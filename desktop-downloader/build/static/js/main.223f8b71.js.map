{"version":3,"file":"static/js/main.223f8b71.js","mappings":"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","sources":["../node_modules/@babel/runtime/helpers/esm/typeof.js","../node_modules/@babel/runtime/helpers/esm/toPropertyKey.js","../node_modules/@babel/runtime/helpers/esm/toPrimitive.js","../node_modules/@babel/runtime/helpers/esm/defineProperty.js","../node_modules/@babel/runtime/helpers/esm/objectSpread2.js","index.js"],"sourcesContent":["function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}\nexport { _typeof as default };","import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nfunction toPropertyKey(t) {\n  var i = toPrimitive(t, \"string\");\n  return \"symbol\" == _typeof(i) ? i : i + \"\";\n}\nexport { toPropertyKey as default };","import _typeof from \"./typeof.js\";\nfunction toPrimitive(t, r) {\n  if (\"object\" != _typeof(t) || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != _typeof(i)) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nexport { toPrimitive as default };","import toPropertyKey from \"./toPropertyKey.js\";\nfunction _defineProperty(e, r, t) {\n  return (r = toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : e[r] = t, e;\n}\nexport { _defineProperty as default };","import defineProperty from \"./defineProperty.js\";\nfunction ownKeys(e, r) {\n  var t = Object.keys(e);\n  if (Object.getOwnPropertySymbols) {\n    var o = Object.getOwnPropertySymbols(e);\n    r && (o = o.filter(function (r) {\n      return Object.getOwnPropertyDescriptor(e, r).enumerable;\n    })), t.push.apply(t, o);\n  }\n  return t;\n}\nfunction _objectSpread2(e) {\n  for (var r = 1; r < arguments.length; r++) {\n    var t = null != arguments[r] ? arguments[r] : {};\n    r % 2 ? ownKeys(Object(t), !0).forEach(function (r) {\n      defineProperty(e, r, t[r]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) {\n      Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r));\n    });\n  }\n  return e;\n}\nexport { _objectSpread2 as default };","/* eslint-disable */\r\nconst PRESET_LABELS = {\r\n  'mp4-1080': '1080p Pro',\r\n  'mp4-720': '720p HD',\r\n  mp3: 'Audio only',\r\n  social: 'Social'\r\n}\r\n\r\nconst textarea = document.getElementById('url-input')\r\nconst addToQueueBtn = document.getElementById('add-to-queue-btn')\r\nconst queueList = document.getElementById('queue-list')\r\nconst queueCounter = document.getElementById('queue-counter')\r\nconst selectionCounter = document.getElementById('selection-counter')\r\nconst clearQueueBtn = document.getElementById('clear-queue')\r\nconst queueSelectAll = document.getElementById('queue-select-all')\r\nconst selectionClearBtn = document.getElementById('selection-clear')\r\nconst queueExportSelectedBtn = document.getElementById('queue-export-selected')\r\nconst queueExportAllBtn = document.getElementById('queue-export-all')\r\nconst fileMenu = document.getElementById('file-menu')\r\nconst statusDestination = document.getElementById('status-destination')\r\nconst statusLine = document.getElementById('status-line')\r\nconst statusQueue = document.getElementById('status-queue')\r\nconst statusPreset = document.getElementById('status-preset')\r\nconst statusEngine = document.getElementById('status-engine')\r\nconst menuTriggers = document.querySelectorAll('[data-menu-trigger]')\r\n\r\nconst previewVideo = document.getElementById('preview-video')\r\nconst previewCard = document.getElementById('preview-card')\r\nconst previewEmpty = document.getElementById('preview-empty')\r\nconst previewInfo = document.getElementById('preview-info')\r\nconst previewPlayBtn = document.getElementById('preview-play')\r\nconst previewStopBtn = document.getElementById('preview-stop')\r\nconst previewRestartBtn = document.getElementById('preview-restart')\r\nconst videoFormatBadge = document.getElementById('video-format-badge')\r\nconst trimStartInput = document.getElementById('trim-start')\r\nconst trimEndInput = document.getElementById('trim-end')\r\nconst trimStartLabel = document.getElementById('trim-start-label')\r\nconst trimEndLabel = document.getElementById('trim-end-label')\r\nconst trimDurationLabel = document.getElementById('trim-duration')\r\nconst trimFill = document.getElementById('trim-fill')\r\nconst currentTimeDisplay = document.getElementById('current-time')\r\nconst totalTimeDisplay = document.getElementById('total-time')\r\nconst timelineHoverPreview = document.getElementById('timeline-hover')\r\nconst playheadIndicator = document.getElementById('playhead-indicator')\r\nconst timelineTrack = document.getElementById('trim-timeline-track')\r\nconst timelineMarkers = document.getElementById('timeline-markers')\r\nconst previewPane = document.querySelector('.preview-pane')\r\nconst metadataPane = document.getElementById('metadata-pane')\r\nconst metadataPopover = document.getElementById('metadata-popover')\r\nconst metadataPopoverTitle = document.getElementById('metadata-popover-title')\r\nconst metadataBackdrop = document.getElementById('metadata-backdrop')\r\nconst metadataCloseBtn = document.getElementById('metadata-close')\r\nconst summaryOpenTriggers = document.querySelectorAll('[data-open-panel]')\r\nconst metadataCards = document.querySelectorAll('[data-popover-panel]')\r\nconst summaryValueFields = {\r\n  thumbnail: document.getElementById('summary-thumbnail'),\r\n  title: document.getElementById('summary-title'),\r\n  keywords: document.getElementById('summary-keywords'),\r\n  description: document.getElementById('summary-description')\r\n}\r\nconst summaryChipRefs = {\r\n  thumbnail: document.querySelector('[data-summary-chip=\"thumbnail\"]'),\r\n  title: document.querySelector('[data-summary-chip=\"title\"]'),\r\n  keywords: document.querySelector('[data-summary-chip=\"keywords\"]'),\r\n  description: document.querySelector('[data-summary-chip=\"description\"]')\r\n}\r\nconst premiumRefreshBtn = document.getElementById('premium-refresh')\r\nconst premiumStatusLabel = document.getElementById('premium-status')\r\nconst premiumToggleControls = document.querySelectorAll('[data-premium-control]')\r\nconst premiumCardGroups = {\r\n  thumbnail: Array.from(document.querySelectorAll('[data-premium-card=\"thumbnail\"]')),\r\n  seo: Array.from(document.querySelectorAll('[data-premium-card=\"seo\"]')),\r\n  story: Array.from(document.querySelectorAll('[data-premium-card^=\"story\"]'))\r\n}\r\nconst premiumThumbnailFrame = document.getElementById('premium-thumbnail')\r\nconst premiumThumbnailRatioLabel = document.getElementById('premium-thumbnail-ratio')\r\nconst premiumKeywordsField = document.getElementById('premium-keywords-string')\r\nconst premiumTitleField = document.getElementById('premium-title')\r\nconst premiumDescriptionField = document.getElementById('premium-description')\r\nconst exportMetaThumbnail = document.getElementById('export-meta-thumbnail')\r\nconst exportMetaKeywords = document.getElementById('export-meta-keywords')\r\nconst exportMetaTitle = document.getElementById('export-meta-title')\r\nconst featureSummaryMap = {\r\n  thumbnail: ['thumbnail'],\r\n  seo: ['keywords'],\r\n  story: ['title', 'description']\r\n}\r\nconst summaryFeatureLookup = {\r\n  thumbnail: 'thumbnail',\r\n  keywords: 'seo',\r\n  title: 'story',\r\n  description: 'story'\r\n}\r\nconst panelTitleMap = {\r\n  thumbnail: 'Smart thumbnail',\r\n  keywords: 'SEO keywords',\r\n  title: 'Story title',\r\n  description: 'Caption draft'\r\n}\r\nconst orderedPanelKeys = ['thumbnail', 'keywords', 'title', 'description']\r\nconst summaryReadyChecks = {\r\n  thumbnail: () => Boolean(state.preview.metadata.thumbnail),\r\n  keywords: () => Boolean(state.preview.metadata.keywords?.length),\r\n  title: () => Boolean(state.preview.metadata.title?.trim()),\r\n  description: () => Boolean(state.preview.metadata.description?.trim())\r\n}\r\n\r\nconst GUIDE_STAGES = ['paste', 'queue', 'download', 'preview']\r\nconst guideProgress = GUIDE_STAGES.reduce((acc, stage) => ({ ...acc, [stage]: false }), {})\r\n\r\nconst getPreviewGuideMarkup = (message = 'Download a video to begin') => `\r\n  <div class=\"hacker-loading\">\r\n    <div class=\"hacker-logo\">\r\n      <span class=\"glitch-text\" data-text=\"WH404\">WH404</span>\r\n      <span class=\"hacker-subtitle\">WORD HACKER</span>\r\n    </div>\r\n    <div class=\"hacker-logs\">\r\n      <div class=\"log-line\"> ${message}</div>\r\n      <div class=\"log-line\"> We handle everything automatically</div>\r\n      <div class=\"log-line\"> Follow these 4 quick steps</div>\r\n    </div>\r\n    <ul class=\"guide-steps\">\r\n      <li class=\"guide-step\" data-stage=\"paste\"><span>1.</span> Paste a link and press Add to Queue</li>\r\n      <li class=\"guide-step\" data-stage=\"queue\"><span>2.</span> Watch the queue progress</li>\r\n      <li class=\"guide-step\" data-stage=\"download\"><span>3.</span> Let WH404 download the file</li>\r\n      <li class=\"guide-step\" data-stage=\"preview\"><span>4.</span> Preview, trim, then export</li>\r\n    </ul>\r\n    <div class=\"progress-dots\"><span>.</span><span>.</span><span>.</span></div>\r\n  </div>\r\n`\r\n\r\nconst showPreviewGuide = (message) => {\r\n  if (!previewEmpty) return\r\n  previewEmpty.innerHTML = getPreviewGuideMarkup(message)\r\n  previewEmpty.classList.remove('hidden')\r\n  applyGuideProgress()\r\n}\r\n\r\nconst applyGuideProgress = () => {\r\n  if (!previewEmpty) return\r\n  previewEmpty.querySelectorAll('.guide-step').forEach((step) => {\r\n    const stage = step.dataset.stage\r\n    if (guideProgress[stage]) {\r\n      step.classList.add('completed')\r\n    } else {\r\n      step.classList.remove('completed')\r\n    }\r\n  })\r\n}\r\n\r\nconst updateGuideProgress = (stage) => {\r\n  if (!Object.prototype.hasOwnProperty.call(guideProgress, stage)) return\r\n  if (!guideProgress[stage]) {\r\n    guideProgress[stage] = true\r\n    applyGuideProgress()\r\n  }\r\n}\r\n\r\nconst resetGuideStage = (stage) => {\r\n  if (!Object.prototype.hasOwnProperty.call(guideProgress, stage)) return\r\n  guideProgress[stage] = false\r\n  applyGuideProgress()\r\n}\r\n\r\nconst DEFAULT_PREVIEW_MESSAGE = 'Paste any link to start decoding.'\r\n\r\n// Check if timeline elements exist\r\nif (!currentTimeDisplay || !totalTimeDisplay) {\r\n  console.warn('[Init] Timeline display elements not found')\r\n}\r\nif (!timelineHoverPreview || !playheadIndicator) {\r\n  console.warn('[Init] Timeline interaction elements not found')\r\n}\r\n\r\nconst exportPop = document.getElementById('export-pop')\r\nconst exportTarget = document.getElementById('export-target')\r\nconst exportBrowse = document.getElementById('export-browse')\r\nconst exportConfirm = document.getElementById('export-confirm')\r\nconst exportFormatSelect = document.getElementById('export-format')\r\nconst exportMessage = document.getElementById('export-message')\r\nconst exportMessageText = document.getElementById('export-message-text')\r\nconst exportMessageDots = document.getElementById('export-message-dots')\r\nconst exportLoader = document.getElementById('export-loader')\r\nconst exportPathInput = document.getElementById('export-path')\r\nconst exportCancel = document.getElementById('export-cancel')\r\nconst exportTypeSelect = document.getElementById('export-type')\r\nconst exportResolutionSelect = document.getElementById('export-resolution')\r\nconst exportConfirmDefaultLabel = exportConfirm?.textContent || 'Export selection'\r\n\r\nconst formatCache = new Map()\r\nconst STORAGE_KEYS = {\r\n  destination: 'wh404:destination'\r\n}\r\nlet engineOffline = false\r\nlet queueId = 0\r\nlet lastPopoverAnchor = null\r\n\r\nconst state = {\r\n  format: 'mp4-1080',\r\n  queue: [],\r\n  busy: false,\r\n  exportId: null,\r\n  autoRun: true,\r\n  destination: '',\r\n  queueSelection: new Set(),\r\n  preview: {\r\n    file: '',\r\n    url: '',\r\n    duration: 0,\r\n    start: 0,\r\n    end: 0,\r\n    ready: false,\r\n    trimmedFile: null,\r\n    trimProcessing: false,\r\n    metadata: {\r\n      title: '',\r\n      description: '',\r\n      keywords: [],\r\n      thumbnail: '',\r\n      fetched: false\r\n    },\r\n    premium: {\r\n      thumbnail: true,\r\n      seo: true,\r\n      story: true\r\n    },\r\n    activePanel: 'thumbnail'\r\n  },\r\n  exportContext: {\r\n    targets: [],\r\n    formats: [],\r\n    resolutions: [],\r\n    audioFormats: [],\r\n    selectedResolution: null,\r\n    selectedFormat: null,\r\n    type: 'video'\r\n  },\r\n  previewMode: 'video'\r\n}\r\n\r\nconst DEFAULT_DEST_LABEL = 'Downloads/WordHackerDownloads'\r\nconst escapeHtml = (value = '') => {\r\n  return String(value)\r\n    .replace(/&/g, '&amp;')\r\n    .replace(/</g, '&lt;')\r\n    .replace(/>/g, '&gt;')\r\n    .replace(/\"/g, '&quot;')\r\n    .replace(/'/g, '&#39;')\r\n}\r\nconst clampValue = (value, min, max) => Math.min(Math.max(value, min), max)\r\nconst getSelectedQueueItems = () => state.queue.filter((item) => state.queueSelection.has(item.id))\r\n\r\nconst setPremiumStatus = (text, variant = 'idle') => {\r\n  if (!premiumStatusLabel) return\r\n  premiumStatusLabel.textContent = text\r\n  premiumStatusLabel.classList.remove('loading', 'error', 'success')\r\n  if (variant !== 'idle') {\r\n    premiumStatusLabel.classList.add(variant)\r\n  }\r\n}\r\n\r\nconst simplifyAspectRatio = (width, height) => {\r\n  const gcd = (a, b) => (b ? gcd(b, a % b) : a)\r\n  const safeWidth = Math.max(1, Math.round(width))\r\n  const safeHeight = Math.max(1, Math.round(height))\r\n  const divisor = gcd(safeWidth, safeHeight) || 1\r\n  return {\r\n    w: Math.round(safeWidth / divisor),\r\n    h: Math.round(safeHeight / divisor)\r\n  }\r\n}\r\n\r\nconst getAspectRatioLabel = (width, height) => {\r\n  if (!width || !height) return '--'\r\n  const ratio = width / height\r\n  const common = [\r\n    { label: '9:16', value: 9 / 16 },\r\n    { label: '4:5', value: 4 / 5 },\r\n    { label: '3:4', value: 3 / 4 },\r\n    { label: '1:1', value: 1 },\r\n    { label: '4:3', value: 4 / 3 },\r\n    { label: '16:9', value: 16 / 9 }\r\n  ]\r\n  const closest = common.reduce((prev, candidate) => {\r\n    return Math.abs(candidate.value - ratio) < Math.abs(prev.value - ratio) ? candidate : prev\r\n  })\r\n  if (Math.abs(closest.value - ratio) <= 0.08) {\r\n    return closest.label\r\n  }\r\n  const simplified = simplifyAspectRatio(width, height)\r\n  return `${simplified.w}:${simplified.h}`\r\n}\r\n\r\nconst updateThumbnailRatioLabel = () => {\r\n  if (!premiumThumbnailRatioLabel) return\r\n  const width = previewVideo?.videoWidth\r\n  const height = previewVideo?.videoHeight\r\n  premiumThumbnailRatioLabel.textContent = width && height ? `Aspect: ${getAspectRatioLabel(width, height)}` : 'Aspect: --'\r\n}\r\n\r\nconst formatTitleSummary = () => {\r\n  const title = state.preview.metadata.title?.trim()\r\n  if (!title) return 'Title not ready'\r\n  return title.length > 42 ? `${title.slice(0, 42)}` : title\r\n}\r\n\r\nconst formatKeywordSummary = () => {\r\n  const keywords = (state.preview.metadata.keywords || []).map((word) => word.trim()).filter(Boolean)\r\n  if (!keywords.length) return 'Waiting'\r\n  if (keywords.length === 1) return keywords[0]\r\n  if (keywords.length === 2) return `${keywords[0]}, ${keywords[1]}`\r\n  return `${keywords.slice(0, 2).join(', ')} +${keywords.length - 2}`\r\n}\r\n\r\nconst formatDescriptionSummary = () => {\r\n  const description = state.preview.metadata.description?.trim()\r\n  if (!description) return 'Waiting'\r\n  const words = description.split(/\\s+/).filter(Boolean)\r\n  if (!words.length) return 'Waiting'\r\n  if (words.length < 12) return description.length > 60 ? `${description.slice(0, 57)}` : description\r\n  return `${words.length} words`\r\n}\r\n\r\nconst formatThumbnailSummary = () => {\r\n  if (!state.preview.metadata.thumbnail) return 'Waiting'\r\n  const width = previewVideo?.videoWidth\r\n  const height = previewVideo?.videoHeight\r\n  if (width && height) {\r\n    return `${getAspectRatioLabel(width, height)} ready`\r\n  }\r\n  return 'Ready'\r\n}\r\n\r\nconst summaryFormatters = {\r\n  thumbnail: formatThumbnailSummary,\r\n  keywords: formatKeywordSummary,\r\n  title: formatTitleSummary,\r\n  description: formatDescriptionSummary\r\n}\r\n\r\nconst getNormalizedPanelKey = (panel) => (orderedPanelKeys.includes(panel) ? panel : 'thumbnail')\r\nconst getFirstEnabledPanel = () => {\r\n  return orderedPanelKeys.find((panel) => {\r\n    const feature = summaryFeatureLookup[panel]\r\n    return feature ? state.preview.premium[feature] : true\r\n  }) || 'thumbnail'\r\n}\r\nconst resolvePanelKey = (panel) => {\r\n  const normalized = getNormalizedPanelKey(panel)\r\n  const feature = summaryFeatureLookup[normalized]\r\n  if (feature && !state.preview.premium[feature]) {\r\n    return getFirstEnabledPanel()\r\n  }\r\n  return normalized\r\n}\r\n\r\nconst updatePopoverAnchor = (chip) => {\r\n  if (!chip || !metadataPopover || !previewPane) return\r\n  const chipRect = chip.getBoundingClientRect()\r\n  const paneRect = previewPane.getBoundingClientRect()\r\n  if (!chipRect.width || !paneRect.width) return\r\n  \r\n  const popoverWidth = Math.min(420, paneRect.width - 54)\r\n  const halfPopover = popoverWidth / 2\r\n  const chipCenterX = chipRect.left + chipRect.width / 2 - paneRect.left\r\n  \r\n  const minX = halfPopover + 20\r\n  const maxX = paneRect.width - halfPopover - 20\r\n  const clampedX = clampValue(chipCenterX, minX, maxX)\r\n  \r\n  const anchorY = chipRect.bottom - paneRect.top + 16\r\n  const maxY = Math.max(120, paneRect.height - 140)\r\n  const clampedY = clampValue(anchorY, 90, maxY)\r\n  \r\n  metadataPopover.style.setProperty('--popover-x', `${clampedX}px`)\r\n  metadataPopover.style.setProperty('--popover-y', `${clampedY}px`)\r\n  lastPopoverAnchor = chip\r\n}\r\n\r\nconst setActiveMetadataPanel = (panelKey = 'thumbnail', anchorChip) => {\r\n  const normalized = resolvePanelKey(panelKey)\r\n  state.preview.activePanel = normalized\r\n  metadataCards.forEach((card) => {\r\n    card.classList.toggle('active', card.dataset.popoverPanel === normalized)\r\n  })\r\n  if (metadataPopoverTitle) {\r\n    metadataPopoverTitle.textContent = panelTitleMap[normalized] || 'Metadata toolkit'\r\n  }\r\n  if (anchorChip) {\r\n    updatePopoverAnchor(anchorChip)\r\n  } else if (lastPopoverAnchor) {\r\n    updatePopoverAnchor(lastPopoverAnchor)\r\n  }\r\n  updateSummaryChips()\r\n}\r\n\r\nconst updateSummaryChips = () => {\r\n  Object.entries(summaryValueFields).forEach(([key, node]) => {\r\n    if (!node) return\r\n    const feature = summaryFeatureLookup[key]\r\n    if (feature && !state.preview.premium[feature]) {\r\n      node.textContent = 'Disabled'\r\n      return\r\n    }\r\n    node.textContent = summaryFormatters[key]?.() || 'Waiting'\r\n  })\r\n\r\n  Object.entries(summaryFeatureLookup).forEach(([summaryKey, feature]) => {\r\n    const enabled = state.preview.premium[feature]\r\n    const chip = summaryChipRefs[summaryKey]\r\n    if (!chip) return\r\n    const ready = enabled && Boolean(summaryReadyChecks[summaryKey]?.())\r\n    chip.classList.toggle('disabled', !enabled)\r\n    chip.classList.toggle('ready', ready)\r\n    chip.classList.toggle('active', state.previewMode === 'insights' && state.preview.activePanel === summaryKey)\r\n    chip.setAttribute('aria-expanded', state.previewMode === 'insights' && state.preview.activePanel === summaryKey ? 'true' : 'false')\r\n  })\r\n}\r\n\r\nconst applyPremiumToggleUI = () => {\r\n  Object.entries(premiumCardGroups).forEach(([feature, cards]) => {\r\n    cards.forEach((card) => card?.classList.toggle('disabled', !state.preview.premium[feature]))\r\n  })\r\n  const activeFeature = summaryFeatureLookup[state.preview.activePanel]\r\n  if (activeFeature && !state.preview.premium[activeFeature]) {\r\n    setActiveMetadataPanel(getFirstEnabledPanel())\r\n  } else {\r\n    updateSummaryChips()\r\n  }\r\n  renderExportMetadata()\r\n}\r\n\r\nconst renderExportMetadata = () => {\r\n  if (exportMetaThumbnail) {\r\n    if (!state.preview.premium.thumbnail) {\r\n      exportMetaThumbnail.textContent = 'Disabled'\r\n    } else if (state.preview.metadata.thumbnail) {\r\n      exportMetaThumbnail.textContent = 'Attached'\r\n    } else {\r\n      exportMetaThumbnail.textContent = 'Waiting for clip'\r\n    }\r\n  }\r\n  if (exportMetaKeywords) {\r\n    if (!state.preview.premium.seo) {\r\n      exportMetaKeywords.textContent = 'Disabled'\r\n    } else if (state.preview.metadata.keywords?.length) {\r\n      exportMetaKeywords.textContent = `${state.preview.metadata.keywords.length} tags ready`\r\n    } else {\r\n      exportMetaKeywords.textContent = 'Waiting for clip'\r\n    }\r\n  }\r\n  if (exportMetaTitle) {\r\n    if (!state.preview.premium.story) {\r\n      exportMetaTitle.textContent = 'Disabled'\r\n    } else if (state.preview.metadata.title) {\r\n      exportMetaTitle.textContent = 'Attached'\r\n    } else {\r\n      exportMetaTitle.textContent = 'Waiting for clip'\r\n    }\r\n  }\r\n}\r\n\r\nconst renderPremiumMetadata = () => {\r\n  if (premiumThumbnailFrame) {\r\n    if (state.preview.metadata.thumbnail) {\r\n      premiumThumbnailFrame.style.backgroundImage = `url(\"${state.preview.metadata.thumbnail}\")`\r\n      premiumThumbnailFrame.innerHTML = ''\r\n    } else {\r\n      premiumThumbnailFrame.style.backgroundImage = 'none'\r\n      premiumThumbnailFrame.innerHTML = '<p>Thumbnail not ready</p>'\r\n    }\r\n  }\r\n\r\n  updateThumbnailRatioLabel()\r\n\r\n  if (premiumKeywordsField) {\r\n    const keywords = (state.preview.metadata.keywords || []).map((word) => word.trim()).filter(Boolean)\r\n    premiumKeywordsField.textContent = keywords.length ? keywords.join(', ') : 'Keywords will appear here'\r\n  }\r\n\r\n  if (premiumTitleField) {\r\n    premiumTitleField.textContent = state.preview.metadata.title || 'Title not ready'\r\n  }\r\n  if (premiumDescriptionField) {\r\n    premiumDescriptionField.textContent = state.preview.metadata.description || 'Description will appear here when a clip is selected.'\r\n  }\r\n  updateSummaryChips()\r\n  renderExportMetadata()\r\n}\r\n\r\nconst setPreviewMode = (mode = 'video') => {\r\n  if (!previewPane) return\r\n  const nextMode = mode === 'insights' ? 'insights' : 'video'\r\n  state.previewMode = nextMode\r\n  previewPane.dataset.mode = nextMode\r\n  metadataPopover?.setAttribute('aria-hidden', nextMode === 'video' ? 'true' : 'false')\r\n  updateSummaryChips()\r\n  if (nextMode === 'insights') {\r\n    const activeChip = summaryChipRefs[state.preview.activePanel]\r\n    if (activeChip) {\r\n      updatePopoverAnchor(activeChip)\r\n    }\r\n    try {\r\n      previewVideo.pause()\r\n    } catch (error) {\r\n      // ignore\r\n    }\r\n  } else if (state.preview.ready) {\r\n    previewEmpty.classList.add('hidden')\r\n  }\r\n}\r\n\r\nconst buildFallbackMetadata = (item = {}) => {\r\n  let keywords = []\r\n  try {\r\n    const urlObj = new URL(item.url || '')\r\n    keywords = urlObj.pathname\r\n      .split('/')\r\n      .filter(Boolean)\r\n      .slice(-4)\r\n      .map((segment) => segment.replace(/[-_]/g, ' ')\r\n        .replace(/\\d+/g, '')\r\n        .trim())\r\n      .filter(Boolean)\r\n  } catch (err) {\r\n    keywords = []\r\n  }\r\n  if (!keywords.length && item.platform?.name) {\r\n    keywords = [item.platform.name.toLowerCase(), 'word hacker 404']\r\n  }\r\n  const fallbackTitle = item.platform ? `${item.platform.name} capture` : 'Word Hacker capture'\r\n  return {\r\n    title: fallbackTitle,\r\n    description: `Auto-generated notes for ${fallbackTitle}. Add your hook before publishing.`,\r\n    keywords,\r\n    thumbnail: item.thumbnail || (item.url ? `https://image.thum.io/get/width/900/crop/600/${encodeURIComponent(item.url)}` : ''),\r\n    fetched: false\r\n  }\r\n}\r\n\r\nconst fetchPremiumMetadata = async (item) => {\r\n  if (!item || !item.url) {\r\n    setPremiumStatus('Select a clip to load metadata.')\r\n    return\r\n  }\r\n  setPremiumStatus('Generating insights...', 'loading')\r\n  const fallback = buildFallbackMetadata(item)\r\n  let response = null\r\n  try {\r\n    if (typeof window.downloader?.fetchMetadata === 'function') {\r\n      response = await window.downloader.fetchMetadata(item.url)\r\n    } else if (typeof window.downloader?.getSeoMetadata === 'function') {\r\n      response = await window.downloader.getSeoMetadata(item.url)\r\n    }\r\n  } catch (err) {\r\n    console.warn('[Premium] Metadata fetch failed', err)\r\n  }\r\n\r\n  const normalized = {\r\n    title: response?.title || fallback.title,\r\n    description: response?.description || fallback.description,\r\n    keywords: Array.isArray(response?.keywords) && response.keywords.length ? response.keywords : fallback.keywords,\r\n    thumbnail: response?.thumbnail || fallback.thumbnail,\r\n    fetched: Boolean(response)\r\n  }\r\n\r\n  state.preview.metadata = normalized\r\n  renderPremiumMetadata()\r\n  setPremiumStatus(normalized.fetched ? 'Premium insights ready.' : 'Using offline cues. Tap refresh to retry.', normalized.fetched ? 'success' : 'error')\r\n}\r\n\r\nconst buildMetadataPayload = () => {\r\n  const payload = {}\r\n  if (state.preview.premium.thumbnail && state.preview.metadata.thumbnail) {\r\n    payload.thumbnail = state.preview.metadata.thumbnail\r\n  }\r\n  if (state.preview.premium.seo && state.preview.metadata.keywords?.length) {\r\n    payload.keywords = state.preview.metadata.keywords\r\n  }\r\n  if (state.preview.premium.story) {\r\n    if (state.preview.metadata.title) payload.title = state.preview.metadata.title\r\n    if (state.preview.metadata.description) payload.description = state.preview.metadata.description\r\n  }\r\n  return Object.keys(payload).length ? payload : null\r\n}\r\n\r\nconst triggerDownloadFromUrl = (url, filename = 'wordhacker-asset') => {\r\n  if (!url) return false\r\n  const link = document.createElement('a')\r\n  link.href = url\r\n  link.download = filename\r\n  link.target = '_blank'\r\n  document.body.appendChild(link)\r\n  link.click()\r\n  document.body.removeChild(link)\r\n  return true\r\n}\r\n\r\nconst getBatchStatusMeta = (item) => {\r\n  if (item.status === 'complete' && (item.exported || (item.files && item.files.length))) {\r\n    return { icon: '', label: 'Ready', className: 'ready' }\r\n  }\r\n  if (item.status === 'error') {\r\n    return { icon: '', label: 'Needs attention', className: 'error' }\r\n  }\r\n  return { icon: '...', label: 'Processing', className: 'waiting' }\r\n}\r\n\r\nconst buildBatchSummaryMarkup = (items) => {\r\n  return `\r\n    <div class=\"batch-summary\">\r\n      <p class=\"batch-summary-header\">${items.length} clips selected</p>\r\n      <div class=\"batch-summary-list\">\r\n        ${items\r\n          .map((item, idx) => {\r\n            const meta = getBatchStatusMeta(item)\r\n            const label = escapeHtml(item.platform ? item.platform.name : `Clip ${idx + 1}`)\r\n            const safeUrl = escapeHtml(item.url)\r\n            return `\r\n              <div class=\"batch-summary-row\">\r\n                <div>\r\n                  <strong>${label}</strong>\r\n                  <div class=\"mono\">${safeUrl}</div>\r\n                </div>\r\n                <div class=\"batch-summary-status ${meta.className}\">\r\n                  <span>${meta.icon}</span>\r\n                  <span>${meta.label}</span>\r\n                </div>\r\n              </div>\r\n            `\r\n          })\r\n          .join('')}\r\n      </div>\r\n      <p class=\"batch-summary-footer\">Run Export Selected to process them together.</p>\r\n    </div>\r\n  `\r\n}\r\n\r\nlet syncPreviewWithSelection = () => {}\r\n\r\nconst handlePremiumCopy = async (target) => {\r\n  let payload = ''\r\n  if (target === 'thumbnail') {\r\n    payload = state.preview.metadata.thumbnail\r\n  } else if (target === 'keywords') {\r\n    payload = (state.preview.metadata.keywords || []).join(', ')\r\n  } else if (target === 'title') {\r\n    payload = state.preview.metadata.title\r\n  } else if (target === 'description') {\r\n    payload = state.preview.metadata.description\r\n  }\r\n  if (!payload) {\r\n    setPremiumStatus('Nothing to copy yet.', 'error')\r\n    return\r\n  }\r\n  const copied = await copyToClipboard(payload)\r\n  if (copied) {\r\n    setPremiumStatus('Copied to clipboard!', 'success')\r\n  } else {\r\n    setPremiumStatus('Unable to copy right now.', 'error')\r\n  }\r\n}\r\n\r\nconst handleExportCopy = async (target) => {\r\n  if (target === 'thumbnail') {\r\n    const success = await copyToClipboard(state.preview.metadata.thumbnail || '')\r\n    setPremiumStatus(success ? 'Thumbnail link copied.' : 'Nothing to copy yet.', success ? 'success' : 'error')\r\n    return\r\n  }\r\n  if (target === 'keywords') {\r\n    const success = await copyToClipboard((state.preview.metadata.keywords || []).join(', '))\r\n    setPremiumStatus(success ? 'Keywords copied.' : 'Nothing to copy yet.', success ? 'success' : 'error')\r\n    return\r\n  }\r\n  if (target === 'story') {\r\n    const story = `${state.preview.metadata.title || ''}\\n\\n${state.preview.metadata.description || ''}`.trim()\r\n    const success = await copyToClipboard(story)\r\n    setPremiumStatus(success ? 'Title & description copied.' : 'Nothing to copy yet.', success ? 'success' : 'error')\r\n  }\r\n}\r\n\r\nlet exportDotsTimer = null\r\n\r\nconst startExportDots = () => {\r\n  if (!exportMessageDots || exportDotsTimer) return\r\n  const frames = ['.', '..', '...']\r\n  let index = 0\r\n  exportMessageDots.textContent = frames[index]\r\n  exportDotsTimer = setInterval(() => {\r\n    index = (index + 1) % frames.length\r\n    exportMessageDots.textContent = frames[index]\r\n  }, 320)\r\n}\r\n\r\nconst stopExportDots = () => {\r\n  if (exportDotsTimer) {\r\n    clearInterval(exportDotsTimer)\r\n    exportDotsTimer = null\r\n  }\r\n  if (exportMessageDots) {\r\n    exportMessageDots.textContent = ''\r\n  }\r\n}\r\n\r\nconst updateExportMessage = (text, { loading = false, variant } = {}) => {\r\n  if (exportMessageText) {\r\n    exportMessageText.textContent = text\r\n  } else {\r\n    exportMessage.textContent = text\r\n  }\r\n\r\n  if (exportMessage) {\r\n    exportMessage.classList.remove('success', 'error')\r\n    if (variant) {\r\n      exportMessage.classList.add(variant)\r\n    }\r\n  }\r\n\r\n  if (loading) {\r\n    exportLoader?.classList.add('active')\r\n    startExportDots()\r\n  } else {\r\n    exportLoader?.classList.remove('active')\r\n    stopExportDots()\r\n  }\r\n}\r\n\r\nconst formatDestinationLabel = (value) => {\r\n  if (!value) return DEFAULT_DEST_LABEL\r\n  if (value.length <= 28) return value\r\n  return `...${value.slice(-28)}`\r\n}\r\n\r\nconst updateDestinationLabel = () => {\r\n  const display = state.destination || DEFAULT_DEST_LABEL\r\n  if (exportPathInput) {\r\n    exportPathInput.value = display\r\n  }\r\n  if (statusDestination) {\r\n    statusDestination.textContent = `Destination: ${formatDestinationLabel(display)}`\r\n  }\r\n}\r\n\r\nconst setDestination = (path) => {\r\n  state.destination = path || ''\r\n  updateDestinationLabel()\r\n  try {\r\n    window.localStorage?.setItem(STORAGE_KEYS.destination, state.destination)\r\n  } catch (error) {\r\n    console.warn('Unable to persist destination', error)\r\n  }\r\n}\r\n\r\nconst openDestinationFolder = () => {\r\n  window.systemDialogs?.openFolder(state.destination || null)\r\n}\r\n\r\nconst closeMenus = () => {\r\n  document.querySelectorAll('.menu-dropdown').forEach((menu) => menu.classList.remove('open'))\r\n}\r\n\r\nconst toggleMenu = (targetId) => {\r\n  if (!targetId) return\r\n  const menu = document.getElementById(`${targetId}-menu`)\r\n  if (!menu) return\r\n  const isOpen = menu.classList.contains('open')\r\n  closeMenus()\r\n  if (!isOpen) {\r\n    menu.classList.add('open')\r\n  }\r\n}\r\n\r\nconst formatFileName = (filePath = '') => {\r\n  if (!filePath) return 'Unnamed file'\r\n  const parts = filePath.split(/[\\\\\\/]/).filter(Boolean)\r\n  return parts.pop() || filePath\r\n}\r\n\r\nconst decodeDatasetPath = (value = '') => {\r\n  if (!value) return ''\r\n  try {\r\n    return decodeURIComponent(value)\r\n  } catch (error) {\r\n    console.warn('Unable to decode dataset path', error)\r\n    return value\r\n  }\r\n}\r\n\r\nconst copyToClipboard = async (text) => {\r\n  if (!text) return false\r\n  if (navigator.clipboard?.writeText) {\r\n    try {\r\n      await navigator.clipboard.writeText(text)\r\n      return true\r\n    } catch (error) {\r\n      console.warn('Clipboard API failed', error)\r\n    }\r\n  }\r\n  try {\r\n    const temp = document.createElement('textarea')\r\n    temp.value = text\r\n    temp.style.position = 'fixed'\r\n    temp.style.opacity = '0'\r\n    temp.style.pointerEvents = 'none'\r\n    document.body.appendChild(temp)\r\n    temp.focus()\r\n    temp.select()\r\n    temp.setSelectionRange(0, text.length)\r\n    const success = document.execCommand('copy')\r\n    temp.remove()\r\n    return success\r\n  } catch (error) {\r\n    console.warn('Clipboard fallback failed', error)\r\n    return false\r\n  }\r\n}\r\n\r\nconst buildFileList = (item) => {\r\n  const wrapper = document.createElement('div')\r\n  wrapper.className = 'slot-files'\r\n  const title = document.createElement('p')\r\n  title.className = 'slot-files-title'\r\n  \r\n  const isExported = item.exported && item.exportedFiles && item.exportedFiles.length\r\n  const displayFiles = isExported ? item.exportedFiles : item.files\r\n  \r\n  if (isExported) {\r\n    title.textContent = displayFiles.length === 1 ? ' Exported file' : ` Exported files (${displayFiles.length})`\r\n  } else {\r\n    title.textContent = displayFiles.length === 1 ? ' Ready to export' : ` Ready to export (${displayFiles.length} files)`\r\n  }\r\n  wrapper.appendChild(title)\r\n\r\n  displayFiles.forEach((file) => {\r\n    const row = document.createElement('div')\r\n    row.className = 'slot-file'\r\n\r\n    const info = document.createElement('div')\r\n    info.className = 'slot-file-info'\r\n\r\n    const name = document.createElement('p')\r\n    name.className = 'slot-file-name'\r\n    name.textContent = formatFileName(file)\r\n\r\n    const pathLabel = document.createElement('p')\r\n    pathLabel.className = 'slot-file-path'\r\n    pathLabel.textContent = isExported ? file : ' Temporary (not saved yet)'\r\n\r\n    info.appendChild(name)\r\n    info.appendChild(pathLabel)\r\n\r\n    const actions = document.createElement('div')\r\n    actions.className = 'slot-file-actions'\r\n\r\n    if (isExported) {\r\n      const revealBtn = document.createElement('button')\r\n      revealBtn.className = 'ghost ghost-icon'\r\n      revealBtn.title = 'Show in Explorer'\r\n      revealBtn.dataset.action = 'reveal'\r\n      revealBtn.dataset.path = encodeURIComponent(file)\r\n      revealBtn.textContent = ''\r\n      actions.appendChild(revealBtn)\r\n    }\r\n\r\n    const copyBtn = document.createElement('button')\r\n    copyBtn.className = 'ghost ghost-icon'\r\n    copyBtn.title = isExported ? 'Copy path' : 'Copy temp path'\r\n    copyBtn.dataset.action = 'copy'\r\n    copyBtn.dataset.path = encodeURIComponent(file)\r\n    copyBtn.textContent = ''\r\n\r\n    actions.appendChild(copyBtn)\r\n\r\n    row.appendChild(info)\r\n    row.appendChild(actions)\r\n    wrapper.appendChild(row)\r\n  })\r\n\r\n  return wrapper\r\n}\r\n\r\nconst formatTime = (value) => {\r\n  const total = Math.max(0, Math.floor(value || 0))\r\n  const minutes = Math.floor(total / 60)\r\n  const seconds = total % 60\r\n  return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`\r\n}\r\n\r\nconst generateTimelineMarkers = (duration) => {\r\n  if (!timelineMarkers || !duration) return\r\n  \r\n  // Generate 5 time markers evenly spaced\r\n  const markerCount = 5\r\n  const markers = []\r\n  \r\n  for (let i = 0; i < markerCount; i++) {\r\n    const time = (i / (markerCount - 1)) * duration\r\n    markers.push(`<span>${formatTime(time)}</span>`)\r\n  }\r\n  \r\n  timelineMarkers.innerHTML = markers.join('')\r\n}\r\n\r\nconst setStatus = (text) => {\r\n  statusLine.textContent = text\r\n}\r\n\r\nconst updatePresetChip = () => {\r\n  statusPreset.textContent = `Preset: ${PRESET_LABELS[state.format] || state.format}`\r\n}\r\n\r\nconst updateQueueChip = () => {\r\n  queueCounter.textContent = `${state.queue.length} item${state.queue.length === 1 ? '' : 's'}`\r\n  statusQueue.textContent = `Queue: ${state.queue.length}`\r\n  updateSelectionCounter()\r\n}\r\n\r\nconst updateSelectionCounter = () => {\r\n  const selectedItems = getSelectedQueueItems()\r\n  const selections = selectedItems.length\r\n  selectionCounter.textContent = `${selections} selected`\r\n  if (queueSelectAll) {\r\n    queueSelectAll.checked = selections > 0 && selections === state.queue.length && state.queue.length > 0\r\n  }\r\n  syncPreviewWithSelection(selectedItems)\r\n}\r\n\r\nconst updateEngineChip = () => {\r\n  if (engineOffline) {\r\n    statusEngine.textContent = 'Engine: offline'\r\n    return\r\n  }\r\n  statusEngine.textContent = state.busy ? 'Engine: running' : 'Engine: idle'\r\n}\r\n\r\nconst detectPlatformFromUrl = (url) => {\r\n  const urlLower = url.toLowerCase()\r\n  if (urlLower.includes('youtube.com') || urlLower.includes('youtu.be')) return { name: 'YouTube', icon: '', color: '#ff0000' }\r\n  if (urlLower.includes('instagram.com') || urlLower.includes('instagr.am')) return { name: 'Instagram', icon: '', color: '#e4405f' }\r\n  if (urlLower.includes('facebook.com') || urlLower.includes('fb.')) return { name: 'Facebook', icon: '', color: '#1877f2' }\r\n  if (urlLower.includes('tiktok.com')) return { name: 'TikTok', icon: '', color: '#00f2ea' }\r\n  if (urlLower.includes('twitter.com') || urlLower.includes('x.com')) return { name: 'Twitter/X', icon: '', color: '#1da1f2' }\r\n  if (urlLower.includes('reddit.com') || urlLower.includes('redd.it')) return { name: 'Reddit', icon: '', color: '#ff4500' }\r\n  if (urlLower.includes('vimeo.com')) return { name: 'Vimeo', icon: '', color: '#1ab7ea' }\r\n  if (urlLower.includes('soundcloud.com')) return { name: 'SoundCloud', icon: '', color: '#ff7700' }\r\n  if (urlLower.includes('dailymotion.com')) return { name: 'Dailymotion', icon: '', color: '#0066dc' }\r\n  if (urlLower.includes('twitch.tv')) return { name: 'Twitch', icon: '', color: '#9146ff' }\r\n  if (urlLower.includes('udemy.com')) return { name: 'Udemy', icon: '', color: '#a435f0' }\r\n  return { name: 'Other', icon: '', color: '#9aa3b2' }\r\n}\r\n\r\nconst parseUrls = () => {\r\n  // Enhanced parser: supports comma, newline, and space separation\r\n  const urls = textarea.value\r\n    .split(/[\\n,\\s]+/)\r\n    .map((url) => url.trim())\r\n    .filter((url) => url.startsWith('http'))\r\n  // Remove duplicates while preserving order\r\n  return Array.from(new Set(urls))\r\n}\r\n\r\nconst createQueueItem = (url) => {\r\n  const platform = detectPlatformFromUrl(url)\r\n  return {\r\n    id: `slot-${++queueId}`,\r\n    url,\r\n    platform,\r\n    status: 'pending',\r\n    percent: 0,\r\n    speed: '0 MB/s',\r\n    eta: '--:--',\r\n    files: []\r\n  }\r\n}\r\n\r\nconst ensureQueueItem = (url) => {\r\n  let item = state.queue.find((entry) => entry.url === url)\r\n  if (!item) {\r\n    item = createQueueItem(url)\r\n    state.queue.push(item)\r\n  }\r\n  return item\r\n}\r\n\r\nconst addToQueue = (urls) => {\r\n  console.log('[Queue] addToQueue called with:', urls)\r\n  let added = 0\r\n  urls.forEach((url) => {\r\n    if (!url) return\r\n    if (!state.queue.some((entry) => entry.url === url)) {\r\n      console.log('[Queue] Adding new item:', url)\r\n      state.queue.push(createQueueItem(url))\r\n      added += 1\r\n    } else {\r\n      console.log('[Queue] Duplicate URL skipped:', url)\r\n    }\r\n  })\r\n  console.log('[Queue] Calling renderQueue, total items:', state.queue.length)\r\n  renderQueue()\r\n  console.log('[Queue] renderQueue completed')\r\n  return added\r\n}\r\n\r\nconst pruneSelection = () => {\r\n  const validIds = new Set(state.queue.map((item) => item.id))\r\n  Array.from(state.queueSelection).forEach((id) => {\r\n    if (!validIds.has(id)) {\r\n      state.queueSelection.delete(id)\r\n    }\r\n  })\r\n}\r\n\r\nconst pushLog = (text) => {\r\n  setStatus(text)\r\n}\r\n\r\nconst toFileUrl = (filePath = '') => {\r\n  if (!filePath) return ''\r\n  if (filePath.startsWith('file://')) return filePath\r\n  // Properly handle Windows paths and special characters\r\n  const normalized = filePath.replace(/\\\\/g, '/')\r\n  const withDrive = normalized.replace(/^([a-zA-Z]):/, '/$1:')\r\n  // Encode each path segment to handle special chars, but not the slashes\r\n  const encoded = withDrive.split('/').map(segment => encodeURIComponent(segment)).join('/')\r\n  return `file://${encoded.startsWith('/') ? '' : '/'}${encoded}`\r\n}\r\n\r\nconst loadPreviewFromItem = (item) => {\r\n  if (!item.files || !item.files.length) {\r\n    setStatus('Preview not ready yet. Finish the download first.')\r\n    return\r\n  }\r\n  \r\n  // Find the first video/audio file\r\n  const source = item.files.find(f => \r\n    f.endsWith('.mp4') || f.endsWith('.webm') || f.endsWith('.mkv') || f.endsWith('.mp3') || f.endsWith('.m4a')\r\n  ) || item.files[0]\r\n  \r\n  state.preview.file = source\r\n  state.preview.url = item.url\r\n  \r\n  // Clear any previous errors\r\n  previewVideo.removeAttribute('poster')\r\n  previewEmpty.classList.add('hidden')\r\n  \r\n  // Set source with proper encoding (toFileUrl now handles encoding)\r\n  const fileUrl = toFileUrl(source)\r\n  console.log('[Preview] Loading:', source)\r\n  console.log('[Preview] File URL:', fileUrl)\r\n  \r\n  previewVideo.src = fileUrl\r\n  previewVideo.load()\r\n  previewInfo.textContent = item.url\r\n  updateGuideProgress('preview')\r\n  fetchPremiumMetadata(item)\r\n  \r\n\r\nsyncPreviewWithSelection = (selectedItems = getSelectedQueueItems()) => {\r\n  if (!previewEmpty) return\r\n  if (!selectedItems.length) {\r\n    previewCard.classList.remove('batch-mode')\r\n    if (state.preview.ready) {\r\n      previewEmpty.classList.add('hidden')\r\n    } else {\r\n      showPreviewGuide(DEFAULT_PREVIEW_MESSAGE)\r\n    }\r\n    return\r\n  }\r\n  if (selectedItems.length === 1) {\r\n    previewCard.classList.remove('batch-mode')\r\n    const target = selectedItems[0]\r\n    if (target.status === 'complete' && (target.files?.length || target.exportedFiles?.length)) {\r\n      loadPreviewFromItem(target)\r\n    } else {\r\n      showPreviewGuide('Selected item is still processing. Please wait for the download to finish.')\r\n    }\r\n    return\r\n  }\r\n  previewCard.classList.add('batch-mode')\r\n  try {\r\n    previewVideo.pause()\r\n  } catch (error) {\r\n    // ignore\r\n  }\r\n  previewEmpty.classList.remove('hidden')\r\n  previewEmpty.innerHTML = buildBatchSummaryMarkup(selectedItems)\r\n}\r\n  // Show loading state\r\n  setStatus('Loading preview...')\r\n}\r\n\r\nconst detectVideoFormat = () => {\r\n  const width = previewVideo.videoWidth\r\n  const height = previewVideo.videoHeight\r\n  const aspectRatio = width / height\r\n  \r\n  // Remove all format classes\r\n  previewCard.classList.remove('video-horizontal', 'video-vertical', 'video-shorts')\r\n  \r\n  let format = 'Unknown'\r\n  \r\n  if (height > width) {\r\n    // Vertical video (likely Shorts, Reels, TikTok)\r\n    if (aspectRatio < 0.6) {\r\n      format = '9:16 Shorts'\r\n      previewCard.classList.add('video-shorts')\r\n    } else {\r\n      format = 'Vertical'\r\n      previewCard.classList.add('video-vertical')\r\n    }\r\n  } else {\r\n    // Horizontal video\r\n    if (aspectRatio >= 1.7) {\r\n      format = '16:9 HD'\r\n    } else if (aspectRatio >= 1.3) {\r\n      format = '4:3 Standard'\r\n    } else {\r\n      format = 'Square'\r\n    }\r\n    previewCard.classList.add('video-horizontal')\r\n  }\r\n  \r\n  videoFormatBadge.textContent = `${format}  ${width}${height}`\r\n  console.log(`[Preview] Format: ${format} (${width}${height}, ratio: ${aspectRatio.toFixed(2)})`)\r\n}\r\n\r\nconst resetPreviewRanges = (duration) => {\r\n  state.preview.duration = duration\r\n  state.preview.start = 0\r\n  state.preview.end = duration\r\n  trimStartInput.max = duration\r\n  trimEndInput.max = duration\r\n  trimStartInput.value = 0\r\n  trimEndInput.value = duration\r\n  trimStartLabel.textContent = formatTime(0)\r\n  trimEndLabel.textContent = formatTime(duration)\r\n  trimDurationLabel.textContent = formatTime(duration)\r\n  \r\n  // Safe timeline display updates\r\n  if (currentTimeDisplay) currentTimeDisplay.textContent = formatTime(0)\r\n  if (totalTimeDisplay) totalTimeDisplay.textContent = formatTime(duration)\r\n  \r\n  state.preview.ready = true\r\n  updateTrimFill()\r\n}\r\n\r\nconst clampPreviewRanges = () => {\r\n  const start = Number(trimStartInput.value)\r\n  let end = Number(trimEndInput.value)\r\n  if (end <= start + 0.1) {\r\n    end = Math.min(state.preview.duration, start + 0.1)\r\n    trimEndInput.value = end\r\n  }\r\n  state.preview.start = start\r\n  state.preview.end = end\r\n  trimStartLabel.textContent = formatTime(start)\r\n  trimEndLabel.textContent = formatTime(end)\r\n  trimDurationLabel.textContent = formatTime(end - start)\r\n  updateTrimFill()\r\n  \r\n  // Trigger background trim processing\r\n  debouncedBackgroundTrim()\r\n}\r\n\r\nlet trimDebounceTimer = null\r\nconst debouncedBackgroundTrim = () => {\r\n  if (trimDebounceTimer) clearTimeout(trimDebounceTimer)\r\n  \r\n  // Wait 2 seconds after user stops adjusting trim handles\r\n  trimDebounceTimer = setTimeout(() => {\r\n    processBackgroundTrim()\r\n  }, 2000)\r\n}\r\n\r\nconst processBackgroundTrim = async () => {\r\n  // Only process if trim is active and ready\r\n  if (!state.preview.ready || !state.preview.file) return\r\n  \r\n  const isTrimmed = state.preview.start > 0 || state.preview.end < state.preview.duration\r\n  if (!isTrimmed) {\r\n    state.preview.trimmedFile = null\r\n    return\r\n  }\r\n  \r\n  if (state.preview.trimProcessing) return\r\n  \r\n  console.log('[Background Trim] Starting pre-processing...')\r\n  state.preview.trimProcessing = true\r\n  setStatus('Pre-processing trim in background...')\r\n  \r\n  try {\r\n    const trimData = {\r\n      start: state.preview.start,\r\n      end: state.preview.end,\r\n      sourceFile: state.preview.file\r\n    }\r\n    \r\n    // Process trim in background\r\n    const result = await window.systemDialogs?.backgroundTrim(trimData)\r\n    \r\n    if (result && result.trimmedFile) {\r\n      state.preview.trimmedFile = result.trimmedFile\r\n      console.log('[Background Trim] Complete:', result.trimmedFile)\r\n      setStatus(' Trim ready - export will be instant!')\r\n    }\r\n  } catch (error) {\r\n    console.error('[Background Trim] Error:', error)\r\n    setStatus('Background trim failed - will process on export')\r\n    state.preview.trimmedFile = null\r\n  } finally {\r\n    state.preview.trimProcessing = false\r\n  }\r\n}\r\n\r\nconst updateTrimFill = () => {\r\n  if (!trimFill) return\r\n  const duration = state.preview.duration || 0\r\n  if (!duration) {\r\n    trimFill.style.left = '0%'\r\n    trimFill.style.width = '0%'\r\n    return\r\n  }\r\n  const startPercent = (state.preview.start / duration) * 100\r\n  const endPercent = (state.preview.end / duration) * 100\r\n  trimFill.style.left = `${startPercent}%`\r\n  trimFill.style.width = `${Math.max(0, endPercent - startPercent)}%`\r\n}\r\n\r\nconst resetPreviewPlayer = (message = DEFAULT_PREVIEW_MESSAGE) => {\r\n  if (!previewVideo) return\r\n\r\n  try {\r\n    previewVideo.pause()\r\n  } catch (err) {\r\n    console.warn('[Preview] pause failed during reset', err)\r\n  }\r\n\r\n  previewVideo.removeAttribute('src')\r\n  previewVideo.removeAttribute('poster')\r\n  previewVideo.load()\r\n  previewPlayBtn.textContent = ''\r\n  previewCard?.classList.remove('video-horizontal', 'video-vertical', 'video-shorts')\r\n\r\n  if (videoFormatBadge) {\r\n    videoFormatBadge.textContent = 'No media loaded'\r\n  }\r\n  if (previewInfo) {\r\n    previewInfo.textContent = 'No video loaded'\r\n  }\r\n\r\n  state.preview.file = ''\r\n  state.preview.url = ''\r\n  state.preview.duration = 0\r\n  state.preview.start = 0\r\n  state.preview.end = 0\r\n  state.preview.ready = false\r\n  state.preview.trimmedFile = null\r\n  state.preview.trimProcessing = false\r\n  state.preview.metadata = {\r\n    title: '',\r\n    description: '',\r\n    keywords: [],\r\n    thumbnail: '',\r\n    fetched: false\r\n  }\r\n  state.preview.activePanel = resolvePanelKey('thumbnail')\r\n\r\n  if (trimStartInput) {\r\n    trimStartInput.value = 0\r\n    trimStartInput.max = 0\r\n  }\r\n  if (trimEndInput) {\r\n    trimEndInput.value = 0\r\n    trimEndInput.max = 0\r\n  }\r\n  if (trimStartLabel) trimStartLabel.textContent = formatTime(0)\r\n  if (trimEndLabel) trimEndLabel.textContent = formatTime(0)\r\n  if (trimDurationLabel) trimDurationLabel.textContent = formatTime(0)\r\n  if (currentTimeDisplay) currentTimeDisplay.textContent = formatTime(0)\r\n  if (totalTimeDisplay) totalTimeDisplay.textContent = formatTime(0)\r\n\r\n  updateTrimFill()\r\n\r\n  resetGuideStage('preview')\r\n  showPreviewGuide(message)\r\n  renderPremiumMetadata()\r\n  setPremiumStatus('Select a clip to load metadata.')\r\n}\r\n\r\nresetPreviewPlayer()\r\napplyPremiumToggleUI()\r\nsetPreviewMode('video')\r\nsetActiveMetadataPanel('thumbnail')\r\n\r\nconst togglePreviewPlayback = () => {\r\n  if (!state.preview.ready) return\r\n  if (previewVideo.paused) {\r\n    previewVideo.currentTime = state.preview.start\r\n    previewVideo.play()\r\n    previewPlayBtn.textContent = ''\r\n  } else {\r\n    previewVideo.pause()\r\n    previewPlayBtn.textContent = ''\r\n  }\r\n}\r\n\r\nconst stopPreview = () => {\r\n  if (!state.preview.ready) return\r\n  previewVideo.pause()\r\n  previewVideo.currentTime = state.preview.start\r\n  previewPlayBtn.textContent = ''\r\n}\r\n\r\nconst restartPreview = () => {\r\n  if (!state.preview.ready) return\r\n  previewVideo.currentTime = state.preview.start\r\n  previewVideo.play()\r\n  previewPlayBtn.textContent = ''\r\n}\r\n\r\nconst renderQueue = () => {\r\n  updateQueueChip()\r\n  queueList.innerHTML = ''\r\n  pruneSelection()\r\n\r\n  if (!state.queue.length) {\r\n    const empty = document.createElement('p')\r\n    empty.className = 'empty'\r\n    empty.textContent = 'Queue is empty. Add links on the right.'\r\n    queueList.appendChild(empty)\r\n    return\r\n  }\r\n\r\n  state.queue.forEach((item, idx) => {\r\n    const slot = document.createElement('article')\r\n    slot.className = `queue-item ${item.status}`\r\n    const selected = state.queueSelection.has(item.id)\r\n    const platformBadge = item.platform ? `<span class=\"platform-badge\" style=\"--platform-color: ${item.platform.color}\">${item.platform.icon} ${item.platform.name}</span>` : ''\r\n    const showCancel = item.status === 'downloading'\r\n    slot.innerHTML = `\r\n      <div class=\"slot-head\">\r\n        <div>\r\n          <div class=\"slot-meta\">\r\n            <label class=\"slot-select\">\r\n              <input type=\"checkbox\" data-select ${selected ? 'checked' : ''} />\r\n              <span class=\"slot-index\">#${String(idx + 1).padStart(2, '0')}</span>\r\n            </label>\r\n            <div>\r\n              <div class=\"slot-url-row\">\r\n                <p class=\"slot-url\">${item.url}</p>\r\n                ${platformBadge}\r\n              </div>\r\n              <p class=\"slot-status\">${item.status === 'pending' ? 'Waiting' : item.status === 'downloading' ? 'Processing' : item.status === 'complete' ? 'Done' : item.status === 'cancelled' ? 'Cancelled' : 'Error'}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"slot-actions\">\r\n          ${showCancel ? '<button class=\"ghost ghost-danger\" data-cancel title=\"Cancel download\"></button>' : ''}\r\n          <button class=\"ghost ghost-icon\" data-move=\"-1\" title=\"Move up\"></button>\r\n          <button class=\"ghost ghost-icon\" data-move=\"1\" title=\"Move down\"></button>\r\n          <button class=\"ghost ghost-danger\" data-delete title=\"Delete from queue\"></button>\r\n          <button class=\"premium-download-btn export-btn\" title=\"Export & Save\">\r\n            <span class=\"download-icon\"></span>\r\n            <span class=\"download-glow\"></span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n      <div class=\"slot-progress\">\r\n        <div class=\"progress-bar\" style=\"--progress:${Math.min(100, item.percent || 0).toFixed(1)}%\">\r\n          <span></span>\r\n        </div>\r\n        <p class=\"slot-metrics\">${item.percent?.toFixed(1) || 0}%  ${item.speed || 'Pending'}  ETA ${item.eta || '--:--'}</p>\r\n      </div>\r\n    `\r\n\r\n    slot.addEventListener('click', (event) => {\r\n      if (event.target.closest('.slot-actions')) return\r\n      loadPreviewFromItem(item)\r\n    })\r\n\r\n    const selectInput = slot.querySelector('[data-select]')\r\n    selectInput.addEventListener('click', (event) => event.stopPropagation())\r\n    selectInput.addEventListener('change', () => {\r\n      if (selectInput.checked) {\r\n        state.queueSelection.add(item.id)\r\n      } else {\r\n        state.queueSelection.delete(item.id)\r\n      }\r\n      updateSelectionCounter()\r\n    })\r\n\r\n    slot.querySelector('.export-btn').addEventListener('click', (event) => {\r\n      event.stopPropagation()\r\n      openExportDrawer([item])\r\n    })\r\n    \r\n    const cancelBtn = slot.querySelector('[data-cancel]')\r\n    if (cancelBtn) {\r\n      cancelBtn.addEventListener('click', async (event) => {\r\n        event.stopPropagation()\r\n        try {\r\n          const result = await window.downloader.cancelDownload(item.url)\r\n          if (result.success) {\r\n            pushLog(`Cancelled download: ${item.url}`)\r\n          } else {\r\n            pushLog(`Could not cancel: ${result.message || 'Unknown error'}`)\r\n          }\r\n        } catch (error) {\r\n          console.error('[Cancel error]', error)\r\n          pushLog('Failed to cancel download')\r\n        }\r\n      })\r\n    }\r\n\r\n    slot.querySelectorAll('[data-move]').forEach((btn) => {\r\n      btn.addEventListener('click', (event) => {\r\n        event.stopPropagation()\r\n        moveQueueItem(item.id, Number(btn.dataset.move))\r\n      })\r\n    })\r\n    \r\n    const deleteBtn = slot.querySelector('[data-delete]')\r\n    if (deleteBtn) {\r\n      deleteBtn.addEventListener('click', (event) => {\r\n        event.stopPropagation()\r\n        deleteQueueItem(item.id)\r\n      })\r\n    }\r\n\r\n    if (item.status === 'complete' && Array.isArray(item.files) && item.files.length) {\r\n      const filesBlock = buildFileList(item)\r\n      filesBlock.addEventListener('click', async (event) => {\r\n        const button = event.target.closest('button[data-action]')\r\n        if (!button) return\r\n        event.stopPropagation()\r\n        const action = button.dataset.action\r\n        const decodedPath = decodeDatasetPath(button.dataset.path || '')\r\n        if (!decodedPath) return\r\n        if (action === 'reveal') {\r\n          await window.systemDialogs?.revealFile(decodedPath)\r\n        } else if (action === 'copy') {\r\n          const copied = await copyToClipboard(decodedPath)\r\n          pushLog(copied ? 'Copied file path to clipboard.' : 'Unable to copy path automatically.')\r\n        }\r\n      })\r\n      slot.appendChild(filesBlock)\r\n    }\r\n\r\n    queueList.appendChild(slot)\r\n  })\r\n}\r\n\r\nconst moveQueueItem = (id, delta) => {\r\n  const index = state.queue.findIndex((item) => item.id === id)\r\n  if (index === -1) return\r\n  const target = index + delta\r\n  if (target < 0 || target >= state.queue.length) return\r\n  const [entry] = state.queue.splice(index, 1)\r\n  state.queue.splice(target, 0, entry)\r\n  renderQueue()\r\n  pushLog(`Reordered queue item ${entry.url}`)\r\n}\r\n\r\nconst deleteQueueItem = (id) => {\r\n  const index = state.queue.findIndex((item) => item.id === id)\r\n  if (index === -1) return\r\n  \r\n  const item = state.queue[index]\r\n  \r\n  // If this item is currently loaded in preview, clear the player\r\n  if (state.preview.url === item.url) {\r\n    resetPreviewPlayer('Preview cleared. Paste a new link to restart the flow.')\r\n    setStatus('Video removed from player')\r\n  }\r\n\r\n  if (item.status === 'complete' && !item.exported) {\r\n    updateHistoryStatus(item.url, 'retry')\r\n  }\r\n  \r\n  // Remove from queue\r\n  state.queue.splice(index, 1)\r\n  state.queueSelection.delete(id)\r\n  \r\n  renderQueue()\r\n  updateSelectionCounter()\r\n  pushLog(`Deleted: ${item.url}`)\r\n}\r\n\r\nconst setBusy = (busy) => {\r\n  state.busy = busy\r\n  updateEngineChip()\r\n}\r\n\r\nconst queueLinks = () => {\r\n  console.log('[Queue] queueLinks called')\r\n  const urls = parseUrls()\r\n  console.log('[Queue] Parsed URLs:', urls)\r\n  if (!urls.length) {\r\n    pushLog('No links detected.')\r\n    return 0\r\n  }\r\n  const added = addToQueue(urls)\r\n  console.log('[Queue] Added', added, 'items to queue')\r\n  textarea.value = ''\r\n  pushLog(`Queued ${added} link${added === 1 ? '' : 's'}.`)\r\n  if (added > 0) {\r\n    updateGuideProgress('queue')\r\n    startQueueIfIdle()\r\n  }\r\n  return added\r\n}\r\n\r\nconst collectDownloadUrls = () => {\r\n  const pending = state.queue\r\n    .filter((item) => item.status === 'pending' || item.status === 'error')\r\n    .map((item) => item.url)\r\n  if (pending.length) return pending\r\n  const fresh = parseUrls()\r\n  if (fresh.length) {\r\n    addToQueue(fresh)\r\n    textarea.value = ''\r\n    updateGuideProgress('queue')\r\n  }\r\n  return fresh\r\n}\r\n\r\nconst onDownload = async () => {\r\n  console.log('[Download] onDownload called')\r\n  const urls = collectDownloadUrls()\r\n  console.log('[Download] Collected URLs:', urls)\r\n  if (!urls.length) {\r\n    pushLog('Add at least one link before downloading.')\r\n    return\r\n  }\r\n  if (!window.downloader || !window.downloader.startDownload) {\r\n    console.error('[Download] window.downloader not available!')\r\n    pushLog(' Download system not ready. Please restart the app.')\r\n    return\r\n  }\r\n  try {\r\n    setBusy(true)\r\n    updateEngineChip()\r\n    pushLog(` Starting ${urls.length} job(s) in preset ${PRESET_LABELS[state.format]}.`)\r\n    console.log('[Download] Calling window.downloader.startDownload with:', { urls, format: state.format, destination: state.destination })\r\n    const result = await window.downloader.startDownload({ urls, format: state.format, destination: state.destination || undefined })\r\n    console.log('[Download] Result:', result)\r\n    if (result?.outputDir) {\r\n      setDestination(result.outputDir)\r\n    }\r\n    pushLog(` Download complete. ${urls.length} file${urls.length === 1 ? '' : 's'} ready. Click Export to save.`)\r\n  } catch (error) {\r\n    console.error('[Download error]', error)\r\n    pushLog(` ${error?.message || 'Download failed. Check your connection and try again.'}`)\r\n  } finally {\r\n    setBusy(false)\r\n    updateEngineChip()\r\n    startQueueIfIdle()\r\n  }\r\n}\r\n\r\nconst startQueueIfIdle = () => {\r\n  if (!state.autoRun || state.busy) return\r\n  const pending = state.queue.some((item) => item.status === 'pending' || item.status === 'error')\r\n  if (pending) {\r\n    onDownload()\r\n  }\r\n}\r\n\r\nconst closeExportDrawer = () => {\r\n  state.exportId = null\r\n  state.exportContext.targets = []\r\n  exportPop.classList.remove('open')\r\n  exportPop.setAttribute('aria-hidden', 'true')\r\n  document.body.classList.remove('exporting')\r\n  updateExportMessage('Choose resolution and format for export.')\r\n  exportConfirm.disabled = false\r\n  exportConfirm.textContent = exportConfirmDefaultLabel\r\n  exportConfirm.style.background = ''\r\n}\r\n\r\nconst describePreset = (preset) => {\r\n  const resolution = preset.height ? `${preset.height}p` : 'Adaptive'\r\n  const fps = preset.fps ? `${preset.fps}fps` : ''\r\n  const audio = preset.acodec === 'none' ? 'No audio' : 'Audio embedded'\r\n  const size = preset.filesize ? `${(preset.filesize / (1024 * 1024)).toFixed(1)}MB` : 'Size dynamic'\r\n  return `${resolution} ${fps}`.trim() + `  ${size}  ${audio}`\r\n}\r\n\r\nconst extractResolutionsFromFormats = (formats) => {\r\n  const videoFormats = formats.filter(fmt => fmt.height && fmt.vcodec && fmt.vcodec !== 'none')\r\n  const resolutions = new Map()\r\n  \r\n  videoFormats.forEach(fmt => {\r\n    const key = `${fmt.height}p`\r\n    if (!resolutions.has(key) || (resolutions.get(key).tbr || 0) < (fmt.tbr || 0)) {\r\n      resolutions.set(key, {\r\n        id: fmt.id,\r\n        height: fmt.height,\r\n        label: `${fmt.height}p${fmt.fps ? ` (${fmt.fps}fps)` : ''}`,\r\n        container: fmt.container || 'mp4',\r\n        vcodec: fmt.vcodec,\r\n        acodec: fmt.acodec,\r\n        tbr: fmt.tbr\r\n      })\r\n    }\r\n  })\r\n  \r\n  return Array.from(resolutions.values()).sort((a, b) => b.height - a.height)\r\n}\r\n\r\nconst extractAudioFormatsFromFormats = (formats) => {\r\n  const audioFormats = formats.filter(fmt => fmt.acodec && fmt.acodec !== 'none' && (!fmt.vcodec || fmt.vcodec === 'none'))\r\n  const qualities = new Map()\r\n  \r\n  audioFormats.forEach(fmt => {\r\n    const key = Math.floor(fmt.abr || 128)\r\n    if (!qualities.has(key) || (qualities.get(key).abr || 0) < (fmt.abr || 0)) {\r\n      qualities.set(key, {\r\n        id: fmt.id,\r\n        label: `${Math.floor(fmt.abr || 128)}kbps`,\r\n        container: fmt.container || 'mp3',\r\n        acodec: fmt.acodec,\r\n        abr: fmt.abr\r\n      })\r\n    }\r\n  })\r\n  \r\n  return Array.from(qualities.values()).sort((a, b) => (b.abr || 0) - (a.abr || 0))\r\n}\r\n\r\nconst updateExportResolutionSelect = () => {\r\n  const type = state.exportContext.type\r\n  if (type === 'video') {\r\n    const resolutions = state.exportContext.resolutions\r\n    exportResolutionSelect.innerHTML = resolutions.length\r\n      ? resolutions.map(r => `<option value=\"${r.id}\">${r.label}</option>`).join('')\r\n      : '<option>No video formats available</option>'\r\n    state.exportContext.selectedResolution = resolutions[0] || null\r\n  } else {\r\n    const audioFormats = state.exportContext.audioFormats\r\n    exportResolutionSelect.innerHTML = audioFormats.length\r\n      ? audioFormats.map(a => `<option value=\"${a.id}\">${a.label}</option>`).join('')\r\n      : '<option>No audio formats available</option>'\r\n    state.exportContext.selectedResolution = audioFormats[0] || null\r\n  }\r\n}\r\n\r\nconst renderExportOptions = (formats) => {\r\n  const resolutions = extractResolutionsFromFormats(formats)\r\n  const audioFormats = extractAudioFormatsFromFormats(formats)\r\n  \r\n  state.exportContext.resolutions = resolutions\r\n  state.exportContext.audioFormats = audioFormats\r\n  \r\n  updateExportResolutionSelect()\r\n\r\n  const outputFormats = state.exportContext.type === 'video' \r\n    ? ['mp4', 'mkv', 'avi', 'webm']\r\n    : ['mp3', 'm4a', 'ogg', 'wav']\r\n  \r\n  exportFormatSelect.innerHTML = outputFormats\r\n    .map((format) => `<option value=\"${format}\">${format.toUpperCase()}</option>`)\r\n    .join('')\r\n  \r\n  state.exportContext.selectedFormat = outputFormats[0]\r\n  updateExportMessage('Ready to export.')\r\n}\r\n\r\nconst formatExportTargetLabel = (targets) => {\r\n  if (targets.length === 1) {\r\n    return targets[0].url\r\n  }\r\n  return `${targets.length} items selected`\r\n}\r\n\r\nconst openExportDrawer = async (items = []) => {\r\n  const completed = items.filter((item) => item.status === 'complete')\r\n  if (!completed.length) {\r\n    pushLog('Only completed downloads can be exported.')\r\n    return\r\n  }\r\n  \r\n  document.body.classList.add('exporting')\r\n  updateExportMessage('Preparing export options', { loading: true })\r\n  \r\n  state.exportContext.targets = completed\r\n  state.exportContext.type = 'video'\r\n  exportTypeSelect.value = 'video'\r\n  exportTarget.textContent = formatExportTargetLabel(completed)\r\n  exportPop.classList.add('open')\r\n  exportPop.setAttribute('aria-hidden', 'false')\r\n  \r\n  const targetUrl = completed[0].url\r\n  const cached = formatCache.get(targetUrl)\r\n\r\n  if (cached) {\r\n    // Instant load from cache\r\n    populateExportOptions(cached)\r\n    updateExportMessage('Ready to export.')\r\n  } else {\r\n    // Show loading state if not cached\r\n    updateExportMessage('Analyzing media formats', { loading: true })\r\n    exportConfirm.disabled = true\r\n    exportFormatSelect.disabled = true\r\n    exportResolutionSelect.disabled = true\r\n\r\n    try {\r\n      const meta = await window.downloader.probeFormats(targetUrl)\r\n      formatCache.set(targetUrl, meta)\r\n      populateExportOptions(meta)\r\n      updateExportMessage('Ready to export.')\r\n    } catch (error) {\r\n      console.error(error)\r\n      updateExportMessage(error?.message || 'Unable to fetch stream metadata.', { variant: 'error' })\r\n    }\r\n  }\r\n}\r\n\r\nconst populateExportOptions = (meta) => {\r\n  const mapped = (meta.formats || []).map((fmt) => ({\r\n    id: fmt.id,\r\n    container: fmt.container || 'mp4',\r\n    note: fmt.note,\r\n    height: fmt.height,\r\n    fps: fmt.fps,\r\n    vcodec: fmt.vcodec,\r\n    acodec: fmt.acodec,\r\n    abr: fmt.abr,\r\n    tbr: fmt.tbr,\r\n    filesize: fmt.filesize\r\n  }))\r\n  state.exportContext.formats = mapped\r\n  renderExportOptions(mapped)\r\n  \r\n  // Enable controls\r\n  exportConfirm.disabled = false\r\n  exportFormatSelect.disabled = false\r\n  exportResolutionSelect.disabled = false\r\n  updateExportMessage('Ready to export.')\r\n}\r\n\r\nconst bindPreviewEvents = () => {\r\n  previewVideo.addEventListener('loadedmetadata', () => {\r\n    resetPreviewRanges(previewVideo.duration || 0)\r\n    previewPlayBtn.textContent = ''\r\n    state.preview.ready = true\r\n    detectVideoFormat()\r\n    updateThumbnailRatioLabel()\r\n    generateTimelineMarkers(previewVideo.duration)\r\n    setStatus(`Preview ready: ${Math.round(previewVideo.duration)}s`)\r\n    updateGuideProgress('preview')\r\n    console.log('[Preview] Loaded successfully, duration:', previewVideo.duration)\r\n  })\r\n  \r\n  // Update current time display and playhead during playback\r\n  previewVideo.addEventListener('timeupdate', () => {\r\n    if (state.preview.ready && previewVideo.duration) {\r\n      const currentTime = previewVideo.currentTime\r\n      \r\n      // Safe update for timeline display\r\n      if (currentTimeDisplay) {\r\n        currentTimeDisplay.textContent = formatTime(currentTime)\r\n      }\r\n      \r\n      // Update playhead position\r\n      if (playheadIndicator) {\r\n        const progress = (currentTime / previewVideo.duration) * 100\r\n        playheadIndicator.style.left = `${progress}%`\r\n        playheadIndicator.classList.add('active')\r\n      }\r\n      \r\n      // Auto-stop at trim end\r\n      if (currentTime >= state.preview.end) {\r\n        previewVideo.pause()\r\n        previewVideo.currentTime = state.preview.start\r\n        previewPlayBtn.textContent = ''\r\n      }\r\n    }\r\n  })\r\n  \r\n  previewVideo.addEventListener('play', () => {\r\n    previewPlayBtn.textContent = ''\r\n  })\r\n  \r\n  previewVideo.addEventListener('pause', () => {\r\n    previewPlayBtn.textContent = ''\r\n  })\r\n  \r\n  previewVideo.addEventListener('error', (e) => {\r\n    console.error('[Preview] Error loading video:', e)\r\n    console.error('[Preview] Error details:', previewVideo.error)\r\n    const errorMsg = previewVideo.error ? \r\n      `Video error: ${previewVideo.error.message || 'Could not load file'}` : \r\n      'Failed to load video'\r\n    setStatus(errorMsg)\r\n    resetPreviewPlayer('Video reset. Load another link to keep going.')\r\n  })\r\n  \r\n  previewVideo.addEventListener('canplay', () => {\r\n    console.log('[Preview] Video can play')\r\n  })\r\n  \r\n  // Timeline hover preview\r\n  if (timelineTrack && timelineHoverPreview) {\r\n    timelineTrack.addEventListener('mousemove', (e) => {\r\n      if (!state.preview.ready || !previewVideo.duration) return\r\n      \r\n      const rect = timelineTrack.getBoundingClientRect()\r\n      const x = e.clientX - rect.left\r\n      const percent = (x / rect.width) * 100\r\n      const time = (percent / 100) * previewVideo.duration\r\n      \r\n      timelineHoverPreview.textContent = formatTime(time)\r\n      timelineHoverPreview.style.left = `${percent}%`\r\n      timelineHoverPreview.classList.add('visible')\r\n    })\r\n    \r\n    timelineTrack.addEventListener('mouseleave', () => {\r\n      timelineHoverPreview.classList.remove('visible')\r\n    })\r\n  }\r\n  \r\n  // Button event listeners\r\n  previewPlayBtn.addEventListener('click', togglePreviewPlayback)\r\n  previewStopBtn.addEventListener('click', stopPreview)\r\n  previewRestartBtn.addEventListener('click', restartPreview)\r\n\r\n  // Magnetic snap functionality for trim timeline\r\n  let activeTrimHandle = null\r\n  const SNAP_THRESHOLD = 30 // pixels for magnetic snap\r\n  \r\n  const handleTrimTimelineClick = (event) => {\r\n    if (!state.preview.ready) return\r\n    const timeline = event.currentTarget\r\n    const rect = timeline.getBoundingClientRect()\r\n    const clickX = event.clientX - rect.left\r\n    const clickPercent = (clickX / rect.width) * 100\r\n    const clickTime = (clickPercent / 100) * state.preview.duration\r\n    \r\n    // Calculate distances to both handles\r\n    const startDistance = Math.abs(state.preview.start - clickTime)\r\n    const endDistance = Math.abs(state.preview.end - clickTime)\r\n    \r\n    // Snap to nearest handle if within threshold\r\n    const threshold = (SNAP_THRESHOLD / rect.width) * state.preview.duration\r\n    \r\n    if (startDistance < threshold && startDistance < endDistance) {\r\n      // Snap to start handle\r\n      trimStartInput.value = clickTime\r\n      activeTrimHandle = 'start'\r\n    } else if (endDistance < threshold) {\r\n      // Snap to end handle\r\n      trimEndInput.value = clickTime\r\n      activeTrimHandle = 'end'\r\n    } else {\r\n      // Click-to-seek: Jump playback to clicked position within trim range\r\n      const trimStart = state.preview.start\r\n      const trimEnd = state.preview.end\r\n      \r\n      // Only seek if click is within trim range\r\n      if (clickTime >= trimStart && clickTime <= trimEnd) {\r\n        previewVideo.currentTime = clickTime\r\n        console.log(`[Timeline] Seek to ${clickTime.toFixed(2)}s within trim range`)\r\n      }\r\n    }\r\n    \r\n    clampPreviewRanges()\r\n  }\r\n  \r\n  const trimTimeline = document.querySelector('.trim-timeline')\r\n  if (trimTimeline) {\r\n    trimTimeline.addEventListener('click', handleTrimTimelineClick)\r\n    \r\n    // Add drag support for magnetic handles\r\n    let isDragging = false\r\n    \r\n    trimTimeline.addEventListener('mousedown', (event) => {\r\n      if (event.target.classList.contains('trim-track') || event.target.classList.contains('trim-range-fill')) {\r\n        handleTrimTimelineClick(event)\r\n        isDragging = true\r\n      }\r\n    })\r\n    \r\n    trimTimeline.addEventListener('mousemove', (event) => {\r\n      if (!isDragging || !activeTrimHandle) return\r\n      const rect = trimTimeline.getBoundingClientRect()\r\n      const clickX = event.clientX - rect.left\r\n      const clickPercent = Math.max(0, Math.min(100, (clickX / rect.width) * 100))\r\n      const clickTime = (clickPercent / 100) * state.preview.duration\r\n      \r\n      if (activeTrimHandle === 'start') {\r\n        trimStartInput.value = clickTime\r\n      } else {\r\n        trimEndInput.value = clickTime\r\n      }\r\n      clampPreviewRanges()\r\n    })\r\n    \r\n    document.addEventListener('mouseup', () => {\r\n      isDragging = false\r\n      activeTrimHandle = null\r\n    })\r\n  }\r\n\r\n  trimStartInput.addEventListener('input', clampPreviewRanges)\r\n  trimEndInput.addEventListener('input', clampPreviewRanges)\r\n}\r\n\r\nconst handleMenuAction = (action) => {\r\n  switch (action) {\r\n    case 'set-destination':\r\n      chooseDestinationFolder()\r\n      break\r\n    case 'open-destination':\r\n      openDestinationFolder()\r\n      break\r\n    case 'check-updates':\r\n      checkForUpdates()\r\n      break\r\n    default:\r\n      break\r\n  }\r\n}\r\n\r\nconst checkForUpdates = async () => {\r\n  const currentVersion = 'v1.0.0'\r\n  const appName = 'WH404 - YT Downloader 1.0'\r\n  \r\n  pushLog('Checking for updates...')\r\n  window.alert(`${appName}\\n\\nCurrent version: 1.0.0\\n\\nChecking GitHub for updates...`)\r\n  \r\n  try {\r\n    const response = await fetch('https://api.github.com/repos/Pramsss108/word-hacker-404/releases/latest')\r\n    const data = await response.json()\r\n    const latestVersion = data.tag_name || data.name || 'v1.0.0'\r\n    \r\n    pushLog(`Latest version: ${latestVersion}`)\r\n    \r\n    if (latestVersion === currentVersion) {\r\n      window.alert(`${appName}\\n\\n You're up to date!\\n\\nCurrent: ${currentVersion}\\nLatest: ${latestVersion}`)\r\n    } else {\r\n      window.alert(`${appName}\\n\\n Update available!\\n\\nCurrent: ${currentVersion}\\nLatest: ${latestVersion}\\n\\nDownload: https://github.com/Pramsss108/word-hacker-404/releases`)\r\n    }\r\n  } catch (error) {\r\n    pushLog('Failed to check for updates. Please visit GitHub manually.')\r\n    window.alert(`${appName}\\n\\nCurrent version: 1.0.0\\n\\n Could not check for updates.\\n\\nVisit: https://github.com/Pramsss108/word-hacker-404/releases`)\r\n  }\r\n}\r\n\r\nconst wireEvents = () => {\r\n  menuTriggers.forEach((btn) => {\r\n    btn.addEventListener('click', (event) => {\r\n      event.stopPropagation()\r\n      toggleMenu(btn.dataset.menuTrigger)\r\n    })\r\n  })\r\n\r\n  fileMenu?.addEventListener('click', (event) => {\r\n    const actionElement = event.target.closest('[data-menu-action]')\r\n    if (!actionElement) return\r\n    event.stopPropagation()\r\n    closeMenus()\r\n    handleMenuAction(actionElement.dataset.menuAction)\r\n  })\r\n\r\n  // About menu handler\r\n  const aboutMenu = document.getElementById('about-menu')\r\n  aboutMenu?.addEventListener('click', (event) => {\r\n    const actionElement = event.target.closest('[data-menu-action]')\r\n    if (actionElement) {\r\n      event.stopPropagation()\r\n      closeMenus()\r\n      handleMenuAction(actionElement.dataset.menuAction)\r\n    }\r\n  })\r\n\r\n  // Help menu handler\r\n  const helpMenu = document.getElementById('help-menu')\r\n  helpMenu?.addEventListener('click', (event) => {\r\n    const actionElement = event.target.closest('[data-menu-action]')\r\n    if (actionElement) {\r\n      event.stopPropagation()\r\n      closeMenus()\r\n      handleMenuAction(actionElement.dataset.menuAction)\r\n    }\r\n  })\r\n\r\n  document.addEventListener('click', (event) => {\r\n    if (!event.target.closest('.menu-group')) {\r\n      closeMenus()\r\n    }\r\n  })\r\n\r\n  document.addEventListener('keydown', (event) => {\r\n    if (event.key === 'Escape') {\r\n      closeMenus()\r\n      if (state.previewMode === 'insights') {\r\n        setPreviewMode('video')\r\n      }\r\n    }\r\n  })\r\n\r\n  const storedDestination = window.localStorage?.getItem(STORAGE_KEYS.destination)\r\n  if (storedDestination) {\r\n    state.destination = storedDestination\r\n  }\r\n  updateDestinationLabel()\r\n\r\n  queueSelectAll?.addEventListener('change', () => {\r\n    if (queueSelectAll.checked) {\r\n      state.queue.forEach((item) => state.queueSelection.add(item.id))\r\n    } else {\r\n      state.queueSelection.clear()\r\n    }\r\n    updateSelectionCounter()\r\n    renderQueue()\r\n  })\r\n\r\n  selectionClearBtn?.addEventListener('click', () => {\r\n    state.queueSelection.clear()\r\n    updateSelectionCounter()\r\n    renderQueue()\r\n  })\r\n\r\n  const exportSelectionHandler = () => {\r\n    const selectedItems = state.queue.filter((item) => state.queueSelection.has(item.id) && item.status === 'complete')\r\n    if (!selectedItems.length) {\r\n      pushLog('Select completed items before exporting.')\r\n      return\r\n    }\r\n    openExportDrawer(selectedItems)\r\n  }\r\n\r\n  queueExportSelectedBtn?.addEventListener('click', exportSelectionHandler)\r\n\r\n  queueExportAllBtn?.addEventListener('click', () => {\r\n    const completed = state.queue.filter((item) => item.status === 'complete')\r\n    if (!completed.length) {\r\n      pushLog('Finish at least one download before exporting all.')\r\n      return\r\n    }\r\n    openExportDrawer(completed)\r\n  })\r\n\r\n  clearQueueBtn?.addEventListener('click', () => {\r\n    state.queue = []\r\n    state.queueSelection.clear()\r\n    renderQueue()\r\n    pushLog('Cleared queue.')\r\n  })\r\n\r\n  // Add to Queue button click\r\n  addToQueueBtn?.addEventListener('click', () => {\r\n    console.log('[Button] Add to Queue clicked')\r\n    if (textarea.value.trim().length) {\r\n      queueLinks()\r\n    } else {\r\n      pushLog('Please paste a link first.')\r\n    }\r\n  })\r\n\r\n  // Enter key in textarea\r\n  textarea?.addEventListener('keydown', (e) => {\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault()\r\n      console.log('[Keyboard] Enter pressed')\r\n      if (textarea.value.trim().length) {\r\n        queueLinks()\r\n      }\r\n    }\r\n  })\r\n\r\n  const handlePasteProgress = () => {\r\n    if (!textarea) return\r\n    if (textarea.value.trim().length) {\r\n      updateGuideProgress('paste')\r\n    }\r\n  }\r\n\r\n  textarea?.addEventListener('input', handlePasteProgress)\r\n  textarea?.addEventListener('paste', handlePasteProgress)\r\n\r\n  // Removed auto-paste processing - user must manually click \"Add to Queue\" or press Enter\r\n\r\n  document.querySelectorAll('[data-window]').forEach((btn) => {\r\n    btn.addEventListener('click', () => {\r\n      window.windowControls?.control(btn.dataset.window)\r\n    })\r\n  })\r\n\r\n  const pinBtn = document.querySelector('[data-pin]')\r\n  pinBtn?.addEventListener('click', async () => {\r\n    const pinned = await window.windowControls?.togglePin()\r\n    if (typeof pinned === 'boolean') {\r\n      pinBtn.classList.toggle('active', pinned)\r\n    }\r\n  })\r\n\r\n  summaryOpenTriggers.forEach((chip) => {\r\n    chip.addEventListener('click', () => {\r\n      const panel = chip.dataset.openPanel\r\n      setActiveMetadataPanel(panel, chip)\r\n      setPreviewMode('insights')\r\n    })\r\n  })\r\n\r\n  metadataBackdrop?.addEventListener('click', () => setPreviewMode('video'))\r\n  metadataCloseBtn?.addEventListener('click', () => setPreviewMode('video'))\r\n\r\n  window.addEventListener('resize', () => {\r\n    if (state.previewMode !== 'insights') return\r\n    const anchor = lastPopoverAnchor || summaryChipRefs[state.preview.activePanel]\r\n    if (anchor) {\r\n      updatePopoverAnchor(anchor)\r\n    }\r\n  })\r\n\r\n  document.querySelectorAll('[data-premium-copy]').forEach((btn) => {\r\n    btn.addEventListener('click', () => handlePremiumCopy(btn.dataset.premiumCopy))\r\n  })\r\n\r\n  document.querySelectorAll('[data-premium-download]').forEach((btn) => {\r\n    btn.addEventListener('click', () => {\r\n      if (!state.preview.metadata.thumbnail) {\r\n        setPremiumStatus('Thumbnail not ready yet.', 'error')\r\n        return\r\n      }\r\n      triggerDownloadFromUrl(state.preview.metadata.thumbnail, 'wh404-thumbnail.jpg')\r\n      setPremiumStatus('Downloading thumbnail...', 'success')\r\n    })\r\n  })\r\n\r\n  document.querySelectorAll('[data-export-copy]').forEach((btn) => {\r\n    btn.addEventListener('click', () => handleExportCopy(btn.dataset.exportCopy))\r\n  })\r\n\r\n  exportBrowse.addEventListener('click', async () => {\r\n    const selected = await window.systemDialogs?.chooseFolder()\r\n    if (selected) {\r\n      exportPathInput.value = selected\r\n    }\r\n  })\r\n\r\n  exportConfirm.addEventListener('click', async () => {\r\n    const targets = state.exportContext.targets\r\n    if (!targets.length) {\r\n      updateExportMessage('No items to export.', { variant: 'error' })\r\n      return\r\n    }\r\n    \r\n    // Collect all temp files from selected items\r\n    const allFiles = []\r\n    targets.forEach(item => {\r\n      if (item.files && item.files.length) {\r\n        allFiles.push(...item.files)\r\n      }\r\n    })\r\n    \r\n    if (!allFiles.length) {\r\n      updateExportMessage('No files available to export.', { variant: 'error' })\r\n      return\r\n    }\r\n    \r\n    try {\r\n      // INSTANT feedback - no delay\r\n      exportConfirm.disabled = true\r\n      exportConfirm.textContent = 'Processing...'\r\n      exportConfirm.style.opacity = '0.7'\r\n      updateExportMessage('Starting export', { loading: true })\r\n      \r\n      // Start heartbeat to show we're alive\r\n      let heartbeatCount = 0\r\n      activeHeartbeat = setInterval(() => {\r\n        heartbeatCount++\r\n        if (heartbeatCount % 2 === 0) {\r\n          updateExportMessage('Processing files', { loading: true })\r\n        } else {\r\n          updateExportMessage('Converting media', { loading: true })\r\n        }\r\n      }, 800)\r\n      const destination = exportPathInput.value || state.destination || undefined\r\n      const outputFormat = exportFormatSelect.value || 'mp4'\r\n      \r\n      // Use pre-processed trim file if available, otherwise pass trim data\r\n      let trimData = null\r\n      let exportFiles = allFiles\r\n      \r\n      if (state.preview.ready && (state.preview.start > 0 || state.preview.end < state.preview.duration)) {\r\n        if (state.preview.trimmedFile) {\r\n          // Use pre-processed file for instant export\r\n          console.log('[Export] Using pre-processed trim file')\r\n          exportFiles = [state.preview.trimmedFile]\r\n          trimData = null // No need to trim again\r\n        } else {\r\n          // Fall back to real-time trimming\r\n          console.log('[Export] Processing trim in real-time')\r\n          trimData = { start: state.preview.start, end: state.preview.end }\r\n        }\r\n      }\r\n      \r\n      const metadataPayload = buildMetadataPayload()\r\n      const exportPayload = {\r\n        files: exportFiles,\r\n        destination,\r\n        outputFormat,\r\n        trim: trimData\r\n      }\r\n      if (metadataPayload) {\r\n        exportPayload.metadata = metadataPayload\r\n      }\r\n\r\n      const result = await window.systemDialogs?.exportFiles(exportPayload)\r\n      \r\n      if (activeHeartbeat) {\r\n        clearInterval(activeHeartbeat)\r\n        activeHeartbeat = null\r\n      }\r\n      \r\n      if (result && result.exported) {\r\n        pushLog(` Exported ${result.exported.length} file${result.exported.length === 1 ? '' : 's'} to ${result.outputDir}`)\r\n        \r\n        // Show success state in the modal - NO POPUP\r\n        updateExportMessage(` Saved ${result.exported.length} file${result.exported.length === 1 ? '' : 's'}!`, { variant: 'success' })\r\n        exportConfirm.textContent = ' Done'\r\n        exportConfirm.style.background = 'var(--highlight)'\r\n        exportConfirm.style.opacity = '1'\r\n        \r\n        // Update items to show exported status\r\n        targets.forEach(item => {\r\n          item.exported = true\r\n          item.exportedFiles = result.exported\r\n          updateHistoryStatus(item.url, 'exported')\r\n        })\r\n        renderQueue()\r\n        \r\n        // Auto-close smoothly after showing success\r\n        setTimeout(() => {\r\n          closeExportDrawer()\r\n        }, 1800)\r\n      }\r\n    } catch (error) {\r\n      if (activeHeartbeat) {\r\n        clearInterval(activeHeartbeat)\r\n        activeHeartbeat = null\r\n      }\r\n      console.error(error)\r\n      updateExportMessage(`Export failed: ${error?.message || 'Unknown error'}`, { variant: 'error' })\r\n      pushLog(` Export failed: ${error?.message || 'Unknown error'}`)\r\n      exportConfirm.style.opacity = '1'\r\n    } finally {\r\n      if (exportPop.classList.contains('open')) {\r\n        if (!exportMessage?.classList.contains('success')) {\r\n          exportConfirm.disabled = false\r\n          exportConfirm.textContent = exportConfirmDefaultLabel\r\n          exportConfirm.style.background = ''\r\n        }\r\n      }\r\n    }\r\n  })\r\n\r\n  exportTypeSelect.addEventListener('change', () => {\r\n    state.exportContext.type = exportTypeSelect.value\r\n    updateExportResolutionSelect()\r\n    \r\n    const outputFormats = exportTypeSelect.value === 'video' \r\n      ? ['mp4', 'mkv', 'avi', 'webm']\r\n      : ['mp3', 'm4a', 'ogg', 'wav']\r\n    \r\n    exportFormatSelect.innerHTML = outputFormats\r\n      .map((format) => `<option value=\"${format}\">${format.toUpperCase()}</option>`)\r\n      .join('')\r\n    \r\n    state.exportContext.selectedFormat = outputFormats[0]\r\n  })\r\n\r\n  exportResolutionSelect.addEventListener('change', () => {\r\n    const selectedId = exportResolutionSelect.value\r\n    if (state.exportContext.type === 'video') {\r\n      state.exportContext.selectedResolution = state.exportContext.resolutions.find(r => r.id === selectedId)\r\n    } else {\r\n      state.exportContext.selectedResolution = state.exportContext.audioFormats.find(a => a.id === selectedId)\r\n    }\r\n  })\r\n\r\n  exportFormatSelect.addEventListener('change', () => {\r\n    state.exportContext.selectedFormat = exportFormatSelect.value\r\n  })\r\n\r\n  exportPop.addEventListener('click', (event) => {\r\n    if (event.target === exportPop) {\r\n      closeExportDrawer()\r\n    }\r\n  })\r\n\r\n  exportCancel.addEventListener('click', closeExportDrawer)\r\n\r\n  bindPreviewEvents()\r\n}\r\n\r\n// ========================================\r\n// DOWNLOAD HISTORY DROPDOWN\r\n// ========================================\r\n\r\nconst HISTORY_STORAGE_KEY = 'wh404:download:history'\r\nconst MAX_HISTORY_ITEMS = 50\r\nconst HISTORY_STATUS_META = {\r\n  exported: { icon: '', label: 'Saved to folder', className: 'history-status--exported' },\r\n  retry: { icon: '', label: 'Retry export', className: 'history-status--retry' },\r\n  downloaded: { icon: '', label: 'Process pending', className: 'history-status--pending' }\r\n}\r\n\r\nconst getHistoryStatusMeta = (status = 'downloaded') => {\r\n  return HISTORY_STATUS_META[status] || HISTORY_STATUS_META.downloaded\r\n}\r\n\r\nconst initHistoryDropdown = () => {\r\n  const historyToggle = document.getElementById('history-toggle')\r\n  const historyDropdown = document.getElementById('history-dropdown')\r\n  const historyClearAll = document.getElementById('history-clear-all')\r\n  \r\n  if (!historyToggle || !historyDropdown) return\r\n  \r\n  // Toggle dropdown\r\n  historyToggle.addEventListener('click', (e) => {\r\n    e.stopPropagation()\r\n    historyDropdown.classList.toggle('open')\r\n    if (historyDropdown.classList.contains('open')) {\r\n      renderHistory()\r\n    }\r\n  })\r\n  \r\n  // Close when clicking outside\r\n  document.addEventListener('click', (e) => {\r\n    if (!historyDropdown.contains(e.target) && e.target !== historyToggle) {\r\n      historyDropdown.classList.remove('open')\r\n    }\r\n  })\r\n  \r\n  // Clear all history\r\n  if (historyClearAll) {\r\n    historyClearAll.addEventListener('click', () => {\r\n      if (confirm('Clear all download history?')) {\r\n        localStorage.removeItem(HISTORY_STORAGE_KEY)\r\n        renderHistory()\r\n        pushLog('History cleared')\r\n      }\r\n    })\r\n  }\r\n  \r\n  renderHistory()\r\n}\r\n\r\nconst addToHistory = (url, platform, filename, status = 'downloaded') => {\r\n  try {\r\n    const history = getHistory()\r\n    const entry = {\r\n      url,\r\n      platform: platform || 'Unknown',\r\n      filename: filename || 'download',\r\n      timestamp: Date.now(),\r\n      date: new Date().toLocaleString(),\r\n      status\r\n    }\r\n    \r\n    // Remove duplicates and add to front\r\n    const filtered = history.filter(h => h.url !== url)\r\n    filtered.unshift(entry)\r\n    \r\n    // Keep only recent items\r\n    const trimmed = filtered.slice(0, MAX_HISTORY_ITEMS)\r\n    \r\n    localStorage.setItem(HISTORY_STORAGE_KEY, JSON.stringify(trimmed))\r\n    renderHistory()\r\n  } catch (err) {\r\n    console.error('[History] Failed to save:', err)\r\n  }\r\n}\r\n\r\nconst getHistory = () => {\r\n  try {\r\n    const stored = localStorage.getItem(HISTORY_STORAGE_KEY)\r\n    return stored ? JSON.parse(stored) : []\r\n  } catch (err) {\r\n    console.error('[History] Failed to load:', err)\r\n    return []\r\n  }\r\n}\r\n\r\nconst updateHistoryStatus = (url, status) => {\r\n  try {\r\n    const history = getHistory()\r\n    const index = history.findIndex((item) => item.url === url)\r\n    if (index === -1) return\r\n    history[index].status = status\r\n    localStorage.setItem(HISTORY_STORAGE_KEY, JSON.stringify(history))\r\n    renderHistory()\r\n  } catch (err) {\r\n    console.error('[History] Failed to update status:', err)\r\n  }\r\n}\r\n\r\nconst renderHistory = () => {\r\n  const historyList = document.getElementById('history-list')\r\n  if (!historyList) return\r\n  \r\n  const history = getHistory()\r\n  \r\n  if (history.length === 0) {\r\n    historyList.innerHTML = '<p class=\"history-empty\">No download history yet</p>'\r\n    return\r\n  }\r\n  \r\n  historyList.innerHTML = history.map(item => {\r\n    const statusMeta = getHistoryStatusMeta(item.status)\r\n    return `\r\n      <div class=\"history-item\" data-url=\"${item.url}\">\r\n        <div class=\"history-item-header\">\r\n          <div class=\"history-item-meta\">\r\n            <span class=\"history-platform\">${item.platform}</span>\r\n            <span class=\"history-date\">${formatHistoryDate(item.timestamp)}</span>\r\n          </div>\r\n          <div class=\"history-status ${statusMeta.className}\" title=\"${statusMeta.label}\">\r\n            <span class=\"history-status-icon\">${statusMeta.icon}</span>\r\n            <span class=\"history-status-text\">${statusMeta.label}</span>\r\n          </div>\r\n        </div>\r\n        <div class=\"history-url\">${item.url}</div>\r\n        <div class=\"history-filename\">${item.filename}</div>\r\n      </div>\r\n    `\r\n  }).join('')\r\n  \r\n  // Add click handlers\r\n  historyList.querySelectorAll('.history-item').forEach(item => {\r\n    item.addEventListener('click', () => {\r\n      const url = item.dataset.url\r\n      const textarea = document.getElementById('url-input')\r\n      if (textarea) {\r\n        textarea.value = url\r\n        textarea.focus()\r\n        updateGuideProgress('paste')\r\n        pushLog('Loaded from history: ' + url)\r\n      }\r\n      document.getElementById('history-dropdown').classList.remove('open')\r\n    })\r\n  })\r\n}\r\n\r\nconst formatHistoryDate = (timestamp) => {\r\n  const now = Date.now()\r\n  const diff = now - timestamp\r\n  const seconds = Math.floor(diff / 1000)\r\n  const minutes = Math.floor(seconds / 60)\r\n  const hours = Math.floor(minutes / 60)\r\n  const days = Math.floor(hours / 24)\r\n  \r\n  if (seconds < 60) return 'Just now'\r\n  if (minutes < 60) return `${minutes}m ago`\r\n  if (hours < 24) return `${hours}h ago`\r\n  if (days < 7) return `${days}d ago`\r\n  \r\n  return new Date(timestamp).toLocaleDateString()\r\n}\r\n\r\nconst bindIpc = () => {\r\n  console.log('[IPC] Binding IPC handlers...')\r\n  \r\n  window.downloader.onStatus((payload = {}) => {\r\n    engineOffline = payload.network === 'offline'\r\n    updateEngineChip()\r\n  })\r\n\r\n  window.downloader.onJobStart(({ url }) => {\r\n    console.log('[IPC] Job started:', url)\r\n    const item = ensureQueueItem(url)\r\n    item.status = 'downloading'\r\n    item.percent = 0\r\n    item.speed = 'Connecting...'\r\n    item.eta = 'Please wait'\r\n    setBusy(true)\r\n    updateEngineChip()\r\n    renderQueue()\r\n    pushLog(` Connecting to server: ${url}`)\r\n  })\r\n\r\n  console.log('[IPC] Registering onProgress handler...')\r\n  window.downloader.onProgress(({ url, percent, speed, eta }) => {\r\n    console.log('[RENDERERMAIN] Received progress:', { url, percent, speed, eta })\r\n    const item = state.queue.find((entry) => entry.url === url)\r\n    if (!item) {\r\n      console.warn('[RENDERER] No queue item found for URL:', url)\r\n      return\r\n    }\r\n    \r\n    // Update immediately - no animation, show exactly what yt-dlp reports\r\n    item.status = 'downloading'\r\n    item.percent = percent\r\n    item.speed = speed\r\n    item.eta = eta\r\n    \r\n    console.log('[RENDERER] Updated item:', { id: item.id, percent: item.percent, speed: item.speed })\r\n    \r\n    // Render immediately for real-time updates\r\n    renderQueue()\r\n  })\r\n\r\n  window.downloader.onJobComplete(({ url, files, tempDir }) => {\r\n    const item = state.queue.find((entry) => entry.url === url)\r\n    if (item) {\r\n      item.status = 'complete'\r\n      item.percent = 100\r\n      item.speed = '0 MB/s'\r\n      item.eta = '00:00'\r\n      item.files = files || []\r\n      item.tempDir = tempDir\r\n      \r\n      // Add to history\r\n      const filename = files && files.length > 0 ? files[0].split(/[/\\\\]/).pop() : 'download'\r\n      const platform = item.platform ? item.platform.name : 'Unknown'\r\n      addToHistory(url, platform, filename)\r\n      updateGuideProgress('download')\r\n      window.tutorial?.triggerAfterFirstDownload?.()\r\n      \r\n      console.log('[Download Complete]', { url, files, tempDir })\r\n      \r\n      // Auto-load preview for the first completed item\r\n      if (state.queue.filter(i => i.status === 'complete').length === 1) {\r\n        setTimeout(() => loadPreviewFromItem(item), 500)\r\n      }\r\n\r\n      // Pre-fetch metadata for export so the menu opens instantly later\r\n      console.log('[Metadata] Pre-fetching formats for:', url)\r\n      window.downloader.probeFormats(url)\r\n        .then(meta => {\r\n          console.log('[Metadata] Cached:', url)\r\n          formatCache.set(url, meta)\r\n        })\r\n        .catch(err => console.warn('[Metadata] Background probe failed:', err))\r\n    }\r\n    renderQueue()\r\n    pushLog(` Downloaded ${url} - ready to export`)\r\n  })\r\n\r\n  window.downloader.onJobError(({ url, message }) => {\r\n    console.error('[Job Error]', { url, message })\r\n    const item = ensureQueueItem(url)\r\n    item.status = 'error'\r\n    item.speed = 'Failed'\r\n    item.eta = 'Retry'\r\n    renderQueue()\r\n    pushLog(` Error: ${message || 'Download failed'}`)\r\n    \r\n    // Check if all jobs are done to update engine state\r\n    const hasActive = state.queue.some(i => i.status === 'downloading' || i.status === 'pending')\r\n    if (!hasActive) {\r\n      setBusy(false)\r\n      updateEngineChip()\r\n    }\r\n  })\r\n  \r\n  window.downloader.onJobCancelled(({ url }) => {\r\n    console.log('[Job Cancelled]', url)\r\n    const item = ensureQueueItem(url)\r\n    item.status = 'cancelled'\r\n    item.speed = 'Cancelled'\r\n    item.eta = '--:--'\r\n    item.percent = 0\r\n    renderQueue()\r\n    pushLog(` Cancelled: ${url}`)\r\n    \r\n    // Check if all jobs are done\r\n    const hasActive = state.queue.some(i => i.status === 'downloading' || i.status === 'pending')\r\n    if (!hasActive) {\r\n      setBusy(false)\r\n      updateEngineChip()\r\n    }\r\n  })\r\n\r\n  let lastExportUpdate = 0\r\n  let activeHeartbeat = null\r\n  \r\n  window.downloader.onExportProgress(({ file, percent, status }) => {\r\n    if (!exportPop.classList.contains('open')) return\r\n    \r\n    // Stop heartbeat when real progress arrives\r\n    if (activeHeartbeat && percent > 0) {\r\n      clearInterval(activeHeartbeat)\r\n      activeHeartbeat = null\r\n    }\r\n    \r\n    // Throttle updates to max 2 per second to avoid UI spam\r\n    const now = Date.now()\r\n    if (now - lastExportUpdate < 500 && percent < 100) return\r\n    lastExportUpdate = now\r\n    \r\n    const safePercent = Math.min(100, Math.max(0, Math.round(percent ?? 0)))\r\n    const fileName = file.length > 25 ? file.slice(0, 22) + '...' : file\r\n    \r\n    updateExportMessage(`Converting ${fileName}`, { loading: true })\r\n    exportConfirm.textContent = `${safePercent}%`\r\n    exportConfirm.style.background = `linear-gradient(90deg, var(--highlight) ${safePercent}%, rgba(255, 255, 255, 0.08) ${safePercent}%)`\r\n    exportConfirm.style.opacity = '1'\r\n  })\r\n}\r\n\r\n// Loading screen handler\r\nconst hideLoadingScreen = () => {\r\n  const loadingScreen = document.getElementById('loading-screen')\r\n  const mainWindow = document.querySelector('.window')\r\n  \r\n  console.log('[Startup] Hiding loading screen immediately...')\r\n  \r\n  // IMMEDIATE visibility - no delays\r\n  if (loadingScreen) {\r\n    loadingScreen.style.display = 'none'\r\n    loadingScreen.classList.add('hidden')\r\n    console.log('[Startup] Loading screen hidden')\r\n  }\r\n  if (mainWindow) {\r\n    mainWindow.style.opacity = '1'\r\n    mainWindow.style.visibility = 'visible'\r\n    mainWindow.classList.add('loaded')\r\n    console.log('[Startup] Main window visible')\r\n  }\r\n}\r\n\r\n// Initialize app\r\nconsole.log('[Startup] Initializing renderer...')\r\n\r\ntry {\r\n  wireEvents()\r\n  console.log('[Startup] Events wired')\r\n} catch (err) {\r\n  console.error('[Startup] wireEvents failed:', err)\r\n}\r\n\r\ntry {\r\n  bindIpc()\r\n  console.log('[Startup] IPC bound')\r\n} catch (err) {\r\n  console.error('[Startup] bindIpc failed:', err)\r\n}\r\n\r\ntry {\r\n  renderQueue()\r\n  console.log('[Startup] Queue rendered')\r\n} catch (err) {\r\n  console.error('[Startup] renderQueue failed:', err)\r\n}\r\n\r\ntry {\r\n  updatePresetChip()\r\n  console.log('[Startup] Preset chip updated')\r\n} catch (err) {\r\n  console.error('[Startup] updatePresetChip failed:', err)\r\n}\r\n\r\ntry {\r\n  updateEngineChip()\r\n  console.log('[Startup] Engine chip updated')\r\n} catch (err) {\r\n  console.error('[Startup] updateEngineChip failed:', err)\r\n}\r\n\r\n// Initialize history dropdown\r\ntry {\r\n  initHistoryDropdown()\r\n  console.log('[Startup] History dropdown initialized')\r\n} catch (err) {\r\n  console.error('[Startup] History init failed:', err)\r\n}\r\n\r\n// Hide loading screen after a brief moment - FORCE IT\r\nsetTimeout(() => {\r\n  console.log('[Startup] FORCING loading screen removal...')\r\n  const loadingScreen = document.getElementById('loading-screen')\r\n  const mainWindow = document.querySelector('.window')\r\n  \r\n  if (loadingScreen) {\r\n    loadingScreen.style.display = 'none'\r\n    loadingScreen.remove() // COMPLETELY REMOVE IT\r\n  }\r\n  if (mainWindow) {\r\n    mainWindow.style.opacity = '1'\r\n    mainWindow.style.visibility = 'visible'\r\n  }\r\n  console.log('[Startup] UI should be visible now!')\r\n}, 500)\r\n\r\nconsole.log('[Startup] Renderer initialized')\r\n\r\n"],"names":["_typeof","o","Symbol","iterator","constructor","prototype","toPropertyKey","t","i","r","e","toPrimitive","call","TypeError","String","Number","_defineProperty","Object","defineProperty","value","enumerable","configurable","writable","ownKeys","keys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","push","apply","_objectSpread2","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","PRESET_LABELS","mp3","social","textarea","document","getElementById","addToQueueBtn","queueList","queueCounter","selectionCounter","clearQueueBtn","queueSelectAll","selectionClearBtn","queueExportSelectedBtn","queueExportAllBtn","fileMenu","statusDestination","statusLine","statusQueue","statusPreset","statusEngine","menuTriggers","querySelectorAll","previewVideo","previewCard","previewEmpty","previewInfo","previewPlayBtn","previewStopBtn","previewRestartBtn","videoFormatBadge","trimStartInput","trimEndInput","trimStartLabel","trimEndLabel","trimDurationLabel","trimFill","currentTimeDisplay","totalTimeDisplay","timelineHoverPreview","playheadIndicator","timelineTrack","timelineMarkers","previewPane","querySelector","metadataPopover","metadataPopoverTitle","metadataBackdrop","metadataCloseBtn","summaryOpenTriggers","metadataCards","summaryValueFields","thumbnail","title","keywords","description","summaryChipRefs","premiumStatusLabel","premiumCardGroups","Array","from","seo","story","premiumThumbnailFrame","premiumThumbnailRatioLabel","premiumKeywordsField","premiumTitleField","premiumDescriptionField","exportMetaThumbnail","exportMetaKeywords","exportMetaTitle","summaryFeatureLookup","panelTitleMap","orderedPanelKeys","summaryReadyChecks","Boolean","state","preview","metadata","_state$preview$metada","_state$preview$metada2","trim","_state$preview$metada3","guideProgress","reduce","acc","stage","_objectSpread","showPreviewGuide","message","innerHTML","concat","undefined","getPreviewGuideMarkup","classList","remove","applyGuideProgress","step","dataset","add","updateGuideProgress","hasOwnProperty","DEFAULT_PREVIEW_MESSAGE","console","warn","exportPop","exportTarget","exportBrowse","exportConfirm","exportFormatSelect","exportMessage","exportMessageText","exportMessageDots","exportLoader","exportPathInput","exportCancel","exportTypeSelect","exportResolutionSelect","exportConfirmDefaultLabel","textContent","formatCache","Map","STORAGE_KEYS","engineOffline","queueId","lastPopoverAnchor","format","queue","busy","exportId","autoRun","destination","queueSelection","Set","file","url","duration","start","end","ready","trimmedFile","trimProcessing","fetched","premium","activePanel","exportContext","targets","formats","resolutions","audioFormats","selectedResolution","selectedFormat","type","previewMode","DEFAULT_DEST_LABEL","escapeHtml","replace","clampValue","min","max","Math","getSelectedQueueItems","item","has","id","setPremiumStatus","text","variant","getAspectRatioLabel","width","height","ratio","closest","label","prev","candidate","abs","simplified","simplifyAspectRatio","gcd","a","b","safeWidth","round","safeHeight","divisor","w","h","updateThumbnailRatioLabel","videoWidth","videoHeight","summaryFormatters","formatThumbnailSummary","formatKeywordSummary","map","word","slice","join","formatTitleSummary","_state$preview$metada4","formatDescriptionSummary","_state$preview$metada5","words","split","getFirstEnabledPanel","find","panel","feature","resolvePanelKey","normalized","includes","getNormalizedPanelKey","updatePopoverAnchor","chip","chipRect","getBoundingClientRect","paneRect","halfPopover","chipCenterX","left","minX","maxX","clampedX","anchorY","bottom","top","maxY","clampedY","style","setProperty","setActiveMetadataPanel","anchorChip","card","toggle","popoverPanel","updateSummaryChips","entries","_ref","_summaryFormatters$ke","key","node","_ref2","_summaryReadyChecks$s","summaryKey","enabled","setAttribute","renderExportMetadata","_state$preview$metada6","renderPremiumMetadata","backgroundImage","setPreviewMode","nextMode","mode","activeChip","pause","error","fetchPremiumMetadata","async","_response","_response2","_response3","_response4","fallback","_item$platform","URL","pathname","segment","err","platform","name","toLowerCase","fallbackTitle","encodeURIComponent","buildFallbackMetadata","response","_window$downloader","_window$downloader2","window","downloader","fetchMetadata","getSeoMetadata","isArray","syncPreviewWithSelection","exportDotsTimer","updateExportMessage","loading","startExportDots","frames","index","setInterval","clearInterval","updateDestinationLabel","display","closeMenus","menu","copyToClipboard","_navigator$clipboard","navigator","clipboard","writeText","temp","createElement","position","opacity","pointerEvents","body","appendChild","focus","select","setSelectionRange","success","execCommand","buildFileList","wrapper","className","isExported","exported","exportedFiles","displayFiles","files","row","info","filePath","pop","formatFileName","pathLabel","actions","revealBtn","action","path","copyBtn","formatTime","total","floor","minutes","seconds","padStart","setStatus","updateSelectionCounter","selectedItems","selections","checked","updateEngineChip","parseUrls","urls","startsWith","createQueueItem","urlLower","icon","color","detectPlatformFromUrl","status","percent","speed","eta","ensureQueueItem","entry","addToQueue","log","added","some","renderQueue","pushLog","loadPreviewFromItem","source","f","endsWith","removeAttribute","fileUrl","encoded","toFileUrl","src","load","_target$files","_target$exportedFiles","target","items","idx","meta","getBatchStatusMeta","safeUrl","clampPreviewRanges","updateTrimFill","debouncedBackgroundTrim","trimDebounceTimer","clearTimeout","setTimeout","processBackgroundTrim","_window$systemDialogs2","trimData","sourceFile","result","systemDialogs","backgroundTrim","startPercent","endPercent","resetPreviewPlayer","applyPremiumToggleUI","_ref3","cards","activeFeature","togglePreviewPlayback","paused","currentTime","play","stopPreview","restartPreview","pruneSelection","validIds","delete","empty","_item$percent","slot","selected","platformBadge","showCancel","toFixed","addEventListener","event","selectInput","stopPropagation","openExportDrawer","cancelBtn","cancelDownload","btn","moveQueueItem","move","deleteBtn","deleteQueueItem","filesBlock","button","decodedPath","decodeURIComponent","decodeDatasetPath","_window$systemDialogs3","revealFile","copied","delta","findIndex","splice","updateHistoryStatus","setBusy","queueLinks","startQueueIfIdle","onDownload","collectDownloadUrls","pending","fresh","startDownload","outputDir","_window$localStorage","localStorage","setItem","setDestination","closeExportDrawer","disabled","background","updateExportResolutionSelect","renderExportOptions","videoFormats","fmt","vcodec","get","tbr","set","fps","container","acodec","values","sort","extractResolutionsFromFormats","qualities","abr","extractAudioFormatsFromFormats","outputFormats","toUpperCase","completed","targetUrl","cached","populateExportOptions","probeFormats","mapped","note","filesize","bindPreviewEvents","detectVideoFormat","aspectRatio","markers","time","generateTimelineMarkers","progress","errorMsg","rect","clientX","activeTrimHandle","handleTrimTimelineClick","currentTarget","clickTime","startDistance","endDistance","threshold","trimStart","trimEnd","trimTimeline","isDragging","contains","clickX","handleMenuAction","chooseDestinationFolder","openDestinationFolder","_window$systemDialogs","openFolder","checkForUpdates","currentVersion","appName","alert","fetch","data","json","latestVersion","tag_name","wireEvents","_window$localStorage2","targetId","isOpen","toggleMenu","menuTrigger","actionElement","menuAction","aboutMenu","helpMenu","storedDestination","getItem","clear","exportSelectionHandler","shiftKey","preventDefault","handlePasteProgress","_window$windowControl","windowControls","control","pinBtn","_window$windowControl2","pinned","togglePin","openPanel","anchor","payload","handlePremiumCopy","premiumCopy","filename","link","href","download","click","removeChild","triggerDownloadFromUrl","handleExportCopy","exportCopy","_window$systemDialogs4","chooseFolder","allFiles","_window$systemDialogs5","heartbeatCount","activeHeartbeat","outputFormat","exportFiles","metadataPayload","buildMetadataPayload","_state$preview$metada7","exportPayload","selectedId","HISTORY_STORAGE_KEY","HISTORY_STATUS_META","retry","downloaded","getHistory","stored","JSON","parse","history","stringify","renderHistory","historyList","statusMeta","getHistoryStatusMeta","formatHistoryDate","timestamp","diff","Date","now","hours","days","toLocaleDateString","bindIpc","onStatus","network","onJobStart","_ref4","onProgress","_ref5","onJobComplete","_ref6","tempDir","_window$tutorial","_window$tutorial$trig","date","toLocaleString","filtered","unshift","trimmed","addToHistory","tutorial","triggerAfterFirstDownload","then","catch","onJobError","_ref7","onJobCancelled","_ref8","lastExportUpdate","onExportProgress","_ref9","safePercent","fileName","initHistoryDropdown","historyToggle","historyDropdown","historyClearAll","confirm","removeItem","loadingScreen","mainWindow","visibility"],"ignoreList":[],"sourceRoot":""}