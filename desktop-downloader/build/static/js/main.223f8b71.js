(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var a=o.call(t,n||"default");if("object"!=e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}function n(e,n,o){return(n=t(n))in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach(function(t){n(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}const i={"mp4-1080":"1080p Pro","mp4-720":"720p HD",mp3:"Audio only",social:"Social"},r=document.getElementById("url-input"),l=document.getElementById("add-to-queue-btn"),s=document.getElementById("queue-list"),d=document.getElementById("queue-counter"),c=document.getElementById("selection-counter"),u=document.getElementById("clear-queue"),p=document.getElementById("queue-select-all"),m=document.getElementById("selection-clear"),v=document.getElementById("queue-export-selected"),g=document.getElementById("queue-export-all"),h=document.getElementById("file-menu"),w=document.getElementById("status-destination"),y=document.getElementById("status-line"),f=document.getElementById("status-queue"),b=document.getElementById("status-preset"),x=document.getElementById("status-engine"),E=document.querySelectorAll("[data-menu-trigger]"),C=document.getElementById("preview-video"),k=document.getElementById("preview-card"),L=document.getElementById("preview-empty"),I=document.getElementById("preview-info"),S=document.getElementById("preview-play"),B=document.getElementById("preview-stop"),q=document.getElementById("preview-restart"),P=document.getElementById("video-format-badge"),M=document.getElementById("trim-start"),D=document.getElementById("trim-end"),A=document.getElementById("trim-start-label"),R=document.getElementById("trim-end-label"),T=document.getElementById("trim-duration"),F=document.getElementById("trim-fill"),N=document.getElementById("current-time"),H=document.getElementById("total-time"),j=document.getElementById("timeline-hover"),O=document.getElementById("playhead-indicator"),U=document.getElementById("trim-timeline-track"),W=document.getElementById("timeline-markers"),Q=document.querySelector(".preview-pane"),z=(document.getElementById("metadata-pane"),document.getElementById("metadata-popover")),J=document.getElementById("metadata-popover-title"),V=document.getElementById("metadata-backdrop"),K=document.getElementById("metadata-close"),G=document.querySelectorAll("[data-open-panel]"),X=document.querySelectorAll("[data-popover-panel]"),Y={thumbnail:document.getElementById("summary-thumbnail"),title:document.getElementById("summary-title"),keywords:document.getElementById("summary-keywords"),description:document.getElementById("summary-description")},_={thumbnail:document.querySelector('[data-summary-chip="thumbnail"]'),title:document.querySelector('[data-summary-chip="title"]'),keywords:document.querySelector('[data-summary-chip="keywords"]'),description:document.querySelector('[data-summary-chip="description"]')},Z=(document.getElementById("premium-refresh"),document.getElementById("premium-status")),$=(document.querySelectorAll("[data-premium-control]"),{thumbnail:Array.from(document.querySelectorAll('[data-premium-card="thumbnail"]')),seo:Array.from(document.querySelectorAll('[data-premium-card="seo"]')),story:Array.from(document.querySelectorAll('[data-premium-card^="story"]'))}),ee=document.getElementById("premium-thumbnail"),te=document.getElementById("premium-thumbnail-ratio"),ne=document.getElementById("premium-keywords-string"),oe=document.getElementById("premium-title"),ae=document.getElementById("premium-description"),ie=document.getElementById("export-meta-thumbnail"),re=document.getElementById("export-meta-keywords"),le=document.getElementById("export-meta-title"),se={thumbnail:"thumbnail",keywords:"seo",title:"story",description:"story"},de={thumbnail:"Smart thumbnail",keywords:"SEO keywords",title:"Story title",description:"Caption draft"},ce=["thumbnail","keywords","title","description"],ue={thumbnail:()=>Boolean(Fe.preview.metadata.thumbnail),keywords:()=>{var e;return Boolean(null===(e=Fe.preview.metadata.keywords)||void 0===e?void 0:e.length)},title:()=>{var e;return Boolean(null===(e=Fe.preview.metadata.title)||void 0===e?void 0:e.trim())},description:()=>{var e;return Boolean(null===(e=Fe.preview.metadata.description)||void 0===e?void 0:e.trim())}},pe=["paste","queue","download","preview"].reduce((e,t)=>a(a({},e),{},{[t]:!1}),{}),me=e=>{L&&(L.innerHTML=function(){return'\n  <div class="hacker-loading">\n    <div class="hacker-logo">\n      <span class="glitch-text" data-text="WH404">WH404</span>\n      <span class="hacker-subtitle">WORD HACKER</span>\n    </div>\n    <div class="hacker-logs">\n      <div class="log-line">\u25b8 '.concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Download a video to begin",'</div>\n      <div class="log-line">\u25b8 We handle everything automatically</div>\n      <div class="log-line">\u25b8 Follow these 4 quick steps</div>\n    </div>\n    <ul class="guide-steps">\n      <li class="guide-step" data-stage="paste"><span>1.</span> Paste a link and press Add to Queue</li>\n      <li class="guide-step" data-stage="queue"><span>2.</span> Watch the queue progress</li>\n      <li class="guide-step" data-stage="download"><span>3.</span> Let WH404 download the file</li>\n      <li class="guide-step" data-stage="preview"><span>4.</span> Preview, trim, then export</li>\n    </ul>\n    <div class="progress-dots"><span>.</span><span>.</span><span>.</span></div>\n  </div>\n')}(e),L.classList.remove("hidden"),ve())},ve=()=>{L&&L.querySelectorAll(".guide-step").forEach(e=>{const t=e.dataset.stage;pe[t]?e.classList.add("completed"):e.classList.remove("completed")})},ge=e=>{Object.prototype.hasOwnProperty.call(pe,e)&&(pe[e]||(pe[e]=!0,ve()))},he="Paste any link to start decoding.";N&&H||console.warn("[Init] Timeline display elements not found"),j&&O||console.warn("[Init] Timeline interaction elements not found");const we=document.getElementById("export-pop"),ye=document.getElementById("export-target"),fe=document.getElementById("export-browse"),be=document.getElementById("export-confirm"),xe=document.getElementById("export-format"),Ee=document.getElementById("export-message"),Ce=document.getElementById("export-message-text"),ke=document.getElementById("export-message-dots"),Le=document.getElementById("export-loader"),Ie=document.getElementById("export-path"),Se=document.getElementById("export-cancel"),Be=document.getElementById("export-type"),qe=document.getElementById("export-resolution"),Pe=(null===be||void 0===be?void 0:be.textContent)||"Export selection",Me=new Map,De="wh404:destination";let Ae=!1,Re=0,Te=null;const Fe={format:"mp4-1080",queue:[],busy:!1,exportId:null,autoRun:!0,destination:"",queueSelection:new Set,preview:{file:"",url:"",duration:0,start:0,end:0,ready:!1,trimmedFile:null,trimProcessing:!1,metadata:{title:"",description:"",keywords:[],thumbnail:"",fetched:!1},premium:{thumbnail:!0,seo:!0,story:!0},activePanel:"thumbnail"},exportContext:{targets:[],formats:[],resolutions:[],audioFormats:[],selectedResolution:null,selectedFormat:null,type:"video"},previewMode:"video"},Ne="Downloads/WordHackerDownloads",He=function(){return String(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},je=(e,t,n)=>Math.min(Math.max(e,t),n),Oe=()=>Fe.queue.filter(e=>Fe.queueSelection.has(e.id)),Ue=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"idle";Z&&(Z.textContent=e,Z.classList.remove("loading","error","success"),"idle"!==t&&Z.classList.add(t))},We=(e,t)=>{if(!e||!t)return"--";const n=e/t,o=[{label:"9:16",value:9/16},{label:"4:5",value:.8},{label:"3:4",value:3/4},{label:"1:1",value:1},{label:"4:3",value:4/3},{label:"16:9",value:16/9}].reduce((e,t)=>Math.abs(t.value-n)<Math.abs(e.value-n)?t:e);if(Math.abs(o.value-n)<=.08)return o.label;const a=((e,t)=>{const n=(e,t)=>t?n(t,e%t):e,o=Math.max(1,Math.round(e)),a=Math.max(1,Math.round(t)),i=n(o,a)||1;return{w:Math.round(o/i),h:Math.round(a/i)}})(e,t);return"".concat(a.w,":").concat(a.h)},Qe=()=>{if(!te)return;const e=null===C||void 0===C?void 0:C.videoWidth,t=null===C||void 0===C?void 0:C.videoHeight;te.textContent=e&&t?"Aspect: ".concat(We(e,t)):"Aspect: --"},ze={thumbnail:()=>{if(!Fe.preview.metadata.thumbnail)return"Waiting";const e=null===C||void 0===C?void 0:C.videoWidth,t=null===C||void 0===C?void 0:C.videoHeight;return e&&t?"".concat(We(e,t)," ready"):"Ready"},keywords:()=>{const e=(Fe.preview.metadata.keywords||[]).map(e=>e.trim()).filter(Boolean);return e.length?1===e.length?e[0]:2===e.length?"".concat(e[0],", ").concat(e[1]):"".concat(e.slice(0,2).join(", ")," +").concat(e.length-2):"Waiting"},title:()=>{var e;const t=null===(e=Fe.preview.metadata.title)||void 0===e?void 0:e.trim();return t?t.length>42?"".concat(t.slice(0,42),"\u2026"):t:"Title not ready"},description:()=>{var e;const t=null===(e=Fe.preview.metadata.description)||void 0===e?void 0:e.trim();if(!t)return"Waiting";const n=t.split(/\s+/).filter(Boolean);return n.length?n.length<12?t.length>60?"".concat(t.slice(0,57),"\u2026"):t:"".concat(n.length," words"):"Waiting"}},Je=()=>ce.find(e=>{const t=se[e];return!t||Fe.preview.premium[t]})||"thumbnail",Ve=e=>{const t=(e=>ce.includes(e)?e:"thumbnail")(e),n=se[t];return n&&!Fe.preview.premium[n]?Je():t},Ke=e=>{if(!e||!z||!Q)return;const t=e.getBoundingClientRect(),n=Q.getBoundingClientRect();if(!t.width||!n.width)return;const o=Math.min(420,n.width-54)/2,a=t.left+t.width/2-n.left,i=o+20,r=n.width-o-20,l=je(a,i,r),s=t.bottom-n.top+16,d=Math.max(120,n.height-140),c=je(s,90,d);z.style.setProperty("--popover-x","".concat(l,"px")),z.style.setProperty("--popover-y","".concat(c,"px")),Te=e},Ge=function(){let e=arguments.length>1?arguments[1]:void 0;const t=Ve(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"thumbnail");Fe.preview.activePanel=t,X.forEach(e=>{e.classList.toggle("active",e.dataset.popoverPanel===t)}),J&&(J.textContent=de[t]||"Metadata toolkit"),e?Ke(e):Te&&Ke(Te),Xe()},Xe=()=>{Object.entries(Y).forEach(e=>{var t;let[n,o]=e;if(!o)return;const a=se[n];!a||Fe.preview.premium[a]?o.textContent=(null===(t=ze[n])||void 0===t?void 0:t.call(ze))||"Waiting":o.textContent="Disabled"}),Object.entries(se).forEach(e=>{var t;let[n,o]=e;const a=Fe.preview.premium[o],i=_[n];if(!i)return;const r=a&&Boolean(null===(t=ue[n])||void 0===t?void 0:t.call(ue));i.classList.toggle("disabled",!a),i.classList.toggle("ready",r),i.classList.toggle("active","insights"===Fe.previewMode&&Fe.preview.activePanel===n),i.setAttribute("aria-expanded","insights"===Fe.previewMode&&Fe.preview.activePanel===n?"true":"false")})},Ye=()=>{var e;(ie&&(Fe.preview.premium.thumbnail?Fe.preview.metadata.thumbnail?ie.textContent="Attached":ie.textContent="Waiting for clip":ie.textContent="Disabled"),re)&&(Fe.preview.premium.seo?null!==(e=Fe.preview.metadata.keywords)&&void 0!==e&&e.length?re.textContent="".concat(Fe.preview.metadata.keywords.length," tags ready"):re.textContent="Waiting for clip":re.textContent="Disabled");le&&(Fe.preview.premium.story?Fe.preview.metadata.title?le.textContent="Attached":le.textContent="Waiting for clip":le.textContent="Disabled")},_e=()=>{if(ee&&(Fe.preview.metadata.thumbnail?(ee.style.backgroundImage='url("'.concat(Fe.preview.metadata.thumbnail,'")'),ee.innerHTML=""):(ee.style.backgroundImage="none",ee.innerHTML="<p>Thumbnail not ready</p>")),Qe(),ne){const e=(Fe.preview.metadata.keywords||[]).map(e=>e.trim()).filter(Boolean);ne.textContent=e.length?e.join(", "):"Keywords will appear here"}oe&&(oe.textContent=Fe.preview.metadata.title||"Title not ready"),ae&&(ae.textContent=Fe.preview.metadata.description||"Description will appear here when a clip is selected."),Xe(),Ye()},Ze=function(){if(!Q)return;const e="insights"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"video")?"insights":"video";if(Fe.previewMode=e,Q.dataset.mode=e,null===z||void 0===z||z.setAttribute("aria-hidden","video"===e?"true":"false"),Xe(),"insights"===e){const e=_[Fe.preview.activePanel];e&&Ke(e);try{C.pause()}catch(t){}}else Fe.preview.ready&&L.classList.add("hidden")},$e=async e=>{var t,n,o,a;if(!e||!e.url)return void Ue("Select a clip to load metadata.");Ue("Generating insights...","loading");const i=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=[];try{n=new URL(t.url||"").pathname.split("/").filter(Boolean).slice(-4).map(e=>e.replace(/[-_]/g," ").replace(/\d+/g,"").trim()).filter(Boolean)}catch(a){n=[]}!n.length&&null!==(e=t.platform)&&void 0!==e&&e.name&&(n=[t.platform.name.toLowerCase(),"word hacker 404"]);const o=t.platform?"".concat(t.platform.name," capture"):"Word Hacker capture";return{title:o,description:"Auto-generated notes for ".concat(o,". Add your hook before publishing."),keywords:n,thumbnail:t.thumbnail||(t.url?"https://image.thum.io/get/width/900/crop/600/".concat(encodeURIComponent(t.url)):""),fetched:!1}}(e);let r=null;try{var l,s;"function"===typeof(null===(l=window.downloader)||void 0===l?void 0:l.fetchMetadata)?r=await window.downloader.fetchMetadata(e.url):"function"===typeof(null===(s=window.downloader)||void 0===s?void 0:s.getSeoMetadata)&&(r=await window.downloader.getSeoMetadata(e.url))}catch(c){console.warn("[Premium] Metadata fetch failed",c)}const d={title:(null===(t=r)||void 0===t?void 0:t.title)||i.title,description:(null===(n=r)||void 0===n?void 0:n.description)||i.description,keywords:Array.isArray(null===(o=r)||void 0===o?void 0:o.keywords)&&r.keywords.length?r.keywords:i.keywords,thumbnail:(null===(a=r)||void 0===a?void 0:a.thumbnail)||i.thumbnail,fetched:Boolean(r)};Fe.preview.metadata=d,_e(),Ue(d.fetched?"Premium insights ready.":"Using offline cues. Tap refresh to retry.",d.fetched?"success":"error")};let et=()=>{};let tt=null;const nt=function(e){let{loading:t=!1,variant:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Ce?Ce.textContent=e:Ee.textContent=e,Ee&&(Ee.classList.remove("success","error"),n&&Ee.classList.add(n)),t?(null===Le||void 0===Le||Le.classList.add("active"),(()=>{if(!ke||tt)return;const e=[".","..","..."];let t=0;ke.textContent=e[t],tt=setInterval(()=>{t=(t+1)%e.length,ke.textContent=e[t]},320)})()):(null===Le||void 0===Le||Le.classList.remove("active"),tt&&(clearInterval(tt),tt=null),ke&&(ke.textContent=""))},ot=()=>{const e=Fe.destination||Ne;var t;Ie&&(Ie.value=e),w&&(w.textContent="Destination: ".concat((t=e)?t.length<=28?t:"...".concat(t.slice(-28)):Ne))},at=()=>{document.querySelectorAll(".menu-dropdown").forEach(e=>e.classList.remove("open"))},it=async e=>{var t;if(!e)return!1;if(null!==(t=navigator.clipboard)&&void 0!==t&&t.writeText)try{return await navigator.clipboard.writeText(e),!0}catch(n){console.warn("Clipboard API failed",n)}try{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",t.style.pointerEvents="none",document.body.appendChild(t),t.focus(),t.select(),t.setSelectionRange(0,e.length);const n=document.execCommand("copy");return t.remove(),n}catch(n){return console.warn("Clipboard fallback failed",n),!1}},rt=e=>{const t=document.createElement("div");t.className="slot-files";const n=document.createElement("p");n.className="slot-files-title";const o=e.exported&&e.exportedFiles&&e.exportedFiles.length,a=o?e.exportedFiles:e.files;return n.textContent=o?1===a.length?"\u2713 Exported file":"\u2713 Exported files (".concat(a.length,")"):1===a.length?"\u23f3 Ready to export":"\u23f3 Ready to export (".concat(a.length," files)"),t.appendChild(n),a.forEach(e=>{const n=document.createElement("div");n.className="slot-file";const a=document.createElement("div");a.className="slot-file-info";const i=document.createElement("p");i.className="slot-file-name",i.textContent=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e?e.split(/[\\\/]/).filter(Boolean).pop()||e:"Unnamed file"}(e);const r=document.createElement("p");r.className="slot-file-path",r.textContent=o?e:"\u23f3 Temporary (not saved yet)",a.appendChild(i),a.appendChild(r);const l=document.createElement("div");if(l.className="slot-file-actions",o){const t=document.createElement("button");t.className="ghost ghost-icon",t.title="Show in Explorer",t.dataset.action="reveal",t.dataset.path=encodeURIComponent(e),t.textContent="\ud83d\udcc2",l.appendChild(t)}const s=document.createElement("button");s.className="ghost ghost-icon",s.title=o?"Copy path":"Copy temp path",s.dataset.action="copy",s.dataset.path=encodeURIComponent(e),s.textContent="\ud83d\udccb",l.appendChild(s),n.appendChild(a),n.appendChild(l),t.appendChild(n)}),t},lt=e=>{const t=Math.max(0,Math.floor(e||0)),n=Math.floor(t/60),o=t%60;return"".concat(String(n).padStart(2,"0"),":").concat(String(o).padStart(2,"0"))},st=e=>{y.textContent=e},dt=()=>{const e=Oe(),t=e.length;c.textContent="".concat(t," selected"),p&&(p.checked=t>0&&t===Fe.queue.length&&Fe.queue.length>0),et(e)},ct=()=>{x.textContent=Ae?"Engine: offline":Fe.busy?"Engine: running":"Engine: idle"},ut=()=>{const e=r.value.split(/[\n,\s]+/).map(e=>e.trim()).filter(e=>e.startsWith("http"));return Array.from(new Set(e))},pt=e=>{const t=(e=>{const t=e.toLowerCase();return t.includes("youtube.com")||t.includes("youtu.be")?{name:"YouTube",icon:"\u25b6\ufe0f",color:"#ff0000"}:t.includes("instagram.com")||t.includes("instagr.am")?{name:"Instagram",icon:"\ud83d\udcf7",color:"#e4405f"}:t.includes("facebook.com")||t.includes("fb.")?{name:"Facebook",icon:"\ud83d\udc65",color:"#1877f2"}:t.includes("tiktok.com")?{name:"TikTok",icon:"\ud83c\udfb5",color:"#00f2ea"}:t.includes("twitter.com")||t.includes("x.com")?{name:"Twitter/X",icon:"\ud83d\udc26",color:"#1da1f2"}:t.includes("reddit.com")||t.includes("redd.it")?{name:"Reddit",icon:"\ud83e\udd16",color:"#ff4500"}:t.includes("vimeo.com")?{name:"Vimeo",icon:"\ud83c\udfac",color:"#1ab7ea"}:t.includes("soundcloud.com")?{name:"SoundCloud",icon:"\ud83d\udd0a",color:"#ff7700"}:t.includes("dailymotion.com")?{name:"Dailymotion",icon:"\ud83d\udcfa",color:"#0066dc"}:t.includes("twitch.tv")?{name:"Twitch",icon:"\ud83d\udfe3",color:"#9146ff"}:t.includes("udemy.com")?{name:"Udemy",icon:"\ud83d\udcda",color:"#a435f0"}:{name:"Other",icon:"\ud83c\udf10",color:"#9aa3b2"}})(e);return{id:"slot-".concat(++Re),url:e,platform:t,status:"pending",percent:0,speed:"0 MB/s",eta:"--:--",files:[]}},mt=e=>{let t=Fe.queue.find(t=>t.url===e);return t||(t=pt(e),Fe.queue.push(t)),t},vt=e=>{console.log("[Queue] addToQueue called with:",e);let t=0;return e.forEach(e=>{e&&(Fe.queue.some(t=>t.url===e)?console.log("[Queue] Duplicate URL skipped:",e):(console.log("[Queue] Adding new item:",e),Fe.queue.push(pt(e)),t+=1))}),console.log("[Queue] Calling renderQueue, total items:",Fe.queue.length),It(),console.log("[Queue] renderQueue completed"),t},gt=e=>{st(e)},ht=e=>{if(!e.files||!e.files.length)return void st("Preview not ready yet. Finish the download first.");const t=e.files.find(e=>e.endsWith(".mp4")||e.endsWith(".webm")||e.endsWith(".mkv")||e.endsWith(".mp3")||e.endsWith(".m4a"))||e.files[0];Fe.preview.file=t,Fe.preview.url=e.url,C.removeAttribute("poster"),L.classList.add("hidden");const n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!e)return"";if(e.startsWith("file://"))return e;const t=e.replace(/\\/g,"/").replace(/^([a-zA-Z]):/,"/$1:").split("/").map(e=>encodeURIComponent(e)).join("/");return"file://".concat(t.startsWith("/")?"":"/").concat(t)}(t);console.log("[Preview] Loading:",t),console.log("[Preview] File URL:",n),C.src=n,C.load(),I.textContent=e.url,ge("preview"),$e(e),et=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Oe();if(L){if(!e.length)return k.classList.remove("batch-mode"),void(Fe.preview.ready?L.classList.add("hidden"):me(he));if(1===e.length){var t,n;k.classList.remove("batch-mode");const o=e[0];return void("complete"===o.status&&(null!==(t=o.files)&&void 0!==t&&t.length||null!==(n=o.exportedFiles)&&void 0!==n&&n.length)?ht(o):me("Selected item is still processing. Please wait for the download to finish."))}k.classList.add("batch-mode");try{C.pause()}catch(a){}var o;L.classList.remove("hidden"),L.innerHTML='\n    <div class="batch-summary">\n      <p class="batch-summary-header">'.concat((o=e).length,' clips selected</p>\n      <div class="batch-summary-list">\n        ').concat(o.map((e,t)=>{const n=(e=>"complete"===e.status&&(e.exported||e.files&&e.files.length)?{icon:"\u2713",label:"Ready",className:"ready"}:"error"===e.status?{icon:"\u26a0",label:"Needs attention",className:"error"}:{icon:"...",label:"Processing",className:"waiting"})(e),o=He(e.platform?e.platform.name:"Clip ".concat(t+1)),a=He(e.url);return'\n              <div class="batch-summary-row">\n                <div>\n                  <strong>'.concat(o,'</strong>\n                  <div class="mono">').concat(a,'</div>\n                </div>\n                <div class="batch-summary-status ').concat(n.className,'">\n                  <span>').concat(n.icon,"</span>\n                  <span>").concat(n.label,"</span>\n                </div>\n              </div>\n            ")}).join(""),'\n      </div>\n      <p class="batch-summary-footer">Run Export Selected to process them together.</p>\n    </div>\n  ')}},st("Loading preview...")},wt=()=>{const e=Number(M.value);let t=Number(D.value);t<=e+.1&&(t=Math.min(Fe.preview.duration,e+.1),D.value=t),Fe.preview.start=e,Fe.preview.end=t,A.textContent=lt(e),R.textContent=lt(t),T.textContent=lt(t-e),xt(),ft()};let yt=null;const ft=()=>{yt&&clearTimeout(yt),yt=setTimeout(()=>{bt()},2e3)},bt=async()=>{if(!Fe.preview.ready||!Fe.preview.file)return;if(Fe.preview.start>0||Fe.preview.end<Fe.preview.duration){if(!Fe.preview.trimProcessing){console.log("[Background Trim] Starting pre-processing..."),Fe.preview.trimProcessing=!0,st("Pre-processing trim in background...");try{var e;const t={start:Fe.preview.start,end:Fe.preview.end,sourceFile:Fe.preview.file},n=await(null===(e=window.systemDialogs)||void 0===e?void 0:e.backgroundTrim(t));n&&n.trimmedFile&&(Fe.preview.trimmedFile=n.trimmedFile,console.log("[Background Trim] Complete:",n.trimmedFile),st("\u2713 Trim ready - export will be instant!"))}catch(t){console.error("[Background Trim] Error:",t),st("Background trim failed - will process on export"),Fe.preview.trimmedFile=null}finally{Fe.preview.trimProcessing=!1}}}else Fe.preview.trimmedFile=null},xt=()=>{if(!F)return;const e=Fe.preview.duration||0;if(!e)return F.style.left="0%",void(F.style.width="0%");const t=Fe.preview.start/e*100,n=Fe.preview.end/e*100;F.style.left="".concat(t,"%"),F.style.width="".concat(Math.max(0,n-t),"%")},Et=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:he;if(C){try{C.pause()}catch(n){console.warn("[Preview] pause failed during reset",n)}var t;C.removeAttribute("src"),C.removeAttribute("poster"),C.load(),S.textContent="\u25b6",null===k||void 0===k||k.classList.remove("video-horizontal","video-vertical","video-shorts"),P&&(P.textContent="No media loaded"),I&&(I.textContent="No video loaded"),Fe.preview.file="",Fe.preview.url="",Fe.preview.duration=0,Fe.preview.start=0,Fe.preview.end=0,Fe.preview.ready=!1,Fe.preview.trimmedFile=null,Fe.preview.trimProcessing=!1,Fe.preview.metadata={title:"",description:"",keywords:[],thumbnail:"",fetched:!1},Fe.preview.activePanel=Ve("thumbnail"),M&&(M.value=0,M.max=0),D&&(D.value=0,D.max=0),A&&(A.textContent=lt(0)),R&&(R.textContent=lt(0)),T&&(T.textContent=lt(0)),N&&(N.textContent=lt(0)),H&&(H.textContent=lt(0)),xt(),t="preview",Object.prototype.hasOwnProperty.call(pe,t)&&(pe[t]=!1,ve()),me(e),_e(),Ue("Select a clip to load metadata.")}};Et(),(()=>{Object.entries($).forEach(e=>{let[t,n]=e;n.forEach(e=>null===e||void 0===e?void 0:e.classList.toggle("disabled",!Fe.preview.premium[t]))});const e=se[Fe.preview.activePanel];e&&!Fe.preview.premium[e]?Ge(Je()):Xe(),Ye()})(),Ze("video"),Ge("thumbnail");const Ct=()=>{Fe.preview.ready&&(C.paused?(C.currentTime=Fe.preview.start,C.play(),S.textContent="\u275a\u275a"):(C.pause(),S.textContent="\u25b6"))},kt=()=>{Fe.preview.ready&&(C.pause(),C.currentTime=Fe.preview.start,S.textContent="\u25b6")},Lt=()=>{Fe.preview.ready&&(C.currentTime=Fe.preview.start,C.play(),S.textContent="\u275a\u275a")},It=()=>{if(d.textContent="".concat(Fe.queue.length," item").concat(1===Fe.queue.length?"":"s"),f.textContent="Queue: ".concat(Fe.queue.length),dt(),s.innerHTML="",(()=>{const e=new Set(Fe.queue.map(e=>e.id));Array.from(Fe.queueSelection).forEach(t=>{e.has(t)||Fe.queueSelection.delete(t)})})(),!Fe.queue.length){const e=document.createElement("p");return e.className="empty",e.textContent="Queue is empty. Add links on the right.",void s.appendChild(e)}Fe.queue.forEach((e,t)=>{var n;const o=document.createElement("article");o.className="queue-item ".concat(e.status);const a=Fe.queueSelection.has(e.id),i=e.platform?'<span class="platform-badge" style="--platform-color: '.concat(e.platform.color,'">').concat(e.platform.icon," ").concat(e.platform.name,"</span>"):"",r="downloading"===e.status;o.innerHTML='\n      <div class="slot-head">\n        <div>\n          <div class="slot-meta">\n            <label class="slot-select">\n              <input type="checkbox" data-select '.concat(a?"checked":"",' />\n              <span class="slot-index">#').concat(String(t+1).padStart(2,"0"),'</span>\n            </label>\n            <div>\n              <div class="slot-url-row">\n                <p class="slot-url">').concat(e.url,"</p>\n                ").concat(i,'\n              </div>\n              <p class="slot-status">').concat("pending"===e.status?"Waiting":"downloading"===e.status?"Processing":"complete"===e.status?"Done":"cancelled"===e.status?"Cancelled":"Error",'</p>\n            </div>\n          </div>\n        </div>\n        <div class="slot-actions">\n          ').concat(r?'<button class="ghost ghost-danger" data-cancel title="Cancel download">\u2715</button>':"",'\n          <button class="ghost ghost-icon" data-move="-1" title="Move up">\u2191</button>\n          <button class="ghost ghost-icon" data-move="1" title="Move down">\u2193</button>\n          <button class="ghost ghost-danger" data-delete title="Delete from queue">\ud83d\uddd1</button>\n          <button class="premium-download-btn export-btn" title="Export & Save">\n            <span class="download-icon">\u2b07</span>\n            <span class="download-glow"></span>\n          </button>\n        </div>\n      </div>\n      <div class="slot-progress">\n        <div class="progress-bar" style="--progress:').concat(Math.min(100,e.percent||0).toFixed(1),'%">\n          <span></span>\n        </div>\n        <p class="slot-metrics">').concat((null===(n=e.percent)||void 0===n?void 0:n.toFixed(1))||0,"% \xb7 ").concat(e.speed||"Pending"," \xb7 ETA ").concat(e.eta||"--:--","</p>\n      </div>\n    "),o.addEventListener("click",t=>{t.target.closest(".slot-actions")||ht(e)});const l=o.querySelector("[data-select]");l.addEventListener("click",e=>e.stopPropagation()),l.addEventListener("change",()=>{l.checked?Fe.queueSelection.add(e.id):Fe.queueSelection.delete(e.id),dt()}),o.querySelector(".export-btn").addEventListener("click",t=>{t.stopPropagation(),Ft([e])});const d=o.querySelector("[data-cancel]");d&&d.addEventListener("click",async t=>{t.stopPropagation();try{const t=await window.downloader.cancelDownload(e.url);t.success?gt("Cancelled download: ".concat(e.url)):gt("Could not cancel: ".concat(t.message||"Unknown error"))}catch(n){console.error("[Cancel error]",n),gt("Failed to cancel download")}}),o.querySelectorAll("[data-move]").forEach(t=>{t.addEventListener("click",n=>{n.stopPropagation(),St(e.id,Number(t.dataset.move))})});const c=o.querySelector("[data-delete]");if(c&&c.addEventListener("click",t=>{t.stopPropagation(),Bt(e.id)}),"complete"===e.status&&Array.isArray(e.files)&&e.files.length){const t=rt(e);t.addEventListener("click",async e=>{const t=e.target.closest("button[data-action]");if(!t)return;e.stopPropagation();const n=t.dataset.action,o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!e)return"";try{return decodeURIComponent(e)}catch(t){return console.warn("Unable to decode dataset path",t),e}}(t.dataset.path||"");var a;if(o)if("reveal"===n)await(null===(a=window.systemDialogs)||void 0===a?void 0:a.revealFile(o));else if("copy"===n){const e=await it(o);gt(e?"Copied file path to clipboard.":"Unable to copy path automatically.")}}),o.appendChild(t)}s.appendChild(o)})},St=(e,t)=>{const n=Fe.queue.findIndex(t=>t.id===e);if(-1===n)return;const o=n+t;if(o<0||o>=Fe.queue.length)return;const[a]=Fe.queue.splice(n,1);Fe.queue.splice(o,0,a),It(),gt("Reordered queue item ".concat(a.url))},Bt=e=>{const t=Fe.queue.findIndex(t=>t.id===e);if(-1===t)return;const n=Fe.queue[t];Fe.preview.url===n.url&&(Et("Preview cleared. Paste a new link to restart the flow."),st("Video removed from player")),"complete"!==n.status||n.exported||Jt(n.url,"retry"),Fe.queue.splice(t,1),Fe.queueSelection.delete(e),It(),dt(),gt("Deleted: ".concat(n.url))},qt=e=>{Fe.busy=e,ct()},Pt=()=>{console.log("[Queue] queueLinks called");const e=ut();if(console.log("[Queue] Parsed URLs:",e),!e.length)return gt("No links detected."),0;const t=vt(e);return console.log("[Queue] Added",t,"items to queue"),r.value="",gt("Queued ".concat(t," link").concat(1===t?"":"s",".")),t>0&&(ge("queue"),Dt()),t},Mt=async()=>{console.log("[Download] onDownload called");const e=(()=>{const e=Fe.queue.filter(e=>"pending"===e.status||"error"===e.status).map(e=>e.url);if(e.length)return e;const t=ut();return t.length&&(vt(t),r.value="",ge("queue")),t})();if(console.log("[Download] Collected URLs:",e),e.length){if(!window.downloader||!window.downloader.startDownload)return console.error("[Download] window.downloader not available!"),void gt("\u26a0 Download system not ready. Please restart the app.");try{qt(!0),ct(),gt("\ud83d\ude80 Starting ".concat(e.length," job(s) in preset ").concat(i[Fe.format],".")),console.log("[Download] Calling window.downloader.startDownload with:",{urls:e,format:Fe.format,destination:Fe.destination});const t=await window.downloader.startDownload({urls:e,format:Fe.format,destination:Fe.destination||void 0});console.log("[Download] Result:",t),null!==t&&void 0!==t&&t.outputDir&&(e=>{Fe.destination=e||"",ot();try{var t;null===(t=window.localStorage)||void 0===t||t.setItem(De,Fe.destination)}catch(n){console.warn("Unable to persist destination",n)}})(t.outputDir),gt("\u2714 Download complete. ".concat(e.length," file").concat(1===e.length?"":"s"," ready. Click Export to save."))}catch(t){console.error("[Download error]",t),gt("\u26a0 ".concat((null===t||void 0===t?void 0:t.message)||"Download failed. Check your connection and try again."))}finally{qt(!1),ct(),Dt()}}else gt("Add at least one link before downloading.")},Dt=()=>{if(!Fe.autoRun||Fe.busy)return;Fe.queue.some(e=>"pending"===e.status||"error"===e.status)&&Mt()},At=()=>{Fe.exportId=null,Fe.exportContext.targets=[],we.classList.remove("open"),we.setAttribute("aria-hidden","true"),document.body.classList.remove("exporting"),nt("Choose resolution and format for export."),be.disabled=!1,be.textContent=Pe,be.style.background=""},Rt=()=>{if("video"===Fe.exportContext.type){const e=Fe.exportContext.resolutions;qe.innerHTML=e.length?e.map(e=>'<option value="'.concat(e.id,'">').concat(e.label,"</option>")).join(""):"<option>No video formats available</option>",Fe.exportContext.selectedResolution=e[0]||null}else{const e=Fe.exportContext.audioFormats;qe.innerHTML=e.length?e.map(e=>'<option value="'.concat(e.id,'">').concat(e.label,"</option>")).join(""):"<option>No audio formats available</option>",Fe.exportContext.selectedResolution=e[0]||null}},Tt=e=>{const t=(e=>{const t=e.filter(e=>e.height&&e.vcodec&&"none"!==e.vcodec),n=new Map;return t.forEach(e=>{const t="".concat(e.height,"p");(!n.has(t)||(n.get(t).tbr||0)<(e.tbr||0))&&n.set(t,{id:e.id,height:e.height,label:"".concat(e.height,"p").concat(e.fps?" (".concat(e.fps,"fps)"):""),container:e.container||"mp4",vcodec:e.vcodec,acodec:e.acodec,tbr:e.tbr})}),Array.from(n.values()).sort((e,t)=>t.height-e.height)})(e),n=(e=>{const t=e.filter(e=>e.acodec&&"none"!==e.acodec&&(!e.vcodec||"none"===e.vcodec)),n=new Map;return t.forEach(e=>{const t=Math.floor(e.abr||128);(!n.has(t)||(n.get(t).abr||0)<(e.abr||0))&&n.set(t,{id:e.id,label:"".concat(Math.floor(e.abr||128),"kbps"),container:e.container||"mp3",acodec:e.acodec,abr:e.abr})}),Array.from(n.values()).sort((e,t)=>(t.abr||0)-(e.abr||0))})(e);Fe.exportContext.resolutions=t,Fe.exportContext.audioFormats=n,Rt();const o="video"===Fe.exportContext.type?["mp4","mkv","avi","webm"]:["mp3","m4a","ogg","wav"];xe.innerHTML=o.map(e=>'<option value="'.concat(e,'">').concat(e.toUpperCase(),"</option>")).join(""),Fe.exportContext.selectedFormat=o[0],nt("Ready to export.")},Ft=async function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter(e=>"complete"===e.status);if(!e.length)return void gt("Only completed downloads can be exported.");var t;document.body.classList.add("exporting"),nt("Preparing export options",{loading:!0}),Fe.exportContext.targets=e,Fe.exportContext.type="video",Be.value="video",ye.textContent=1===(t=e).length?t[0].url:"".concat(t.length," items selected"),we.classList.add("open"),we.setAttribute("aria-hidden","false");const n=e[0].url,o=Me.get(n);if(o)Nt(o),nt("Ready to export.");else{nt("Analyzing media formats",{loading:!0}),be.disabled=!0,xe.disabled=!0,qe.disabled=!0;try{const e=await window.downloader.probeFormats(n);Me.set(n,e),Nt(e),nt("Ready to export.")}catch(a){console.error(a),nt((null===a||void 0===a?void 0:a.message)||"Unable to fetch stream metadata.",{variant:"error"})}}},Nt=e=>{const t=(e.formats||[]).map(e=>({id:e.id,container:e.container||"mp4",note:e.note,height:e.height,fps:e.fps,vcodec:e.vcodec,acodec:e.acodec,abr:e.abr,tbr:e.tbr,filesize:e.filesize}));Fe.exportContext.formats=t,Tt(t),be.disabled=!1,xe.disabled=!1,qe.disabled=!1,nt("Ready to export.")},Ht=()=>{C.addEventListener("loadedmetadata",()=>{var e;e=C.duration||0,Fe.preview.duration=e,Fe.preview.start=0,Fe.preview.end=e,M.max=e,D.max=e,M.value=0,D.value=e,A.textContent=lt(0),R.textContent=lt(e),T.textContent=lt(e),N&&(N.textContent=lt(0)),H&&(H.textContent=lt(e)),Fe.preview.ready=!0,xt(),S.textContent="\u25b6",Fe.preview.ready=!0,(()=>{const e=C.videoWidth,t=C.videoHeight,n=e/t;k.classList.remove("video-horizontal","video-vertical","video-shorts");let o="Unknown";t>e?n<.6?(o="9:16 Shorts",k.classList.add("video-shorts")):(o="Vertical",k.classList.add("video-vertical")):(o=n>=1.7?"16:9 HD":n>=1.3?"4:3 Standard":"Square",k.classList.add("video-horizontal")),P.textContent="".concat(o," \xb7 ").concat(e,"\xd7").concat(t),console.log("[Preview] Format: ".concat(o," (").concat(e,"\xd7").concat(t,", ratio: ").concat(n.toFixed(2),")"))})(),Qe(),(e=>{if(!W||!e)return;const t=[];for(let n=0;n<5;n++){const o=n/4*e;t.push("<span>".concat(lt(o),"</span>"))}W.innerHTML=t.join("")})(C.duration),st("Preview ready: ".concat(Math.round(C.duration),"s")),ge("preview"),console.log("[Preview] Loaded successfully, duration:",C.duration)}),C.addEventListener("timeupdate",()=>{if(Fe.preview.ready&&C.duration){const e=C.currentTime;if(N&&(N.textContent=lt(e)),O){const t=e/C.duration*100;O.style.left="".concat(t,"%"),O.classList.add("active")}e>=Fe.preview.end&&(C.pause(),C.currentTime=Fe.preview.start,S.textContent="\u25b6")}}),C.addEventListener("play",()=>{S.textContent="\u23f8"}),C.addEventListener("pause",()=>{S.textContent="\u25b6"}),C.addEventListener("error",e=>{console.error("[Preview] Error loading video:",e),console.error("[Preview] Error details:",C.error);const t=C.error?"Video error: ".concat(C.error.message||"Could not load file"):"Failed to load video";st(t),Et("Video reset. Load another link to keep going.")}),C.addEventListener("canplay",()=>{console.log("[Preview] Video can play")}),U&&j&&(U.addEventListener("mousemove",e=>{if(!Fe.preview.ready||!C.duration)return;const t=U.getBoundingClientRect(),n=(e.clientX-t.left)/t.width*100,o=n/100*C.duration;j.textContent=lt(o),j.style.left="".concat(n,"%"),j.classList.add("visible")}),U.addEventListener("mouseleave",()=>{j.classList.remove("visible")})),S.addEventListener("click",Ct),B.addEventListener("click",kt),q.addEventListener("click",Lt);let e=null;const t=t=>{if(!Fe.preview.ready)return;const n=t.currentTarget.getBoundingClientRect(),o=(t.clientX-n.left)/n.width*100/100*Fe.preview.duration,a=Math.abs(Fe.preview.start-o),i=Math.abs(Fe.preview.end-o),r=30/n.width*Fe.preview.duration;if(a<r&&a<i)M.value=o,e="start";else if(i<r)D.value=o,e="end";else{const e=Fe.preview.start,t=Fe.preview.end;o>=e&&o<=t&&(C.currentTime=o,console.log("[Timeline] Seek to ".concat(o.toFixed(2),"s within trim range")))}wt()},n=document.querySelector(".trim-timeline");if(n){n.addEventListener("click",t);let o=!1;n.addEventListener("mousedown",e=>{(e.target.classList.contains("trim-track")||e.target.classList.contains("trim-range-fill"))&&(t(e),o=!0)}),n.addEventListener("mousemove",t=>{if(!o||!e)return;const a=n.getBoundingClientRect(),i=t.clientX-a.left,r=Math.max(0,Math.min(100,i/a.width*100))/100*Fe.preview.duration;"start"===e?M.value=r:D.value=r,wt()}),document.addEventListener("mouseup",()=>{o=!1,e=null})}M.addEventListener("input",wt),D.addEventListener("input",wt)},jt=e=>{switch(e){case"set-destination":chooseDestinationFolder();break;case"open-destination":(()=>{var e;null===(e=window.systemDialogs)||void 0===e||e.openFolder(Fe.destination||null)})();break;case"check-updates":Ot()}},Ot=async()=>{const e="v1.0.0",t="WH404 - YT Downloader 1.0";gt("Checking for updates..."),window.alert("".concat(t,"\n\nCurrent version: 1.0.0\n\nChecking GitHub for updates..."));try{const n=await fetch("https://api.github.com/repos/Pramsss108/word-hacker-404/releases/latest"),o=await n.json(),a=o.tag_name||o.name||"v1.0.0";gt("Latest version: ".concat(a)),a===e?window.alert("".concat(t,"\n\n\u2705 You're up to date!\n\nCurrent: ").concat(e,"\nLatest: ").concat(a)):window.alert("".concat(t,"\n\n\ud83c\udd95 Update available!\n\nCurrent: ").concat(e,"\nLatest: ").concat(a,"\n\nDownload: https://github.com/Pramsss108/word-hacker-404/releases"))}catch(n){gt("Failed to check for updates. Please visit GitHub manually."),window.alert("".concat(t,"\n\nCurrent version: 1.0.0\n\n\u26a0\ufe0f Could not check for updates.\n\nVisit: https://github.com/Pramsss108/word-hacker-404/releases"))}},Ut=()=>{var e;E.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation(),(e=>{if(!e)return;const t=document.getElementById("".concat(e,"-menu"));if(!t)return;const n=t.classList.contains("open");at(),n||t.classList.add("open")})(e.dataset.menuTrigger)})}),null===h||void 0===h||h.addEventListener("click",e=>{const t=e.target.closest("[data-menu-action]");t&&(e.stopPropagation(),at(),jt(t.dataset.menuAction))});const t=document.getElementById("about-menu");null===t||void 0===t||t.addEventListener("click",e=>{const t=e.target.closest("[data-menu-action]");t&&(e.stopPropagation(),at(),jt(t.dataset.menuAction))});const n=document.getElementById("help-menu");null===n||void 0===n||n.addEventListener("click",e=>{const t=e.target.closest("[data-menu-action]");t&&(e.stopPropagation(),at(),jt(t.dataset.menuAction))}),document.addEventListener("click",e=>{e.target.closest(".menu-group")||at()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&(at(),"insights"===Fe.previewMode&&Ze("video"))});const o=null===(e=window.localStorage)||void 0===e?void 0:e.getItem(De);o&&(Fe.destination=o),ot(),null===p||void 0===p||p.addEventListener("change",()=>{p.checked?Fe.queue.forEach(e=>Fe.queueSelection.add(e.id)):Fe.queueSelection.clear(),dt(),It()}),null===m||void 0===m||m.addEventListener("click",()=>{Fe.queueSelection.clear(),dt(),It()});null===v||void 0===v||v.addEventListener("click",()=>{const e=Fe.queue.filter(e=>Fe.queueSelection.has(e.id)&&"complete"===e.status);e.length?Ft(e):gt("Select completed items before exporting.")}),null===g||void 0===g||g.addEventListener("click",()=>{const e=Fe.queue.filter(e=>"complete"===e.status);e.length?Ft(e):gt("Finish at least one download before exporting all.")}),null===u||void 0===u||u.addEventListener("click",()=>{Fe.queue=[],Fe.queueSelection.clear(),It(),gt("Cleared queue.")}),null===l||void 0===l||l.addEventListener("click",()=>{console.log("[Button] Add to Queue clicked"),r.value.trim().length?Pt():gt("Please paste a link first.")}),null===r||void 0===r||r.addEventListener("keydown",e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),console.log("[Keyboard] Enter pressed"),r.value.trim().length&&Pt())});const a=()=>{r&&r.value.trim().length&&ge("paste")};null===r||void 0===r||r.addEventListener("input",a),null===r||void 0===r||r.addEventListener("paste",a),document.querySelectorAll("[data-window]").forEach(e=>{e.addEventListener("click",()=>{var t;null===(t=window.windowControls)||void 0===t||t.control(e.dataset.window)})});const i=document.querySelector("[data-pin]");null===i||void 0===i||i.addEventListener("click",async()=>{var e;const t=await(null===(e=window.windowControls)||void 0===e?void 0:e.togglePin());"boolean"===typeof t&&i.classList.toggle("active",t)}),G.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.openPanel;Ge(t,e),Ze("insights")})}),null===V||void 0===V||V.addEventListener("click",()=>Ze("video")),null===K||void 0===K||K.addEventListener("click",()=>Ze("video")),window.addEventListener("resize",()=>{if("insights"!==Fe.previewMode)return;const e=Te||_[Fe.preview.activePanel];e&&Ke(e)}),document.querySelectorAll("[data-premium-copy]").forEach(e=>{e.addEventListener("click",()=>(async e=>{let t="";if("thumbnail"===e?t=Fe.preview.metadata.thumbnail:"keywords"===e?t=(Fe.preview.metadata.keywords||[]).join(", "):"title"===e?t=Fe.preview.metadata.title:"description"===e&&(t=Fe.preview.metadata.description),!t)return void Ue("Nothing to copy yet.","error");await it(t)?Ue("Copied to clipboard!","success"):Ue("Unable to copy right now.","error")})(e.dataset.premiumCopy))}),document.querySelectorAll("[data-premium-download]").forEach(e=>{e.addEventListener("click",()=>{Fe.preview.metadata.thumbnail?(!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"wordhacker-asset";if(!e)return!1;const n=document.createElement("a");n.href=e,n.download=t,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n)}(Fe.preview.metadata.thumbnail,"wh404-thumbnail.jpg"),Ue("Downloading thumbnail...","success")):Ue("Thumbnail not ready yet.","error")})}),document.querySelectorAll("[data-export-copy]").forEach(e=>{e.addEventListener("click",()=>(async e=>{if("thumbnail"===e){const e=await it(Fe.preview.metadata.thumbnail||"");return void Ue(e?"Thumbnail link copied.":"Nothing to copy yet.",e?"success":"error")}if("keywords"===e){const e=await it((Fe.preview.metadata.keywords||[]).join(", "));return void Ue(e?"Keywords copied.":"Nothing to copy yet.",e?"success":"error")}if("story"===e){const e="".concat(Fe.preview.metadata.title||"","\n\n").concat(Fe.preview.metadata.description||"").trim(),t=await it(e);Ue(t?"Title & description copied.":"Nothing to copy yet.",t?"success":"error")}})(e.dataset.exportCopy))}),fe.addEventListener("click",async()=>{var e;const t=await(null===(e=window.systemDialogs)||void 0===e?void 0:e.chooseFolder());t&&(Ie.value=t)}),be.addEventListener("click",async()=>{const e=Fe.exportContext.targets;if(!e.length)return void nt("No items to export.",{variant:"error"});const t=[];if(e.forEach(e=>{e.files&&e.files.length&&t.push(...e.files)}),t.length)try{var n;be.disabled=!0,be.textContent="Processing...",be.style.opacity="0.7",nt("Starting export",{loading:!0});let o=0;activeHeartbeat=setInterval(()=>{o++,nt(o%2===0?"Processing files":"Converting media",{loading:!0})},800);const a=Ie.value||Fe.destination||void 0,i=xe.value||"mp4";let r=null,l=t;Fe.preview.ready&&(Fe.preview.start>0||Fe.preview.end<Fe.preview.duration)&&(Fe.preview.trimmedFile?(console.log("[Export] Using pre-processed trim file"),l=[Fe.preview.trimmedFile],r=null):(console.log("[Export] Processing trim in real-time"),r={start:Fe.preview.start,end:Fe.preview.end}));const s=(()=>{var e;const t={};return Fe.preview.premium.thumbnail&&Fe.preview.metadata.thumbnail&&(t.thumbnail=Fe.preview.metadata.thumbnail),Fe.preview.premium.seo&&null!==(e=Fe.preview.metadata.keywords)&&void 0!==e&&e.length&&(t.keywords=Fe.preview.metadata.keywords),Fe.preview.premium.story&&(Fe.preview.metadata.title&&(t.title=Fe.preview.metadata.title),Fe.preview.metadata.description&&(t.description=Fe.preview.metadata.description)),Object.keys(t).length?t:null})(),d={files:l,destination:a,outputFormat:i,trim:r};s&&(d.metadata=s);const c=await(null===(n=window.systemDialogs)||void 0===n?void 0:n.exportFiles(d));activeHeartbeat&&(clearInterval(activeHeartbeat),activeHeartbeat=null),c&&c.exported&&(gt("\u2714 Exported ".concat(c.exported.length," file").concat(1===c.exported.length?"":"s"," to ").concat(c.outputDir)),nt("\u2713 Saved ".concat(c.exported.length," file").concat(1===c.exported.length?"":"s","!"),{variant:"success"}),be.textContent="\u2713 Done",be.style.background="var(--highlight)",be.style.opacity="1",e.forEach(e=>{e.exported=!0,e.exportedFiles=c.exported,Jt(e.url,"exported")}),It(),setTimeout(()=>{At()},1800))}catch(o){activeHeartbeat&&(clearInterval(activeHeartbeat),activeHeartbeat=null),console.error(o),nt("Export failed: ".concat((null===o||void 0===o?void 0:o.message)||"Unknown error"),{variant:"error"}),gt("\u26a0 Export failed: ".concat((null===o||void 0===o?void 0:o.message)||"Unknown error")),be.style.opacity="1"}finally{we.classList.contains("open")&&(null!==Ee&&void 0!==Ee&&Ee.classList.contains("success")||(be.disabled=!1,be.textContent=Pe,be.style.background=""))}else nt("No files available to export.",{variant:"error"})}),Be.addEventListener("change",()=>{Fe.exportContext.type=Be.value,Rt();const e="video"===Be.value?["mp4","mkv","avi","webm"]:["mp3","m4a","ogg","wav"];xe.innerHTML=e.map(e=>'<option value="'.concat(e,'">').concat(e.toUpperCase(),"</option>")).join(""),Fe.exportContext.selectedFormat=e[0]}),qe.addEventListener("change",()=>{const e=qe.value;"video"===Fe.exportContext.type?Fe.exportContext.selectedResolution=Fe.exportContext.resolutions.find(t=>t.id===e):Fe.exportContext.selectedResolution=Fe.exportContext.audioFormats.find(t=>t.id===e)}),xe.addEventListener("change",()=>{Fe.exportContext.selectedFormat=xe.value}),we.addEventListener("click",e=>{e.target===we&&At()}),Se.addEventListener("click",At),Ht()},Wt="wh404:download:history",Qt={exported:{icon:"\ud83d\udcc1",label:"Saved to folder",className:"history-status--exported"},retry:{icon:"\u21ba",label:"Retry export",className:"history-status--retry"},downloaded:{icon:"\u27f3",label:"Process pending",className:"history-status--pending"}},zt=()=>{try{const e=localStorage.getItem(Wt);return e?JSON.parse(e):[]}catch(e){return console.error("[History] Failed to load:",e),[]}},Jt=(e,t)=>{try{const n=zt(),o=n.findIndex(t=>t.url===e);if(-1===o)return;n[o].status=t,localStorage.setItem(Wt,JSON.stringify(n)),Vt()}catch(n){console.error("[History] Failed to update status:",n)}},Vt=()=>{const e=document.getElementById("history-list");if(!e)return;const t=zt();0!==t.length?(e.innerHTML=t.map(e=>{const t=function(){return Qt[arguments.length>0&&void 0!==arguments[0]?arguments[0]:"downloaded"]||Qt.downloaded}(e.status);return'\n      <div class="history-item" data-url="'.concat(e.url,'">\n        <div class="history-item-header">\n          <div class="history-item-meta">\n            <span class="history-platform">').concat(e.platform,'</span>\n            <span class="history-date">').concat(Kt(e.timestamp),'</span>\n          </div>\n          <div class="history-status ').concat(t.className,'" title="').concat(t.label,'">\n            <span class="history-status-icon">').concat(t.icon,'</span>\n            <span class="history-status-text">').concat(t.label,'</span>\n          </div>\n        </div>\n        <div class="history-url">').concat(e.url,'</div>\n        <div class="history-filename">').concat(e.filename,"</div>\n      </div>\n    ")}).join(""),e.querySelectorAll(".history-item").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.url,n=document.getElementById("url-input");n&&(n.value=t,n.focus(),ge("paste"),gt("Loaded from history: "+t)),document.getElementById("history-dropdown").classList.remove("open")})})):e.innerHTML='<p class="history-empty">No download history yet</p>'},Kt=e=>{const t=Date.now()-e,n=Math.floor(t/1e3),o=Math.floor(n/60),a=Math.floor(o/60),i=Math.floor(a/24);return n<60?"Just now":o<60?"".concat(o,"m ago"):a<24?"".concat(a,"h ago"):i<7?"".concat(i,"d ago"):new Date(e).toLocaleDateString()},Gt=()=>{console.log("[IPC] Binding IPC handlers..."),window.downloader.onStatus(function(){Ae="offline"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).network,ct()}),window.downloader.onJobStart(e=>{let{url:t}=e;console.log("[IPC] Job started:",t);const n=mt(t);n.status="downloading",n.percent=0,n.speed="Connecting...",n.eta="Please wait",qt(!0),ct(),It(),gt("\u25b6 Connecting to server: ".concat(t))}),console.log("[IPC] Registering onProgress handler..."),window.downloader.onProgress(e=>{let{url:t,percent:n,speed:o,eta:a}=e;console.log("[RENDERER\u2190MAIN] Received progress:",{url:t,percent:n,speed:o,eta:a});const i=Fe.queue.find(e=>e.url===t);i?(i.status="downloading",i.percent=n,i.speed=o,i.eta=a,console.log("[RENDERER] Updated item:",{id:i.id,percent:i.percent,speed:i.speed}),It()):console.warn("[RENDERER] No queue item found for URL:",t)}),window.downloader.onJobComplete(e=>{let{url:t,files:n,tempDir:o}=e;const a=Fe.queue.find(e=>e.url===t);if(a){var i,r;a.status="complete",a.percent=100,a.speed="0 MB/s",a.eta="00:00",a.files=n||[],a.tempDir=o;const e=n&&n.length>0?n[0].split(/[/\\]/).pop():"download",l=a.platform?a.platform.name:"Unknown";!function(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"downloaded";try{const a=zt(),i={url:e,platform:t||"Unknown",filename:n||"download",timestamp:Date.now(),date:(new Date).toLocaleString(),status:o},r=a.filter(t=>t.url!==e);r.unshift(i);const l=r.slice(0,50);localStorage.setItem(Wt,JSON.stringify(l)),Vt()}catch(a){console.error("[History] Failed to save:",a)}}(t,l,e),ge("download"),null===(i=window.tutorial)||void 0===i||null===(r=i.triggerAfterFirstDownload)||void 0===r||r.call(i),console.log("[Download Complete]",{url:t,files:n,tempDir:o}),1===Fe.queue.filter(e=>"complete"===e.status).length&&setTimeout(()=>ht(a),500),console.log("[Metadata] Pre-fetching formats for:",t),window.downloader.probeFormats(t).then(e=>{console.log("[Metadata] Cached:",t),Me.set(t,e)}).catch(e=>console.warn("[Metadata] Background probe failed:",e))}It(),gt("\u2714 Downloaded ".concat(t," - ready to export"))}),window.downloader.onJobError(e=>{let{url:t,message:n}=e;console.error("[Job Error]",{url:t,message:n});const o=mt(t);o.status="error",o.speed="Failed",o.eta="Retry",It(),gt("\u26a0 Error: ".concat(n||"Download failed"));Fe.queue.some(e=>"downloading"===e.status||"pending"===e.status)||(qt(!1),ct())}),window.downloader.onJobCancelled(e=>{let{url:t}=e;console.log("[Job Cancelled]",t);const n=mt(t);n.status="cancelled",n.speed="Cancelled",n.eta="--:--",n.percent=0,It(),gt("\ud83d\udeab Cancelled: ".concat(t));Fe.queue.some(e=>"downloading"===e.status||"pending"===e.status)||(qt(!1),ct())});let e=0,t=null;window.downloader.onExportProgress(n=>{let{file:o,percent:a,status:i}=n;if(!we.classList.contains("open"))return;t&&a>0&&(clearInterval(t),t=null);const r=Date.now();if(r-e<500&&a<100)return;e=r;const l=Math.min(100,Math.max(0,Math.round(null!==a&&void 0!==a?a:0))),s=o.length>25?o.slice(0,22)+"...":o;nt("Converting ".concat(s),{loading:!0}),be.textContent="".concat(l,"%"),be.style.background="linear-gradient(90deg, var(--highlight) ".concat(l,"%, rgba(255, 255, 255, 0.08) ").concat(l,"%)"),be.style.opacity="1"})};console.log("[Startup] Initializing renderer...");try{Ut(),console.log("[Startup] Events wired")}catch(Xt){console.error("[Startup] wireEvents failed:",Xt)}try{Gt(),console.log("[Startup] IPC bound")}catch(Xt){console.error("[Startup] bindIpc failed:",Xt)}try{It(),console.log("[Startup] Queue rendered")}catch(Xt){console.error("[Startup] renderQueue failed:",Xt)}try{b.textContent="Preset: ".concat(i[Fe.format]||Fe.format),console.log("[Startup] Preset chip updated")}catch(Xt){console.error("[Startup] updatePresetChip failed:",Xt)}try{ct(),console.log("[Startup] Engine chip updated")}catch(Xt){console.error("[Startup] updateEngineChip failed:",Xt)}try{(()=>{const e=document.getElementById("history-toggle"),t=document.getElementById("history-dropdown"),n=document.getElementById("history-clear-all");e&&t&&(e.addEventListener("click",e=>{e.stopPropagation(),t.classList.toggle("open"),t.classList.contains("open")&&Vt()}),document.addEventListener("click",n=>{t.contains(n.target)||n.target===e||t.classList.remove("open")}),n&&n.addEventListener("click",()=>{confirm("Clear all download history?")&&(localStorage.removeItem(Wt),Vt(),gt("History cleared"))}),Vt())})(),console.log("[Startup] History dropdown initialized")}catch(Xt){console.error("[Startup] History init failed:",Xt)}setTimeout(()=>{console.log("[Startup] FORCING loading screen removal...");const e=document.getElementById("loading-screen"),t=document.querySelector(".window");e&&(e.style.display="none",e.remove()),t&&(t.style.opacity="1",t.style.visibility="visible"),console.log("[Startup] UI should be visible now!")},500),console.log("[Startup] Renderer initialized")})();
//# sourceMappingURL=main.223f8b71.js.map