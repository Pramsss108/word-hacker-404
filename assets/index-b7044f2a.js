var kG=Object.defineProperty;var TG=(n,e,t)=>e in n?kG(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var le=(n,e,t)=>(TG(n,typeof e!="symbol"?e+"":e,t),t);import{r as te,a as CG,g as VS,c as di,b as EG,R as _G}from"./vendor-e72fc605.js";import{A as ax,X as El,U as Vy,Z as uo,D as mp,C as lu,W as BS,P as NG,B as kv,L as uy,S as sa,a as IA,R as AG,b as By,c as L1,d as RG,e as $G,f as DG,M as PG,g as OG,E as FG,F as LG,G as SA,H as OP,h as MG,i as cu,j as zG,k as VG,l as FP,T as gf,m as uu,n as jy,o as M1,p as Uy,V as BG,q as jG,r as UG,s as WG,t as jS,u as LP,v as z1,w as GG,x as HG,y as qG,z as KG,I as XG,J as YG,K as QG,N as kA,O as TA,Q as Rg,Y as CA,_ as ZG,$ as JG,a0 as e6,a1 as t6,a2 as n6,a3 as s6}from"./utils-e8ee15a8.js";function r6(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();var MP={exports:{}},lx={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i6=te,o6=Symbol.for("react.element"),a6=Symbol.for("react.fragment"),l6=Object.prototype.hasOwnProperty,c6=i6.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u6={key:!0,ref:!0,__self:!0,__source:!0};function zP(n,e,t){var s,r={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)l6.call(e,s)&&!u6.hasOwnProperty(s)&&(r[s]=e[s]);if(n&&n.defaultProps)for(s in e=n.defaultProps,e)r[s]===void 0&&(r[s]=e[s]);return{$$typeof:o6,type:n,key:i,ref:o,props:r,_owner:c6.current}}lx.Fragment=a6;lx.jsx=zP;lx.jsxs=zP;MP.exports=lx;var x=MP.exports,V1={},EA=CG;V1.createRoot=EA.createRoot,V1.hydrateRoot=EA.hydrateRoot;function US({density:n=24,speed:e=2,opacity:t=.08}){const s=te.useRef(null),r=te.useRef(null);return te.useEffect(()=>{const i=s.current,o=i.getContext("2d");let a=!0,l=0,c=0,u=0,h=[];const d=["0","1"],p=window.matchMedia("(prefers-reduced-motion: reduce)").matches,f=()=>{l=i.parentElement?i.parentElement.clientWidth:window.innerWidth,c=i.parentElement?i.parentElement.clientHeight:window.innerHeight,i.width=l,i.height=c;const y=14;u=Math.max(10,Math.floor(l/1e3*n));const w=Math.max(y,Math.floor(l/u));u=Math.floor(l/w),h=Array.from({length:u},()=>Math.floor(Math.random()*c)),o.font="12px 'JetBrains Mono', monospace"},g=()=>{if(a){o.fillStyle=`rgba(0, 0, 0, ${p?.2:.08})`,o.fillRect(0,0,l,c),o.fillStyle=`rgba(10,255,106, ${t})`;for(let y=0;y<h.length;y++){const w=y*(l/h.length),v=h[y],I=d[Math.random()>.5?1:0];o.fillText(I,w,v),h[y]=v+(p?e*.4:e+Math.random()*2),h[y]>c&&(h[y]=0)}r.current=requestAnimationFrame(g)}},m=()=>{document.hidden?(a=!1,r.current&&cancelAnimationFrame(r.current)):(a=!0,r.current=requestAnimationFrame(g))};return f(),r.current=requestAnimationFrame(g),window.addEventListener("resize",f),document.addEventListener("visibilitychange",m),()=>{a=!1,r.current&&cancelAnimationFrame(r.current),window.removeEventListener("resize",f),document.removeEventListener("visibilitychange",m)}},[n,e,t]),x.jsx("canvas",{ref:s,className:"matrix-canvas","aria-hidden":!0})}class h6{constructor(e){le(this,"wasmModule",null);le(this,"wasmMemory",null);le(this,"inputPtr",0);le(this,"outputPtr",0);le(this,"size");this.size=e}async initialize(){var e;try{if(!this.isWASMSupported())return console.warn("WASM not supported, falling back to JavaScript"),!1;const t=this.generateFFTWASMModule(),s=await WebAssembly.instantiate(t);return this.wasmModule=((e=s.instance)==null?void 0:e.exports)||s,this.wasmMemory=this.wasmModule.memory,this.inputPtr=this.wasmModule.malloc(this.size*4),this.outputPtr=this.wasmModule.malloc(this.size*4),!0}catch(t){return console.warn("WASM initialization failed:",t),!1}}process(e,t){if(!this.wasmModule||!this.wasmMemory)throw new Error("WASM module not initialized");new Float32Array(this.wasmMemory.buffer,this.inputPtr,this.size).set(e),this.wasmModule.processFFT(this.inputPtr,this.outputPtr,this.size);const r=new Float32Array(this.wasmMemory.buffer,this.outputPtr,this.size);t.set(r)}dispose(){this.wasmModule&&(this.inputPtr&&this.wasmModule.free(this.inputPtr),this.outputPtr&&this.wasmModule.free(this.outputPtr),this.wasmModule=null,this.wasmMemory=null)}isWASMSupported(){return typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"}generateFFTWASMModule(){return new Uint8Array([0,97,115,109,1,0,0,0])}}class _A{constructor(e){le(this,"size");le(this,"cos",new Float32Array(0));le(this,"sin",new Float32Array(0));this.size=e,this.precomputeTwiddles()}process(e,t){this.fft(e,t)}dispose(){}precomputeTwiddles(){this.cos=new Float32Array(this.size),this.sin=new Float32Array(this.size);for(let e=0;e<this.size;e++){const t=-2*Math.PI*e/this.size;this.cos[e]=Math.cos(t),this.sin[e]=Math.sin(t)}}fft(e,t){const s=this.size;for(let r=0;r<s;r++)t[r]=e[this.reverseBits(r,Math.log2(s))];for(let r=2;r<=s;r<<=1){const i=2*Math.PI/r;for(let o=0;o<s;o+=r)for(let a=0;a<r/2;a++){const l=t[o+a],c=t[o+a+r/2]*Math.cos(i*a)-t[o+a+r/2]*Math.sin(i*a);t[o+a]=l+c,t[o+a+r/2]=l-c}}}reverseBits(e,t){let s=0;for(let r=0;r<t;r++)s=s<<1|e&1,e>>=1;return s}}class d6{constructor(e){le(this,"config");le(this,"processors",new Map);le(this,"wasmSupported",!1);this.config=e,this.wasmSupported=this.checkWASMSupport()}async initialize(){if(!this.config.enableWASM||!this.wasmSupported){console.log("Using JavaScript fallback for audio processing");return}try{const e=new h6(2048);await e.initialize()?(this.processors.set("fft",e),console.log("WASM FFT processor initialized")):(this.processors.set("fft",new _A(2048)),console.log("FFT processor using JavaScript fallback"))}catch(e){console.warn("WASM initialization error:",e),this.initializeJSFallbacks()}}getProcessor(e){return this.processors.get(e)||null}isWASMEnabled(){return this.config.enableWASM&&this.wasmSupported}getPerformanceStats(){return{wasmEnabled:this.isWASMEnabled(),processorsActive:this.processors.size,memoryUsage:this.estimateMemoryUsage()}}dispose(){for(const e of this.processors.values())e.dispose();this.processors.clear()}checkWASMSupport(){try{return typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"&&typeof WebAssembly.Memory=="function"}catch{return!1}}initializeJSFallbacks(){this.processors.set("fft",new _A(2048)),console.log("All processors using JavaScript fallback")}estimateMemoryUsage(){return this.processors.size*2048*4}}class p6{constructor(e){le(this,"wasmCore");le(this,"bufferSize");this.wasmCore=new d6(e),this.bufferSize=e.blockSize}async initialize(){await this.wasmCore.initialize()}async processBuffer(e,t){const s=this.wasmCore.getProcessor(t);if(!s)throw new Error(`Processor ${t} not available`);const r=e.constructor.length>0?new e.constructor(e.numberOfChannels,e.length,e.sampleRate):e;for(let i=0;i<e.numberOfChannels;i++){const o=e.getChannelData(i),a=r.getChannelData(i);for(let l=0;l<o.length;l+=this.bufferSize){const c=Math.min(this.bufferSize,o.length-l),u=o.subarray(l,l+c),h=a.subarray(l,l+c);s.process(u,h)}}return r}getPerformanceStats(){return this.wasmCore.getPerformanceStats()}dispose(){this.wasmCore.dispose()}}const f6={enableWASM:!0,fallbackToJS:!0,blockSize:2048,sampleRate:48e3,channels:2};let Tv=null;function VP(n=f6){return Tv||(Tv=new p6(n)),Tv}function m6(){const[n,e]=te.useState({wasmEnabled:!1,processorsActive:0,memoryUsage:0,avgProcessingTime:0,lastFrameTime:0}),[t,s]=te.useState(!1);return te.useEffect(()=>{let r,i=performance.now(),o=[];const a=()=>{const l=performance.now(),c=l-i;o.push(c),o.length>60&&o.shift();const h=VP().getPerformanceStats();e({wasmEnabled:h.wasmEnabled,processorsActive:h.processorsActive,memoryUsage:h.memoryUsage,avgProcessingTime:o.reduce((d,p)=>d+p,0)/o.length,lastFrameTime:c}),i=l,t&&(r=requestAnimationFrame(a))};return t&&a(),()=>{r&&cancelAnimationFrame(r)}},[t]),t?x.jsxs("div",{className:"performance-monitor",children:[x.jsxs("div",{className:"performance-header",children:[x.jsx("span",{className:"performance-title",children:"M4 Performance Monitor"}),x.jsx("button",{onClick:()=>s(!1),className:"performance-close","aria-label":"Close performance monitor",children:x.jsx("span",{className:"close-cross","aria-hidden":!0,children:"âœ•"})})]}),x.jsxs("div",{className:"performance-grid",children:[x.jsxs("div",{className:"stat-item",children:[x.jsx("span",{className:"stat-label",children:"Engine:"}),x.jsx("span",{className:`stat-value ${n.wasmEnabled?"wasm":"js"}`,children:n.wasmEnabled?"WASM":"JavaScript"})]}),x.jsxs("div",{className:"stat-item",children:[x.jsx("span",{className:"stat-label",children:"Processors:"}),x.jsx("span",{className:"stat-value",children:n.processorsActive})]}),x.jsxs("div",{className:"stat-item",children:[x.jsx("span",{className:"stat-label",children:"Memory:"}),x.jsxs("span",{className:"stat-value",children:[(n.memoryUsage/1024).toFixed(1),"KB"]})]}),x.jsxs("div",{className:"stat-item",children:[x.jsx("span",{className:"stat-label",children:"Avg Frame:"}),x.jsxs("span",{className:`stat-value ${n.avgProcessingTime>16.67?"warning":"good"}`,children:[n.avgProcessingTime.toFixed(1),"ms"]})]}),x.jsxs("div",{className:"stat-item",children:[x.jsx("span",{className:"stat-label",children:"Frame Rate:"}),x.jsxs("span",{className:`stat-value ${1e3/n.avgProcessingTime<30?"warning":"good"}`,children:[(1e3/n.avgProcessingTime).toFixed(0),"fps"]})]}),x.jsxs("div",{className:"stat-item",children:[x.jsx("span",{className:"stat-label",children:"Performance:"}),x.jsx("span",{className:`stat-value ${n.wasmEnabled?"excellent":"good"}`,children:n.wasmEnabled?"3x Faster":"Standard"})]})]})]}):x.jsx("button",{onClick:()=>s(!0),className:"performance-toggle",title:"Show M4 Performance Monitor",children:"ðŸ“Š M4 Stats"})}const g6="modulepreload",y6=function(n){return"/"+n},NA={},gp=function(e,t,s){if(!t||t.length===0)return e();const r=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=y6(i),i in NA)return;NA[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!s)for(let u=r.length-1;u>=0;u--){const h=r[u];if(h.href===i&&(!o||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":g6,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((u,h)=>{c.addEventListener("load",u),c.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},b6={pitchShift:-5,distortion:.4,reverbMix:.5,delayTime:.2,delayFeedback:.3,lowpassFreq:2e4,highpassFreq:100,aiEnhancement:.7,noiseReduction:.6,aiModelSize:"tiny",enableWASM:!0,wasmBlockSize:2048,enablePitchShift:!1,enableDistortion:!1,enableReverb:!1,enableDelay:!1,enableLowpass:!1,enableHighpass:!1,enableAIEnhancement:!0,enableNoiseReduction:!1,enableMastering:!0},Cv=new(window.AudioContext||window.webkitAudioContext),AA=async n=>{if(Cv.state==="suspended")try{await Cv.resume()}catch{}const e=await n.arrayBuffer();return await Cv.decodeAudioData(e)},x6=n=>{const e=n.numberOfChannels,t=n.length*e*2+44,s=new ArrayBuffer(t),r=new DataView(s),i=[];let o,a,l=0,c=0;for(h(1179011410),h(t-8),h(1163280727),h(544501094),h(16),u(1),u(e),h(n.sampleRate),h(n.sampleRate*2*e),u(e*2),u(16),h(1635017060),h(t-c-4),o=0;o<n.numberOfChannels;o++)i.push(n.getChannelData(o));for(;c<r.byteLength-44;){for(o=0;o<e;o++)a=Math.max(-1,Math.min(1,i[o][l])),a=(.5+a<0?a*32768:a*32767)|0,r.setInt16(44+c,a,!0),c+=2;l++}return new Blob([r],{type:"audio/wav"});function u(d){r.setUint16(c,d,!0),c+=2}function h(d){r.setUint32(c,d,!0),c+=4}};class w6{constructor(e=48e3){le(this,"sampleRate");le(this,"frameSize");le(this,"window");this.sampleRate=e,this.frameSize=2048,this.window=this.createHannWindow(this.frameSize)}analyzeVoiceProfile(e){const t=e.getChannelData(0),s=this.estimateFundamentalFrequency(t),r=this.extractFormants(t),i=this.computeSpectralCentroid(t),o=this.computeHarmonicRatio(t),a=this.classifyVoiceType(s,r);return{fundamentalFreq:s,formantFreqs:r,spectralCentroid:i,harmonicRatio:o,voiceType:a}}estimateFundamentalFrequency(e){const t=Math.floor(this.sampleRate/800),s=Math.floor(this.sampleRate/50);let r=0,i=t;for(let o=t;o<s;o++){let a=0,l=0;for(let c=0;c<e.length-o;c++)a+=e[c]*e[c+o],l++;a/=l,a>r&&(r=a,i=o)}return this.sampleRate/i}extractFormants(e){const t=this.computeFFT(e),s=this.computePowerSpectrum(t);return this.findSpectralPeaks(s,4)}computeSpectralCentroid(e){const t=this.computeFFT(e),s=this.computePowerSpectrum(t);let r=0,i=0;for(let o=0;o<s.length;o++){const a=o*this.sampleRate/(2*s.length);r+=a*s[o],i+=s[o]}return i>0?r/i:0}computeHarmonicRatio(e){const t=this.estimateFundamentalFrequency(e),s=this.computeFFT(e),r=this.computePowerSpectrum(s);let i=0,o=0;for(let a=0;a<r.length;a++){o+=r[a];const l=a*this.sampleRate/(2*r.length),c=Math.round(l/t);Math.abs(l-c*t)<t*.1&&(i+=r[a])}return o>0?i/o:0}classifyVoiceType(e,t){return t.length<2?"unknown":e<130&&t[0]<500?"male":e>180&&t[0]>500?"female":"unknown"}createHannWindow(e){const t=new Float32Array(e);for(let s=0;s<e;s++)t[s]=.5*(1-Math.cos(2*Math.PI*s/(e-1)));return t}computeFFT(e){const t=e.length,s=new Float32Array(t*2),r=new Float32Array(t);for(let i=0;i<t;i++)r[i]=e[i]*this.window[i%this.window.length];for(let i=0;i<t;i++){let o=0,a=0;for(let l=0;l<t;l++){const c=-2*Math.PI*i*l/t;o+=r[l]*Math.cos(c),a+=r[l]*Math.sin(c)}s[i*2]=o,s[i*2+1]=a}return s}computePowerSpectrum(e){const t=new Float32Array(e.length/2);for(let s=0;s<t.length;s++){const r=e[s*2],i=e[s*2+1];t[s]=r*r+i*i}return t}findSpectralPeaks(e,t){const s=[];for(let r=1;r<e.length-1;r++)if(e[r]>e[r-1]&&e[r]>e[r+1]){const i=r*this.sampleRate/(2*e.length);s.push({freq:i,magnitude:e[r]})}return s.sort((r,i)=>i.magnitude-r.magnitude),s.slice(0,t).map(r=>r.freq)}}class v6{constructor(e){le(this,"ctx");le(this,"analyzer");le(this,"voiceProfile",null);this.ctx=e,this.analyzer=new w6(e.sampleRate)}async enhanceAudio(e,t){t.adaptiveMode&&(this.voiceProfile=this.analyzer.analyzeVoiceProfile(e),console.log("M5: Voice profile analyzed:",this.voiceProfile));const s=this.ctx.createBuffer(e.numberOfChannels,e.length,e.sampleRate);for(let r=0;r<e.numberOfChannels;r++){const i=e.getChannelData(r),o=s.getChannelData(r);this.applyClarityEnhancement(i,o,t.clarity),this.applyPresenceBoost(o,t.presence),this.applyWarmthEnhancement(o,t.warmth),this.applyIntelligibilityBoost(o,t.intelligibility)}return s}applyClarityEnhancement(e,t,s){if(s===0){t.set(e);return}const r=this.voiceProfile?this.voiceProfile.spectralCentroid*1.5:3e3,i=1+s*.5,o=Math.exp(-2*Math.PI*r/this.ctx.sampleRate);let a=0,l=0;for(let c=0;c<e.length;c++){const u=e[c],h=i*u+(i-1)*o*l-o*a;t[c]=h,l=u,a=h}}applyPresenceBoost(e,t){if(t===0)return;const s=this.voiceProfile&&this.voiceProfile.formantFreqs[1]||2500,r=1+t*.3,i=2,o=2*Math.PI*s/this.ctx.sampleRate,a=Math.cos(o),l=Math.sin(o)/(2*i),c=Math.sqrt(r),u=1+l*c,h=-2*a,d=1-l*c,p=1+l/c,f=-2*a,g=1-l/c;let m=0,y=0,w=0,v=0;for(let I=0;I<e.length;I++){const _=e[I],N=(u*_+h*m+d*y-f*w-g*v)/p;e[I]=N,y=m,m=_,v=w,w=N}}applyWarmthEnhancement(e,t){if(t===0)return;const s=this.voiceProfile?this.voiceProfile.fundamentalFreq*2:200,r=1+t*.4,i=Math.exp(-2*Math.PI*s/this.ctx.sampleRate);let o=0;for(let a=0;a<e.length;a++){const l=e[a]+i*o;e[a]=l*r,o=l}}applyIntelligibilityBoost(e,t){if(t===0)return;const s=[{freq:1e3,gain:1+t*.2},{freq:2e3,gain:1+t*.3},{freq:4e3,gain:1+t*.4}];for(const r of s){const i=2*Math.PI*r.freq/this.ctx.sampleRate,o=Math.exp(-i);let a=0;for(let l=0;l<e.length;l++){const c=e[l]+o*a;e[l]=c*r.gain,a=c}}}getVoiceProfile(){return this.voiceProfile}}class I6{constructor(e){le(this,"input");le(this,"output");le(this,"enhancer");le(this,"config");this.input=e.createGain(),this.output=e.createGain(),this.enhancer=new v6(e),this.config={clarity:.7,presence:.5,warmth:.3,intelligibility:.8,adaptiveMode:!0,voiceType:"auto"},this.input.connect(this.output)}setParams(e){e.aiEnhancement!==void 0&&(this.config.clarity=e.aiEnhancement,this.config.presence=e.aiEnhancement*.7,this.config.warmth=e.aiEnhancement*.4,this.config.intelligibility=e.aiEnhancement*1.1),e.enableAIEnhancement!==void 0&&(this.config.adaptiveMode=e.enableAIEnhancement)}async processBuffer(e){return await this.enhancer.enhanceAudio(e,this.config)}getVoiceProfile(){return this.enhancer.getVoiceProfile()}dispose(){this.input.disconnect(),this.output.disconnect()}}function RA(n){return new I6(n)}class S6{constructor(e){le(this,"ctx");le(this,"lowShelf");le(this,"midPeak");le(this,"highShelf");this.ctx=e,this.setupFilters()}setupFilters(){this.lowShelf=this.ctx.createBiquadFilter(),this.lowShelf.type="lowshelf",this.lowShelf.frequency.value=250,this.lowShelf.gain.value=0,this.midPeak=this.ctx.createBiquadFilter(),this.midPeak.type="peaking",this.midPeak.frequency.value=1e3,this.midPeak.Q.value=1,this.midPeak.gain.value=0,this.highShelf=this.ctx.createBiquadFilter(),this.highShelf.type="highshelf",this.highShelf.frequency.value=4e3,this.highShelf.gain.value=0,this.lowShelf.connect(this.midPeak),this.midPeak.connect(this.highShelf)}connect(e){this.highShelf.connect(e)}getInput(){return this.lowShelf}setParams(e){this.lowShelf.frequency.value=e.lowFreq,this.lowShelf.gain.value=e.lowGain,this.midPeak.frequency.value=(e.lowFreq+e.highFreq)/2,this.midPeak.gain.value=e.midGain,this.highShelf.frequency.value=e.highFreq,this.highShelf.gain.value=e.highGain}dispose(){this.lowShelf.disconnect(),this.midPeak.disconnect(),this.highShelf.disconnect()}}class k6{constructor(e){le(this,"ctx");le(this,"splitter");le(this,"merger");le(this,"midGain");le(this,"sideGain");le(this,"bassFilter");le(this,"delayL");le(this,"delayR");this.ctx=e,this.setupStereoProcessing()}setupStereoProcessing(){this.splitter=this.ctx.createChannelSplitter(2),this.merger=this.ctx.createChannelMerger(2),this.midGain=this.ctx.createGain(),this.sideGain=this.ctx.createGain(),this.bassFilter=this.ctx.createBiquadFilter(),this.bassFilter.type="lowpass",this.bassFilter.frequency.value=120,this.delayL=this.ctx.createDelay(.001),this.delayR=this.ctx.createDelay(.001),this.delayL.delayTime.value=0,this.delayR.delayTime.value=0,this.splitter.connect(this.merger,0,0),this.splitter.connect(this.merger,1,1)}getInput(){return this.splitter}connect(e){this.merger.connect(e)}setParams(e){if(!e.enabled)return;const t=Math.max(0,Math.min(2,e.width));this.midGain.gain.value=1,this.sideGain.gain.value=t,this.bassFilter.frequency.value=120+e.bass*80;const s=e.imaging*5e-4;this.delayL.delayTime.value=s,this.delayR.delayTime.value=0}dispose(){this.splitter.disconnect(),this.merger.disconnect(),this.midGain.disconnect(),this.sideGain.disconnect(),this.bassFilter.disconnect(),this.delayL.disconnect(),this.delayR.disconnect()}}class T6{constructor(e){le(this,"ctx");le(this,"filter");le(this,"waveshaper");le(this,"dryGain");le(this,"wetGain");le(this,"mixer");this.ctx=e,this.setupExciter()}setupExciter(){this.filter=this.ctx.createBiquadFilter(),this.filter.type="highpass",this.filter.frequency.value=2e3,this.waveshaper=this.ctx.createWaveShaper(),this.waveshaper.curve=this.createExciterCurve(),this.waveshaper.oversample="4x",this.dryGain=this.ctx.createGain(),this.wetGain=this.ctx.createGain(),this.mixer=this.ctx.createGain(),this.filter.connect(this.waveshaper),this.waveshaper.connect(this.wetGain),this.wetGain.connect(this.mixer),this.dryGain.connect(this.mixer)}createExciterCurve(){const t=new Float32Array(1024);for(let s=0;s<1024;s++){const r=(s-512)/512;t[s]=Math.tanh(r*2)*.5+Math.sin(r*Math.PI)*.1}return t}getInput(){return this.dryGain}connect(e){this.mixer.connect(e)}connectToFilter(){this.dryGain.connect(this.filter)}setParams(e){if(!e.enabled){this.wetGain.gain.value=0,this.dryGain.gain.value=1;return}this.filter.frequency.value=e.frequency,this.wetGain.gain.value=e.amount*.3,this.dryGain.gain.value=1-e.amount*.2,this.waveshaper.curve=this.createExciterCurve()}dispose(){this.filter.disconnect(),this.waveshaper.disconnect(),this.dryGain.disconnect(),this.wetGain.disconnect(),this.mixer.disconnect()}}class C6{constructor(e){le(this,"ctx");le(this,"compressor");le(this,"outputGain");le(this,"lookAheadDelay");this.ctx=e,this.setupLimiter()}setupLimiter(){this.lookAheadDelay=this.ctx.createDelay(.01),this.lookAheadDelay.delayTime.value=.005,this.compressor=this.ctx.createDynamicsCompressor(),this.compressor.threshold.value=-3,this.compressor.knee.value=0,this.compressor.ratio.value=20,this.compressor.attack.value=.001,this.compressor.release.value=.1,this.outputGain=this.ctx.createGain(),this.outputGain.gain.value=.9,this.lookAheadDelay.connect(this.compressor),this.compressor.connect(this.outputGain)}getInput(){return this.lookAheadDelay}connect(e){this.outputGain.connect(e)}setParams(e){if(!e.enabled){this.compressor.threshold.value=0,this.compressor.ratio.value=1;return}this.compressor.threshold.value=e.threshold,this.compressor.release.value=e.release/1e3,this.outputGain.gain.value=Math.pow(10,e.ceiling/20)}dispose(){this.lookAheadDelay.disconnect(),this.compressor.disconnect(),this.outputGain.disconnect()}}class E6{constructor(e){le(this,"input");le(this,"output");le(this,"multibandEQ");le(this,"stereoEnhancer");le(this,"exciter");le(this,"limiter");le(this,"masterVolume");le(this,"config");this.input=e.createGain(),this.output=e.createGain(),this.multibandEQ=new S6(e),this.stereoEnhancer=new k6(e),this.exciter=new T6(e),this.limiter=new C6(e),this.masterVolume=e.createGain(),this.config={multiband:{enabled:!0,lowGain:0,midGain:0,highGain:0,lowFreq:300,highFreq:3e3},stereo:{enabled:!0,width:1,bass:.3,imaging:.2},exciter:{enabled:!0,amount:.3,frequency:4e3,harmonics:2},finalLimiter:{enabled:!0,threshold:-1,release:100,ceiling:-.3},masterVolume:1},this.connectChain(),this.updateParameters()}connectChain(){this.input.connect(this.multibandEQ.getInput()),this.multibandEQ.connect(this.stereoEnhancer.getInput()),this.stereoEnhancer.connect(this.exciter.getInput()),this.exciter.connectToFilter(),this.exciter.connect(this.limiter.getInput()),this.limiter.connect(this.masterVolume),this.masterVolume.connect(this.output)}setParams(e){if(e.enableMastering!==void 0&&(this.config.multiband.enabled=e.enableMastering,this.config.stereo.enabled=e.enableMastering,this.config.exciter.enabled=e.enableMastering,this.config.finalLimiter.enabled=e.enableMastering),e.aiEnhancement!==void 0){const t=e.aiEnhancement;this.config.exciter.amount=t*.4,this.config.stereo.width=1+t*.3,this.config.multiband.highGain=t*2}this.updateParameters()}updateParameters(){this.multibandEQ.setParams(this.config.multiband),this.stereoEnhancer.setParams(this.config.stereo),this.exciter.setParams(this.config.exciter),this.limiter.setParams(this.config.finalLimiter),this.masterVolume.gain.value=this.config.masterVolume}getMasteringMetrics(){return{eqActive:this.config.multiband.enabled,stereoWidth:this.config.stereo.width,exciterAmount:this.config.exciter.amount,limiterReduction:this.config.finalLimiter.enabled?Math.max(0,this.config.finalLimiter.threshold):0,outputLevel:this.config.masterVolume}}dispose(){this.input.disconnect(),this.output.disconnect(),this.multibandEQ.dispose(),this.stereoEnhancer.dispose(),this.exciter.dispose(),this.limiter.dispose(),this.masterVolume.disconnect()}}function $A(n){return new E6(n)}class BP{constructor(e){le(this,"input");le(this,"output");this.ctx=e,this.input=this.output=e.createBiquadFilter(),this.output.type="highpass",this.output.frequency.value=100,this.output.Q.value=.7}setParams(e){e.highpassFreq!==void 0&&this.output.frequency.setValueAtTime(Math.max(20,Math.min(2e4,e.highpassFreq)),this.ctx.currentTime)}dispose(){this.output.disconnect()}}class jP{constructor(e){le(this,"input");le(this,"output");this.ctx=e,this.input=this.output=e.createBiquadFilter(),this.output.type="lowpass",this.output.frequency.value=2e4,this.output.Q.value=.7}setParams(e){e.lowpassFreq!==void 0&&this.output.frequency.setValueAtTime(Math.max(20,Math.min(2e4,e.lowpassFreq)),this.ctx.currentTime)}dispose(){this.output.disconnect()}}class UP{constructor(e){le(this,"input");le(this,"output");this.input=this.output=e.createDynamicsCompressor(),this.output.threshold.value=-24,this.output.knee.value=30,this.output.ratio.value=3,this.output.attack.value=.003,this.output.release.value=.25}setParams(e){}dispose(){this.output.disconnect()}}class WP{constructor(e){le(this,"input");le(this,"output");le(this,"delayLine");le(this,"feedbackNode");le(this,"wetGainNode");this.ctx=e,this.input=e.createGain(),this.output=e.createGain(),this.delayLine=e.createDelay(1),this.feedbackNode=e.createGain(),this.wetGainNode=e.createGain(),this.input.connect(this.delayLine),this.delayLine.connect(this.feedbackNode),this.feedbackNode.connect(this.delayLine),this.delayLine.connect(this.wetGainNode),this.wetGainNode.connect(this.output),this.input.connect(this.output),this.delayLine.delayTime.value=.2,this.feedbackNode.gain.value=.3,this.wetGainNode.gain.value=0}setParams(e){e.delayTime!==void 0&&this.delayLine.delayTime.setValueAtTime(Math.max(.001,Math.min(1,e.delayTime)),this.ctx.currentTime),e.delayFeedback!==void 0&&this.feedbackNode.gain.setValueAtTime(Math.max(0,Math.min(.95,e.delayFeedback)),this.ctx.currentTime)}dispose(){this.delayLine.disconnect(),this.feedbackNode.disconnect(),this.wetGainNode.disconnect(),this.output.disconnect()}}class GP{constructor(e){le(this,"input");le(this,"output");le(this,"convolverNode");le(this,"wetGainNode");this.ctx=e,this.input=e.createGain(),this.output=e.createGain(),this.convolverNode=e.createConvolver(),this.wetGainNode=e.createGain(),this.createReverbImpulse(),this.input.connect(this.convolverNode),this.convolverNode.connect(this.wetGainNode),this.wetGainNode.connect(this.output),this.input.connect(this.output),this.wetGainNode.gain.value=0}createReverbImpulse(){const e=this.ctx.sampleRate*2,t=this.ctx.createBuffer(2,e,this.ctx.sampleRate);for(let s=0;s<2;s++){const r=t.getChannelData(s);for(let i=0;i<e;i++){const o=Math.pow(1-i/e,2);r[i]=(Math.random()*2-1)*o*.5}}this.convolverNode.buffer=t}setParams(e){e.reverbMix}dispose(){this.convolverNode.disconnect(),this.wetGainNode.disconnect(),this.output.disconnect()}}class HP{constructor(e){le(this,"input");le(this,"output");le(this,"limiter");le(this,"makeupGain");this.limiter=e.createDynamicsCompressor(),this.makeupGain=e.createGain(),this.input=this.limiter,this.output=this.makeupGain,this.limiter.threshold.value=-1,this.limiter.knee.value=0,this.limiter.ratio.value=20,this.limiter.attack.value=1e-4,this.limiter.release.value=.01,this.makeupGain.gain.value=1,this.limiter.connect(this.makeupGain)}setParams(e){}dispose(){this.limiter.disconnect(),this.makeupGain.disconnect()}}class _6{constructor(e){le(this,"input");le(this,"output");le(this,"peakHold",0);le(this,"peakHoldTime",0);le(this,"rmsHistory",[]);le(this,"PEAK_HOLD_TIME",1e3);le(this,"RMS_HISTORY_SIZE",10);this.ctx=e,this.input=this.output=e.createAnalyser(),this.output.fftSize=512,this.output.smoothingTimeConstant=.2}getPeakLevel(){const e=new Float32Array(this.output.fftSize);this.output.getFloatTimeDomainData(e);let t=0;for(let r=0;r<e.length;r++)t=Math.max(t,Math.abs(e[r]));const s=this.ctx.currentTime*1e3;return(t>this.peakHold||s-this.peakHoldTime>this.PEAK_HOLD_TIME)&&(this.peakHold=t,this.peakHoldTime=s),t}getPeakHold(){return this.peakHold}getRMSLevel(){const e=new Float32Array(this.output.fftSize);this.output.getFloatTimeDomainData(e);let t=0;for(let r=0;r<e.length;r++)t+=e[r]*e[r];const s=Math.sqrt(t/e.length);return this.rmsHistory.push(s),this.rmsHistory.length>this.RMS_HISTORY_SIZE&&this.rmsHistory.shift(),this.rmsHistory.reduce((r,i)=>r+i,0)/this.rmsHistory.length}getLoudnessLUFS(){const e=new Float32Array(this.output.fftSize);this.output.getFloatTimeDomainData(e);let t=0,s=0;for(let o=0;o<e.length;o++){const a=e[o];Math.abs(a)>.001&&(t+=a*a,s++)}if(s===0)return-60;const r=t/s,i=-.691+10*Math.log10(r+1e-10);return Math.max(-60,Math.min(0,i))}getFrequencyData(){const e=new Float32Array(this.output.frequencyBinCount);return this.output.getFloatFrequencyData(e),e}getMeterData(){return{peak:this.getPeakLevel(),peakHold:this.getPeakHold(),rms:this.getRMSLevel(),loudness:this.getLoudnessLUFS(),frequencyData:this.getFrequencyData()}}setParams(e){}dispose(){this.output.disconnect()}}class qP{constructor(e){le(this,"input");le(this,"output");le(this,"bands",[]);le(this,"analyser");le(this,"isEnabled",!1);this.ctx=e,this.input=e.createGain(),this.output=e.createGain(),this.analyser=e.createAnalyser(),this.analyser.fftSize=2048,this.analyser.smoothingTimeConstant=.8,this.createFrequencyBands(),this.input.connect(this.output)}createFrequencyBands(){[{low:60,high:250},{low:250,high:1e3},{low:1e3,high:4e3},{low:4e3,high:8e3}].forEach(t=>{const s=this.ctx.createBiquadFilter();s.type="bandpass",s.frequency.value=Math.sqrt(t.low*t.high),s.Q.value=t.high/t.low/2;const r=this.ctx.createGain();r.gain.value=1,this.bands.push({filter:s,expander:r,threshold:.1})})}connectMultibandChain(){this.input.disconnect(this.output),this.input.connect(this.analyser);let e=this.ctx.createGain();e.gain.value=.25,this.bands.forEach(t=>{this.input.connect(t.filter),t.filter.connect(t.expander),t.expander.connect(e)}),e.connect(this.output)}disconnectMultibandChain(){this.bands.forEach(e=>{e.filter.disconnect(),e.expander.disconnect()}),this.analyser.disconnect(),this.input.connect(this.output)}updateExpanderThresholds(e,t){this.bands.forEach((s,r)=>{const i=[.8,1,.6,1.2][r],o=e*(2+t*3)*i;s.threshold=Math.max(.01,Math.min(.5,o));const a=1-t*.7;s.expander.gain.setValueAtTime(a,this.ctx.currentTime)})}analyzeMeydaFeatures(e){try{return{rms:this.calculateRMSFromFrequencyData(e),spectralCentroid:this.calculateSpectralCentroid(e),spectralRolloff:this.calculateSpectralRolloff(e,.95),zcr:.5}}catch(t){return console.warn("Meyda analysis failed, using fallback:",t),{rms:.1,spectralCentroid:1e3,spectralRolloff:4e3,zcr:.5}}}calculateRMSFromFrequencyData(e){let t=0;for(let s=0;s<e.length;s++){const r=Math.pow(10,e[s]/20);t+=r*r}return Math.sqrt(t/e.length)}calculateSpectralCentroid(e){let t=0,s=0;for(let r=0;r<e.length;r++){const i=Math.pow(10,e[r]/20),o=r*this.ctx.sampleRate/(2*e.length);t+=o*i,s+=i}return s>0?t/s:1e3}calculateSpectralRolloff(e,t){let s=0;const r=e.map(a=>Math.pow(10,a/20));for(const a of r)s+=a;const i=s*t;let o=0;for(let a=0;a<r.length;a++)if(o+=r[a],o>=i)return a*this.ctx.sampleRate/(2*r.length);return this.ctx.sampleRate/4}calculateAdaptiveNoiseFloor(e,t){const s=Math.max(.01,.2-e.rms*.5),r=e.spectralCentroid/2e3,i=e.spectralRolloff/8e3;let o=1;r>1.5?o*=1.3:r<.5&&(o*=.8),i>.7&&(o*=1.2);const a=s*o*(1+t);return Math.max(.01,Math.min(.3,a))}setParams(e){const t=this.isEnabled;if(this.isEnabled=e.enableNoiseReduction??!1,this.isEnabled!==t&&(this.isEnabled?this.connectMultibandChain():this.disconnectMultibandChain()),this.isEnabled&&e.noiseReduction!==void 0){const s=Math.max(0,Math.min(1,e.noiseReduction)),r=new Float32Array(this.analyser.frequencyBinCount);this.analyser.getFloatFrequencyData(r);const i=this.analyzeMeydaFeatures(r),o=this.calculateAdaptiveNoiseFloor(i,s);this.updateExpanderThresholds(o,s)}}dispose(){this.isEnabled&&this.disconnectMultibandChain(),this.bands.forEach(e=>{e.filter.disconnect(),e.expander.disconnect()}),this.analyser.disconnect(),this.input.disconnect(),this.output.disconnect()}}function N6(n){return new BP(n)}function A6(n){return new jP(n)}function R6(n){return new UP(n)}function $6(n){return new WP(n)}function D6(n){return new GP(n)}function P6(n){return new HP(n)}function O6(n){return new _6(n)}function F6(n){return new qP(n)}class L6{constructor(){le(this,"ctx");le(this,"previewGraph",null);le(this,"wasmProcessor",null);this.ctx=new(window.AudioContext||window.webkitAudioContext),this.initializeWASM()}async initializeWASM(){try{this.wasmProcessor=VP({enableWASM:!0,fallbackToJS:!0,blockSize:2048,sampleRate:this.ctx.sampleRate,channels:2}),await this.wasmProcessor.initialize(),console.log("M4: WASM processor initialized for high-performance audio processing")}catch(e){console.warn("M4: WASM initialization failed, using JavaScript fallback:",e)}}async ensureAudioContext(){this.ctx.state==="suspended"&&await this.ctx.resume()}buildPreviewGraph(e,t){const s=[],r=N6(this.ctx),i=A6(this.ctx),o=F6(this.ctx),a=RA(this.ctx),l=R6(this.ctx),c=$6(this.ctx),u=D6(this.ctx),h=P6(this.ctx),d=$A(this.ctx),p=O6(this.ctx);s.push(r,i,o,a,l,c,u,h,d,p);const f=this.ctx.createBufferSource();return f.buffer=e,f.loop=!1,{nodes:s,sourceNode:f,connect:()=>{let m=f;t.enableHighpass&&(m.connect(r.input),m=r.output),t.enableLowpass&&(m.connect(i.input),m=i.output),t.enableNoiseReduction&&(m.connect(o.input),m=o.output),t.enableAIEnhancement&&(m.connect(a.input),m=a.output),m.connect(l.input),m=l.output,t.enableDelay&&(m.connect(c.input),m=c.output),t.enableReverb&&(m.connect(u.input),m=u.output),m.connect(h.input),m=h.output,m.connect(d.input),m=d.output,m.connect(p.input),p.output.connect(this.ctx.destination)},disconnect:()=>{if(f){try{f.stop()}catch{}f.disconnect()}s.forEach(m=>{try{m.output.disconnect()}catch{}})},updateParams:m=>{s.forEach(y=>{try{y.setParams(m)}catch(w){console.warn("Failed to update node params:",w)}})},dispose:()=>{if(f){try{f.stop()}catch{}f.disconnect()}s.forEach(m=>{try{m.dispose()}catch(y){console.warn("Failed to dispose node:",y)}})}}}async renderOffline(e,t,s){if(this.wasmProcessor&&t.enableNoiseReduction)try{s==null||s(.1);const i=await this.wasmProcessor.processBuffer(e,"fft");return s==null||s(.9),console.log("M4: Used WASM acceleration for noise reduction"),i}catch(i){console.warn("M4: WASM processing failed, falling back to standard:",i)}const r=new OfflineAudioContext(e.numberOfChannels,e.length,e.sampleRate);try{const i=new BP(r),o=new jP(r),a=new qP(r),l=RA(r),c=new UP(r),u=new WP(r),h=new GP(r),d=new HP(r),p=$A(r);[i,o,a,l,c,u,h,d,p].forEach(y=>{try{y.setParams(t)}catch(w){console.warn("Failed to set offline node params:",w)}});const g=r.createBufferSource();g.buffer=e;let m=g;if(t.enableHighpass&&(m.connect(i.input),m=i.output),t.enableLowpass&&(m.connect(o.input),m=o.output),t.enableNoiseReduction&&(m.connect(a.input),m=a.output),t.enableAIEnhancement&&(m.connect(l.input),m=l.output),m.connect(c.input),m=c.output,t.enableDelay&&(m.connect(u.input),m=u.output),t.enableReverb&&(m.connect(h.input),m=h.output),m.connect(d.input),m=d.output,t.enableMastering&&(m.connect(p.input),m=p.output),m.connect(r.destination),g.start(0),s){const y=setInterval(()=>{s(Math.random()*.8)},100),w=await r.startRendering();return clearInterval(y),s(1),w}else return await r.startRendering()}catch(i){return console.error("Offline rendering failed:",i),e}}getPreviewGraph(){return this.previewGraph}setPreviewGraph(e){this.previewGraph&&this.previewGraph.dispose(),this.previewGraph=e}dispose(){this.previewGraph&&(this.previewGraph.dispose(),this.previewGraph=null),this.ctx.state!=="closed"&&this.ctx.close()}}let Ev=null;function ra(){return Ev||(Ev=new L6),Ev}const B1=[{id:"wav",name:"WAV (Uncompressed)",extension:"wav",mimeType:"audio/wav",description:"Highest quality, larger file size",quality:[{id:"studio",name:"Studio (48kHz/24-bit)",sampleRate:48e3,bitDepth:24,channels:2},{id:"broadcast",name:"Broadcast (48kHz/16-bit)",sampleRate:48e3,bitDepth:16,channels:2},{id:"cd",name:"CD Quality (44.1kHz/16-bit)",sampleRate:44100,bitDepth:16,channels:2}]},{id:"mp3",name:"MP3 (Compressed)",extension:"mp3",mimeType:"audio/mpeg",description:"Good quality, smaller file size",quality:[{id:"high",name:"High Quality (320 kbps)",bitrate:320,sampleRate:44100,channels:2},{id:"standard",name:"Standard (192 kbps)",bitrate:192,sampleRate:44100,channels:2},{id:"voice",name:"Voice Optimized (128 kbps)",bitrate:128,sampleRate:44100,channels:1}]},{id:"aac",name:"AAC (Advanced Audio)",extension:"m4a",mimeType:"audio/mp4",description:"Better compression than MP3",quality:[{id:"high",name:"High Quality (256 kbps)",bitrate:256,sampleRate:44100,channels:2},{id:"standard",name:"Standard (128 kbps)",bitrate:128,sampleRate:44100,channels:2},{id:"voice",name:"Voice Optimized (96 kbps)",bitrate:96,sampleRate:44100,channels:1}]}],$g=[{id:"voice-clarity",name:"ðŸŽ¯ Voice Clarity Boost",description:"Enhance speech intelligibility and presence",category:"voice-enhancement",settings:{pitchShift:0,distortion:0,reverbMix:.1,delayTime:.05,delayFeedback:.1,lowpassFreq:12e3,highpassFreq:80,aiEnhancement:.8,noiseReduction:.7,aiModelSize:"tiny",enableWASM:!0,wasmBlockSize:2048,enablePitchShift:!1,enableDistortion:!1,enableReverb:!0,enableDelay:!0,enableLowpass:!0,enableHighpass:!0,enableAIEnhancement:!0,enableNoiseReduction:!0,enableMastering:!0},author:"Word Hacker 404",createdAt:new Date,tags:["voice","clarity","speech"],favorite:!1},{id:"podcast-master",name:"ðŸŽ™ï¸ Podcast Master",description:"Professional podcast voice processing",category:"mastering",settings:{pitchShift:0,distortion:0,reverbMix:.05,delayTime:.02,delayFeedback:.05,lowpassFreq:15e3,highpassFreq:100,aiEnhancement:.6,noiseReduction:.8,aiModelSize:"tiny",enableWASM:!0,wasmBlockSize:4096,enablePitchShift:!1,enableDistortion:!1,enableReverb:!0,enableDelay:!1,enableLowpass:!0,enableHighpass:!0,enableAIEnhancement:!0,enableNoiseReduction:!0,enableMastering:!0},author:"Word Hacker 404",createdAt:new Date,tags:["podcast","broadcast","professional"],favorite:!0},{id:"creative-voice",name:"ðŸŽ¨ Creative Voice FX",description:"Dramatic voice transformation effects",category:"creative",settings:{pitchShift:-3,distortion:.3,reverbMix:.4,delayTime:.15,delayFeedback:.25,lowpassFreq:8e3,highpassFreq:150,aiEnhancement:.4,noiseReduction:.5,aiModelSize:"medium",enableWASM:!0,wasmBlockSize:2048,enablePitchShift:!0,enableDistortion:!0,enableReverb:!0,enableDelay:!0,enableLowpass:!0,enableHighpass:!0,enableAIEnhancement:!0,enableNoiseReduction:!0,enableMastering:!0},author:"Word Hacker 404",createdAt:new Date,tags:["creative","fx","dramatic"],favorite:!1},{id:"ai-enhance",name:"ðŸ¤– AI Enhancement Pro",description:"Maximum AI-powered voice enhancement",category:"ai-generated",settings:{pitchShift:0,distortion:0,reverbMix:.2,delayTime:.08,delayFeedback:.15,lowpassFreq:18e3,highpassFreq:60,aiEnhancement:1,noiseReduction:.9,aiModelSize:"large",enableWASM:!0,wasmBlockSize:2048,enablePitchShift:!1,enableDistortion:!1,enableReverb:!0,enableDelay:!0,enableLowpass:!0,enableHighpass:!0,enableAIEnhancement:!0,enableNoiseReduction:!0,enableMastering:!0},author:"Word Hacker 404",createdAt:new Date,tags:["ai","enhancement","automatic"],favorite:!0}],bl=class bl{static getInstance(){return bl.instance||(bl.instance=new bl),bl.instance}async exportAudio(e,t,s){const r=B1.find(l=>l.id===t.format);if(!r)throw new Error(`Unsupported export format: ${t.format}`);const i=r.quality.find(l=>l.id===t.quality);if(!i)throw new Error(`Unsupported quality option: ${t.quality}`);let o=e;s&&s(.1),t.normalize&&(o=this.normalizeAudio(o)),s&&s(.3),(t.fadeIn>0||t.fadeOut>0)&&(o=this.applyFades(o,t.fadeIn,t.fadeOut)),s&&s(.5),t.trimSilence&&(o=this.trimSilence(o)),s&&s(.7);const a=await this.convertToFormat(o,r,i);return s&&s(1),a}normalizeAudio(e){const s=new(window.AudioContext||window.webkitAudioContext)().createBuffer(e.numberOfChannels,e.length,e.sampleRate);let r=0;for(let o=0;o<e.numberOfChannels;o++){const a=e.getChannelData(o);for(let l=0;l<a.length;l++)r=Math.max(r,Math.abs(a[l]))}const i=r>0?.97/r:1;for(let o=0;o<e.numberOfChannels;o++){const a=e.getChannelData(o),l=s.getChannelData(o);for(let c=0;c<a.length;c++)l[c]=a[c]*i}return s}applyFades(e,t,s){const i=new(window.AudioContext||window.webkitAudioContext)().createBuffer(e.numberOfChannels,e.length,e.sampleRate),o=Math.floor(t*e.sampleRate),a=Math.floor(s*e.sampleRate);for(let l=0;l<e.numberOfChannels;l++){const c=e.getChannelData(l),u=i.getChannelData(l);for(let h=0;h<c.length;h++){let d=1;if(h<o&&(d=h/o),h>c.length-a){const p=(c.length-h)/a;d=Math.min(d,p)}u[h]=c[h]*d}}return i}trimSilence(e){let s=0;e:for(let l=0;l<e.length;l++)for(let c=0;c<e.numberOfChannels;c++)if(Math.abs(e.getChannelData(c)[l])>.01){s=l;break e}let r=e.length;e:for(let l=e.length-1;l>=0;l--)for(let c=0;c<e.numberOfChannels;c++)if(Math.abs(e.getChannelData(c)[l])>.01){r=l+1;break e}const i=r-s,a=new(window.AudioContext||window.webkitAudioContext)().createBuffer(e.numberOfChannels,i,e.sampleRate);for(let l=0;l<e.numberOfChannels;l++){const c=e.getChannelData(l),u=a.getChannelData(l);for(let h=0;h<i;h++)u[h]=c[s+h]}return a}async convertToFormat(e,t,s){switch(t.id){case"wav":return this.encodeWAV(e,s);case"mp3":return this.encodeMP3(e,s);case"aac":return this.encodeAAC(e,s);default:throw new Error(`Unsupported format: ${t.id}`)}}encodeWAV(e,t){const s=Math.min(e.numberOfChannels,t.channels),r=t.sampleRate,i=t.bitDepth||16,o=i/8,a=this.resampleBuffer(e,r),l=a.length*s*o,c=new ArrayBuffer(44+l),u=new DataView(c),h=(f,g)=>{for(let m=0;m<g.length;m++)u.setUint8(f+m,g.charCodeAt(m))};h(0,"RIFF"),u.setUint32(4,36+l,!0),h(8,"WAVE"),h(12,"fmt "),u.setUint32(16,16,!0),u.setUint16(20,1,!0),u.setUint16(22,s,!0),u.setUint32(24,r,!0),u.setUint32(28,r*s*o,!0),u.setUint16(32,s*o,!0),u.setUint16(34,i,!0),h(36,"data"),u.setUint32(40,l,!0);const d=Math.pow(2,i-1)-1;let p=44;for(let f=0;f<a.length;f++)for(let g=0;g<s;g++){const m=a.getChannelData(Math.min(g,a.numberOfChannels-1)),y=Math.max(-1,Math.min(1,m[f]));if(i===16)u.setInt16(p,y*d,!0),p+=2;else if(i===24){const w=Math.floor(y*d);u.setUint8(p,w&255),u.setUint8(p+1,w>>8&255),u.setUint8(p+2,w>>16&255),p+=3}}return new Blob([c],{type:"audio/wav"})}async encodeMP3(e,t){return console.warn("MP3 encoding not yet implemented, using WAV as fallback"),this.encodeWAV(e,{id:t.id,name:t.name,sampleRate:t.sampleRate,bitDepth:16,channels:t.channels})}async encodeAAC(e,t){return console.warn("AAC encoding not yet implemented, using WAV as fallback"),this.encodeWAV(e,{id:t.id,name:t.name,sampleRate:t.sampleRate,bitDepth:16,channels:t.channels})}resampleBuffer(e,t){if(e.sampleRate===t)return e;const s=new(window.AudioContext||window.webkitAudioContext),r=t/e.sampleRate,i=Math.floor(e.length*r),o=s.createBuffer(e.numberOfChannels,i,t);for(let a=0;a<e.numberOfChannels;a++){const l=e.getChannelData(a),c=o.getChannelData(a);for(let u=0;u<i;u++){const h=u/r,d=Math.floor(h),p=h-d;d+1<l.length?c[u]=l[d]*(1-p)+l[d+1]*p:c[u]=l[Math.min(d,l.length-1)]}}return o}};le(bl,"instance");let j1=bl;const na=class na{constructor(){le(this,"presets",[...$g])}static getInstance(){return na.instance||(na.instance=new na,na.instance.loadPresets()),na.instance}getPresets(){return this.presets}getPresetsByCategory(e){return this.presets.filter(t=>t.category===e)}getFavoritePresets(){return this.presets.filter(e=>e.favorite)}createPreset(e,t,s,r="custom"){const i={id:`custom-${Date.now()}`,name:e,description:t,category:r,settings:{...s},author:"User",createdAt:new Date,tags:[],favorite:!1};return this.presets.push(i),this.savePresets(),i}updatePreset(e,t){const s=this.presets.findIndex(r=>r.id===e);s!==-1&&(this.presets[s]={...this.presets[s],...t},this.savePresets())}deletePreset(e){if($g.some(t=>t.id===e))throw new Error("Cannot delete built-in preset");this.presets=this.presets.filter(t=>t.id!==e),this.savePresets()}toggleFavorite(e){const t=this.presets.find(s=>s.id===e);t&&(t.favorite=!t.favorite,this.savePresets())}exportPreset(e){const t=this.presets.find(s=>s.id===e);if(!t)throw new Error("Preset not found");return JSON.stringify(t,null,2)}importPreset(e){const t=JSON.parse(e);return t.id=`imported-${Date.now()}`,t.createdAt=new Date,this.presets.push(t),this.savePresets(),t}savePresets(){const e=this.presets.filter(t=>!$g.some(s=>s.id===t.id));localStorage.setItem("word-hacker-presets",JSON.stringify(e))}loadPresets(){try{const e=localStorage.getItem("word-hacker-presets");if(e){const t=JSON.parse(e);this.presets=[...$g,...t]}}catch(e){console.warn("Failed to load presets:",e)}}};le(na,"instance");let U1=na;const KP=j1.getInstance(),_v=U1.getInstance(),xl=class xl{static getInstance(){return xl.instance||(xl.instance=new xl),xl.instance}async runMasterQualityInvigilator(e,t,s){const r=Date.now(),i=[],o=[];s&&s(0,"Initializing Quality Assurance System...");try{s&&s(.1,"Validating audio buffer integrity..."),i.push(await this.testAudioBufferIntegrity(e)),s&&s(.2,"Validating effect settings..."),i.push(await this.testSettingsValidation(t)),s&&s(.3,"Testing engine core functionality..."),i.push(await this.testEngineCoreFunction(e,t)),s&&s(.4,"Analyzing processing quality...");const h=await this.testProcessingQuality(e,t);i.push(h),s&&s(.5,"Running performance benchmarks..."),i.push(await this.testPerformanceBenchmark(e,t)),s&&s(.6,"Detecting memory leaks..."),i.push(await this.testMemoryLeaks(e,t)),s&&s(.7,"Validating export systems..."),i.push(await this.testExportSystems(e,t)),s&&s(.8,"Validating preset systems..."),i.push(await this.testPresetSystems()),s&&s(.9,"Checking browser compatibility..."),i.push(await this.testBrowserCompatibility()),s&&s(.95,"Validating NASA-grade compliance..."),i.push(await this.testNASACompliance(h.metrics)),s&&s(1,"Quality assurance complete")}catch(h){i.push({id:"critical-error",name:"Critical System Error",status:"fail",message:`Critical error during QA: ${h instanceof Error?h.message:"Unknown error"}`,timestamp:new Date})}o.push(...this.generateRecommendations(i));const a=i.some(h=>h.status==="fail"),l=i.some(h=>h.status==="warning"),c=a?"fail":l?"warning":"pass",u=i.every(h=>h.status==="pass")&&i.length>=10&&!a&&!l;return{overallStatus:c,tests:i,processingTime:Date.now()-r,recommendations:o,nasa_grade_compliance:u}}async testAudioBufferIntegrity(e){try{if(!e||e.length===0)return{id:"buffer-integrity",name:"Audio Buffer Integrity",status:"fail",message:"Invalid or empty audio buffer",timestamp:new Date};if(e.sampleRate<44100)return{id:"buffer-integrity",name:"Audio Buffer Integrity",status:"warning",message:`Low sample rate detected: ${e.sampleRate}Hz (recommended: â‰¥44.1kHz)`,timestamp:new Date};let t=0;for(let s=0;s<e.numberOfChannels;s++){const r=e.getChannelData(s);for(let i=0;i<r.length;i++)(!isFinite(r[i])||Math.abs(r[i])>1)&&t++}return t>0?{id:"buffer-integrity",name:"Audio Buffer Integrity",status:"fail",message:`Corrupted samples detected: ${t}`,timestamp:new Date}:{id:"buffer-integrity",name:"Audio Buffer Integrity",status:"pass",message:`Buffer validated: ${e.length} samples, ${e.numberOfChannels} channels, ${e.sampleRate}Hz`,timestamp:new Date}}catch(t){return{id:"buffer-integrity",name:"Audio Buffer Integrity",status:"fail",message:`Buffer validation failed: ${t instanceof Error?t.message:"Unknown error"}`,timestamp:new Date}}}async testSettingsValidation(e){try{const t=[];return(e.pitchShift<-24||e.pitchShift>24)&&t.push(`Pitch shift out of range: ${e.pitchShift} (recommended: -24 to +24)`),(e.distortion<0||e.distortion>1)&&t.push(`Distortion out of range: ${e.distortion} (expected: 0-1)`),(e.reverbMix<0||e.reverbMix>1)&&t.push(`Reverb mix out of range: ${e.reverbMix} (expected: 0-1)`),(e.lowpassFreq<20||e.lowpassFreq>2e4)&&t.push(`Lowpass frequency out of range: ${e.lowpassFreq}Hz (recommended: 20-20000Hz)`),(e.highpassFreq<1||e.highpassFreq>2e3)&&t.push(`Highpass frequency out of range: ${e.highpassFreq}Hz (recommended: 1-2000Hz)`),[2048,4096,8192].includes(e.wasmBlockSize)||t.push(`Invalid WASM block size: ${e.wasmBlockSize} (expected: 2048, 4096, or 8192)`),t.length>0?{id:"settings-validation",name:"Settings Validation",status:"warning",message:`Settings issues detected: ${t.join("; ")}`,timestamp:new Date}:{id:"settings-validation",name:"Settings Validation",status:"pass",message:"All effect settings validated successfully",timestamp:new Date}}catch(t){return{id:"settings-validation",name:"Settings Validation",status:"fail",message:`Settings validation failed: ${t instanceof Error?t.message:"Unknown error"}`,timestamp:new Date}}}async testEngineCoreFunction(e,t){try{const s=ra();await s.ensureAudioContext();const r=s.buildPreviewGraph(e,t);if(!r)return{id:"engine-core",name:"Engine Core Functionality",status:"fail",message:"Failed to create preview graph",timestamp:new Date};const i=Date.now(),o=await s.renderOffline(e,t),a=Date.now()-i;return!o||o.length===0?{id:"engine-core",name:"Engine Core Functionality",status:"fail",message:"Offline rendering failed or returned empty buffer",timestamp:new Date}:(r.dispose(),{id:"engine-core",name:"Engine Core Functionality",status:"pass",message:`Engine validated: Preview graph created, offline rendering completed in ${a}ms`,timestamp:new Date})}catch(s){return{id:"engine-core",name:"Engine Core Functionality",status:"fail",message:`Engine core test failed: ${s instanceof Error?s.message:"Unknown error"}`,timestamp:new Date}}}async testProcessingQuality(e,t){try{const s=ra();await s.ensureAudioContext();const r=await s.renderOffline(e,t),i=await this.analyzeQualityMetrics(r),o=[];i.peakLevel>-.1&&o.push(`Potential clipping detected: ${i.peakLevel.toFixed(2)}dB`),i.dynamicRange<6&&o.push(`Low dynamic range: ${i.dynamicRange.toFixed(1)}dB`),i.thd>.1&&o.push(`High THD: ${i.thd.toFixed(3)}%`),i.lufsIntegrated>-14&&o.push(`Loudness too high: ${i.lufsIntegrated.toFixed(1)} LUFS (broadcast limit: -14 LUFS)`);const a=o.length>0?"warning":"pass",l=o.length>0?`Quality issues detected: ${o.join("; ")}`:`High quality processing validated: ${i.dynamicRange.toFixed(1)}dB dynamic range, ${i.thd.toFixed(3)}% THD`;return{id:"processing-quality",name:"Processing Quality Analysis",status:a,message:l,metrics:i,timestamp:new Date}}catch(s){return{id:"processing-quality",name:"Processing Quality Analysis",status:"fail",message:`Quality analysis failed: ${s instanceof Error?s.message:"Unknown error"}`,timestamp:new Date}}}async testPerformanceBenchmark(e,t){try{const s=ra();await s.ensureAudioContext();const r=3,i=[];for(let u=0;u<r;u++){const h=performance.now();await s.renderOffline(e,t),i.push(performance.now()-h)}const o=i.reduce((u,h)=>u+h,0)/i.length,a=o/(e.length/e.sampleRate*1e3);let l,c;return a<.1?(l="pass",c=`Excellent performance: ${a.toFixed(3)}x realtime (${o.toFixed(1)}ms)`):a<1?(l="pass",c=`Good performance: ${a.toFixed(3)}x realtime (${o.toFixed(1)}ms)`):a<5?(l="warning",c=`Slow performance: ${a.toFixed(3)}x realtime (${o.toFixed(1)}ms)`):(l="fail",c=`Poor performance: ${a.toFixed(3)}x realtime (${o.toFixed(1)}ms)`),{id:"performance-benchmark",name:"Performance Benchmarking",status:l,message:c,timestamp:new Date}}catch(s){return{id:"performance-benchmark",name:"Performance Benchmarking",status:"fail",message:`Performance test failed: ${s instanceof Error?s.message:"Unknown error"}`,timestamp:new Date}}}async testMemoryLeaks(e,t){var s,r;try{const i=((s=performance.memory)==null?void 0:s.usedJSHeapSize)||0,o=ra();await o.ensureAudioContext();const a=5;for(let d=0;d<a;d++){const p=o.buildPreviewGraph(e,t);await new Promise(f=>setTimeout(f,10)),p.dispose()}window.gc&&window.gc();const c=(((r=performance.memory)==null?void 0:r.usedJSHeapSize)||0)-i;let u,h;return c<1024*1024?(u="pass",h=`No significant memory leaks detected: +${Math.round(c/1024)}KB`):c<5*1024*1024?(u="warning",h=`Minor memory increase detected: +${Math.round(c/(1024*1024))}MB`):(u="fail",h=`Significant memory leak detected: +${Math.round(c/(1024*1024))}MB`),{id:"memory-leaks",name:"Memory Leak Detection",status:u,message:h,timestamp:new Date}}catch(i){return{id:"memory-leaks",name:"Memory Leak Detection",status:"warning",message:`Memory test inconclusive: ${i instanceof Error?i.message:"Unknown error"}`,timestamp:new Date}}}async testExportSystems(e,t){try{const s=ra();await s.ensureAudioContext();const r=await s.renderOffline(e,t),i=await KP.exportAudio(r,{format:"wav",quality:"cd",normalize:!0,fadeIn:0,fadeOut:0,trimSilence:!1});return!i||i.size===0?{id:"export-systems",name:"Export System Validation",status:"fail",message:"WAV export failed or returned empty blob",timestamp:new Date}:{id:"export-systems",name:"Export System Validation",status:"pass",message:`Export systems validated: WAV export successful (${Math.round(i.size/1024)}KB)`,timestamp:new Date}}catch(s){return{id:"export-systems",name:"Export System Validation",status:"fail",message:`Export test failed: ${s instanceof Error?s.message:"Unknown error"}`,timestamp:new Date}}}async testPresetSystems(){try{const e=_v.getPresets();if(e.length===0)return{id:"preset-systems",name:"Preset System Validation",status:"fail",message:"No presets available in preset service",timestamp:new Date};const t=_v.createPreset("QA Test Preset","Temporary preset for quality assurance",{pitchShift:0,distortion:0,reverbMix:0,delayTime:0,delayFeedback:0,lowpassFreq:2e4,highpassFreq:20,aiEnhancement:.5,noiseReduction:.5,aiModelSize:"tiny",enableWASM:!0,wasmBlockSize:2048,enablePitchShift:!1,enableDistortion:!1,enableReverb:!1,enableDelay:!1,enableLowpass:!1,enableHighpass:!1,enableAIEnhancement:!1,enableNoiseReduction:!1,enableMastering:!1});return _v.deletePreset(t.id),{id:"preset-systems",name:"Preset System Validation",status:"pass",message:`Preset system validated: ${e.length} presets available, create/delete operations successful`,timestamp:new Date}}catch(e){return{id:"preset-systems",name:"Preset System Validation",status:"fail",message:`Preset test failed: ${e instanceof Error?e.message:"Unknown error"}`,timestamp:new Date}}}async testBrowserCompatibility(){try{const e=[];!window.AudioContext&&!window.webkitAudioContext&&e.push("Web Audio API not supported"),window.WebAssembly||e.push("WebAssembly not supported"),(!window.File||!window.FileReader)&&e.push("File API not supported");try{const t=new(window.AudioContext||window.webkitAudioContext);t.createBuffer(2,44100,44100),t.close()}catch{e.push("AudioBuffer creation failed")}return e.length>0?{id:"browser-compatibility",name:"Browser Compatibility",status:"fail",message:`Compatibility issues: ${e.join("; ")}`,timestamp:new Date}:{id:"browser-compatibility",name:"Browser Compatibility",status:"pass",message:"All browser APIs available and functional",timestamp:new Date}}catch(e){return{id:"browser-compatibility",name:"Browser Compatibility",status:"fail",message:`Compatibility test failed: ${e instanceof Error?e.message:"Unknown error"}`,timestamp:new Date}}}async testNASACompliance(e){try{const t=[],s=[];e.peakLevel<=-.1?t.push("Peak limiting"):s.push("Peak level exceeds -0.1dB"),e.thd<=.05?t.push("THD within limits"):s.push("THD exceeds 0.05%"),e.dynamicRange>=12?t.push("Dynamic range"):s.push("Dynamic range below 12dB"),e.snr>=60?t.push("Signal-to-noise ratio"):s.push("SNR below 60dB"),e.lufsIntegrated<=-14?t.push("Loudness compliance"):s.push("Loudness exceeds broadcast standards");const r=t.length/5*100;let i,o;return r===100?(i="pass",o=`NASA-grade compliance achieved: 100% (${t.join(", ")})`):r>=80?(i="warning",o=`Partial NASA compliance: ${r}% (violations: ${s.join(", ")})`):(i="fail",o=`NASA compliance failed: ${r}% (violations: ${s.join(", ")})`),{id:"nasa-compliance",name:"NASA Compliance Validation",status:i,message:o,timestamp:new Date}}catch(t){return{id:"nasa-compliance",name:"NASA Compliance Validation",status:"fail",message:`NASA compliance test failed: ${t instanceof Error?t.message:"Unknown error"}`,timestamp:new Date}}}async analyzeQualityMetrics(e){const t=e.getChannelData(0),s=t.length;let r=0,i=0,o=0;for(let m=0;m<s;m++){const y=Math.abs(t[m]);r=Math.max(r,y),o+=y*y}i=Math.sqrt(o/s);const a=20*Math.log10(r),l=20*Math.log10(i),c=a-l,u=this.calculateTHD(t),h=l- -60,d=this.calculateSpectralMetrics(t,e.sampleRate),p=l-.691,f=p,g=a;return{peakLevel:a,rmsLevel:l,dynamicRange:c,thd:u,snr:h,spectralBalance:d.balance,spectralCentroid:d.centroid,spectralRolloff:d.rolloff,latency:0,cpuUsage:0,memoryUsage:0,lufsIntegrated:p,lufsMomentary:f,truePeak:g}}calculateTHD(e){let t=0;const s=1024;for(let r=0;r<e.length-s;r+=s){let i=0,o=0;for(let a=0;a<s;a++){const l=e[r+a];i+=Math.abs(l),a%2===0&&(o+=Math.abs(l))}i>0&&(t+=o/i)}return Math.min(t/(e.length/s)*100,100)}calculateSpectralMetrics(e,t){const s=t/2,r=.5,i=s*.3,o=s*.8;return{balance:r,centroid:i,rolloff:o}}generateRecommendations(e){const t=[],s=e.filter(a=>a.status==="fail"),r=e.filter(a=>a.status==="warning");s.length>0&&t.push(`ðŸš¨ Critical: Fix ${s.length} failed tests before deployment`),r.length>0&&t.push(`âš ï¸ Address ${r.length} warning conditions for optimal performance`);const i=e.find(a=>a.id==="processing-quality");if(i!=null&&i.metrics){const a=i.metrics;a.peakLevel>-.3&&t.push("ðŸ”§ Consider adding/adjusting limiter to prevent clipping"),a.dynamicRange<10&&t.push("ðŸŽšï¸ Increase dynamic range by reducing compression"),a.thd>.1&&t.push("ðŸŽ›ï¸ Reduce distortion and saturation effects")}const o=e.find(a=>a.id==="performance-benchmark");return(o==null?void 0:o.status)==="warning"&&t.push("âš¡ Consider enabling WASM acceleration for better performance"),e.every(a=>a.status==="pass")&&t.push("âœ… All systems validated - Ready for NASA-grade deployment"),t}};le(xl,"instance");let W1=xl;const M6=W1.getInstance();function Fs(n,e,t,s){return new(t||(t=Promise))(function(r,i){function o(c){try{l(s.next(c))}catch(u){i(u)}}function a(c){try{l(s.throw(c))}catch(u){i(u)}}function l(c){var u;c.done?r(c.value):(u=c.value,u instanceof t?u:new t(function(h){h(u)})).then(o,a)}l((s=s.apply(n,e||[])).next())})}let yf=class{constructor(){this.listeners={}}on(e,t,s){if(this.listeners[e]||(this.listeners[e]=new Set),s==null?void 0:s.once){const r=(...i)=>{this.un(e,r),t(...i)};return this.listeners[e].add(r),()=>this.un(e,r)}return this.listeners[e].add(t),()=>this.un(e,t)}un(e,t){var s;(s=this.listeners[e])===null||s===void 0||s.delete(t)}once(e,t){return this.on(e,t,{once:!0})}unAll(){this.listeners={}}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach(s=>s(...t))}};const Dg={decode:function(n,e){return Fs(this,void 0,void 0,function*(){const t=new AudioContext({sampleRate:e});try{return yield t.decodeAudioData(n)}finally{t.close()}})},createBuffer:function(n,e){if(!n||n.length===0)throw new Error("channelData must be a non-empty array");if(e<=0)throw new Error("duration must be greater than 0");if(typeof n[0]=="number"&&(n=[n]),!n[0]||n[0].length===0)throw new Error("channelData must contain non-empty channel arrays");(function(s){const r=s[0];if(r.some(i=>i>1||i<-1)){const i=r.length;let o=0;for(let a=0;a<i;a++){const l=Math.abs(r[a]);l>o&&(o=l)}for(const a of s)for(let l=0;l<i;l++)a[l]/=o}})(n);const t=n.map(s=>s instanceof Float32Array?s:Float32Array.from(s));return{duration:e,length:t[0].length,sampleRate:t[0].length/e,numberOfChannels:t.length,getChannelData:s=>{const r=t[s];if(!r)throw new Error(`Channel ${s} not found`);return r},copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function XP(n,e){const t=e.xmlns?document.createElementNS(e.xmlns,n):document.createElement(n);for(const[s,r]of Object.entries(e))if(s==="children"&&r)for(const[i,o]of Object.entries(r))o instanceof Node?t.appendChild(o):typeof o=="string"?t.appendChild(document.createTextNode(o)):t.appendChild(XP(i,o));else s==="style"?Object.assign(t.style,r):s==="textContent"?t.textContent=r:t.setAttribute(s,r.toString());return t}function DA(n,e,t){const s=XP(n,e||{});return t==null||t.appendChild(s),s}var z6=Object.freeze({__proto__:null,createElement:DA,default:DA});const V6={fetchBlob:function(n,e,t){return Fs(this,void 0,void 0,function*(){const s=yield fetch(n,t);if(s.status>=400)throw new Error(`Failed to fetch ${n}: ${s.status} (${s.statusText})`);return function(r,i){Fs(this,void 0,void 0,function*(){if(!r.body||!r.headers)return;const o=r.body.getReader(),a=Number(r.headers.get("Content-Length"))||0;let l=0;const c=u=>{l+=(u==null?void 0:u.length)||0;const h=Math.round(l/a*100);i(h)};try{for(;;){const u=yield o.read();if(u.done)break;c(u.value)}}catch(u){console.warn("Progress tracking error:",u)}})}(s.clone(),e),s.blob()})}};function kn(n){let e=n;const t=new Set;return{get value(){return e},set(s){Object.is(e,s)||(e=s,t.forEach(r=>r(e)))},update(s){this.set(s(e))},subscribe:s=>(t.add(s),()=>t.delete(s))}}function cl(n,e){const t=kn(n());return e.forEach(s=>s.subscribe(()=>{const r=n();Object.is(t.value,r)||t.set(r)})),{get value(){return t.value},subscribe:s=>t.subscribe(s)}}function ea(n,e){let t;const s=()=>{t&&(t(),t=void 0),t=n()},r=e.map(i=>i.subscribe(s));return s(),()=>{t&&(t(),t=void 0),r.forEach(i=>i())}}class B6 extends yf{get isPlayingSignal(){return this._isPlaying}get currentTimeSignal(){return this._currentTime}get durationSignal(){return this._duration}get volumeSignal(){return this._volume}get mutedSignal(){return this._muted}get playbackRateSignal(){return this._playbackRate}get seekingSignal(){return this._seeking}constructor(e){super(),this.isExternalMedia=!1,this.reactiveMediaEventCleanups=[],e.media?(this.media=e.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),this._isPlaying=kn(!1),this._currentTime=kn(0),this._duration=kn(0),this._volume=kn(this.media.volume),this._muted=kn(this.media.muted),this._playbackRate=kn(this.media.playbackRate||1),this._seeking=kn(!1),this.setupReactiveMediaEvents(),e.mediaControls&&(this.media.controls=!0),e.autoplay&&(this.media.autoplay=!0),e.playbackRate!=null&&this.onMediaEvent("canplay",()=>{e.playbackRate!=null&&(this.media.playbackRate=e.playbackRate)},{once:!0})}setupReactiveMediaEvents(){this.reactiveMediaEventCleanups.push(this.onMediaEvent("play",()=>{this._isPlaying.set(!0)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("pause",()=>{this._isPlaying.set(!1)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("ended",()=>{this._isPlaying.set(!1)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("timeupdate",()=>{this._currentTime.set(this.media.currentTime)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("durationchange",()=>{this._duration.set(this.media.duration||0)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("loadedmetadata",()=>{this._duration.set(this.media.duration||0)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("seeking",()=>{this._seeking.set(!0)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("seeked",()=>{this._seeking.set(!1)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("volumechange",()=>{this._volume.set(this.media.volume),this._muted.set(this.media.muted)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("ratechange",()=>{this._playbackRate.set(this.media.playbackRate)}))}onMediaEvent(e,t,s){return this.media.addEventListener(e,t,s),()=>this.media.removeEventListener(e,t,s)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const e=this.getSrc();e.startsWith("blob:")&&URL.revokeObjectURL(e)}canPlayType(e){return this.media.canPlayType(e)!==""}setSrc(e,t){const s=this.getSrc();if(e&&s===e)return;this.revokeSrc();const r=t instanceof Blob&&(this.canPlayType(t.type)||!e)?URL.createObjectURL(t):e;if(s&&this.media.removeAttribute("src"),r||e)try{this.media.src=r}catch{this.media.src=e}}destroy(){this.reactiveMediaEventCleanups.forEach(e=>e()),this.reactiveMediaEventCleanups=[],this.isExternalMedia||(this.media.pause(),this.revokeSrc(),this.media.removeAttribute("src"),this.media.load(),this.media.remove())}setMediaElement(e){this.reactiveMediaEventCleanups.forEach(t=>t()),this.reactiveMediaEventCleanups=[],this.media=e,this.setupReactiveMediaEvents()}play(){return Fs(this,void 0,void 0,function*(){try{return yield this.media.play()}catch(e){if(e instanceof DOMException&&e.name==="AbortError")return;throw e}})}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(e){this.media.currentTime=Math.max(0,Math.min(e,this.getDuration()))}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(e){this.media.volume=e}getMuted(){return this.media.muted}setMuted(e){this.media.muted=e}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(e,t){t!=null&&(this.media.preservesPitch=t),this.media.playbackRate=e}getMediaElement(){return this.media}setSinkId(e){return this.media.setSinkId(e)}}function j6({maxTop:n,maxBottom:e,halfHeight:t,vScale:s,barMinHeight:r=0,barAlign:i}){let o=Math.round(n*t*s),a=o+Math.round(e*t*s)||1;return a<r&&(a=r,i||(o=a/2)),{topHeight:o,totalHeight:a}}function U6({barAlign:n,halfHeight:e,topHeight:t,totalHeight:s,canvasHeight:r}){return n==="top"?0:n==="bottom"?r-s:e-t}function PA(n,e,t){const s=e-n.left,r=t-n.top;return[s/n.width,r/n.height]}function YP(n){return!!(n.barWidth||n.barGap||n.barAlign)}function OA(n,e){if(!YP(e))return n;const t=e.barWidth||.5,s=t+(e.barGap||t/2);return s===0?n:Math.floor(n/s)*s}function FA({scrollLeft:n,totalWidth:e,numCanvases:t}){if(e===0)return[0];const s=n/e,r=Math.floor(s*t);return[r-1,r,r+1]}function QP(n){const e=n._cleanup;typeof e=="function"&&e()}function W6(n){const e=kn({scrollLeft:n.scrollLeft,scrollWidth:n.scrollWidth,clientWidth:n.clientWidth}),t=cl(()=>function(i){const{scrollLeft:o,scrollWidth:a,clientWidth:l}=i;if(a===0)return{startX:0,endX:1};const c=o/a,u=(o+l)/a;return{startX:Math.max(0,Math.min(1,c)),endX:Math.max(0,Math.min(1,u))}}(e.value),[e]),s=cl(()=>function(i){return{left:i.scrollLeft,right:i.scrollLeft+i.clientWidth}}(e.value),[e]),r=()=>{e.set({scrollLeft:n.scrollLeft,scrollWidth:n.scrollWidth,clientWidth:n.clientWidth})};return n.addEventListener("scroll",r,{passive:!0}),{scrollData:e,percentages:t,bounds:s,cleanup:()=>{n.removeEventListener("scroll",r),QP(e)}}}class G6 extends yf{constructor(e,t){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.subscriptions=[],this.unsubscribeOnScroll=[],this.dragStream=null,this.scrollStream=null,this.subscriptions=[],this.options=e;const s=this.parentFromOptionsContainer(e.container);this.parent=s;const[r,i]=this.initHtml();s.appendChild(r),this.container=r,this.scrollContainer=i.querySelector(".scroll"),this.wrapper=i.querySelector(".wrapper"),this.canvasWrapper=i.querySelector(".canvases"),this.progressWrapper=i.querySelector(".progress"),this.cursor=i.querySelector(".cursor"),t&&i.appendChild(t),this.initEvents()}parentFromOptionsContainer(e){let t;if(typeof e=="string"?t=document.querySelector(e):e instanceof HTMLElement&&(t=e),!t)throw new Error("Container not found");return t}initEvents(){this.wrapper.addEventListener("click",t=>{const s=this.wrapper.getBoundingClientRect(),[r,i]=PA(s,t.clientX,t.clientY);this.emit("click",r,i)}),this.wrapper.addEventListener("dblclick",t=>{const s=this.wrapper.getBoundingClientRect(),[r,i]=PA(s,t.clientX,t.clientY);this.emit("dblclick",r,i)}),this.options.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.scrollStream=W6(this.scrollContainer);const e=ea(()=>{const{startX:t,endX:s}=this.scrollStream.percentages.value,{left:r,right:i}=this.scrollStream.bounds.value;this.emit("scroll",t,s,r,i)},[this.scrollStream.percentages,this.scrollStream.bounds]);if(this.subscriptions.push(e),typeof ResizeObserver=="function"){const t=this.createDelay(100);this.resizeObserver=new ResizeObserver(()=>{t().then(()=>this.onContainerResize()).catch(()=>{})}),this.resizeObserver.observe(this.scrollContainer)}}onContainerResize(){const e=this.parent.clientWidth;e===this.lastContainerWidth&&this.options.height!=="auto"||(this.lastContainerWidth=e,this.reRender(),this.emit("resize"))}initDrag(){if(this.dragStream)return;this.dragStream=function(t,s={}){const{threshold:r=3,mouseButton:i=0,touchDelay:o=100}=s,a=kn(null),l=new Map,c=matchMedia("(pointer: coarse)").matches;let u=()=>{};const h=d=>{if(d.button!==i||(l.set(d.pointerId,d),l.size>1))return;let p=d.clientX,f=d.clientY,g=!1;const m=Date.now(),y=t.getBoundingClientRect(),{left:w,top:v}=y,I=k=>{if(k.defaultPrevented||l.size>1||c&&Date.now()-m<o)return;const S=k.clientX,A=k.clientY,P=S-p,D=A-f;(g||Math.abs(P)>r||Math.abs(D)>r)&&(k.preventDefault(),k.stopPropagation(),g||(a.set({type:"start",x:p-w,y:f-v}),g=!0),a.set({type:"move",x:S-w,y:A-v,deltaX:P,deltaY:D}),p=S,f=A)},_=k=>{if(l.delete(k.pointerId),g){const S=k.clientX,A=k.clientY;a.set({type:"end",x:S-w,y:A-v})}u()},N=k=>{l.delete(k.pointerId),k.relatedTarget&&k.relatedTarget!==document.documentElement||_(k)},T=k=>{g&&(k.stopPropagation(),k.preventDefault())},E=k=>{k.defaultPrevented||l.size>1||g&&k.preventDefault()};document.addEventListener("pointermove",I),document.addEventListener("pointerup",_),document.addEventListener("pointerout",N),document.addEventListener("pointercancel",N),document.addEventListener("touchmove",E,{passive:!1}),document.addEventListener("click",T,{capture:!0}),u=()=>{document.removeEventListener("pointermove",I),document.removeEventListener("pointerup",_),document.removeEventListener("pointerout",N),document.removeEventListener("pointercancel",N),document.removeEventListener("touchmove",E),setTimeout(()=>{document.removeEventListener("click",T,{capture:!0})},10)}};return t.addEventListener("pointerdown",h),{signal:a,cleanup:()=>{u(),t.removeEventListener("pointerdown",h),l.clear(),QP(a)}}}(this.wrapper);const e=ea(()=>{const t=this.dragStream.signal.value;if(!t)return;const s=this.wrapper.getBoundingClientRect().width,r=(i=t.x/s)<0?0:i>1?1:i;var i;t.type==="start"?(this.isDragging=!0,this.emit("dragstart",r)):t.type==="move"?this.emit("drag",r):t.type==="end"&&(this.isDragging=!1,this.emit("dragend",r))},[this.dragStream.signal]);this.subscriptions.push(e)}initHtml(){const e=document.createElement("div"),t=e.attachShadow({mode:"open"}),s=this.options.cspNonce&&typeof this.options.cspNonce=="string"?this.options.cspNonce.replace(/"/g,""):"";return t.innerHTML=`
      <style${s?` nonce="${s}"`:""}>
        :host {
          user-select: none;
          min-width: 1px;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight(this.options.height,this.options.splitChannels)}px;
          pointer-events: none;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper" part="wrapper">
          <div class="canvases" part="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[e,t]}setOptions(e){if(this.options.container!==e.container){const t=this.parentFromOptionsContainer(e.container);t.appendChild(this.container),this.parent=t}e.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.options=e,this.reRender()}getWrapper(){return this.wrapper}getWidth(){return this.scrollContainer.clientWidth}getScroll(){return this.scrollContainer.scrollLeft}setScroll(e){this.scrollContainer.scrollLeft=e}setScrollPercentage(e){const{scrollWidth:t}=this.scrollContainer,s=t*e;this.setScroll(s)}destroy(){var e;this.subscriptions.forEach(t=>t()),this.container.remove(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),(e=this.unsubscribeOnScroll)===null||e===void 0||e.forEach(t=>t()),this.unsubscribeOnScroll=[],this.dragStream&&(this.dragStream.cleanup(),this.dragStream=null),this.scrollStream&&(this.scrollStream.cleanup(),this.scrollStream=null)}createDelay(e=10){let t,s;const r=()=>{t&&(clearTimeout(t),t=void 0),s&&(s(),s=void 0)};return this.timeouts.push(r),()=>new Promise((i,o)=>{r(),s=o,t=setTimeout(()=>{t=void 0,s=void 0,i()},e)})}getHeight(e,t){var s;const r=((s=this.audioData)===null||s===void 0?void 0:s.numberOfChannels)||1;return function({optionsHeight:i,optionsSplitChannels:o,parentHeight:a,numberOfChannels:l,defaultHeight:c=128}){if(i==null)return c;const u=Number(i);if(!isNaN(u))return u;if(i==="auto"){const h=a||c;return o!=null&&o.every(d=>!d.overlay)?h/l:h}return c}({optionsHeight:e,optionsSplitChannels:t,parentHeight:this.parent.clientHeight,numberOfChannels:r,defaultHeight:128})}convertColorValues(e,t){return function(s,r,i){if(!Array.isArray(s))return s||"";if(s.length===0)return"#999";if(s.length<2)return s[0]||"";const o=document.createElement("canvas"),a=o.getContext("2d"),l=i??o.height*r,c=a.createLinearGradient(0,0,0,l||r),u=1/(s.length-1);return s.forEach((h,d)=>{c.addColorStop(d*u,h)}),c}(e,this.getPixelRatio(),t==null?void 0:t.canvas.height)}getPixelRatio(){return e=window.devicePixelRatio,Math.max(1,e||1);var e}renderBarWaveform(e,t,s,r){const{width:i,height:o}=s.canvas,{halfHeight:a,barWidth:l,barRadius:c,barIndexScale:u,barSpacing:h,barMinHeight:d}=function({width:f,height:g,length:m,options:y,pixelRatio:w}){const v=g/2,I=y.barWidth?y.barWidth*w:1,_=y.barGap?y.barGap*w:y.barWidth?I/2:0,N=I+_||1;return{halfHeight:v,barWidth:I,barGap:_,barRadius:y.barRadius||0,barMinHeight:y.barMinHeight?y.barMinHeight*w:0,barIndexScale:m>0?f/N/m:0,barSpacing:N}}({width:i,height:o,length:(e[0]||[]).length,options:t,pixelRatio:this.getPixelRatio()}),p=function({channelData:f,barIndexScale:g,barSpacing:m,barWidth:y,halfHeight:w,vScale:v,canvasHeight:I,barAlign:_,barMinHeight:N}){const T=f[0]||[],E=f[1]||T,k=T.length,S=[];let A=0,P=0,D=0;for(let V=0;V<=k;V++){const U=Math.round(V*g);if(U>A){const{topHeight:K,totalHeight:ee}=j6({maxTop:P,maxBottom:D,halfHeight:w,vScale:v,barMinHeight:N,barAlign:_}),L=U6({barAlign:_,halfHeight:w,topHeight:K,totalHeight:ee,canvasHeight:I});S.push({x:A*m,y:L,width:y,height:ee}),A=U,P=0,D=0}const q=Math.abs(T[V]||0),J=Math.abs(E[V]||0);q>P&&(P=q),J>D&&(D=J)}return S}({channelData:e,barIndexScale:u,barSpacing:h,barWidth:l,halfHeight:a,vScale:r,canvasHeight:o,barAlign:t.barAlign,barMinHeight:d});s.beginPath();for(const f of p)c&&"roundRect"in s?s.roundRect(f.x,f.y,f.width,f.height,c):s.rect(f.x,f.y,f.width,f.height);s.fill(),s.closePath()}renderLineWaveform(e,t,s,r){const{width:i,height:o}=s.canvas,a=function({channelData:l,width:c,height:u,vScale:h}){const d=u/2,p=l[0]||[];return[p,l[1]||p].map((f,g)=>{const m=f.length,y=m?c/m:0,w=d,v=g===0?-1:1,I=[{x:0,y:w}];let _=0,N=0;for(let T=0;T<=m;T++){const E=Math.round(T*y);if(E>_){const S=w+(Math.round(N*d*h)||1)*v;I.push({x:_,y:S}),_=E,N=0}const k=Math.abs(f[T]||0);k>N&&(N=k)}return I.push({x:_,y:w}),I})}({channelData:e,width:i,height:o,vScale:r});s.beginPath();for(const l of a)if(l.length){s.moveTo(l[0].x,l[0].y);for(let c=1;c<l.length;c++){const u=l[c];s.lineTo(u.x,u.y)}}s.fill(),s.closePath()}renderWaveform(e,t,s){if(s.fillStyle=this.convertColorValues(t.waveColor,s),t.renderFunction)return void t.renderFunction(e,s);const r=function({channelData:i,barHeight:o,normalize:a,maxPeak:l}){var c;const u=o||1;if(!a)return u;const h=i[0];if(!h||h.length===0)return u;let d=l??0;if(!l)for(let p=0;p<h.length;p++){const f=(c=h[p])!==null&&c!==void 0?c:0,g=Math.abs(f);g>d&&(d=g)}return d?u/d:u}({channelData:e,barHeight:t.barHeight,normalize:t.normalize,maxPeak:t.maxPeak});YP(t)?this.renderBarWaveform(e,t,s,r):this.renderLineWaveform(e,t,s,r)}renderSingleCanvas(e,t,s,r,i,o,a){const l=this.getPixelRatio(),c=document.createElement("canvas");c.width=Math.round(s*l),c.height=Math.round(r*l),c.style.width=`${s}px`,c.style.height=`${r}px`,c.style.left=`${Math.round(i)}px`,o.appendChild(c);const u=c.getContext("2d");if(t.renderFunction?(u.fillStyle=this.convertColorValues(t.waveColor,u),t.renderFunction(e,u)):this.renderWaveform(e,t,u),c.width>0&&c.height>0){const h=c.cloneNode(),d=h.getContext("2d");d.drawImage(c,0,0),d.globalCompositeOperation="source-in",d.fillStyle=this.convertColorValues(t.progressColor,d),d.fillRect(0,0,c.width,c.height),a.appendChild(h)}}renderMultiCanvas(e,t,s,r,i,o){const a=this.getPixelRatio(),{clientWidth:l}=this.scrollContainer,c=s/a,u=function({clientWidth:f,totalWidth:g,options:m}){return OA(Math.min(8e3,f,g),m)}({clientWidth:l,totalWidth:c,options:t});let h={};if(u===0)return;const d=f=>{if(f<0||f>=p||h[f])return;h[f]=!0;const g=f*u;let m=Math.min(c-g,u);if(m=OA(m,t),m<=0)return;const y=function({channelData:w,offset:v,clampedWidth:I,totalWidth:_}){return w.map(N=>{const T=Math.floor(v/_*N.length),E=Math.floor((v+I)/_*N.length);return N.slice(T,E)})}({channelData:e,offset:g,clampedWidth:m,totalWidth:c});this.renderSingleCanvas(y,t,m,r,g,i,o)},p=Math.ceil(c/u);if(!this.isScrollable){for(let f=0;f<p;f++)d(f);return}if(FA({scrollLeft:this.scrollContainer.scrollLeft,totalWidth:c,numCanvases:p}).forEach(f=>d(f)),p>1){const f=this.on("scroll",()=>{const{scrollLeft:g}=this.scrollContainer;Object.keys(h).length>10&&(i.innerHTML="",o.innerHTML="",h={}),FA({scrollLeft:g,totalWidth:c,numCanvases:p}).forEach(m=>d(m))});this.unsubscribeOnScroll.push(f)}}renderChannel(e,t,s,r){var{overlay:i}=t,o=function(u,h){var d={};for(var p in u)Object.prototype.hasOwnProperty.call(u,p)&&h.indexOf(p)<0&&(d[p]=u[p]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function"){var f=0;for(p=Object.getOwnPropertySymbols(u);f<p.length;f++)h.indexOf(p[f])<0&&Object.prototype.propertyIsEnumerable.call(u,p[f])&&(d[p[f]]=u[p[f]])}return d}(t,["overlay"]);const a=document.createElement("div"),l=this.getHeight(o.height,o.splitChannels);a.style.height=`${l}px`,i&&r>0&&(a.style.marginTop=`-${l}px`),this.canvasWrapper.style.minHeight=`${l}px`,this.canvasWrapper.appendChild(a);const c=a.cloneNode();this.progressWrapper.appendChild(c),this.renderMultiCanvas(e,o,s,l,a,c)}render(e){return Fs(this,void 0,void 0,function*(){var t;this.timeouts.forEach(c=>c()),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",this.options.width!=null&&(this.scrollContainer.style.width=typeof this.options.width=="number"?`${this.options.width}px`:this.options.width);const s=this.getPixelRatio(),r=this.scrollContainer.clientWidth,{scrollWidth:i,isScrollable:o,useParentWidth:a,width:l}=function({duration:c,minPxPerSec:u=0,parentWidth:h,fillParent:d,pixelRatio:p}){const f=Math.ceil(c*u),g=f>h,m=!!(d&&!g);return{scrollWidth:f,isScrollable:g,useParentWidth:m,width:(m?h:f)*p}}({duration:e.duration,minPxPerSec:this.options.minPxPerSec||0,parentWidth:r,fillParent:this.options.fillParent,pixelRatio:s});if(this.isScrollable=o,this.wrapper.style.width=a?"100%":`${i}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=e,this.emit("render"),this.options.splitChannels)for(let c=0;c<e.numberOfChannels;c++){const u=Object.assign(Object.assign({},this.options),(t=this.options.splitChannels)===null||t===void 0?void 0:t[c]);this.renderChannel([e.getChannelData(c)],u,l,c)}else{const c=[e.getChannelData(0)];e.numberOfChannels>1&&c.push(e.getChannelData(1)),this.renderChannel(c,this.options,l,0)}Promise.resolve().then(()=>this.emit("rendered"))})}reRender(){if(this.unsubscribeOnScroll.forEach(s=>s()),this.unsubscribeOnScroll=[],!this.audioData)return;const{scrollWidth:e}=this.scrollContainer,{right:t}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&e!==this.scrollContainer.scrollWidth){const{right:s}=this.progressWrapper.getBoundingClientRect(),r=function(i){const o=2*i;return(o<0?Math.floor(o):Math.ceil(o))/2}(s-t);this.scrollContainer.scrollLeft+=r}}zoom(e){this.options.minPxPerSec=e,this.reRender()}scrollIntoView(e,t=!1){const{scrollLeft:s,scrollWidth:r,clientWidth:i}=this.scrollContainer,o=e*r,a=s,l=s+i,c=i/2;if(this.isDragging)o+30>l?this.scrollContainer.scrollLeft+=30:o-30<a&&(this.scrollContainer.scrollLeft-=30);else{(o<a||o>l)&&(this.scrollContainer.scrollLeft=o-(this.options.autoCenter?c:0));const u=o-s-c;t&&this.options.autoCenter&&u>0&&(this.scrollContainer.scrollLeft+=u)}}renderProgress(e,t){if(isNaN(e))return;const s=100*e;this.canvasWrapper.style.clipPath=`polygon(${s}% 0%, 100% 0%, 100% 100%, ${s}% 100%)`,this.progressWrapper.style.width=`${s}%`,this.cursor.style.left=`${s}%`,this.cursor.style.transform=this.options.cursorWidth?`translateX(-${e*this.options.cursorWidth}px)`:"",this.isScrollable&&this.options.autoScroll&&this.audioData&&this.audioData.duration>0&&this.scrollIntoView(e,t)}exportImage(e,t,s){return Fs(this,void 0,void 0,function*(){const r=this.canvasWrapper.querySelectorAll("canvas");if(!r.length)throw new Error("No waveform data");if(s==="dataURL"){const i=Array.from(r).map(o=>o.toDataURL(e,t));return Promise.resolve(i)}return Promise.all(Array.from(r).map(i=>new Promise((o,a)=>{i.toBlob(l=>{l?o(l):a(new Error("Could not export image"))},e,t)})))})}}class H6 extends yf{constructor(){super(...arguments),this.animationFrameId=null,this.isRunning=!1}start(){if(this.isRunning)return;this.isRunning=!0;const e=()=>{this.isRunning&&(this.emit("tick"),this.animationFrameId=requestAnimationFrame(e))};e()}stop(){this.isRunning=!1,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}destroy(){this.stop()}}class Nv extends yf{constructor(e=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=e,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return Fs(this,void 0,void 0,function*(){})}get src(){return this.currentSrc}set src(e){if(this.currentSrc=e,this._duration=void 0,!e)return this.buffer=null,void this.emit("emptied");fetch(e).then(t=>{if(t.status>=400)throw new Error(`Failed to fetch ${e}: ${t.status} (${t.statusText})`);return t.arrayBuffer()}).then(t=>this.currentSrc!==e?null:this.audioContext.decodeAudioData(t)).then(t=>{this.currentSrc===e&&(this.buffer=t,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())}).catch(t=>{console.error("WebAudioPlayer load error:",t)})}_play(){if(!this.paused)return;this.paused=!1,this.bufferNode&&(this.bufferNode.onended=null,this.bufferNode.disconnect()),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let e=this.playedDuration*this._playbackRate;(e>=this.duration||e<0)&&(e=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,e),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var e;this.paused=!0,(e=this.bufferNode)===null||e===void 0||e.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return Fs(this,void 0,void 0,function*(){this.paused&&(this._play(),this.emit("play"))})}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(e){const t=e-this.currentTime,s=this.bufferNode;s==null||s.stop(this.audioContext.currentTime+t),s==null||s.addEventListener("ended",()=>{s===this.bufferNode&&(this.bufferNode=null,this.pause())},{once:!0})}setSinkId(e){return Fs(this,void 0,void 0,function*(){return this.audioContext.setSinkId(e)})}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this.bufferNode&&(this.bufferNode.playbackRate.value=e)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(e){const t=!this.paused;t&&this._pause(),this.playedDuration=e/this._playbackRate,t&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var e,t;return(e=this._duration)!==null&&e!==void 0?e:((t=this.buffer)===null||t===void 0?void 0:t.duration)||0}set duration(e){this._duration=e}get volume(){return this.gainNode.gain.value}set volume(e){this.gainNode.gain.value=e,this.emit("volumechange")}get muted(){return this._muted}set muted(e){this._muted!==e&&(this._muted=e,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(e){return/^(audio|video)\//.test(e)}getGainNode(){return this.gainNode}getChannelData(){const e=[];if(!this.buffer)return e;const t=this.buffer.numberOfChannels;for(let s=0;s<t;s++)e.push(this.buffer.getChannelData(s));return e}removeAttribute(e){switch(e){case"src":this.src="";break;case"playbackRate":this.playbackRate=0;break;case"currentTime":this.currentTime=0;break;case"duration":this.duration=0;break;case"volume":this.volume=0;break;case"muted":this.muted=!1}}}const q6={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class yp extends B6{static create(e){return new yp(e)}getState(){return this.wavesurferState}getRenderer(){return this.renderer}constructor(e){const t=e.media||(e.backend==="WebAudio"?new Nv:void 0);super({media:t,mediaControls:e.mediaControls,autoplay:e.autoplay,playbackRate:e.audioRate}),this.plugins=[],this.decodedData=null,this.stopAtPosition=null,this.subscriptions=[],this.mediaSubscriptions=[],this.abortController=null,this.reactiveCleanups=[],this.options=Object.assign({},q6,e);const{state:s,actions:r}=function(a){var l,c,u,h,d,p;const f=(l=a==null?void 0:a.currentTime)!==null&&l!==void 0?l:kn(0),g=(c=a==null?void 0:a.duration)!==null&&c!==void 0?c:kn(0),m=(u=a==null?void 0:a.isPlaying)!==null&&u!==void 0?u:kn(!1),y=(h=a==null?void 0:a.isSeeking)!==null&&h!==void 0?h:kn(!1),w=(d=a==null?void 0:a.volume)!==null&&d!==void 0?d:kn(1),v=(p=a==null?void 0:a.playbackRate)!==null&&p!==void 0?p:kn(1),I=kn(null),_=kn(null),N=kn(""),T=kn(0),E=kn(0),k=cl(()=>!m.value,[m]),S=cl(()=>I.value!==null,[I]),A=cl(()=>S.value&&g.value>0,[S,g]),P=cl(()=>f.value,[f]),D=cl(()=>g.value>0?f.value/g.value:0,[f,g]);return{state:{currentTime:f,duration:g,isPlaying:m,isPaused:k,isSeeking:y,volume:w,playbackRate:v,audioBuffer:I,peaks:_,url:N,zoom:T,scrollPosition:E,canPlay:S,isReady:A,progress:P,progressPercent:D},actions:{setCurrentTime:V=>{const U=Math.max(0,Math.min(g.value||1/0,V));f.set(U)},setDuration:V=>{g.set(Math.max(0,V))},setPlaying:V=>{m.set(V)},setSeeking:V=>{y.set(V)},setVolume:V=>{const U=Math.max(0,Math.min(1,V));w.set(U)},setPlaybackRate:V=>{const U=Math.max(.1,Math.min(16,V));v.set(U)},setAudioBuffer:V=>{I.set(V),V&&g.set(V.duration)},setPeaks:V=>{_.set(V)},setUrl:V=>{N.set(V)},setZoom:V=>{T.set(Math.max(0,V))},setScrollPosition:V=>{E.set(Math.max(0,V))}}}}({isPlaying:this.isPlayingSignal,currentTime:this.currentTimeSignal,duration:this.durationSignal,volume:this.volumeSignal,playbackRate:this.playbackRateSignal,isSeeking:this.seekingSignal});this.wavesurferState=s,this.wavesurferActions=r,this.timer=new H6;const i=t?void 0:this.getMediaElement();this.renderer=new G6(this.options,i),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initReactiveState(),this.initPlugins();const o=this.options.url||this.getSrc()||"";Promise.resolve().then(()=>{this.emit("init");const{peaks:a,duration:l}=this.options;(o||a&&l)&&this.load(o,a,l).catch(c=>{this.emit("error",c instanceof Error?c:new Error(String(c)))})})}updateProgress(e=this.getCurrentTime()){return this.renderer.renderProgress(e/this.getDuration(),this.isPlaying()),e}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",()=>{if(!this.isSeeking()){const e=this.updateProgress();this.emit("timeupdate",e),this.emit("audioprocess",e),this.stopAtPosition!=null&&this.isPlaying()&&e>=this.stopAtPosition&&this.pause()}}))}initReactiveState(){this.reactiveCleanups.push(function(e,t){const s=[];s.push(ea(()=>{const o=e.isPlaying.value;t.emit(o?"play":"pause")},[e.isPlaying])),s.push(ea(()=>{const o=e.currentTime.value;t.emit("timeupdate",o),e.isPlaying.value&&t.emit("audioprocess",o)},[e.currentTime,e.isPlaying])),s.push(ea(()=>{e.isSeeking.value&&t.emit("seeking",e.currentTime.value)},[e.isSeeking,e.currentTime]));let r=!1;s.push(ea(()=>{e.isReady.value&&!r&&(r=!0,t.emit("ready",e.duration.value))},[e.isReady,e.duration]));let i=!1;return s.push(ea(()=>{const o=e.isPlaying.value,a=e.currentTime.value,l=e.duration.value,c=l>0&&a>=l;i&&!o&&c&&t.emit("finish"),i=o&&c},[e.isPlaying,e.currentTime,e.duration])),s.push(ea(()=>{const o=e.zoom.value;o>0&&t.emit("zoom",o)},[e.zoom])),()=>{s.forEach(o=>o())}}(this.wavesurferState,{emit:this.emit.bind(this)}))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",()=>{const e=this.updateProgress();this.emit("timeupdate",e)}),this.onMediaEvent("play",()=>{this.emit("play"),this.timer.start()}),this.onMediaEvent("pause",()=>{this.emit("pause"),this.timer.stop(),this.stopAtPosition=null}),this.onMediaEvent("emptied",()=>{this.timer.stop(),this.stopAtPosition=null}),this.onMediaEvent("ended",()=>{this.emit("timeupdate",this.getDuration()),this.emit("finish"),this.stopAtPosition=null}),this.onMediaEvent("seeking",()=>{this.emit("seeking",this.getCurrentTime())}),this.onMediaEvent("error",()=>{var e;this.emit("error",(e=this.getMediaElement().error)!==null&&e!==void 0?e:new Error("Media error")),this.stopAtPosition=null}))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",(e,t)=>{this.options.interact&&(this.seekTo(e),this.emit("interaction",e*this.getDuration()),this.emit("click",e,t))}),this.renderer.on("dblclick",(e,t)=>{this.emit("dblclick",e,t)}),this.renderer.on("scroll",(e,t,s,r)=>{const i=this.getDuration();this.emit("scroll",e*i,t*i,s,r)}),this.renderer.on("render",()=>{this.emit("redraw")}),this.renderer.on("rendered",()=>{this.emit("redrawcomplete")}),this.renderer.on("dragstart",e=>{this.emit("dragstart",e)}),this.renderer.on("dragend",e=>{this.emit("dragend",e)}),this.renderer.on("resize",()=>{this.emit("resize")}));{let e;const t=this.renderer.on("drag",s=>{var r;if(!this.options.interact)return;this.renderer.renderProgress(s),clearTimeout(e);let i=0;const o=this.options.dragToSeek;this.isPlaying()?i=0:o===!0?i=200:o&&typeof o=="object"&&(i=(r=o.debounceTime)!==null&&r!==void 0?r:200),e=setTimeout(()=>{this.seekTo(s)},i),this.emit("interaction",s*this.getDuration()),this.emit("drag",s)});this.subscriptions.push(()=>{clearTimeout(e),t()})}}initPlugins(){var e;!((e=this.options.plugins)===null||e===void 0)&&e.length&&this.options.plugins.forEach(t=>{this.registerPlugin(t)})}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach(e=>e()),this.mediaSubscriptions=[]}setOptions(e){this.options=Object.assign({},this.options,e),e.duration&&!e.peaks&&(this.decodedData=Dg.createBuffer(this.exportPeaks(),e.duration)),e.peaks&&e.duration&&(this.decodedData=Dg.createBuffer(e.peaks,e.duration)),this.renderer.setOptions(this.options),e.audioRate&&this.setPlaybackRate(e.audioRate),e.mediaControls!=null&&(this.getMediaElement().controls=e.mediaControls)}registerPlugin(e){if(this.plugins.includes(e))return e;e._init(this),this.plugins.push(e);const t=e.once("destroy",()=>{this.plugins=this.plugins.filter(s=>s!==e),this.subscriptions=this.subscriptions.filter(s=>s!==t)});return this.subscriptions.push(t),e}unregisterPlugin(e){this.plugins=this.plugins.filter(t=>t!==e),e.destroy()}getWrapper(){return this.renderer.getWrapper()}getWidth(){return this.renderer.getWidth()}getScroll(){return this.renderer.getScroll()}setScroll(e){return this.renderer.setScroll(e)}setScrollTime(e){const t=e/this.getDuration();this.renderer.setScrollPercentage(t)}getActivePlugins(){return this.plugins}loadAudio(e,t,s,r){return Fs(this,void 0,void 0,function*(){var i;if(this.emit("load",e),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,this.stopAtPosition=null,(i=this.abortController)===null||i===void 0||i.abort(),this.abortController=null,!t&&!s){const a=this.options.fetchParams||{};window.AbortController&&!a.signal&&(this.abortController=new AbortController,a.signal=this.abortController.signal);const l=u=>this.emit("loading",u);t=yield V6.fetchBlob(e,l,a);const c=this.options.blobMimeType;c&&(t=new Blob([t],{type:c}))}this.setSrc(e,t);const o=yield new Promise(a=>{const l=r||this.getDuration();l?a(l):this.mediaSubscriptions.push(this.onMediaEvent("loadedmetadata",()=>a(this.getDuration()),{once:!0}))});if(!e&&!t){const a=this.getMediaElement();a instanceof Nv&&(a.duration=o)}if(s)this.decodedData=Dg.createBuffer(s,o||0);else if(t){const a=yield t.arrayBuffer();this.decodedData=yield Dg.decode(a,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())})}load(e,t,s){return Fs(this,void 0,void 0,function*(){try{return yield this.loadAudio(e,void 0,t,s)}catch(r){throw this.emit("error",r),r}})}loadBlob(e,t,s){return Fs(this,void 0,void 0,function*(){try{return yield this.loadAudio("",e,t,s)}catch(r){throw this.emit("error",r),r}})}zoom(e){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(e),this.emit("zoom",e)}getDecodedData(){return this.decodedData}exportPeaks({channels:e=2,maxLength:t=8e3,precision:s=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const r=Math.min(e,this.decodedData.numberOfChannels),i=[];for(let o=0;o<r;o++){const a=this.decodedData.getChannelData(o),l=[],c=a.length/t;for(let u=0;u<t;u++){const h=a.slice(Math.floor(u*c),Math.ceil((u+1)*c));let d=0;for(let p=0;p<h.length;p++){const f=h[p];Math.abs(f)>Math.abs(d)&&(d=f)}l.push(Math.round(d*s)/s)}i.push(l)}return i}getDuration(){let e=super.getDuration()||0;return e!==0&&e!==1/0||!this.decodedData||(e=this.decodedData.duration),e}toggleInteraction(e){this.options.interact=e}setTime(e){this.stopAtPosition=null,super.setTime(e),this.updateProgress(e),this.emit("timeupdate",e)}seekTo(e){const t=this.getDuration()*e;this.setTime(t)}play(e,t){const s=Object.create(null,{play:{get:()=>super.play}});return Fs(this,void 0,void 0,function*(){e!=null&&this.setTime(e);const r=yield s.play.call(this);return t!=null&&(this.media instanceof Nv?this.media.stopAt(t):this.stopAtPosition=t),r})}playPause(){return Fs(this,void 0,void 0,function*(){return this.isPlaying()?this.pause():this.play()})}stop(){this.pause(),this.setTime(0)}skip(e){this.setTime(this.getCurrentTime()+e)}empty(){this.load("",[[0]],.001)}setMediaElement(e){this.unsubscribePlayerEvents(),super.setMediaElement(e),this.initPlayerEvents()}exportImage(){return Fs(this,arguments,void 0,function*(e="image/png",t=1,s="dataURL"){return this.renderer.exportImage(e,t,s)})}destroy(){var e;this.emit("destroy"),(e=this.abortController)===null||e===void 0||e.abort(),this.plugins.forEach(t=>t.destroy()),this.subscriptions.forEach(t=>t()),this.unsubscribePlayerEvents(),this.reactiveCleanups.forEach(t=>t()),this.reactiveCleanups=[],this.timer.destroy(),this.renderer.destroy(),super.destroy()}}yp.BasePlugin=class extends yf{constructor(n){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=n}onInit(){}_init(n){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=n,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(n=>n()),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}},yp.dom=z6;let ZP=class{constructor(){this.listeners={}}on(e,t,s){if(this.listeners[e]||(this.listeners[e]=new Set),s==null?void 0:s.once){const r=(...i)=>{this.un(e,r),t(...i)};return this.listeners[e].add(r),()=>this.un(e,r)}return this.listeners[e].add(t),()=>this.un(e,t)}un(e,t){var s;(s=this.listeners[e])===null||s===void 0||s.delete(t)}once(e,t){return this.on(e,t,{once:!0})}unAll(){this.listeners={}}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach(s=>s(...t))}},K6=class extends ZP{constructor(e){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=e}onInit(){}_init(e){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=e,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(e=>e()),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}};function JP(n,e){const t=e.xmlns?document.createElementNS(e.xmlns,n):document.createElement(n);for(const[s,r]of Object.entries(e))if(s==="children"&&r)for(const[i,o]of Object.entries(r))o instanceof Node?t.appendChild(o):typeof o=="string"?t.appendChild(document.createTextNode(o)):t.appendChild(JP(i,o));else s==="style"?Object.assign(t.style,r):s==="textContent"?t.textContent=r:t.setAttribute(s,r.toString());return t}function Fd(n,e,t){const s=JP(n,e||{});return t==null||t.appendChild(s),s}function eO(n){let e=n;const t=new Set;return{get value(){return e},set(s){Object.is(e,s)||(e=s,t.forEach(r=>r(e)))},update(s){this.set(s(e))},subscribe:s=>(t.add(s),()=>t.delete(s))}}function hy(n,e){let t;const s=()=>{t&&(t(),t=void 0),t=n()},r=e.map(i=>i.subscribe(s));return s(),()=>{t&&(t(),t=void 0),r.forEach(i=>i())}}function Lc(n,e){const t=eO(null),s=r=>{t.set(r)};return n.addEventListener(e,s),t._cleanup=()=>{n.removeEventListener(e,s)},t}function il(n){const e=n._cleanup;typeof e=="function"&&e()}function dy(n,e={}){const{threshold:t=3,mouseButton:s=0,touchDelay:r=100}=e,i=eO(null),o=new Map,a=matchMedia("(pointer: coarse)").matches;let l=()=>{};const c=u=>{if(u.button!==s||(o.set(u.pointerId,u),o.size>1))return;let h=u.clientX,d=u.clientY,p=!1;const f=Date.now(),g=n.getBoundingClientRect(),{left:m,top:y}=g,w=T=>{if(T.defaultPrevented||o.size>1||a&&Date.now()-f<r)return;const E=T.clientX,k=T.clientY,S=E-h,A=k-d;(p||Math.abs(S)>t||Math.abs(A)>t)&&(T.preventDefault(),T.stopPropagation(),p||(i.set({type:"start",x:h-m,y:d-y}),p=!0),i.set({type:"move",x:E-m,y:k-y,deltaX:S,deltaY:A}),h=E,d=k)},v=T=>{if(o.delete(T.pointerId),p){const E=T.clientX,k=T.clientY;i.set({type:"end",x:E-m,y:k-y})}l()},I=T=>{o.delete(T.pointerId),T.relatedTarget&&T.relatedTarget!==document.documentElement||v(T)},_=T=>{p&&(T.stopPropagation(),T.preventDefault())},N=T=>{T.defaultPrevented||o.size>1||p&&T.preventDefault()};document.addEventListener("pointermove",w),document.addEventListener("pointerup",v),document.addEventListener("pointerout",I),document.addEventListener("pointercancel",I),document.addEventListener("touchmove",N,{passive:!1}),document.addEventListener("click",_,{capture:!0}),l=()=>{document.removeEventListener("pointermove",w),document.removeEventListener("pointerup",v),document.removeEventListener("pointerout",I),document.removeEventListener("pointercancel",I),document.removeEventListener("touchmove",N),setTimeout(()=>{document.removeEventListener("click",_,{capture:!0})},10)}};return n.addEventListener("pointerdown",c),{signal:i,cleanup:()=>{l(),n.removeEventListener("pointerdown",c),o.clear(),il(i)}}}class LA extends ZP{constructor(e,t,s=0){var r,i,o,a,l,c,u,h,d,p;super(),this.totalDuration=t,this.numberOfChannels=s,this.element=null,this.minLength=0,this.maxLength=1/0,this.contentEditable=!1,this.subscriptions=[],this.updatingSide=void 0,this.isRemoved=!1,this.subscriptions=[],this.id=e.id||`region-${Math.random().toString(32).slice(2)}`,this.start=this.clampPosition(e.start),this.end=this.clampPosition((r=e.end)!==null&&r!==void 0?r:e.start),this.drag=(i=e.drag)===null||i===void 0||i,this.resize=(o=e.resize)===null||o===void 0||o,this.resizeStart=(a=e.resizeStart)===null||a===void 0||a,this.resizeEnd=(l=e.resizeEnd)===null||l===void 0||l,this.color=(c=e.color)!==null&&c!==void 0?c:"rgba(0, 0, 0, 0.1)",this.minLength=(u=e.minLength)!==null&&u!==void 0?u:this.minLength,this.maxLength=(h=e.maxLength)!==null&&h!==void 0?h:this.maxLength,this.channelIdx=(d=e.channelIdx)!==null&&d!==void 0?d:-1,this.contentEditable=(p=e.contentEditable)!==null&&p!==void 0?p:this.contentEditable,this.element=this.initElement(),this.setContent(e.content),this.setPart(),this.renderPosition(),this.initMouseEvents()}clampPosition(e){return Math.max(0,Math.min(this.totalDuration,e))}setPart(){var e;const t=this.start===this.end;(e=this.element)===null||e===void 0||e.setAttribute("part",`${t?"marker":"region"} ${this.id}`)}addResizeHandles(e){const t={position:"absolute",zIndex:"2",width:"6px",height:"100%",top:"0",cursor:"ew-resize",wordBreak:"keep-all"},s=Fd("div",{part:"region-handle region-handle-left",style:Object.assign(Object.assign({},t),{left:"0",borderLeft:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"2px 0 0 2px"})},e),r=Fd("div",{part:"region-handle region-handle-right",style:Object.assign(Object.assign({},t),{right:"0",borderRight:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"0 2px 2px 0"})},e),i=dy(s,{threshold:1}),o=dy(r,{threshold:1}),a=hy(()=>{const c=i.signal.value;c&&(c.type==="move"&&c.deltaX!==void 0?this.onResize(c.deltaX,"start"):c.type==="end"&&this.onEndResizing("start"))},[i.signal]),l=hy(()=>{const c=o.signal.value;c&&(c.type==="move"&&c.deltaX!==void 0?this.onResize(c.deltaX,"end"):c.type==="end"&&this.onEndResizing("end"))},[o.signal]);this.subscriptions.push(()=>{a(),l(),i.cleanup(),o.cleanup()})}removeResizeHandles(e){const t=e.querySelector('[part*="region-handle-left"]'),s=e.querySelector('[part*="region-handle-right"]');t&&e.removeChild(t),s&&e.removeChild(s)}initElement(){if(this.isRemoved)return null;const e=this.start===this.end;let t=0,s=100;this.channelIdx>=0&&this.numberOfChannels>0&&this.channelIdx<this.numberOfChannels&&(s=100/this.numberOfChannels,t=s*this.channelIdx);const r=Fd("div",{style:{position:"absolute",top:`${t}%`,height:`${s}%`,backgroundColor:e?"none":this.color,borderLeft:e?"2px solid "+this.color:"none",borderRadius:"2px",boxSizing:"border-box",transition:"background-color 0.2s ease",cursor:this.drag?"grab":"default",pointerEvents:"all"}});return!e&&this.resize&&this.addResizeHandles(r),r}renderPosition(){if(!this.element)return;const e=this.start/this.totalDuration,t=(this.totalDuration-this.end)/this.totalDuration;this.element.style.left=100*e+"%",this.element.style.right=100*t+"%"}toggleCursor(e){var t;this.drag&&(!((t=this.element)===null||t===void 0)&&t.style)&&(this.element.style.cursor=e?"grabbing":"grab")}initMouseEvents(){const{element:e}=this;if(!e)return;const t=Lc(e,"click"),s=Lc(e,"mouseenter"),r=Lc(e,"mouseleave"),i=Lc(e,"dblclick"),o=Lc(e,"pointerdown"),a=Lc(e,"pointerup"),l=t.subscribe(m=>m&&this.emit("click",m)),c=s.subscribe(m=>m&&this.emit("over",m)),u=r.subscribe(m=>m&&this.emit("leave",m)),h=i.subscribe(m=>m&&this.emit("dblclick",m)),d=o.subscribe(m=>m&&this.toggleCursor(!0)),p=a.subscribe(m=>m&&this.toggleCursor(!1));this.subscriptions.push(()=>{l(),c(),u(),h(),d(),p(),il(t),il(s),il(r),il(i),il(o),il(a)});const f=dy(e),g=hy(()=>{const m=f.signal.value;m&&(m.type==="start"?this.toggleCursor(!0):m.type==="move"&&m.deltaX!==void 0?this.onMove(m.deltaX):m.type==="end"&&(this.toggleCursor(!1),this.drag&&this.emit("update-end")))},[f.signal]);this.subscriptions.push(()=>{g(),f.cleanup()}),this.contentEditable&&this.content&&(this.contentClickListener=m=>this.onContentClick(m),this.contentBlurListener=()=>this.onContentBlur(),this.content.addEventListener("click",this.contentClickListener),this.content.addEventListener("blur",this.contentBlurListener))}_onUpdate(e,t,s){var r;if(!(!((r=this.element)===null||r===void 0)&&r.parentElement))return;const{width:i}=this.element.parentElement.getBoundingClientRect(),o=e/i*this.totalDuration;let a=t&&t!=="start"?this.start:this.start+o,l=t&&t!=="end"?this.end:this.end+o;const c=s!==void 0;c&&this.updatingSide&&this.updatingSide!==t&&(this.updatingSide==="start"?a=s:l=s),a=Math.max(0,a),l=Math.min(this.totalDuration,l);const u=l-a;this.updatingSide=t;const h=u>=this.minLength&&u<=this.maxLength;a<=l&&(h||c)&&(this.start=a,this.end=l,this.renderPosition(),this.emit("update",t))}onMove(e){this.drag&&this._onUpdate(e)}onResize(e,t){this.resize&&(this.resizeStart||t!=="start")&&(this.resizeEnd||t!=="end")&&this._onUpdate(e,t)}onEndResizing(e){this.resize&&(this.emit("update-end",e),this.updatingSide=void 0)}onContentClick(e){e.stopPropagation(),e.target.focus(),this.emit("click",e)}onContentBlur(){this.emit("update-end")}_setTotalDuration(e){this.totalDuration=e,this.renderPosition()}play(e){this.emit("play",e&&this.end!==this.start?this.end:void 0)}getContent(e=!1){var t;return e?this.content||void 0:this.element instanceof HTMLElement?((t=this.content)===null||t===void 0?void 0:t.innerHTML)||void 0:""}setContent(e){var t;if(this.element)if(this.content&&this.contentEditable&&(this.contentClickListener&&this.content.removeEventListener("click",this.contentClickListener),this.contentBlurListener&&this.content.removeEventListener("blur",this.contentBlurListener)),(t=this.content)===null||t===void 0||t.remove(),e){if(typeof e=="string"){const s=this.start===this.end;this.content=Fd("div",{style:{padding:`0.2em ${s?.2:.4}em`,display:"inline-block"},textContent:e})}else this.content=e;this.contentEditable&&(this.content.contentEditable="true",this.contentClickListener=s=>this.onContentClick(s),this.contentBlurListener=()=>this.onContentBlur(),this.content.addEventListener("click",this.contentClickListener),this.content.addEventListener("blur",this.contentBlurListener)),this.content.setAttribute("part","region-content"),this.element.appendChild(this.content),this.emit("content-changed")}else this.content=void 0}setOptions(e){var t,s;if(this.element){if(e.color&&(this.color=e.color,this.element.style.backgroundColor=this.color),e.drag!==void 0&&(this.drag=e.drag,this.element.style.cursor=this.drag?"grab":"default"),e.start!==void 0||e.end!==void 0){const r=this.start===this.end;this.start=this.clampPosition((t=e.start)!==null&&t!==void 0?t:this.start),this.end=this.clampPosition((s=e.end)!==null&&s!==void 0?s:r?this.start:this.end),this.renderPosition(),this.setPart()}if(e.content&&this.setContent(e.content),e.id&&(this.id=e.id,this.setPart()),e.resize!==void 0&&e.resize!==this.resize){const r=this.start===this.end;this.resize=e.resize,this.resize&&!r?this.addResizeHandles(this.element):this.removeResizeHandles(this.element)}e.resizeStart!==void 0&&(this.resizeStart=e.resizeStart),e.resizeEnd!==void 0&&(this.resizeEnd=e.resizeEnd)}}remove(){this.isRemoved=!0,this.emit("remove"),this.subscriptions.forEach(e=>e()),this.subscriptions=[],this.content&&this.contentEditable&&(this.contentClickListener&&(this.content.removeEventListener("click",this.contentClickListener),this.contentClickListener=void 0),this.contentBlurListener&&(this.content.removeEventListener("blur",this.contentBlurListener),this.contentBlurListener=void 0)),this.element&&(this.element.remove(),this.element=null),this.unAll()}}class WS extends K6{constructor(e){super(e),this.regions=[],this.regionsContainer=this.initRegionsContainer()}static create(e){return new WS(e)}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");this.wavesurfer.getWrapper().appendChild(this.regionsContainer),this.subscriptions.push(this.wavesurfer.on("ready",t=>{this.regions.forEach(s=>s._setTotalDuration(t))}));let e=[];this.subscriptions.push(this.wavesurfer.on("timeupdate",t=>{const s=this.regions.filter(r=>r.start<=t&&(r.end===r.start?r.start+.05:r.end)>=t);s.forEach(r=>{e.includes(r)||this.emit("region-in",r)}),e.forEach(r=>{s.includes(r)||this.emit("region-out",r)}),e=s}))}initRegionsContainer(){return Fd("div",{part:"regions-container",style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",zIndex:"5",pointerEvents:"none"}})}getRegions(){return this.regions}avoidOverlapping(e){e.content&&setTimeout(()=>{const t=e.content,s=t.getBoundingClientRect(),r=this.regions.map(i=>{if(i===e||!i.content)return 0;const o=i.content.getBoundingClientRect();return s.left<o.left+o.width&&o.left<s.left+s.width?o.height:0}).reduce((i,o)=>i+o,0);t.style.marginTop=`${r}px`},10)}adjustScroll(e){var t,s;if(!e.element)return;const r=(s=(t=this.wavesurfer)===null||t===void 0?void 0:t.getWrapper())===null||s===void 0?void 0:s.parentElement;if(!r)return;const{clientWidth:i,scrollWidth:o}=r;if(o<=i)return;const a=r.getBoundingClientRect(),l=e.element.getBoundingClientRect(),c=l.left-a.left,u=l.right-a.left;c<0?r.scrollLeft+=c:u>i&&(r.scrollLeft+=u-i)}virtualAppend(e,t,s){const r=()=>{if(!this.wavesurfer)return;const i=this.wavesurfer.getWidth(),o=this.wavesurfer.getScroll(),a=t.clientWidth,l=this.wavesurfer.getDuration(),c=Math.round(e.start/l*a),u=c+(Math.round((e.end-e.start)/l*a)||1)>o&&c<o+i;u&&!s.parentElement?t.appendChild(s):!u&&s.parentElement&&s.remove()};setTimeout(()=>{if(!this.wavesurfer||!e.element)return;r();const i=this.wavesurfer.on("scroll",r),o=this.wavesurfer.on("zoom",r),a=this.wavesurfer.on("resize",r);this.subscriptions.push(i,o,a),e.once("remove",()=>{i(),o(),a()})},0)}saveRegion(e){if(!e.element)return;this.virtualAppend(e,this.regionsContainer,e.element),this.avoidOverlapping(e),this.regions.push(e);const t=[e.on("update",s=>{s||this.adjustScroll(e),this.emit("region-update",e,s)}),e.on("update-end",s=>{this.avoidOverlapping(e),this.emit("region-updated",e,s)}),e.on("play",s=>{var r;(r=this.wavesurfer)===null||r===void 0||r.play(e.start,s)}),e.on("click",s=>{this.emit("region-clicked",e,s)}),e.on("dblclick",s=>{this.emit("region-double-clicked",e,s)}),e.on("content-changed",()=>{this.emit("region-content-changed",e)}),e.once("remove",()=>{t.forEach(s=>s()),this.regions=this.regions.filter(s=>s!==e),this.emit("region-removed",e)})];this.subscriptions.push(...t),this.emit("region-created",e)}addRegion(e){var t,s;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");const r=this.wavesurfer.getDuration(),i=(s=(t=this.wavesurfer)===null||t===void 0?void 0:t.getDecodedData())===null||s===void 0?void 0:s.numberOfChannels,o=new LA(e,r,i);return this.emit("region-initialized",o),r?this.saveRegion(o):this.subscriptions.push(this.wavesurfer.once("ready",a=>{o._setTotalDuration(a),this.saveRegion(o)})),o}enableDragSelection(e,t=3){var s;const r=(s=this.wavesurfer)===null||s===void 0?void 0:s.getWrapper();if(!(r&&r instanceof HTMLElement))return()=>{};let i=null,o=0,a=0;const l=dy(r,{threshold:t}),c=hy(()=>{var u,h;const d=l.signal.value;if(d)if(d.type==="start"){if(o=d.x,!this.wavesurfer)return;const p=this.wavesurfer.getDuration(),f=(h=(u=this.wavesurfer)===null||u===void 0?void 0:u.getDecodedData())===null||h===void 0?void 0:h.numberOfChannels,{width:g}=this.wavesurfer.getWrapper().getBoundingClientRect();a=o/g*p;const m=d.x/g*p,y=(d.x+5)/g*p;i=new LA(Object.assign(Object.assign({},e),{start:m,end:y}),p,f),this.emit("region-initialized",i),i.element&&this.regionsContainer.appendChild(i.element)}else d.type==="move"&&d.deltaX!==void 0?i&&i._onUpdate(d.deltaX,d.x>o?"end":"start",a):d.type==="end"&&i&&(this.saveRegion(i),i.updatingSide=void 0,i=null)},[l.signal]);return()=>{c(),l.cleanup()}}clearRegions(){this.regions.slice().forEach(e=>e.remove()),this.regions=[]}destroy(){this.clearRegions(),super.destroy(),this.regionsContainer.remove()}}class X6{constructor(){this.listeners={}}on(e,t,s){if(this.listeners[e]||(this.listeners[e]=new Set),s==null?void 0:s.once){const r=(...i)=>{this.un(e,r),t(...i)};return this.listeners[e].add(r),()=>this.un(e,r)}return this.listeners[e].add(t),()=>this.un(e,t)}un(e,t){var s;(s=this.listeners[e])===null||s===void 0||s.delete(t)}once(e,t){return this.on(e,t,{once:!0})}unAll(){this.listeners={}}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach(s=>s(...t))}}class Y6 extends X6{constructor(e){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=e}onInit(){}_init(e){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=e,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(e=>e()),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}}function tO(n,e){const t=e.xmlns?document.createElementNS(e.xmlns,n):document.createElement(n);for(const[s,r]of Object.entries(e))if(s==="children"&&r)for(const[i,o]of Object.entries(r))o instanceof Node?t.appendChild(o):typeof o=="string"?t.appendChild(document.createTextNode(o)):t.appendChild(tO(i,o));else s==="style"?Object.assign(t.style,r):s==="textContent"?t.textContent=r:t.setAttribute(s,r.toString());return t}function Av(n,e,t){return tO(n,e||{})}const Q6={height:20,timeOffset:0,formatTimeCallback:n=>n/60>1?`${Math.floor(n/60)}:${`${(n=Math.round(n%60))<10?"0":""}${n}`}`:`${Math.round(1e3*n)/1e3}`};class GS extends Y6{constructor(e){super(e||{}),this.notchElements=new Map,this.currentTimeline=null,this.options=Object.assign({},Q6,e),this.timelineWrapper=this.initTimelineWrapper()}static create(e){return new GS(e)}onInit(){var e;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");let t=this.wavesurfer.getWrapper();if(this.options.container instanceof HTMLElement)t=this.options.container;else if(typeof this.options.container=="string"){const r=document.querySelector(this.options.container);if(!r)throw Error(`No Timeline container found matching ${this.options.container}`);t=r}this.options.insertPosition?(t.firstElementChild||t).insertAdjacentElement(this.options.insertPosition,this.timelineWrapper):t.appendChild(this.timelineWrapper);const s=this.wavesurfer.getState();this.subscriptions.push(function(r,i){let o;const a=()=>{o&&(o(),o=void 0),o=r()},l=i.map(c=>c.subscribe(a));return a(),()=>{o&&(o(),o=void 0),l.forEach(c=>c())}}(()=>{(s.duration.value>0||this.options.duration)&&this.initTimeline()},[s.duration])),this.subscriptions.push(this.wavesurfer.on("redraw",()=>this.initTimeline())),this.subscriptions.push(this.wavesurfer.on("scroll",(r,i,o,a)=>{this.currentTimeline&&this.updateVisibleNotches(o,a,this.currentTimeline)})),(!((e=this.wavesurfer)===null||e===void 0)&&e.getDuration()||this.options.duration)&&this.initTimeline()}destroy(){this.timelineWrapper.remove(),super.destroy()}initTimelineWrapper(){return Av("div",{part:"timeline-wrapper",style:{pointerEvents:"none"}})}defaultTimeInterval(e){return e>=25?1:5*e>=25?5:15*e>=25?15:60*Math.ceil(.5/e)}defaultPrimaryLabelInterval(e){return e>=25?10:5*e>=25?6:4}defaultSecondaryLabelInterval(e){return e>=25?5:2}virtualAppend(e,t,s){if(this.notchElements.set(s,{start:e,width:s.clientWidth,wasVisible:!1}),!this.wavesurfer)return;const r=this.wavesurfer.getScroll(),i=r+this.wavesurfer.getWidth(),o=this.notchElements.get(s),a=e>=r&&e+o.width<i;o.wasVisible=a,a&&t.appendChild(s)}updateVisibleNotches(e,t,s){this.notchElements.forEach((r,i)=>{const o=r.start>=e&&r.start+r.width<t;o!==r.wasVisible&&(r.wasVisible=o,o?s.appendChild(i):i.remove())})}initTimeline(){var e,t,s,r,i,o,a,l;this.notchElements.clear();const c=(s=(t=(e=this.wavesurfer)===null||e===void 0?void 0:e.getDuration())!==null&&t!==void 0?t:this.options.duration)!==null&&s!==void 0?s:0,u=(((r=this.wavesurfer)===null||r===void 0?void 0:r.getWrapper().scrollWidth)||this.timelineWrapper.scrollWidth)/c,h=(i=this.options.timeInterval)!==null&&i!==void 0?i:this.defaultTimeInterval(u),d=(o=this.options.primaryLabelInterval)!==null&&o!==void 0?o:this.defaultPrimaryLabelInterval(u),p=this.options.primaryLabelSpacing,f=(a=this.options.secondaryLabelInterval)!==null&&a!==void 0?a:this.defaultSecondaryLabelInterval(u),g=this.options.secondaryLabelSpacing,m=this.options.insertPosition==="beforebegin",y=Av("div",{style:Object.assign({height:`${this.options.height}px`,overflow:"hidden",fontSize:this.options.height/2+"px",whiteSpace:"nowrap"},m?{position:"absolute",top:"0",left:"0",right:"0",zIndex:"2"}:{position:"relative"})});y.setAttribute("part","timeline"),typeof this.options.style=="string"?y.setAttribute("style",y.getAttribute("style")+this.options.style):typeof this.options.style=="object"&&Object.assign(y.style,this.options.style);const w=Av("div",{style:{width:"0",height:"50%",display:"flex",flexDirection:"column",justifyContent:m?"flex-start":"flex-end",top:m?"0":"auto",bottom:m?"auto":"0",overflow:"visible",borderLeft:"1px solid currentColor",opacity:`${(l=this.options.secondaryLabelOpacity)!==null&&l!==void 0?l:.25}`,position:"absolute",zIndex:"1"}});for(let v=0,I=0;v<c;v+=h,I++){const _=w.cloneNode(),N=Math.round(100*v)%Math.round(100*d)==0||p&&I%p==0,T=Math.round(100*v)%Math.round(100*f)==0||g&&I%g==0;(N||T)&&(_.style.height="100%",_.style.textIndent="3px",_.textContent=this.options.formatTimeCallback(v),N&&(_.style.opacity="1"));const E=N?"primary":T?"secondary":"tick";_.setAttribute("part",`timeline-notch timeline-notch-${E}`);const k=Math.round(100*(v+this.options.timeOffset))/100*u;_.style.left=`${k}px`,this.virtualAppend(k,y,_)}this.timelineWrapper.innerHTML="",this.timelineWrapper.appendChild(y),this.currentTimeline=y,this.emit("ready")}}function Z6({onBackToHome:n}){const[e,t]=te.useState("Ready. Upload an audio file or record your voice."),[s,r]=te.useState(null),[i,o]=te.useState(!1),[a,l]=te.useState(null),[c,u]=te.useState(null),[h,d]=te.useState(null),[p,f]=te.useState(b6),[g,m]=te.useState([]),[y,w]=te.useState(null),[v,I]=te.useState(null),[_,N]=te.useState("none"),T=te.useRef(null),[E,k]=te.useState(!1),[S,A]=te.useState(!1),[P,D]=te.useState(0),[V,U]=te.useState({format:"wav",quality:"cd",normalize:!0,fadeIn:0,fadeOut:0,trimSilence:!1}),[q,J]=te.useState(!1),[K,ee]=te.useState(!1),[L,ae]=te.useState(null),[ce,z]=te.useState(0),[ue,de]=te.useState("enhance"),[be,Ee]=te.useState(!1),[Re,_e]=te.useState(!1),Ae=te.useRef(null),je=te.useRef(null),qe=te.useRef(null),[gt,Et]=te.useState(null),[ot,xt]=te.useState({peak:0,rms:0,loudness:-60});te.useEffect(()=>{try{const Z=localStorage.getItem("hacker-voice-profiles");Z&&m(JSON.parse(Z))}catch(Z){console.error("Failed to load profiles:",Z)}},[]),te.useEffect(()=>{localStorage.setItem("hacker-voice-profiles",JSON.stringify(g))},[g]),te.useEffect(()=>()=>{c&&URL.revokeObjectURL(c),h&&URL.revokeObjectURL(h)},[c,h]),te.useEffect(()=>{c&&at(c)},[c]),te.useEffect(()=>{const Z=ye=>{if((ye.code==="Space"||ye.code==="KeyA"||ye.code==="KeyP")&&ye.preventDefault(),!(ye.target instanceof HTMLInputElement||ye.target instanceof HTMLTextAreaElement)&&y)switch(ye.code){case"Space":_==="preview"?qt():ie();break;case"KeyA":_==="original"?qt():Yn();break;case"KeyP":_==="preview"?qt():ie();break}};return document.addEventListener("keydown",Z),()=>document.removeEventListener("keydown",Z)},[y,_]);const Rt=async()=>{var Z;if(!y){r("No audio loaded for export");return}A(!0),D(0),r(null);try{const ye=ra();await ye.ensureAudioContext();const Le=await ye.renderOffline(y,p,bs=>D(bs*.8));D(.8);const nt=await KP.exportAudio(Le,V,bs=>D(.8+bs*.2)),Lt=B1.find(bs=>bs.id===V.format),lt=Lt==null?void 0:Lt.quality.find(bs=>bs.id===V.quality),Wt=`${((Z=a==null?void 0:a.name)==null?void 0:Z.split(".")[0])||"processed"}_${(lt==null?void 0:lt.name)||"export"}.${(Lt==null?void 0:Lt.extension)||"wav"}`,Mt=URL.createObjectURL(nt),Qs=document.createElement("a");Qs.href=Mt,Qs.download=Wt,Qs.click(),URL.revokeObjectURL(Mt),t(`Successfully exported: ${Wt}`),k(!1)}catch(ye){console.error("Export failed:",ye),r(`Export failed: ${ye instanceof Error?ye.message:"Unknown error"}`)}finally{A(!1),D(0)}},It=async()=>{if(!y){r("No audio loaded for quality assurance");return}ee(!0),z(0),r(null),J(!0);try{const Z=await M6.runMasterQualityInvigilator(y,p,ye=>{z(ye)});ae(Z),Z.nasa_grade_compliance?t("ðŸš€ NASA-grade quality assurance PASSED - Ready for deployment!"):Z.overallStatus==="pass"?t("âœ… Quality assurance passed with recommendations"):Z.overallStatus==="warning"?t("âš ï¸ Quality assurance passed with warnings"):t("âŒ Quality assurance failed - Review issues before deployment")}catch(Z){r(`Quality assurance failed: ${Z instanceof Error?Z.message:"Unknown error"}`)}finally{ee(!1)}},yn=async Z=>{if(!i){qt(),c&&URL.revokeObjectURL(c),h&&URL.revokeObjectURL(h),v&&(v.dispose(),I(null)),w(null),l(Z),u(URL.createObjectURL(Z)),d(null),r(null),N("none"),t(`Loading ${Z.name} for live preview...`);try{const ye=await AA(Z);w(ye);const Le=ra();await Le.ensureAudioContext();const nt=Le.buildPreviewGraph(ye,p);I(nt),Le.setPreviewGraph(nt),setTimeout(()=>{c&&at(c)},100),t(`${Z.name} ready. Use A/B preview or adjust effects.`)}catch(ye){console.error("Failed to load audio for preview:",ye),r("Failed to load audio file for preview."),t("Failed to load audio. Please try another file.")}}},at=Z=>{if(!je.current)return;qe.current&&qe.current.destroy();const ye=yp.create({container:je.current,waveColor:"#0aff6a",progressColor:"#07c06b",cursorColor:"#d92e2e",barWidth:2,barRadius:1,height:100,normalize:!0});ye.registerPlugin(GS.create({height:20,insertPosition:"beforebegin",timeInterval:.5,primaryLabelInterval:2,secondaryLabelInterval:1,style:{fontSize:"10px",color:"#9aa3b2"}}));const Le=ye.registerPlugin(WS.create());ye.load(Z),Le.on("region-created",nt=>{nt&&typeof nt=="object"&&"start"in nt&&"end"in nt&&Et({start:nt.start,end:nt.end})}),qe.current=ye},zt=te.useCallback(()=>{if(!v)return;const Z=()=>{try{const ye=v.nodes[v.nodes.length-1];if(ye&&typeof ye.getMeterData=="function"){const Le=ye.getMeterData();xt({peak:Le.peak,rms:Le.rms,loudness:Le.loudness})}}catch(ye){console.warn("Meter update failed:",ye)}_!=="none"&&requestAnimationFrame(Z)};Z()},[_,v]),ln=te.useCallback(()=>{xt({peak:0,rms:0,loudness:-60})},[]),Ps=async()=>{if(!a){r("No file selected.");return}o(!0),r(null),h&&URL.revokeObjectURL(h),d(null);try{t("ðŸ” Analyzing audio structure...");const Z=await AA(a);t("ðŸ¤– Initializing professional audio engine...");const Le=await ra().renderOffline(Z,p,Lt=>{const lt=Math.round(Lt*100);Lt<.3?t(`ðŸŽ¯ Applying effects chain... ${lt}%`):Lt<.7?t(`ï¿½ï¸ Professional mastering... ${lt}%`):t(`ðŸ›¡ï¸ Finalizing processed audio... ${lt}%`)});t("ðŸ“¦ Encoding your protected voice...");const nt=x6(Le);d(URL.createObjectURL(nt)),t("ðŸŽ‰ Your voice is now protected and ready for download!")}catch(Z){console.error("AI Processing failed:",Z),r(`AI processing encountered an issue: ${Z.message||"Unknown error"}`),t("âŒ Processing failed. Please try again.")}finally{o(!1)}},qt=()=>{if(N("none"),ln(),qe.current&&qe.current.pause(),T.current){try{T.current.stop(),T.current.disconnect()}catch{}T.current=null}if(v&&v.sourceNode)try{v.sourceNode.stop(),v.disconnect()}catch{}},Yn=async()=>{if(y){qt();try{const Z=new AudioContext;await Z.resume();const ye=Z.createBufferSource();ye.buffer=y,ye.connect(Z.destination),T.current=ye,N("original"),ye.onended=()=>{N("none"),T.current=null,Z.close()},ye.start(0),qe.current&&qe.current.play()}catch(Z){console.error("Failed to play original:",Z),N("none"),T.current=null}}},ie=async()=>{if(y){qt();try{if(qe.current)N("preview"),qe.current.play(),qe.current.on("finish",()=>{N("none")}),zt();else{const Z=new AudioContext;await Z.resume();const ye=Z.createBufferSource();ye.buffer=y,ye.connect(Z.destination),T.current=ye,N("preview"),ye.onended=()=>{N("none"),T.current=null,Z.close()},ye.start(0)}}catch(Z){console.error("Failed to play preview:",Z),N("none")}}},fe=Z=>{const ye={...p,...Z};f(ye),v&&v.updateParams(ye)},ze=Z=>{Z.preventDefault(),_e(!0)},Ke=Z=>{Z.preventDefault(),_e(!1)},ne=Z=>{Z.preventDefault(),_e(!1);const Le=Array.from(Z.dataTransfer.files).find(nt=>nt.type.startsWith("audio/")||nt.type.startsWith("video/"));Le?yn(Le):r("Please drop an audio or video file")};return x.jsxs("div",{className:"app voice-encrypter-page",children:[x.jsx(US,{opacity:.06,density:20,speed:1.5}),x.jsx(m6,{}),x.jsxs("div",{className:"voice-daw",children:[x.jsxs("header",{className:"daw-header",children:[x.jsx("button",{onClick:n,className:"daw-icon-btn","aria-label":"Back to home",children:x.jsx(ax,{size:18})}),x.jsxs("div",{className:"daw-title",children:[x.jsx("strong",{children:"Voice Encrypter"}),x.jsx("span",{className:"daw-subtitle",children:"AI Vocal Shield"})]}),x.jsxs("div",{className:"daw-header-actions",children:[x.jsx("span",{className:`daw-status ${i?"processing":s?"error":"ready"}`,children:s||e}),x.jsx("button",{onClick:n,className:"daw-icon-btn","aria-label":"Close tool",children:x.jsx(El,{size:18})})]})]}),x.jsxs("div",{className:"daw-main",children:[x.jsxs("aside",{className:"daw-left",children:[x.jsxs("div",{className:"daw-upload-section",children:[x.jsx("input",{ref:Ae,type:"file",accept:"audio/*,video/*",onChange:Z=>{var ye;return((ye=Z.target.files)==null?void 0:ye[0])&&yn(Z.target.files[0])},className:"hidden"}),x.jsxs("button",{onClick:()=>{var Z;return(Z=Ae.current)==null?void 0:Z.click()},onDragOver:ze,onDragLeave:Ke,onDrop:ne,className:`daw-upload-btn ${Re?"drag-over":""}`,disabled:i,children:[x.jsx(Vy,{size:20}),x.jsxs("div",{className:"upload-content",children:[x.jsx("div",{className:"upload-title",children:a?a.name:"Upload Audio"}),x.jsx("div",{className:"upload-subtitle",children:"MP3, WAV, MP4, MOV â€¢ Max 100MB"})]})]})]}),x.jsxs("div",{className:"daw-modes",children:[x.jsxs("div",{className:"mode-tabs",role:"tablist",children:[x.jsx("button",{className:`mode-tab ${ue==="enhance"?"active":""}`,onClick:()=>de("enhance"),role:"tab",children:"Enhance"}),x.jsx("button",{className:`mode-tab ${ue==="denoise"?"active":""}`,onClick:()=>de("denoise"),role:"tab",children:"Denoise"}),x.jsx("button",{className:`mode-tab ${ue==="encrypt"?"active":""}`,onClick:()=>de("encrypt"),role:"tab",children:"Encrypt"})]}),x.jsx("div",{className:"mode-hint",children:"Spacebar: Play/Pause"})]})]}),x.jsxs("section",{className:"daw-center",children:[c&&x.jsxs("div",{className:"daw-timeline",children:[x.jsxs("div",{className:"timeline-header",children:[x.jsx("span",{className:"timeline-title",children:"Waveform & Selection"}),x.jsxs("div",{className:"timeline-controls",children:[x.jsx("button",{className:"timeline-btn",onClick:()=>{if(qe.current){const Z=qe.current.getDuration();Et({start:0,end:Z})}},title:"Select All",children:"All"}),gt&&x.jsxs(x.Fragment,{children:[x.jsxs("div",{className:"selection-info",children:[x.jsxs("span",{children:[gt.start.toFixed(2),"s - ",gt.end.toFixed(2),"s"]}),x.jsxs("span",{className:"selection-duration",children:["(",(gt.end-gt.start).toFixed(2),"s)"]})]}),x.jsx("button",{className:"timeline-btn clear",onClick:()=>Et(null),title:"Clear Selection",children:"Clear"})]})]})]}),x.jsx("div",{className:"timeline-content",children:x.jsx("div",{ref:je,className:"daw-waveform"})}),x.jsxs("div",{className:"daw-meters",children:[x.jsxs("div",{className:"meter",children:[x.jsx("span",{className:"meter-label",children:"Peak"}),x.jsx("div",{className:"meter-bar",children:x.jsx("div",{className:"meter-fill peak",style:{width:`${Math.min(100,ot.peak*100)}%`}})}),x.jsxs("span",{className:"meter-value",children:[(ot.peak*100).toFixed(1),"%"]})]}),x.jsxs("div",{className:"meter",children:[x.jsx("span",{className:"meter-label",children:"RMS"}),x.jsx("div",{className:"meter-bar",children:x.jsx("div",{className:"meter-fill rms",style:{width:`${Math.min(100,ot.rms*100)}%`}})}),x.jsxs("span",{className:"meter-value",children:[(ot.rms*100).toFixed(1),"%"]})]}),x.jsxs("div",{className:"meter",children:[x.jsx("span",{className:"meter-label",children:"Loud"}),x.jsx("div",{className:"meter-bar",children:x.jsx("div",{className:"meter-fill loudness",style:{width:`${Math.min(100,Math.max(0,(ot.loudness+60)/60*100))}%`}})}),x.jsx("span",{className:"meter-value",children:ot.loudness.toFixed(1)})]})]})]}),!c&&x.jsxs("div",{className:"daw-placeholder",children:[x.jsx(Vy,{size:48}),x.jsx("h3",{children:"No Audio Loaded"}),x.jsx("p",{children:"Upload an audio file to see the waveform and timeline"})]})]}),x.jsx("aside",{className:"daw-right",children:x.jsxs("div",{className:"effects-section scrollable-effects",children:[x.jsx("h3",{className:"section-title",children:ue==="enhance"?"Enhancement":ue==="denoise"?"Noise Reduction":"Voice Effects"}),(ue==="enhance"||ue==="encrypt")&&x.jsxs("div",{className:`effect-module ${p.enableAIEnhancement?"active":"inactive"}`,children:[x.jsxs("label",{className:"effect-toggle",children:[x.jsx("input",{type:"checkbox",checked:p.enableAIEnhancement,onChange:Z=>fe({enableAIEnhancement:Z.target.checked})}),x.jsx("span",{className:"toggle-slider"}),x.jsx("span",{className:"effect-name",children:"AI Enhancement"})]}),p.enableAIEnhancement&&x.jsxs("div",{className:"effect-controls",children:[x.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.05",value:p.aiEnhancement,onChange:Z=>fe({aiEnhancement:parseFloat(Z.target.value)})}),x.jsx("span",{className:"control-value",children:p.aiEnhancement.toFixed(1)}),x.jsxs("label",{className:"effect-subcontrol",children:[x.jsx("span",{children:"Model size"}),x.jsxs("select",{value:p.aiModelSize,onChange:Z=>fe({aiModelSize:Z.target.value}),children:[x.jsx("option",{value:"tiny",children:"Tiny â€¢ 3MB"}),x.jsx("option",{value:"medium",children:"Medium â€¢ 12MB"}),x.jsx("option",{value:"large",children:"Large â€¢ 48MB"})]})]})]})]}),(ue==="denoise"||ue==="encrypt")&&x.jsxs("div",{className:`effect-module ${p.enableNoiseReduction?"active":"inactive"}`,children:[x.jsxs("label",{className:"effect-toggle",children:[x.jsx("input",{type:"checkbox",checked:p.enableNoiseReduction,onChange:Z=>fe({enableNoiseReduction:Z.target.checked})}),x.jsx("span",{className:"toggle-slider"}),x.jsx("span",{className:"effect-name",children:"Noise Reduction"})]}),p.enableNoiseReduction&&x.jsxs("div",{className:"effect-controls",children:[x.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:p.noiseReduction,onChange:Z=>fe({noiseReduction:parseFloat(Z.target.value)})}),x.jsx("span",{className:"control-value",children:p.noiseReduction.toFixed(1)})]})]}),ue==="encrypt"&&x.jsxs(x.Fragment,{children:[x.jsxs("div",{className:`effect-module ${p.enablePitchShift?"active":"inactive"}`,children:[x.jsxs("label",{className:"effect-toggle",children:[x.jsx("input",{type:"checkbox",checked:p.enablePitchShift,onChange:Z=>fe({enablePitchShift:Z.target.checked})}),x.jsx("span",{className:"toggle-slider"}),x.jsx("span",{className:"effect-name",children:"Pitch Shift"})]}),p.enablePitchShift&&x.jsxs("div",{className:"effect-controls",children:[x.jsx("input",{type:"range",min:"-12",max:"12",step:"0.5",value:p.pitchShift,onChange:Z=>fe({pitchShift:parseFloat(Z.target.value)})}),x.jsxs("span",{className:"control-value",children:[p.pitchShift.toFixed(1)," st"]})]})]}),x.jsxs("div",{className:`effect-module ${p.enableReverb?"active":"inactive"}`,children:[x.jsxs("label",{className:"effect-toggle",children:[x.jsx("input",{type:"checkbox",checked:p.enableReverb,onChange:Z=>fe({enableReverb:Z.target.checked})}),x.jsx("span",{className:"toggle-slider"}),x.jsx("span",{className:"effect-name",children:"Reverb"})]}),p.enableReverb&&x.jsxs("div",{className:"effect-controls",children:[x.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:p.reverbMix,onChange:Z=>fe({reverbMix:parseFloat(Z.target.value)})}),x.jsx("span",{className:"control-value",children:p.reverbMix.toFixed(1)})]})]})]}),x.jsx("div",{className:"mastering-divider",children:x.jsx("span",{className:"divider-text",children:"Final Mix & Master"})}),x.jsxs("div",{className:`effect-module mastering-module ${p.enableMastering?"active":"inactive"}`,children:[x.jsxs("label",{className:"effect-toggle",children:[x.jsx("input",{type:"checkbox",checked:p.enableMastering,onChange:Z=>fe({enableMastering:Z.target.checked})}),x.jsx("span",{className:"toggle-slider"}),x.jsx("span",{className:"effect-name",children:"Professional Mastering"})]}),x.jsx("div",{className:"effect-description",children:"Mix all effects and apply professional mastering"})]})]})})]}),x.jsxs("footer",{className:"daw-transport",children:[x.jsx("div",{className:"transport-left",children:y&&x.jsxs(x.Fragment,{children:[x.jsxs("button",{onClick:_==="original"?qt:Yn,className:`transport-btn ${_==="original"?"playing":""}`,disabled:i,title:"Play Original (A key)",children:[x.jsx("span",{className:"btn-icon",children:_==="original"?"â¸":"â–¶"}),x.jsx("span",{className:"btn-label",children:"Original"})]}),x.jsxs("button",{onClick:_==="preview"?qt:ie,className:`transport-btn ${_==="preview"?"playing":""}`,disabled:i,title:"Play Preview (Spacebar)",children:[x.jsx("span",{className:"btn-icon",children:_==="preview"?"â¸":"â–¶"}),x.jsx("span",{className:"btn-label",children:"Preview"})]})]})}),x.jsx("div",{className:"transport-center",children:y&&x.jsx("button",{onClick:Ps,disabled:i,className:"process-btn",children:i?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"spinner"}),"Processing..."]}):x.jsxs(x.Fragment,{children:[x.jsx(uo,{size:16}),"Apply Effects"]})})}),x.jsx("div",{className:"transport-right",children:h&&x.jsxs(x.Fragment,{children:[x.jsxs("label",{className:"export-checkbox",children:[x.jsx("input",{type:"checkbox",checked:be,onChange:Z=>Ee(Z.target.checked)}),x.jsx("span",{children:"Export selection only"})]}),x.jsxs("button",{onClick:()=>k(!0),className:"export-btn",children:[x.jsx(mp,{size:16}),"Export"]}),x.jsxs("button",{onClick:It,className:"qa-btn",disabled:K,children:[x.jsx("span",{className:"btn-icon",children:"ðŸ”¬"}),"QA"]})]})})]})]}),E&&x.jsx("div",{className:"modal-overlay",onClick:()=>k(!1),children:x.jsxs("div",{className:"export-panel",onClick:Z=>Z.stopPropagation(),children:[x.jsxs("div",{className:"panel-header",children:[x.jsx("h3",{children:"ðŸš€ Professional Export"}),x.jsx("button",{onClick:()=>k(!1),className:"close-btn",children:x.jsx(El,{size:18})})]}),x.jsxs("div",{className:"export-config",children:[x.jsxs("div",{className:"format-section",children:[x.jsx("label",{children:"Output Format"}),x.jsx("div",{className:"format-grid",children:B1.map(Z=>x.jsxs("div",{className:`format-card ${V.format===Z.id?"selected":""}`,onClick:()=>U({...V,format:Z.id,quality:Z.quality[0].id}),children:[x.jsx("div",{className:"format-name",children:Z.name}),x.jsx("div",{className:"format-desc",children:Z.description})]},Z.id))})]}),x.jsx("div",{className:"panel-actions",children:x.jsx("button",{onClick:Rt,className:"export-confirm-btn",disabled:S||!y,children:S?"Exporting...":"Export Audio"})})]})]})}),q&&x.jsx("div",{className:"modal-overlay",onClick:()=>J(!1),children:x.jsxs("div",{className:"qa-panel",onClick:Z=>Z.stopPropagation(),children:[x.jsxs("div",{className:"panel-header",children:[x.jsx("h3",{children:"ðŸ”¬ Pro-Grade Quality Assurance"}),x.jsx("button",{onClick:()=>J(!1),className:"close-btn",children:x.jsx(El,{size:18})})]}),x.jsxs("div",{className:"qa-config",children:[K&&x.jsxs("div",{className:"qa-progress-section",children:[x.jsxs("div",{className:"progress-label",children:["Running Quality Check... ",Math.round(ce*100),"%"]}),x.jsx("div",{className:"progress-bar",children:x.jsx("div",{className:"progress-fill",style:{width:`${ce*100}%`}})})]}),L&&!K&&x.jsx("div",{className:"qa-results",children:x.jsxs("div",{className:`qa-status ${L.overallStatus}`,children:["Quality Check: ",L.overallStatus]})}),!L&&!K&&x.jsx("button",{onClick:It,className:"run-qa-btn",disabled:!y,children:"âœ… Run Quality Check"})]})]})})]})}function J6(){return new Worker("/assets/vectorizer.worker-bc7c8622.js",{type:"module"})}function eH(){return new Worker("/assets/llm.worker-89b52568.js",{type:"module"})}const MA={tech:{label:"Technology & SaaS",keywords:"tech startup branding, circuit patterns, digital connection, modern, sleek, innovation"},food:{label:"Food & Beverage",keywords:"organic shapes, appetizing, restaurant branding, fresh, bold flavors, hospitality"},sports:{label:"Sports & Esports",keywords:"aggressive, dynamic movement, mascot, team emblem, jersey style, athletic"},fashion:{label:"Fashion & Apparel",keywords:"elegant, luxury, streetwear, fabric texture, haute couture, trendy"},realestate:{label:"Real Estate",keywords:"architectural, structure, home, stability, trust, building silhouette"},gaming:{label:"Gaming & Streamer",keywords:"neon, avatar, fantasy, sci-fi, twitch emote style, high energy"},medical:{label:"Medical & Health",keywords:"clean, sterile, cross, heart, dna, professional, trustworthy, blue and white"},crypto:{label:"Crypto & Web3",keywords:"blockchain, nodes, futuristic, decentralized, token, metallic gradients"},legal:{label:"Legal & Finance",keywords:"scales, pillars, serif fonts, traditional, authoritative, gold and black"},music:{label:"Music & Entertainment",keywords:"sound waves, rhythm, vinyl, concert, artistic, expressive"},nature:{label:"Eco & Nature",keywords:"leaves, sustainability, earth tones, organic, recycling, growth"},automotive:{label:"Automotive",keywords:"speed, metallic, chrome, horsepower, silhouette, racing"}},zA={minimal:{label:"Minimalist",keywords:"flat design, negative space, clean lines, Paul Rand style, less is more, reductionist"},geometric:{label:"Geometric",keywords:"sacred geometry, mathematical shapes, bauhaus style, sharp angles, grid-based"},vintage:{label:"Vintage / Retro",keywords:"distressed texture, 70s style, badge, rubber hose animation style, muted colors"},cyberpunk:{label:"Cyberpunk",keywords:"glitch aesthetic, neon accents, futuristic, techwear style, hud element, high contrast"},handdrawn:{label:"Hand Drawn",keywords:"sketchy, organic lines, doodle style, rough edges, artistic, pen and ink"},isometric:{label:"3D Isometric",keywords:"isometric view, 3d vector, blocky, dimension, architectural, engineering"},abstract:{label:"Abstract",keywords:"fluid shapes, conceptual, avant-garde, non-representational, artistic interpretation"},corporate:{label:"Corporate Professional",keywords:"trustworthy, solid, sans-serif, balanced, fortune 500 style"},luxury:{label:"Luxury & High-End",keywords:"serif, gold foil texture, elegant, sophisticated, premium, crest"},popart:{label:"Pop Art",keywords:"halftone dots, comic book style, bold outlines, vibrant colors, roy lichtenstein"}},VA={logo:{label:"Logo / Brand Mark",keywords:"vector logo, logomark, brand identity, scalable"},logotype:{label:"Logotype / Wordmark",keywords:"typography logo, custom lettering, wordmark, font-based logo, clean typography"},icon:{label:"App Icon / UI",keywords:"app icon, ui element, rounded corners, ios style, material design"},favicon:{label:"Favicon (Web)",keywords:"favicon, 16x16 pixel perfect, simplified shape, high visibility at small sizes"},mascot:{label:"Mascot / Character",keywords:"character design, mascot, expressive face, full body, personality"},badge:{label:"Badge / Emblem",keywords:"circular badge, patch style, embroidery ready, crest, shield"},sticker:{label:"Sticker / Decal",keywords:"die-cut sticker, white border, vinyl decal, sticker art"},tshirt:{label:"T-Shirt Design",keywords:"t-shirt graphic, screen print ready, merchandise, apparel design"},pattern:{label:"Seamless Pattern",keywords:"seamless pattern, tiling background, wallpaper, textile design"},social:{label:"Social Media Avatar",keywords:"profile picture, circular crop safe, personal branding, avatar"},esports:{label:"Esports Team Logo",keywords:"aggressive animal mascot, shield background, bold outlines, vector sport logo"}},Rv={monochrome:{label:"Monochrome (B&W)",colors:["#000000","#ffffff"],keywords:"black and white, monochrome, high contrast, ink style"},cyberpunk:{label:"Neon Cyberpunk",colors:["#0aff6a","#ff00ff","#00ffff","#1a1a1a"],keywords:"neon green, hot pink, cyan, dark background, glowing"},sunset:{label:"Sunset Gradient",colors:["#ff7e5f","#feb47b","#765285"],keywords:"warm gradient, orange to purple, sunset vibes, dusk"},ocean:{label:"Deep Ocean",colors:["#006994","#003366","#48d1cc"],keywords:"deep blue, teal, aquatic tones, cool colors"},forest:{label:"Forest & Earth",colors:["#228b22","#8b4513","#f0e68c"],keywords:"earth tones, forest green, brown, natural palette"},corporate:{label:"Trust Blue",colors:["#0056b3","#00a8e8","#ffffff","#333333"],keywords:"professional blue, white, dark grey, corporate identity"},luxury:{label:"Gold & Black",colors:["#d4af37","#000000","#1a1a1a"],keywords:"gold foil, matte black, premium, luxury, metallic"},pastel:{label:"Soft Pastels",colors:["#ffb3ba","#baffc9","#bae1ff","#ffffba"],keywords:"pastel colors, soft, baby blue, mint green, gentle"},retro:{label:"Retro 80s",colors:["#ff0055","#ffcc00","#00ddff"],keywords:"synthwave, 80s retro, vibrant, miami vice style"},grayscale:{label:"Grayscale",colors:["#333333","#666666","#999999","#cccccc"],keywords:"shades of gray, neutral, sophisticated, silver"}},BA={centered:{label:"Centered (Default)",keywords:"centered composition, symmetrical balance, focal point"},golden:{label:"Golden Ratio",keywords:"golden ratio composition, fibonacci spiral, perfect proportions"},minimal:{label:"Isolated",keywords:"isolated on white, no background elements, standalone object"},dynamic:{label:"Dynamic Action",keywords:"action pose, motion blur lines, dynamic angle, perspective"}},jA={professional:{label:"Professional",keywords:"trustworthy, serious, established"},playful:{label:"Playful",keywords:"fun, whimsical, cute, friendly"},aggressive:{label:"Aggressive",keywords:"bold, fierce, strong, dominant"},calm:{label:"Calm",keywords:"peaceful, zen, soft, relaxing"},innovative:{label:"Innovative",keywords:"cutting-edge, modern, disruptive"}};var tH=Object.create,nO=Object.defineProperty,nH=Object.getOwnPropertyDescriptor,sO=Object.getOwnPropertyNames,sH=Object.getPrototypeOf,rH=Object.prototype.hasOwnProperty,HS=(n,e)=>function(){return e||(0,n[sO(n)[0]])((e={exports:{}}).exports,e),e.exports},iH=(n,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of sO(e))!rH.call(n,r)&&r!==t&&nO(n,r,{get:()=>e[r],enumerable:!(s=nH(e,r))||s.enumerable});return n},cx=(n,e,t)=>(t=n!=null?tH(sH(n)):{},iH(e||!n||!n.__esModule?nO(t,"default",{value:n,enumerable:!0}):t,n)),oH=HS({"../../node_modules/.pnpm/iota-array@1.0.0/node_modules/iota-array/iota.js"(n,e){function t(s){for(var r=new Array(s),i=0;i<s;++i)r[i]=i;return r}e.exports=t}}),aH=HS({"../../node_modules/.pnpm/is-buffer@1.1.6/node_modules/is-buffer/index.js"(n,e){e.exports=function(r){return r!=null&&(t(r)||s(r)||!!r._isBuffer)};function t(r){return!!r.constructor&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function s(r){return typeof r.readFloatLE=="function"&&typeof r.slice=="function"&&t(r.slice(0,0))}}}),ux=HS({"../../node_modules/.pnpm/ndarray@1.0.19/node_modules/ndarray/ndarray.js"(n,e){var t=oH(),s=aH(),r=typeof Float64Array<"u";function i(h,d){return h[0]-d[0]}function o(){var h=this.stride,d=new Array(h.length),p;for(p=0;p<d.length;++p)d[p]=[Math.abs(h[p]),p];d.sort(i);var f=new Array(d.length);for(p=0;p<f.length;++p)f[p]=d[p][1];return f}function a(h,d){var p=["View",d,"d",h].join("");d<0&&(p="View_Nil"+h);var f=h==="generic";if(d===-1){var g="function "+p+"(a){this.data=a;};var proto="+p+".prototype;proto.dtype='"+h+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+p+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+p+"(a){return new "+p+"(a);}",S=new Function(g);return S()}else if(d===0){var g="function "+p+"(a,d) {this.data = a;this.offset = d};var proto="+p+".prototype;proto.dtype='"+h+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+p+"_copy() {return new "+p+"(this.data,this.offset)};proto.pick=function "+p+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+p+"_get(){return "+(f?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+p+"_set(v){return "+(f?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+p+"(a,b,c,d){return new "+p+"(a,d)}",S=new Function("TrivialArray",g);return S(c[h][0])}var g=["'use strict'"],m=t(d),y=m.map(function(A){return"i"+A}),w="this.offset+"+m.map(function(A){return"this.stride["+A+"]*i"+A}).join("+"),v=m.map(function(A){return"b"+A}).join(","),I=m.map(function(A){return"c"+A}).join(",");g.push("function "+p+"(a,"+v+","+I+",d){this.data=a","this.shape=["+v+"]","this.stride=["+I+"]","this.offset=d|0}","var proto="+p+".prototype","proto.dtype='"+h+"'","proto.dimension="+d),g.push("Object.defineProperty(proto,'size',{get:function "+p+"_size(){return "+m.map(function(A){return"this.shape["+A+"]"}).join("*"),"}})"),d===1?g.push("proto.order=[0]"):(g.push("Object.defineProperty(proto,'order',{get:"),d<4?(g.push("function "+p+"_order(){"),d===2?g.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):d===3&&g.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):g.push("ORDER})")),g.push("proto.set=function "+p+"_set("+y.join(",")+",v){"),f?g.push("return this.data.set("+w+",v)}"):g.push("return this.data["+w+"]=v}"),g.push("proto.get=function "+p+"_get("+y.join(",")+"){"),f?g.push("return this.data.get("+w+")}"):g.push("return this.data["+w+"]}"),g.push("proto.index=function "+p+"_index(",y.join(),"){return "+w+"}"),g.push("proto.hi=function "+p+"_hi("+y.join(",")+"){return new "+p+"(this.data,"+m.map(function(A){return["(typeof i",A,"!=='number'||i",A,"<0)?this.shape[",A,"]:i",A,"|0"].join("")}).join(",")+","+m.map(function(A){return"this.stride["+A+"]"}).join(",")+",this.offset)}");var _=m.map(function(A){return"a"+A+"=this.shape["+A+"]"}),N=m.map(function(A){return"c"+A+"=this.stride["+A+"]"});g.push("proto.lo=function "+p+"_lo("+y.join(",")+"){var b=this.offset,d=0,"+_.join(",")+","+N.join(","));for(var T=0;T<d;++T)g.push("if(typeof i"+T+"==='number'&&i"+T+">=0){d=i"+T+"|0;b+=c"+T+"*d;a"+T+"-=d}");g.push("return new "+p+"(this.data,"+m.map(function(A){return"a"+A}).join(",")+","+m.map(function(A){return"c"+A}).join(",")+",b)}"),g.push("proto.step=function "+p+"_step("+y.join(",")+"){var "+m.map(function(A){return"a"+A+"=this.shape["+A+"]"}).join(",")+","+m.map(function(A){return"b"+A+"=this.stride["+A+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var T=0;T<d;++T)g.push("if(typeof i"+T+"==='number'){d=i"+T+"|0;if(d<0){c+=b"+T+"*(a"+T+"-1);a"+T+"=ceil(-a"+T+"/d)}else{a"+T+"=ceil(a"+T+"/d)}b"+T+"*=d}");g.push("return new "+p+"(this.data,"+m.map(function(A){return"a"+A}).join(",")+","+m.map(function(A){return"b"+A}).join(",")+",c)}");for(var E=new Array(d),k=new Array(d),T=0;T<d;++T)E[T]="a[i"+T+"]",k[T]="b[i"+T+"]";g.push("proto.transpose=function "+p+"_transpose("+y+"){"+y.map(function(A,P){return A+"=("+A+"===undefined?"+P+":"+A+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+p+"(this.data,"+E.join(",")+","+k.join(",")+",this.offset)}"),g.push("proto.pick=function "+p+"_pick("+y+"){var a=[],b=[],c=this.offset");for(var T=0;T<d;++T)g.push("if(typeof i"+T+"==='number'&&i"+T+">=0){c=(c+this.stride["+T+"]*i"+T+")|0}else{a.push(this.shape["+T+"]);b.push(this.stride["+T+"])}");g.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),g.push("return function construct_"+p+"(data,shape,stride,offset){return new "+p+"(data,"+m.map(function(A){return"shape["+A+"]"}).join(",")+","+m.map(function(A){return"stride["+A+"]"}).join(",")+",offset)}");var S=new Function("CTOR_LIST","ORDER",g.join(`
`));return S(c[h],o)}function l(h){if(s(h))return"buffer";if(r)switch(Object.prototype.toString.call(h)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(h)?"array":"generic"}var c={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};function u(h,d,p,f){if(h===void 0){var I=c.array[0];return I([])}else typeof h=="number"&&(h=[h]);d===void 0&&(d=[h.length]);var g=d.length;if(p===void 0){p=new Array(g);for(var m=g-1,y=1;m>=0;--m)p[m]=y,y*=d[m]}if(f===void 0){f=0;for(var m=0;m<g;++m)p[m]<0&&(f-=(d[m]-1)*p[m])}for(var w=l(h),v=c[w];v.length<=g+1;)v.push(a(w,v.length-1));var I=v[g+1];return I(h,d,p,f)}e.exports=u}}),lH=typeof global=="object"&&global&&global.Object===Object&&global,cH=lH,uH=typeof self=="object"&&self&&self.Object===Object&&self,hH=cH||uH||Function("return this")(),qS=hH,dH=qS.Symbol,Wy=dH,rO=Object.prototype,pH=rO.hasOwnProperty,fH=rO.toString,Td=Wy?Wy.toStringTag:void 0;function mH(n){var e=pH.call(n,Td),t=n[Td];try{n[Td]=void 0;var s=!0}catch{}var r=fH.call(n);return s&&(e?n[Td]=t:delete n[Td]),r}var gH=mH,yH=Object.prototype,bH=yH.toString;function xH(n){return bH.call(n)}var wH=xH,vH="[object Null]",IH="[object Undefined]",UA=Wy?Wy.toStringTag:void 0;function SH(n){return n==null?n===void 0?IH:vH:UA&&UA in Object(n)?gH(n):wH(n)}var kH=SH;function TH(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var iO=TH,CH="[object AsyncFunction]",EH="[object Function]",_H="[object GeneratorFunction]",NH="[object Proxy]";function AH(n){if(!iO(n))return!1;var e=kH(n);return e==EH||e==_H||e==CH||e==NH}var RH=AH,$H=qS["__core-js_shared__"],$v=$H,WA=function(){var n=/[^.]+$/.exec($v&&$v.keys&&$v.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function DH(n){return!!WA&&WA in n}var PH=DH,OH=Function.prototype,FH=OH.toString;function LH(n){if(n!=null){try{return FH.call(n)}catch{}try{return n+""}catch{}}return""}var MH=LH,zH=/[\\^$.*+?()[\]{}|]/g,VH=/^\[object .+?Constructor\]$/,BH=Function.prototype,jH=Object.prototype,UH=BH.toString,WH=jH.hasOwnProperty,GH=RegExp("^"+UH.call(WH).replace(zH,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function HH(n){if(!iO(n)||PH(n))return!1;var e=RH(n)?GH:VH;return e.test(MH(n))}var qH=HH;function KH(n,e){return n==null?void 0:n[e]}var XH=KH;function YH(n,e){var t=XH(n,e);return qH(t)?t:void 0}var oO=YH,QH=oO(Object,"create"),bp=QH;function ZH(){this.__data__=bp?bp(null):{},this.size=0}var JH=ZH;function e5(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}var t5=e5,n5="__lodash_hash_undefined__",s5=Object.prototype,r5=s5.hasOwnProperty;function i5(n){var e=this.__data__;if(bp){var t=e[n];return t===n5?void 0:t}return r5.call(e,n)?e[n]:void 0}var o5=i5,a5=Object.prototype,l5=a5.hasOwnProperty;function c5(n){var e=this.__data__;return bp?e[n]!==void 0:l5.call(e,n)}var u5=c5,h5="__lodash_hash_undefined__";function d5(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=bp&&e===void 0?h5:e,this}var p5=d5;function Lu(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var s=n[e];this.set(s[0],s[1])}}Lu.prototype.clear=JH;Lu.prototype.delete=t5;Lu.prototype.get=o5;Lu.prototype.has=u5;Lu.prototype.set=p5;var GA=Lu;function f5(){this.__data__=[],this.size=0}var m5=f5;function g5(n,e){return n===e||n!==n&&e!==e}var y5=g5;function b5(n,e){for(var t=n.length;t--;)if(y5(n[t][0],e))return t;return-1}var hx=b5,x5=Array.prototype,w5=x5.splice;function v5(n){var e=this.__data__,t=hx(e,n);if(t<0)return!1;var s=e.length-1;return t==s?e.pop():w5.call(e,t,1),--this.size,!0}var I5=v5;function S5(n){var e=this.__data__,t=hx(e,n);return t<0?void 0:e[t][1]}var k5=S5;function T5(n){return hx(this.__data__,n)>-1}var C5=T5;function E5(n,e){var t=this.__data__,s=hx(t,n);return s<0?(++this.size,t.push([n,e])):t[s][1]=e,this}var _5=E5;function Mu(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var s=n[e];this.set(s[0],s[1])}}Mu.prototype.clear=m5;Mu.prototype.delete=I5;Mu.prototype.get=k5;Mu.prototype.has=C5;Mu.prototype.set=_5;var N5=Mu,A5=oO(qS,"Map"),R5=A5;function $5(){this.size=0,this.__data__={hash:new GA,map:new(R5||N5),string:new GA}}var D5=$5;function P5(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}var O5=P5;function F5(n,e){var t=n.__data__;return O5(e)?t[typeof e=="string"?"string":"hash"]:t.map}var dx=F5;function L5(n){var e=dx(this,n).delete(n);return this.size-=e?1:0,e}var M5=L5;function z5(n){return dx(this,n).get(n)}var V5=z5;function B5(n){return dx(this,n).has(n)}var j5=B5;function U5(n,e){var t=dx(this,n),s=t.size;return t.set(n,e),this.size+=t.size==s?0:1,this}var W5=U5;function zu(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var s=n[e];this.set(s[0],s[1])}}zu.prototype.clear=D5;zu.prototype.delete=M5;zu.prototype.get=V5;zu.prototype.has=j5;zu.prototype.set=W5;var aO=zu,G5="Expected a function";function KS(n,e){if(typeof n!="function"||e!=null&&typeof e!="function")throw new TypeError(G5);var t=function(){var s=arguments,r=e?e.apply(this,s):s[0],i=t.cache;if(i.has(r))return i.get(r);var o=n.apply(this,s);return t.cache=i.set(r,o)||i,o};return t.cache=new(KS.Cache||aO),t}KS.Cache=aO;var H5=KS,XS=cx(ux()),lO=class G1{constructor(e,t){this.type="application/octet-stream",this.params={},this.type=e,this.params=t}toString(){const e=[];for(const t in this.params){const s=this.params[t];e.push(`${t}=${s}`)}return[this.type,...e].join(";")}static create(e,t){return new G1(e,t)}isIdentical(e){return this.type===e.type&&this.params===e.params}isEqual(e){return this.type===e.type}static fromString(e){const[t,...s]=e.split(";"),r={};for(const i of s){const[o,a]=i.split("=");r[o.trim()]=a.trim()}return new G1(t,r)}},Dv=cx(ux());async function q5(n){const e=lO.fromString(n.type);switch(e.type){case"image/x-alpha8":{const t=parseInt(e.params.width),s=parseInt(e.params.height);return(0,Dv.default)(new Uint8Array(await n.arrayBuffer()),[s,t,1])}case"image/x-rgba8":{const t=parseInt(e.params.width),s=parseInt(e.params.height);return(0,Dv.default)(new Uint8Array(await n.arrayBuffer()),[s,t,4])}case"application/octet-stream":case"image/png":case"image/jpeg":case"image/jpg":case"image/webp":{const t=await createImageBitmap(n),s=Q5(t);return(0,Dv.default)(new Uint8Array(s.data),[s.height,s.width,4])}default:throw new Error(`Invalid format: ${e.type} with params: ${e.params}`)}}async function K5(n,e=.8,t="image/png"){const[s,r,i]=n.shape;switch(t){case"image/x-alpha8":case"image/x-rgba8":{const l=lO.create(t,{width:r.toString(),height:s.toString()});return new Blob([n.data],{type:l.toString()})}case"image/png":case"image/jpeg":case"image/webp":{const l=new ImageData(new Uint8ClampedArray(n.data),r,s);var o=cO(l.width,l.height),a=o.getContext("2d");return a.putImageData(l,0,0),o.convertToBlob({quality:e,type:t})}default:throw new Error(`Invalid format: ${t}`)}}function X5(n){return new RegExp("^(?:[a-z+]+:)?//","i").test(n)}function Y5(n,e){return X5(n)?n:new URL(n,e).href}function Q5(n){var e=cO(n.width,n.height),t=e.getContext("2d");return t.drawImage(n,0,0),t.getImageData(0,0,e.width,e.height)}function Z5(n){if(typeof Uint8Array<"u")return new Uint8Array(n);if(typeof Uint8ClampedArray<"u")return new Uint8ClampedArray(n);if(typeof Uint16Array<"u")return new Uint16Array(n);if(typeof Uint32Array<"u")return new Uint32Array(n);if(typeof Float32Array<"u")return new Float32Array(n);if(typeof Float64Array<"u")return new Float64Array(n);throw new Error("TypedArray not supported")}function HA(n,e,t,s=!1){const[r,i,o]=n.shape;let a=i/e,l=r/t;s&&(a=l=Math.max(a,l)>1?Math.max(a,l):Math.min(a,l));const c=(0,XS.default)(Z5(o*e*t),[t,e,o]);for(let u=0;u<t;u++)for(let h=0;h<e;h++){const d=h*a,p=u*l,f=Math.max(Math.floor(d),0),g=Math.min(Math.ceil(d),i-1),m=Math.max(Math.floor(p),0),y=Math.min(Math.ceil(p),r-1),w=d-f,v=p-m;for(let I=0;I<o;I++){const _=n.get(m,f,I),N=n.get(m,g,I),T=n.get(y,f,I),E=n.get(y,g,I),k=(1-w)*(1-v)*_+w*(1-v)*N+(1-w)*v*T+w*v*E;c.set(u,h,I,k)}}return c}function J5(n,e=[128,128,128],t=[256,256,256]){var s=n.data;const[r,i,o]=n.shape,a=r*i,l=new Float32Array(3*a);for(let c=0,u=0;c<s.length;c+=4,u+=1)l[u]=(s[c]-e[0])/t[0],l[u+a]=(s[c+1]-e[1])/t[1],l[u+a+a]=(s[c+2]-e[2])/t[2];return(0,XS.default)(l,[1,3,r,i])}async function eq(n,e){return typeof n=="string"&&(n=Y5(n,e.publicPath),n=new URL(n)),n instanceof URL&&(n=await(await fetch(n,{})).blob()),(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n=new Blob([n])),n instanceof Blob&&(n=await q5(n)),n}function tq(n){const e=new Uint8Array(n.data.length);for(let t=0;t<n.data.length;t++)e[t]=n.data[t]*255;return(0,XS.default)(e,n.shape)}function cO(n,e){let t;if(typeof OffscreenCanvas<"u"?t=new OffscreenCanvas(n,e):t=document.createElement("canvas"),!t)throw new Error("Canvas nor OffscreenCanvas are available in the current context.");return t}var nq=cx(ux()),uO=async()=>navigator.gpu===void 0?!1:await navigator.gpu.requestAdapter()!==null,sq=()=>navigator.hardwareConcurrency??4;async function qA(n,e){return URL.createObjectURL(await hO(n,e))}async function hO(n,e){const t=new URL("resources.json",e.publicPath),s=await fetch(t);if(!s.ok)throw new Error("Resource metadata not found. Ensure that the config.publicPath is configured correctly.");const i=(await s.json())[n];if(!i)throw new Error(`Resource ${n} not found. Ensure that the config.publicPath is configured correctly.`);const o=i.chunks;let a=0;const l=o.map(async h=>{const d=h.offsets[1]-h.offsets[0],p=e.publicPath?new URL(h.name,e.publicPath).toString():h.name,g=await(await fetch(p,e.fetchArgs)).blob();if(d!==g.size)throw new Error(`Failed to fetch ${n} with size ${d} but got ${g.size}`);return e.progress&&(a+=d,e.progress(`fetch:${n}`,a,i.size)),g}),c=await Promise.all(l),u=new Blob(c,{type:i.mime});if(u.size!==i.size)throw new Error(`Failed to fetch ${n} with size ${i.size} but got ${u.size}`);return u}var Cd=null,dO=async n=>(Cd!==null||(n?Cd=(await gp(()=>import("./ort.webgpu.bundle.min-ea48514c.js"),["assets/ort.webgpu.bundle.min-ea48514c.js","assets/vendor-e72fc605.js","assets/utils-e8ee15a8.js"])).default:Cd=(await gp(()=>import("./ort.min-f571ca7c.js").then(e=>e.o),["assets/ort.min-f571ca7c.js","assets/vendor-e72fc605.js"])).default),Cd);async function rq(n,e){const t=e.device==="gpu"&&await uO(),s=t&&e.proxyToWorker,r=[t?"webgpu":"wasm"],i=await dO(t);e.debug&&(console.debug("	Using WebGPU:",t),console.debug("	Proxy to Worker:",s),i.env.debug=!0,i.env.logLevel="verbose"),i.env.wasm.numThreads=sq(),i.env.wasm.proxy=s;const o=t?"/onnxruntime-web/ort-wasm-simd-threaded.jsep":"/onnxruntime-web/ort-wasm-simd-threaded",a=await qA(`${o}.wasm`,e),l=await qA(`${o}.mjs`,e);i.env.wasm.wasmPaths={mjs:l,wasm:a},e.debug&&console.debug("ort.env.wasm:",i.env.wasm);const c={executionProviders:r,graphOptimizationLevel:"all",executionMode:"parallel",enableCpuMemArena:!0};return await i.InferenceSession.create(n,c).catch(h=>{throw new Error(`Failed to create session: "${h}". Please check if the publicPath is set correctly.`)})}async function iq(n,e,t,s){const r=s.device==="gpu"&&await uO(),i=await dO(r),o={};for(const[c,u]of e)o[c]=new i.Tensor("float32",new Float32Array(u.data),u.shape);const a=await n.run(o,{}),l=[];for(const c of t){const u=a[c],h=u.dims,d=u.data,p=(0,nq.default)(d,h);l.push(p)}return l}var Pt;(function(n){n.assertEqual=r=>r;function e(r){}n.assertIs=e;function t(r){throw new Error}n.assertNever=t,n.arrayToEnum=r=>{const i={};for(const o of r)i[o]=o;return i},n.getValidEnumValues=r=>{const i=n.objectKeys(r).filter(a=>typeof r[r[a]]!="number"),o={};for(const a of i)o[a]=r[a];return n.objectValues(o)},n.objectValues=r=>n.objectKeys(r).map(function(i){return r[i]}),n.objectKeys=typeof Object.keys=="function"?r=>Object.keys(r):r=>{const i=[];for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&i.push(o);return i},n.find=(r,i)=>{for(const o of r)if(i(o))return o},n.isInteger=typeof Number.isInteger=="function"?r=>Number.isInteger(r):r=>typeof r=="number"&&isFinite(r)&&Math.floor(r)===r;function s(r,i=" | "){return r.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}n.joinValues=s,n.jsonStringifyReplacer=(r,i)=>typeof i=="bigint"?i.toString():i})(Pt||(Pt={}));var H1;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(H1||(H1={}));var $e=Pt.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),oo=n=>{switch(typeof n){case"undefined":return $e.undefined;case"string":return $e.string;case"number":return isNaN(n)?$e.nan:$e.number;case"boolean":return $e.boolean;case"function":return $e.function;case"bigint":return $e.bigint;case"symbol":return $e.symbol;case"object":return Array.isArray(n)?$e.array:n===null?$e.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?$e.promise:typeof Map<"u"&&n instanceof Map?$e.map:typeof Set<"u"&&n instanceof Set?$e.set:typeof Date<"u"&&n instanceof Date?$e.date:$e.object;default:return $e.unknown}},xe=Pt.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),oq=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:"),ri=class pO extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(i){return i.message},s={_errors:[]},r=i=>{for(const o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(r);else if(o.code==="invalid_return_type")r(o.returnTypeError);else if(o.code==="invalid_arguments")r(o.argumentsError);else if(o.path.length===0)s._errors.push(t(o));else{let a=s,l=0;for(;l<o.path.length;){const c=o.path[l];l===o.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(t(o))):a[c]=a[c]||{_errors:[]},a=a[c],l++}}};return r(this),s}static assert(e){if(!(e instanceof pO))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Pt.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},s=[];for(const r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):s.push(e(r));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}};ri.create=n=>new ri(n);var hu=(n,e)=>{let t;switch(n.code){case xe.invalid_type:n.received===$e.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case xe.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,Pt.jsonStringifyReplacer)}`;break;case xe.unrecognized_keys:t=`Unrecognized key(s) in object: ${Pt.joinValues(n.keys,", ")}`;break;case xe.invalid_union:t="Invalid input";break;case xe.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${Pt.joinValues(n.options)}`;break;case xe.invalid_enum_value:t=`Invalid enum value. Expected ${Pt.joinValues(n.options)}, received '${n.received}'`;break;case xe.invalid_arguments:t="Invalid function arguments";break;case xe.invalid_return_type:t="Invalid function return type";break;case xe.invalid_date:t="Invalid date";break;case xe.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:Pt.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case xe.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case xe.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case xe.custom:t="Invalid input";break;case xe.invalid_intersection_types:t="Intersection results could not be merged";break;case xe.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case xe.not_finite:t="Number must be finite";break;default:t=e.defaultError,Pt.assertNever(n)}return{message:t}},fO=hu;function aq(n){fO=n}function Gy(){return fO}var Hy=n=>{const{data:e,path:t,errorMaps:s,issueData:r}=n,i=[...t,...r.path||[]],o={...r,path:i};if(r.message!==void 0)return{...r,path:i,message:r.message};let a="";const l=s.filter(c=>!!c).slice().reverse();for(const c of l)a=c(o,{data:e,defaultError:a}).message;return{...r,path:i,message:a}},lq=[];function Ce(n,e){const t=Gy(),s=Hy({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===hu?void 0:hu].filter(r=>!!r)});n.common.issues.push(s)}var or=class mO{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const s=[];for(const r of t){if(r.status==="aborted")return Je;r.status==="dirty"&&e.dirty(),s.push(r.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){const s=[];for(const r of t){const i=await r.key,o=await r.value;s.push({key:i,value:o})}return mO.mergeObjectSync(e,s)}static mergeObjectSync(e,t){const s={};for(const r of t){const{key:i,value:o}=r;if(i.status==="aborted"||o.status==="aborted")return Je;i.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||r.alwaysSet)&&(s[i.value]=o.value)}return{status:e.value,value:s}}},Je=Object.freeze({status:"aborted"}),Qc=n=>({status:"dirty",value:n}),Us=n=>({status:"valid",value:n}),q1=n=>n.status==="aborted",K1=n=>n.status==="dirty",Fl=n=>n.status==="valid",xp=n=>typeof Promise<"u"&&n instanceof Promise;function qy(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)}function gO(n,e,t,s,r){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?r.call(n,t):r?r.value=t:e.set(n,t),t}var Ve;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(Ve||(Ve={}));var Ld,Md,qi=class{constructor(n,e,t,s){this._cachedPath=[],this.parent=n,this.data=e,this._path=t,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},KA=(n,e)=>{if(Fl(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new ri(n.common.issues);return this._error=t,this._error}}};function ut(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:s,description:r}=n;if(e&&(t||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:r}:{errorMap:(o,a)=>{var l,c;const{message:u}=n;return o.code==="invalid_enum_value"?{message:u??a.defaultError}:typeof a.data>"u"?{message:(l=u??s)!==null&&l!==void 0?l:a.defaultError}:o.code!=="invalid_type"?{message:a.defaultError}:{message:(c=u??t)!==null&&c!==void 0?c:a.defaultError}},description:r}}var bt=class{get description(){return this._def.description}_getType(n){return oo(n.data)}_getOrReturnCtx(n,e){return e||{common:n.parent.common,data:n.data,parsedType:oo(n.data),schemaErrorMap:this._def.errorMap,path:n.path,parent:n.parent}}_processInputParams(n){return{status:new or,ctx:{common:n.parent.common,data:n.data,parsedType:oo(n.data),schemaErrorMap:this._def.errorMap,path:n.path,parent:n.parent}}}_parseSync(n){const e=this._parse(n);if(xp(e))throw new Error("Synchronous parse encountered promise.");return e}_parseAsync(n){const e=this._parse(n);return Promise.resolve(e)}parse(n,e){const t=this.safeParse(n,e);if(t.success)return t.data;throw t.error}safeParse(n,e){var t;const s={common:{issues:[],async:(t=e==null?void 0:e.async)!==null&&t!==void 0?t:!1,contextualErrorMap:e==null?void 0:e.errorMap},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:n,parsedType:oo(n)},r=this._parseSync({data:n,path:s.path,parent:s});return KA(s,r)}"~validate"(n){var e,t;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:n,parsedType:oo(n)};if(!this["~standard"].async)try{const r=this._parseSync({data:n,path:[],parent:s});return Fl(r)?{value:r.value}:{issues:s.common.issues}}catch(r){!((t=(e=r==null?void 0:r.message)===null||e===void 0?void 0:e.toLowerCase())===null||t===void 0)&&t.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:n,path:[],parent:s}).then(r=>Fl(r)?{value:r.value}:{issues:s.common.issues})}async parseAsync(n,e){const t=await this.safeParseAsync(n,e);if(t.success)return t.data;throw t.error}async safeParseAsync(n,e){const t={common:{issues:[],contextualErrorMap:e==null?void 0:e.errorMap,async:!0},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:n,parsedType:oo(n)},s=this._parse({data:n,path:t.path,parent:t}),r=await(xp(s)?s:Promise.resolve(s));return KA(t,r)}refine(n,e){const t=s=>typeof e=="string"||typeof e>"u"?{message:e}:typeof e=="function"?e(s):e;return this._refinement((s,r)=>{const i=n(s),o=()=>r.addIssue({code:xe.custom,...t(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(a=>a?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(n,e){return this._refinement((t,s)=>n(t)?!0:(s.addIssue(typeof e=="function"?e(t,s):e),!1))}_refinement(n){return new pi({schema:this,typeName:Ze.ZodEffects,effect:{type:"refinement",refinement:n}})}superRefine(n){return this._refinement(n)}constructor(n){this.spa=this.safeParseAsync,this._def=n,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Fi.create(this,this._def)}nullable(){return Ia.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ll.create(this)}promise(){return fu.create(this,this._def)}or(n){return Cp.create([this,n],this._def)}and(n){return Ep.create(this,n,this._def)}transform(n){return new pi({...ut(this._def),schema:this,typeName:Ze.ZodEffects,effect:{type:"transform",transform:n}})}default(n){const e=typeof n=="function"?n:()=>n;return new Rp({...ut(this._def),innerType:this,defaultValue:e,typeName:Ze.ZodDefault})}brand(){return new YS({typeName:Ze.ZodBranded,type:this,...ut(this._def)})}catch(n){const e=typeof n=="function"?n:()=>n;return new $p({...ut(this._def),innerType:this,catchValue:e,typeName:Ze.ZodCatch})}describe(n){const e=this.constructor;return new e({...this._def,description:n})}pipe(n){return QS.create(this,n)}readonly(){return Dp.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},cq=/^c[^\s-]{8,}$/i,uq=/^[0-9a-z]+$/,hq=/^[0-9A-HJKMNP-TV-Z]{26}$/i,dq=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,pq=/^[a-z0-9_-]{21}$/i,fq=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,mq=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,gq=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,yq="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Pv,bq=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,xq=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,wq=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,vq=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Iq=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Sq=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,yO="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",kq=new RegExp(`^${yO}$`);function bO(n){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Tq(n){return new RegExp(`^${bO(n)}$`)}function xO(n){let e=`${yO}T${bO(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Cq(n,e){return!!((e==="v4"||!e)&&bq.test(n)||(e==="v6"||!e)&&wq.test(n))}function Eq(n,e){if(!fq.test(n))return!1;try{const[t]=n.split("."),s=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),r=JSON.parse(atob(s));return!(typeof r!="object"||r===null||!r.typ||!r.alg||e&&r.alg!==e)}catch{return!1}}function _q(n,e){return!!((e==="v4"||!e)&&xq.test(n)||(e==="v6"||!e)&&vq.test(n))}var du=class zd extends bt{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==$e.string){const i=this._getOrReturnCtx(e);return Ce(i,{code:xe.invalid_type,expected:$e.string,received:i.parsedType}),Je}const s=new or;let r;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(r=this._getOrReturnCtx(e,r),Ce(r,{code:xe.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="max")e.data.length>i.value&&(r=this._getOrReturnCtx(e,r),Ce(r,{code:xe.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="length"){const o=e.data.length>i.value,a=e.data.length<i.value;(o||a)&&(r=this._getOrReturnCtx(e,r),o?Ce(r,{code:xe.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):a&&Ce(r,{code:xe.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),s.dirty())}else if(i.kind==="email")gq.test(e.data)||(r=this._getOrReturnCtx(e,r),Ce(r,{validation:"email",code:xe.invalid_string,message:i.message}),s.dirty());else if(i.kind==="emoji")Pv||(Pv=new RegExp(yq,"u")),Pv.test(e.data)||(r=this._getOrReturnCtx(e,r),Ce(r,{validation:"emoji",code:xe.invalid_string,message:i.message}),s.dirty());else if(i.kind==="uuid")dq.test(e.data)||(r=this._getOrReturnCtx(e,r),Ce(r,{validation:"uuid",code:xe.invalid_string,message:i.message}),s.dirty());else if(i.kind==="nanoid")pq.test(e.data)||(r=this._getOrReturnCtx(e,r),Ce(r,{validation:"nanoid",code:xe.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid")cq.test(e.data)||(r=this._getOrReturnCtx(e,r),Ce(r,{validation:"cuid",code:xe.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid2")uq.test(e.data)||(r=this._getOrReturnCtx(e,r),Ce(r,{validation:"cuid2",code:xe.invalid_string,message:i.message}),s.dirty());else if(i.kind==="ulid")hq.test(e.data)||(r=this._getOrReturnCtx(e,r),Ce(r,{validation:"ulid",code:xe.invalid_string,message:i.message}),s.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),Ce(r,{validation:"url",code:xe.invalid_string,message:i.message}),s.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),Ce(r,{validation:"regex",code:xe.invalid_string,message:i.message}),s.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(r=this._getOrReturnCtx(e,r),Ce(r,{code:xe.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),s.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(r=this._getOrReturnCtx(e,r),Ce(r,{code:xe.invalid_string,validation:{startsWith:i.value},message:i.message}),s.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(r=this._getOrReturnCtx(e,r),Ce(r,{code:xe.invalid_string,validation:{endsWith:i.value},message:i.message}),s.dirty()):i.kind==="datetime"?xO(i).test(e.data)||(r=this._getOrReturnCtx(e,r),Ce(r,{code:xe.invalid_string,validation:"datetime",message:i.message}),s.dirty()):i.kind==="date"?kq.test(e.data)||(r=this._getOrReturnCtx(e,r),Ce(r,{code:xe.invalid_string,validation:"date",message:i.message}),s.dirty()):i.kind==="time"?Tq(i).test(e.data)||(r=this._getOrReturnCtx(e,r),Ce(r,{code:xe.invalid_string,validation:"time",message:i.message}),s.dirty()):i.kind==="duration"?mq.test(e.data)||(r=this._getOrReturnCtx(e,r),Ce(r,{validation:"duration",code:xe.invalid_string,message:i.message}),s.dirty()):i.kind==="ip"?Cq(e.data,i.version)||(r=this._getOrReturnCtx(e,r),Ce(r,{validation:"ip",code:xe.invalid_string,message:i.message}),s.dirty()):i.kind==="jwt"?Eq(e.data,i.alg)||(r=this._getOrReturnCtx(e,r),Ce(r,{validation:"jwt",code:xe.invalid_string,message:i.message}),s.dirty()):i.kind==="cidr"?_q(e.data,i.version)||(r=this._getOrReturnCtx(e,r),Ce(r,{validation:"cidr",code:xe.invalid_string,message:i.message}),s.dirty()):i.kind==="base64"?Iq.test(e.data)||(r=this._getOrReturnCtx(e,r),Ce(r,{validation:"base64",code:xe.invalid_string,message:i.message}),s.dirty()):i.kind==="base64url"?Sq.test(e.data)||(r=this._getOrReturnCtx(e,r),Ce(r,{validation:"base64url",code:xe.invalid_string,message:i.message}),s.dirty()):Pt.assertNever(i);return{status:s.value,value:e.data}}_regex(e,t,s){return this.refinement(r=>e.test(r),{validation:t,code:xe.invalid_string,...Ve.errToObj(s)})}_addCheck(e){return new zd({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Ve.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Ve.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Ve.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Ve.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Ve.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Ve.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Ve.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Ve.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Ve.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Ve.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Ve.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Ve.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Ve.errToObj(e)})}datetime(e){var t,s;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(s=e==null?void 0:e.local)!==null&&s!==void 0?s:!1,...Ve.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...Ve.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...Ve.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Ve.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...Ve.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Ve.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Ve.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Ve.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Ve.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Ve.errToObj(t)})}nonempty(e){return this.min(1,Ve.errToObj(e))}trim(){return new zd({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new zd({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new zd({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};du.create=n=>{var e;return new du({checks:[],typeName:Ze.ZodString,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...ut(n)})};function Nq(n,e){const t=(n.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,r=t>s?t:s,i=parseInt(n.toFixed(r).replace(".","")),o=parseInt(e.toFixed(r).replace(".",""));return i%o/Math.pow(10,r)}var wp=class X1 extends bt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==$e.number){const i=this._getOrReturnCtx(e);return Ce(i,{code:xe.invalid_type,expected:$e.number,received:i.parsedType}),Je}let s;const r=new or;for(const i of this._def.checks)i.kind==="int"?Pt.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),Ce(s,{code:xe.invalid_type,expected:"integer",received:"float",message:i.message}),r.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),Ce(s,{code:xe.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),Ce(s,{code:xe.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):i.kind==="multipleOf"?Nq(e.data,i.value)!==0&&(s=this._getOrReturnCtx(e,s),Ce(s,{code:xe.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),Ce(s,{code:xe.not_finite,message:i.message}),r.dirty()):Pt.assertNever(i);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Ve.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Ve.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Ve.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Ve.toString(t))}setLimit(e,t,s,r){return new X1({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:Ve.toString(r)}]})}_addCheck(e){return new X1({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Ve.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Ve.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Ve.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Ve.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Ve.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Ve.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Ve.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Ve.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Ve.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Pt.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(t===null||s.value>t)&&(t=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}};wp.create=n=>new wp({checks:[],typeName:Ze.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...ut(n)});var vp=class Y1 extends bt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==$e.bigint)return this._getInvalidInput(e);let s;const r=new or;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),Ce(s,{code:xe.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),Ce(s,{code:xe.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),Ce(s,{code:xe.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):Pt.assertNever(i);return{status:r.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return Ce(t,{code:xe.invalid_type,expected:$e.bigint,received:t.parsedType}),Je}gte(e,t){return this.setLimit("min",e,!0,Ve.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Ve.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Ve.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Ve.toString(t))}setLimit(e,t,s,r){return new Y1({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:Ve.toString(r)}]})}_addCheck(e){return new Y1({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Ve.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Ve.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Ve.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Ve.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Ve.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};vp.create=n=>{var e;return new vp({checks:[],typeName:Ze.ZodBigInt,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...ut(n)})};var Ip=class extends bt{_parse(n){if(this._def.coerce&&(n.data=!!n.data),this._getType(n)!==$e.boolean){const t=this._getOrReturnCtx(n);return Ce(t,{code:xe.invalid_type,expected:$e.boolean,received:t.parsedType}),Je}return Us(n.data)}};Ip.create=n=>new Ip({typeName:Ze.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...ut(n)});var Sp=class wO extends bt{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==$e.date){const i=this._getOrReturnCtx(e);return Ce(i,{code:xe.invalid_type,expected:$e.date,received:i.parsedType}),Je}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return Ce(i,{code:xe.invalid_date}),Je}const s=new or;let r;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(r=this._getOrReturnCtx(e,r),Ce(r,{code:xe.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),s.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(r=this._getOrReturnCtx(e,r),Ce(r,{code:xe.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),s.dirty()):Pt.assertNever(i);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new wO({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Ve.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Ve.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};Sp.create=n=>new Sp({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:Ze.ZodDate,...ut(n)});var Ky=class extends bt{_parse(n){if(this._getType(n)!==$e.symbol){const t=this._getOrReturnCtx(n);return Ce(t,{code:xe.invalid_type,expected:$e.symbol,received:t.parsedType}),Je}return Us(n.data)}};Ky.create=n=>new Ky({typeName:Ze.ZodSymbol,...ut(n)});var kp=class extends bt{_parse(n){if(this._getType(n)!==$e.undefined){const t=this._getOrReturnCtx(n);return Ce(t,{code:xe.invalid_type,expected:$e.undefined,received:t.parsedType}),Je}return Us(n.data)}};kp.create=n=>new kp({typeName:Ze.ZodUndefined,...ut(n)});var Tp=class extends bt{_parse(n){if(this._getType(n)!==$e.null){const t=this._getOrReturnCtx(n);return Ce(t,{code:xe.invalid_type,expected:$e.null,received:t.parsedType}),Je}return Us(n.data)}};Tp.create=n=>new Tp({typeName:Ze.ZodNull,...ut(n)});var pu=class extends bt{constructor(){super(...arguments),this._any=!0}_parse(n){return Us(n.data)}};pu.create=n=>new pu({typeName:Ze.ZodAny,...ut(n)});var _l=class extends bt{constructor(){super(...arguments),this._unknown=!0}_parse(n){return Us(n.data)}};_l.create=n=>new _l({typeName:Ze.ZodUnknown,...ut(n)});var xo=class extends bt{_parse(n){const e=this._getOrReturnCtx(n);return Ce(e,{code:xe.invalid_type,expected:$e.never,received:e.parsedType}),Je}};xo.create=n=>new xo({typeName:Ze.ZodNever,...ut(n)});var Xy=class extends bt{_parse(n){if(this._getType(n)!==$e.undefined){const t=this._getOrReturnCtx(n);return Ce(t,{code:xe.invalid_type,expected:$e.void,received:t.parsedType}),Je}return Us(n.data)}};Xy.create=n=>new Xy({typeName:Ze.ZodVoid,...ut(n)});var Ll=class py extends bt{_parse(e){const{ctx:t,status:s}=this._processInputParams(e),r=this._def;if(t.parsedType!==$e.array)return Ce(t,{code:xe.invalid_type,expected:$e.array,received:t.parsedType}),Je;if(r.exactLength!==null){const o=t.data.length>r.exactLength.value,a=t.data.length<r.exactLength.value;(o||a)&&(Ce(t,{code:o?xe.too_big:xe.too_small,minimum:a?r.exactLength.value:void 0,maximum:o?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),s.dirty())}if(r.minLength!==null&&t.data.length<r.minLength.value&&(Ce(t,{code:xe.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),s.dirty()),r.maxLength!==null&&t.data.length>r.maxLength.value&&(Ce(t,{code:xe.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((o,a)=>r.type._parseAsync(new qi(t,o,t.path,a)))).then(o=>or.mergeArray(s,o));const i=[...t.data].map((o,a)=>r.type._parseSync(new qi(t,o,t.path,a)));return or.mergeArray(s,i)}get element(){return this._def.type}min(e,t){return new py({...this._def,minLength:{value:e,message:Ve.toString(t)}})}max(e,t){return new py({...this._def,maxLength:{value:e,message:Ve.toString(t)}})}length(e,t){return new py({...this._def,exactLength:{value:e,message:Ve.toString(t)}})}nonempty(e){return this.min(1,e)}};Ll.create=(n,e)=>new Ll({type:n,minLength:null,maxLength:null,exactLength:null,typeName:Ze.ZodArray,...ut(e)});function jc(n){if(n instanceof Ur){const e={};for(const t in n.shape){const s=n.shape[t];e[t]=Fi.create(jc(s))}return new Ur({...n._def,shape:()=>e})}else return n instanceof Ll?new Ll({...n._def,type:jc(n.element)}):n instanceof Fi?Fi.create(jc(n.unwrap())):n instanceof Ia?Ia.create(jc(n.unwrap())):n instanceof va?va.create(n.items.map(e=>jc(e))):n}var Ur=class Yr extends bt{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=Pt.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==$e.object){const c=this._getOrReturnCtx(e);return Ce(c,{code:xe.invalid_type,expected:$e.object,received:c.parsedType}),Je}const{status:s,ctx:r}=this._processInputParams(e),{shape:i,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof xo&&this._def.unknownKeys==="strip"))for(const c in r.data)o.includes(c)||a.push(c);const l=[];for(const c of o){const u=i[c],h=r.data[c];l.push({key:{status:"valid",value:c},value:u._parse(new qi(r,h,r.path,c)),alwaysSet:c in r.data})}if(this._def.catchall instanceof xo){const c=this._def.unknownKeys;if(c==="passthrough")for(const u of a)l.push({key:{status:"valid",value:u},value:{status:"valid",value:r.data[u]}});else if(c==="strict")a.length>0&&(Ce(r,{code:xe.unrecognized_keys,keys:a}),s.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const u of a){const h=r.data[u];l.push({key:{status:"valid",value:u},value:c._parse(new qi(r,h,r.path,u)),alwaysSet:u in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const c=[];for(const u of l){const h=await u.key,d=await u.value;c.push({key:h,value:d,alwaysSet:u.alwaysSet})}return c}).then(c=>or.mergeObjectSync(s,c)):or.mergeObjectSync(s,l)}get shape(){return this._def.shape()}strict(e){return Ve.errToObj,new Yr({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,s)=>{var r,i,o,a;const l=(o=(i=(r=this._def).errorMap)===null||i===void 0?void 0:i.call(r,t,s).message)!==null&&o!==void 0?o:s.defaultError;return t.code==="unrecognized_keys"?{message:(a=Ve.errToObj(e).message)!==null&&a!==void 0?a:l}:{message:l}}}:{}})}strip(){return new Yr({...this._def,unknownKeys:"strip"})}passthrough(){return new Yr({...this._def,unknownKeys:"passthrough"})}extend(e){return new Yr({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Yr({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Ze.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Yr({...this._def,catchall:e})}pick(e){const t={};return Pt.objectKeys(e).forEach(s=>{e[s]&&this.shape[s]&&(t[s]=this.shape[s])}),new Yr({...this._def,shape:()=>t})}omit(e){const t={};return Pt.objectKeys(this.shape).forEach(s=>{e[s]||(t[s]=this.shape[s])}),new Yr({...this._def,shape:()=>t})}deepPartial(){return jc(this)}partial(e){const t={};return Pt.objectKeys(this.shape).forEach(s=>{const r=this.shape[s];e&&!e[s]?t[s]=r:t[s]=r.optional()}),new Yr({...this._def,shape:()=>t})}required(e){const t={};return Pt.objectKeys(this.shape).forEach(s=>{if(e&&!e[s])t[s]=this.shape[s];else{let i=this.shape[s];for(;i instanceof Fi;)i=i._def.innerType;t[s]=i}}),new Yr({...this._def,shape:()=>t})}keyof(){return CO(Pt.objectKeys(this.shape))}};Ur.create=(n,e)=>new Ur({shape:()=>n,unknownKeys:"strip",catchall:xo.create(),typeName:Ze.ZodObject,...ut(e)});Ur.strictCreate=(n,e)=>new Ur({shape:()=>n,unknownKeys:"strict",catchall:xo.create(),typeName:Ze.ZodObject,...ut(e)});Ur.lazycreate=(n,e)=>new Ur({shape:n,unknownKeys:"strip",catchall:xo.create(),typeName:Ze.ZodObject,...ut(e)});var Cp=class extends bt{_parse(n){const{ctx:e}=this._processInputParams(n),t=this._def.options;function s(r){for(const o of r)if(o.result.status==="valid")return o.result;for(const o of r)if(o.result.status==="dirty")return e.common.issues.push(...o.ctx.common.issues),o.result;const i=r.map(o=>new ri(o.ctx.common.issues));return Ce(e,{code:xe.invalid_union,unionErrors:i}),Je}if(e.common.async)return Promise.all(t.map(async r=>{const i={...e,common:{...e.common,issues:[]},parent:null};return{result:await r._parseAsync({data:e.data,path:e.path,parent:i}),ctx:i}})).then(s);{let r;const i=[];for(const a of t){const l={...e,common:{...e.common,issues:[]},parent:null},c=a._parseSync({data:e.data,path:e.path,parent:l});if(c.status==="valid")return c;c.status==="dirty"&&!r&&(r={result:c,ctx:l}),l.common.issues.length&&i.push(l.common.issues)}if(r)return e.common.issues.push(...r.ctx.common.issues),r.result;const o=i.map(a=>new ri(a));return Ce(e,{code:xe.invalid_union,unionErrors:o}),Je}}get options(){return this._def.options}};Cp.create=(n,e)=>new Cp({options:n,typeName:Ze.ZodUnion,...ut(e)});var io=n=>n instanceof _p?io(n.schema):n instanceof pi?io(n.innerType()):n instanceof Np?[n.value]:n instanceof bf?n.options:n instanceof Ap?Pt.objectValues(n.enum):n instanceof Rp?io(n._def.innerType):n instanceof kp?[void 0]:n instanceof Tp?[null]:n instanceof Fi?[void 0,...io(n.unwrap())]:n instanceof Ia?[null,...io(n.unwrap())]:n instanceof YS||n instanceof Dp?io(n.unwrap()):n instanceof $p?io(n._def.innerType):[],vO=class IO extends bt{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==$e.object)return Ce(t,{code:xe.invalid_type,expected:$e.object,received:t.parsedType}),Je;const s=this.discriminator,r=t.data[s],i=this.optionsMap.get(r);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(Ce(t,{code:xe.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),Je)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){const r=new Map;for(const i of t){const o=io(i.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const a of o){if(r.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);r.set(a,i)}}return new IO({typeName:Ze.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...ut(s)})}};function Q1(n,e){const t=oo(n),s=oo(e);if(n===e)return{valid:!0,data:n};if(t===$e.object&&s===$e.object){const r=Pt.objectKeys(e),i=Pt.objectKeys(n).filter(a=>r.indexOf(a)!==-1),o={...n,...e};for(const a of i){const l=Q1(n[a],e[a]);if(!l.valid)return{valid:!1};o[a]=l.data}return{valid:!0,data:o}}else if(t===$e.array&&s===$e.array){if(n.length!==e.length)return{valid:!1};const r=[];for(let i=0;i<n.length;i++){const o=n[i],a=e[i],l=Q1(o,a);if(!l.valid)return{valid:!1};r.push(l.data)}return{valid:!0,data:r}}else return t===$e.date&&s===$e.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}var Ep=class extends bt{_parse(n){const{status:e,ctx:t}=this._processInputParams(n),s=(r,i)=>{if(q1(r)||q1(i))return Je;const o=Q1(r.value,i.value);return o.valid?((K1(r)||K1(i))&&e.dirty(),{status:e.value,value:o.data}):(Ce(t,{code:xe.invalid_intersection_types}),Je)};return t.common.async?Promise.all([this._def.left._parseAsync({data:t.data,path:t.path,parent:t}),this._def.right._parseAsync({data:t.data,path:t.path,parent:t})]).then(([r,i])=>s(r,i)):s(this._def.left._parseSync({data:t.data,path:t.path,parent:t}),this._def.right._parseSync({data:t.data,path:t.path,parent:t}))}};Ep.create=(n,e,t)=>new Ep({left:n,right:e,typeName:Ze.ZodIntersection,...ut(t)});var va=class SO extends bt{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==$e.array)return Ce(s,{code:xe.invalid_type,expected:$e.array,received:s.parsedType}),Je;if(s.data.length<this._def.items.length)return Ce(s,{code:xe.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Je;!this._def.rest&&s.data.length>this._def.items.length&&(Ce(s,{code:xe.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...s.data].map((o,a)=>{const l=this._def.items[a]||this._def.rest;return l?l._parse(new qi(s,o,s.path,a)):null}).filter(o=>!!o);return s.common.async?Promise.all(i).then(o=>or.mergeArray(t,o)):or.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new SO({...this._def,rest:e})}};va.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new va({items:n,typeName:Ze.ZodTuple,rest:null,...ut(e)})};var kO=class Z1 extends bt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==$e.object)return Ce(s,{code:xe.invalid_type,expected:$e.object,received:s.parsedType}),Je;const r=[],i=this._def.keyType,o=this._def.valueType;for(const a in s.data)r.push({key:i._parse(new qi(s,a,s.path,a)),value:o._parse(new qi(s,s.data[a],s.path,a)),alwaysSet:a in s.data});return s.common.async?or.mergeObjectAsync(t,r):or.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,s){return t instanceof bt?new Z1({keyType:e,valueType:t,typeName:Ze.ZodRecord,...ut(s)}):new Z1({keyType:du.create(),valueType:e,typeName:Ze.ZodRecord,...ut(t)})}},Yy=class extends bt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(n){const{status:e,ctx:t}=this._processInputParams(n);if(t.parsedType!==$e.map)return Ce(t,{code:xe.invalid_type,expected:$e.map,received:t.parsedType}),Je;const s=this._def.keyType,r=this._def.valueType,i=[...t.data.entries()].map(([o,a],l)=>({key:s._parse(new qi(t,o,t.path,[l,"key"])),value:r._parse(new qi(t,a,t.path,[l,"value"]))}));if(t.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const a of i){const l=await a.key,c=await a.value;if(l.status==="aborted"||c.status==="aborted")return Je;(l.status==="dirty"||c.status==="dirty")&&e.dirty(),o.set(l.value,c.value)}return{status:e.value,value:o}})}else{const o=new Map;for(const a of i){const l=a.key,c=a.value;if(l.status==="aborted"||c.status==="aborted")return Je;(l.status==="dirty"||c.status==="dirty")&&e.dirty(),o.set(l.value,c.value)}return{status:e.value,value:o}}}};Yy.create=(n,e,t)=>new Yy({valueType:e,keyType:n,typeName:Ze.ZodMap,...ut(t)});var Qy=class J1 extends bt{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==$e.set)return Ce(s,{code:xe.invalid_type,expected:$e.set,received:s.parsedType}),Je;const r=this._def;r.minSize!==null&&s.data.size<r.minSize.value&&(Ce(s,{code:xe.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),r.maxSize!==null&&s.data.size>r.maxSize.value&&(Ce(s,{code:xe.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const i=this._def.valueType;function o(l){const c=new Set;for(const u of l){if(u.status==="aborted")return Je;u.status==="dirty"&&t.dirty(),c.add(u.value)}return{status:t.value,value:c}}const a=[...s.data.values()].map((l,c)=>i._parse(new qi(s,l,s.path,c)));return s.common.async?Promise.all(a).then(l=>o(l)):o(a)}min(e,t){return new J1({...this._def,minSize:{value:e,message:Ve.toString(t)}})}max(e,t){return new J1({...this._def,maxSize:{value:e,message:Ve.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Qy.create=(n,e)=>new Qy({valueType:n,minSize:null,maxSize:null,typeName:Ze.ZodSet,...ut(e)});var TO=class fy extends bt{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==$e.function)return Ce(t,{code:xe.invalid_type,expected:$e.function,received:t.parsedType}),Je;function s(a,l){return Hy({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Gy(),hu].filter(c=>!!c),issueData:{code:xe.invalid_arguments,argumentsError:l}})}function r(a,l){return Hy({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Gy(),hu].filter(c=>!!c),issueData:{code:xe.invalid_return_type,returnTypeError:l}})}const i={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof fu){const a=this;return Us(async function(...l){const c=new ri([]),u=await a._def.args.parseAsync(l,i).catch(p=>{throw c.addIssue(s(l,p)),c}),h=await Reflect.apply(o,this,u);return await a._def.returns._def.type.parseAsync(h,i).catch(p=>{throw c.addIssue(r(h,p)),c})})}else{const a=this;return Us(function(...l){const c=a._def.args.safeParse(l,i);if(!c.success)throw new ri([s(l,c.error)]);const u=Reflect.apply(o,this,c.data),h=a._def.returns.safeParse(u,i);if(!h.success)throw new ri([r(u,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new fy({...this._def,args:va.create(e).rest(_l.create())})}returns(e){return new fy({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new fy({args:e||va.create([]).rest(_l.create()),returns:t||_l.create(),typeName:Ze.ZodFunction,...ut(s)})}},_p=class extends bt{get schema(){return this._def.getter()}_parse(n){const{ctx:e}=this._processInputParams(n);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}};_p.create=(n,e)=>new _p({getter:n,typeName:Ze.ZodLazy,...ut(e)});var Np=class extends bt{_parse(n){if(n.data!==this._def.value){const e=this._getOrReturnCtx(n);return Ce(e,{received:e.data,code:xe.invalid_literal,expected:this._def.value}),Je}return{status:"valid",value:n.data}}get value(){return this._def.value}};Np.create=(n,e)=>new Np({value:n,typeName:Ze.ZodLiteral,...ut(e)});function CO(n,e){return new bf({values:n,typeName:Ze.ZodEnum,...ut(e)})}var bf=class eI extends bt{constructor(){super(...arguments),Ld.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),s=this._def.values;return Ce(t,{expected:Pt.joinValues(s),received:t.parsedType,code:xe.invalid_type}),Je}if(qy(this,Ld,"f")||gO(this,Ld,new Set(this._def.values),"f"),!qy(this,Ld,"f").has(e.data)){const t=this._getOrReturnCtx(e),s=this._def.values;return Ce(t,{received:t.data,code:xe.invalid_enum_value,options:s}),Je}return Us(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return eI.create(e,{...this._def,...t})}exclude(e,t=this._def){return eI.create(this.options.filter(s=>!e.includes(s)),{...this._def,...t})}};Ld=new WeakMap;bf.create=CO;var Ap=class extends bt{constructor(){super(...arguments),Md.set(this,void 0)}_parse(n){const e=Pt.getValidEnumValues(this._def.values),t=this._getOrReturnCtx(n);if(t.parsedType!==$e.string&&t.parsedType!==$e.number){const s=Pt.objectValues(e);return Ce(t,{expected:Pt.joinValues(s),received:t.parsedType,code:xe.invalid_type}),Je}if(qy(this,Md,"f")||gO(this,Md,new Set(Pt.getValidEnumValues(this._def.values)),"f"),!qy(this,Md,"f").has(n.data)){const s=Pt.objectValues(e);return Ce(t,{received:t.data,code:xe.invalid_enum_value,options:s}),Je}return Us(n.data)}get enum(){return this._def.values}};Md=new WeakMap;Ap.create=(n,e)=>new Ap({values:n,typeName:Ze.ZodNativeEnum,...ut(e)});var fu=class extends bt{unwrap(){return this._def.type}_parse(n){const{ctx:e}=this._processInputParams(n);if(e.parsedType!==$e.promise&&e.common.async===!1)return Ce(e,{code:xe.invalid_type,expected:$e.promise,received:e.parsedType}),Je;const t=e.parsedType===$e.promise?e.data:Promise.resolve(e.data);return Us(t.then(s=>this._def.type.parseAsync(s,{path:e.path,errorMap:e.common.contextualErrorMap})))}};fu.create=(n,e)=>new fu({type:n,typeName:Ze.ZodPromise,...ut(e)});var pi=class extends bt{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Ze.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(n){const{status:e,ctx:t}=this._processInputParams(n),s=this._def.effect||null,r={addIssue:i=>{Ce(t,i),i.fatal?e.abort():e.dirty()},get path(){return t.path}};if(r.addIssue=r.addIssue.bind(r),s.type==="preprocess"){const i=s.transform(t.data,r);if(t.common.async)return Promise.resolve(i).then(async o=>{if(e.value==="aborted")return Je;const a=await this._def.schema._parseAsync({data:o,path:t.path,parent:t});return a.status==="aborted"?Je:a.status==="dirty"||e.value==="dirty"?Qc(a.value):a});{if(e.value==="aborted")return Je;const o=this._def.schema._parseSync({data:i,path:t.path,parent:t});return o.status==="aborted"?Je:o.status==="dirty"||e.value==="dirty"?Qc(o.value):o}}if(s.type==="refinement"){const i=o=>{const a=s.refinement(o,r);if(t.common.async)return Promise.resolve(a);if(a instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(t.common.async===!1){const o=this._def.schema._parseSync({data:t.data,path:t.path,parent:t});return o.status==="aborted"?Je:(o.status==="dirty"&&e.dirty(),i(o.value),{status:e.value,value:o.value})}else return this._def.schema._parseAsync({data:t.data,path:t.path,parent:t}).then(o=>o.status==="aborted"?Je:(o.status==="dirty"&&e.dirty(),i(o.value).then(()=>({status:e.value,value:o.value}))))}if(s.type==="transform")if(t.common.async===!1){const i=this._def.schema._parseSync({data:t.data,path:t.path,parent:t});if(!Fl(i))return i;const o=s.transform(i.value,r);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:o}}else return this._def.schema._parseAsync({data:t.data,path:t.path,parent:t}).then(i=>Fl(i)?Promise.resolve(s.transform(i.value,r)).then(o=>({status:e.value,value:o})):i);Pt.assertNever(s)}};pi.create=(n,e,t)=>new pi({schema:n,typeName:Ze.ZodEffects,effect:e,...ut(t)});pi.createWithPreprocess=(n,e,t)=>new pi({schema:e,effect:{type:"preprocess",transform:n},typeName:Ze.ZodEffects,...ut(t)});var Fi=class extends bt{_parse(n){return this._getType(n)===$e.undefined?Us(void 0):this._def.innerType._parse(n)}unwrap(){return this._def.innerType}};Fi.create=(n,e)=>new Fi({innerType:n,typeName:Ze.ZodOptional,...ut(e)});var Ia=class extends bt{_parse(n){return this._getType(n)===$e.null?Us(null):this._def.innerType._parse(n)}unwrap(){return this._def.innerType}};Ia.create=(n,e)=>new Ia({innerType:n,typeName:Ze.ZodNullable,...ut(e)});var Rp=class extends bt{_parse(n){const{ctx:e}=this._processInputParams(n);let t=e.data;return e.parsedType===$e.undefined&&(t=this._def.defaultValue()),this._def.innerType._parse({data:t,path:e.path,parent:e})}removeDefault(){return this._def.innerType}};Rp.create=(n,e)=>new Rp({innerType:n,typeName:Ze.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...ut(e)});var $p=class extends bt{_parse(n){const{ctx:e}=this._processInputParams(n),t={...e,common:{...e.common,issues:[]}},s=this._def.innerType._parse({data:t.data,path:t.path,parent:{...t}});return xp(s)?s.then(r=>({status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new ri(t.common.issues)},input:t.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new ri(t.common.issues)},input:t.data})}}removeCatch(){return this._def.innerType}};$p.create=(n,e)=>new $p({innerType:n,typeName:Ze.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...ut(e)});var Zy=class extends bt{_parse(n){if(this._getType(n)!==$e.nan){const t=this._getOrReturnCtx(n);return Ce(t,{code:xe.invalid_type,expected:$e.nan,received:t.parsedType}),Je}return{status:"valid",value:n.data}}};Zy.create=n=>new Zy({typeName:Ze.ZodNaN,...ut(n)});var Aq=Symbol("zod_brand"),YS=class extends bt{_parse(n){const{ctx:e}=this._processInputParams(n),t=e.data;return this._def.type._parse({data:t,path:e.path,parent:e})}unwrap(){return this._def.type}},QS=class EO extends bt{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?Je:i.status==="dirty"?(t.dirty(),Qc(i.value)):this._def.out._parseAsync({data:i.value,path:s.path,parent:s})})();{const r=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return r.status==="aborted"?Je:r.status==="dirty"?(t.dirty(),{status:"dirty",value:r.value}):this._def.out._parseSync({data:r.value,path:s.path,parent:s})}}static create(e,t){return new EO({in:e,out:t,typeName:Ze.ZodPipeline})}},Dp=class extends bt{_parse(n){const e=this._def.innerType._parse(n),t=s=>(Fl(s)&&(s.value=Object.freeze(s.value)),s);return xp(e)?e.then(s=>t(s)):t(e)}unwrap(){return this._def.innerType}};Dp.create=(n,e)=>new Dp({innerType:n,typeName:Ze.ZodReadonly,...ut(e)});function XA(n,e){const t=typeof n=="function"?n(e):typeof n=="string"?{message:n}:n;return typeof t=="string"?{message:t}:t}function _O(n,e={},t){return n?pu.create().superRefine((s,r)=>{var i,o;const a=n(s);if(a instanceof Promise)return a.then(l=>{var c,u;if(!l){const h=XA(e,s),d=(u=(c=h.fatal)!==null&&c!==void 0?c:t)!==null&&u!==void 0?u:!0;r.addIssue({code:"custom",...h,fatal:d})}});if(!a){const l=XA(e,s),c=(o=(i=l.fatal)!==null&&i!==void 0?i:t)!==null&&o!==void 0?o:!0;r.addIssue({code:"custom",...l,fatal:c})}}):pu.create()}var Rq={object:Ur.lazycreate},Ze;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(Ze||(Ze={}));var $q=(n,e={message:`Input not instance of ${n.name}`})=>_O(t=>t instanceof n,e),NO=du.create,AO=wp.create,Dq=Zy.create,Pq=vp.create,RO=Ip.create,Oq=Sp.create,Fq=Ky.create,Lq=kp.create,Mq=Tp.create,zq=pu.create,Vq=_l.create,Bq=xo.create,jq=Xy.create,Uq=Ll.create,Wq=Ur.create,Gq=Ur.strictCreate,Hq=Cp.create,qq=vO.create,Kq=Ep.create,Xq=va.create,Yq=kO.create,Qq=Yy.create,Zq=Qy.create,Jq=TO.create,e9=_p.create,t9=Np.create,n9=bf.create,s9=Ap.create,r9=fu.create,YA=pi.create,i9=Fi.create,o9=Ia.create,a9=pi.createWithPreprocess,l9=QS.create,c9=()=>NO().optional(),u9=()=>AO().optional(),h9=()=>RO().optional(),d9={string:n=>du.create({...n,coerce:!0}),number:n=>wp.create({...n,coerce:!0}),boolean:n=>Ip.create({...n,coerce:!0}),bigint:n=>vp.create({...n,coerce:!0}),date:n=>Sp.create({...n,coerce:!0})},p9=Je,ds=Object.freeze({__proto__:null,defaultErrorMap:hu,setErrorMap:aq,getErrorMap:Gy,makeIssue:Hy,EMPTY_PATH:lq,addIssueToContext:Ce,ParseStatus:or,INVALID:Je,DIRTY:Qc,OK:Us,isAborted:q1,isDirty:K1,isValid:Fl,isAsync:xp,get util(){return Pt},get objectUtil(){return H1},ZodParsedType:$e,getParsedType:oo,ZodType:bt,datetimeRegex:xO,ZodString:du,ZodNumber:wp,ZodBigInt:vp,ZodBoolean:Ip,ZodDate:Sp,ZodSymbol:Ky,ZodUndefined:kp,ZodNull:Tp,ZodAny:pu,ZodUnknown:_l,ZodNever:xo,ZodVoid:Xy,ZodArray:Ll,ZodObject:Ur,ZodUnion:Cp,ZodDiscriminatedUnion:vO,ZodIntersection:Ep,ZodTuple:va,ZodRecord:kO,ZodMap:Yy,ZodSet:Qy,ZodFunction:TO,ZodLazy:_p,ZodLiteral:Np,ZodEnum:bf,ZodNativeEnum:Ap,ZodPromise:fu,ZodEffects:pi,ZodTransformer:pi,ZodOptional:Fi,ZodNullable:Ia,ZodDefault:Rp,ZodCatch:$p,ZodNaN:Zy,BRAND:Aq,ZodBranded:YS,ZodPipeline:QS,ZodReadonly:Dp,custom:_O,Schema:bt,ZodSchema:bt,late:Rq,get ZodFirstPartyTypeKind(){return Ze},coerce:d9,any:zq,array:Uq,bigint:Pq,boolean:RO,date:Oq,discriminatedUnion:qq,effect:YA,enum:n9,function:Jq,instanceof:$q,intersection:Kq,lazy:e9,literal:t9,map:Qq,nan:Dq,nativeEnum:s9,never:Bq,null:Mq,nullable:o9,number:AO,object:Wq,oboolean:h9,onumber:u9,optional:i9,ostring:c9,pipeline:l9,preprocess:a9,promise:r9,record:Yq,set:Zq,strictObject:Gq,string:NO,symbol:Fq,transformer:YA,tuple:Xq,undefined:Lq,union:Hq,unknown:Vq,void:jq,NEVER:p9,ZodIssueCode:xe,quotelessJson:oq,ZodError:ri}),QA={name:"@imgly/background-removal",version:"1.7.0",description:"Background Removal in the Browser",keywords:["background-removal","client-side","data-privacy","image-segmentation","image-matting","onnx"],repository:{type:"git",url:"git+https://github.com/imgly/background-removal-js.git"},license:"SEE LICENSE IN LICENSE.md",author:{name:"IMG.LY GmbH",email:"support@img.ly",url:"https://img.ly"},bugs:{email:"support@img.ly"},source:"./src/index.ts",main:"./dist/index.cjs",module:"./dist/index.mjs",types:"./dist/src/index.d.ts",exports:{".":{require:"./dist/index.cjs",import:"./dist/index.mjs",types:"./dist/src/index.d.ts"}},homepage:"https://img.ly/showcases/cesdk/web/background-removal",files:["LICENSE.md","README.md","CHANGELOG.md","ThirdPartyLicenses.json","dist/","bin/"],scripts:{start:"pnpm run watch",clean:"npx rimraf dist",test:"true",resources:"node ../../scripts/package-resources.mjs","changelog:create":"node ../../scripts/changelog/changelog-create.mjs","changelog:generate":"node ../../scripts/changelog/changelog-generate.mjs",build:"pnpm run clean && pnpm run types && pnpm run resources && pnpm run changelog:generate && node scripts/build.mjs",types:" npx tsc --declaration --emitDeclarationOnly --declarationDir dist --declarationMap",watch:"pnpm run clean && pnpm run resources && pnpm run changelog:generate && node scripts/watch.mjs","publish:latest":"pnpm publish --tag latest --access public","publish:next":"pnpm publish --tag next --access public","package:pack":"pnpm pack . --pack-destination ../../releases","check:all":"pnpm run check:pretty","check:pretty":"prettier --list-different './src/**/*.{ts,tsx}'",pretty:"prettier --write './src/**/*.{ts,tsx}'"},dependencies:{"lodash-es":"^4.17.21",ndarray:"~1.0.0",zod:"^3.23.8"},peerDependencies:{"onnxruntime-web":"1.21.0"},devDependencies:{"@types/lodash-es":"^4.17.12","@types/ndarray":"~1.0.14","@types/node":"~20.3.0",assert:"~2.0.0",esbuild:"~0.18.0",glob:"~10.3.0","npm-dts":"~1.3.0",process:"~0.11.0","ts-loader":"~9.4.0",tslib:"~2.5.0",typescript:"~5.1.0",util:"~0.12.0",webpack:"~5.85.0","webpack-cli":"~5.1.0"}},f9=ds.object({publicPath:ds.string().optional().describe("The public path to the wasm files and the onnx model.").default("https://staticimgly.com/@imgly/background-removal-data/${PACKAGE_VERSION}/dist/").transform(n=>n.replace("${PACKAGE_NAME}",QA.name).replace("${PACKAGE_VERSION}",QA.version)),debug:ds.boolean().default(!1).describe("Whether to enable debug logging."),rescale:ds.boolean().default(!0).describe("Whether to rescale the image."),device:ds.enum(["cpu","gpu"]).default("cpu").describe("The device to run the model on."),proxyToWorker:ds.boolean().default(!1).describe("Whether to proxy inference to a web worker."),fetchArgs:ds.any().default({}).describe("Arguments to pass to fetch when loading the model."),progress:ds.function().args(ds.string(),ds.number(),ds.number()).returns(ds.void()).describe("Progress callback.").optional(),model:ds.preprocess(n=>{switch(n){case"large":return"isnet";case"small":return"isnet_quint8";case"medium":return"isnet_fp16";default:return n}},ds.enum(["isnet","isnet_fp16","isnet_quint8"])).default("medium"),output:ds.object({format:ds.enum(["image/png","image/jpeg","image/webp","image/x-rgba8","image/x-alpha8"]).default("image/png"),quality:ds.number().default(.8)}).default({})}).default({}).transform(n=>(n.debug&&console.log("Config:",n),n.debug&&!n.progress&&(n.progress=n.progress??((e,t,s)=>{console.debug(`Downloading ${e}: ${t} of ${s}`)}),crossOriginIsolated||n.debug&&console.debug("Cross-Origin-Isolated is not enabled. Performance will be degraded. Please see  https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer.")),n));function m9(n){return f9.parse(n??{})}var g9=cx(ux());async function y9(n){n.debug&&console.debug("Loading model...",n.model);const e=n.model,s=await(await hO(`/models/${e}`,n)).arrayBuffer();return await rq(s,n)}async function b9(n){n=m9(n);const e=await y9(n);return{config:n,session:{base:e}}}async function x9(n,e,t){const[r,i,o]=n.shape,a=!1;let l=HA(n,1024,1024,a);const c=J5(l);let u=await iq(t.base,[["input",c]],["output"],e),h=(0,g9.default)(u[0].data,[1024,1024,1]),d=tq(h);return e.rescale?(d=HA(d,i,r,a),[d,n]):[d,l]}var w9=H5(b9,n=>JSON.stringify(n));async function v9(n,e){var d,p,f,g;const{config:t,session:s}=await w9(e);t.progress&&t.progress("compute:decode",0,4);const r=await eq(n,t);(d=t.progress)==null||d.call(t,"compute:inference",1,4);const[i,o]=await x9(r,t,s);(p=t.progress)==null||p.call(t,"compute:mask",2,4);const a=o,[l,c]=a.shape,u=l*c;for(let m=0;m<u;m+=1)a.data[4*m+3]=i.data[m];(f=t.progress)==null||f.call(t,"compute:encode",3,4);const h=await K5(a,t.output.quality,t.output.format);return(g=t.progress)==null||g.call(t,"compute:encode",4,4),h}/*! Bundled license information:

is-buffer/index.js:
  (*!
   * Determine if an object is a Buffer
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)
*/const I9=n=>Array.isArray(n),ZA=n=>I9(n)?n[0]:n,S9=({scale:n,name:e,version:t,meta:{architecture:s,...r},path:i})=>{const o=i||`models/x${n}/model.json`;return s==="rdn"?{scale:n,modelType:"layers",_internals:{path:o,name:e,version:t},meta:{architecture:s,...r},inputRange:[0,255],outputRange:[0,255]}:{setup:l=>{const c=l.layers.Layer,u=.2;class h extends c{constructor(){super({});le(this,"beta");this.beta=u}call(g){return l.mul(ZA(g),this.beta)}}le(h,"className","MultiplyBeta"),[h,(p=>{class f extends c{constructor(){super({});le(this,"scale",p)}computeOutputShape(y){return[y[0],y[1],y[2],3]}call(y){return l.depthToSpace(ZA(y),this.scale,"NHWC")}}return le(f,"className",`PixelShuffle${n}x`),f})(n)].forEach(p=>{l.serialization.registerClass(p)})},scale:n,modelType:"layers",_internals:{path:o,name:e,version:t},meta:{architecture:s,...r},inputRange:[0,1],outputRange:[0,1]}},k9="@upscalerjs/default-model",T9="1.0.0-beta.17",C9=2,E9=S9({scale:C9,name:k9,version:T9,path:"models/model.json",meta:{C:1,D:2,G:4,G0:64,T:10,architecture:"rdn",patchSize:128,size:"slim",artifactReducing:!1,sharpening:!1,dataset:"div2k",modelFileName:"rdn-C1-D2-G4-G064-T10-x2-patchsize128-compress100-sharpen0-datadiv2k-vary_cFalse_best-val_loss_epoch494"}});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _9=1e-7,N9=1e-4;class ZS{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class px{refCount(e){return Zs("refCount")}incRef(e){return Zs("incRef")}timerAvailable(){return!0}time(e){return Zs("time")}read(e){return Zs("read")}readSync(e){return Zs("readSync")}readToGPU(e,t){return Zs("readToGPU")}numDataIds(){return Zs("numDataIds")}disposeData(e,t){return Zs("disposeData")}write(e,t,s){return Zs("write")}move(e,t,s,r,i){return Zs("move")}createTensorFromGPUData(e,t,s){return Zs("createTensorFromGPUData")}memory(){return Zs("memory")}floatPrecision(){return Zs("floatPrecision")}epsilon(){return this.floatPrecision()===32?_9:N9}dispose(){return Zs("dispose")}}function Zs(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JS(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,ho(n,e,t)}function A9(n,e){if(n.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${n.length}Second array length was ${e.length}`);let t=n.length,s=0;for(;t>0;)s=Math.random()*t|0,t--,ho(n,t,s),ho(e,t,s)}function Sa(n,e,t){return Math.max(n,Math.min(e,t))}function fx(n){return n%2===0?n:n+1}function ho(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function $O(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function R9(n,e){const t=Math.random();return e*t+(1-t)*n}function $9(n,e){let t=0;for(let s=0;s<n.length;s++){const r=Number(n[s])-Number(e[s]);t+=r*r}return t}function O(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function as(n,e,t=""){O(wt(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function lc(n){O(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function re(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function D9(n){return n.length===0}function DO(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==null&&e[t]!==null&&n[t]!==e[t])return!1;return!0}function wt(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Ml(n){return n%1===0}function P9(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;{const e=Math.exp(2*n);return(e-1)/(e+1)}}function Jy(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function O9(n){const e=new Uint32Array(n);for(let t=0;t<n;++t)e[t]=t;return JS(e),e}function Nl(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function tI(n,e=r=>0,t,s){return new Promise((r,i)=>{let o=0;const a=()=>{if(n()){r();return}o++;const l=e(o);if(t!=null&&o>=t){i();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function ek(n,e){let t=1,s=-1;for(let i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${i}`);s=i}else if(n[i]<0)throw Error(`Shapes can not be < 0. Found ${n[i]} at dim ${i}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[s]=e/t,r}function ft(n,e){const t=e.length;return n=n==null?e.map((s,r)=>r):[].concat(n),O(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),O(n.every(s=>Ml(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function Do(n,e){const t=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||r?null:ft(e,n).sort();let o=0;for(let a=0;a<n.length;++a){if(i!=null){if(i[o]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(i[o]==null||i[o]>a)&&n[a]===1&&(t.push(n[a]),s.push(a)),i[o]<=a&&o++}n[a]!==1&&(t.push(n[a]),s.push(a))}return{newShape:t,keptDims:s}}function Hn(n,e){return mn(n,e)}function mn(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function PO(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function OO(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function tk(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function Pp(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function FO(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function Pi(n){return typeof n=="string"||n instanceof String}function LO(n){return typeof n=="boolean"}function eb(n){return typeof n=="number"}function cc(n){return Array.isArray(n)?cc(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":eb(n)?"float32":Pi(n)?"string":LO(n)?"bool":"float32"}function ka(n){return!!(n&&n.constructor&&n.call&&n.apply)}function tb(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function Be(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function MO(n,e,t,s=!1){const r=new Array;if(e.length===1){const i=e[0]*(s?2:1);for(let o=0;o<i;o++)r[o]=t[n+o]}else{const i=e[0],o=e.slice(1),a=o.reduce((l,c)=>l*c)*(s?2:1);for(let l=0;l<i;l++)r[l]=MO(n+l*a,o,t,s)}return r}function Ir(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((r,i)=>r*i)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return MO(0,n,e,t)}function zO(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function mx(n,e){const t=is(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function is(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function nk(n,e){const t=n.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return Ir(n,new Float32Array(t));if(e==="int32")return Ir(n,new Int32Array(t));if(e==="bool")return Ir(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function hr(n){n.forEach(e=>{O(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function ii(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=t[r]*n[r];return s}function uc(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/t[r]),n-=s[r]*t[r];return s[s.length-1]=n,s}function wo(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JA="tfjsflags";class VO{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=F9,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(X().getBool("IS_TEST")||X().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];X().getBool("IS_TEST")||X().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(wo(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);JA in e&&e[JA].split(",").forEach(s=>{const[r,i]=s.split(":");this.urlFlags[r]=M9(r,i)})}}function F9(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>(L9(e,s[0],s[1]),s.join("="))),e}function L9(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function M9(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function X(){return sk}let sk=null;function z9(n){sk=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Ov;function BO(){if(Ov==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");Ov=n}return Ov}function V9(){const n=BO();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function rk(n,e){const t=V9();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const xf="Abs",Vu="Acos",Bu="Acosh",hc="Add",wf="AddN",gx="All",yx="Any",vf="ArgMax",If="ArgMin",ju="Asin",Uu="Asinh",Wu="Atan",Gu="Atanh",Hu="Atan2",Sf="AvgPool",bx="AvgPoolGrad",kf="AvgPool3D",xx="AvgPool3DGrad",Tf="BatchMatMul",Cf="BatchToSpaceND",wx="Bincount",Ef="BitwiseAnd",jO="BroadcastTo",vx="BroadcastArgs",qu="Cast",Ku="Ceil",Xu="ClipByValue",Ix="Complex",_f="ComplexAbs",Nf="Concat",Af="Conv2D",Sx="Conv2DBackpropFilter",Rf="Conv2DBackpropInput",$f="Conv3D",kx="Conv3DBackpropFilterV2",Tx="Conv3DBackpropInputV2",Yu="Cos",Qu="Cosh",Cx="Cumprod",Df="Cumsum",Ex="CropAndResize",_x="DenseBincount",Nx="DepthToSpace",Pf="DepthwiseConv2dNative",Ax="DepthwiseConv2dNativeBackpropFilter",Rx="DepthwiseConv2dNativeBackpropInput",$x="Diag",Of="Dilation2D",nb="Dilation2DBackpropInput",sb="Dilation2DBackpropFilter",Dx="Draw",Zu="RealDiv",Px="Einsum",Ju="Elu",Ox="EluGrad",eh="Erf",Ff="Equal",th="Exp",Lf="ExpandDims",nh="Expm1",Fx="FFT",Lx="Fill",Mx="FlipLeftRight",sh="Floor",rh="FloorDiv",Mf="FusedBatchNorm",zf="GatherV2",zx="GatherNd",Vf="Greater",ih="GreaterEqual",oh="Identity",Vx="IFFT",Bx="Imag",ah="IsFinite",lh="IsInf",ch="IsNan",Bf="LeakyRelu",jf="Less",Uf="LessEqual",jx="LinSpace",uh="Log",hh="Log1p",Wf="LogicalAnd",Gf="LogicalNot",Hf="LogicalOr",B9="LogicalXor",UO="LogSoftmax",j9="LowerBound",qf="LRN",Ux="LRNGrad",U9="MatrixBandPart",Kf="Max",dh="Maximum",Xf="MaxPool",Wx="MaxPoolGrad",Yf="MaxPool3D",Gx="MaxPool3DGrad",Hx="MaxPoolWithArgmax",Qf="Mean",Zf="Min",ph="Minimum",Jf="MirrorPad",fh="Mod",qx="Multinomial",mh="Multiply",em="Neg",tm="NotEqual",Kx="NonMaxSuppressionV3",Xx="NonMaxSuppressionV4",Yx="NonMaxSuppressionV5",nm="OnesLike",sm="OneHot",rm="Pack",im="PadV2",W9="Pool",gh="Pow",om="Prelu",am="Prod",Qx="RaggedGather",Zx="RaggedRange",Jx="RaggedTensorToTensor",ew="Range",tw="Real",yh="Reciprocal",bh="Relu",lm="Reshape",cm="ResizeNearestNeighbor",nw="ResizeNearestNeighborGrad",um="ResizeBilinear",sw="ResizeBilinearGrad",xh="Relu6",hm="Reverse",wh="Round",vh="Rsqrt",rw="ScatterNd",iw="TensorScatterUpdate",ow="SearchSorted",dm="Select",Ih="Selu",pm="Slice",Sh="Sin",kh="Sinh",Th="Sign",Ch="Sigmoid",Eh="Softplus",_h="Sqrt",fm="Sum",mm="SpaceToBatchND",gm="SplitV",ym="Softmax",aw="SparseFillEmptyRows",lw="SparseReshape",cw="SparseSegmentMean",uw="SparseSegmentSum",hw="SparseToDense",Nh="SquaredDifference",dw="Square",bm="StaticRegexReplace",pw="StridedSlice",fw="StringNGrams",mw="StringSplit",gw="StringToHashBucketFast",Ah="Sub",Rh="Tan",$h="Tanh",Dh="Tile",yw="TopK",bw="Transform",Al="Transpose",xw="Unique",xm="Unpack",wm="UnsortedSegmentSum",G9="UpperBound",vm="ZerosLike",Ph="Step",rb="FromPixels",ww="RotateWithOffset",Op="_FusedMatMul",Fp="FusedConv2D",Lp="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yr(...n){X().getBool("IS_TEST")||X().getBool("PROD")||console.warn(...n)}function H9(...n){X().getBool("IS_TEST")||X().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mu=rk("kernelRegistry",()=>new Map),Mp=rk("gradRegistry",()=>new Map);function zp(n,e){const t=ik(n,e);return mu.get(t)}function nI(n){return Mp.get(n)}function ib(n){const e=mu.entries(),t=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[i,o]=r,[a]=i.split("_");a===n&&t.push(o)}return t}function vw(n){const{kernelName:e,backendName:t}=n,s=ik(e,t);mu.has(s)&&yr(`The kernel '${e}' for backend '${t}' is already registered`),mu.set(s,n)}function WO(n){const{kernelName:e}=n;Mp.has(e)&&X().getBool("DEBUG")&&yr(`Overriding the gradient for '${e}'`),Mp.set(e,n)}function q9(n,e){const t=ik(n,e);if(!mu.has(t))throw new Error(`The kernel '${n}' for backend '${e}' is not registered`);mu.delete(t)}function K9(n){if(!Mp.has(n))throw new Error(`The gradient '${n}' for backend is not registered`);Mp.delete(n)}function X9(n,e){ib(n).forEach(s=>{const r=Object.assign({},s,{backendName:e});vw(r)})}function ik(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GO(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var HO=tn,Lr=null;try{Lr=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function tn(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}tn.prototype.__isLong__;Object.defineProperty(tn.prototype,"__isLong__",{value:!0});function dr(n){return(n&&n.__isLong__)===!0}tn.isLong=dr;var eR={},tR={};function dc(n,e){var t,s,r;return e?(n>>>=0,(r=0<=n&&n<256)&&(s=tR[n],s)?s:(t=nn(n,(n|0)<0?-1:0,!0),r&&(tR[n]=t),t)):(n|=0,(r=-128<=n&&n<128)&&(s=eR[n],s)?s:(t=nn(n,n<0?-1:0,!1),r&&(eR[n]=t),t))}tn.fromInt=dc;function Mr(n,e){if(isNaN(n))return e?vl:zr;if(e){if(n<0)return vl;if(n>=qO)return YO}else{if(n<=-sR)return rr;if(n+1>=sR)return XO}return n<0?Mr(-n,e).neg():nn(n%gu|0,n/gu|0,e)}tn.fromNumber=Mr;function nn(n,e,t){return new tn(n,e,t)}tn.fromBits=nn;var ob=Math.pow;function ok(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return zr;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var s;if((s=n.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return ok(n.substring(1),e,t).neg();for(var r=Mr(ob(t,8)),i=zr,o=0;o<n.length;o+=8){var a=Math.min(8,n.length-o),l=parseInt(n.substring(o,o+a),t);if(a<8){var c=Mr(ob(t,a));i=i.mul(c).add(Mr(l))}else i=i.mul(r),i=i.add(Mr(l))}return i.unsigned=e,i}tn.fromString=ok;function xi(n,e){return typeof n=="number"?Mr(n,e):typeof n=="string"?ok(n,e):nn(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}tn.fromValue=xi;var nR=65536,Y9=1<<24,gu=nR*nR,qO=gu*gu,sR=qO/2,rR=dc(Y9),zr=dc(0);tn.ZERO=zr;var vl=dc(0,!0);tn.UZERO=vl;var Zc=dc(1);tn.ONE=Zc;var KO=dc(1,!0);tn.UONE=KO;var sI=dc(-1);tn.NEG_ONE=sI;var XO=nn(-1,2147483647,!1);tn.MAX_VALUE=XO;var YO=nn(-1,-1,!0);tn.MAX_UNSIGNED_VALUE=YO;var rr=nn(0,-2147483648,!1);tn.MIN_VALUE=rr;var Te=tn.prototype;Te.toInt=function(){return this.unsigned?this.low>>>0:this.low};Te.toNumber=function(){return this.unsigned?(this.high>>>0)*gu+(this.low>>>0):this.high*gu+(this.low>>>0)};Te.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(rr)){var t=Mr(e),s=this.div(t),r=s.mul(t).sub(this);return s.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Mr(ob(e,6),this.unsigned),o=this,a="";;){var l=o.div(i),c=o.sub(l.mul(i)).toInt()>>>0,u=c.toString(e);if(o=l,o.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}};Te.getHighBits=function(){return this.high};Te.getHighBitsUnsigned=function(){return this.high>>>0};Te.getLowBits=function(){return this.low};Te.getLowBitsUnsigned=function(){return this.low>>>0};Te.getNumBitsAbs=function(){if(this.isNegative())return this.eq(rr)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1};Te.isZero=function(){return this.high===0&&this.low===0};Te.eqz=Te.isZero;Te.isNegative=function(){return!this.unsigned&&this.high<0};Te.isPositive=function(){return this.unsigned||this.high>=0};Te.isOdd=function(){return(this.low&1)===1};Te.isEven=function(){return(this.low&1)===0};Te.equals=function(e){return dr(e)||(e=xi(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Te.eq=Te.equals;Te.notEquals=function(e){return!this.eq(e)};Te.neq=Te.notEquals;Te.ne=Te.notEquals;Te.lessThan=function(e){return this.comp(e)<0};Te.lt=Te.lessThan;Te.lessThanOrEqual=function(e){return this.comp(e)<=0};Te.lte=Te.lessThanOrEqual;Te.le=Te.lessThanOrEqual;Te.greaterThan=function(e){return this.comp(e)>0};Te.gt=Te.greaterThan;Te.greaterThanOrEqual=function(e){return this.comp(e)>=0};Te.gte=Te.greaterThanOrEqual;Te.ge=Te.greaterThanOrEqual;Te.compare=function(e){if(dr(e)||(e=xi(e)),this.eq(e))return 0;var t=this.isNegative(),s=e.isNegative();return t&&!s?-1:!t&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Te.comp=Te.compare;Te.negate=function(){return!this.unsigned&&this.eq(rr)?rr:this.not().add(Zc)};Te.neg=Te.negate;Te.add=function(e){dr(e)||(e=xi(e));var t=this.high>>>16,s=this.high&65535,r=this.low>>>16,i=this.low&65535,o=e.high>>>16,a=e.high&65535,l=e.low>>>16,c=e.low&65535,u=0,h=0,d=0,p=0;return p+=i+c,d+=p>>>16,p&=65535,d+=r+l,h+=d>>>16,d&=65535,h+=s+a,u+=h>>>16,h&=65535,u+=t+o,u&=65535,nn(d<<16|p,u<<16|h,this.unsigned)};Te.subtract=function(e){return dr(e)||(e=xi(e)),this.add(e.neg())};Te.sub=Te.subtract;Te.multiply=function(e){if(this.isZero())return zr;if(dr(e)||(e=xi(e)),Lr){var t=Lr.mul(this.low,this.high,e.low,e.high);return nn(t,Lr.get_high(),this.unsigned)}if(e.isZero())return zr;if(this.eq(rr))return e.isOdd()?rr:zr;if(e.eq(rr))return this.isOdd()?rr:zr;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(rR)&&e.lt(rR))return Mr(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,i=this.low>>>16,o=this.low&65535,a=e.high>>>16,l=e.high&65535,c=e.low>>>16,u=e.low&65535,h=0,d=0,p=0,f=0;return f+=o*u,p+=f>>>16,f&=65535,p+=i*u,d+=p>>>16,p&=65535,p+=o*c,d+=p>>>16,p&=65535,d+=r*u,h+=d>>>16,d&=65535,d+=i*c,h+=d>>>16,d&=65535,d+=o*l,h+=d>>>16,d&=65535,h+=s*u+r*c+i*l+o*a,h&=65535,nn(p<<16|f,h<<16|d,this.unsigned)};Te.mul=Te.multiply;Te.divide=function(e){if(dr(e)||(e=xi(e)),e.isZero())throw Error("division by zero");if(Lr){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Lr.div_u:Lr.div_s)(this.low,this.high,e.low,e.high);return nn(t,Lr.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?vl:zr;var s,r,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return vl;if(e.gt(this.shru(1)))return KO;i=vl}else{if(this.eq(rr)){if(e.eq(Zc)||e.eq(sI))return rr;if(e.eq(rr))return Zc;var o=this.shr(1);return s=o.div(e).shl(1),s.eq(zr)?e.isNegative()?Zc:sI:(r=this.sub(e.mul(s)),i=s.add(r.div(e)),i)}else if(e.eq(rr))return this.unsigned?vl:zr;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=zr}for(r=this;r.gte(e);){s=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),l=a<=48?1:ob(2,a-48),c=Mr(s),u=c.mul(e);u.isNegative()||u.gt(r);)s-=l,c=Mr(s,this.unsigned),u=c.mul(e);c.isZero()&&(c=Zc),i=i.add(c),r=r.sub(u)}return i};Te.div=Te.divide;Te.modulo=function(e){if(dr(e)||(e=xi(e)),Lr){var t=(this.unsigned?Lr.rem_u:Lr.rem_s)(this.low,this.high,e.low,e.high);return nn(t,Lr.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Te.mod=Te.modulo;Te.rem=Te.modulo;Te.not=function(){return nn(~this.low,~this.high,this.unsigned)};Te.and=function(e){return dr(e)||(e=xi(e)),nn(this.low&e.low,this.high&e.high,this.unsigned)};Te.or=function(e){return dr(e)||(e=xi(e)),nn(this.low|e.low,this.high|e.high,this.unsigned)};Te.xor=function(e){return dr(e)||(e=xi(e)),nn(this.low^e.low,this.high^e.high,this.unsigned)};Te.shiftLeft=function(e){return dr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?nn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):nn(0,this.low<<e-32,this.unsigned)};Te.shl=Te.shiftLeft;Te.shiftRight=function(e){return dr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?nn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):nn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Te.shr=Te.shiftRight;Te.shiftRightUnsigned=function(e){if(dr(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var s=this.low;return nn(s>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?nn(t,0,this.unsigned):nn(t>>>e-32,0,this.unsigned)};Te.shru=Te.shiftRightUnsigned;Te.shr_u=Te.shiftRightUnsigned;Te.toSigned=function(){return this.unsigned?nn(this.low,this.high,!1):this};Te.toUnsigned=function(){return this.unsigned?this:nn(this.low,this.high,!0)};Te.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Te.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Te.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};tn.fromBytes=function(e,t,s){return s?tn.fromBytesLE(e,t):tn.fromBytesBE(e,t)};tn.fromBytesLE=function(e,t){return new tn(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};tn.fromBytesBE=function(e,t){return new tn(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const QO=VS(HO),Q9=r6({__proto__:null,default:QO},[HO]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ul=QO||Q9;function Im(n){return ul.fromString(n,!0,16)}const ZO=Im("c3a5c85c97cb3127"),ol=Im("b492b66fbe98f273"),Is=Im("9ae16a3b2f90404f");function rI(n){return n.xor(n.shru(47))}function JO(n,e,t){const s=n.slice(e,e+t);return ul.fromBytes(Array.from(s),!0,!0)}function Xt(n,e){return JO(n,e,8)}function iR(n,e){return JO(n,e,4)}function Bn(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function pa(n,e,t=Im("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let r=e.xor(s).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function Z9(n,e,t,s,r,i){r=r.add(n),i=Bn(i.add(r).add(s),21);const o=r;return r=r.add(e),r=r.add(t),i=i.add(Bn(r,44)),[r.add(s),i.add(o)]}function Pg(n,e,t,s){return Z9(Xt(n,e),Xt(n,e+8),Xt(n,e+16),Xt(n,e+24),t,s)}function J9(n,e=n.length){if(e>=8){const t=Is.add(e*2),s=Xt(n,0).add(Is),r=Xt(n,e-8),i=Bn(r,37).mul(t).add(s),o=Bn(s,25).add(r).mul(t);return pa(i,o,t)}if(e>=4){const t=Is.add(e*2),s=iR(n,0);return pa(s.shl(3).add(e),iR(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],r=n[e-1],i=t+(s<<8),o=e+(r<<2);return rI(Is.mul(i).xor(ZO.mul(o))).mul(Is)}return Is}function e8(n,e=n.length){const t=Is.add(e*2),s=Xt(n,0).mul(ol),r=Xt(n,8),i=Xt(n,e-8).mul(t),o=Xt(n,e-16).mul(Is);return pa(Bn(s.add(r),43).add(Bn(i,30)).add(o),s.add(Bn(r.add(Is),18)).add(i),t)}function t8(n,e=n.length){const t=Is.add(e*2),s=Xt(n,0).mul(Is),r=Xt(n,8),i=Xt(n,e-8).mul(t),o=Xt(n,e-16).mul(Is),a=Bn(s.add(r),43).add(Bn(i,30)).add(o),l=pa(a,s.add(Bn(r.add(Is),18)).add(i),t),c=Xt(n,16).mul(t),u=Xt(n,24),h=a.add(Xt(n,e-32)).mul(t),d=l.add(Xt(n,e-24)).mul(t);return pa(Bn(c.add(u),43).add(Bn(h,30)).add(d),c.add(Bn(u.add(s),18)).add(h),t)}function eF(n,e=n.length){const t=ul.fromNumber(81,!0);if(e<=32)return e<=16?J9(n,e):e8(n,e);if(e<=64)return t8(n,e);let s=t,r=t.mul(ol).add(113),i=rI(r.mul(Is).add(113)).mul(Is),o=[ul.UZERO,ul.UZERO],a=[ul.UZERO,ul.UZERO];s=s.mul(Is).add(Xt(n,0));let l=0;const c=(e-1>>6)*64,u=c+(e-1&63)-63;do s=Bn(s.add(r).add(o[0]).add(Xt(n,l+8)),37).mul(ol),r=Bn(r.add(o[1]).add(Xt(n,l+48)),42).mul(ol),s=s.xor(a[1]),r=r.add(o[0]).add(Xt(n,l+40)),i=Bn(i.add(a[0]),33).mul(ol),o=Pg(n,l,o[1].mul(ol),s.add(a[0])),a=Pg(n,l+32,i.add(a[1]),r.add(Xt(n,l+16))),[i,s]=[s,i],l+=64;while(l!==c);const h=ol.add(i.and(255).shl(1));return l=u,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),s=Bn(s.add(r).add(o[0]).add(Xt(n,l+8)),37).mul(h),r=Bn(r.add(o[1]).add(Xt(n,l+48)),42).mul(h),s=s.xor(a[1].mul(9)),r=r.add(o[0].mul(9).add(Xt(n,l+40))),i=Bn(i.add(a[0]),33).mul(h),o=Pg(n,l,o[1].mul(h),s.add(a[0])),a=Pg(n,l+32,i.add(a[1]),r.add(Xt(n,l+16))),[i,s]=[s,i],pa(pa(o[0],a[0],h).add(rI(r).mul(ZO)).add(i),pa(o[1],a[1],h).add(s),h)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Po(n,e){return e==="string"?Li(n):za([n],e)}function n8(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function za(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Ki(n)),X().getBool("DEBUG")&&PO(n,e),n8(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function Jn(){return X().platform.now()}function tF(n,e){return X().platform.fetch(n,e)}function Li(n,e="utf-8"){return e=e||"utf-8",X().platform.encode(n,e)}function vo(n,e="utf-8"){return e=e||"utf-8",X().platform.decode(n,e)}function Dn(n){return X().platform.isTypedArray!=null?X().platform.isTypedArray(n):GO(n)}function Ki(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||wo(n)||n==null||Dn(n)&&t)e.push(n);else if(Array.isArray(n)||Dn(n))for(let s=0;s<n.length;++s)Ki(n[s],e,t);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)Ki(n[r],e,t)}return e}const s8=Object.freeze(Object.defineProperty({__proto__:null,arraysEqual:wt,arraysEqualWithNull:DO,assert:O,assertNonNegativeIntegerDimensions:hr,assertNonNull:lc,assertShapesMatch:as,bytesFromStringArray:FO,bytesPerElement:Pp,checkConversionForErrors:PO,clamp:Sa,computeStrides:Be,convertBackendValuesAndArrayBuffer:zO,createScalarValue:Po,createShuffledIndices:O9,decodeString:vo,distSquared:$9,encodeString:Li,fetch:tF,fingerPrint64:eF,flatten:Ki,getArrayFromDType:mn,getTypedArrayFromDType:Hn,hasEncodingLoss:tk,hexToLong:Im,indexToLoc:uc,inferDtype:cc,inferFromImplicitShape:ek,isBoolean:LO,isFunction:ka,isInt:Ml,isNumber:eb,isPromise:wo,isScalarShape:D9,isString:Pi,isTypedArray:Dn,isValidDtype:OO,locToIndex:ii,makeOnesTypedArray:mx,makeZerosNestedTypedArray:nk,makeZerosTypedArray:is,nearestDivisor:tb,nearestLargerEven:fx,now:Jn,parseAxisParam:ft,randUniform:R9,repeatedTry:tI,rightPad:Nl,shuffle:JS,shuffleCombo:A9,sizeFromShape:re,sizeToSquarishShape:Jy,squeezeShape:Do,sum:$O,swap:ho,tanh:P9,toNestedArray:Ir,toTypedArray:za},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class r8{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new o8)}profileKernel(e,t,s){let r;const i=()=>{r=s()};let o;const a=Jn();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const c of r)c.dataSync();o=Promise.resolve({kernelMs:Jn()-a})}if(X().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<r.length;c++){const u=r[c];u.data().then(h=>{i8(h,u.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:o.then(c=>c.kernelMs),extraInfo:o.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:r,inputs:i,extraInfo:o}=e;s.forEach(a=>{Promise.all([a.data(),r,o]).then(l=>{this.logger.logKernelProfile(t,a,l[0],l[1],i,l[2])})})}}function i8(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}let o8=class{logKernelProfile(e,t,s,r,i,o){const a=typeof r=="number"?Nl(`${r}ms`,9):r.error,l=Nl(e,25),c=t.rank,u=t.size,h=Nl(t.shape.toString(),14);let d="";for(const p in i){const f=i[p];if(f!=null){const g=f.shape||t.shape,m=g.length;d+=`${p}: ${m}D ${m>0?g:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${h}	%c${u}	%c${d}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a8(n,e,t){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<n.length;l++){const c=n[l],u=c.inputs;for(const h in u){const d=u[h];let p=!1;for(let f=0;f<e.length;f++)if(s[d.id]){c.outputs.forEach(g=>s[g.id]=!0),p=!0,r[c.id]=!0;break}if(p)break}}const i={};i[t.id]=!0;const o={};for(let l=n.length-1;l>=0;l--){const c=n[l],u=c.inputs;for(let h=0;h<c.outputs.length;h++)if(i[c.outputs[h].id]){for(const d in u)i[u[d].id]=!0,o[c.id]=!0;break}}const a=[];for(let l=0;l<n.length;l++){const c=n[l];if(r[c.id]&&o[c.id]){const u={};for(const d in c.inputs){const p=c.inputs[d];s[p.id]&&(u[d]=p)}const h=Object.assign({},c);h.inputs=u,h.outputs=c.outputs,a.push(h)}}return a}function l8(n,e,t,s){for(let r=e.length-1;r>=0;r--){const i=e[r],o=[];if(i.outputs.forEach(l=>{const c=n[l.id];c!=null?o.push(c):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const a=i.gradient(o);for(const l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const c=t(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);const u=i.inputs[l];if(!wt(c.shape,u.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${u.shape}'`);if(n[u.id]==null)n[u.id]=c;else{const h=n[u.id];n[u.id]=s(h,c),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oR=20,Ed=3,Fv=7;function c8(n,e,t,s){const r=Be(e),i=u8(n,e,t,r),o=e.length,a=my(n,e,t,r,i),l=["Tensor"];return s&&(l.push(`  dtype: ${t}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function u8(n,e,t,s){const r=re(e),i=s[s.length-1],o=new Array(i).fill(0),a=e.length,l=t==="complex64"?Bd(n):n;if(a>1)for(let c=0;c<r/i;c++){const u=c*i;for(let h=0;h<i;h++)o[h]=Math.max(o[h],Vd(l[u+h],0,t).length)}return o}function Vd(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(Fv))} + ${parseFloat(n[1].toFixed(Fv))}j`:Pi(n)?s=`'${n}'`:t==="bool"?s=nF(n):s=parseFloat(n.toFixed(Fv)).toString(),Nl(s,e)}function nF(n){return n===0?"false":"true"}function my(n,e,t,s,r,i=!0){const o=t==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(t==="complex64"){const g=Bd(n);return[Vd(g[0],0,t)]}return t==="bool"?[nF(n[0])]:[n[0].toString()]}if(l===1){if(a>oR){const m=Ed*o;let y=Array.from(n.slice(0,m)),w=Array.from(n.slice((a-Ed)*o,a*o));return t==="complex64"&&(y=Bd(y),w=Bd(w)),["["+y.map((v,I)=>Vd(v,r[I],t)).join(", ")+", ..., "+w.map((v,I)=>Vd(v,r[a-Ed+I],t)).join(", ")+"]"]}return["["+(t==="complex64"?Bd(n):Array.from(n)).map((m,y)=>Vd(m,r[y],t)).join(", ")+"]"]}const c=e.slice(1),u=s.slice(1),h=s[0]*o,d=[];if(a>oR){for(let g=0;g<Ed;g++){const m=g*h,y=m+h;d.push(...my(n.slice(m,y),c,t,u,r,!1))}d.push("...");for(let g=a-Ed;g<a;g++){const m=g*h,y=m+h;d.push(...my(n.slice(m,y),c,t,u,r,g===a-1))}}else for(let g=0;g<a;g++){const m=g*h,y=m+h;d.push(...my(n.slice(m,y),c,t,u,r,g===a-1))}const p=l===2?",":"";d[0]="["+(a>0?d[0]+p:"");for(let g=1;g<d.length-1;g++)d[g]=" "+d[g]+p;let f=`,
`;for(let g=2;g<l;g++)f+=`
`;return d[d.length-1]=" "+d[d.length-1]+"]"+(i?"":f),d}function Bd(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nn{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=re(e),s!=null){const r=s.length;O(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||mn(t,this.size),this.strides=Be(e)}set(e,...t){t.length===0&&(t=[0]),O(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}t++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return ei().makeTensor(this.values,this.shape,this.dtype)}}let ei=null,Uc=null;function h8(n){ei=n}function d8(n){Uc=n}class kt{constructor(e,t,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=re(e),this.strides=Be(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Uc.buffer(this.shape,this.dtype,e)}bufferSync(){return Uc.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Ir(this.shape,e,this.dtype==="complex64")}arraySync(){return Ir(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=ei().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>vo(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),ei().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=ei().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>vo(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await ei().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),ei().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Uc.print(this,e)}clone(){return this.throwIfDisposed(),Uc.clone(this)}toString(e=!1){const t=this.dataSync();return c8(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Uc.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),ei().makeVariable(this,e,t,s)}}Object.defineProperty(kt,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function oe(){return rk("Tensor",()=>kt)}oe();class Vp extends kt{constructor(e,t,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!wt(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);ei().disposeTensor(this),this.dataId=e.dataId,ei().incRef(this,null)}dispose(){ei().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Vp,Symbol.hasInstance,{value:n=>n instanceof kt&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var iI;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(iI||(iI={}));var oI;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(oI||(oI={}));var aI;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(aI||(aI={}));var lI;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(lI||(lI={}));var cI;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(cI||(cI={}));const p8={float32:lI,int32:oI,bool:aI,complex64:cI};function Ws(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return p8[n][e]}function Iw(n){return Ws(n,"int32")}function sF(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function rF(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dn(n,e){if(n.dtype===e.dtype)return[n,e];const t=Ws(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function iF(n,e){O(n.dtype===e.dtype,()=>`The dtypes of the first(${n.dtype}) and second(${e.dtype}) input must match`)}function Sw(n,e){return e.some(t=>t.id===n.id)}function Io(n){const e=[];return oF(n,e,new Set),e}function oF(n,e,t){if(n==null)return;if(n instanceof kt){e.push(n);return}if(!f8(n))return;const s=n;for(const r in s){const i=s[r];t.has(i)||(t.add(i),oF(i,e,t))}}function f8(n){return Array.isArray(n)||typeof n=="object"}const m8=Object.freeze(Object.defineProperty({__proto__:null,assertTypesMatch:iF,getTensorsInContainer:Io,isTensorInList:Sw,makeTypesMatch:dn},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lv(n){return n.kernelName!=null}class aR{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class yu{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new aR}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(yr(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new r8(this.backendInstance),!0}setupRegisteredKernels(){ib(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){ib(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof px)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,i=s.then(o=>r<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,yr(`Initialization of backend ${e} failed`),yr(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return yr(`Initialization of backend ${e} failed`),yr(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:r,asyncInit:i}=this.initializeBackend(s);if(i||r)return{name:s,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),r=s.backend,i=this.readSync(t),o=r.refCount(t);r.disposeData(t,!0),s.backend=e,e.move(t,i,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,s){e();try{const r=s();return t(),r}catch(r){throw t(),r}}nextTensorId(){return yu.nextTensorId++}nextVariableId(){return yu.nextVariableId++}clone(e){const t=B.runKernel(oh,{x:e}),s={x:e},r=o=>({x:()=>{const a="float32",l={x:o},c={dtype:a};return B.runKernel(qu,l,c)}}),i=[];return this.addTapeNode(this.state.activeScope.name,s,[t],r,i,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,!(zp(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const r=this.backend.numDataIds();let i=0;s.forEach(l=>{i+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-t-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const r=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const c=Lv(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Lv(e)){const{kernelName:f,inputs:g,attrs:m}=e;this.backendName==null&&this.backend;const y=zp(f,this.backendName);O(y!=null,()=>`Cannot find registered kernel '${f}' for backend '${this.backendName}'`),a=()=>{const w=this.backend.numDataIds();l=y.kernelFunc({inputs:g,attrs:m,backend:this.backend});const v=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(f,w,v);const I=v.map(_=>_.rank!=null?_:this.makeTensorFromTensorInfo(_));if(r){const _=this.getTensorsForGradient(f,g,I);s=this.saveTensorsForBackwardMode(_)}return I}}else{const{forwardFunc:f}=e,g=m=>{r&&(s=m.map(y=>this.keep(this.clone(y))))};a=()=>{const m=this.backend.numDataIds();l=this.tidy(()=>f(this.backend,g));const y=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,m,y),y}}const{inputs:u,attrs:h}=e,d=Lv(e)?null:e.backwardsFunc;let p;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(p=this.profiler.profileKernel(c,u,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),t=p.outputs)}),r&&this.addTapeNode(c,u,t,d,s,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map(f=>u[f]!=null?u[f].shape:null),outputShapes:t.map(f=>f.shape),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(l)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,t,s){const r=nI(e);if(r!=null){const i=r.inputsToSave||[],o=r.outputsToSave||[];let a;r.saveAllInputs?(O(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(c=>t[c])):a=i.map(c=>t[c]);const l=s.filter((c,u)=>o[u]);return a.concat(l)}return[]}makeTensor(e,t,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let i=e;s==="string"&&Pi(e[0])&&(i=e.map(l=>Li(l)));const o=r.write(i,t,s),a=new kt(t,s,o,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(o),c=FO(i);this.state.numBytes+=c-l.bytes,l.bytes=c}return a}makeTensorFromDataId(e,t,s,r){s=s||"float32";const i={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:r,dtype:i}=e,o=new kt(r,i,s,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const i=new Vp(e,t,s,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*Pp(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof Vp||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*Pp(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,r,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:i},l=nI(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=c=>(c=c.map((u,h)=>{if(u==null){const d=s[h],p=is(d.size,d.dtype);return this.makeTensor(p,d.shape,d.dtype)}return u}),r(c.length>1?c:c[0],i,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=Io(e),s=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!s.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===r.id&&this.track(i)})}gradients(e,t,s,r=!1){if(O(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));O(i instanceof kt,()=>"The result y returned by f() must be a tensor.");const o=a8(this.state.activeTape,t,i);if(!r&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[i.id]=s??g8(i.shape),l8(a,o,c=>this.tidy(c),y8);const l=t.map(c=>a[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(const u of c.saved)u.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return O(ka(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{O(t.every(a=>a instanceof kt),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};t.forEach((a,l)=>{r[l]=a});const i=(a,l)=>(s=e(...t,l),O(s.value instanceof kt,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),O(ka(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(a,l)=>{const c=s.gradFunc(a,l),u=Array.isArray(c)?c:[c];O(u.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),O(u.every(d=>d instanceof kt),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return u.forEach((d,p)=>{h[p]=()=>d}),h};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=Jn(),s=await this.backend.time(e);return s.wallMs=Jn()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new aR;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}yu.nextTensorId=0;yu.nextVariableId=0;function g8(n){const e=mx(re(n),"float32");return B.makeTensor(e,n,"float32")}function aF(){const n=BO();if(n._tfengine==null){const e=new VO(n);n._tfengine=new yu(e)}return z9(n._tfengine.ENV),h8(()=>n._tfengine),n._tfengine}const B=aF();function y8(n,e){const t={a:n,b:e};return B.runKernel(hc,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b8(){return typeof navigator<"u"&&navigator!=null}let uI;function x8(n){uI=n}function ak(n){if(uI!==void 0)return uI;if(n||b8()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function lk(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}const w8=Object.freeze(Object.defineProperty({__proto__:null,isBrowser:lk,isMobile:ak,mockIsMobile:x8},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gs=X();Gs.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Gs.registerFlag("IS_BROWSER",()=>lk());Gs.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Gs.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Gs.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Gs.registerFlag("PROD",()=>!1);Gs.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Gs.getBool("DEBUG"));Gs.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Gs.registerFlag("IS_TEST",()=>!1);Gs.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Gs.getBool("DEBUG"));Gs.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Gs.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Gs.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xi(n,e){let t=n;if(Dn(n))return e==="string"?[]:[n.length];if(sF(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(rF(n))return[n.buffer.size/(e==null?4:Pp(e))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||Dn(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&X().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&lF(n,s,[]),s}function lF(n,e,t){if(t=t||[],!Array.isArray(n)&&!Dn(n)){O(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}O(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),O(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let r=0;r<n.length;++r)lF(n[r],s,t.concat(r))}function lR(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function F(n,e,t,s="numeric"){if(n instanceof kt)return lR(s,n.dtype,e,t),n;let r=cc(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),lR(s,r,e,t),n==null||!Dn(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${l}'`)}const i=Xi(n,r);!Dn(n)&&!Array.isArray(n)&&(n=[n]);const a=r!=="string"?za(n,r):Ki(n,[],!0);return B.makeTensor(a,i,r)}function Bp(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,o)=>F(i,`${e}[${o}]`,t,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ck="__op";function j(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+ck;const r=(...i)=>{B.startScope(t);try{const o=s(...i);return wo(o)&&console.error("Cannot return a Promise inside of tidy."),B.endScope(o),o}catch(o){throw B.endScope(null),o}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v8(n,e){const t=F(n,"real","complex"),s=F(e,"imag","complex");as(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:t,imag:s};return B.runKernel(Ix,r)}const So=j({complex_:v8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Va(n,e,t,s){if(s==null)s=cc(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(rF(n)||sF(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return B.backend.createTensorFromGPUData(n,e||t,s)}if(!Dn(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){hr(e);const r=re(e),i=re(t);O(r===i,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${i}`);for(let o=0;o<t.length;++o){const a=t[o],l=o===t.length-1?a!==re(e.slice(o)):!0;O(t[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Dn(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?za(n,s):Ki(n,[],!0),B.makeTensor(n,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ir(n,e,t){const s=Xi(n,t);return Va(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hI={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class wi{static join(e){return new wi(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>Dn(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=t+r.byteLength;this.shards.push({buffer:r,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=t-e,i=new ArrayBuffer(r),o=new Uint8Array(i);let a=0;for(let l=s;l<this.shards.length;l++){const c=this.shards[l],h=e+a-c.start,d=a,f=Math.min(t,c.end)-c.start,g=new Uint8Array(c.buffer,h,f-h);if(o.set(g,d),a+=g.length,t<c.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(r){return e<r.start?-1:e>=r.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=I8(this.shards,t);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function I8(n,e){let t=0,s=n.length;for(;t<=s;){const r=Math.floor((s-t)/2)+t,i=e(n[r]);if(i===0)return r;i<0?s=r:t=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ab=4;async function dI(n,e){const t=[],s=[],r=Array.isArray(n)?n.map(o=>o.name):Object.keys(n);for(let o=0;o<r.length;++o){const a=r[o],l=Array.isArray(n)?n[o].tensor:n[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const c={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const u=new Promise(async h=>{const d=await l.bytes(),p=d.reduce((m,y)=>m+y.length,0)+ab*d.length,f=new Uint8Array(p);let g=0;for(let m=0;m<d.length;m++){const y=d[m],w=new Uint8Array(new Uint32Array([y.length]).buffer);f.set(w,g),g+=ab,f.set(y,g),g+=y.length}h(f)});s.push(u)}else s.push(l.data());e!=null&&(c.group=e),t.push(c)}const i=await Promise.all(s);return{data:S8(i),specs:t}}function uk(n,e){const t=new wi(n),s={};let r,i=0;for(const o of e){const a=o.name,l=o.dtype,c=o.shape,u=re(c);let h;if("quantization"in o){const d=o.quantization;if(d.dtype==="uint8"||d.dtype==="uint16"){if(!("min"in d&&"scale"in d))throw new Error(`Weight ${o.name} with quantization ${d.dtype} doesn't have corresponding metadata min and scale.`)}else if(d.dtype==="float16"){if(l!=="float32")throw new Error(`Weight ${o.name} is quantized with ${d.dtype} which only supports weights of type float32 not ${l}.`)}else throw new Error(`Weight ${o.name} has unknown quantization dtype ${d.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const p=hI[d.dtype],f=t.slice(i,i+u*p),g=d.dtype==="uint8"?new Uint8Array(f):new Uint16Array(f);if(l==="float32")if(d.dtype==="uint8"||d.dtype==="uint16"){h=new Float32Array(g.length);for(let m=0;m<g.length;m++){const y=g[m];h[m]=y*d.scale+d.min}}else if(d.dtype==="float16")r===void 0&&(r=N8()),h=r(g);else throw new Error(`Unsupported quantization type ${d.dtype} for weight type float32.`);else if(l==="int32"){if(d.dtype!=="uint8"&&d.dtype!=="uint16")throw new Error(`Unsupported quantization type ${d.dtype} for weight type int32.`);h=new Int32Array(g.length);for(let m=0;m<g.length;m++){const y=g[m];h[m]=Math.round(y*d.scale+d.min)}}else throw new Error(`Unsupported dtype in weight '${a}': ${l}`);i+=u*p}else if(l==="string"){const d=re(o.shape);h=[];for(let p=0;p<d;p++){const f=new Uint32Array(t.slice(i,i+ab))[0];i+=ab;const g=new Uint8Array(t.slice(i,i+f));h.push(g),i+=f}}else{const d=hI[l],p=t.slice(i,i+u*d);if(l==="float32")h=new Float32Array(p);else if(l==="int32")h=new Int32Array(p);else if(l==="bool")h=new Uint8Array(p);else if(l==="complex64"){h=new Float32Array(p);const f=new Float32Array(h.length/2),g=new Float32Array(h.length/2);for(let w=0;w<f.length;w++)f[w]=h[w*2],g[w]=h[w*2+1];const m=ir(f,c,"float32"),y=ir(g,c,"float32");s[a]=So(m,y),m.dispose(),y.dispose()}else throw new Error(`Unsupported dtype in weight '${a}': ${l}`);i+=u*d}l!=="complex64"&&(s[a]=ir(h,c,l))}return s}function S8(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(i=>{if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const s=new Uint8Array(e);let r=0;return t.forEach(i=>{s.set(new Uint8Array(i.buffer),r),r+=i.byteLength}),s.buffer}const hk=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function cR(n){return hk?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function k8(n){if(hk)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function T8(n){if(hk){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function cF(n){return wi.join(n)}function uR(n){const e="/";for(n=n.trim();n.endsWith(e);)n=n.slice(0,n.length-1);const t=n.split(e);return t[t.length-1]}function uF(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function dk(n,e,t){const s={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(s.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=t}return n.signature!=null&&(s.signature=n.signature),n.userDefinedMetadata!=null&&(s.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(s.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(s.initializerSignature=n.initializerSignature),s}async function pk(n,e){let t,s;return n.weightsManifest!=null&&([t,s]=await e(n.weightsManifest)),dk(n,t,s)}function Sm(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:cR(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:cR(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new wi(n.weightData).byteLength}}function fk(n){const e=[];for(const t of n)e.push(...t.weights);return e}function C8(){const n=t=>{let s=t<<13,r=0;for(;!(s&8388608);)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function E8(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function _8(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function N8(){const n=C8(),e=E8(),t=_8();return s=>{const r=new ArrayBuffer(4*s.length),i=new Uint32Array(r);for(let o=0;o<s.length;o++){const a=s[o],l=n[t[a>>10]+(a&1023)]+e[a>>10];i[o]=l}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return cn.instance==null&&(cn.instance=new cn),cn.instance}static registerSaveRouter(e){cn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){cn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return cn.getHandlers(e,"save")}static getLoadHandlers(e,t){return cn.getHandlers(e,"load",t)}static getHandlers(e,t,s){const r=[];return(t==="load"?cn.getInstance().loadRouters:cn.getInstance().saveRouters).forEach(o=>{const a=o(e,s);a!==null&&r.push(a)}),r}}const A8=n=>cn.registerSaveRouter(n),R8=n=>cn.registerLoadRouter(n),hF=n=>cn.getSaveHandlers(n),dF=(n,e)=>cn.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pI="tensorflowjs",fI=1,Il="models_store",la="model_info_store";function pF(){if(!X().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function mI(n){const e=n.result;e.createObjectStore(Il,{keyPath:"modelPath"}),e.createObjectStore(la,{keyPath:"modelPath"})}class zl{constructor(e){if(this.indexedDB=pF(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,r)=>{const i=this.indexedDB.open(pI,fI);i.onupgradeneeded=()=>mI(i),i.onsuccess=()=>{const o=i.result;if(t==null){const a=o.transaction(Il,"readonly"),c=a.objectStore(Il).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(c.result.modelArtifacts)},c.onerror=u=>(o.close(),r(c.error)),a.oncomplete=()=>o.close()}else{t.weightData=wi.join(t.weightData);const a=Sm(t),l=o.transaction(la,"readwrite");let c=l.objectStore(la),u;try{u=c.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(d){return r(d)}let h;u.onsuccess=()=>{h=o.transaction(Il,"readwrite");const d=h.objectStore(Il);let p;try{p=d.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(f){return r(f)}p.onsuccess=()=>s({modelArtifactsInfo:a}),p.onerror=f=>{c=l.objectStore(la);const g=c.delete(this.modelPath);g.onsuccess=()=>(o.close(),r(p.error)),g.onerror=m=>(o.close(),r(p.error))}},u.onerror=d=>(o.close(),r(u.error)),l.oncomplete=()=>{h==null?o.close():h.oncomplete=()=>o.close()}}},i.onerror=o=>r(i.error)})}}zl.URL_SCHEME="indexeddb://";const fF=n=>X().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(zl.URL_SCHEME)?$8(n.slice(zl.URL_SCHEME.length)):null;cn.registerSaveRouter(fF);cn.registerLoadRouter(fF);function $8(n){return new zl(n)}function D8(n){return n.startsWith(zl.URL_SCHEME)?n.slice(zl.URL_SCHEME.length):n}class P8{constructor(){this.indexedDB=pF()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open(pI,fI);s.onupgradeneeded=()=>mI(s),s.onsuccess=()=>{const r=s.result,i=r.transaction(la,"readonly"),a=i.objectStore(la).getAll();a.onsuccess=()=>{const l={};for(const c of a.result)l[c.modelPath]=c.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),t(a.error)),i.oncomplete=()=>r.close()},s.onerror=r=>t(s.error)})}async removeModel(e){return e=D8(e),new Promise((t,s)=>{const r=this.indexedDB.open(pI,fI);r.onupgradeneeded=()=>mI(r),r.onsuccess=()=>{const i=r.result,o=i.transaction(la,"readwrite"),a=o.objectStore(la),l=a.get(e);let c;l.onsuccess=()=>{if(l.result==null)return i.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const u=a.delete(e),h=()=>{c=i.transaction(Il,"readwrite");const p=c.objectStore(Il).delete(e);p.onsuccess=()=>t(l.result.modelArtifactsInfo),p.onerror=f=>s(l.error)};u.onsuccess=h,u.onerror=d=>(h(),i.close(),s(l.error))}},l.onerror=u=>(i.close(),s(l.error)),o.oncomplete=()=>{c==null?i.close():c.oncomplete=()=>i.close()}},r.onerror=i=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const po="/",Wc="tensorflowjs_models",mF="info",O8="model_topology",F8="weight_specs",L8="weight_data",M8="model_metadata";function gF(n){return{info:[Wc,n,mF].join(po),topology:[Wc,n,O8].join(po),weightSpecs:[Wc,n,F8].join(po),weightData:[Wc,n,L8].join(po),modelMetadata:[Wc,n,M8].join(po)}}function yF(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function z8(n){const e=n.split(po);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(po)}function V8(n){return n.startsWith(Vl.URL_SCHEME)?n.slice(Vl.URL_SCHEME.length):n}class Vl{constructor(e){if(!X().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=gF(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=Sm(e),i=wi.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,k8(i));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw yF(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const a=JSON.parse(i);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=T8(o),t}}Vl.URL_SCHEME="localstorage://";const bF=n=>X().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Vl.URL_SCHEME)?B8(n.slice(Vl.URL_SCHEME.length)):null;cn.registerSaveRouter(bF);cn.registerLoadRouter(bF);function B8(n){return new Vl(n)}class j8{constructor(){O(X().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),O(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Wc+po,s=po+mF;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(t)&&i.endsWith(s)){const o=z8(i);e[o]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=V8(e);const t=gF(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return yF(t),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jc="://";class vs{constructor(){this.managers={}}static getInstance(){return vs.instance==null&&(vs.instance=new vs),vs.instance}static registerManager(e,t){O(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(Jc)&&(e=e.slice(0,e.indexOf(Jc))),O(e.length>0,()=>"scheme must not be an empty string.");const s=vs.getInstance();O(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=vs.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(vs.getInstance().managers)}}function gy(n){if(n.indexOf(Jc)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${vs.getSchemes().join(",")}`);return{scheme:n.split(Jc)[0],path:n.split(Jc)[1]}}async function xF(n,e,t=!1){O(n!==e,()=>`Old path and new path are the same: '${n}'`);const s=cn.getLoadHandlers(n);O(s.length>0,()=>`Copying failed because no load handler is found for source URL ${n}.`),O(s.length<2,()=>`Copying failed because more than one (${s.length}) load handlers for source URL ${n}.`);const r=s[0],i=cn.getSaveHandlers(e);O(i.length>0,()=>`Copying failed because no save handler is found for destination URL ${e}.`),O(i.length<2,()=>`Copying failed because more than one (${s.length}) save handlers for destination URL ${e}.`);const o=i[0],a=gy(n).scheme,l=gy(n).path,c=a===gy(n).scheme,u=await r.load();t&&c&&await vs.getManager(a).removeModel(l);const h=await o.save(u);return t&&!c&&await vs.getManager(a).removeModel(l),h.modelArtifactsInfo}async function U8(){const n=vs.getSchemes(),e={};for(const t of n){const s=await vs.getManager(t).listModels();for(const r in s){const i=t+Jc+r;e[i]=s[r]}}return e}async function W8(n){const e=gy(n);return vs.getManager(e.scheme).removeModel(e.path)}async function G8(n,e){return xF(n,e,!1)}async function H8(n,e){return xF(n,e,!0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class q8{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!X().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return GO(e)}}if(X().get("IS_BROWSER")){X().setPlatform("browser",new q8);try{vs.registerManager(Vl.URL_SCHEME,new j8)}catch{}try{vs.registerManager(zl.URL_SCHEME,new P8)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K8={importFetch:()=>require("node-fetch")};let Mv;class X8{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return X().global.fetch!=null?X().global.fetch(e,t):(Mv==null&&(Mv=K8.importFetch()),Mv(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}X().get("IS_NODE")&&!X().get("IS_BROWSER")&&X().setPlatform("node",new X8);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ct(n,e="float32",t){return e=e||"float32",hr(n),new Nn(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y8(n,e){const t=F(n,"x","cast");if(!OO(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},r={dtype:e};return B.runKernel(qu,s,r)}const ve=j({cast_:Y8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q8(n){const t={x:F(n,"x","clone","string_or_numeric")};return B.runKernel(oh,t)}const Mi=j({clone_:Q8});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mk(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */aF();const Z8={buffer:ct,cast:ve,clone:Mi,print:mk};d8(Z8);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J8(){X().set("PROD",!0)}function eK(){X().set("DEBUG",!0)}function tK(){X().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function nK(n){X().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function sK(){B.disposeVariables()}function Jr(){return B}function lb(){return B.memory()}function rK(n){return B.profile(n)}function Y(n,e){return B.tidy(n,e)}function et(n){Io(n).forEach(t=>t.dispose())}function Pn(n){return B.keep(n)}function iK(n){return B.time(n)}function oK(n){return B.setBackend(n)}function aK(){return B.ready()}function lK(){return B.backendName}function cK(n){B.removeBackend(n)}function uK(n){return B.findBackend(n)}function hK(n){return B.findBackendFactory(n)}function gk(n,e,t=1){return B.registerBackend(n,e,t)}function wF(){return B.backend}function dK(n,e){X().setPlatform(n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pK(n,e){let t=F(n,"a","add"),s=F(e,"b","add");[t,s]=dn(t,s);const r={a:t,b:s};return B.runKernel(hc,r)}const pe=j({add_:pK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fK(n,e){let t=F(n,"a","floorDiv"),s=F(e,"b","floorDiv");[t,s]=dn(t,s);const r={a:t,b:s};return B.runKernel(rh,r)}const kw=j({floorDiv_:fK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mK(n,e){let t=F(n,"a","div"),s=F(e,"b","div");if([t,s]=dn(t,s),t.dtype==="int32"&&s.dtype==="int32")return kw(t,s);const r={a:t,b:s},i={};return B.runKernel(Zu,r,i)}const Me=j({div_:mK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gK(n,e){let t=F(n,"a","mul"),s=F(e,"b","mul");[t,s]=dn(t,s);const r={a:t,b:s};return B.runKernel(mh,r)}const W=j({mul_:gK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yK(n){const e=F(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return B.runKernel(_f,t)}else{const t={x:e};return B.runKernel(xf,t)}}const Tn=j({abs_:yK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bK(n){const t={x:F(n,"x","acos")};return B.runKernel(Vu,t)}const yk=j({acos_:bK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xK(n){const t={x:F(n,"x","acosh")};return B.runKernel(Bu,t)}const bk=j({acosh_:xK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wK(n){O(Array.isArray(n),()=>"The argument passed to tf.addN() must be a list of tensors"),O(n.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${n.length}`);const e=n.map((r,i)=>F(r,`tensors${i}`,"addN")),t=e[0];e.forEach(r=>{if(r.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(r=>{if(!wt(r.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const s=e;return B.runKernel(wf,s)}const vF=j({addN_:wK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vK(n,e=null,t=!1){const r={x:F(n,"x","all","bool")},i={axis:e,keepDims:t};return B.runKernel(gx,r,i)}const Tw=j({all_:vK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IK(n,e=null,t=!1){const r={x:F(n,"x","any","bool")},i={axis:e,keepDims:t};return B.runKernel(yx,r,i)}const jp=j({any_:IK});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SK(n,e=0){const s={x:F(n,"x","argMax")},r={axis:e};return B.runKernel(vf,s,r)}const Bl=j({argMax_:SK});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kK(n,e=0){const s={x:F(n,"x","argMin")},r={axis:e};return B.runKernel(If,s,r)}const xk=j({argMin_:kK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TK(n){const t={x:F(n,"x","asin")};return B.runKernel(ju,t)}const wk=j({asin_:TK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CK(n){const t={x:F(n,"x","asinh")};return B.runKernel(Uu,t)}const vk=j({asinh_:CK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EK(n){const t={x:F(n,"x","atan")};return B.runKernel(Wu,t)}const Ik=j({atan_:EK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _K(n,e){let t=F(n,"a","atan2"),s=F(e,"b","atan2");[t,s]=dn(t,s);const r={a:t,b:s};return B.runKernel(Hu,r)}const Sk=j({atan2_:_K});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NK(n){const t={x:F(n,"x","atanh")};return B.runKernel(Gu,t)}const kk=j({atanh_:NK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function km(n,e,t,s,r="NHWC",i){const o=n[3],a=[...e,o],l=Fo(r);return Kn(n,a,t,i,s,null,null,l)}function Hr(n,e,t,s,r,i,o="channelsLast"){const[a,l]=Up(e);let c;if(o==="channelsLast")c=[a,l,n[3],n[3]];else if(o==="channelsFirst")c=[a,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return Kn(n,c,t,s,r,i,!1,o)}function Oo(n,e,t,s,r,i,o="NDHWC"){const[a,l,c]=gI(e);let u,h;if(o==="NDHWC")h="channelsLast",u=[a,l,c,n[4],n[4]];else if(o==="NCDHW")h="channelsFirst",u=[a,l,c,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return Ba(n,u,t,s,r,!1,h,i)}function Kn(n,e,t,s,r,i,o=!1,a="channelsLast"){let[l,c,u,h]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,u,h]=n;else if(a==="channelsFirst")[l,h,c,u]=n;else throw new Error(`Unknown dataFormat ${a}`);const[d,p,,f]=e,[g,m]=Up(t),[y,w]=Up(s),v=eu(d,y),I=eu(p,w),{padInfo:_,outHeight:N,outWidth:T}=$K(r,c,u,g,m,v,I,i,a),E=o?f*h:f;let k;return a==="channelsFirst"?k=[l,E,N,T]:a==="channelsLast"&&(k=[l,N,T,E]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:u,inChannels:h,outHeight:N,outWidth:T,outChannels:E,padInfo:_,strideHeight:g,strideWidth:m,filterHeight:d,filterWidth:p,effectiveFilterHeight:v,effectiveFilterWidth:I,dilationHeight:y,dilationWidth:w,inShape:n,outShape:k,filterShape:e}}function Ba(n,e,t,s,r,i=!1,o="channelsLast",a){let[l,c,u,h,d]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,c,u,h,d]=n;else if(o==="channelsFirst")[l,d,c,u,h]=n;else throw new Error(`Unknown dataFormat ${o}`);const[p,f,g,,m]=e,[y,w,v]=gI(t),[I,_,N]=gI(s),T=eu(p,I),E=eu(f,_),k=eu(g,N),{padInfo:S,outDepth:A,outHeight:P,outWidth:D}=DK(r,c,u,h,y,w,v,T,E,k,a),V=i?m*d:m;let U;return o==="channelsFirst"?U=[l,V,A,P,D]:o==="channelsLast"&&(U=[l,A,P,D,V]),{batchSize:l,dataFormat:o,inDepth:c,inHeight:u,inWidth:h,inChannels:d,outDepth:A,outHeight:P,outWidth:D,outChannels:V,padInfo:S,strideDepth:y,strideHeight:w,strideWidth:v,filterDepth:p,filterHeight:f,filterWidth:g,effectiveFilterDepth:T,effectiveFilterHeight:E,effectiveFilterWidth:k,dilationDepth:I,dilationHeight:_,dilationWidth:N,inShape:n,outShape:U,filterShape:e}}function AK(n,e,t,s,r){s==null&&(s=Tk(n,e,t));const i=n[0],o=n[1],a=Wp((i-e+2*s)/t+1,r),l=Wp((o-e+2*s)/t+1,r);return[a,l]}function RK(n,e,t,s,r,i){r==null&&(r=Tk(n,e[0],s[0]));const o=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*r>=e[a]&&(o[a]=Wp((n[a]-e[a]+2*r)/s[a]+1,i));return o}function Tk(n,e,t,s=1){const r=eu(e,s);return Math.floor((n[0]*(t-1)-t+r)/2)}function Up(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function gI(n){return typeof n=="number"?[n,n,n]:n}function eu(n,e){return e<=1?n:n+(n-1)*(e-1)}function $K(n,e,t,s,r,i,o,a,l){let c,u,h;if(typeof n=="number"){c={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const p=AK([e,t],i,s,n,a);u=p[0],h=p[1]}else if(n==="same"){u=Math.ceil(e/s),h=Math.ceil(t/r);const d=Math.max(0,(u-1)*s+i-e),p=Math.max(0,(h-1)*r+o-t),f=Math.floor(d/2),g=d-f,m=Math.floor(p/2),y=p-m;c={top:f,bottom:g,left:m,right:y,type:"SAME"}}else if(n==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((e-i+1)/s),h=Math.ceil((t-o+1)/r);else if(typeof n=="object"){const d=l==="channelsLast"?n[1][0]:n[2][0],p=l==="channelsLast"?n[1][1]:n[2][1],f=l==="channelsLast"?n[2][0]:n[3][0],g=l==="channelsLast"?n[2][1]:n[3][1];c={top:d,bottom:p,left:f,right:g,type:d===0&&p===0&&f===0&&g===0?"VALID":"EXPLICIT"},u=Wp((e-i+d+p)/s+1,a),h=Wp((t-o+f+g)/r+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:c,outHeight:u,outWidth:h}}function DK(n,e,t,s,r,i,o,a,l,c,u){let h,d,p,f;if(n==="valid"&&(n=0),typeof n=="number"){h={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const m=RK([e,t,s,1],[a,l,c],1,[r,i,o],n,u);d=m[0],p=m[1],f=m[2]}else if(n==="same"){d=Math.ceil(e/r),p=Math.ceil(t/i),f=Math.ceil(s/o);const g=(d-1)*r+a-e,m=(p-1)*i+l-t,y=(f-1)*o+c-s,w=Math.floor(g/2),v=g-w,I=Math.floor(m/2),_=m-I,N=Math.floor(y/2),T=y-N;h={top:I,bottom:_,left:N,right:T,front:w,back:v,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:h,outDepth:d,outHeight:p,outWidth:f}}function Wp(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function Ta(n){const[e,t,s]=Up(n);return e===1&&t===1&&s===1}function ls(n,e){return Ta(n)||Ta(e)}function jl(n){return Up(n).every(e=>e>0)}function Fo(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function As(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")O(Ml(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{O(Ml(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PK(n,e){const s={x:F(n,"x","reshape","string_or_numeric")},r={shape:e};return B.runKernel(lm,s,r)}const G=j({reshape_:PK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OK(n,e,t,s,r){const i=F(n,"x","avgPool","float32"),o=1;O(ls(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=G(i,[1,i.shape[0],i.shape[1],i.shape[2]])),O(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),As("avgPool",s,r);const c={x:a},u={filterSize:e,strides:t,pad:s,dimRoundingMode:r};let h=B.runKernel(Sf,c,u);return h=ve(h,i.dtype),l?G(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Tm=j({avgPool_:OK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FK(n,e,t,s,r,i="NDHWC"){const o=F(n,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=G(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),O(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),O(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),O(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),As("avgPool3d",s,r);const c={x:a},u={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i};let h=B.runKernel(kf,c,u);return h=ve(h,a.dtype),l?G(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const Ck=j({avgPool3d_:FK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LK(n,e=0){O(n.length>=1,()=>"Pass at least one tensor to concat");const t=Bp(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return Mi(t[0]);const s=t,r={axis:e};return B.runKernel(Nf,s,r)}const xn=j({concat_:LK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MK(n,e,t=!1,s=!1){let r=F(n,"a","matMul"),i=F(e,"b","matMul");[r,i]=dn(r,i);const o={a:r,b:i},a={transposeA:t,transposeB:s};return B.runKernel(Tf,o,a)}const pt=j({matMul_:MK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zK(n){const t={x:F(n,"x","sigmoid","float32")};return B.runKernel(Ch,t)}const oi=j({sigmoid_:zK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VK(n,e,t){const s=F(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},i={begin:e,size:t};return B.runKernel(pm,r,i)}const St=j({slice_:VK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BK(n){const t={x:F(n,"x","tanh","float32")};return B.runKernel($h,t)}const Ul=j({tanh_:BK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jK(n,e,t,s,r,i){const o=F(n,"forgetBias","basicLSTMCell"),a=F(e,"lstmKernel","basicLSTMCell"),l=F(t,"lstmBias","basicLSTMCell"),c=F(s,"data","basicLSTMCell"),u=F(r,"c","basicLSTMCell"),h=F(i,"h","basicLSTMCell"),d=xn([c,h],1),p=pt(d,a),f=pe(p,l),g=f.shape[0],m=f.shape[1]/4,y=[g,m],w=St(f,[0,0],y),v=St(f,[0,m],y),I=St(f,[0,m*2],y),_=St(f,[0,m*3],y),N=pe(W(oi(w),Ul(v)),W(u,oi(pe(o,I)))),T=W(Ul(N),oi(_));return[N,T]}const IF=j({basicLSTMCell_:jK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UK(n,e,t){const s=F(n,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);O(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),O(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),O(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const i={x:s},o={blockShape:e,crops:t};return B.runKernel(Cf,i,o)}const Cm=j({batchToSpaceND_:UK});function WK(n){let e;return n.rank===0||n.rank===1?e=G(n,[1,1,1,n.size]):n.rank===2?e=G(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=G(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GK(n,e,t,s,r,i){i==null&&(i=.001);const o=F(n,"x","batchNorm"),a=F(e,"mean","batchNorm"),l=F(t,"variance","batchNorm");let c;r!=null&&(c=F(r,"scale","batchNorm"));let u;s!=null&&(u=F(s,"offset","batchNorm")),O(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),O(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),O(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const d={x:WK(o),scale:c,offset:u,mean:a,variance:l},p={varianceEpsilon:i},f=B.runKernel(Mf,d,p);return G(f,o.shape)}const Oh=j({batchNorm_:GK});function HK(n,e,t,s,r,i){const o=F(n,"x","batchNorm"),a=F(e,"mean","batchNorm"),l=F(t,"variance","batchNorm");let c;r!=null&&(c=F(r,"scale","batchNorm"));let u;return s!=null&&(u=F(s,"offset","batchNorm")),O(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),O(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),O(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&O(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),u!=null&&O(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),Oh(o,a,l,u,c,i)}const Ek=j({batchNorm2d_:HK});function qK(n,e,t,s,r,i){const o=F(n,"x","batchNorm"),a=F(e,"mean","batchNorm"),l=F(t,"variance","batchNorm");let c;r!=null&&(c=F(r,"scale","batchNorm"));let u;return s!=null&&(u=F(s,"offset","batchNorm")),O(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),O(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),O(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&O(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),u!=null&&O(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),Oh(o,a,l,u,c,i)}const _k=j({batchNorm3d_:qK});function KK(n,e,t,s,r,i){const o=F(n,"x","batchNorm"),a=F(e,"mean","batchNorm"),l=F(t,"variance","batchNorm");let c;r!=null&&(c=F(r,"scale","batchNorm"));let u;return s!=null&&(u=F(s,"offset","batchNorm")),O(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),O(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),O(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&O(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),u!=null&&O(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),Oh(o,a,l,u,c,i)}const Nk=j({batchNorm4d_:KK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XK(n,e,t){const s=F(n,"x","bincount"),r=F(e,"weights","bincount");O(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),O(t>=0,()=>`size must be non-negative, but got ${t}.`),O(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const i={x:s,weights:r},o={size:t};return B.runKernel(wx,i,o)}const Ak=j({bincount_:XK});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YK(n,e){const t=F(n,"x","bitwiseAnd"),s=F(e,"y","bitwiseAnd");if(!wt(t.shape,s.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${t.shape}, y: ${s.shape}`);if(t.dtype!=="int32"||s.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${t.dtype} and type of y: ${s.dtype}`);const r={a:t,b:s};return B.runKernel(Ef,r)}const SF=j({bitwiseAnd_:YK});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QK(n,e){const t=F(n,"s0","broadcastArgs","int32"),s=F(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${t.rank}`);if(s.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${s.rank}`);const r={s0:t,s1:s};return B.runKernel(vx,r)}const kF=j({broadcastArgs_:QK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZK(n,e){let t=F(n,"broadcastTo","x");const s=t.shape;if(hr(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const c=t.shape.slice();for(;c.length<e.length;)c.unshift(1);t=G(t,c)}const r=t.shape,i=Array.from(e);for(let c=e.length-1;c>=0;c--)if(r[c]===e[c])i[c]=1;else if(t.shape[c]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(i.map((c,u)=>c>1?u:-1).filter(c=>c>=0).length===0)return Mi(t);const a={x:t},l={reps:i};return B.runKernel(Dh,a,l)}const Rl=j({broadcastTo_:ZK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JK(n){const t={x:F(n,"x","ceil","float32")};return B.runKernel(Ku,t)}const Rk=j({ceil_:JK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pc(n,e,t){hr(n),t=t||cc(e);const s={shape:n,value:e,dtype:t};return B.runKernel(Lx,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e7(n,e,t){const s=F(n,"x","clipByValue");if(O(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return pc(s.shape,e,s.dtype);const r={x:s},i={clipValueMin:e,clipValueMax:t};return B.runKernel(Xu,r,i)}const Hs=j({clipByValue_:e7});function t7(n){return xn(n,0)}const $k=j({concat1d_:t7});function n7(n,e){return xn(n,e)}const Dk=j({concat2d_:n7});function s7(n,e){return xn(n,e)}const Pk=j({concat3d_:s7});function r7(n,e){return xn(n,e)}const Ok=j({concat4d_:r7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i7(n,e,t,s,r="NHWC",i=[1,1],o){const a=F(n,"x","conv2d","float32"),l=F(e,"filter","conv2d","float32");let c=a,u=!1;a.rank===3&&(u=!0,c=G(a,[1,a.shape[0],a.shape[1],a.shape[2]])),O(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),O(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),As("conv2d",s,o);const h=r==="NHWC"?c.shape[3]:c.shape[1];O(h===l.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${l.shape[2]}.`),O(ls(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),O(jl(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),O(jl(t),()=>"Error in conv2D: Strides should be larger than 0.");const d={x:c,filter:l},p={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},f=B.runKernel(Af,d,p);return u?G(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const ko=j({conv2d_:i7});function o7(n,e,t,s,r="NWC",i=1,o){const a=F(n,"x","conv1d"),l=F(e,"filter","conv1d");let c=a,u=!1;a.rank===2&&(u=!0,c=G(a,[1,a.shape[0],a.shape[1]])),O(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),O(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),As("conv1d",s,o),O(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),O(ls(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),O(jl(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),O(jl(t),()=>"Error in conv1D: Stride should be larger than 0."),O(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const h=G(l,[1,l.shape[0],l.shape[1],l.shape[2]]),d=G(c,[c.shape[0],1,c.shape[1],c.shape[2]]),m=ko(d,h,[1,t],s,"NHWC",[1,i],o);return u?G(m,[m.shape[2],m.shape[3]]):G(m,[m.shape[0],m.shape[2],m.shape[3]])}const Cw=j({conv1d_:o7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a7(n,e,t,s,r,i="NHWC",o){O(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,l=e,c=!1;e.rank===3&&(c=!0,l=G(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),O(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),O(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),O(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const u=i==="NHWC"?a[3]:a[1],h=i==="NHWC"?l.shape[3]:l.shape[1];O(u===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${t.shape[2]}.`),O(h===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${t.shape[3]}.`),As("conv2dDerInput",r,o);const d={dy:l,filter:t},p={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,inputShape:a},f=B.runKernel(Rf,d,p);return c?G(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const Fk=j({conv2DBackpropInput_:a7});function l7(n,e,t,s,r,i){const o=F(n,"x","conv2dTranspose"),a=F(e,"filter","conv2dTranspose");return Fk(t,o,a,s,r,"NHWC",i)}const Ew=j({conv2dTranspose_:l7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c7(n,e,t,s,r="NDHWC",i=[1,1,1]){const o=F(n,"x","conv3d"),a=F(e,"filter","conv3d");let l=o,c=!1;o.rank===4&&(c=!0,l=G(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),O(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),O(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),O(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),O(ls(t,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),O(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),O(jl(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),O(jl(t),()=>"Error in conv3D: Strides should be larger than 0.");const u={x:l,filter:a},h={strides:t,pad:s,dataFormat:r,dilations:i},d=B.runKernel($f,u,h);return c?G(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const Lk=j({conv3d_:c7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u7(n,e,t,s,r){O(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let i=n,o=e,a=!1;e.rank===4&&(a=!0,o=G(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);const l=i[4],c=o.shape[4];O(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),O(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),O(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),O(l===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[3]}.`),O(c===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${t.shape[4]}.`);const u={dy:o,filter:t},h={pad:r,strides:s,inputShape:i},d=B.runKernel(Tx,u,h);return a?G(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const TF=j({conv3DBackpropInput_:u7});function h7(n,e,t,s,r){const i=F(n,"x","conv3dTranspose"),o=F(e,"filter","conv3dTranspose");return TF(t,i,o,s,r)}const Mk=j({conv3dTranspose_:h7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d7(n){const t={x:F(n,"x","cos","float32")};return B.runKernel(Yu,t)}const Em=j({cos_:d7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p7(n){const t={x:F(n,"x","cosh","float32")};return B.runKernel(Qu,t)}const _w=j({cosh_:p7});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f7(n,e=0,t=!1,s=!1){const i={x:F(n,"x","cumprod")},o={axis:e,exclusive:t,reverse:s};return B.runKernel(Cx,i,o)}const Gp=j({cumprod_:f7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m7(n,e=0,t=!1,s=!1){const i={x:F(n,"x","cumsum")},o={axis:e,exclusive:t,reverse:s};return B.runKernel(Df,i,o)}const Nw=j({cumsum_:m7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g7(n,e,t,s=!1){const r=F(n,"x","denseBincount"),i=F(e,"weights","denseBincount");O(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),O(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),O(t>=0,()=>`size must be non-negative, but got ${t}.`),O(i.size===r.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${i.shape}.`);const o={x:r,weights:i},a={size:t,binaryOutput:s};return B.runKernel(_x,o,a)}const cb=j({denseBincount_:g7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y7(n,e,t="NHWC"){const s=F(n,"x","depthToSpace","float32"),r=t==="NHWC"?s.shape[1]:s.shape[2],i=t==="NHWC"?s.shape[2]:s.shape[3],o=t==="NHWC"?s.shape[3]:s.shape[1];O(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),O(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),O(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${s.shape}`),O(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:t};return B.runKernel(Nx,a,l)}const zk=j({depthToSpace_:y7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b7(n,e,t,s,r="NHWC",i=[1,1],o){const a=F(n,"x","depthwiseConv2d","float32"),l=F(e,"filter","depthwiseConv2d","float32");let c=a,u=!1;a.rank===3&&(u=!0,c=G(a,[1,a.shape[0],a.shape[1],a.shape[2]])),O(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),O(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const h=r==="NHWC"?c.shape[3]:c.shape[1];O(h===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${l.shape[2]}.`),As("depthwiseConv2d",s,o);const d={x:c,filter:l},p={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},f=B.runKernel(Pf,d,p);return u?G(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const Fh=j({depthwiseConv2d_:b7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x7(n){const t={x:F(n,"x","diag")};return B.runKernel($x,t)}const CF=j({diag_:x7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w7(n,e,t,s,r=[1,1],i="NHWC"){const o=F(n,"x","dilation2d"),a=F(e,"filter","dilation2d");O(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),O(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),O(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=o,c=!1;o.rank===3&&(l=G(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),O(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const u={x:l,filter:a},h={strides:t,pad:s,dilations:r},d=B.runKernel(Of,u,h);return c?G(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const Vk=j({dilation2d_:w7});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wl(n,e){const t=n.length,s=[];for(let r=0;r<t;r++){const i=t-1-r,o=n[i]||1;(e[e.length-1-r]||1)>1&&o===1&&s.unshift(i)}return s}function An(n,e){const t=[];for(let s=0;s<e.length;s++){const r=n[n.length-s-1],i=e.length-s-1,o=e[i];(r==null||r===1&&o>1)&&t.unshift(i)}return t}function tt(n,e){const t=Math.max(n.length,e.length),s=new Array(t);for(let r=0;r<t;r++){let i=n[n.length-r-1];i==null&&(i=1);let o=e[e.length-r-1];if(o==null&&(o=1),i===1)s[t-r-1]=o;else if(o===1)s[t-r-1]=i;else if(i!==o){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else s[t-r-1]=i}return s}const v7=Object.freeze(Object.defineProperty({__proto__:null,assertAndGetBroadcastShape:tt,getBroadcastDims:Wl,getReductionAxes:An},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I7(n,e){let t=F(n,"a","equal","string_or_numeric"),s=F(e,"b","equal","string_or_numeric");[t,s]=dn(t,s),tt(t.shape,s.shape);const r={a:t,b:s};return B.runKernel(Ff,r)}const ar=j({equal_:I7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S7(n,e,t){const s=F(e,"a","where"),r=F(t,"b","where"),i=F(n,"condition","where","bool"),o=tt(tt(i.shape,s.shape),r.shape),a=Rl(i,o),l=Rl(s,o),c=Rl(r,o),u={condition:a,t:l,e:c};return B.runKernel(dm,u)}const Wn=j({where_:S7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k7(n){const t={x:F(n,"x","zerosLike")};return B.runKernel(vm,t)}const Ct=j({zerosLike_:k7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T7(n,e){let t=F(n,"a","div"),s=F(e,"b","div");[t,s]=dn(t,s);const r=Me(t,s),i=Ct(r),o=ar(s,i);return Wn(o,i,r)}const Bk=j({divNoNan_:T7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C7(n,e){const t=F(n,"t1","dot"),s=F(e,"t2","dot");O((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const r=t.rank===1?t.size:t.shape[1],i=s.rank===1?s.size:s.shape[0];if(O(r===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${i}.`),t.rank===1&&s.rank===1){const o=G(t,[1,-1]),a=G(s,[-1,1]),l=pt(o,a);return G(l,[])}else if(t.rank===1&&s.rank===2){const o=G(t,[1,-1]),a=G(s,[s.shape[0],s.shape[1]]),l=pt(o,a);return G(l,[l.size])}else if(t.rank===2&&s.rank===1){const o=G(s,[-1,1]),a=pt(t,o);return G(a,[a.size])}else{const o=G(s,[s.shape[0],s.shape[1]]);return pt(t,o)}}const jk=j({dot_:C7});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E7(n,...e){const t=e.map((r,i)=>F(r,`tensors${i}`,"einsum")),s={equation:n};return B.runKernel(Px,t,s)}const hl=j({einsum_:E7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _7(n){const t={x:F(n,"x","elu","float32")};return B.runKernel(Ju,t)}const Lh=j({elu_:_7});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N7(n,e){const t=F(n,"x","ensureShape","string_or_numeric");if(!DO(t.shape,e))throw new Error(`EnsureShape: Shape of tensor ${t.shape} is not compatible with expected shape ${e}`);return n}const EF=j({ensureShape_:N7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A7(n){let e=F(n,"x","erf");O(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=ve(e,"float32"));const t={x:e};return B.runKernel(eh,t)}const Uk=j({erf_:A7});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wk(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function _F(n,e,t){const s=n.length+e.length,r=[];let i=0,o=0;for(let a=0;a<s;a++)t.indexOf(a)===-1?r.push(n[i++]):r.push(e[o++]);return r}function Xn(n,e){const t=[],s=n.length;for(let i=0;i<s;i++)e.indexOf(i)===-1&&t.push(n[i]);const r=e.map(i=>n[i]);return[t,r]}function wn(n,e){const t=e.map(s=>1);return _F(n,t,e)}function cs(n,e,t){O(Wk(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function pn(n,e){if(Wk(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function ja(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function vn(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R7(n,e=null,t=!1){const r={x:F(n,"x","max")},i={reductionIndices:e,keepDims:t};return B.runKernel(Kf,r,i)}const Sr=j({max_:R7});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $7(n,e=null,t=!1){const r={x:F(n,"x","min")},i={axis:e,keepDims:t};return B.runKernel(Zf,r,i)}const bu=j({min_:$7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D7(n,e){let t=F(n,"base","pow"),s=F(e,"exp","pow");[t,s]=dn(t,s);const r={a:t,b:s};return B.runKernel(gh,r)}const To=j({pow_:D7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ue(n,e){if((Dn(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Dn(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Va(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P7(n){const t={x:F(n,"x","sqrt","float32")};return B.runKernel(_h,t)}const os=j({sqrt_:P7});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O7(n){const e=F(n,"x","square"),t={};return B.runKernel("Square",{x:e},t)}const jt=j({square_:O7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F7(n,e=null,t=!1){let s=F(n,"x","sum");s.dtype==="bool"&&(s=ve(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return B.runKernel(fm,r,i)}const Pe=j({sum_:F7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L7(n,e="euclidean",t=null,s=!1){n=F(n,"x","norm");const r=NF(n,e,t);let i=r.shape;if(s){const o=ft(t,n.shape);i=wn(r.shape,o)}return G(r,i)}function NF(n,e,t=null){if(n.rank===0)return Tn(n);if(n.rank!==1&&t===null)return NF(G(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Pe(Tn(n),t);if(e===1/0)return Sr(Tn(n),t);if(e===-1/0)return bu(Tn(n),t);if(e==="euclidean"||e===2)return os(Pe(To(Tn(n),Ue(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return Sr(Pe(Tn(n),t[0]),t[1]-1);if(e===1/0)return Sr(Pe(Tn(n),t[1]),t[0]);if(e===-1/0)return bu(Pe(Tn(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return os(Pe(jt(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const Mh=j({norm_:L7});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M7(n,e=null,t=!1){return Mh(n,"euclidean",e,t)}const Gk=j({euclideanNorm_:M7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z7(n){const t={x:F(n,"x","exp")};return B.runKernel(th,t)}const qs=j({exp_:z7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V7(n,e=0){const t=F(n,"x","expandDims","string_or_numeric");O(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},r={dim:e};return B.runKernel(Lf,s,r)}const es=j({expandDims_:V7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B7(n){const t={x:F(n,"x","expm1")};return B.runKernel(nh,t)}const Hk=j({expm1_:B7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j7(n,e){const t=F(n,"x","tile","string_or_numeric");O(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},r={reps:e};return B.runKernel(Dh,s,r)}const xr=j({tile_:j7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U7(n,e,t,s="float32"){e==null&&(e=n);const r=ct([n,e],s),i=n<=e?n:e;for(let a=0;a<i;++a)r.set(1,a,a);const o=G(r.toTensor(),[n,e]);if(t==null)return o;if(t.length===1)return xr(es(o,0),[t[0],1,1]);if(t.length===2)return xr(es(es(o,0),0),[t[0],t[1],1,1]);if(t.length===3)return xr(es(es(es(o,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const Aw=j({eye_:U7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W7(n){const t={x:F(n,"x","floor","float32")};return B.runKernel(sh,t)}const zh=j({floor_:W7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G7(n,e,t=0,s=0){const r=F(n,"x","gather"),i=F(e,"indices","gather","int32"),o={x:r,indices:i},a={axis:t,batchDims:s};return B.runKernel(zf,o,a)}const Vh=j({gather_:G7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H7(n,e){let t=F(n,"a","greater","string_or_numeric"),s=F(e,"b","greater","string_or_numeric");[t,s]=dn(t,s),tt(t.shape,s.shape);const r={a:t,b:s};return B.runKernel(Vf,r)}const Rs=j({greater_:H7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q7(n,e){let t=F(n,"a","greaterEqual","string_or_numeric"),s=F(e,"b","greaterEqual","string_or_numeric");[t,s]=dn(t,s),tt(t.shape,s.shape);const r={a:t,b:s};return B.runKernel(ih,r)}const Lo=j({greaterEqual_:q7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K7(n){const t={input:F(n,"input","imag")};return B.runKernel(Bx,t)}const _m=j({imag_:K7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X7(n){const t={x:F(n,"x","isFinite")};return B.runKernel(ah,t)}const qk=j({isFinite_:X7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y7(n){const t={x:F(n,"x","isInf")};return B.runKernel(lh,t)}const Kk=j({isInf_:Y7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q7(n){const t={x:F(n,"x","isNaN")};return B.runKernel(ch,t)}const Xk=j({isNaN_:Q7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z7(n,e=.2){const s={x:F(n,"x","leakyRelu")},r={alpha:e};return B.runKernel(Bf,s,r)}const Nm=j({leakyRelu_:Z7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J7(n,e){let t=F(n,"a","less","string_or_numeric"),s=F(e,"b","less","string_or_numeric");[t,s]=dn(t,s),tt(t.shape,s.shape);const r={a:t,b:s};return B.runKernel(jf,r)}const xu=j({less_:J7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eX(n,e){let t=F(n,"a","lessEqual","string_or_numeric"),s=F(e,"b","lessEqual","string_or_numeric");[t,s]=dn(t,s),tt(t.shape,s.shape);const r={a:t,b:s};return B.runKernel(Uf,r)}const Ua=j({lessEqual_:eX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AF(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");const s={start:n,stop:e,num:t};return B.runKernel(jx,{},s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tX(n,e=5,t=1,s=1,r=.5){const i=F(n,"x","localResponseNormalization");O(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),O(Ml(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,a=!1;i.rank===3&&(a=!0,o=G(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:o},c={depthRadius:e,bias:t,alpha:s,beta:r},u=B.runKernel(qf,l,c);return a?G(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const Yk=j({localResponseNormalization_:tX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nX(n){const t={x:F(n,"x","log","float32")};return B.runKernel(uh,t)}const lr=j({log_:nX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sX(n){const t={x:F(n,"x","log1p")};return B.runKernel(hh,t)}const Am=j({log1p_:sX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rX(n){return O(ka(n),()=>"The f passed in grad(f) must be a function"),(e,t)=>{const s=F(e,"x","tf.grad","string_or_numeric"),r=t!=null?F(t,"dy","tf.grad"):null;return B.tidy(()=>{const{value:i,grads:o}=B.gradients(()=>n(s),[s],r);return r!=null&&as(i.shape,r.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Rw(o),o[0]})}}function iX(n){return O(ka(n),()=>"The f passed in grads(f) must be a function"),(e,t)=>{O(Array.isArray(e),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");const s=Bp(e,"args","tf.grads","string_or_numeric"),r=t!=null?F(t,"dy","tf.grads"):null;return B.tidy(()=>{const{value:i,grads:o}=B.gradients(()=>n(...s),s,r);return r!=null&&as(i.shape,r.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Rw(o),o})}}function oX(n){return O(ka(n),()=>"The f passed in valueAndGrad(f) must be a function"),(e,t)=>{O(e instanceof kt,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),O(t==null||t instanceof kt,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");const{grads:s,value:r}=B.gradients(()=>n(e),[e],t);return Rw(s),{grad:s[0],value:r}}}function aX(n){return O(ka(n),()=>"The f passed in valueAndGrads(f) must be a function"),(e,t)=>{O(Array.isArray(e)&&e.every(r=>r instanceof kt),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),O(t==null||t instanceof kt,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");const s=B.gradients(()=>n(...e),e,t);return t!=null&&as(s.value.shape,t.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Rw(s.grads),s}}function RF(n,e){O(ka(n),()=>"The f passed in variableGrads(f) must be a function"),O(e==null||Array.isArray(e)&&e.every(c=>c instanceof Vp),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const c in B.registeredVariables)e.push(B.registeredVariables[c])}const s=t?e.filter(c=>!c.trainable):null,r=e.length;e=e.filter(c=>c.trainable),O(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const i=!0,{value:o,grads:a}=B.gradients(n,e,null,i);O(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),O(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((c,u)=>{a[u]!=null&&(l[c.name]=a[u])}),s!=null&&s.forEach(c=>l[c.name]=null),{value:o,grads:l}}function Yi(n){return B.customGrad(n)}function Rw(n){if(n.filter(t=>t==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lX(n){const t={x:F(n,"x","neg")};return B.runKernel(em,t)}const Yt=j({neg_:lX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cX(n){const t={x:F(n,"x","softplus")};return B.runKernel(Eh,t)}const fc=j({softplus_:cX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uX(n){const e=F(n,"x","logSigmoid");return Yi(s=>({value:Yt(fc(Yt(s))),gradFunc:o=>W(o,oi(Yt(s)))}))(e)}const Qk=j({logSigmoid_:uX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hX(n,e){let t=F(n,"a","sub"),s=F(e,"b","sub");[t,s]=dn(t,s);const r={a:t,b:s};return B.runKernel(Ah,r)}const Ne=j({sub_:hX});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dX(n,e=-1){const t=F(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return Yi((r,i)=>{const a=Sr(r,e,!0),l=Ne(r,a),c=Ne(ve(l,"float32"),lr(Pe(qs(l),e,!0)));return i([c]),{value:c,gradFunc:(h,d)=>{const[p]=d,f=!0,g=qs(p);return Ne(h,W(Pe(h,e,f),g))}}})(t)}const $w=j({logSoftmax_:dX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pX(n,e=null,t=!1){const s=F(n,"x","logSumExp"),r=ft(e,s.shape),i=Sr(s,r,!0),o=Ne(s,i),a=qs(o),l=Pe(a,r),c=lr(l),u=pe(G(i,c.shape),c);if(t){const h=wn(u.shape,r);return G(u,h)}return u}const Rm=j({logSumExp_:pX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fX(n,e){const t=F(n,"a","logicalAnd","bool"),s=F(e,"b","logicalAnd","bool");tt(t.shape,s.shape);const r={a:t,b:s};return B.runKernel(Wf,r)}const Wr=j({logicalAnd_:fX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mX(n){const t={x:F(n,"x","logicalNot","bool")};return B.runKernel(Gf,t)}const $m=j({logicalNot_:mX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gX(n,e){const t=F(n,"a","logicalOr","bool"),s=F(e,"b","logicalOr","bool");tt(t.shape,s.shape);const r={a:t,b:s};return B.runKernel(Hf,r)}const Dw=j({logicalOr_:gX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yX(n,e){const t=F(n,"a","logicalXor","bool"),s=F(e,"b","logicalXor","bool");return tt(t.shape,s.shape),Wr(Dw(n,e),$m(Wr(n,e)))}const Zk=j({logicalXor_:yX});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Og=2147483648;function bX(n,e,t="left"){const s=F(n,"sortedSequence","searchSorted"),r=F(e,"values","searchSorted"),i=s.shape[s.shape.length-1],o=r.shape[r.shape.length-1],a=G(s,[-1,i]),l=G(r,[-1,o]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(re(l.shape)>=Og)throw new Error(`values tensor size must less than ${Og}`);if(a.shape[1]>=Og)throw new Error(`trailing dim_size must less than ${Og} for int32 output type, was ${a.shape[1]}`);const c={sortedSequence:a,values:l},u={side:t};return B.runKernel(ow,c,u)}const Pw=j({searchSorted_:bX});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $F(n,e){return Pw(n,e,"left")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xX(n,e,t,s,r){const i=F(n,"x","maxPool"),o=1;let a=i,l=!1;i.rank===3&&(l=!0,a=G(i,[1,i.shape[0],i.shape[1],i.shape[2]])),O(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),O(ls(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),As("maxPool",s,r);const c={x:a},u={filterSize:e,strides:t,pad:s,dimRoundingMode:r},h=B.runKernel(Xf,c,u);return l?G(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Dm=j({maxPool_:xX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wX(n,e=[1,1,1],t,s,r,i="NDHWC"){const o=F(n,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=G(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),O(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),O(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),As("maxPool3d",s,r);const c={x:a},u={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i},h=B.runKernel(Yf,c,u);return l?G(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const Jk=j({maxPool3d_:wX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vX(n,e,t,s,r=!1){const o={x:F(n,"x","maxPoolWithArgmax")},a={filterSize:e,strides:t,pad:s,includeBatchInIndex:r},l=B.runKernel(Hx,o,a);return{result:l[0],indexes:l[1]}}const DF=j({maxPoolWithArgmax_:vX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IX(n,e){let t=F(n,"a","maximum"),s=F(e,"b","maximum");[t,s]=dn(t,s),t.dtype==="bool"&&(t=ve(t,"int32"),s=ve(s,"int32")),tt(t.shape,s.shape);const r={a:t,b:s};return B.runKernel(dh,r)}const to=j({maximum_:IX});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SX(n,e=null,t=!1){const r={x:F(n,"x","mean")},i={axis:e,keepDims:t};return B.runKernel(Qf,r,i)}const un=j({mean_:SX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function En(n,e="float32"){if(hr(n),e==="complex64"){const s=En(n,"float32"),r=En(n,"float32");return So(s,r)}const t=is(re(n),e);return B.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vs(n,e="float32"){if(hr(n),e==="complex64"){const s=Vs(n,"float32"),r=En(n,"float32");return So(s,r)}const t=mx(re(n),e);return B.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PF(n,e,{indexing:t="xy"}={}){if(t!=="xy"&&t!=="ij")throw new TypeError(`${t} is not a valid third argument to meshgrid`);if(n===void 0)return[];let s=F(n,"x","meshgrid",n instanceof kt?n.dtype:"float32");if(e===void 0)return[s];let r=F(e,"y","meshgrid",e instanceof kt?e.dtype:"float32");const i=re(s.shape),o=re(r.shape);return t==="xy"?(s=G(s,[1,-1]),r=G(r,[-1,1]),[pt(Vs([o,1],s.dtype),s),pt(r,Vs([1,i],r.dtype))]):(s=G(s,[-1,1]),r=G(r,[1,-1]),[pt(s,Vs([1,o],s.dtype)),pt(Vs([i,1],r.dtype),r)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kX(n,e){let t=F(n,"a","minimum"),s=F(e,"b","minimum");[t,s]=dn(t,s),t.dtype==="bool"&&(t=ve(t,"int32"),s=ve(s,"int32")),tt(t.shape,s.shape);const r={a:t,b:s};return B.runKernel(ph,r)}const Ca=j({minimum_:kX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TX(n,e,t){O(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=F(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");O(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let a=0;a<s.rank;a++)O(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),O(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const i={paddings:e,mode:t},o={x:s};return B.runKernel(Jf,o,i)}const eT=j({mirrorPad_:TX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CX(n,e){let t=F(n,"a","mod"),s=F(e,"b","mod");[t,s]=dn(t,s);const r={a:t,b:s};return B.runKernel(fh,r)}const tT=j({mod_:CX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EX(n,e=null,t=!1){n=F(n,"x","moments");const s=ft(e,n.shape),r=un(n,s,t);let i=r.shape;t||(i=wn(r.shape,s));const o=jt(Ne(ve(n,"float32"),G(r,i))),a=un(o,s,t);return{mean:r,variance:a}}const Pm=j({moments_:EX});function _X(n,e,t,s){const r=F(e,"data","multiRNNCell"),i=Bp(t,"c","multiRNNCell"),o=Bp(s,"h","multiRNNCell");let a=r;const l=[];for(let h=0;h<n.length;h++){const d=n[h](a,i[h],o[h]);l.push(d[0]),l.push(d[1]),a=d[1]}const c=[],u=[];for(let h=0;h<l.length;h+=2)c.push(l[h]),u.push(l[h+1]);return[c,u]}const OF=j({multiRNNCell_:_X});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NX(n,e,t,s=!1){const r=F(n,"logits","multinomial"),i=r.size,o=r.rank;if(i<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${i}.`);if(o>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${o}`);t=t||Math.random();const l={logits:o===1?G(r,[1,-1]):r},c={numSamples:e,seed:t,normalized:s},u=B.runKernel(qx,l,c);return o===1?G(u,[u.size]):u}const FF=j({multinomial_:NX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AX(n,e){let t=F(n,"a","notEqual","string_or_numeric"),s=F(e,"b","notEqual","string_or_numeric");[t,s]=dn(t,s),tt(t.shape,s.shape);const r={a:t,b:s};return B.runKernel(tm,r)}const Gl=j({notEqual_:AX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RX(n,e,t=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:F(n,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:t,offValue:s};return B.runKernel(sm,o,a)}const wu=j({oneHot_:RX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $X(n){const t={x:F(n,"x","onesLike")};return B.runKernel(nm,t)}const cr=j({onesLike_:$X});function DX(n,e){const t=F(n,"v1","outerProduct"),s=F(e,"v2","outerProduct");O(t.rank===1&&s.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${t.rank} and ${s.rank}.`);const r=G(t,[-1,1]),i=G(s,[1,-1]);return pt(r,i)}const LF=j({outerProduct_:DX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PX(n,e,t=0){const s=F(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},i={x:s};return B.runKernel(im,i,r)}const Mo=j({pad_:PX});function OX(n,e,t=0){return O(e.length===2,()=>"Invalid number of paddings. Must be length of 2."),Mo(n,[e],t)}const MF=j({pad1d_:OX});function FX(n,e,t=0){return O(e.length===2&&e[0].length===2&&e[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Mo(n,e,t)}const zF=j({pad2d_:FX});function LX(n,e,t=0){return O(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Mo(n,e,t)}const VF=j({pad3d_:LX});function MX(n,e,t=0){return O(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Mo(n,e,t)}const BF=j({pad4d_:MX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zX(n,e,t){const s=F(n,"x","spaceToBatchND");O(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),O(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),O(s.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+t[l-1][0]+t[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},i={blockShape:e,paddings:t};return B.runKernel(mm,r,i)}const Om=j({spaceToBatchND_:zX});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VX(n,e,t,s,r,i,o){r==null&&(r=[1,1]),i==null&&(i=1),s===0&&(s="valid");const a=F(n,"x","maxPool");let l=a,c=!1;a.rank===3&&(c=!0,l=G(a,[1,a.shape[0],a.shape[1],a.shape[2]])),O(ls(i,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`);const u=Hr(l.shape,e,i,r,s),h=[u.dilationHeight,u.dilationWidth];let d;s==="same"?d=jX([u.filterHeight,u.filterWidth],h):d=[[0,0],[0,0]];const p=h[0]===1&&h[1]===1,[f,g]=BX([u.inHeight,u.inWidth],h,d),m=p?s:"valid",y=p?l:Om(l,h,f),v=(t==="avg"?()=>Tm(y,e,i,m,o):()=>Dm(y,e,i,m,o))(),I=p?v:Cm(v,h,g);return c?G(I,[I.shape[1],I.shape[2],I.shape[3]]):I}function BX(n,e,t){const s=t.map(u=>u[0]),r=t.map(u=>u[1]),i=n.concat(s,r),o=e.map((u,h)=>(u-i[h]%u)%u),a=r.map((u,h)=>u+o[h]),l=e.map((u,h)=>[s[h],a[h]]),c=e.map((u,h)=>[0,o[h]]);return[l,c]}function jX(n,e){const s=n.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),r=s.map(o=>Math.floor(o/2)),i=s.map((o,a)=>o-r[a]);return s.map((o,a)=>[r[a],i[a]])}const nT=j({pool_:VX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UX(n,e){const t=F(n,"x","prelu"),s=F(e,"alpha","prelu"),r={x:t,alpha:s};return B.runKernel(om,r)}const Fm=j({prelu_:UX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WX(n,e=null,t=!1){let s=F(n,"x","prod");s.dtype==="bool"&&(s=ve(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return B.runKernel(am,r,i)}const sT=j({prod_:WX});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GX(n,e,t,s){const r=n.map((u,h)=>F(u,`tensors${h}`,"raggedGather","int32")),i=F(e,"paramsDenseValues","raggedGather"),o=F(t,"indices","raggedGather","int32"),a={paramsNestedSplits:r,paramsDenseValues:i,indices:o},l={outputRaggedRank:s},c=B.runKernel(Qx,a,l);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}const jF=j({raggedGather_:GX});/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HX(n,e,t){const s=F(n,"starts","raggedRange"),r=F(e,"limits","raggedRange",s.dtype),i=F(t,"deltas","raggedRange",s.dtype),o={starts:s,limits:r,deltas:i},a=B.runKernel(Zx,o);return{rtNestedSplits:a[0],rtDenseValues:a[1]}}const UF=j({raggedRange_:HX});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qX(n,e,t,s,r){const i=F(n,"shape","raggedTensorToTensor","int32"),o=F(e,"values","raggedTensorToTensor"),a=F(t,"defaultValue","raggedTensorToTensor",o.dtype),l=s.map((h,d)=>F(h,`tensors${d}`,"raggedTensorToTensor","int32")),c={shape:i,values:o,defaultValue:a,rowPartitionTensors:l},u={rowPartitionTypes:r};return B.runKernel(Jx,c,u)}const WF=j({raggedTensorToTensor_:qX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KX(n,e,t){hr(n);const s=re(n);let r=null;if(t==null||t==="float32")r=new Float32Array(s);else if(t==="int32")r=new Int32Array(s);else if(t==="bool")r=new Uint8Array(s);else throw new Error(`Unknown data type ${t}`);for(let i=0;i<s;i++)r[i]=e();return B.makeTensor(r,n,t)}const GF=j({rand_:KX});var rT={exports:{}};rT.exports;(function(n){(function(e,t,s){function r(l){var c=this,u=a();c.next=function(){var h=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=h-(c.c=h|0)},c.c=1,c.s0=u(" "),c.s1=u(" "),c.s2=u(" "),c.s0-=u(l),c.s0<0&&(c.s0+=1),c.s1-=u(l),c.s1<0&&(c.s1+=1),c.s2-=u(l),c.s2<0&&(c.s2+=1),u=null}function i(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function o(l,c){var u=new r(l),h=c&&c.state,d=u.next;return d.int32=function(){return u.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,h&&(typeof h=="object"&&i(h,u),d.state=function(){return i(u,{})}),d}function a(){var l=4022871197,c=function(u){u=String(u);for(var h=0;h<u.length;h++){l+=u.charCodeAt(h);var d=.02519603282416938*l;l=d>>>0,d-=l,d*=l,l=d>>>0,d-=l,l+=d*4294967296}return(l>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:s&&s.amd?s(function(){return o}):this.alea=o})(di,n,!1)})(rT);var XX=rT.exports,iT={exports:{}};iT.exports;(function(n){(function(e,t,s){function r(a){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var h=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^h^h>>>8},a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var c=new r(a),u=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var d=c.next()>>>11,p=(c.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},h.int32=c.next,h.quick=h,u&&(typeof u=="object"&&i(u,c),h.state=function(){return i(c,{})}),h}t&&t.exports?t.exports=o:s&&s.amd?s(function(){return o}):this.xor128=o})(di,n,!1)})(iT);var YX=iT.exports,oT={exports:{}};oT.exports;(function(n){(function(e,t,s){function r(a){var l=this,c="";l.next=function(){var h=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(h^h<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,u==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var c=new r(a),u=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var d=c.next()>>>11,p=(c.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},h.int32=c.next,h.quick=h,u&&(typeof u=="object"&&i(u,c),h.state=function(){return i(c,{})}),h}t&&t.exports?t.exports=o:s&&s.amd?s(function(){return o}):this.xorwow=o})(di,n,!1)})(oT);var QX=oT.exports,aT={exports:{}};aT.exports;(function(n){(function(e,t,s){function r(a){var l=this;l.next=function(){var u=l.x,h=l.i,d,p;return d=u[h],d^=d>>>7,p=d^d<<24,d=u[h+1&7],p^=d^d>>>10,d=u[h+3&7],p^=d^d>>>3,d=u[h+4&7],p^=d^d<<7,d=u[h+7&7],d=d^d<<13,p^=d^d<<9,u[h]=p,l.i=h+1&7,p};function c(u,h){var d,p=[];if(h===(h|0))p[0]=h;else for(h=""+h,d=0;d<h.length;++d)p[d&7]=p[d&7]<<15^h.charCodeAt(d)+p[d+1&7]<<13;for(;p.length<8;)p.push(0);for(d=0;d<8&&p[d]===0;++d);for(d==8?p[7]=-1:p[d],u.x=p,u.i=0,d=256;d>0;--d)u.next()}c(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var c=new r(a),u=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var d=c.next()>>>11,p=(c.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},h.int32=c.next,h.quick=h,u&&(u.x&&i(u,c),h.state=function(){return i(c,{})}),h}t&&t.exports?t.exports=o:s&&s.amd?s(function(){return o}):this.xorshift7=o})(di,n,!1)})(aT);var ZX=aT.exports,lT={exports:{}};lT.exports;(function(n){(function(e,t,s){function r(a){var l=this;l.next=function(){var u=l.w,h=l.X,d=l.i,p,f;return l.w=u=u+1640531527|0,f=h[d+34&127],p=h[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,f=h[d]=f^p,l.i=d,f+(u^u>>>16)|0};function c(u,h){var d,p,f,g,m,y=[],w=128;for(h===(h|0)?(p=h,h=null):(h=h+"\0",p=0,w=Math.max(w,h.length)),f=0,g=-32;g<w;++g)h&&(p^=h.charCodeAt((g+32)%h.length)),g===0&&(m=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,g>=0&&(m=m+1640531527|0,d=y[g&127]^=p+m,f=d==0?f+1:0);for(f>=128&&(y[(h&&h.length||0)&127]=-1),f=127,g=4*128;g>0;--g)p=y[f+34&127],d=y[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,y[f]=p^d;u.w=m,u.X=y,u.i=f}c(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var c=new r(a),u=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var d=c.next()>>>11,p=(c.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},h.int32=c.next,h.quick=h,u&&(u.X&&i(u,c),h.state=function(){return i(c,{})}),h}t&&t.exports?t.exports=o:s&&s.amd?s(function(){return o}):this.xor4096=o})(di,n,!1)})(lT);var JX=lT.exports,cT={exports:{}};cT.exports;(function(n){(function(e,t,s){function r(a){var l=this,c="";l.next=function(){var h=l.b,d=l.c,p=l.d,f=l.a;return h=h<<25^h>>>7^d,d=d-p|0,p=p<<24^p>>>8^f,f=f-h|0,l.b=h=h<<20^h>>>12^d,l.c=d=d-p|0,l.d=p<<16^d>>>16^f,l.a=f-h|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):c+=a;for(var u=0;u<c.length+20;u++)l.b^=c.charCodeAt(u)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var c=new r(a),u=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var d=c.next()>>>11,p=(c.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},h.int32=c.next,h.quick=h,u&&(typeof u=="object"&&i(u,c),h.state=function(){return i(c,{})}),h}t&&t.exports?t.exports=o:s&&s.amd?s(function(){return o}):this.tychei=o})(di,n,!1)})(cT);var eY=cT.exports,HF={exports:{}};const tY={},nY=Object.freeze(Object.defineProperty({__proto__:null,default:tY},Symbol.toStringTag,{value:"Module"})),sY=EG(nY);(function(n){(function(e,t,s){var r=256,i=6,o=52,a="random",l=s.pow(r,i),c=s.pow(2,o),u=c*2,h=r-1,d;function p(I,_,N){var T=[];_=_==!0?{entropy:!0}:_||{};var E=y(m(_.entropy?[I,v(t)]:I??w(),3),T),k=new f(T),S=function(){for(var A=k.g(i),P=l,D=0;A<c;)A=(A+D)*r,P*=r,D=k.g(1);for(;A>=u;)A/=2,P/=2,D>>>=1;return(A+D)/P};return S.int32=function(){return k.g(4)|0},S.quick=function(){return k.g(4)/4294967296},S.double=S,y(v(k.S),t),(_.pass||N||function(A,P,D,V){return V&&(V.S&&g(V,k),A.state=function(){return g(k,{})}),D?(s[a]=A,P):A})(S,E,"global"in _?_.global:this==s,_.state)}function f(I){var _,N=I.length,T=this,E=0,k=T.i=T.j=0,S=T.S=[];for(N||(I=[N++]);E<r;)S[E]=E++;for(E=0;E<r;E++)S[E]=S[k=h&k+I[E%N]+(_=S[E])],S[k]=_;(T.g=function(A){for(var P,D=0,V=T.i,U=T.j,q=T.S;A--;)P=q[V=h&V+1],D=D*r+q[h&(q[V]=q[U=h&U+P])+(q[U]=P)];return T.i=V,T.j=U,D})(r)}function g(I,_){return _.i=I.i,_.j=I.j,_.S=I.S.slice(),_}function m(I,_){var N=[],T=typeof I,E;if(_&&T=="object")for(E in I)try{N.push(m(I[E],_-1))}catch{}return N.length?N:T=="string"?I:I+"\0"}function y(I,_){for(var N=I+"",T,E=0;E<N.length;)_[h&E]=h&(T^=_[h&E]*19)+N.charCodeAt(E++);return v(_)}function w(){try{var I;return d&&(I=d.randomBytes)?I=I(r):(I=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(I)),v(I)}catch{var _=e.navigator,N=_&&_.plugins;return[+new Date,e,N,e.screen,v(t)]}}function v(I){return String.fromCharCode.apply(0,I)}if(y(s.random(),t),n.exports){n.exports=p;try{d=sY}catch{}}else s["seed"+a]=p})(typeof self<"u"?self:di,[],Math)})(HF);var rY=HF.exports,iY=XX,oY=YX,aY=QX,lY=ZX,cY=JX,uY=eY,mc=rY;mc.alea=iY;mc.xor128=oY;mc.xorwow=aY;mc.xorshift7=lY;mc.xor4096=cY;mc.tychei=uY;var Bh=mc;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hY=.001,qF=.1;function dY(n,e,t){return t==null&&(t=uT()),yI(n,e,(s,r)=>hT(s,r,t))}function uT(){return B.backend.floatPrecision()===32?hY:qF}function yI(n,e,t){let s=!0;if((Dn(n)||Dn(e))&&(s=!1),Dn(n)&&Dn(e)&&(s=!0),s){const o=n.constructor.name,a=e.constructor.name;if(o!==a)throw new Error(`Arrays are of different type. Actual: ${o}. Expected: ${a}`)}if(Array.isArray(n)&&Array.isArray(e)){const o=Xi(n),a=Xi(e);if(!wt(o,a))throw new Error(`Arrays have different shapes. Actual: [${o}]. Expected: [${a}]`)}const r=Dn(n)?n:Ki(n),i=Dn(e)?e:Ki(e);if(r.length!==i.length)throw new Error(`Arrays have different lengths actual: ${r.length} vs expected: ${i.length}.
Actual:   ${r}.
Expected: ${i}.`);for(let o=0;o<i.length;++o){const a=r[o],l=i[o];if(!t(a,l))throw new Error(`Arrays differ: actual[${o}] = ${a}, expected[${o}] = ${l}.
Actual:   ${r}.
Expected: ${i}.`)}typeof expect<"u"&&expect().nothing()}function pY(n,e){n().then(()=>e.fail(),()=>e()),typeof expect<"u"&&expect().nothing()}function fY(n,e){const t=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return Pi(n)||Pi(n[0])||Pi(e)||Pi(e[0])?yI(n,t,(s,r)=>s==r):yI(n,e,(s,r)=>hT(s,r,0))}function mY(n,e,t){if(t==null&&(t=uT()),!hT(n,e,t))throw new Error(`Numbers differ: actual === ${n}, expected === ${e}`);typeof expect<"u"&&expect().nothing()}function hT(n,e,t){return!isFinite(n)&&!isFinite(e)?!0:!(isNaN(n)||isNaN(e)||Math.abs(n-e)>t)}function gY(n,e,t){for(let s=0;s<n.length;s++)if(n[s]<e||n[s]>t)throw new Error(`Value out of range:${n[s]} low: ${e}, high: ${t}`)}function yY(n,e){const t=new Float32Array(n),s=new Float32Array(e);if(t.length!==s.length)throw new Error(`Expected ArrayBuffer to be of length ${s.length}, but it was ${t.length}`);for(let r=0;r<s.length;r++)if(t[r]!==s[r])throw new Error(`Expected ArrayBuffer value at ${r} to be ${s[r]} but got ${t[r]} instead`)}function KF(n){for(let e=0;e<n.length;e++){const t=n[e];Array.isArray(t)?KF(t):n[e]=Li(t)}return n}function bY(n){const e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(n),new Promise(t=>{e.addEventListener("loadeddata",s=>t(e)),e.load()})}async function xY(n){await n.play(),"requestVideoFrameCallback"in n&&await new Promise(e=>{n.requestVideoFrameCallback(e)})}const wY=Object.freeze(Object.defineProperty({__proto__:null,TEST_EPSILON_FLOAT16:qF,createVideoElement:bY,encodeStrings:KF,expectArrayBuffersEqual:yY,expectArraysClose:dY,expectArraysEqual:fY,expectNumbersClose:mY,expectPromiseToFail:pY,expectValuesInRange:gY,play:xY,testEpsilon:uT},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dT{constructor(e,t,s,r,i){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=Bh.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,s=!1;for(;!s;){let r,i,o;do r=2*this.random()-1,i=2*this.random()-1,o=r*r+i*i;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*r*a,t=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class vY{constructor(e,t,s,r){this.alpha=e,this.beta=1/t,this.dtype=s;const i=r||Math.random();this.randu=Bh.alea(i.toString()),this.randn=new dT(0,1,s,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,s,r,i,o;for(;;){do r=this.randn.nextValue(),o=1+this.c*r;while(o<=0);if(o*=o*o,e=r*r,t=1-.331*e*e,s=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<s)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}}class IY{constructor(e=0,t=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=Bh.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SY(n,e,t=1,s="float32",r){if(hr(n),t==null&&(t=1),s==null&&(s="float32"),s!=="float32"&&s!=="int32")throw new Error(`Unsupported data type ${s}`);const i=new vY(e,t,s,r),o=ct(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const XF=j({randomGamma_:SY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kY(n,e=0,t=1,s,r){if(hr(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const i=new dT(e,t,s,!1,r),o=ct(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const Ow=j({randomNormal_:kY});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TY(n,e,t){if(e!=null&&e==="bool")throw new Error(`Unsupported data type ${e}`);return Ow(n,0,1,e,t)}const YF=j({randomStandardNormal_:TY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CY(n,e=0,t=1,s="float32",r){hr(n);const i=ct(n,s),o=new IY(e,t,null,r);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const Wa=j({randomUniform_:CY});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EY(n,e,t,s){return Wa(n,e,t,"int32",s)}const QF=j({randomUniformInt_:EY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hl(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:s};return B.runKernel(ew,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Y(n){const t={input:F(n,"input","real")};return B.runKernel(tw,t)}const vu=j({real_:_Y});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NY(n){const t={x:F(n,"x","reciprocal")};return B.runKernel(yh,t)}const pT=j({reciprocal_:NY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AY(n){const t={x:F(n,"x","relu")};return B.runKernel(bh,t)}const vi=j({relu_:AY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RY(n){const t={x:F(n,"x","relu6")};return B.runKernel(xh,t)}const Fw=j({relu6_:RY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Y(n,e){const s={x:F(n,"x","reverse")},r={dims:e};return B.runKernel(hm,s,r)}const Cr=j({reverse_:$Y});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DY(n){const e=F(n,"x","reverse");return O(e.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`),Cr(e,0)}const ZF=j({reverse1d_:DY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PY(n,e){const t=F(n,"x","reverse");return O(t.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${t.rank}.`),Cr(t,e)}const JF=j({reverse2d_:PY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OY(n,e){const t=F(n,"x","reverse");return O(t.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${t.rank}.`),Cr(t,e)}const eL=j({reverse3d_:OY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FY(n,e){const t=F(n,"x","reverse");return O(t.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${t.rank}.`),Cr(t,e)}const tL=j({reverse4d_:FY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LY(n){const t={x:F(n,"x","round")};return B.runKernel(wh,t)}const Lw=j({round_:LY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MY(n){const t={x:F(n,"x","rsqrt","float32")};return B.runKernel(vh,t)}const Mw=j({rsqrt_:MY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zY(n){const t={x:F(n,"x","selu")};return B.runKernel(Ih,t)}const zw=j({selu_:zY});function VY(n,e,t,s,r,i=[1,1],o="NHWC"){const a=F(n,"x","separableConv2d"),l=F(e,"depthwiseFilter","separableConv2d"),c=F(t,"pointwiseFilter","separableConv2d");let u=a,h=!1;if(a.rank===3&&(h=!0,u=G(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");O(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),O(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),O(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),O(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),O(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);const d=l.shape[2],p=l.shape[3];O(c.shape[2]===d*p,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${d*p}, but got ${c.shape[2]}.`);const f=Fh(u,l,s,r,o,i),m=ko(f,c,1,"valid",o);return h?G(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const Vw=j({separableConv2d_:VY});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function BY(n,e){const t=F(n,"x","setdiff1d"),s=F(e,"y","setdiff1d");O(t.dtype===s.dtype,()=>`x and y should have the same dtype, but got x (${t.dtype}) and y (${s.dtype}).`),O(t.rank===1,()=>`x should be 1D tensor, but got x (${t.shape}).`),O(s.rank===1,()=>`y should be 1D tensor, but got y (${s.shape}).`);const r=await t.data(),i=await s.data(),o=new Set(i);let a=0;for(let u=0;u<r.length;u++)o.has(r[u])||a++;const l=new Nn([a],t.dtype),c=new Nn([a],"int32");for(let u=0,h=0;u<r.length;u++)o.has(r[u])||(l.values[h]=r[u],c.values[h]=u,h++);return[l.toTensor(),c.toTensor()]}const nL=BY;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jY(n){const t={x:F(n,"x","sign")};return B.runKernel(Th,t)}const fT=j({sign_:jY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UY(n){const t={x:F(n,"x","sin","float32")};return B.runKernel(Sh,t)}const Bw=j({sin_:UY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WY(n){const t={x:F(n,"x","sinh")};return B.runKernel(kh,t)}const jw=j({sinh_:WY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GY(n,e,t){const s=F(n,"x","slice1d");return O(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),St(s,[e],[t])}const Lm=j({slice1d_:GY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HY(n,e,t){const s=F(n,"x","slice2d");return O(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),St(s,e,t)}const Uw=j({slice2d_:HY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qY(n,e,t){const s=F(n,"x","slice3d");return O(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),St(s,e,t)}const Mm=j({slice3d_:qY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KY(n,e,t){const s=F(n,"x","slice4d");return O(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),St(s,e,t)}const Iu=j({slice4d_:KY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XY(n,e=-1){const t=F(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},r={dim:e};return B.runKernel(ym,s,r)}const zm=j({softmax_:XY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YY(n){O(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return B.runKernel(Fx,e)}const Vm=j({fft_:YY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QY(n){O(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return B.runKernel(Vx,e)}const Su=j({ifft_:QY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZY(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const r=G(n,[t,e]);s=Su(r)}else{const r=[t,2*(e-1)],i=G(vu(n),[t,e]),o=G(_m(n),[t,e]),a=Cr(St(i,[0,1],[t,e-2]),1),l=W(Cr(St(o,[0,1],[t,e-2]),1),Ue(-1)),c=xn([i,a],1),u=xn([o,l],1),h=G(So(c,u),[r[0],r[1]]);s=Su(h)}if(s=vu(s),n.rank===3&&n.shape[0]!==0){const r=s,i=n.shape[0];s=G(s,[i,s.shape[0]/i,s.shape[1]]),r.dispose()}return s}const Ww=j({irfft_:ZY});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JY(n,e,t=0){const r={x:F(n,"x","split")},i={numOrSizeSplits:e,axis:t};return B.runKernel(gm,r,i)}const Bs=j({split_:JY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eQ(n,e){O(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let r;if(e!=null&&e<t){const f=n.shape.map(m=>0),g=n.shape.map(m=>m);g[n.shape.length-1]=e,r=St(n,f,g),t=e}else if(e!=null&&e>t){const f=n.shape.map(g=>g);f[n.shape.length-1]=e-t,r=xn([n,En(f)],n.shape.length-1),t=e}else r=n;const i=Ct(r),o=G(So(r,i),[s,t]),a=Vm(o),l=Math.floor(t/2)+1,c=vu(a),u=_m(a),h=Bs(c,[l,t-l],c.shape.length-1),d=Bs(u,[l,t-l],u.shape.length-1),p=r.shape.slice();return p[r.shape.length-1]=l,G(So(h[0],d[0]),p)}const Bm=j({rfft_:eQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tQ(n,e){let t=F(n,"a","squaredDifference"),s=F(e,"b","squaredDifference");[t,s]=dn(t,s),tt(t.shape,s.shape);const r={a:t,b:s},i={};return B.runKernel(Nh,r,i)}const Gw=j({squaredDifference_:tQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nQ(n,e){const t=F(n,"x","squeeze","string_or_numeric");return G(t,Do(t.shape,e).newShape)}const Ga=j({squeeze_:nQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sQ(n,e=0){const t=Bp(n,"tensors","stack","string_or_numeric");O(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&O(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,r={axis:e};return B.runKernel(rm,s,r)}const Es=j({stack_:sQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rQ(n,e=0){const s={x:F(n,"x","step")},r={alpha:e};return B.runKernel(Ph,s,r)}const gc=j({step_:rQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iQ(n,e,t,s,r=0,i=0,o=0,a=0,l=0){const u={x:F(n,"x","stridedSlice","string_or_numeric")},h={begin:e,end:t,strides:s,beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return B.runKernel(pw,u,h)}const mT=j({stridedSlice_:iQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oQ(n){const t={x:F(n,"x","tan","float32")};return B.runKernel(Rh,t)}const gT=j({tan_:oQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ss(n,e){lc(n);const t=Xi(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Va(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fa(n,e,t){if(lc(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=Xi(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Va(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yT(n,e,t){if(lc(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const s=Xi(n,t);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Va(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sL(n,e,t){if(lc(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const s=Xi(n,t);if(s.length!==4&&s.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Va(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rL(n,e,t){if(lc(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const s=Xi(n,t);if(s.length!==5&&s.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Va(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iL(n,e,t){if(lc(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const s=Xi(n,t);if(s.length!==6&&s.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||s,Va(n,e,s,t)}function bT(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(i+` update.rank < ${r}. `);if(n.length<s+(t.rank-r))throw new Error(i+` Output shape length < ${s+(t.rank-r)}`);if(t.rank!==r+n.length-s)throw new Error(i+` update.rank != ${r+n.length-s}`);for(let o=0;o<r;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${t.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<t.rank-r;++o)if(t.shape[o+r]!==n[o+s])throw new Error(i+` updates.shape[${o+r}] (${t.shape[o+r]}) != shape[${o+r}] (${n[o+r]})`)}function Hw(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}bT(t,e,n)}function Ha(n,e,t){const s=e.shape.length,r=s>1?e.shape[s-1]:1,i=t.length;let o=1;for(let h=r;h<i;++h)o*=t[h];const a=r<1?1:r,l=re(e.shape)/a,c=[...Be(t.slice(0,r)),1],u=re(t);return{sliceRank:r,numUpdates:l,sliceSize:o,strides:c,outputSize:u}}const aQ=Object.freeze(Object.defineProperty({__proto__:null,calculateShapes:Ha,validateInput:Hw,validateUpdateShape:bT},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lQ(n,e,t){const s=F(n,"tensor","tensorScatterupdate"),r=F(e,"indices","tensorScatterupdate","int32"),i=F(t,"updates","tensorScatterupdate");if(Hw(i,r,s.shape),s.dtype!==i.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${s.dtype} and ${i.dtype}.`);const o={tensor:s,indices:r,updates:i},a={};return B.runKernel(iw,o,a)}const oL=j({tensorScatterUpdate_:lQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cQ(n,e=1,t=!0){const s=F(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const i={x:s},o={k:e,sorted:t},[a,l]=B.runKernel(yw,i,o);return{values:a,indices:l}}const xT=j({topk_:cQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uQ(n,e=0,t=1,s,r){if(hr(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new dT(e,t,s,!0,r),o=ct(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const qw=j({truncatedNormal_:uQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hQ(n,e=0){const t=F(n,"x","unique","string_or_numeric");O(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},r={axis:e},[i,o]=B.runKernel(xw,s,r);return{values:i,indices:o}}const wT=j({unique_:hQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dQ(n,e,t){const s=F(n,"x","unsortedSegmentSum"),r=F(e,"segmentIds","unsortedSegmentSum","int32");O(Ml(t),()=>"numSegments must be of dtype int");const i={x:s,segmentIds:r},o={numSegments:t};return B.runKernel(wm,i,o)}const Kw=j({unsortedSegmentSum_:dQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pQ(n,e=0){const t=F(n,"x","unstack","string_or_numeric");O(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},r={axis:e};return B.runKernel(xm,s,r)}const Er=j({unstack_:pQ});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aL(n,e){return Pw(n,e,"right")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vT(n,e=!0,t,s){return B.makeVariable(n,e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xw(n,e){const t=[];for(let i=0;i<e.length;i++)e[i]&&t.push(i);const s=ct(n,"int32"),r=ct([t.length,n.length],"int32");for(let i=0;i<t.length;i++){const o=s.indexToLoc(t[i]),a=i*n.length;r.values.set(o,a)}return r.toTensor()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function fQ(n){const e=F(n,"condition","whereAsync","bool"),t=await e.data(),s=Xw(e.shape,t);return n!==e&&e.dispose(),s}const IT=fQ;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function mQ(n,e,t){const s=F(n,"tensor","boolMask"),r=F(e,"mask","boolMask","bool"),i=t??0,o=r.rank,a=s.shape;O(o>0,()=>"mask cannot be scalar"),as(a.slice(i,i+o),r.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let g=i;g<i+o;g++)l*=a[g];const c=a.slice(0,i).concat([l],a.slice(i+o)),u=G(s,c),h=G(r,[-1]),d=await IT(h),p=Ga(d,[1]),f=Vh(u,p,i);return n!==s&&s.dispose(),e!==r&&r.dispose(),p.dispose(),u.dispose(),h.dispose(),d.dispose(),f}const lL=mQ;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gQ(n,e,t){const s=F(n,"x","transpose");if(e==null&&(e=s.shape.map((o,a)=>a).reverse()),O(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(o=>{O(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},i={perm:e};return s.dtype==="complex64"?Y(()=>{let o=vu(s),a=_m(s);return o=B.runKernel(Al,{x:o},i),a=B.runKernel(Al,{x:a},i),t&&(a=Yt(a)),So(o,a)}):B.runKernel(Al,r,i)}const vt=j({transpose_:gQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yQ(n,e,t,s,r=!0){const i=F(n,"v","movingAverage"),o=F(e,"x","movingAverage"),a=F(t,"decay","movingAverage");iF(i,o),O(wt(i.shape,o.shape),()=>"Shape mismatch in v and x");const l=Ue(1),c=Ne(l,a);let u=W(Ne(o,i),c);if(r){O(s!=null,()=>"When using zeroDebias: true, step is required.");const h=F(s,"step","movingAverage");u=Me(u,Ne(l,To(a,h)))}return pe(i,u)}const cL=j({movingAverage_:yQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bQ(n,e,t){hr(t);const s=F(n,"indices","scatterND","int32"),r=F(e,"updates","scatterND");Hw(r,s,t);const i={indices:s,updates:r},o={shape:t};return B.runKernel(rw,i,o)}const uL=j({scatterND_:bQ});function xQ(n,e,t,s){if(n.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${n.dtype}.`);if(n.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${n.shape}.`);const r=n.rank>0?n.shape[0]:1,i=n.rank>1?n.shape[1]:1;if(t.length!==i)throw new Error(`outputShape has incorrect number of elements:, ${t.length}, should be: ${i}.`);const o=e.size;if(!(e.rank===0||e.rank===1&&o===r))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${r}]`);if(e.dtype!==s.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wQ(n,e,t,s=0){hr(t);const r=F(n,"sparseIndices","sparseToDense","int32"),i=F(e,"sparseValues","sparseToDense","string_or_numeric"),o=F(s,"defaultValue","sparseToDense",i.dtype);xQ(r,i,t,o);const a={sparseIndices:r,sparseValues:i,defaultValue:o},l={outputShape:t};return B.runKernel(hw,a,l)}const hL=j({sparseToDense_:wQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vQ(n,e){const t=F(e,"indices","gatherND","int32"),r={params:F(n,"x","gatherND","string_or_numeric"),indices:t};return B.runKernel(zx,r)}const dL=j({gatherND_:vQ});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IQ(n,e){if(e==null)return n.shape.slice();if(wt(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SQ(n,e,t,s){const r=F(n,"x","dropout");if(O(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),O(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof kt?r.clone():r;const i=IQ(r,t),o=1-e,a=Me(zh(pe(Wa(i,0,1,"float32",s),o)),o);return W(r,a)}const ST=j({dropout_:SQ});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kT(n){return Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))))}function Yw(n,e,t){const s=1-n%2,r=new Float32Array(n);for(let i=0;i<n;++i){const o=2*Math.PI*i/(n+s-1);r[i]=e-t*Math.cos(o)}return ss(r,"float32")}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function kQ(n,e,t=1){const s=F(n,"predictions","inTopK"),r=F(e,"targets","inTopK");O(s.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${s.rank}`),O(s.rank-1===r.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${s.rank} and targets rank ${r.rank}`),as(s.shape.slice(0,s.shape.length-1),r.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const i=s.shape[s.shape.length-1];O(t>0&&t<=i,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${i}), but got ${t}`);const o=await s.data(),a=await r.data(),[l,c]=[o.length/i,i],u=Hn("bool",l);for(let h=0;h<l;h++){const d=h*c,p=o.subarray(d,d+c),f=[];for(let g=0;g<p.length;g++)f.push({value:p[g],index:g});f.sort((g,m)=>m.value-g.value),u[h]=0;for(let g=0;g<t;g++)if(f[g].index===a[h]){u[h]=1;break}}return n!==s&&s.dispose(),e!==r&&r.dispose(),ir(u,r.shape,"bool")}const pL=kQ;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TQ(n,e,t,s,r,i="NHWC",o){let a=n;n.rank===3&&(a=G(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=G(e,[1,e.shape[0],e.shape[1],e.shape[2]])),O(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),O(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),O(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const c=i==="NHWC"?a.shape[3]:a.shape[1],u=i==="NHWC"?l.shape[3]:l.shape[1];O(c===t[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${t[2]}.`),O(u===t[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${t[3]}).`),As("conv2dDerFilter",r,o);const h={x:a,dy:l},d={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,filterShape:t};return B.runKernel(Sx,h,d)}const TT=j({conv2DBackpropFilter_:TQ});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qw(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return W(n,gc(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function Zw(n,e){let t=e;const s=An(n.shape,e.shape);return s.length>0&&(t=Pe(t,s)),G(t,n.shape)}function Jw(n,e,t,s){if(e==="linear")return n;if(e==="relu")return vi(n);if(e==="elu")return Lh(n);if(e==="relu6")return Fw(n);if(e==="prelu")return Fm(n,t);if(e==="leakyrelu")return Nm(n,s);if(e==="sigmoid")return oi(n);throw new Error(`Unknown fused activation ${e}.`)}const e0=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CQ({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(l=l||"linear",e0(B.state.gradientDepth,l)===!1){O(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let N=ko(n,e,t,s,r,i,o);return a!=null&&(N=pe(N,a)),Jw(N,l,c,u)}const h=F(n,"x","conv2d","float32"),d=F(e,"filter","conv2d","float32");let p=h,f=!1;h.rank===3&&(f=!0,p=G(h,[1,h.shape[0],h.shape[1],h.shape[2]])),O(p.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`),O(d.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${d.rank}.`),As("fused conv2d",s,o);const g=r==="NHWC"?p.shape[3]:p.shape[1];O(d.shape[2]===g,()=>`Error in conv2d: depth of input (${g}) must match input depth for filter ${d.shape[2]}.`),O(ls(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);const m=Kn(p.shape,d.shape,t,i,s,o);let y;a!=null&&(y=F(a,"bias","fused conv2d"),[y]=dn(y,h),r==="NHWC"?tt(m.outShape,y.shape):(O(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),O(y.shape.length===0||y.shape[0]===m.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${m.outChannels})`)));let w;if(c!=null){const N=c.shape;if(O(N.length<=1||N.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${N.length}.`),N.length===1)O(N[0]===1||N[0]===m.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${N}) is not compatible with the number of output channels (${m.outChannels}).`);else if(N.length===3)try{tt(N,m.outShape)}catch{const E=`Error in fused conv2d: PReLU activation weights (${N}) is not compatible with the output shape of the conv2d (${m.outShape}).`;throw Error(E)}w=F(c,"prelu weights","fused conv2d")}const v=(N,T)=>{O(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[E,k,S,A]=T,P=Qw(N,S,l);O(Ta(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const D=Fk(k.shape,P,E,t,s),V=TT(k,P,E.shape,t,s),U=[D,V];if(A!=null){const q=Zw(A,P);U.push(q)}return U},I={x:p,filter:d,bias:y,preluActivationWeights:w},_={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:u};return a==null?Yi((T,E,k)=>{let S=B.runKernel(Fp,I,_);return k([E,T,S]),f&&(S=G(S,[S.shape[1],S.shape[2],S.shape[3]])),{value:S,gradFunc:v}})(p,d):Yi((T,E,k,S)=>{let A=B.runKernel(Fp,I,_);return S([E,T,A,k]),f&&(A=G(A,[A.shape[1],A.shape[2],A.shape[3]])),{value:A,gradFunc:v}})(p,d,y)}const fL=j({fusedConv2d_:CQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EQ(n,e,t,s,r,i=[1,1],o){let a=n;n.rank===3&&(a=G(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=G(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:l},u={strides:s,pad:r,dimRoundingMode:o,dilations:i,filterShape:t};return B.runKernel(Ax,c,u)}const mL=j({depthwiseConv2dNativeBackpropFilter_:EQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Q(n,e,t,s,r,i=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=G(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:t},u={strides:s,pad:r,dimRoundingMode:o,dilations:i,inputShape:n},h=B.runKernel(Rx,c,u);return l?G(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const gL=j({depthwiseConv2dNativeBackpropInput_:_Q});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NQ({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(e0(B.state.gradientDepth,l)===!1){let _=Fh(n,e,t,s,r,i,o);return a!=null&&(_=pe(_,a)),Jw(_,l,c,u)}const h=F(n,"x","depthwiseConv2d","float32"),d=F(e,"filter","depthwiseConv2d","float32");let p=h,f=!1;h.rank===3&&(f=!0,p=G(h,[1,h.shape[0],h.shape[1],h.shape[2]])),O(p.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${p.rank}.`),O(d.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${d.rank}.`),O(p.shape[3]===d.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${p.shape[3]}) must match the inChannels dimension in filter ${d.shape[2]}.`),i==null&&(i=[1,1]),O(ls(t,i),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),As("fused depthwiseConv2d",s,o);const g=Kn(p.shape,d.shape,t,i,s,o,!0);let m;a!=null&&(m=F(a,"bias","fused conv2d"),[m]=dn(m,h),tt(g.outShape,m.shape));let y;c!=null&&(y=F(c,"prelu weights","fused depthwiseConv2d"));const w=(_,N)=>{O(Ta(i),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`);const[T,E,k,S]=N,A=Qw(_,k,l),P=gL(E.shape,A,T,t,s,i,o),D=mL(E,A,T.shape,t,s,i,o);if(S!=null){const V=Zw(m,A);return[P,D,V]}return[P,D]},v={x:p,filter:d,bias:m,preluActivationWeights:y},I={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:u};return a==null?Yi((N,T,E)=>{let k=B.runKernel(Lp,v,I);return E([T,N,k]),f&&(k=G(k,[k.shape[1],k.shape[2],k.shape[3]])),{value:k,gradFunc:w}})(p,d):Yi((N,T,E,k)=>{let S=B.runKernel(Lp,v,I);return k([T,N,S,E]),f&&(S=G(S,[S.shape[1],S.shape[2],S.shape[3]])),{value:S,gradFunc:w}})(p,d,m)}const AQ=j({fusedDepthwiseConv2d_:NQ});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RQ({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:r,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(e0(B.state.gradientDepth,i)===!1){let A=pt(n,e,t,s);return r!=null&&(A=pe(A,r)),Jw(A,i,o,a)}let l=F(n,"a","fused matMul"),c=F(e,"b","fused matMul");[l,c]=dn(l,c);const u=t?l.shape[l.rank-2]:l.shape[l.rank-1],h=s?c.shape[c.rank-1]:c.shape[c.rank-2],d=t?l.shape[l.rank-1]:l.shape[l.rank-2],p=s?c.shape[c.rank-2]:c.shape[c.rank-1],f=l.shape.slice(0,-2),g=c.shape.slice(0,-2),m=re(f),y=re(g);O(u===h,()=>`Error in fused matMul: inner shapes (${u}) and (${h}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${t} and transposeB=${s} must match.`);const v=tt(l.shape.slice(0,-2),c.shape.slice(0,-2)).concat([d,p]),I=t?G(l,[m,u,d]):G(l,[m,d,u]),_=s?G(c,[y,p,h]):G(c,[y,h,p]);let N;r!=null&&(N=F(r,"bias","fused matMul"),[N]=dn(N,l),tt(v,N.shape));let T;o!=null&&(T=F(o,"prelu weights","fused matMul"));const E=(A,P)=>{const[D,V,U,q]=P,J=Qw(G(A,U.shape),U,i);let K,ee;if(!t&&!s?(K=pt(J,V,!1,!0),ee=pt(D,J,!0,!1)):!t&&s?(K=pt(J,V,!1,!1),ee=pt(J,D,!0,!1)):t&&!s?(K=pt(V,J,!1,!0),ee=pt(D,J,!1,!1)):(K=pt(V,J,!0,!0),ee=pt(J,D,!0,!0)),r!=null){const L=Zw(q,J);return[K,ee,L]}else return[K,ee]},k={a:I,b:_,bias:N,preluActivationWeights:T},S={transposeA:t,transposeB:s,activation:i,leakyreluAlpha:a};return r==null?Yi((P,D,V)=>{const U=B.runKernel(Op,k,S);return V([P,D,U]),{value:G(U,v),gradFunc:E}})(I,_):Yi((P,D,V,U)=>{const q=B.runKernel(Op,k,S);return U([P,D,q,V]),{value:G(q,v),gradFunc:E}})(I,_,N)}const bI=j({fusedMatMul_:RQ});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yL=Object.freeze(Object.defineProperty({__proto__:null,conv2d:fL,depthwiseConv2d:AQ,matMul:bI},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Q(n){return Yw(n,.54,.46)}const DQ=j({hammingWindow_:$Q});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PQ(n){return Yw(n,.5,.5)}const bL=j({hannWindow_:PQ});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OQ(n,e,t,s=!1,r=0){let i=0;const o=[];for(;i+e<=n.size;)o.push(St(n,i,e)),i+=t;if(s)for(;i<n.size;){const a=i+e-n.size,l=xn([St(n,i,e-a),pc([a],r)]);o.push(l),i+=t}return o.length===0?fa([],[0,e]):G(xn(o),[o.length,e])}const xL=j({frame_:OQ});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FQ(n,e,t,s,r=bL){s==null&&(s=kT(e));const i=xL(n,e,t),o=W(i,r(e));return Bm(o,s)}const LQ=j({stft_:FQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MQ(n,e,t,s,r="bilinear",i=0){const o=F(n,"image","cropAndResize"),a=F(e,"boxes","cropAndResize","float32"),l=F(t,"boxInd","cropAndResize","int32"),c=a.shape[0];O(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),O(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`),O(l.rank===1&&l.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`),O(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),O(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),O(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const u={image:o,boxes:a,boxInd:l},h={method:r,extrapolationValue:i,cropSize:s};return B.runKernel(Ex,u,h)}const zQ=j({cropAndResize_:MQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VQ(n){const e=F(n,"image","flipLeftRight","float32");O(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return B.runKernel(Mx,t,{})}const BQ=j({flipLeftRight_:VQ});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jQ(n){const e=F(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];O(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),O(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,xr(e,r)}const UQ=j({grayscaleToRGB_:jQ});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WQ(n){const e=F(n,"image","RGBToGrayscale"),t=e.rank-1,s=e.shape[t];O(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),O(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,i=ve(e,"float32"),o=ss([.2989,.587,.114]);let a;switch(e.rank){case 2:a=hl("ij,j->i",i,o);break;case 3:a=hl("ijk,k->ij",i,o);break;case 4:a=hl("ijkl,l->ijk",i,o);break;case 5:a=hl("ijklm,m->ijkl",i,o);break;case 6:a=hl("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return a=es(a,-1),ve(a,r)}const GQ=j({rgbToGrayscale_:WQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HQ(n,e,t=0,s=.5){const r=F(n,"image","rotateWithOffset","float32");O(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const i={image:r},o={radians:e,fillValue:t,center:s};return B.runKernel(ww,i,o)}const qQ=j({rotateWithOffset_:HQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jh(n,e,t,s,r,i){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=n.shape[0];return t=Math.min(t,o),O(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),O(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),O(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),O(e.rank===1,()=>"scores must be a 1D tensor"),O(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),O(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KQ(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=F(n,"boxes","nonMaxSuppression","float32"),o=F(e,"scores","nonMaxSuppression","float32"),a=jh(i,o,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:t,iouThreshold:s,scoreThreshold:r};return B.runKernel(Kx,{boxes:i,scores:o},l)}const XQ=j({nonMaxSuppression_:KQ});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YQ(n,e,t){const s=QQ(n,e,t),r=s<0?-(s+1):s;n.splice(r,0,e)}function QQ(n,e,t){return JQ(n,e,t||ZQ)}function ZQ(n,e){return n>e?1:n<e?-1:0}function JQ(n,e,t){let s=0,r=n.length,i=0,o=!1;for(;s<r;){i=s+(r-s>>>1);const a=t(e,n[i]);a>0?s=i+1:(r=i,o=!a)}return o?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t0(n,e,t,s,r){return CT(n,e,t,s,r,0)}function n0(n,e,t,s,r,i){return CT(n,e,t,s,r,0,!1,i,!0)}function s0(n,e,t,s,r,i){return CT(n,e,t,s,r,i,!0)}function CT(n,e,t,s,r,i,o=!1,a=!1,l=!1){const c=[];for(let m=0;m<e.length;m++)e[m]>r&&c.push({score:e[m],boxIndex:m,suppressBeginIndex:0});c.sort(hR);const u=i>0?-.5/i:0,h=[],d=[];for(;h.length<t&&c.length>0;){const m=c.pop(),{score:y,boxIndex:w,suppressBeginIndex:v}=m;if(y<r)break;let I=!1;for(let _=h.length-1;_>=v;--_){const N=eZ(n,w,h[_]);if(N>=s){I=!0;break}if(m.score=m.score*tZ(s,u,N),m.score<=r)break}m.suppressBeginIndex=h.length,I||(m.score===y?(h.push(w),d.push(m.score)):m.score>r&&YQ(c,m,hR))}const p=h.length,f=t-p;a&&f>0&&(h.push(...new Array(f).fill(0)),d.push(...new Array(f).fill(0)));const g={selectedIndices:h};return o&&(g.selectedScores=d),l&&(g.validOutputs=p),g}function eZ(n,e,t){const s=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),i=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),c=Math.min(r[0],r[2]),u=Math.min(r[1],r[3]),h=Math.max(r[0],r[2]),d=Math.max(r[1],r[3]),p=(a-i)*(l-o),f=(h-c)*(d-u);if(p<=0||f<=0)return 0;const g=Math.max(i,c),m=Math.max(o,u),y=Math.min(a,h),w=Math.min(l,d),v=Math.max(y-g,0)*Math.max(w-m,0);return v/(p+f-v)}function tZ(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function hR(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function nZ(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=F(n,"boxes","nonMaxSuppressionAsync"),o=F(e,"scores","nonMaxSuppressionAsync"),a=jh(i,o,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([i.data(),o.data()]),c=l[0],u=l[1],{selectedIndices:h}=t0(c,u,t,s,r);return i!==n&&i.dispose(),o!==e&&o.dispose(),ss(h,"int32")}const sZ=nZ;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rZ(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=F(n,"boxes","nonMaxSuppression"),a=F(e,"scores","nonMaxSuppression"),l=jh(o,a,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const c={boxes:o,scores:a},u={maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i},h=B.runKernel(Yx,c,u);return{selectedIndices:h[0],selectedScores:h[1]}}const iZ=j({nonMaxSuppressionWithScore_:rZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function oZ(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=F(n,"boxes","nonMaxSuppressionAsync"),a=F(e,"scores","nonMaxSuppressionAsync"),l=jh(o,a,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const c=await Promise.all([o.data(),a.data()]),u=c[0],h=c[1],{selectedIndices:d,selectedScores:p}=s0(u,h,t,s,r,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:ss(d,"int32"),selectedScores:ss(p)}}const aZ=oZ;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lZ(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=F(n,"boxes","nonMaxSuppression"),a=F(e,"scores","nonMaxSuppression"),l=jh(o,a,t,s,r,null),c=l.maxOutputSize,u=l.iouThreshold,h=l.scoreThreshold,d={boxes:o,scores:a},p={maxOutputSize:c,iouThreshold:u,scoreThreshold:h,padToMaxOutputSize:i},f=B.runKernel(Xx,d,p);return{selectedIndices:f[0],validOutputs:f[1]}}const cZ=j({nonMaxSuppressionPadded_:lZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function uZ(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=F(n,"boxes","nonMaxSuppressionAsync"),a=F(e,"scores","nonMaxSuppressionAsync"),l=jh(o,a,t,s,r,null),c=l.maxOutputSize,u=l.iouThreshold,h=l.scoreThreshold,[d,p]=await Promise.all([o.data(),a.data()]),{selectedIndices:f,validOutputs:g}=n0(d,p,c,u,h,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:ss(f,"int32"),validOutputs:Ue(g,"int32")}}const hZ=uZ;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dZ(n,e,t=!1,s=!1){const r=F(n,"images","resizeBilinear");O(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),O(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),O(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=G(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},c=B.runKernel(um,a,l);return o?G(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const wL=j({resizeBilinear_:dZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pZ(n,e,t=!1,s=!1){const r=F(n,"images","resizeNearestNeighbor");O(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),O(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),O(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),O(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=G(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},c=B.runKernel(cm,a,l);return o?G(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const vL=j({resizeNearestNeighbor_:pZ});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fZ(n,e="binary",t=!1,s=.5){const r=F(n,"image","threshold"),i=.2989,o=.587,a=.114,l=r.shape[0]*r.shape[1];let c=W(ss([s]),255),u,h,d,p;if(O(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),O(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),O(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),O(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[u,h,d]=Bs(r,[1,1,1],-1);const m=W(u,i),y=W(h,o),w=W(d,a);p=pe(pe(m,y),w)}else p=n;if(e==="otsu"){const m=Ak(ve(Lw(p),"int32"),ir([]),256);c=mZ(m,l)}const f=t?Ua(p,c):Rs(p,c);return ve(W(f,255),"int32")}function mZ(n,e){let t=ss([-1]),s=ss([0]),r=ss([0]),i,o,a,l,c,u;for(let h=0;h<n.size-1;h++){i=St(n,0,h+1),o=St(n,h+1),c=Me(Pe(i),e),u=Me(Pe(o),e);const d=Pe(W(i,Hl(0,i.size)));a=Me(d,Pe(i));const p=pc(o.shape,i.size),f=pe(Hl(0,o.size),p),g=W(o,f);l=Me(Pe(g),Pe(o));const m=Ne(a,l),y=Ne(a,l),w=W(c,u);r=W(W(w,m),y);const v=Rs(r,s);s=Wn(v,r,s),t=Wn(v,ss([h]),t)}return t}const gZ=j({threshold_:fZ});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yZ(n,e,t="nearest",s="constant",r=0,i){const o=F(n,"image","transform","float32"),a=F(e,"transforms","transform","float32");O(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),O(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),O(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:o,transforms:a},c={interpolation:t,fillMode:s,fillValue:r,outputShape:i};return B.runKernel(bw,l,c)}const bZ=j({transform_:yZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xZ(n,e,t){const s=F(n,"a","bandPart");O(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[i,o]=s.shape.slice(-2);let a,l;typeof e=="number"?(O(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),O(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),a=F(e<0?i:e,"numLower","bandPart")):(O(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Wn(xu(e,0),i,Ca(e,i))),typeof t=="number"?(O(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),O(t<=o,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${o}).`),l=F(t<0?o:t,"numUpper","bandPart")):(O(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=Wn(xu(t,0),o,Ca(t,o)));const c=G(Hl(0,i,1,"int32"),[-1,1]),u=Hl(0,o,1,"int32"),h=Ne(c,u),d=Wr(Ua(h,a),Lo(h,Yt(l))),p=En([i,o],s.dtype);return G(Es(Er(G(s,[-1,i,o])).map(f=>Wn(d,f,p))),r)}const wZ=j({bandPart_:xZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vZ(n){let e;if(Array.isArray(n)){e=!1,O(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let i=1;i<n.length;++i)O(n[i].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[i].shape[0]} vs. ${r})`)}else e=!0,n=Bs(n,n.shape[0],0).map(r=>Ga(r,[0]));O(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let r=0;r<n.length;++r)t.push(B.tidy(()=>{let i=s[r];if(r>0)for(let o=0;o<r;++o){const a=W(Pe(W(t[o],i)),t[o]);i=Ne(i,a)}return Me(i,Mh(i,"euclidean"))}));return e?Es(t,0):t}const IZ=j({gramSchmidt_:vZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SZ(n,e=!1){if(O(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return dR(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((l,c)=>l*c),s=Er(G(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],i=[];s.forEach(l=>{const[c,u]=dR(l,e);r.push(c),i.push(u)});const o=G(Es(r,0),n.shape),a=G(Es(i,0),n.shape);return[o,a]}}function dR(n,e=!1){return B.tidy(()=>{O(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let r=Aw(t),i=Mi(n);const o=fa([[1]],[1,1]);let a=Mi(o);const l=t>=s?s:t;for(let c=0;c<l;++c){const u=i,h=a,d=r;[a,i,r]=B.tidy(()=>{const p=St(i,[c,c],[t-c,1]),f=Mh(p),g=St(i,[c,c],[1,1]),m=Wn(Rs(g,0),fa([[-1]]),fa([[1]])),y=Ne(g,W(m,f)),w=Me(p,y);w.shape[0]===1?a=Mi(o):a=xn([o,St(w,[1,0],[w.shape[0]-1,w.shape[1]])],0);const v=Yt(Me(pt(m,y),f)),I=St(i,[c,0],[t-c,s]),_=W(v,a),N=vt(a);if(c===0)i=Ne(I,pt(_,pt(N,I)));else{const k=Ne(I,pt(_,pt(N,I)));i=xn([St(i,[0,0],[c,s]),k],0)}const T=vt(_),E=St(r,[0,c],[t,r.shape[1]-c]);if(c===0)r=Ne(E,pt(pt(E,a),T));else{const k=Ne(E,pt(pt(E,a),T));r=xn([St(r,[0,0],[t,c]),k],1)}return[a,i,r]}),et([u,h,d])}return!e&&t>s&&(r=St(r,[0,0],[t,s]),i=St(i,[0,0],[s,s])),[r,i]})}const kZ=j({qr_:SZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ks;(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(ks||(ks={}));function TZ(n,e,t=ks.SUM_BY_NONZERO_WEIGHTS){const s=F(n,"losses","computeWeightedLoss");let r=null;e!=null&&(r=F(e,"weights","computeWeightedLoss"));const i=r==null?s:W(s,r);if(t===ks.NONE)return i;if(t===ks.SUM)return Pe(i);if(t===ks.MEAN){if(r==null)return un(i);{const o=s.size/r.size,a=Me(Pe(i),Pe(r));return o>1?Me(a,Ue(o)):a}}if(t===ks.SUM_BY_NONZERO_WEIGHTS){if(r==null)return Me(Pe(i),Ue(s.size));{const o=W(r,Vs(s.shape)),a=ve(Pe(Gl(o,Ue(0))),"float32");return Me(Pe(i),a)}}throw Error(`Unknown reduction: ${t}`)}const zo=j({computeWeightedLoss_:TZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CZ(n,e,t,s=ks.SUM_BY_NONZERO_WEIGHTS){const r=F(n,"labels","absoluteDifference"),i=F(e,"predictions","absoluteDifference");let o=null;t!=null&&(o=F(t,"weights","absoluteDifference")),as(r.shape,i.shape,"Error in absoluteDifference: ");const a=Tn(Ne(r,i));return zo(a,o,s)}const EZ=j({absoluteDifference_:CZ});function _Z(n,e,t,s,r=ks.SUM_BY_NONZERO_WEIGHTS){const i=F(n,"labels","cosineDistance"),o=F(e,"predictions","cosineDistance");let a=null;s!=null&&(a=F(s,"weights","cosineDistance")),as(i.shape,o.shape,"Error in cosineDistance: ");const l=Ue(1),c=Ne(l,Pe(W(i,o),t,!0));return zo(c,a,r)}const NZ=j({cosineDistance_:_Z});function AZ(n,e,t,s=ks.SUM_BY_NONZERO_WEIGHTS){let r=F(n,"labels","hingeLoss");const i=F(e,"predictions","hingeLoss");let o=null;t!=null&&(o=F(t,"weights","hingeLoss")),as(r.shape,i.shape,"Error in hingeLoss: ");const a=Ue(1);r=Ne(W(Ue(2),r),a);const l=vi(Ne(a,W(r,i)));return zo(l,o,s)}const RZ=j({hingeLoss_:AZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Z(n,e,t,s=1,r=ks.SUM_BY_NONZERO_WEIGHTS){const i=F(n,"labels","huberLoss"),o=F(e,"predictions","huberLoss");let a=null;t!=null&&(a=F(t,"weights","huberLoss")),as(i.shape,o.shape,"Error in huberLoss: ");const l=Ue(s),c=Tn(Ne(o,i)),u=Ca(c,l),h=Ne(c,u),d=pe(W(Ue(.5),jt(u)),W(l,h));return zo(d,a,r)}const DZ=j({huberLoss_:$Z});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PZ(n,e,t,s=1e-7,r=ks.SUM_BY_NONZERO_WEIGHTS){const i=F(n,"labels","logLoss"),o=F(e,"predictions","logLoss");let a=null;t!=null&&(a=F(t,"weights","logLoss")),as(i.shape,o.shape,"Error in logLoss: ");const l=Ue(1),c=Ue(s),u=Yt(W(i,lr(pe(o,c)))),h=W(Ne(l,i),lr(pe(Ne(l,o),c))),d=Ne(u,h);return zo(d,a,r)}const OZ=j({logLoss_:PZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FZ(n,e,t,s=ks.SUM_BY_NONZERO_WEIGHTS){const r=F(n,"labels","meanSquaredError"),i=F(e,"predictions","meanSquaredError");let o=null;t!=null&&(o=F(t,"weights","meanSquaredError")),as(r.shape,i.shape,"Error in meanSquaredError: ");const a=Gw(r,i);return zo(a,o,s)}const LZ=j({meanSquaredError_:FZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MZ(n,e){const t=F(n,"labels","sigmoidCrossEntropyWithLogits"),s=F(e,"logits","sigmoidCrossEntropyWithLogits");as(t.shape,s.shape,"Error in sigmoidCrossEntropyWithLogits: ");const r=vi(s),i=W(s,t),o=Am(qs(Yt(Tn(s))));return pe(Ne(r,i),o)}function zZ(n,e,t,s=0,r=ks.SUM_BY_NONZERO_WEIGHTS){let i=F(n,"multiClassLabels","sigmoidCrossEntropy");const o=F(e,"logits","sigmoidCrossEntropy");let a=null;if(t!=null&&(a=F(t,"weights","sigmoidCrossEntropy")),as(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),s>0){const c=Ue(s),u=Ue(1),h=Ue(.5);i=pe(W(i,Ne(u,c)),W(h,c))}const l=MZ(i,o);return zo(l,a,r)}const VZ=j({sigmoidCrossEntropy_:zZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BZ(n,e,t=-1){if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${t}`);return Yi((r,i,o)=>{const l=Rm(i,[t],!0),c=Ne(ve(i,"float32"),l);o([r,c]);const u=Yt(W(c,r));return{value:Pe(u,[t]),gradFunc:(p,f)=>{const[g,m]=f,y=wn(p.shape,[t]);return[W(G(p,y),Ne(ve(g,"float32"),qs(m))),W(G(p,y),Ne(qs(m),ve(g,"float32")))]}}})(n,e)}function jZ(n,e,t,s=0,r=ks.SUM_BY_NONZERO_WEIGHTS){let i=F(n,"onehotLabels","softmaxCrossEntropy");const o=F(e,"logits","softmaxCrossEntropy");let a=null;if(t!=null&&(a=F(t,"weights","softmaxCrossEntropy")),as(i.shape,o.shape,"Error in softmaxCrossEntropy: "),s>0){const c=Ue(s),u=Ue(1),h=Ue(i.shape[1]);i=pe(W(i,Ne(u,c)),Me(c,h))}const l=BZ(i,o);return zo(l,a,r)}const UZ=j({softmaxCrossEntropy_:jZ});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WZ(n,e,t,s){const r=F(n,"indices","sparseFillEmptyRows","int32"),i=F(e,"values","sparseFillEmptyRows"),o=F(t,"denseShape","sparseFillEmptyRows","int32"),a=F(s,"defaultValue","sparseFillEmptyRows",i.dtype);if(r.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${r.shape}`);if(i.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${i.shape}`);if(o.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${o.shape}`);if(a.rank!==0)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const l={indices:r,values:i,denseShape:o,defaultValue:a},c=B.runKernel(aw,l);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}const GZ=j({sparseFillEmptyRows_:WZ});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HZ(n,e,t){const s=F(n,"inputIndices","sparseReshape","int32"),r=F(e,"inputShape","sparseReshape","int32"),i=F(t,"newShape","sparseReshape","int32");if(s.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${s.shape}`);if(r.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${r.shape}`);if(i.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${i.shape}`);const o={inputIndices:s,inputShape:r,newShape:i},a=B.runKernel(lw,o);return{outputIndices:a[0],outputShape:a[1]}}const qZ=j({sparseReshape_:HZ});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KZ(n,e,t){const s=F(n,"data","sparseSegmentMean"),r=F(e,"indices","sparseSegmentMean","int32"),i=F(t,"segmentIds","sparseSegmentMean","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${r.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${i.shape}`);const o={data:s,indices:r,segmentIds:i};return B.runKernel(cw,o)}const XZ=j({sparseSegmentMean_:KZ});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YZ(n,e,t){const s=F(n,"data","sparseSegmentSum"),r=F(e,"indices","sparseSegmentSum","int32"),i=F(t,"segmentIds","sparseSegmentSum","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${r.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${i.shape}`);const o={data:s,indices:r,segmentIds:i};return B.runKernel(uw,o)}const QZ=j({sparseSegmentSum_:YZ});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZZ(n,e,t,s,r,i,o,a){const l=F(n,"data","stringNGrams","string");if(l.dtype!=="string")throw new Error("Data must be of datatype string");if(l.shape.length!==1)throw new Error(`Data must be a vector, saw: ${l.shape}`);const c=F(e,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const u={separator:t,nGramWidths:s,leftPad:r,rightPad:i,padWidth:o,preserveShortSequences:a},h={data:l,dataSplits:c},d=B.runKernel(fw,h,u);return{nGrams:d[0],nGramsSplits:d[1]}}const JZ=j({stringNGrams_:ZZ});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eJ(n,e,t=!0){const s=F(n,"input","stringSplit","string"),r=F(e,"delimiter","stringSplit","string");if(s.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${s.shape}`);if(r.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${r.shape}`);const i={skipEmpty:t},o={input:s,delimiter:r},a=B.runKernel(mw,o,i);return{indices:a[0],values:a[1],shape:a[2]}}const tJ=j({stringSplit_:eJ});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nJ(n,e){const t=F(n,"input","stringToHashBucketFast","string"),s={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const r={input:t};return B.runKernel(gw,r,s)}const sJ=j({stringToHashBucketFast_:nJ});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rJ(n,e,t,s=!0){const r=F(n,"input","staticRegexReplace","string"),i={pattern:e,rewrite:t,replaceGlobal:s};return B.runKernel(bm,{x:r},i)}const iJ=j({staticRegexReplace_:rJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IL={fft:Vm,ifft:Su,rfft:Bm,irfft:Ww},SL={hammingWindow:DQ,hannWindow:bL,frame:xL,stft:LQ},Vr={flipLeftRight:BQ,grayscaleToRGB:UQ,resizeNearestNeighbor:vL,resizeBilinear:wL,rgbToGrayscale:GQ,rotateWithOffset:qQ,cropAndResize:zQ,nonMaxSuppression:XQ,nonMaxSuppressionAsync:sZ,nonMaxSuppressionWithScore:iZ,nonMaxSuppressionWithScoreAsync:aZ,nonMaxSuppressionPadded:cZ,nonMaxSuppressionPaddedAsync:hZ,threshold:gZ,transform:bZ},ET={bandPart:wZ,gramSchmidt:IZ,qr:kZ},kL={absoluteDifference:EZ,computeWeightedLoss:zo,cosineDistance:NZ,hingeLoss:RZ,huberLoss:DZ,logLoss:OZ,meanSquaredError:LZ,sigmoidCrossEntropy:VZ,softmaxCrossEntropy:UZ},TL={sparseFillEmptyRows:GZ,sparseReshape:qZ,sparseSegmentMean:XZ,sparseSegmentSum:QZ},CL={stringNGrams:JZ,stringSplit:tJ,stringToHashBucketFast:sJ,staticRegexReplace:iJ};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oJ=new Map,xI=new Map;class yc{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class br{constructor(){this.classNameMap={}}static getMap(){return br.instance==null&&(br.instance=new br),br.instance}static register(e){br.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function me(n,e,t){O(n.className!=null,()=>"Class being registered does not have the static className property defined."),O(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),O(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const s=t,r=e+">"+s;return br.register(n),oJ.set(r,n),xI.set(n,r),n}function aJ(n){return xI.has(n)?xI.get(n):n.className}const lJ=Object.freeze(Object.defineProperty({__proto__:null,Serializable:yc,SerializationMap:br,getRegisteredName:aJ,registerClass:me},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vo extends yc{minimize(e,t=!1,s){const{value:r,grads:i}=this.computeGradients(e,s);if(s!=null){const o=s.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(o)}else this.applyGradients(i);return et(i),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return RF(e,t)}dispose(){this.iterations_!=null&&et(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Ue(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Vo,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _T extends Vo{static get className(){return"Adadelta"}constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=B.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=B.registeredVariables[s],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:Y(()=>Ct(i).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:Y(()=>Ct(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,c=this.accumulatedUpdates[r].variable;Y(()=>{const u=pe(W(l,this.rho),W(jt(a),1-this.rho)),h=W(Me(os(pe(c,this.epsilon)),os(pe(l,this.epsilon))),a),d=pe(W(c,this.rho),W(jt(h),1-this.rho));l.assign(u),c.assign(d);const p=pe(W(h,-this.learningRate),i);i.assign(p)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(et(this.accumulatedGrads.map(e=>e.variable)),et(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NT extends Vo{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=B.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:Y(()=>pc(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const a=this.accumulatedGrads[r].variable;Y(()=>{const l=pe(a,jt(o));a.assign(l);const c=pe(W(Me(o,os(pe(l,B.backend.epsilon()))),-this.learningRate),i);i.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&et(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AT extends Vo{static get className(){return"Adam"}constructor(e,t,s,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Y(()=>{this.accBeta1=Ue(t).variable(),this.accBeta2=Ue(s).variable()}),r==null&&(this.epsilon=B.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);Y(()=>{const s=Ne(1,this.accBeta1),r=Ne(1,this.accBeta2);t.forEach((i,o)=>{const a=B.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:Y(()=>Ct(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:Y(()=>Ct(a).variable(l))});const c=Array.isArray(e)?e[o].tensor:e[i];if(c==null)return;const u=this.accumulatedFirstMoment[o].variable,h=this.accumulatedSecondMoment[o].variable,d=pe(W(u,this.beta1),W(c,1-this.beta1)),p=pe(W(h,this.beta2),W(jt(c),1-this.beta2)),f=Me(d,s),g=Me(p,r);u.assign(d),h.assign(p);const m=pe(W(Me(f,pe(os(g),this.epsilon)),-this.learningRate),a);a.assign(m)}),this.accBeta1.assign(W(this.accBeta1,this.beta1)),this.accBeta2.assign(W(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&et(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&et(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),Y(()=>{this.accBeta1.assign(To(this.beta1,this.iterations_+1)),this.accBeta2.assign(To(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RT extends Vo{static get className(){return"Adamax"}constructor(e,t,s,r=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Y(()=>{this.iteration=Ue(0).variable(),this.accBeta1=Ue(t).variable()}),r==null&&(this.epsilon=B.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);Y(()=>{const s=Ne(1,this.accBeta1),r=Me(-this.learningRate,pe(W(this.iteration,this.decay),1));t.forEach((i,o)=>{const a=B.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:Ct(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:Ct(a).variable(l)});const c=Array.isArray(e)?e[o].tensor:e[i];if(c==null)return;const u=this.accumulatedFirstMoment[o].variable,h=this.accumulatedWeightedInfNorm[o].variable,d=pe(W(u,this.beta1),W(c,1-this.beta1)),p=W(h,this.beta2),f=Tn(c),g=to(p,f);u.assign(d),h.assign(g);const m=pe(W(Me(r,s),Me(d,pe(g,this.epsilon))),a);a.assign(m)}),this.iteration.assign(pe(this.iteration,1)),this.accBeta1.assign(W(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&et(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&et(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class r0 extends Vo{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const o=B.registeredVariables[s];Y(()=>{const a=pe(W(this.c,i),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Pn(Ue(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $T extends r0{static get className(){return"Momentum"}constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=Ue(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=B.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:Y(()=>Ct(i).variable(!1))});const o=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&Y(()=>{let l;const c=pe(W(this.m,o),a);this.useNesterov?l=pe(W(this.c,pe(a,W(c,this.m))),i):l=pe(W(this.c,c),i),o.assign(c),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&et(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DT extends Vo{static get className(){return"RMSProp"}constructor(e,t=.9,s=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,r==null&&(this.epsilon=B.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=B.registeredVariables[s],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:Y(()=>Ct(i).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:Y(()=>Ct(i).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:Y(()=>Ct(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,c=this.accumulatedMoments[r].variable;Y(()=>{const u=pe(W(l,this.decay),W(jt(a),1-this.decay));if(this.centered){const h=this.accumulatedMeanGrads[r].variable,d=pe(W(h,this.decay),W(a,1-this.decay)),p=Me(W(a,this.learningRate),os(Ne(u,pe(jt(d),this.epsilon)))),f=pe(W(c,this.momentum),p);l.assign(u),h.assign(d),c.assign(f);const g=Ne(i,f);i.assign(g)}else{const h=pe(W(l,this.decay),W(jt(a),1-this.decay)),d=pe(W(c,this.momentum),Me(W(a,this.learningRate),os(pe(h,this.epsilon))));l.assign(h),c.assign(d);const p=Ne(i,d);i.assign(p)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&et(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&et(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&et(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cJ=[_T,NT,AT,RT,$T,DT,r0];function uJ(){for(const n of cJ)me(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hJ="model",dJ=".json",pJ=".weights.bin";function pR(n){return new Promise(e=>setTimeout(e)).then(n)}class ql{constructor(e){if(!X().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(ql.URL_SCHEME)&&(e=e.slice(ql.URL_SCHEME.length)),(e==null||e.length===0)&&(e=hJ),this.modelJsonFileName=e+dJ,this.weightDataFileName=e+pJ}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const t=wi.join(e.weightData),s=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=uF(e,r),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),a=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=o,await pR(()=>a.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){const l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;l.download=this.weightDataFileName,l.href=s,await pR(()=>l.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Sm(e)}}}}ql.URL_SCHEME="downloads://";class fJ{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,t)=>{const s=new FileReader;s.onload=r=>{const i=JSON.parse(r.target.result),o=i.modelTopology;if(o==null){t(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(i.weightsManifest==null){t(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:o});return}const l=pk(i,c=>this.loadWeights(c));e(l)},s.onerror=r=>t(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),s.readAsText(this.jsonFile)})}loadWeights(e){const t=[],s=[];for(const o of e)t.push(...o.weights),s.push(...o.paths);const r=this.checkManifestAndWeightFiles(e),i=s.map(o=>this.loadWeightsFile(o,r[o]));return Promise.all(i).then(o=>[t,o])}loadWeightsFile(e,t){return new Promise((s,r)=>{const i=new FileReader;i.onload=o=>{const a=o.target.result;s(a)},i.onerror=o=>r(`Failed to weights data from file of path '${e}'.`),i.readAsArrayBuffer(t)})}checkManifestAndWeightFiles(e){const t=[],s=this.weightsFiles.map(i=>uR(i.name)),r={};for(const i of e)i.paths.forEach(o=>{const a=uR(o);if(t.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(t.push(a),s.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);r[o]=this.weightsFiles[s.indexOf(a)]});if(t.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${t.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}const mJ=n=>X().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ql.URL_SCHEME)?gJ(n.slice(ql.URL_SCHEME.length)):null;cn.registerSaveRouter(mJ);function gJ(n="model"){return new ql(n)}function yJ(n){return new fJ(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fR(n,e,t,s){o(n),t=t??0,s=s??1,a(t,s);let r=0;const i=l=>(l.then(c=>{const u=t+ ++r/n.length*(s-t);return e(u),c}),l);function o(l){O(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,c){O(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),O(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),O(c>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${c}`)}return Promise.all(n.map(i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function EL(n,e){e==null&&(e={});const t=e.fetchFunc==null?X().platform.fetch:e.fetchFunc,s=n.map(h=>t(h,e.requestInit,{isBinary:!0})),r=0,i=.5,a=(e.onProgress==null?await Promise.all(s):await fR(s,e.onProgress,r,i)).map(h=>h.arrayBuffer()),l=.5,c=1;return e.onProgress==null?await Promise.all(a):await fR(a,e.onProgress,l,c)}async function _L(n,e="",t,s){return NL(o=>EL(o,{requestInit:s}))(n,e,t)}function NL(n){return async(e,t="",s)=>{const r=e.map(()=>!1),i={},o=s!=null?s.map(()=>!1):[],a=[];if(e.forEach((p,f)=>{let g=0;p.weights.forEach(m=>{const y="quantization"in m?m.quantization.dtype:m.dtype,w=hI[y]*re(m.shape),v=()=>{r[f]=!0,i[f]==null&&(i[f]=[]),i[f].push({manifestEntry:m,groupOffset:g,sizeBytes:w})};s!=null?s.forEach((I,_)=>{I===m.name&&(v(),o[_]=!0)}):v(),a.push(m.name),g+=w})}),!o.every(p=>p)){const p=s.filter((f,g)=>!o[g]);throw new Error(`Could not find weights in manifest with names: ${p.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}const l=r.reduce((p,f,g)=>(f&&p.push(g),p),[]),c=[];l.forEach(p=>{e[p].paths.forEach(f=>{const g=t+(t.endsWith("/")?"":"/")+f;c.push(g)})});const u=await n(c),h={};let d=0;return l.forEach(p=>{const f=e[p].paths.length,g=new wi(u.slice(d,d+f));i[p].forEach(y=>{const w=g.slice(y.groupOffset,y.groupOffset+y.sizeBytes),v=uk(w,[y.manifestEntry]);for(const I in v)h[I]=v[I]}),d+=f}),h}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bJ="application/octet-stream",xJ="application/json";class PT{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(O(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=X().platform.fetch,O(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&O(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=uF(e,s);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:xJ}),"model.json"),e.weightData!=null){const o=wi.join(e.weightData);t.body.append("model.weights.bin",new Blob([o],{type:bJ}),"model.weights.bin")}const i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:Sm(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async load(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const s=t.modelTopology,r=t.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return pk(t,i=>this.loadWeights(i))}async loadWeights(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=wJ(t),i=this.weightPathPrefix||s,o=fk(e),a=[],l=[];for(const u of e)for(const h of u.paths)this.weightUrlConverter!=null?l.push(this.weightUrlConverter(h)):a.push(i+h+r);this.weightUrlConverter&&a.push(...await Promise.all(l));const c=await EL(a,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[o,c]}}PT.URL_SCHEME_REGEX=/^https?:\/\//;function wJ(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),s=n.substring(0,e),r=t>e?n.substring(t):"";return[s+"/",r]}function wI(n){return n.match(PT.URL_SCHEME_REGEX)!=null}const AL=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(s=>wI(s)):t=wI(n),t)return OT(n,e)}return null};cn.registerSaveRouter(AL);cn.registerLoadRouter(AL);function OT(n,e){return new PT(n,e)}function RL(n,e){return OT(n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zv{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class $L{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}}class vJ{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=t=>Promise.resolve(e.save(t)))}}function IJ(n,e,t,s){const r=arguments;return new vJ(ub(...r))}function ub(n,e,t,s){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new zv(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new zv({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new zv({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:s}))}function SJ(n){return new $L(n)}function kJ(n){return new $L(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FT=Object.freeze(Object.defineProperty({__proto__:null,CompositeArrayBuffer:wi,browserFiles:yJ,browserHTTPRequest:RL,concatenateArrayBuffers:cF,copyModel:G8,decodeWeights:uk,encodeWeights:dI,fromMemory:IJ,fromMemorySync:ub,getLoadHandlers:dF,getModelArtifactsForJSON:pk,getModelArtifactsForJSONSync:dk,getModelArtifactsInfoForJSON:Sm,getSaveHandlers:hF,getWeightSpecs:fk,http:OT,isHTTPScheme:wI,listModels:U8,loadWeights:_L,moveModel:H8,registerLoadRouter:R8,registerSaveRouter:A8,removeModel:W8,weightsLoaderFactory:NL,withSaveHandler:SJ,withSaveHandlerSync:kJ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TJ(n,e,t){const s=F(n,"labels","confusionMatrix"),r=F(e,"predictions","confusionMatrix");O(t==null||t>0&&Number.isInteger(t),()=>`If provided, numClasses must be a positive integer, but got ${t}`),O(s.rank===1,()=>`Expected the rank of labels to be 1, but got ${s.rank}`),O(r.rank===1,()=>`Expected the rank of predictions to be 1, but got ${r.rank}`),O(s.shape[0]===r.shape[0],()=>`Mismatch in the number of examples: ${s.shape[0]} vs. ${r.shape[0]}. Labels and predictions should have the same number of elements.`),O(t>0&&Number.isInteger(t),()=>`numClasses is required to be a positive integer, but got ${t}`);const i=wu(ve(s,"int32"),t),o=wu(ve(r,"int32"),t),a=vt(i),l=pt(a,o);return ve(l,"int32")}const CJ=j({confusionMatrix_:TJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EJ=Object.freeze(Object.defineProperty({__proto__:null,confusionMatrix:CJ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let nl,mR=!1;function DL(n,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let t=!1,s=!1,r=!1,i=!1,o=!1,a=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)s=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)r=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)i=!0;else if(n.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&n instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${n.constructor.name}`);if(zp(rb,B.backendName)!=null){const f={pixels:n},g={numChannels:e};return B.runKernel(rb,f,g)}const[c,u]=r?[n.videoWidth,n.videoHeight]:[n.width,n.height];let h;if(o)h=n.getContext("2d").getImageData(0,0,c,u).data;else if(s||t)h=n.data;else if(i||r||a){if(nl==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")nl=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else nl=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});nl.canvas.width=c,nl.canvas.height=u,nl.drawImage(n,0,0,c,u),h=nl.getImageData(0,0,c,u).data}let d;if(e===4)d=new Int32Array(h);else{const f=c*u;d=new Int32Array(f*e);for(let g=0;g<f;g++)for(let m=0;m<e;++m)d[g*e+m]=h[g*4+m]}return yT(d,[u,c,e],"int32")}function _J(n){return n!=null&&n.data instanceof Uint8Array}function NJ(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function AJ(n){return n!=null&&n.width!==0&&n.height!==0}function RJ(n){return NJ()&&!(n instanceof ImageBitmap)&&AJ(n)&&!_J(n)}async function PL(n,e=3){let t=null;if(X().getBool("WRAP_TO_IMAGEBITMAP")&&RJ(n)){let s;try{s=await createImageBitmap(n,{premultiplyAlpha:"none"})}catch{s=null}s!=null&&s.width===n.width&&s.height===n.height?t=s:t=n}else t=n;return DL(t,e)}function OL(n){if(n.rank!==2&&n.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const e=n.rank===2?1:n.shape[2];if(e>4||e===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${e}`);if(n.dtype!=="float32"&&n.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`)}function $J(n){const e=(n==null?void 0:n.alpha)||1;if(e>1||e<0)throw new Error(`Alpha value ${e} is suppoed to be in range [0 - 1].`)}async function DJ(n,e){let t=F(n,"img","toPixels");if(!(n instanceof kt)){const c=t;t=ve(c,"int32"),c.dispose()}OL(t);const[s,r]=t.shape.slice(0,2),i=t.rank===2?1:t.shape[2],o=await t.data(),a=t.dtype==="float32"?255:1,l=new Uint8ClampedArray(r*s*4);for(let c=0;c<s*r;++c){const u=[0,0,0,255];for(let d=0;d<i;d++){const p=o[c*i+d];if(t.dtype==="float32"){if(p<0||p>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${p}.`)}else if(t.dtype==="int32"&&(p<0||p>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${p}.`);i===1?(u[0]=p*a,u[1]=p*a,u[2]=p*a):u[d]=p*a}const h=c*4;l[h+0]=Math.round(u[0]),l[h+1]=Math.round(u[1]),l[h+2]=Math.round(u[2]),l[h+3]=Math.round(u[3])}if(e!=null){mR||zp(Dx,B.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),mR=!0),e.width=r,e.height=s;const c=e.getContext("2d"),u=new ImageData(l,r,s);c.putImageData(u,0,0)}return t!==n&&t.dispose(),l}function PJ(n,e,t){let s=F(n,"img","draw");if(!(n instanceof kt)){const o=s;s=ve(o,"int32"),o.dispose()}OL(s),$J(t==null?void 0:t.imageOptions);const r={image:s},i={canvas:e,options:t};B.runKernel(Dx,r,i)}const FL=j({fromPixels_:DL}),OJ=Object.freeze(Object.defineProperty({__proto__:null,draw:PJ,fromPixels:FL,fromPixelsAsync:PL,toPixels:DJ},Symbol.toStringTag,{value:"Module"}));function i0(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(re(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,i=r[r.length-1];let o=1;for(let h=0;h<r.length-1;++h)o*=r[h];const a=n.shape,l=r.slice();l.pop();let c=1;for(let h=i;h<t;++h)c*=a[h],l.push(a[h]);const u=[...Be(n.shape).map(h=>h/c),1].slice(0,i);return[l,o,c,u]}const FJ=Object.freeze(Object.defineProperty({__proto__:null,prepareAndValidate:i0},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vI=-2,LJ=-1;function LT(n,e,t){const s=n.shape.length;O(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),O(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)O(e[r]+t[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function MJ(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function MT(n,e,t){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((e[r]-n[r])/t[r]);return s}function LL(n,e,t,s){const r=[...n];for(let i=r.length;i<s.length;i++)r.push(1);for(let i=0;i<t;i++)i===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function ML(n,e,t){return t<=n?t:t-(e-1)}function zL(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function zJ(n,e,t,s,r,i,o,a,l){const c=n.length;let u=new Array(c),h=new Array(c),d=new Array(c);if(e.length&&t>0){const p=e[0],f=t+1;u=VL(o,p,f,s,n),h=BL(a,p,f,r,n),d=LL(i,p,f,n)}else for(let p=0;p<c;p++)u[p]=UL(o,s,i,n,p,l),h[p]=WL(a,r,i,n,p,l),d[p]=jL(i,p,l);return{begin:u,end:h,strides:d}}function VL(n,e,t,s,r){const i=[...r],o=zL(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=0;else{const l=ML(e,t,a);let c=s[l];n&1<<l&&(c=0),i[a]=c}return i}function BL(n,e,t,s,r){const i=[...r],o=zL(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{const l=ML(e,t,a);let c=s[l];n&1<<l&&(c=Number.MAX_SAFE_INTEGER),i[a]=c}for(let a=0;a<i.length;a++){const l=r[a];i[a]<0&&(i[a]+=l),i[a]=Sa(0,i[a],r[a])}return i}function jL(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function UL(n,e,t,s,r,i){let o=e[r];const a=t[r]||1;(n&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),o=Sa(0,o,l-1),o}function WL(n,e,t,s,r,i){let o=e[r];const a=t[r]||1;(n&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),a>0?o=Sa(0,o,l):o=Sa(-1,o,l-1),o}function zT(n,e,t){let s=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){s=r;break}for(let r=s+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function VT(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function o0(n,e,t){let s;const r=n.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(o=>{O(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(r).fill(-1):typeof t=="number"?i=[t,...new Array(r-1).fill(-1)]:t.length<r?i=t.concat(new Array(r-t.length).fill(-1)):i=t,i=i.map((o,a)=>o>=0?o:(O(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),n.shape[a]-s[a])),[s,i]}function BT(n,e,t,s,r,i,o,a,l){let c;if(s==null?(c=new Array(e.length),c.fill(1)):c=s,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const h={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:c.slice(),beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let v=0;v<h.dims;v++)u&&1<<v&a&&h.numAddAxisAfterEllipsis++,1<<v&o&&(u=!0);u||(h.ellipsisMask|=1<<h.dims,h.dims++);const d={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};VJ(h,d);let p=!0,f=!0,g=!0;const m=[],y=[];for(let v=0;v<n.length;++v){if(d.strides[v]===0)throw Error(`strides[${v}] must be non-zero`);const I=!!(d.shrinkAxisMask&1<<v),_=n[v];if(_===-1){m.push(I?1:-1);continue}const N=[d.beginMask&1<<v,d.endMask&1<<v],T=[d.strides[v]>0?0:-1,d.strides[v]>0?_:_-1];if(I&&d.strides[v]<=0)throw Error("only stride 1 allowed on non-range indexing.");g=g&&d.strides[v]===1;const E=!!(d.beginMask&1<<v&&d.endMask&1<<v);if(d.beginValid&&d.endValid){if(I){const P=d.begin[v]<0?_+d.begin[v]:d.begin[v];if(d.begin[v]=P,d.end[v]=d.begin[v]+1,P<0||P>=_)throw Error(`slice index ${d.begin[v]} of dimension ${v} out of bounds.`)}else d.begin[v]=gR(d.begin[v],0,d.strides[v],_,N,T),d.end[v]=gR(d.end[v],1,d.strides[v],_,N,T);const A=d.strides[v]===1&&d.begin[v]===0&&d.end[v]===_;p=p&&A,f=f&&(v===0&&d.strides[v]===1||A)}else p=p&&d.strides[v]===1&&E,f=f&&(v===0&&d.strides[v]===1||E);let k,S=!1;if(d.beginValid&&d.endValid?(k=d.end[v]-d.begin[v],S=!0):I?(k=1,S=!0):E&&_>=0&&(d.strides[v]<0?k=-_:k=_,S=!0),S){let A;k===0||k<0!=d.strides[v]<0?A=0:A=Math.trunc(k/d.strides[v])+(k%d.strides[v]!==0?1:0),m.push(A)}else m.push(-1)}for(let v=0;v<d.finalShapeGatherIndices.length;++v){const I=d.finalShapeGatherIndices[v];I>=0?y.push(m[I]):I===vI&&y.push(1)}return{finalShapeSparse:y.filter((v,I)=>d.finalShapeGatherIndices[I]!==vI),finalShape:y,isIdentity:p,sliceDim0:f,isSimpleSlice:g,begin:d.begin,end:d.end,strides:d.strides}}function VJ(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(vI),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(LJ),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function gR(n,e,t,s,r,i){if(r[e])return t>0?i[e]:i[e+1&1];{const o=n<0?s+n:n;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const GL=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:LT,computeFlatOffset:VT,computeOutShape:MT,getNormalizedAxes:zJ,isSliceContinous:zT,maskToAxes:MJ,parseSliceParams:o0,sliceInfo:BT,startForAxis:UL,startIndicesWithElidedDims:VL,stopForAxis:WL,stopIndicesWithElidedDims:BL,stridesForAxis:jL,stridesWithElidedDims:LL},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. */const HL="4.11.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qL{static sgd(e){return new r0(e)}static momentum(e,t,s=!1){return new $T(e,t,s)}static rmsprop(e,t=.9,s=0,r=null,i=!1){return new DT(e,t,s,r,i)}static adam(e=.001,t=.9,s=.999,r=null){return new AT(e,t,s,r)}static adadelta(e=.001,t=.95,s=null){return new _T(e,t,s)}static adamax(e=.002,t=.9,s=.999,r=null,i=0){return new RT(e,t,s,r,i)}static adagrad(e,t=.1){return new NT(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const al=qL;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BJ=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n())();function jT(){return new Promise(n=>BJ(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UT(n,e){const t=n[0].length;n.forEach((r,i)=>{O(r.length===t,()=>`Error in concat${t}D: rank of tensors[${i}] must be the same as the rank of the rest (${t})`)}),O(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((r,i)=>{for(let o=0;o<t;o++)O(o===e||r[o]===s[o],()=>`Error in concat${t}D: Shape of tensors[${i}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${i}.`)})}function zi(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ti;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(ti||(ti={}));function KL(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let r=1;r<t.length;++r){const i=t[r],o=s[s.length-t.length+r],a=s[o];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${i} but shape[${r+n}] = ${a}`)}else s[o]=i}return s}function XL(n){const e={FIRST_DIM_SIZE:ti.FIRST_DIM_SIZE,VALUE_ROWIDS:ti.VALUE_ROWIDS,ROW_LENGTHS:ti.ROW_LENGTHS,ROW_SPLITS:ti.ROW_SPLITS,ROW_LIMITS:ti.ROW_LIMITS,ROW_STARTS:ti.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function YL(n){return n.length===0?0:n[0]===ti.FIRST_DIM_SIZE?n.length-1:n.length}function QL(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(t,s-1);++r){const i=n[r],o=e[r+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${i} but ragged tensor input.flatValues.shape[${r-n.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WT=30;function a0(n){return n<=WT?n:tb(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GT(n,e,t){const s=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jm(n,e,t,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const i=e.length;for(let o=0;o<i;++o)r=r.concat([n[o+1]/e[o],e[o]]);r=r.concat(n.slice(i+1))}return r}function Um(n,e,t=!0){const s=[];if(t){s.push(e);for(let r=e+1;r<n;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],i=[];for(let o=1;o<n;++o)o>=e*2+1||o%2===1?i.push(o):r.push(o);s.push(...r),s.push(0),s.push(...i)}return s}function Wm(n,e,t,s=!0){const r=[];s?r.push(n[0]/t):r.push(n[0]*t);for(let i=1;i<n.length;++i)i<=e.length?s?r.push(e[i-1]*n[i]):r.push(n[i]/e[i-1]):r.push(n[i]);return r}function HT(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function qT(n,e,t){const s=n.slice(0,1);for(let r=0;r<t;++r)s.push(n[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l0=1.7580993408473768,c0=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KT=.3275911,XT=.254829592,YT=-.284496736,QT=1.421413741,ZT=-1.453152027,JT=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Co(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function ZL(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function JL(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function eM(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function eC(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function tM(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function nM(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const i=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(i),s[r]=Math.sin(i)}return{real:t,imag:s}}function sM(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),r=Math.cos(s),i=Math.sin(s);return{real:r,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vv="->",jJ=/->/g,yR=",",bR="...";function tC(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(jJ,"").length)/Vv.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${Vv}").`);const[s,r]=n.split(Vv);O(s.indexOf(bR)===-1,()=>`The ellipsis notation ("${bR}") is not supported yet.`);const i=s.split(yR),o=i.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let d=0;d<r.length;++d){const p=r[d];if(!i.some(f=>f.indexOf(p)!==-1))throw new Error(`Output subscripts contain the label ${p} not present in the input subscripts.`);a.indexOf(p)===-1&&a.push(p)}for(let d=0;d<s.length;++d){const p=s[d];a.indexOf(p)===-1&&p!==yR&&a.push(p)}const l=new Array(i.length);for(let d=0;d<o;++d){if(new Set(i[d].split("")).size!==i[d].length)throw new Error(`Found duplicate axes in input component ${i[d]}. Support for duplicate axes in input is not implemented yet.`);l[d]=[];for(let p=0;p<i[d].length;++p)l[d].push(a.indexOf(i[d][p]))}const c=a.length,u=r.length,h=[];for(let d=u;d<c;++d)h.push(d);return{allDims:a,summedDims:h,idDims:l}}function nC(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const s=[];for(let r=0;r<n;++r)t[r]===-1&&s.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:s}}function sC(n,e,t){const s=new Array(n);for(let r=0;r<t.length;++r){const i=t[r].shape;for(let o=0;o<e[r].length;++o)s[e[r][o]]===void 0?s[e[r][o]]=i[o]:O(s[e[r][o]]===i[o],()=>`Expected dimension ${s[e[r][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function rC(n,e){const t=n,s=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let o=0;o<r;++o)s.push([]);const i=[];for(let o=0;o<t.length;++o){const a=t[o],l=UJ(e,a);for(const c of l)i.indexOf(c)===-1&&(s[o].push(c),i.push(c))}return{path:t,steps:s}}function iC(n){return n.every((e,t)=>e===t)}function UJ(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function oC(n,e,t=0){let s=[];if(typeof e=="number")O(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);O(r<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[i]=n.shape[t]-o}O(n.shape[t]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rM(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function iM(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function oM(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aM(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function lM(n,e){return`size ${n} must be non-negative, not ${e}`}function cM(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function uM(n,e){const t=re(n),s=re(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function hM(n,e){const t=re(n),s=re(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function II(){return"segment ids must be >= 0"}function dM(){return"segment ids are not increasing"}function pM(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function fM(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mM(n,e){let t=!1,s;for(n<=WT?(s=n,t=!0):s=tb(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=tb(n,s+1);return s}function gM(n,e,t){const s=[],r=n.length;for(let i=0;i<r;i++)i!==e?s.push(n[i]):s.push(t);return s}function aC(n,e,t,s){const r=e.shape.length,i=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>i)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${i}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let h=0;h<s;++h)if(n.shape[h]!==e.shape[h])throw new Error(`x.shape[${h}]: ${n.shape[h]} should be equal to indices.shape[${h}]: ${e.shape[h]}.`);const o=n.shape[t],a=[];let l=1,c=1,u=1;for(let h=0;h<s;++h)a.push(n.shape[h]),l*=n.shape[h];for(let h=s;h<t;h++)a.push(n.shape[h]),c*=n.shape[h];for(let h=s;h<r;h++)a.push(e.shape[h]);for(let h=t+1;h<i;h++)a.push(n.shape[h]),u*=n.shape[h];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:o,outputShape:a}}const WJ=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:aC,computeOutShape:gM,segOpComputeOptimalWindowSize:mM},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eo(n){try{return n.map(e=>vo(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function yM(n){return n.map(e=>Li(e))}const bM=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:XT,ERF_A2:YT,ERF_A3:QT,ERF_A4:ZT,ERF_A5:JT,ERF_P:KT,PARALLELIZE_THRESHOLD:WT,get RowPartitionType(){return ti},SELU_SCALE:c0,SELU_SCALEALPHA:l0,applyActivation:Jw,assertAndGetBroadcastShape:tt,assertAxesAreInnerMostDims:cs,assertParamsConsistent:UT,assignToTypedArray:tM,axesAreInnerMostDims:Wk,calculateShapes:Ha,checkEinsumDimSizes:sC,checkPadOnDimRoundingMode:As,combineLocations:_F,combineRaggedTensorToTensorShapes:KL,complexWithEvenIndex:JL,complexWithOddIndex:eM,computeConv2DInfo:Kn,computeConv3DInfo:Ba,computeDefaultPad:Tk,computeDilation2DInfo:km,computeOptimalWindowSize:a0,computeOutAndReduceShapes:Xn,computeOutShape:zi,computePool2DInfo:Hr,computePool3DInfo:Oo,convertConv2DDataFormat:Fo,decodeEinsumEquation:tC,eitherStridesOrDilationsAreOne:ls,expandShapeToKeepDim:wn,exponent:sM,exponents:nM,fromStringArrayToUint8:yM,fromUint8ToStringArray:Eo,getAxesPermutation:pn,getBroadcastDims:Wl,getComplexWithIndex:eC,getEinsumComputePath:rC,getEinsumPermutation:nC,getFusedBiasGradient:Zw,getFusedDyActivation:Qw,getImageCenter:GT,getInnerMostAxes:vn,getPermuted:Um,getRaggedRank:YL,getReductionAxes:An,getReshaped:jm,getReshapedPermuted:Wm,getRowPartitionTypesHelper:XL,getSliceBeginCoords:HT,getSliceSize:qT,getSparseFillEmptyRowsIndicesDenseShapeMismatch:rM,getSparseFillEmptyRowsNegativeIndexErrorMessage:iM,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:oM,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:cM,getSparseReshapeInputOutputMismatchErrorMessage:hM,getSparseReshapeInputOutputMultipleErrorMessage:uM,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:aM,getSparseReshapeNegativeOutputDimErrorMessage:lM,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:fM,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:II,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:dM,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:pM,getUndoAxesPermutation:ja,isIdentityPermutation:iC,log:H9,mergeRealAndImagArrays:Co,prepareAndValidate:i0,prepareSplitSize:oC,segment_util:WJ,shouldFuse:e0,slice_util:GL,splitRealAndImagArrays:ZL,stridesOrDilationsArePositive:jl,tupleValuesAreOne:Ta,upcastType:Ws,validateDefaultValueShape:QL,validateInput:Hw,validateUpdateShape:bT,warn:yr},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GJ=Object.freeze(Object.defineProperty({__proto__:null,nonMaxSuppressionV3Impl:t0,nonMaxSuppressionV4Impl:n0,nonMaxSuppressionV5Impl:s0,whereImpl:Xw},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */uJ();var $l;(function(n){n.UNDEFINED="undefined",n.INVALID_MODEL_TYPE="invalidModelType",n.MISSING_PATH="missingPath"})($l||($l={}));const xM=n=>!n||!Array.isArray(n)||n.length!==4?!1:n.every(e=>e===null||typeof e=="number"),wM=n=>xM(n)&&n[1]!==null&&n[2]!==null&&n[1]>0&&n[2]>0;function vM(n){function e(t){try{return t.shape.length===n}catch{}return!1}return e}const IM=vM(4),HJ=vM(3),Gm=n=>n instanceof kt,qJ=n=>typeof n=="string",KJ=n=>typeof n=="string"&&["layers","graph"].includes(n);class yy extends Error{constructor(t){super(t);le(this,"type");this.type=t}}const XJ=n=>{var e;if(n===void 0)throw new yy($l.UNDEFINED);if(!KJ(n.modelType??"layers"))throw new yy($l.INVALID_MODEL_TYPE);if(!n.path&&!((e=n._internals)!=null&&e.path))throw new yy($l.MISSING_PATH);return!0},YJ=n=>typeof n=="number",SM=n=>Array.isArray(n)&&n.length===2&&n.every(YJ),tp=n=>{console.warn(Array.isArray(n)?n.join(`
`):n)};function lC(n){return n!==void 0&&typeof n=="function"}function QJ(n){return lC(n)&&n.length<=1}const ZJ=(n,e,t)=>!lC(n)||n.length<=1?!1:t===void 0&&e==="tensor"?!0:t==="tensor",JJ=n=>n?n.aborted:!1;async function kM(n,e){let t;for(t=await n.next();!t.done;t=await n.next())e&&await e(t.value);return t.value}function TM(n){return n!=null}function np(n,e,...t){const s=t.filter(TM);if(s.length){const r=n.tidy(()=>s.reduce((i,o)=>o(i),e));return!e.isDisposed&&e!==r&&e.dispose(),r}return e}const eee=n=>n instanceof yy,tee="https://upscalerjs.com/documentation/troubleshooting#deprecated-model-definition-function",nee=["Passing a model definition as a function is deprecated and will be removed in a future version.","To leverage model lifecycle methods, use the setup and teardown methods.",`For more information, see ${tee}.`].join(" "),see="https://upscalerjs.com/documentation/troubleshooting#padding-is-undefined",ree=['"padding" is undefined, but "patchSize" is explicitly defined.',"Without padding, patches of images often have visible artifacting at the seams. Defining an explicit padding will resolve the artifacting.",`For more information, see ${see}.`,'To hide this warning, pass an explicit padding of "0".'].join(" "),iee="https://upscalerjs.com/documentation/troubleshooting#progress-specified-without-patch-size",oee=['The "progress" callback was provided but "patchSize" was not defined.','Without a "patchSize", the "progress" callback will never be called.',`For more information, see ${iee}.`].join(" "),aee="https://upscalerjs.com/documentation/troubleshooting#invalid-predicted-tensor",lee=n=>[`The tensor returned by the model was not a valid rank-4 tensor. It's shape is ${JSON.stringify(n)}.}`,"UpscalerJS only supports models returning valid image-like data in four dimensional form.",`For more information, see ${aee}.`].join(" "),cee="https://upscalerjs.com/documentation/troubleshooting#invalid-model-prediction",uee=["The model output was not a valid tensor. UpscalerJS only supports models returning valid tensors.","This is likely an error with the model itself, not UpscalerJS.",`For more information, see ${cee}.`].join(" "),hee=new Error("No defined tensors were passed to concatTensors");class dee extends Error{constructor(){super(...arguments);le(this,"message","The upscale request received an abort signal")}}const pee="https://upscalerjs.com/documentation/troubleshooting#invalid-model-type",fee="https://upscalerjs.com/documentation/troubleshooting#input-size-and-patch-size",mee="https://upscalerjs.com/documentation/troubleshooting#error-with-model-input-shape",gee=n=>[`You've provided an invalid model type: ${JSON.stringify(n)}. Accepted types are "layers" and "graph".`,`For more information, see ${pee}.`].join(" "),cC="There is a bug with the upscaler code. Please report this.",yee=["You have provided a patchSize, but the model definition already includes an input size.","Your patchSize will be ignored.",`For more information, see ${fee}.`].join(" "),bee=n=>[`Expected model to have a rank-4 compatible input shape. Instead got: ${JSON.stringify(n)}.`,`For more information, see ${mee}.`].join(" "),xee=n=>new Error([`Invalid patch size: ${n}. Patch size must be greater than 0.`].join(" ")),wee=(n,e)=>new Error([`Invalid patch size and padding: ${n} and ${e}. Patch size must be greater than padding * 2.`].join(" ")),vee="https://upscalerjs.com/documentation/troubleshooting#patch-size-indivisible-by-divisibility-factor",Iee=(n,e,t)=>[`Invalid patch size: ${n}. The model has a defined divibility factor of ${e} and patch size must be a multiple of this number.`,`Patch size has been scaled up to ${t}.`,`
For more information, see ${vee}.`].join(" "),See=new Error(["Model input sizes must be square. If you are using a model with a non-square input size and would like to request support,","please file a feature request at https://github.com/thekevinscott/upscalerjs"].join(" ")),kee="https://upscalerjs.com/documentation/troubleshooting#missing-path-and-internals",Tee=n=>['Provided model configuration is missing both a "path" and "_internals". A valid path to a model JSON file must be provided.',`For more information, see ${kee}.`,`The model configuration provided was: ${JSON.stringify(n)}`].join(" ");function Cee(n,e){switch(n){case $l.INVALID_MODEL_TYPE:return new Error(gee(e==null?void 0:e.modelType));case $l.MISSING_PATH:return new Error(Tee(e));default:return new Error(cC)}}const CM=(n,e,t)=>async s=>{if(t&&await n.nextFrame(),JJ(e))throw Array.isArray(s)?s.forEach(r=>r==null?void 0:r.dispose()):Gm(s)&&s.dispose(),new dee},hb=n=>!n||typeof n!="object"?!1:"patchSize"in n&&typeof n.patchSize=="number",SI=n=>!!n&&typeof n=="number"&&n>0,Eee="https://upscalerjs.com/documentation/troubleshooting#invalid-warmup-value",_ee=n=>["Invalid value passed to warmup in warmupSizes:",JSON.stringify(n),`For more information, see ${Eee}.`].join(`
`),kI=n=>new Error(_ee(n)),Nee=n=>{if(hb(n)){const{patchSize:e}=n;return e}return n};async function*Aee(n,e,t){const{model:s,modelDefinition:r}=await e;for(const i of t){if(!hb(i)&&!SI(i))throw kI(i);const o=Nee(i);let a=n.zeros([1,o,o,3]);yield[a];const l=[r.preprocess,c=>s.predict(c),r.postprocess].filter(Boolean);for(const c of l)a=np(n,a,c),yield[a];a.dispose(),yield}}const Ree=n=>{if(Array.isArray(n)){for(const e of n)if(!hb(e)&&!SI(e))throw kI(n);return n}else if(hb(n)||SI(n))return[n];throw kI(n)},xR=async(n,e,t,{signal:s=void 0,awaitNextFrame:r=!1}={},i)=>{const o=CM(n,s||i.signal,r);await o(),await kM(Aee(n,e,Ree(t)),o)},$ee=(n,e)=>e instanceof n.LayersModel,Dee=n=>({...n});function Pee(n){return typeof n=="function"}function Oee(n,e){return Pee(e)?(tp(nee),e(n)):e}async function Fee(n,e){const t=Oee(n,e);return t.setup&&await t.setup(n),t}function wR(n,e,t){return t==="graph"?n.loadGraphModel(e):n.loadLayersModel(e)}const Lee=(n,e)=>$ee(n,e)?e.layers[0].batchInputShape:e.inputs[0].shape,Mee=(n,{model:e})=>{const t=Lee(n,e);if(!xM(t))throw new Error(bee(t));return t},Bv=(n,e)=>Math.ceil(e/n)*n,zee=(n,e,{patchSize:t,padding:s},r)=>{const i=Mee(n,e);if(t!==void 0){if(t<=0)throw xee(t);if(s!==void 0&&s*2>=t)throw wee(t,s)}if(wM(i)){if(t!==void 0&&tp(yee),i[1]!==i[2])throw See;return{patchSize:i[1],padding:s,modelInputShape:i}}t!==void 0&&s===void 0&&tp(ree);const{divisibilityFactor:o}=e.modelDefinition;if(o!==void 0){if(t!==void 0){const a=Bv(o,t);return a!==t&&tp(Iee(t,o,a)),{patchSize:a,padding:s,modelInputShape:[null,a,a,3]}}return{patchSize:void 0,padding:void 0,modelInputShape:[null,Bv(o,r[1]),Bv(o,r[2]),3]}}return{patchSize:t,padding:s,modelInputShape:void 0}},Vee=(n,e)=>t=>{const s=t.shape[1],r=t.shape[2];return wM(e)&&(e[1]>s||e[2]>r)?n.tidy(()=>{const i=Math.max(s,e[1]),o=Math.max(r,e[2]),a=n.zeros([1,s,o-r,3]),l=n.zeros([1,i-s,o,3]),c=n.concat([t,a],2);return n.concat([c,l],1)}):t},vR=(n,e,t)=>s=>{const r=e[1]*t,i=e[2]*t;return r<s.shape[1]||i<s.shape[2]?n.tidy(()=>n.slice(s,[0,0,0],[1,r,i,3])):s},IR=n=>e=>{const t=SM(n)?n[1]:255;return e.clipByValue(0,t).mul(t===1?255:1)},Bee=(n,e)=>t=>SM(e)&&e[1]===1?n.mul(t,1/255):t,jee=(n,e)=>n.tidy(()=>{const[t,s]=e.shape,r=n.fill([t,s],255).expandDims(2);return e.clipByValue(0,255).concat([r],2).dataSync()});function Uee(n){return Gm(n)?n.clone():n}function SR(n,e,t=0){const s=e.filter(TM);if(s.length===0)throw hee;const r=n.concat(s,t);return e.forEach(i=>i==null?void 0:i.dispose()),r}const kR=(n,e,t,s)=>{let r=e;const i=e===0||t===n?0:s,o=r+t>n;let a=o?t-(n-r):0;const l=o||t===n?0:s,c=o?0:i;let u=t-(o?a:0);o&&(r=n-t),r-=c,a+=c,u-=c+l;const h=t>n?n:t-i-l;return{pre:{origin:r,size:t},post:{origin:a,size:u},increment:h}},Wee=([n,e],t,s)=>{const r=[];let i=0,o=0;for(;o<e;){const{pre:{origin:a,size:l},post:{origin:c,size:u},increment:h}=kR(e,o,Math.min(t,e),s),d=[];for(;i<n;){const{pre:{origin:p,size:f},post:{origin:g,size:m},increment:y}=kR(n,i,Math.min(t,n),s);d.push({pre:{origin:[a,p],size:[l,f]},post:{origin:[c,g],size:[u,m]}}),i+=y}r.push(d),i=0,o+=h}return r},Gee=(n,e,t,s)=>(n*t+e+1)/s,TR=(n,e)=>{const t=n.predict(e);if(!Gm(t))throw new Error(uee);if(IM(t))return t;throw new Error(lee(t.shape))};async function*Hee(n,e,{output:t,progress:s,progressOutput:r},i,{originalImageSize:o,patchSize:a,padding:l=0},{tensorAsBase64:c}){const{model:u,modelDefinition:h}=i,d=h.scale??1;if(a){const[m,y]=e.shape.slice(1),w=Wee([y,m],a,l);yield;let v;const I=w.length*w[0].length;for(let T=0;T<w.length;T++){const E=w[T],k=E.length;let S;yield[S,v];for(let A=0;A<k;A++){const{pre:P,post:D}=E[A];yield[v,S];const V=e.slice([0,...P.origin],[-1,...P.size]);yield[v,S,V];const U=TR(u,V);V.dispose(),yield[v,S,U];const q=[0,D.origin[0]*d,D.origin[1]*d],J=[-1,D.size[0]*d,D.size[1]*d],K=U.slice(q,J);U.dispose(),yield[v,S,K];const ee=np(n,K,h.postprocess,IR(h.outputRange));if(yield[v,S,ee],s!==void 0&&lC(s)){const L=Gee(T,A,k,I);if(QJ(s))s(L);else{const ae=ee.squeeze(),ce={row:T,col:A,patchCoordinates:{pre:P,post:D}};if(ZJ(s,t,r))s(L,ae,ce);else{const z=c(n,ae);ae.dispose(),s(L,z,ce)}}}yield[v,S,ee],S=SR(n,[S,ee],2),ee.dispose(),yield[v,S]}v=SR(n,[v,S],1),S.dispose(),yield[v]}const _=np(n,v.clone(),vR(n,o,d));v==null||v.dispose(),yield[_];const N=_.squeeze();return _.dispose(),N}s&&tp(oee);const p=TR(u,e);yield[p];const f=np(n,p.clone(),h.postprocess,IR(h.outputRange),vR(n,o,d));p.dispose(),yield[f];const g=f.squeeze();return f.dispose(),g}async function*qee(n,e,t,s,{getImageAsTensor:r,tensorAsBase64:i}){const o=Uee(e),a=await r(n,o);yield a;const l=a.shape,{patchSize:c,padding:u,modelInputShape:h}=zee(n,s,t,l),d=np(n,a,s.modelDefinition.preprocess,Bee(n,s.modelDefinition.inputRange),h?Vee(n,h):void 0);yield d;const p=Hee(n,d,{output:t.output,progressOutput:t.progressOutput,progress:t.progress},s,{originalImageSize:l,patchSize:c,padding:u},{tensorAsBase64:i});let f=await p.next();for(yield f.value;!f.done;)f=await p.next(),Array.isArray(f.value)?yield[...f.value,d]:Gm(f.value)?yield[f.value,d]:yield d;d.dispose();const g=f.value;if(t.output==="tensor")return g;const m=i(n,g);return g.dispose(),m}async function Kee(n,e,{signal:t,awaitNextFrame:s,...r},i,{checkValidEnvironment:o,...a}){o(e,{output:r.output,progressOutput:r.progressOutput});const l=CM(n,t||i.signal,s);await l();const c=await kM(qee(n,e,r,i,a),l);return await l(),c}const Xee=E9;function Yee({tf:n,getUpscaleOptions:e,checkValidEnvironment:t,getImageAsTensor:s,tensorAsBase64:r,loadModel:i}){class o{constructor(l={}){le(this,"_opts");le(this,"_model");le(this,"ready");le(this,"_abortController",new AbortController);le(this,"upscale",this.execute.bind(this));le(this,"warmup",async(l=[],c)=>(await this.ready,xR(n,this._model,l,c,{signal:this._abortController.signal})));le(this,"abort",()=>{this._abortController.abort(),this._abortController=new AbortController});le(this,"dispose",async()=>{await this.ready;const{model:l,modelDefinition:c}=await this._model;c.teardown&&await c.teardown(n),l.dispose()});le(this,"getModel",()=>this._model);this._opts={...l},this._model=i(n,Fee(n,this._opts.model||Xee)),this.ready=new Promise((c,u)=>{this._model.then(()=>xR(n,this._model,this._opts.warmupSizes||[],void 0,{signal:this._abortController.signal})).then(c).catch(u)})}async execute(l,c){const u={checkValidEnvironment:t,getImageAsTensor:s,tensorAsBase64:r};await this.ready;const h=await this._model;return Kee(n,l,e(c),{...h,signal:this._abortController.signal},u)}}return o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EM={kernelName:xf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>W(n,gc(ve(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qee={kernelName:Vu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=jt(ve(t,"float32")),r=os(Ne(Ue(1),s));return Yt(Me(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zee={kernelName:Bu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=os(Ne(jt(ve(t,"float32")),1));return Me(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jee={kernelName:hc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=tt(t.shape,s.shape);return{a:()=>{let a=n;const l=An(t.shape,r);return l.length>0&&(a=Pe(a,l)),G(a,t.shape)},b:()=>{let a=n;const l=An(s.shape,r);return l.length>0&&(a=Pe(a,l)),G(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ete={kernelName:wf,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((s,r)=>{t[r]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tte={kernelName:vf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ct(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nte={kernelName:If,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ct(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ste={kernelName:ju,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Me(n,os(Ne(Ue(1),jt(ve(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rte={kernelName:Uu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=os(pe(Ue(1),jt(ve(t,"float32"))));return Me(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ite={kernelName:Hu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=tt(t.shape,s.shape);return{a:()=>{const a=pe(jt(t),jt(s));let l=W(n,Me(s,a));const c=An(t.shape,r);return c.length>0&&(l=Pe(l,c)),G(l,t.shape)},b:()=>{const a=pe(jt(t),jt(s));let l=Yt(W(n,Me(t,a)));const c=An(s.shape,r);return c.length>0&&(l=Pe(l,c)),G(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ote={kernelName:Wu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Me(n,pe(jt(ve(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ate={kernelName:Gu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Me(n,Ne(Ue(1),jt(ve(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lte(n,e,t,s,r,i){const o=F(n,"dy","avgPool3dGrad"),a=F(e,"input","avgPool3dGrad");let l=o,c=a,u=!1;a.rank===4&&(u=!0,l=G(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=G(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),O(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),O(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),As("avgPool3dGrad",r,i);const h={dy:l,input:c},d={filterSize:t,strides:s,pad:r,dimRoundingMode:i},p=B.runKernel(xx,h,d);return u?G(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const cte=j({avgPool3dGrad_:lte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ute={kernelName:kf,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:i,pad:o,dimRoundingMode:a}=t;return{x:()=>cte(n,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hte(n,e,t,s,r){const i=F(n,"dy","avgPoolGrad"),o=F(e,"input","avgPoolGrad");O(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let a=o,l=i,c=!1;o.rank===3&&(c=!0,a=G(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=G(i,[1,i.shape[0],i.shape[1],i.shape[2]])),O(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),O(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const u={dy:l,input:a},h={filterSize:t,strides:s,pad:r},d=B.runKernel(bx,u,h);return c?G(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const dte=j({avgPoolGrad_:hte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pte={kernelName:Sf,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:i,pad:o}=t;return{x:()=>dte(n,s,r,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fte={kernelName:Tf,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[s,r]=e,{transposeA:i,transposeB:o}=t;return!i&&!o?{a:()=>pt(n,r,!1,!0),b:()=>pt(s,n,!0,!1)}:!i&&o?{a:()=>pt(n,r,!1,!1),b:()=>pt(n,s,!0,!1)}:i&&!o?{a:()=>pt(r,n,!1,!0),b:()=>pt(s,n,!1,!1)}:{a:()=>pt(r,n,!0,!0),b:()=>pt(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mte={kernelName:Cf,gradFunc:(n,e,t)=>{const{blockShape:s,crops:r}=t;return{x:()=>Om(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gte={kernelName:jO,gradFunc:(n,e,t)=>{const s=t,r=s.inputShape,i=s.shape,o=Array.from(i);for(let l=r.length-1;l>=0;l--)if(r[l]===i[l])o[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${i}].`);const a=[];for(let l=0;l<o.length;l++)o[l]>1&&a.push(l);return{x:()=>Pe(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yte={kernelName:qu,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bte={kernelName:Ku,gradFunc:n=>({x:()=>Ct(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xte={kernelName:Xu,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{clipValueMin:r,clipValueMax:i}=t;return{x:()=>Wn(Wr(Lo(s,r),Ua(s,i)),n,Ct(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wte={kernelName:_f,inputsToSave:["x"],gradFunc:EM.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vte={kernelName:Nf,saveAllInputs:!0,gradFunc:(n,e,t)=>{const s=e.map(l=>l.shape),{axis:r}=t,i=ft(r,e[0].shape)[0],o=s.map(l=>l[i]);return Bs(n,o,i).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ite={kernelName:Af,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{dilations:i,strides:o,pad:a,dataFormat:l}=t;return O(Ta(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>Fk(s.shape,n,r,o,a,l),filter:()=>TT(s,n,r.shape,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ste={kernelName:Rf,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{strides:i,pad:o,dataFormat:a,dimRoundingMode:l}=t;return{dy:()=>ko(n,r,i,o,a,1,l),filter:()=>TT(n,s,r.shape,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kte(n,e,t,s,r){let i=n;n.rank===4&&(i=G(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let o=e;o.rank===4&&(o=G(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),O(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),O(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),O(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),O(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),O(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);const a={x:i,dy:o},l={strides:s,pad:r,filterShape:t};return B.runKernel(kx,a,l)}const Tte=j({conv3DBackpropFilter_:kte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cte={kernelName:$f,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:i}=t;O(Ta(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[o,a]=e;return{x:()=>TF(o.shape,n,a,r,i),filter:()=>Tte(o,n,a.shape,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ete={kernelName:Yu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>W(Yt(Bw(ve(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _te={kernelName:Qu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>W(jw(ve(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nte={kernelName:Df,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r,exclusive:i,reverse:o}=t;return{x:()=>{const a=pn([r],s.rank);let l=Nw(n,r,i,!o);return a!=null&&(l=vt(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ate={kernelName:Pf,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:i,dimRoundingMode:o}=t,a=s??[1,1];O(Ta(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,c]=e;return O(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),O(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),O(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),O(ls(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),As("depthwiseConv2d",i,o),{x:()=>gL(l.shape,n,c,r,i,a,o),filter:()=>mL(l,n,c.shape,r,i,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rte={kernelName:Of,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,i={x:s,filter:r,dy:n},o={x:s,filter:r,dy:n};return{x:()=>B.runKernel(nb,i,t),filter:()=>B.runKernel(sb,o,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $te={kernelName:Ju,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,s={dy:n,y:t};return{x:()=>B.runKernel(Ox,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dte={kernelName:eh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=W(qs(Yt(jt(t))),2/Math.sqrt(Math.PI));return{x:()=>W(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pte={kernelName:th,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>W(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ote={kernelName:Lf,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>G(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fte={kernelName:nh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>W(n,qs(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lte={kernelName:sh,gradFunc:n=>({x:()=>Ct(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mte={kernelName:rh,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=tt(t.shape,s.shape);return{a:()=>{const a=Me(n,ve(s,"float32")),l=An(t.shape,r);return l.length>0?G(Pe(a,l),t.shape):a},b:()=>{let a=W(n,ve(t,"float32"));const l=An(s.shape,r);l.length>0&&(a=G(Pe(a,l),s.shape));const c=jt(s);return Yt(Me(a,ve(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zte={kernelName:Mf,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:s}=t,[r,i,o,a]=e,l=a??Ue(1),c=An(i.shape,r.shape),u=[];if(i.rank===1){for(let I=0;I<r.shape.length-1;++I)u.push(r.shape[I]);u.push(1)}const h=Ne(r,i),d=W(n,l),p=Mw(pe(o,Ue(s))),f=W(W(W(p,p),p),Ue(-.5));return{x:()=>i.rank===1?G(W(W(n,xr(G(p,[1,1,1,i.shape[0]]),u)),l),r.shape):G(W(W(n,p),l),r.shape),mean:()=>{let I=W(W(p,Ue(-1)),d);return i.rank===1&&(I=Pe(I,c)),G(I,i.shape)},variance:()=>{let I=W(W(f,h),d);return i.rank===1&&(I=Pe(I,c)),G(I,i.shape)},scale:()=>{const I=W(h,p);let _=W(n,I);return i.rank===1&&(_=Pe(_,c)),G(_,i.shape)},offset:()=>{let I=n;return i.rank===1&&(I=Pe(I,c)),G(I,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vte={kernelName:zf,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[s,r]=e,{axis:i,batchDims:o}=t,a=ft(i,s.shape)[0],l=(c,u,h)=>()=>{const d=c.shape,p=u.size,f=d.slice(0,a),g=f.length,m=d.slice(i,d.length).slice(1),y=m.length,w=CR(0,g),v=CR(g+1,g+1+y),I=ER([f,[p],m]),_=G(h,I),N=G(u,[p]),T=ER([[g],w,v]),E=vt(_,T);let k=Kw(E,N,c.shape[a]);const S=ja(T);return k=vt(k,S),k};if(o===1){const c=s.shape[0],u=s.split(c,0);return{x:()=>Es(u.map((p,f)=>l(p,r.slice(f,1),n.slice(f,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,n),indices:()=>r}}};function CR(n,e){const t=[];for(let s=n;s<e;++s)t.push(s);return t}function ER(n){const e=[];for(let t=0;t<n.length;++t)for(let s=0;s<n[t].length;++s)e.push(n[t][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bte={kernelName:ih,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>Ct(t),b:()=>Ct(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jte={kernelName:oh,gradFunc:n=>({x:()=>ve(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ute={kernelName:ah,gradFunc:n=>({x:()=>Ct(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wte={kernelName:lh,gradFunc:n=>({x:()=>Ct(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gte={kernelName:ch,gradFunc:n=>({x:()=>Ct(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hte={kernelName:Bf,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{alpha:r}=t,i=Rs(s,0);return{x:()=>Wn(i,n,W(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qte={kernelName:hh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Me(n,pe(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kte={kernelName:uh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Me(n,ve(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xte={kernelName:UO,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;return{logits:()=>{const o=qs(s);return Ne(n,W(Pe(n,r,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yte(n,e,t,s=5,r=1,i=1,o=.5){const a={x:n,y:e,dy:t},l={depthRadius:s,bias:r,alpha:i,beta:o};return B.runKernel(Ux,a,l)}const Qte=j({localResponseNormalizationBackprop_:Yte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zte={kernelName:qf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{depthRadius:i,bias:o,alpha:a,beta:l}=t;return{x:()=>Qte(s,r,n,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _M(n,e,t,s){return e.rank<t.rank&&(e=G(e,wn(e.shape,s))),n.rank<t.rank&&(n=G(n,wn(n.shape,s))),{x:()=>W(n,ve(ar(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _R={kernelName:Kf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{reductionIndices:r}=s,i=e[0],o=e[1],a=ft(r,i.shape),l=_M(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jte={kernelName:dh,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>W(n,ve(Lo(t,s),"float32")),b:()=>W(n,ve(xu(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ene(n,e,t,s,r,i,o){const a=F(n,"dy","maxPool3dGrad"),l=F(e,"input","maxPool3dGrad"),c=F(t,"output","maxPool3dGrad");let u=a,h=l,d=c,p=!1;l.rank===4&&(p=!0,u=G(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),h=G(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),d=G(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),O(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),O(h.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),O(d.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${d.rank}.`),As("maxPool3dGrad",i,o);const f={dy:u,input:h,output:d},g={filterSize:s,strides:r,pad:i,dimRoundingMode:o},m=B.runKernel(Gx,f,g);return p?G(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const tne=j({maxPool3dGrad_:ene});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nne={kernelName:Yf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=t;return{x:()=>tne(n,s,r,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sne(n,e,t,s,r,i,o){const a=F(n,"dy","maxPoolGrad"),l=F(e,"input","maxPoolGrad"),c=F(t,"output","maxPoolGrad");O(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),O(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),O(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),As("maxPoolGrad",i,o);const u={dy:a,input:l,output:c},h={filterSize:s,strides:r,pad:i,dimRoundingMode:o};return B.runKernel(Wx,u,h)}const rne=j({maxPoolGrad_:sne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ine={kernelName:Xf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a}=t;return{x:()=>rne(n,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const one={kernelName:Qf,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t,i=ft(r,s.shape),a=Xn(s.shape,i)[1],l=re(a);return{x:()=>{const u=s.shape.slice();i.forEach(p=>{u[p]=1});const h=G(n,u);return Me(W(h,Vs(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ane={kernelName:Zf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{axis:r}=s,[i,o]=e,a=ft(r,i.shape),l=_M(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lne={kernelName:ph,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>W(n,ve(Ua(t,s),"float32")),b:()=>W(n,ve(Rs(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cne={kernelName:Jf,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,i=r.map(o=>o[0]);return{x:()=>St(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const une={kernelName:fh,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=tt(t.shape,s.shape);return{a:()=>{const a=An(t.shape,r);return a.length>0?G(Pe(n,a),t.shape):n},b:()=>{const a=W(n,Yt(zh(Me(t,s)))),l=An(s.shape,r);return l.length>0?G(Pe(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hne={kernelName:mh,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=tt(t.shape,s.shape);return{a:()=>{const a=W(n,ve(s,"float32")),l=An(t.shape,r);return l.length>0?G(Pe(a,l),t.shape):a},b:()=>{const a=W(n,ve(t,"float32")),l=An(s.shape,r);return l.length>0?G(Pe(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dne={kernelName:em,gradFunc:n=>({x:()=>Yt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pne={kernelName:sm,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>En(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fne={kernelName:nm,gradFunc:n=>({x:()=>Ct(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mne={kernelName:rm,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:s}=t;return Er(n,s).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NR={kernelName:im,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,i=r.map(o=>o[0]);return{x:()=>St(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gne={kernelName:gh,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,s,r]=e,i=t,o=s,a=tt(i.shape,o.shape);return{a:()=>{const u=ve(o,"float32");let h=W(n,W(u,To(i,Ne(u,Ue(1)))));const d=An(i.shape,a);return d.length>0&&(h=Pe(h,d)),G(h,i.shape)},b:()=>{const u=Rs(i,0),h=Wn(u,lr(i),Ct(i));let d=W(n,W(r,h));const p=An(o.shape,a);return p.length>0&&(d=Pe(d,p)),G(d,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yne={kernelName:om,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,s]=e,r=Rs(t,0);return{x:()=>Wn(r,n,W(n,s)),alpha:()=>{let i=Wn(r,Ct(n),W(n,t));const o=An(s.shape,n.shape);return o.length>0&&(i=Pe(i,o)),G(i,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bne(n,e,t){const s=n.shape.slice();s[t]=1;const r=G(e,s),i=Gp(n,t,!0,!1),o=Gp(n,t,!0,!0),a=W(i,o);return W(r,a)}function xne(n,e,t){const s=n.shape.length,r=s-t.length,i=pn(t,s);let o=n;i!=null&&(o=vt(n,i));const a=o.shape.slice(),c=a.splice(s-t.length,t.length).reduce((d,p)=>d*p,1);a.push(c);const u=o.reshape(a);let h=bne(u,e,r);if(h=h.reshape(o.shape),i!=null){const d=ja(i);h=vt(h,d)}return h}const wne={kernelName:am,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;let i=[];return r==null?i=s.shape.map((o,a)=>a):typeof r=="number"?i=[r]:i=r,{x:()=>xne(s,n,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vne={kernelName:Zu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=tt(t.shape,s.shape);return{a:()=>{const a=Me(n,ve(s,"float32")),l=An(t.shape,r);return l.length>0?G(Pe(a,l),t.shape):a},b:()=>{let a=W(n,ve(t,"float32"));const l=An(s.shape,r);l.length>0&&(a=G(Pe(a,l),s.shape));const c=jt(s);return Yt(Me(a,ve(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ine={kernelName:yh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Me(n,Yt(jt(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sne={kernelName:xh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=W(Ua(t,6),gc(t));return{x:()=>W(n,ve(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kne={kernelName:bh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>W(n,ve(gc(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tne={kernelName:lm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>G(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cne={kernelName:um,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>B.runKernel(sw,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ene={kernelName:cm,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>B.runKernel(nw,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ne={kernelName:hm,gradFunc:(n,e,t)=>{const{dims:s}=t,r=ft(s,n.shape);return{x:()=>Cr(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nne={kernelName:wh,gradFunc:n=>({x:()=>Ct(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ane={kernelName:vh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Yt(Me(n,W(To(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rne={kernelName:dm,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>ve(Ct(t),"float32"),t:()=>W(n,ve(t,n.dtype)),e:()=>W(n,ve($m(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ne={kernelName:Ih,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Rs(t,Ue(0)),r=Ue(l0),i=Ue(c0),o=W(n,i),a=W(W(n,r),qs(ve(t,"float32")));return Wn(s,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dne={kernelName:Ch,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>W(n,W(t,Ne(Ue(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pne={kernelName:Th,gradFunc:n=>({x:()=>Ct(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const One={kernelName:Sh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>W(Em(ve(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fne={kernelName:kh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>W(_w(ve(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lne={kernelName:pm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{begin:r,size:i}=t,o=s.shape,[a,l]=o0(s,r,i),c=[];for(let u=0;u<n.rank;u++)c.push([a[u],o[u]-a[u]-l[u]]);return{x:()=>Mo(n,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mne={kernelName:ym,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{dim:r}=t,i=!0,o=W(n,s);return{logits:()=>Ne(o,W(Pe(o,[r],i),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zne={kernelName:Eh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>W(n,oi(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AR={kernelName:mm,gradFunc:(n,e,t)=>{const{blockShape:s,paddings:r}=t;return{x:()=>Cm(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RR={kernelName:gm,gradFunc:(n,e,t)=>{const{axis:s}=t;return{x:()=>xn(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vne={kernelName:_h,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Me(n,W(os(ve(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bne={kernelName:dw,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>W(n,W(ve(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jne={kernelName:Nh,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Ue(2);return{a:()=>W(n,W(r,Ne(t,s))),b:()=>W(n,W(r,Ne(s,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Une={kernelName:Ph,gradFunc:n=>({x:()=>Ct(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wne={kernelName:Ah,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=tt(t.shape,s.shape);return{a:()=>{let a=n;const l=An(t.shape,r);return l.length>0&&(a=Pe(a,l)),G(a,t.shape)},b:()=>{let a=n;const l=An(s.shape,r);return l.length>0&&(a=Pe(a,l)),G(Yt(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gne={kernelName:fm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,r=s.shape.slice(),{axis:i}=t;ft(i,s.shape).forEach(c=>{r[c]=1});const a=G(n,r),l=W(a,Vs(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hne={kernelName:Rh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Me(n,jt(Em(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qne={kernelName:$h,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>W(Ne(Ue(1),jt(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kne={kernelName:Dh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{reps:r}=t;return{x:()=>{let o=Ct(s);if(s.rank===1)for(let a=0;a<r[0];++a)o=pe(o,St(n,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)o=pe(o,St(n,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let c=0;c<r[2];++c)o=pe(o,St(n,[a*s.shape[0],l*s.shape[1],c*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let c=0;c<r[2];++c)for(let u=0;u<r[3];++u)o=pe(o,St(n,[a*s.shape[0],l*s.shape[1],c*s.shape[2],u*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xne={kernelName:Al,gradFunc:(n,e,t)=>{const s=t,{perm:r}=s,i=ja(r);return{x:()=>vt(n,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yne={kernelName:xm,gradFunc:(n,e,t)=>{const s=t,{axis:r}=s;return{value:()=>Es(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qne={kernelName:wm,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Zne(n,t)}}};function Zne(n,e){const t=to(e,Ct(e)),s=Vh(n,t);let r=Lo(e,Ue(0,"int32"));const i=s.rank-r.rank;for(let a=0;a<i;++a)r=es(r,a+1);r=Wr(r,Vs(s.shape,"bool"));const o=Ct(s);return Wn(r,s,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jne={kernelName:vm,gradFunc:n=>({x:()=>Ct(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ese=[EM,Qee,Zee,Jee,ete,tte,nte,ste,rte,ite,ote,ate,ute,pte,fte,mte,gte,yte,bte,xte,wte,vte,Ste,Ite,Cte,Ete,_te,Nte,Ate,Rte,vne,$te,Dte,Pte,Ote,Fte,Mte,Lte,zte,Vte,Bte,jte,Ute,Wte,Gte,Hte,qte,Kte,Xte,Zte,_R,_R,Jte,nne,ine,one,ane,lne,cne,une,hne,dne,pne,fne,mne,NR,NR,gne,yne,wne,Ine,Sne,kne,Tne,Cne,Ene,_ne,Nne,Ane,Rne,$ne,Dne,Pne,One,Fne,Lne,Mne,zne,AR,AR,RR,RR,Vne,jne,Bne,Une,Wne,Gne,Hne,qne,Kne,Xne,Yne,Qne,Jne];for(const n of ese)WO(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.abs=function(){return this.throwIfDisposed(),Tn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.acos=function(){return this.throwIfDisposed(),yk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.acosh=function(){return this.throwIfDisposed(),bk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.add=function(n){return this.throwIfDisposed(),pe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.all=function(n,e){return this.throwIfDisposed(),Tw(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.any=function(n,e){return this.throwIfDisposed(),jp(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.argMax=function(n){return this.throwIfDisposed(),Bl(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.argMin=function(n){return this.throwIfDisposed(),xk(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.asScalar=function(){return this.throwIfDisposed(),O(this.size===1,()=>"The array must have only 1 element."),G(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.asType=function(n){return this.throwIfDisposed(),ve(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.as1D=function(){return this.throwIfDisposed(),G(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.as2D=function(n,e){return this.throwIfDisposed(),G(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),G(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.as4D=function(n,e,t,s){return this.throwIfDisposed(),G(this,[n,e,t,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.as5D=function(n,e,t,s,r){return this.throwIfDisposed(),G(this,[n,e,t,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.asin=function(){return this.throwIfDisposed(),wk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.asinh=function(){return this.throwIfDisposed(),vk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.atan=function(){return this.throwIfDisposed(),Ik(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.atan2=function(n){return this.throwIfDisposed(),Sk(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.atanh=function(){return this.throwIfDisposed(),kk(this)};oe().prototype.avgPool=function(n,e,t,s){return this.throwIfDisposed(),Tm(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),Cm(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.batchNorm=function(n,e,t,s,r){return this.throwIfDisposed(),Oh(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Rl(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.cast=function(n){return this.throwIfDisposed(),ve(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.ceil=function(){return this.throwIfDisposed(),Rk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),Hs(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof kt&&(n=[n]),xn([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.conv1d=function(n,e,t,s,r,i){return this.throwIfDisposed(),Cw(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.conv2dTranspose=function(n,e,t,s,r){return this.throwIfDisposed(),Ew(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.conv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),ko(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.cos=function(){return this.throwIfDisposed(),Em(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.cosh=function(){return this.throwIfDisposed(),_w(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),Gp(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),Nw(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),zk(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.depthwiseConv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),Fh(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.dilation2d=function(n,e,t,s,r){return this.throwIfDisposed(),Vk(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.divNoNan=function(n){return this.throwIfDisposed(),Bk(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.div=function(n){return this.throwIfDisposed(),Me(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.dot=function(n){return this.throwIfDisposed(),jk(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.elu=function(){return this.throwIfDisposed(),Lh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.equal=function(n){return this.throwIfDisposed(),ar(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.erf=function(){return this.throwIfDisposed(),Uk(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),Gk(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.exp=function(){return this.throwIfDisposed(),qs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.expandDims=function(n){return this.throwIfDisposed(),es(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.expm1=function(){return this.throwIfDisposed(),Hk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.fft=function(){return this.throwIfDisposed(),Vm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.flatten=function(){return this.throwIfDisposed(),G(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.floor=function(){return this.throwIfDisposed(),zh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.floorDiv=function(n){return this.throwIfDisposed(),kw(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.gather=function(n,e,t){return this.throwIfDisposed(),Vh(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Lo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.greater=function(n){return this.throwIfDisposed(),Rs(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.ifft=function(){return this.throwIfDisposed(),Su(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.irfft=function(){return this.throwIfDisposed(),Ww(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.isFinite=function(){return this.throwIfDisposed(),qk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.isInf=function(){return this.throwIfDisposed(),Kk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.isNaN=function(){return this.throwIfDisposed(),Xk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.leakyRelu=function(n){return this.throwIfDisposed(),Nm(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.lessEqual=function(n){return this.throwIfDisposed(),Ua(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.less=function(n){return this.throwIfDisposed(),xu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.localResponseNormalization=function(n,e,t,s){return this.throwIfDisposed(),Yk(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.logSigmoid=function(){return this.throwIfDisposed(),Qk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.logSoftmax=function(n){return this.throwIfDisposed(),$w(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),Rm(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.log=function(){return this.throwIfDisposed(),lr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.log1p=function(){return this.throwIfDisposed(),Am(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.logicalAnd=function(n){return this.throwIfDisposed(),Wr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.logicalNot=function(){return this.throwIfDisposed(),$m(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.logicalOr=function(n){return this.throwIfDisposed(),Dw(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.logicalXor=function(n){return this.throwIfDisposed(),Zk(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),pt(this,n,e,t)};oe().prototype.maxPool=function(n,e,t,s){return this.throwIfDisposed(),Dm(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.max=function(n,e){return this.throwIfDisposed(),Sr(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.maximum=function(n){return this.throwIfDisposed(),to(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.mean=function(n,e){return this.throwIfDisposed(),un(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.min=function(n,e){return this.throwIfDisposed(),bu(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.minimum=function(n){return this.throwIfDisposed(),Ca(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),eT(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.mod=function(n){return this.throwIfDisposed(),tT(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.mul=function(n){return this.throwIfDisposed(),W(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.neg=function(){return this.throwIfDisposed(),Yt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.norm=function(n,e,t){return this.throwIfDisposed(),Mh(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.notEqual=function(n){return this.throwIfDisposed(),Gl(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),wu(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.onesLike=function(){return this.throwIfDisposed(),cr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.pad=function(n,e){return this.throwIfDisposed(),Mo(this,n,e)};oe().prototype.pool=function(n,e,t,s,r,i){return this.throwIfDisposed(),nT(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.pow=function(n){return this.throwIfDisposed(),To(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.prelu=function(n){return this.throwIfDisposed(),Fm(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.prod=function(n,e){return this.throwIfDisposed(),sT(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.reciprocal=function(){return this.throwIfDisposed(),pT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.relu=function(){return this.throwIfDisposed(),vi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.relu6=function(){return this.throwIfDisposed(),Fw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.reshapeAs=function(n){return this.throwIfDisposed(),G(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.reshape=function(n){return this.throwIfDisposed(),G(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),wL(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),vL(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.reverse=function(n){return this.throwIfDisposed(),Cr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.rfft=function(){return this.throwIfDisposed(),Bm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.round=function(){return this.throwIfDisposed(),Lw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.rsqrt=function(){return this.throwIfDisposed(),Mw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.selu=function(){return this.throwIfDisposed(),zw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.separableConv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),Vw(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.sigmoid=function(){return this.throwIfDisposed(),oi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.sign=function(){return this.throwIfDisposed(),fT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.sin=function(){return this.throwIfDisposed(),Bw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.sinh=function(){return this.throwIfDisposed(),jw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.slice=function(n,e){return this.throwIfDisposed(),St(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.softmax=function(n){return this.throwIfDisposed(),zm(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.softplus=function(){return this.throwIfDisposed(),fc(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),Om(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.split=function(n,e){return this.throwIfDisposed(),Bs(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.sqrt=function(){return this.throwIfDisposed(),os(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.square=function(){return this.throwIfDisposed(),jt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.squaredDifference=function(n){return this.throwIfDisposed(),Gw(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.squeeze=function(n){return this.throwIfDisposed(),Ga(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof kt?[this,n]:[this,...n];return Es(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.step=function(n){return this.throwIfDisposed(),gc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.stridedSlice=function(n,e,t,s,r,i,o,a){return this.throwIfDisposed(),mT(this,n,e,t,s,r,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.sub=function(n){return this.throwIfDisposed(),Ne(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.sum=function(n,e){return this.throwIfDisposed(),Pe(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.tan=function(){return this.throwIfDisposed(),gT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.tanh=function(){return this.throwIfDisposed(),Ul(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.tile=function(n){return this.throwIfDisposed(),xr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.toBool=function(){return this.throwIfDisposed(),ve(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.toFloat=function(){return this.throwIfDisposed(),ve(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.toInt=function(){return this.throwIfDisposed(),ve(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.topk=function(n,e){return this.throwIfDisposed(),xT(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.transpose=function(n){return this.throwIfDisposed(),vt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.unique=function(n){return this.throwIfDisposed(),wT(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),Kw(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.unstack=function(n){return this.throwIfDisposed(),Er(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.where=function(n,e){return this.throwIfDisposed(),Wn(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().prototype.zerosLike=function(){return this.throwIfDisposed(),Ct(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ri extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ri.prototype)}}class Br extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Br.prototype)}}class H extends Error{constructor(e){super(e),Object.setPrototypeOf(this,H.prototype)}}class rt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,rt.prototype)}}class uC extends Error{constructor(e){super(e),Object.setPrototypeOf(this,uC.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class NM{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Kl(n,e){if(Array.isArray(n)){let t=[];for(let s=0;s<e;s++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function $i(n,e){if(!n)throw new uC(e)}function $R(n,e){let t=0;for(const s of n)s===e&&t++;return t}function Ls(n){return n.length===1?n[0]:n}function Gt(n){return Array.isArray(n)?n:[n]}function ao(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function dl(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let Nr={};function hC(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function TI(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>TI(e));else{const e=Object.keys(n);for(const t of e){const s=n[t];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[t]=s.value:TI(s))}}}function Hm(n,e={},t={},s="object",r=!1){if(typeof n=="string"){const i=n;let o;if(i in t)o=t[i];else if(i in Nr)o=Nr[i];else if(o=e[i],o==null)throw new H(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const i=n;if(i.className==null||i.config==null)throw new H(`${s}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const o=i.className;let a,l;if(o in t?[a,l]=t[o]:o in Nr?[a,l]=Nr.className:o in e&&([a,l]=e[o]),a==null)throw new H(`Unknown ${s}: ${o}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const c={};for(const p of Object.keys(Nr))c[p]=Nr[p];for(const p of Object.keys(t))c[p]=t[p];const u=i.config;u.customObjects=c;const h=Object.assign({},Nr);for(const p of Object.keys(t))Nr[p]=t[p];TI(i.config);const d=l(a,i.config,t,r);return Nr=Object.assign({},h),d}else{const c=Object.assign({},Nr);for(const h of Object.keys(t))Nr[h]=t[h];const u=new a(i.config);return Nr=Object.assign({},c),u}}}function tse(n,e){return n<e?-1:n>e?1:0}function Fg(n,e){return-1*tse(n,e)}function ma(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function nse(n){if(n==null)throw new H(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function bc(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new H(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function dC(n,e,t=0,s=1/0){return $i(t>=0),$i(s>=t),Array.isArray(n)&&n.length>=t&&n.length<=s&&n.every(r=>typeof r===e)}function Un(n,e){Array.isArray(n)?(O(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,s)=>Un(t,`element ${s+1} of ${e}`))):O(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${AM(n)}.`)}function AM(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>AM(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function sse(n,e,t){let s=t!=null?t():Jn(),r;return(...o)=>{const a=t!=null?t():Jn();return a-s<e||(s=a,r=n(...o)),r}}function RM(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let rse=0;function $M(){return rse++}const Lg={};function u0(n=""){return n in Lg||(Lg[n]=0),Lg[n]+=1,n+Lg[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const ise=["channelsFirst","channelsLast"],ose=["nearest","bilinear"],ase=["valid","same","causal"],lse=["max","avg"],cse=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Mc=new Map;function In(n){bc(ise,"DataFormat",n)}function use(n){bc(ose,"InterpolationFormat",n)}function _r(n){bc(ase,"PaddingMode",n)}function DM(n){bc(lse,"PoolMode",n)}const sp=[],DR="/";function Dl(n,e){sp.push(n);try{const t=e();return sp.pop(),t}catch(t){throw sp.pop(),t}}function hse(){return sp.length===0?"":sp.join(DR)+DR}function PM(n){if(!FM(n))throw new Error("Not a valid tensor name: '"+n+"'");return hse()+n}function OM(n){if(!FM(n))throw new Error("Not a valid tensor name: '"+n+"'");Mc.has(n)||Mc.set(n,0);const e=Mc.get(n);if(Mc.set(n,Mc.get(n)+1),e>0){const t=`${n}_${e}`;return Mc.set(t,1),t}else return n}const dse=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function FM(n){return!!n.match(dse)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function pse(n){return n===parseInt(n.toString(),10)}function ga(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let s=1;for(let r=e;r<t;++r)s*=n[r];return s}function ku(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s<e&&(e=s)}return e}function Ea(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s>e&&(e=s)}return e}function fi(n,e){if(e<n)throw new H(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let s=n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let jv;function On(){return jv==null&&(jv=wF().epsilon()),jv}function mi(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Vi(n,e){return ve(n,e)}function qm(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),G(n,t)}function fse(n,e){return Y(()=>{if(n.shape.length!==2)throw new H(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=qm(n,1);return CI(t,[1,e,1])})}function mse(n){const e=[ga(n.shape)];return G(n,e)}function gse(n){if(n.rank<=1)throw new H(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],ga(n.shape,1)];return G(n,e)}function Pl(n,e,t){return Y(()=>{switch(n.rank){case 1:return Lm(n,e,t);case 2:return Uw(n,[e,0],[t,n.shape[1]]);case 3:return Mm(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return Iu(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return St(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return St(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new H(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Uv(n,e,t){return Y(()=>{switch(n.rank){case 1:return Lm(n,e,t);case 2:return Uw(n,[0,e],[n.shape[0],t]);case 3:return Mm(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return Iu(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new H(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Mg(n,e,t,s){return Y(()=>{switch(n.rank){case 1:return Lm(n,e,t);case 2:switch(s){case 1:return Pl(n,e,t);case 2:return Uv(n,e,t);default:throw new H(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Pl(n,e,t);case 2:return Mm(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return Uv(n,e,t);default:throw new H(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Pl(n,e,t);case 2:return Iu(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return Iu(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return Uv(n,e,t);default:throw new H(`The axis is not within the rank of the tensor ${s}`)}default:throw new H(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function pC(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),xn(n,e)}function PR(n,e){switch(n.rank){case 1:return $k([n,e]);case 2:return Dk([n,e],0);case 3:return Pk([n,e],0);case 4:return Ok([n,e],0);default:throw new H(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function CI(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new H(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return xr(n,e)}function h0(n,e=0,t=1,s,r){return Ow(n,e,t,s,r)}function Bi(n,e,t,s){if(n.rank<2||e.rank<2)throw new rt(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=n.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(r!==i)throw new rt(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return bI({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?EI(n.rank,s,mi()):null,activation:t});{const r=n.shape.slice(),i=r.pop();n=G(n,[-1,i]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),c=[...o,a],u=Array.from({length:e.rank},(f,g)=>g===0?e.rank-2:g<=e.rank-2?g-1:g);e=G(vt(e,u),[l,-1]);const h=[...r,...c];return G(bI({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?EI(n.rank,s,mi()):null,activation:t}),h)}}function LM(n,e,t){return Y(()=>(Array.isArray(e)?e=ss(e,"int32"):e=ve(e,"int32"),Vh(n,e,t)))}function Km(n){return W(n,n)}function EI(n,e,t){const s=e.shape;if(e.rank!==1&&e.rank!==n)throw new H(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return s.length===1?G(e,[1,s[0],1,1,1]):G(e,[1,s[3],s[0],s[1],s[2]]);if(t==="channelsLast")return s.length===1?G(e,[1,1,1,1,s[0]]):G(e,[1].concat(s))}else if(n===4){if(t==="channelsFirst")return s.length===1?G(e,[1,s[0],1,1]):G(e,[1,s[2],s[0],s[1]]);if(t==="channelsLast")return s.length===1?G(e,[1,1,1,s[0]]):G(e,[1].concat(s))}else if(n===3){if(t==="channelsFirst")return s.length===1?G(e,[1,s[0],1]):G(e,[1,s[1],s[0]]);if(t==="channelsLast")return s.length===1?G(e,[1,1,s[0]]):G(e,[1].concat(s))}else if(n<3)return e;throw new H(`Unsupported input rank by biasAdd: ${e.rank}`)}function Ii(n,e,t){return Y(()=>(t==null&&(t=mi()),In(t),pe(n,EI(n.rank,e,t))))}function yse(n,e=1){if(e!==1)throw new rt(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return Lh(n)}function bse(n){return Y(()=>Me(n,pe(Tn(n),1)))}function MM(n,e,t,s){return Y(()=>ST(n,e,t,s))}function xse(n){return Y(()=>{const e=pe(.5,W(.2,n));return Hs(e,0,1)})}function Xm(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const wse=["fanIn","fanOut","fanAvg"],vse=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ise(n){bc(wse,"FanMode",n)}function Sse(n){bc(vse,"Distribution",n)}class qr extends yc{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class fC extends qr{apply(e,t){return En(e,t)}}fC.className="Zeros";me(fC);class d0 extends qr{apply(e,t){return Vs(e,t)}}d0.className="Ones";me(d0);class mC extends qr{constructor(e){if(super(),typeof e!="object")throw new H(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new H(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return Y(()=>W(Ue(this.value),Vs(e,t)))}getConfig(){return{value:this.value}}}mC.className="Constant";me(mC);class gC extends qr{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return Wa(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}gC.className="RandomUniform";me(gC);class yC extends qr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new rt(`randomNormal does not support dType ${t}.`);return h0(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}yC.className="RandomNormal";me(yC);class bC extends qr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new rt(`truncatedNormal does not support dType ${t}.`);return qw(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}bC.className="TruncatedNormal";me(bC);class xC extends qr{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return Y(()=>{if(e.length!==2||e[0]!==e[1])throw new H("Identity matrix initializer can only be used for 2D square matrices.");return W(this.gain,Aw(e[0]))})}getConfig(){return{gain:this.gain}}}xC.className="Identity";me(xC);function kse(n,e="channelsLast"){let t,s;if(In(e),n.length===2)t=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const r=ga(n,2);t=n[1]*r,s=n[0]*r}else if(e==="channelsLast"){const r=ga(n,0,n.length-2);t=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=ga(n);t=Math.sqrt(r),s=Math.sqrt(r)}return[t,s]}class Ks extends qr{constructor(e){if(super(),e.scale<0)throw new H(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,Ise(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,Sse(this.distribution),this.seed=e.seed}apply(e,t){const s=kse(e),r=s[0],i=s[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,r):this.mode==="fanOut"?o/=Math.max(1,i):o/=Math.max(1,(r+i)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new rt(`${this.getClassName()} does not support dType ${t}.`);return qw(e,0,a,t,this.seed)}else{const a=Math.sqrt(3*o);return Wa(e,-a,a,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Ks.className="VarianceScaling";me(Ks);class p0 extends Ks{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ks.className}}p0.className="GlorotUniform";me(p0);class f0 extends Ks{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ks.className}}f0.className="GlorotNormal";me(f0);class m0 extends Ks{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ks.className}}m0.className="HeNormal";me(m0);class g0 extends Ks{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ks.className}}g0.className="HeUniform";me(g0);class y0 extends Ks{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ks.className}}y0.className="LeCunNormal";me(y0);class b0 extends Ks{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ks.className}}b0.className="LeCunUniform";me(b0);class wC extends qr{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return Y(()=>{if(e.length<2)throw new rt("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const s=re(e.slice(0,-1)),r=e[e.length-1],i=s*r;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const o=[Math.max(r,s),Math.min(r,s)],a=h0(o,0,1,t,this.seed),l=ET.qr(a,!1);let c=l[0];const h=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return c=W(c,h.sign()),s<r&&(c=c.transpose()),W(Ue(this.gain),c.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}wC.className="Orthogonal";me(wC);const OR={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function FR(n,e={}){return Hm(n,br.getMap().classNameMap,e,"initializer")}function hn(n){return hC(n)}function on(n){if(typeof n=="string"){const e=n in OR?OR[n]:n;if(e==="GlorotNormal")return new f0;if(e==="GlorotUniform")return new p0;if(e==="HeNormal")return new m0;if(e==="HeUniform")return new g0;if(e==="LeCunNormal")return new y0;if(e==="LeCunUniform")return new b0;{const t={};return t.className=e,t.config={},FR(t)}}else return n instanceof qr?n:FR(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _I(n){return Array.isArray(n)&&Array.isArray(n[0])}function db(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function Xe(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new H(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function Ft(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new H(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function pb(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const LR="Variable";class zM{constructor(e,t="float32",s=LR,r=!0,i=null){this.dtype=t??"float32",this.shape=e.shape,this.id=$M(),s=s??LR,this.originalName=PM(s),this.name=OM(this.originalName),this.trainable_=r,this.constraint=i,this.val=vT(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),Tse(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function Tse(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function NI(n){return n.map(e=>e.read())}function vC(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class _n{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class gi{constructor(e,t,s,r,i,o,a){this.dtype=e,this.shape=t,this.sourceLayer=s,this.inputs=r,this.callArgs=i,this.outputTensorIndex=a,this.id=$M(),o!=null&&(this.originalName=PM(o),this.name=OM(this.originalName)),this.rank=t.length}}let Cse=0,x0=class{constructor(e,t){this.callArgs=t,this.id=Cse++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},Ese=0;class mt extends yc{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=Ese++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const s=this.getClassName();t=ao(s)+"_"+u0(s)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let i=null;e.batchSize!=null&&(i=e.batchSize),s=[i].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new Br(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new H(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Ls(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Ls(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Ri(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Ri(`Layer ${this.name} is not connected, no input to return.`);return Ls(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Ri(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Ri(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Ls(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=Gt(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=Gt(this.inputSpec);if(t.length!==s.length)throw new H(`Layer ${this.name} expects ${s.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){const i=t[r],o=s[r];if(o==null)continue;const a=i.rank;if(o.ndim!=null&&a!==o.ndim)throw new H(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new H(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new H(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&i.dtype!==o.dtype)throw new H(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${i.dtype}.`);if(o.axes){const l=i.shape;for(const c in o.axes){const u=Number(c),h=o.axes[c],d=u>=0?l[u]:l[l.length+u];if(h!=null&&[h,null].indexOf(d)===-1)throw new H(`Input ${r} is incompatible with layer ${this.name}: expected axis ${u} of input shape to have value ${h} but got shape ${l}.`)}}if(o.shape!=null)for(let l=0;l<o.shape.length;++l){const c=o.shape[l],u=i.shape[l];if(c!=null&&u!=null&&c!==u)throw new H(`Input ${r} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${i.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const s=Gt(e),r=Ase(e),i=Rse(e);if(r===i)throw new H("Arguments to apply() must be all SymbolicTensors or all Tensors");return Dl(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const a of Gt(e))o.push(a.shape);this.build(Ls(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let o=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,o);const a=Gt(o),l=[];for(let c of a)s.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(o=Ls(l),this.activityRegularizer!=null)throw new rt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=_se(e),a=this.computeOutputShape(o);let l;const c=Nse(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((u,h)=>new gi(c,u,this,Gt(e),t,this.name,h)):l=new gi(c,a,this,Gt(e),t,this.name),this.addInboundNode(e,l,null,null,o,a,t),this._refCount++,this.activityRegularizer!=null)throw new rt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Ri(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const s=JSON.stringify(t.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new Ri(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Br(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return pb(this.weights)}build(e){this.built=!0}getWeights(e=!1){return NI(e?this.trainableWeights:this.weights)}setWeights(e){Y(()=>{const t=this.weights;if(t.length!==e.length)throw new H(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const s=[],r=NI(t);for(let i=0;i<r.length;++i){const o=r[i],a=t[i],l=e[i];if(!wt(o.shape,l.shape))throw new H(`Layer weight shape ${o.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}vC(s)})}addWeight(e,t,s,r,i,o,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new H(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():on("zeros"));const c=r.apply(t,s),u=new zM(c,s,e,o,a);return c.dispose(),i!=null&&this.addLoss(()=>i.apply(u.read())),o==null&&(o=!0),o?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=Gt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s);if(t instanceof Array&&r instanceof Array){if(t.length!==r.length)throw new Error(`${this.name} outputs ${t.length} tensors but ${r.length} masks for those tensors`);for(let i=0;i<t.length;i++)t[i].kerasMask=r[i]}else{if(r instanceof Array)throw new Error(`{this.name} outputs a single tensor but ${r.length} masks`);if(t instanceof Array)throw new Error(`{this.name} outputs ${t.length} tensors but only one mask`);t.kerasMask=r}}addInboundNode(e,t,s,r,i,o,a=null){const l=Gt(e);t=Gt(t),s=Gt(s),r=Gt(r),i=db(i),o=db(o);const c=[],u=[],h=[];for(const d of l)c.push(d.sourceLayer),u.push(d.nodeIndex),h.push(d.tensorIndex);new x0({outboundLayer:this,inboundLayers:c,nodeIndices:u,tensorIndices:h,inputTensors:l,outputTensors:t,inputMasks:s,outputMasks:r,inputShapes:i,outputShapes:o},a);for(let d=0;d<t.length;d++)t[d].sourceLayer=this,t[d].nodeIndex=this.inboundNodes.length-1,t[d].tensorIndex=d}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function _se(n){n=Gt(n);const e=[];for(const t of n)e.push(t.shape);return Ls(e)}function Nse(n){return"float32"}function VM(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const s=e.inboundNodes[t];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let i=0;i<s.inboundLayers.length;i++){const o=s.inputTensors[i],a=s.inboundLayers[i],l=s.nodeIndices[i],c=VM(o,a,l);for(const u of c)r.indexOf(u)===-1&&r.push(u)}return r}}}function Ase(n){let e=!0;for(const t of Gt(n))if(!(t instanceof gi)){e=!1;break}return e}function Rse(n){let e=!0;for(const t of Gt(n))if(t instanceof gi){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Uh extends mt{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:u0("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new H("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new H("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new H("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=t,this.dtype=s,this.inputSpec=[{shape:t}];const r=new gi(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new x0({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new H(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Uh.className="InputLayer";me(Uh);function BM(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new H("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new Uh({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $se(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return ve(e,n.dtype)}catch{throw new H(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class ca{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof ca)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=$se(e,t),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new H(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof gi){if(this.id2Value[e.id]==null)throw new H(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new H(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof gi){if(this.id2Value[e.id]==null)throw new H(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new H(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&et(this.id2Mask)}}const fb=new NM,mb=new NM;function Dse(n){fb!=null&&fb.setMaxEntries(n),mb!=null&&mb.setMaxEntries(n)}function jd(n,e,t,s){const r=t==null?!1:t.training,i=Array.isArray(n),o=i?n:[n],a=o.map(f=>f.name),l=[],c=e.names();for(const f of a)c.indexOf(f)!==-1?l.push(e.getValue(f)):l.push(null);s!=null&&(s.maxNumTensors=-1/0,s.minNumTensors=1/0);const u=a.join(",")+"|"+e.names().sort().join(",");let h=fb.get(u),d;if(h==null){const f=Pse(o,e);h=f.sorted,d=f.recipientCounts,fb.put(u,h),mb.put(u,d)}d={},r||Object.assign(d,mb.get(u));const p=new ca(e);for(let f=0;f<h.length;++f){if(s!=null){const k=lb().numTensors;k>s.maxNumTensors&&(s.maxNumTensors=k),k<s.minNumTensors&&(s.minNumTensors=k)}const g=h[f],m=g.sourceLayer;if(m instanceof Uh)continue;const y=[],w=[],v=[];let I=!1;for(const k of g.inputs){const S=p.getValue(k),A=p.getMask(k);y.push(S),w.push(A),A!=null&&(I=!0),r||(d[k.name]--,d[k.name]===0&&!e.hasKey(k)&&a.indexOf(k.name)===-1&&!S.isDisposed&&k.sourceLayer.stateful!==!0&&v.push(S))}I&&(t=t||{},t.mask=w[0]);const _=Gt(m.apply(y,t));let N=null;m.supportsMasking&&(N=m.computeMask(y,w));const T=Fse(g),E=Array.isArray(T)?T:[T];for(let k=0;k<E.length;++k){p.hasKey(E[k])||p.add(E[k],_[k],Array.isArray(N)?N[0]:N);const S=a.indexOf(E[k].name);S!==-1&&(l[S]=_[k])}r||et(v)}return p.disposeMasks(),i?l:l[0]}function Pse(n,e){O(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],s={};if(n.length===1){const r=MR(n[0],e);t=r.sorted,s=r.recipientMap}else{const r=new Set;for(const i of n){const{sorted:o,recipientMap:a}=MR(i,e);for(const l of o)r.has(l.name)||(t.push(l),r.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(c=>s[l].add(c))}}return{sorted:t,recipientCounts:Ose(s)}}function Ose(n){const e={};for(const t in n)e[t]=n[t].size;return e}function MR(n,e){const t=new Set,s=[],r={};for(const a of e.names())t.add(a);const i=[],o=[];for(i.push(n);i.length>0;){const a=i[i.length-1];if(t.has(a.name)){i.pop();continue}const l=o[o.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),s.push(a),t.add(a.name),l&&o.pop();else{o.push(i.length-1);for(const c of a.inputs)r[c.name]==null&&(r[c.name]=new Set),r[c.name].add(a.name),!t.has(c.name)&&i.push(c)}}return{sorted:s,recipientMap:r}}function Fse(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){t=s;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lse=X();Lse.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,Dse);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function IC(n,e){return Y(()=>os(Pe(W(n,n),e,!0)))}class Ym extends yc{getConfig(){return{}}}class SC extends Ym{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Y(()=>{const t=IC(e,this.axis),s=Hs(t,0,this.maxValue);return W(e,Me(s,pe(On(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}SC.className="MaxNorm";me(SC);class kC extends Ym{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Y(()=>Me(e,pe(On(),IC(e,this.axis))))}getConfig(){return{axis:this.axis}}}kC.className="UnitNorm";me(kC);class TC extends Ym{apply(e){return vi(e)}}TC.className="NonNeg";me(TC);class CC extends Ym{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Y(()=>{const t=IC(e,this.axis),s=pe(W(this.rate,Hs(t,this.minValue,this.maxValue)),W(1-this.rate,t));return W(e,Me(s,pe(On(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}CC.className="MinMaxNorm";me(CC);const zR={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Ln(n){return hC(n)}function VR(n,e={}){return Hm(n,br.getMap().classNameMap,e,"constraint")}function Mn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in zR?zR[n]:n,config:{}};return VR(t)}else return n instanceof Ym?n:VR(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Mse(n){return new SC(n)}function zse(n){return new kC(n)}function Vse(){return new TC}function Bse(n){return new CC(n)}const jse=Object.freeze(Object.defineProperty({__proto__:null,maxNorm:Mse,minMaxNorm:Bse,nonNeg:Vse,unitNorm:zse},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Use(){return new fC}function Wse(){return new d0}function Gse(n){return new mC(n)}function Hse(n){return new gC(n)}function qse(n){return new yC(n)}function Kse(n){return new bC(n)}function Xse(n){return new xC(n)}function Yse(n){return new Ks(n)}function Qse(n){return new p0(n)}function Zse(n){return new f0(n)}function Jse(n){return new m0(n)}function ere(n){return new g0(n)}function tre(n){return new y0(n)}function nre(n){return new b0(n)}function sre(n){return new wC(n)}const rre=Object.freeze(Object.defineProperty({__proto__:null,constant:Gse,glorotNormal:Zse,glorotUniform:Qse,heNormal:Jse,heUniform:ere,identity:Xse,leCunNormal:tre,leCunUniform:nre,ones:Wse,orthogonal:sre,randomNormal:qse,randomUniform:Hse,truncatedNormal:Kse,varianceScaling:Yse,zeros:Use},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Jo(n){if(n==null)return;const e=[],t=[],s=[];for(const r in n){const i=n[r];if(typeof i!="number"){const o=i;e.push(o.data()),t.push(r),s.push(o)}}if(e.length>0){const r=await Promise.all(e);for(let i=0;i<r.length;++i)n[t[i]]=r[i][0];et(s)}}function jM(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var BR;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(BR||(BR={}));const ire=125;class Tu{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class UM{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class ore extends Tu{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const s=t.size==null?0:t.size;this.seen+=s;for(const r in t){const i=t[r];if(typeof i=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+i*s;else{let o;r in this.totals?o=this.totals[r]:this.totals[r]=0;const a=Y(()=>pe(this.totals[r],W(i,s)));this.totals[r]=a,o!=null&&o.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?t[s]=this.totals[s]/this.seen:Y(()=>{const r=W(Me(1,this.seen),this.totals[s]);t[s]=r,this.totals[s].dispose(),Pn(t[s])}))}}class WM extends Tu{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const s in t)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(t[s])}async syncData(){const e=[],t=[],s=[];for(const i in this.history){const o=this.history[i];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const l=o[a];e.push(l.data()),t.push(i),s.push(a)}}const r=await Promise.all(e);for(let i=0;i<r.length;++i)this.history[t[i]][s[i]].dispose(),this.history[t[i]][s[i]]=r[i][0]}}class GM extends Tu{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||jT,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=ire),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");eb(this.yieldEvery)&&(this.maybeWait=sse(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,s){const r=[];this.yield!=null&&(await Jo(s),r.push(this.yield(e,t,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await Jo(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const s=[];this.epochEnd!=null&&(await Jo(t),s.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,t){this.batchBegin!=null&&(await Jo(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const s=[];this.batchEnd!=null&&(await Jo(t),s.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):eb(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Jo(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Jo(e),await this.trainEnd(e))}}function HM(n,e){return n==null&&(n={}),n instanceof Tu?[n]:Array.isArray(n)&&n[0]instanceof Tu?n:Gt(n).map(s=>new GM(s,e))}class gr{constructor(){}static registerCallbackConstructor(e,t){O(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),gr.checkForDuplicate(t),gr.constructors[e]==null&&(gr.constructors[e]=[]),gr.constructors[e].push(t)}static checkForDuplicate(e){for(const t in gr.constructors)gr.constructors[+t].forEach(r=>{if(r===e)throw new H("Duplicate callback constructor.")})}static clear(){gr.constructors={}}static createCallbacks(e){const t=[];for(const s in gr.constructors){const r=+s;e>=r&&t.push(...gr.constructors[r])}return t.map(s=>new s)}}gr.constructors={};function qM(n,e,t,s,r,i,o,a,l){const c=new WM,u=[new ore,...gr.createCallbacks(e)];n!=null&&u.push(...n),u.push(c);const h=new UM(u);return h.setParams({epochs:t,initialEpoch:s,samples:r,steps:i,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:h,history:c}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ai(n,e={},t=!1){return Hm(n,br.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function gb(n,e){return Y(()=>{n.dtype!=="float32"&&(n=ve(n,"float32"));const t=Pe(Km(n),e,!0),s=pc(t.shape,On()),r=os(to(t,s));return Me(n,r)})}function xc(n,e){return Y(()=>un(Km(Ne(e,n)),-1))}function w0(n,e){return Y(()=>un(Tn(Ne(e,n)),-1))}function Wh(n,e){return Y(()=>{const t=Ne(n,e),s=Hs(Tn(n),On(),Number.MAX_VALUE),r=Tn(Me(t,s));return W(100,un(r,-1))})}function are(n,e){return Y(()=>{const t=Hs(e,On(),Number.MAX_VALUE),s=lr(pe(1,t)),r=Hs(n,On(),Number.MAX_VALUE),i=lr(pe(1,r));return un(Km(Ne(s,i)),-1)})}function lre(n,e){return Y(()=>{const t=to(0,Ne(1,W(n,e)));return un(Km(t),-1)})}function cre(n,e){return Y(()=>{const t=to(0,Ne(1,W(n,e)));return un(t,-1)})}function ure(n,e){return Y(()=>{const t=Pe(W(n,e),-1),s=Sr(W(Ne(1,n),e),-1);return to(0,pe(1,Ne(s,t)))})}function hre(n,e){return Y(()=>{const t=Math.log(2),s=Ne(e,n),r=Ne(pe(s,fc(W(-2,s))),t);return un(r,-1)})}function Hp(n,e,t=!1){return Y(()=>{if(t)e=zm(e);else{const s=Pe(e,e.shape.length-1,!0);e=Me(e,s)}return e=Hs(e,On(),1-On()),Yt(Pe(W(ve(n,"float32"),lr(e)),e.shape.length-1))})}function yb(n,e,t=!1){return Y(()=>{const s=ve(zh(mse(n)),"int32");e=Hs(e,On(),1-On());const r=e.shape,i=G(wu(s,r[r.length-1]),r);return Hp(i,e,t)})}function dre(n,e){if(!wt(n.shape,e.shape))throw new H(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return Y(()=>{const t=vi(e),s=Yt(Tn(e));return pe(Ne(t,W(e,n)),Am(qs(s)))})}function v0(n,e){return Y(()=>{let t;return t=Hs(e,On(),1-On()),t=lr(Me(t,Ne(1,t))),un(dre(n,t),-1)})}function pre(n,e){return Y(()=>{const t=Hs(n,On(),1),s=Hs(e,On(),1);return Pe(W(n,lr(Me(t,s))),-1)})}function fre(n,e){return Y(()=>{const t=lr(pe(On(),e));return un(Ne(e,W(n,t)),-1)})}function EC(n,e){return Y(()=>{const t=gb(n,-1),s=gb(e,-1),r=W(t,s);return Yt(Pe(r,-1))})}const bb={meanSquaredError:xc,meanAbsoluteError:w0,meanAbsolutePercentageError:Wh,meanSquaredLogarithmicError:are,squaredHinge:lre,hinge:cre,categoricalHinge:ure,logcosh:hre,categoricalCrossentropy:Hp,sparseCategoricalCrossentropy:yb,binaryCrossentropy:v0,kullbackLeiblerDivergence:pre,poisson:fre,cosineProximity:EC};function Wv(n){if(typeof n=="string"){if(n in bb)return bb[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new H(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _C(n,e){return Y(()=>{const t=W(.5,cr(e)),s=Vi(Rs(e,t),n.dtype);return un(ar(n,s),-1)})}function NC(n,e){return Y(()=>Vi(ar(Bl(n,-1),Bl(e,-1)),"float32"))}function KM(n,e){return Y(()=>ve(Pe(Wr(ar(n,1),ar(e,1))),"float32"))}function mre(n,e){return Y(()=>ve(Pe(Wr(ar(n,1),ar(e,0))),"float32"))}function gre(n,e){return Y(()=>ve(Pe(Wr(ar(n,0),ar(e,1))),"float32"))}function XM(n,e){return Y(()=>{const t=KM(n,e),s=gre(n,e),r=pe(t,s);return ve(Wn(Rs(r,0),Me(t,r),0),"float32")})}function yre(n,e){return Y(()=>{const t=KM(n,e),s=mre(n,e),r=pe(t,s);return ve(Wn(Rs(r,0),Me(t,r),0),"float32")})}function YM(n,e){return v0(n,e)}function QM(n,e){return n.rank===e.rank&&(n=Ga(n,[n.rank-1])),e=Bl(e,-1),e.dtype!==n.dtype&&(e=ve(e,n.dtype)),ve(ar(n,e),"float32")}const bre=xc,xre=xc,wre=w0,vre=w0,Ire=Wh,Sre=Wh,AC=Hp,kre=EC,ZM=yb,xb={binaryAccuracy:_C,categoricalAccuracy:NC,precision:XM,categoricalCrossentropy:AC,sparseCategoricalCrossentropy:ZM,mse:bre,MSE:xre,mae:wre,MAE:vre,mape:Ire,MAPE:Sre,cosine:kre};function Tre(n){if(typeof n=="string"&&n in xb)return xb[n];if(typeof n!="string"&&n!=null)return n;throw new H(`Unknown metric ${n}`)}function zg(n){if($i(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(bb))if(bb[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(xb))if(xb[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Cre(n){const e={Adagrad:()=>al.adagrad(.01),Adadelta:()=>al.adadelta(1,.95,On()),Adam:()=>al.adam(.001,.9,.999,On()),Adamax:()=>al.adamax(.002,.9,.999,On(),0),RMSProp:()=>al.rmsprop(.001,.9,0,On()),SGD:()=>al.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new H(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const jR=1*1024*1024;function UR(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!AI(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const s=JSON.stringify(n);s.length>jR&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${jR}.`)}}function AI(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!AI(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!AI(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ere(n,e,t,s=console.log){const r=Nre(n),i=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(u=>Math.floor(e*u)));let o;if(!r){i.push("Receives inputs"),o=[];for(const u in n.nodesByDepth)o.push(...n.nodesByDepth[u])}s("_".repeat(e)),wb(i,t,s),s("=".repeat(e));const a=n.layers;for(let u=0;u<a.length;++u)r?Are(a[u],t,s):Rre(a[u],t,o,s),s((u===a.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const l=_re(n),c=pb(n.nonTrainableWeights);s(`Total params: ${l+c}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${c}`),s("_".repeat(e))}function _re(n){let e;return n.collectedTrainableWeights!=null?e=pb(n.collectedTrainableWeights):e=pb(n.trainableWeights),e}function Nre(n){let e=!0;const t=[],s=[];for(const r in n.nodesByDepth)t.push(n.nodesByDepth[r]);for(const r of t){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of n.layers){let i=!1;for(const o of r.inboundNodes)if(s.indexOf(o)!==-1)if(i){e=!1;break}else i=!0;if(!e)break}return e}function wb(n,e,t=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);t(s)}function Are(n,e,t){let s,r;try{r=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const i=n.name,o=n.getClassName(),a=[`${i} (${o})`,r,s,n.countParams().toString()];wb(a,e,t)}function Rre(n,e,t,s){let r,i;try{i=n.inboundNodes.map(h=>JSON.stringify(h.inputShapes)).join(",")}catch{i="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const o=[];for(const h of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(h)===-1))for(let d=0;d<h.inboundLayers.length;++d){const p=h.inboundLayers[d].name,f=h.nodeIndices[d],g=h.tensorIndices[d];o.push(`${p}[${f}][${g}]`)}const a=n.name,l=n.getClassName(),c=o.length===0?"":o[0],u=[`${a} (${l})`,i,r,n.countParams().toString(),c];wb(u,e,s);for(let h=1;h<o.length;++h)wb(["","","","",o[h]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function JM(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function qp(n,e){if(n===null)return null;if(typeof n=="string")return dl(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];JM(e,r,i)?t.push(i):t.push(qp(i,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")t[s]=r;else{const i=dl(s);t[i]=qp(r,i)}}return t}}function RI(n,e){if(n==null)return null;if(typeof n=="string")return ao(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];JM(e,r,i)?t.push(i):t.push(RI(i,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s],i=ao(s);(s==="name"||s==="className")&&typeof r=="string"?t[i]=r:t[i]=RI(r,s)}return t}}/** @license See the LICENSE file. */const I0="4.11.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const $re=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class Qr extends mt{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const w=this.getClassName().toLowerCase();this.name=u0(w)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],ma(this.inputs).length!==this.inputs.length)throw new H(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(w=>w.name)}`);ma(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(w=>w.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const w of this.outputs){const v=w.sourceLayer,I=w.nodeIndex,_=w.tensorIndex;this.outputLayers.push(v),this.outputLayersNodeIndices.push(I),this.outputLayersTensorIndices.push(_)}for(const w of this.inputs){const v=w.sourceLayer,I=w.nodeIndex,_=w.tensorIndex;$i(I===0,"input layer has >1 nodes"),$i(_===0,"input layer has >1 tensors"),this.inputLayers.push(v),this.inputLayersNodeIndices.push(I),this.inputLayersTensorIndices.push(_)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let w=0;w<this.inputLayers.length;w++){const v=this.inputLayers[w];if(!(v instanceof Uh))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${w} (0-based) originates from layer type ${v.getClassName()}.`);this.inputNames.push(v.name),this.feedInputShapes.push(v.batchInputShape),this.feedInputNames.push(v.name)}for(const w of this.outputLayers)this.outputNames.push(w.name);this.internalInputShapes=this.inputs.map(w=>w.shape),this.internalOutputShapes=this.outputs.map(w=>w.shape);const t={},s={},r={},i={},o={},a=[],l=(w,v,I,_,N,T)=>{(_==null||N==null||T==null)&&(_=w.sourceLayer,N=w.nodeIndex,T=w.tensorIndex);const E=_.inboundNodes[N];if(I.indexOf(E)!==-1)throw new Br(`The tensor ${w.name} at layer "${_.name}" is part of a cycle.`);if(v.indexOf(E)!==-1)return;this.containerNodes.add(Qr.nodeKey(_,N)),_.id in o||(o[_.id]=Object.keys(o).length),I.indexOf(E)===-1&&I.push(E);const k=E.inboundLayers.length;for(let S=0;S<k;S++){const A=E.inputTensors[S],P=E.inboundLayers[S],D=E.nodeIndices[S],V=E.tensorIndices[S];l(A,v,I,P,D,V)}for(v.push(E);I.indexOf(E)>=0;)I.splice(I.indexOf(E),1);a.push(E)},c=[],u=[];for(const w of this.outputs)l(w,c,u);const h=a.slice().reverse();for(const w of h){s[w.id]=w,w.id in t||(t[w.id]=0);let v=t[w.id];const I=r[w.outboundLayer.id]==null?0:r[w.outboundLayer.id];v=Math.max(v,I),r[w.outboundLayer.id]=v,i[w.outboundLayer.id]=w.outboundLayer,t[w.id]=v;for(let _=0;_<w.inboundLayers.length;_++){const N=w.inboundLayers[_],T=w.nodeIndices[_],E=N.inboundNodes[T],k=t[E.id]==null?0:t[E.id];t[E.id]=Math.max(v+1,k),s[E.id]=E}}const d={};for(const w in t){const v=t[w];v in d||(d[v]=[]),d[v].push(s[w])}const p={};for(const w in r){const v=r[w];v in p||(p[v]=[]),p[v].push(i[w])}let f=Object.keys(p).map(w=>parseInt(w,10)).sort(Fg);this.layers=[];for(const w of f){const v=p[w];v.sort((I,_)=>{const N=o[I.id],T=o[_.id];return N<T?-1:N>T?1:0});for(const I of v)I instanceof Qr&&this.internalContainerRefs.push(I),this.layers.push(I)}this.layersByDepth=p,f=Object.keys(d).map(w=>parseInt(w,10)).sort(Fg);const g=this.inputs.slice(),m=[];for(const w of f)for(const v of d[w]){const I=v.outboundLayer;if(I!=null){for(const _ of v.inputTensors)if(g.indexOf(_)===-1)throw new Br(`Graph disconnected: cannot obtain value for tensor ${_} at layer "${I.name}". The following previous layers were accessed without issue: ${m}`);for(const _ of v.outputTensors)g.push(_);m.push(I.name)}}this.nodesByDepth=d;const y=this.layers.map(w=>w.name);for(const w of y){const v=y.filter(I=>I===w).length;if(v!==1)throw new Br(`The name "${w}" is used ${v} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new x0({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(w=>null),outputMasks:this.outputs.map(w=>null),inputShapes:this.inputs.map(w=>w.shape),outputShapes:this.outputs.map(w=>w.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new H("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.layers)t.push(...s.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const s={};let r=0;const i=$re(e);i&&this.parseWeights(e);for(const a of this.layers)for(const[l,c]of a.weights.entries()){const u=i?`${c.name.split("/").slice(0,-1).join("/")+"/"}${l}`:c.originalName;if(s[u]!=null)throw new H(`Duplicate weight name: ${u}`);s[u]=c,r++}const o=[];for(const a in e){let l=a;if(s[a]==null){const c=a.split("/");l=c.slice(0,-2).concat([c[c.length-1]]).join("/")}if(s[l]!=null)o.push([s[l],e[a]]);else if(t)throw new H(`Provided weight data has no target variable: ${a}`);delete s[l]}if(t){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new H(`${a.length} of ${r} weights are not set: ${a}`)}vC(o)}parseWeights(e){for(const t in Object.keys(e)){const s=t.split("/"),r=["vars","layer_checkpoint_dependencies"],i=s.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!r.includes(o)).join("/");i!==t&&(e[i]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${I0}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const s=RI(this.updatedConfig());return t?JSON.stringify(s):s}call(e,t){return Y(()=>{e=Gt(e);const s=new ca;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return jd(this.outputs,s,t)})}computeMask(e,t){return Y(()=>{e=Gt(e);let s;return t==null?s=Kl(null,e.length):s=Gt(t),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const t=db(e);if(t.length!==this.inputLayers.length)throw new H(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<t.length;a++){const l=this.inputLayers[a],c=t[a],u=l.name+"_0_0";s[u]=c}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Fg);if(r.length>1)for(const a of r){const l=this.nodesByDepth[a];for(const c of l){const u=c.outboundLayer;if(this.inputLayers.map(g=>g.id).indexOf(u.id)!==-1)continue;const h=[];for(let g=0;g<c.inboundLayers.length;g++){const m=c.inboundLayers[g],y=c.nodeIndices[g],w=c.tensorIndices[g],v=`${m.name}_${y}_${w}`,I=s[v];h.push(I)}const d=u.computeOutputShape(Ls(h)),p=db(d),f=u.inboundNodes.indexOf(c);for(let g=0;g<p.length;g++){const m=`${u.name}_${f}_${g}`;s[m]=p[g]}}}const i=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],c=this.outputLayersNodeIndices[a],u=this.outputLayersTensorIndices[a],h=`${l.name}_${c}_${u}`;o.push(h)}for(let a=0;a<o.length;a++){const l=o[a];$i(l in s),i.push(s[l])}return Ls(i)}runInternalGraph(e,t){t==null&&(t=Kl(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const c=this.inputs[l],u=e[l],h=t[l];s[c.id]=[u,h]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Fg);for(const l of r){const c=this.nodesByDepth[l];for(const u of c){const h=u.outboundLayer,d=u.inputTensors,p=u.outputTensors,f=new Array;for(const g of d)g.id in s&&f.push(s[g.id]);if(f.length===d.length){let g={},m,y,w,v;if(u.callArgs!=null&&(g=u.callArgs),f.length===1){const[I,_]=f[0];g.mask==null&&(g.mask=_),w=Gt(h.call(I,g)),v=Gt(h.computeMask(I,_)),m=[I],y=[_]}else m=f.map(I=>I[0]),y=f.map(I=>I[1]),g.mask==null&&(g.mask=y),w=Gt(h.call(m,g)),v=Gt(h.computeMask(m,y));if(h.activityRegularizer)throw new rt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let I=0;I<p.length;++I){const _=p[I],N=w[I],T=v[I];s[_.id]=[N,T]}}}}const i=[],o=[],a=[];for(const l of this.outputs){$i(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[c,u]=s[l.id];a.push(c.shape),i.push(c),o.push(u)}return[i,o,a]}buildNodeConversionMap(e){const t={};let s;for(const r of this.layers){s=r instanceof Qr?1:0;for(let i=0;i<r.inboundNodes.length;i++){const o=Qr.nodeKey(r,i);this.containerNodes.has(o)&&(t[o]=s,s+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new H("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new H(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new H(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return Y(()=>{const e=[];for(const t of this.layers)for(let s=0;s<t.inboundNodes.length;++s){const r=Qr.nodeKey(t,s);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),s=[];for(const o of this.layers){const a=o.getClassName(),l=o.getConfig(),c=[];for(let h=0;h<o.inboundNodes.length;h++){const d=o.inboundNodes[h],p=Qr.nodeKey(o,h);let f={};if(this.containerNodes.has(p)){if(d.callArgs)try{JSON.stringify(d.callArgs),f=d.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${d.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),f={}}if(d.inboundLayers.length>0){const g=[];for(let m=0;m<d.inboundLayers.length;m++){const y=d.inboundLayers[m],w=d.nodeIndices[m],v=d.tensorIndices[m],I=Qr.nodeKey(y,w);let _=t[I];_==null&&(_=0),g.push([y.name,_,v,f])}c.push(g)}}}const u={};u.name=o.name,u.className=a,u.config=l,u.inboundNodes=c,s.push(u)}e.layers=s;const r=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],l=this.inputLayersNodeIndices[o],c=Qr.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=t[c];u==null&&(u=0);const h=this.inputLayersTensorIndices[o];r.push([a.name,u,h])}e.inputLayers=r;const i=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],l=this.outputLayersNodeIndices[o],c=Qr.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=t[c];u==null&&(u=0);const h=this.outputLayersTensorIndices[o];i.push([a.name,u,h])}return e.outputLayers=i,e}static fromConfig(e,t,s={},r=!1){const i={},o={};function a(m,y){m.name in o?o[m.name].push(y):o[m.name]=[y]}function l(m,y){const w=[];let v;for(const I of y){const _=I[0],N=I[1],T=I[2];if(v=I[3]==null?{}:I[3],!(_ in i)){a(m,y);return}const E=i[_];if(E.inboundNodes.length<=N){a(m,y);return}const k=E.inboundNodes[N];w.push(k.outputTensors[T])}w.length>0&&m.apply(Ls(w),v)}function c(m){const y=m.name,w=ai(m,t.customObjects!=null?t.customObjects:{});w.setFastWeightInitDuringBuild(r),i[y]=w,m.inboundNodes.forEach(I=>{if(!(I instanceof Array))throw new H(`Corrupted configuration, expected array for nodeData: ${I}`);a(w,I)})}const u=t.name,h=t.layers;for(const m of h)c(m);for(;!nse(o);)for(const m of h){const y=i[m.name];if(y.name in o){const w=o[y.name];delete o[y.name];for(const v of w)l(y,v)}}const d=[],p=[],f=t.inputLayers;for(const m of f){const y=m[0],w=m[1],v=m[2];$i(y in i);const _=i[y].inboundNodes[w].outputTensors;d.push(_[v])}const g=t.outputLayers;for(const m of g){const y=m[0],w=m[1],v=m[2];$i(y in i);const _=i[y].inboundNodes[w].outputTensors;p.push(_[v])}return new e({inputs:d,outputs:p,name:u})}get stateful(){if(this._stateful)throw new H("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){Y(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Dre(n,e,t){const s=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return e.forEach(i=>{i in n?r.push(n[i]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${t} must be either an array with ${s} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function ez(n,e){return Dre(n,e,"classWeight")}async function tz(n,e,t,s){if(e!=null||s!=null)throw new Error("Support sampleWeight is not implemented yet");if(t!=null){const r=Y(()=>{if(n.shape.length===1)return Mi(n);if(n.shape.length===2){if(n.shape[1]>1)return Bl(n,1);if(n.shape[1]===1)return G(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await r.data());et(r);const o=[];return i.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(t[a])}),ss(o,"float32")}else return null}function Pre(n,e){return W(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Ore=32;function nz(n,e){let t,s;const r=e;t=r.xs,s=r.ys,O(t!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const i=WR("input",n.inputNames,t),o=WR("output",n.outputNames,s),a=i[0].shape[0];O(i.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),O(o.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<i.length;l++)O(i[l].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let l=0;l<o.length;l++)O(o[l].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:i,ys:o}}function WR(n,e,t){if(t instanceof kt)return[t];if(Array.isArray(t))return O(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const s=[];for(const r of e){if(t[r]==null)throw new H(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(t[r])}return s}}function Fre(n){if(n.length===3)throw new rt("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function Lre(n,e,t){const s=t.batchesPerEpoch!=null;if(O(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),O(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),O(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),O(!s||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),O(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=t.validationData!=null;let i,o;if(r)if(GR(t.validationData))O(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const m=Fre(t.validationData);i=m.xs,o=m.ys}const a=n.makeTrainFunction(),l=n.getDedupedMetricsNames();let c;r?c=l.slice().concat(l.map(m=>"val_"+m)):c=l.slice();const u=HM(t.callbacks,t.yieldEvery),h=t.verbose==null?1:t.verbose,{callbackList:d,history:p}=qM(u,h,t.epochs,null,null,Mre(e,t),null,r,c);d.setModel(n),n.history=p,await d.onTrainBegin(),n.stopTraining_=!1;let f=t.initialEpoch==null?0:t.initialEpoch,g=await e.iterator();for(;f<t.epochs;){const m={};await d.onEpochBegin(f);let y=0,w=0;for(s||(g=await e.iterator());!s||y<t.batchesPerEpoch;){const v=await g.next();if(s&&v.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(v.value!=null){const{xs:I,ys:_}=nz(n,v.value),N={};N.batch=w,N.size=I[0].shape[0],await d.onBatchBegin(w,N);const T=[];if(t.classWeight!=null){const S=ez(t.classWeight,n.outputNames);for(let A=0;A<S.length;++A)T.push(await tz(_[A],null,S[A]))}const E=I.concat(_).concat(T),k=a(E);et(E);for(let S=0;S<l.length;++S){const A=l[S],P=k[S];N[A]=P,Pn(P)}await d.onBatchEnd(w,N),jM(N),w++,y++}if(s?y>=t.batchesPerEpoch:v.done){if(r){let I;GR(t.validationData)?I=Gt(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):I=Gt(n.evaluate(i,o,{batchSize:t.validationBatchSize==null?Ore:t.validationBatchSize,verbose:0}));for(let _=0;_<n.metricsNames.length;++_)m[`val_${n.metricsNames[_]}`]=I[_]}break}if(n.stopTraining_)break}if(await d.onEpochEnd(f,m),f++,n.stopTraining_)break}return await d.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function Mre(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function GR(n){return typeof n.iterator=="function"}function zre(n){return typeof n.next=="function"}async function Vre(n,e,t){t=t||{};const s=t.batches!=null,r=n.testFunction;let i=[];if(t.verbose>0)throw new rt("Verbose mode is not implemented yet.");O(!s||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const o=zre(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<t.batches;){const c=await o.next();if(i=Y(()=>{if(c.value){const{xs:u,ys:h}=nz(n,c.value),d=u.concat(h),p=Y(()=>r(d));if(et(d),l===0)for(let g=0;g<p.length;++g)i.push(Ue(0));const f=d[0].shape[0];for(let g=0;g<p.length;++g){const m=p[g],y=i[g];i[g]=Y(()=>pe(i[g],W(f,m))),l>0&&et(y)}et(p),a+=f,++l}return i}),c.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<i.length;++c){const u=i[c];i[c]=Me(i[c],a),et(u)}return Ls(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Gv(n){O(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function _d(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(s=>Pl(s,e,t-e)):Pl(n,e,t-e)}function $I(n,e){return Y(()=>n==null?null:Array.isArray(n)?n.map(t=>$I(t,e)):LM(n,e.dtype==="int32"?e:ve(e,"int32")))}function Hv(n,e){const t=[];let s=0,r=null;for(;s<n;)r=s+e,r>=n&&(r=n),t.push([s,r]),s=r;return t}function sz(n){const e=[];n instanceof kt&&(n=[n]);for(let t=0;t<n.length;++t){const s=n[t];if(s.rank===1)e.push(qm(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function Xr(n,e){if(n==null)return;const t=[];if(e instanceof kt)t.push(e.id);else if(Array.isArray(e))e.forEach(r=>t.push(r.id));else if(e!=null)for(const r in e){const i=e[r];t.push(i.id)}const s=[];if(n instanceof kt)t.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{t.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const i=n[r];t.indexOf(i.id)===-1&&s.push(i)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Bre(n){return n instanceof kt}function DI(n){return Array.isArray(n)}function HR(n){return!Bre(n)&&!DI(n)}function qR(n,e,t,s=!0,r=""){if(e==null||e.length===0){if(n!=null){let o=!1;if(DI(n)&&n.length>0)o=!0;else if(HR(n)){for(const a in n)if(n.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new H(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(o=>null);let i;if(HR(n)){n=n,i=[];for(const o of e){if(n[o]==null)throw new H(`No data provided for "${o}". Need data for each key in: ${e}`);i.push(n[o])}}else if(DI(n)){if(n=n,n.length!==e.length)throw new H(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);i=n}else{if(n=n,e.length>1)throw new H(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);i=[n]}if(i=sz(i),t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new H(`Error when checking ${r}: expected ${e[o]} to have ${t[o].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<t[o].length;++l){if(l===0&&!s)continue;const c=a.shape[l],u=t[o][l];if(u!=null&&u>=0&&c!==u)throw new H(`${r} expected a batch of elements where each example has shape [${t[o].slice(1,t[o].length)}] (i.e.,tensor shape [*,${t[o].slice(1,t[o].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return i}function jre(n,e,t){const s=ma(n.map(i=>i.shape[0]));s.sort();const r=ma(e.map(i=>i.shape[0]));if(r.sort(),s.length>1)throw new H(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(r.length>1)throw new H(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(i=>i.shape))}`);if(s.length>0&&r.length>0&&!wt(s,r))throw new H(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function Ure(n,e,t){const s=[xc,v0,Hp];for(let r=0;r<n.length;++r){const i=n[r],o=e[r],a=t[r];if(o!=null){if(o===Hp&&i.shape[i.shape.length-1]===1)throw new H(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(o)!==-1){const l=i.shape.slice(1),c=a.slice(1);for(let u=0;u<l.length;++u){const h=l[u],d=c[u];if(d!=null&&h!==d)throw new H(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function KR(n,e,t,s=!0,r=""){let i;if(Array.isArray(n)){if(n.length!==e.length)throw new H(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);i=n}else{if(e.length>1)throw new H(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);i=[n]}if(t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new H(`Error when checking ${r}: expected ${e[o]} to have ${t[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<t[o].length;++l){if(l===0&&!s)continue;const c=a.shape[l],u=t[o][l];if(u!=null&&u!==c)throw new H(`Error when checking ${r}: expected ${e[o]} to have shape ${JSON.stringify(t[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function Wre(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(s=>t);{const s=[];for(const r of e){let i=t.hasOwnProperty(r)?t[r]:[];Array.isArray(i)||(i=[i]),s.push(i)}return s}}const Gre="layers-model";class yo extends Qr{constructor(e){super(e),this.isTraining=!1}summary(e,t,s=console.log){if(!this.built)throw new H("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Ere(this,e,t,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=Cre(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Vo))throw new H("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new H(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),t.push(Wv(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new H(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(a=>Wv(a))}else{const o=Wv(e.loss);this.outputs.forEach(a=>{t.push(o)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Dl("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const r=Wre(e.metrics,this.outputNames),i=(o,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,o])};Dl("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=r[o];(c=>{const u="";let h,d,p;for(const f of c){if(typeof f=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(f)!==-1){const m=this.internalOutputShapes[o];m[m.length-1]===1||this.lossFunctions[o]===v0?["accuracy","acc"].indexOf(f)!==-1?d=_C:["crossentropy","ce"].indexOf(f)!==-1&&(d=YM):this.lossFunctions[o]===yb?["accuracy","acc"].indexOf(f)!==-1?d=QM:["crossentropy","ce"].indexOf(f)!==-1&&(d=ZM):["accuracy","acc"].indexOf(f)!==-1?d=NC:["crossentropy","ce"].indexOf(f)!==-1&&(d=AC);let y;["accuracy","acc"].indexOf(f)!==-1?y="acc":["crossentropy","ce"].indexOf(f)!==-1&&(y="ce"),p=d,h=u+y}else p=Tre(f),h=u+zg(f);let g;Dl(h,()=>{g=p}),i(o,h,g)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,s={}){const r=s.batchSize==null?32:s.batchSize;Gv(r);const i=!0,o=this.standardizeUserDataXY(e,t,i,r);try{const a=o[0].concat(o[1]);this.makeTestFunction();const l=this.testFunction,c=this.testLoop(l,a,r,s.verbose,s.steps);return Ls(c)}finally{Xr(o[0],e),Xr(o[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),Vre(this,e,t)}checkNumSamples(e,t,s,r="steps"){let i;if(s!=null){if(i=null,t!=null)throw new H(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new H(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return i}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new H("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(t),r=s?t:[t],i=this.retrieveSymbolicTensors(r),o=new ca;if(e instanceof kt&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new H(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)o.add(this.inputs[l],e[l])}else for(const l of this.inputs){const c=e[l.name];if(c==null)throw new H(`No value is provided for the model's input ${l.name}`);o.add(l,c)}const a=jd(i,o);return s?a:a[0]}retrieveSymbolicTensors(e){const t=Kl(null,e.length);let s=e.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],o=i.map(a=>a.name);for(let a=0;a<e.length;++a){const l=o.indexOf(e[a]);if(l!==-1&&(t[a]=i[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw t.forEach((i,o)=>{i==null&&r.push(e[o])}),new H(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,s=!1){return Y(()=>{const r=this.checkNumSamples(e);if(s)throw new rt("Verbose predictLoop() is not implemented yet.");const i=Hv(r,t),o=this.outputs.map(a=>[]);for(let a=0;a<i.length;++a)Y(()=>{const c=i[a][0],u=i[a][1],h=_d(e,c,u),d=[];if(Array.isArray(h))for(let f=0;f<h.length;++f)d.push({key:this.inputs[f],value:h[f]});else d.push({key:this.inputs[0],value:h});const p=new ca(d);return jd(this.outputs,p)}).forEach((c,u)=>o[u].push(c));return Ls(o.map(a=>xn(a,0)))})}predict(e,t={}){const s=sz(e);KR(s,this.inputNames,this.feedInputShapes,!1);try{const r=t.batchSize==null?32:t.batchSize;return Gv(r),this.predictLoop(s,r)}finally{Xr(s,e)}}predictOnBatch(e){KR(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,s=!0,r){if(this.optimizer_==null)throw new Br("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===yb?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(e=qR(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=qR(t,this.feedOutputNames,i,!1,"target"),jre(e,t),Ure(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new H(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,s,r,i=!0,o){const[a,l]=this.standardizeUserDataXY(e,t,i,o);if(s!=null)throw new Error("sample weight is not supported yet.");let c=null;if(r!=null){const u=ez(r,this.outputNames);c=[];for(let h=0;h<u.length;++h)c.push(await tz(l[h],null,u[h]))}return[a,l,c]}testLoop(e,t,s,r=0,i){return Y(()=>{const o=this.checkNumSamples(t,s,i,"steps"),a=[];if(r>0)throw new rt("Verbose mode is not implemented yet.");if(i!=null)throw new rt("steps mode in testLoop() is not implemented yet");{const l=Hv(o,s),c=ss(fi(0,o));for(let u=0;u<l.length;++u){const h=l[u][0],d=l[u][1],p=Pl(c,h,d-h),f=$I(t,p),g=e(f);if(u===0)for(let m=0;m<g.length;++m)a.push(Ue(0));for(let m=0;m<g.length;++m){const y=g[m];a[m]=pe(a[m],W(d-h,y))}}for(let u=0;u<a.length;++u)a[u]=Me(a[u],o)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let s=0;s<e.length;++s){const r=e[s];let i=r;if($R(e,r)>1){const o=$R(e.slice(0,s),r);i+=`_${o}`}t.push(i)}return t}makeTrainFunction(){return e=>{const t=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const h=[];for(let g=0;g<this.inputs.length;++g)h.push({key:this.inputs[g],value:s[g]});const d=new ca(h),p=jd(this.outputs,d,{training:!0});let f;for(let g=0;g<this.lossFunctions.length;++g){const m=this.lossFunctions[g];let y=m(r[g],p[g]);i[g]!=null&&(y=Pre(y,i[g]));const w=un(y);t.push(w),g===0?f=y:f=pe(f,y)}for(let g=0;g<this.metricsTensors.length;++g){let m;if(this.outputs.length>1&&g<this.outputs.length)m=t[g];else{const y=this.metricsTensors[g][0],w=this.metricsTensors[g][1];m=un(y(r[w],p[w]))}Pn(m),o.push(m)}return f=un(f),this.calculateLosses().forEach(g=>{f=pe(f,g)}),f},l=this.collectedTrainableWeights.map(h=>h.read()),c=!0;return[this.optimizer_.minimize(a,c,l)].concat(o)}}makeTestFunction(){this.testFunction=e=>Y(()=>{const t=[];let s;const r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let c=0;c<this.inputs.length;++c)o.push({key:this.inputs[c],value:r[c]});const a=new ca(o),l=jd(this.outputs,a);for(let c=0;c<this.lossFunctions.length;++c){const u=this.lossFunctions[c],h=un(u(i[c],l[c]));c===0?s=h:s=pe(s,h),t.push(s)}for(let c=0;c<this.metricsTensors.length;++c){const u=this.metricsTensors[c][0],h=this.metricsTensors[c][1],d=un(u(i[h],l[h]));t.push(d)}return t})}async fit(e,t,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,i,o,a,l,c,u,h,d;try{const p=s.batchSize==null?32:s.batchSize;Gv(p);const f=!1,g=await this.standardizeUserData(e,t,s.sampleWeight,s.classWeight,f,p);r=g[0],i=g[1],d=g[2];let m=!1,y;if(s.validationData!=null&&s.validationData.length>0){if(m=!0,s.validationData.length===2)l=s.validationData[0],c=s.validationData[1];else throw s.validationData.length===3?new rt("validationData including sample weights is not supported yet."):new H(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const k=!0,S=await this.standardizeUserData(l,c,null,null,k,p);u=S[0],h=S[1],y=u.concat(h)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){m=!0;const k=Math.floor(r[0].shape[0]*(1-s.validationSplit)),S=r[0].shape[0];u=_d(r,k,S),o=r,r=_d(r,0,k),h=_d(i,k,S),a=i,i=_d(i,0,k),y=u.concat(h)}else s.validationSteps!=null&&(m=!0);const w=r.concat(i).concat(d);this.checkTrainableWeightsConsistency();const v=this.makeTrainFunction(),I=this.getDedupedMetricsNames();let _,N;m?(this.makeTestFunction(),_=this.testFunction,N=I.slice().concat(I.map(k=>"val_"+k))):(_=null,y=[],N=I.slice());const T=HM(s.callbacks,s.yieldEvery);return await this.fitLoop(v,w,I,p,s.epochs,s.verbose,T,_,y,s.shuffle,N,s.initialEpoch,null,null)}finally{this.isTraining=!1,Xr(r,e),Xr(i,t),Xr(o,e),Xr(a,t),Xr(u,l),Xr(h,c),d!=null&&et(d)}}async fitLoop(e,t,s,r,i,o,a,l,c,u,h,d,p,f){r==null&&(r=32),i==null&&(i=1),u==null&&(u=!0),d==null&&(d=0);let g=!1;if(l!=null&&c!=null&&(g=!0),f!=null&&(g=!0,p==null))throw new H("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const m=this.checkNumSamples(t,r,p,"steps_per_epoch");let y;m!=null&&(y=fi(0,m)),o==null&&(o=1);const{callbackList:w,history:v}=qM(a,o,i,d,m,p,r,g,h);w.setModel(this),this.history=v,await w.onTrainBegin(),this.stopTraining_=!1;for(let I=d;I<i;++I){await w.onEpochBegin(I);const _={};if(p!=null)throw new rt("stepsPerEpoch mode is not implemented yet.");{if(u==="batch")throw new rt("batch shuffling is not implemneted yet");u&&JS(y);const N=ss(y),T=Hv(m,r);for(let E=0;E<T.length;++E){const k={};if(await w.onBatchBegin(E,k),Y(()=>{const S=T[E][0],A=T[E][1],P=Pl(N,S,A-S);k.batch=E,k.size=A-S;const D=$I(t,P),V=e(D);for(let U=0;U<s.length;++U){const q=s[U],J=V[U];k[q]=J,Pn(J)}if(E===T.length-1&&g){const U=this.testLoop(l,c,r);for(let q=0;q<s.length;++q){const J=s[q],K=U[q];Pn(K),_["val_"+J]=K}}}),await w.onBatchEnd(E,k),jM(k),this.stopTraining_)break}N.dispose()}if(await w.onEpochEnd(I,_),this.stopTraining_)break}return await w.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return Lre(this,e,t)}async trainOnBatch(e,t){const s=await this.standardizeUserData(e,t),r=s[0],i=s[1],a=this.makeTrainFunction()(r.concat(i)),l=[];for(const c of a){const u=await c.data();l.push(u[0])}return et(a),Xr(s[0],e),Xr(s[1],t),Ls(l)}getNamedWeights(e){const t=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,i=this.getWeights(s);for(let o=0;o<r.length;++o)s&&!r[o].trainable||t.push({name:r[o].originalName,tensor:i[o]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=lb().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-lb().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=ao(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>ao(t))}else{const t=Object.keys(this.loss);e={};const s=this.loss;for(const r of t)if(typeof s[r]=="string")e[r]=ao(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[ao(zg(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>ao(zg(e)));{const e={};for(const t in this.metrics)e[t]=ao(zg(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=qp(e.optimizer_config),s=ai(t);let r;if(typeof e.loss=="string")r=dl(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(o=>dl(o));else if(e.loss!=null){r={};for(const o in e.loss)r[o]=dl(e.loss[o])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(o=>dl(o));else if(e.metrics!=null){i={};for(const o in e.metrics)i[o]=dl(e.metrics[o])}this.compile({loss:r,metrics:i,optimizer:s})}async save(e,t){if(typeof e=="string"){const c=hF(e);if(c.length===0)throw new H(`Cannot find any save handlers for URL '${e}'`);if(c.length>1)throw new H(`Found more than one (${c.length}) save handlers for URL '${e}'`);e=c[0]}if(e.save==null)throw new H("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await dI(this.getNamedWeights(t)),r=!1,i=null,a={modelTopology:this.toJSON(i,r),format:Gre,generatedBy:`TensorFlow.js tfjs-layers v${I0}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const c="optimizer",{data:u,specs:h}=await dI(await this.optimizer.getWeights(),c);s.specs.push(...h),s.data=cF([s.data,u])}return this.userDefinedMetadata!=null&&(UR(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){UR(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}yo.className="Model";me(yo);class rz extends yo{}rz.className="Functional";me(rz);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Hre(n,e){"modelTopology"in n||(n={modelTopology:n}),n=n;let t=n.modelTopology;t.model_config!=null&&(t=t.model_config);const s=qp(t),r=ai(s,e);if(n.weightsManifest!=null){const i=await _L(n.weightsManifest,n.pathPrefix,r.weights.map(a=>a.originalName)),o={};for(const a of r.weights)o[a.originalName]=i[a.originalName];r.loadWeights(o),et(i)}return r}async function qre(n,e){if(e==null&&(e={}),typeof n=="string"){const t=dF(n,e);if(t.length===0)t.push(RL(n,e));else if(t.length>1)throw new H(`Found more than one (${t.length}) load handlers for URL '${n}'`);n=t[0]}return Kre(n,void 0,e)}async function Kre(n,e,t){if(t==null&&(t={}),n.load==null)throw new H("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await n.load();let r=s.modelTopology;r.model_config!=null&&(r=r.model_config);const i=t.strict==null?!0:t.strict,o=s.weightData!=null&&s.weightSpecs!=null&&i,a=ai(qp(r),e,o),l=s.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new H("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:c,optimizerWeights:u}=Xre(s.weightData,s.weightSpecs);a.loadWeights(c,i),a.optimizer!=null&&u.length>0&&await a.optimizer.setWeights(u),et(c),et(u.map(h=>h.tensor))}return a}function Xre(n,e){const t=uk(n,e),s={},r=[];return e.forEach(i=>{i.group==="optimizer"?r.push({name:i.name,tensor:t[i.name]}):s[i.name]=t[i.name]}),{modelWeights:s,optimizerWeights:r}}class Xl extends yo{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:u0("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new H(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof Xl||e instanceof yo;let s;if(t){if(s=e,s.outputs.length!==1)throw new H("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new H("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new H("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=BM({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(t)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new H(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new H("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=VM(this.outputs[0])}this.inboundNodes=[],new x0({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Kl(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(Ft(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new yo({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,s=console.log){this.built||this.build(),super.summary(e,t,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,s={}){if(!this.built)throw new Br("The model needs to be compiled before being used.");return this.model.evaluate(e,t,s)}async evaluateDataset(e,t){if(!this.built)throw new Br("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,s={}){if(!this.built)throw new Br("The model needs to be compiled before being used.");return this.model.fit(e,t,s)}async fitDataset(e,t){if(!this.built)throw new Br("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,s={},r=!1){let i,o={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new H("Legacy serialization format not supported yet.");i=t}else O(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=t.layers,delete t.layers,o=t;const a=new e(o);if(!(a instanceof Xl))throw new rt(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of i){const u=ai(l,void 0,r);r&&u.setFastWeightInitDuringBuild(!0),a.add(u)}return a}set stopTraining(e){if(this.model==null)throw new H("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new H("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const s={};s.className=t.getClassName(),s.config=t.getConfig(),e.push(s)}return{name:this.name,layers:e}}}Xl.className="Sequential";me(Xl);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Yre(n){return new yo(n)}function Qre(n){return new Xl(n)}function iz(n){return BM(n)}function Zre(n,e){gr.registerCallbackConstructor(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Ys=class extends yc{getConfig(){return{}}};class oz extends Ys{apply(e,t=1){return yse(e,t)}}oz.className="elu";me(oz);class az extends Ys{apply(e){return zw(e)}}az.className="selu";me(az);class lz extends Ys{apply(e){return vi(e)}}lz.className="relu";me(lz);class cz extends Ys{apply(e){return Y(()=>Ca(6,vi(e)))}}cz.className="relu6";me(cz);class uz extends Ys{apply(e){return e}}uz.className="linear";me(uz);class hz extends Ys{apply(e){return oi(e)}}hz.className="sigmoid";me(hz);class dz extends Ys{apply(e){return xse(e)}}dz.className="hardSigmoid";me(dz);class pz extends Ys{apply(e){return fc(e)}}pz.className="softplus";me(pz);class fz extends Ys{apply(e){return bse(e)}}fz.className="softsign";me(fz);class mz extends Ys{apply(e){return Ul(e)}}mz.className="tanh";me(mz);let RC=class extends Ys{apply(e,t=-1){return zm(e,t)}};RC.className="softmax";me(RC);class gz extends Ys{apply(e,t=-1){return $w(e,t)}}gz.className="logSoftmax";me(gz);class yz extends Ys{apply(e,t=1){return Y(()=>W(oi(W(e,t)),e))}}yz.className="swish";me(yz);class bz extends Ys{apply(e){return Y(()=>W(e,Ul(fc(e))))}}bz.className="mish";me(bz);function _a(n){return n.getClassName()}function qv(n,e={}){return Hm(n,br.getMap().classNameMap,e,"activation")}function Na(n){if(n==null){const e={};return e.className="linear",e.config={},qv(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},qv(e)}else return n instanceof Ys?n:qv(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $C(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class xz extends yc{}class Qm extends xz{constructor(e){super(),$C(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return Y(()=>{let t=En([1]);return this.hasL1&&(t=pe(t,Pe(W(this.l1,Tn(e))))),this.hasL2&&(t=pe(t,Pe(W(this.l2,Km(e))))),G(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}Qm.className="L1L2";me(Qm);function Jre(n){return $C(n),new Qm({l1:n!=null?n.l1:null,l2:0})}function eie(n){return $C(n),new Qm({l2:n!=null?n.l2:null,l1:0})}const XR={l1l2:"L1L2"};function Ht(n){return hC(n)}function YR(n,e={}){return Hm(n,br.getMap().classNameMap,e,"regularizer")}function an(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in XR?XR[n]:n,config:{}};return YR(t)}else return n instanceof xz?n:YR(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class DC extends mt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=Xe(e);let s=vi(e);return this.maxValue!=null&&(s=Hs(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}DC.className="ReLU";me(DC);class PC extends mt{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=Xe(e);return Nm(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}PC.className="LeakyReLU";me(PC);class OC extends mt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=on(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=an(e.alphaRegularizer),this.alphaConstraint=Mn(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new H(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Ft(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new _n({ndim:e.length,axes:s})],this.built=!0}call(e,t){return e=Xe(e),Fm(e,this.alpha.read())}getConfig(){const e={alphaInitializer:hn(this.alphaInitializer),alphaRegularizer:Ht(this.alphaRegularizer),alphaConstraint:Ln(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}OC.className="PReLU";me(OC);let FC=class extends mt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new rt(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=Xe(e);return Lh(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};FC.className="ELU";me(FC);class LC extends mt{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const s=Xe(e);return W(s,ve(Rs(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}LC.className="ThresholdedReLU";me(LC);class MC extends mt{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new RC().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return Y(()=>{let s=Xe(e);const r=t.mask;if(r!=null){const i=W(Ne(Vs(s.shape),ve(r,s.dtype)),Ue(-1e9));s=pe(s,i)}return this.axis instanceof Array?this.axis.length>1?qs(Ne(s,Rm(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}MC.className="Softmax";me(MC);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tu(n,e,t){if(typeof n=="number")return Kl(n,e);if(n.length!==e)throw new H(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let s=0;s<e;++s){const r=n[s];if(!pse(r))throw new H(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function li(n,e,t,s,r=1){if(n==null)return n;const i=e+(e-1)*(r-1);let o;return t==="same"?o=n:o=n-i+1,Math.floor((o+s-1)/s)}function Di(n,e,t,s){if(n==null)return null;if(s==="valid")n=n*e+Ea([t-e,0]);else if(s==="same")n=n*e;else throw new H(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function zC(n,e){return Y(()=>(In(e),e==="channelsFirst"?vt(n,[0,2,3,1]):n))}function wz(n,e){return Y(()=>(In(e),e==="channelsFirst"?vt(n,[0,2,3,4,1]):n))}function tie(n,e,t,s=1,r="valid",i,o=1){return Y(()=>{if(i==null&&(i=mi()),In(i),n.shape.length!==3)throw new H(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new H(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new H(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if(i==="channelsFirst"&&(n=vt(n,[0,2,1])),r==="causal")throw new rt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=Cw(n,e,s,r==="same"?"same":"valid","NWC",o);return t!=null&&(a=Ii(a,t)),a})}function QR(n,e,t,s=[1,1],r="valid",i,o,a=null){return Y(()=>{if(i==null&&(i=mi()),In(i),n.rank!==3&&n.rank!==4)throw new H(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new H(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=zC(n,i);if(r==="causal")throw new rt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=fL({x:l,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:a}),i==="channelsFirst"&&(l=vt(l,[0,3,1,2])),l})}function nie(n,e,t,s=[1,1,1],r="valid",i,o){return Y(()=>{if(i==null&&(i=mi()),In(i),n.rank!==4&&n.rank!==5)throw new H(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new H(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=wz(n,i);if(r==="causal")throw new rt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=Lk(a,e,s,r==="same"?"same":"valid","NDHWC",o),t!=null&&(a=Ii(a,t)),i==="channelsFirst"&&(a=vt(a,[0,4,1,2,3])),a})}class S0 extends mt{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",S0.verifyArgs(t),this.rank=e,Un(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new rt(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=tu(t.kernelSize,e,"kernelSize"),this.strides=tu(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,_r(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,In(this.dataFormat),this.activation=Na(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=on(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Mn(t.biasConstraint),this.biasRegularizer=an(t.biasRegularizer),this.activityRegularizer=an(t.activityRegularizer),this.dilationRate=tu(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new H(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new H(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new H(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if($i("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!dC(e.kernelSize,"number",1,3))throw new H(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:_a(this.activation),useBias:this.useBias,biasInitializer:hn(this.biasInitializer),biasRegularizer:Ht(this.biasRegularizer),activityRegularizer:Ht(this.activityRegularizer),biasConstraint:Ln(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class Gh extends S0{constructor(e,t){super(e,t),this.kernel=null,Gh.verifyArgs(t),this.filters=t.filters,Un(this.filters,"filters"),this.kernelInitializer=on(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Mn(t.kernelConstraint),this.kernelRegularizer=an(t.kernelRegularizer)}build(e){e=Ft(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new H(`The channel dimension of the input should be defined. Found ${e[t]}`);const s=e[t],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:s}}],this.built=!0}call(e,t){return Y(()=>{e=Xe(e);let s;const r=this.bias==null?null:this.bias.read(),i=RM(this.activation.getClassName());if(i!=null&&this.rank===2)s=QR(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)s=tie(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=QR(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=nie(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new rt("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=Ft(e);const t=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<s.length;++i){const o=li(s[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);t.push(o)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:hn(this.kernelInitializer),kernelRegularizer:Ht(this.kernelRegularizer),kernelConstraint:Ln(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new H(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Hh extends Gh{constructor(e){super(2,e),Hh.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!dC(e.kernelSize,"number",1,2))throw new H(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Hh.className="Conv2D";me(Hh);class qh extends Gh{constructor(e){super(3,e),qh.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new H(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}qh.className="Conv3D";me(qh);class VC extends Hh{constructor(e){if(super(e),this.inputSpec=[new _n({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new H(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ft(e),e.length!==4)throw new H("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new H("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new _n({ndim:4,axes:{[t]:s}})],this.built=!0}call(e,t){return Y(()=>{let s=Xe(e);if(s.shape.length!==4)throw new H(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const l=r[o],c=r[a],u=this.kernelSize[0],h=this.kernelSize[1],d=this.strides[0],p=this.strides[1],f=Di(l,d,u,this.padding),g=Di(c,p,h,this.padding),m=[i,f,g,this.filters];this.dataFormat!=="channelsLast"&&(s=vt(s,[0,2,3,1]));let y=Ew(s,this.kernel.read(),m,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(y=vt(y,[0,3,1,2])),this.bias!=null&&(y=Ii(y,this.bias.read(),this.dataFormat)),this.activation!=null&&(y=this.activation.apply(y)),y})}computeOutputShape(e){e=Ft(e);const t=e.slice();let s,r,i;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3):(s=3,r=1,i=2);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],c=this.strides[1];return t[s]=this.filters,t[r]=Di(t[r],l,o,this.padding),t[i]=Di(t[i],c,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}VC.className="Conv2DTranspose";me(VC);class BC extends qh{constructor(e){if(super(e),this.inputSpec=[new _n({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new H(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ft(e),e.length!==5)throw new H("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new H("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new _n({ndim:5,axes:{[t]:s}})],this.built=!0}call(e,t){return Y(()=>{let s=Xe(e);if(s.shape.length!==5)throw new H(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a,l;this.dataFormat==="channelsFirst"?(l=2,o=3,a=4):(l=1,o=2,a=3);const c=r[l],u=r[o],h=r[a],d=this.kernelSize[0],p=this.kernelSize[1],f=this.kernelSize[2],g=this.strides[0],m=this.strides[1],y=this.strides[2],w=Di(c,g,d,this.padding),v=Di(u,m,p,this.padding),I=Di(h,y,f,this.padding),_=[i,w,v,I,this.filters];this.dataFormat!=="channelsLast"&&(s=vt(s,[0,2,3,4,1]));let N=Mk(s,this.kernel.read(),_,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(N=vt(N,[0,4,1,2,3])),this.bias!==null&&(N=Ii(N,this.bias.read(),this.dataFormat)),this.activation!==null&&(N=this.activation.apply(N)),N})}computeOutputShape(e){e=Ft(e);const t=e.slice();let s,r,i,o;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3,o=4):(s=4,r=1,i=2,o=3);const a=this.kernelSize[0],l=this.kernelSize[1],c=this.kernelSize[2],u=this.strides[0],h=this.strides[1],d=this.strides[2];return t[s]=this.filters,t[r]=Di(t[r],u,a,this.padding),t[i]=Di(t[i],h,l,this.padding),t[o]=Di(t[o],d,c,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}BC.className="Conv3DTranspose";me(BC);class vz extends Gh{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new H("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new H("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new H(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=on(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=an(t.depthwiseRegularizer),this.depthwiseConstraint=Mn(t.depthwiseConstraint),this.pointwiseInitializer=on(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=an(t.pointwiseRegularizer),this.pointwiseConstraint=Mn(t.pointwiseConstraint)}build(e){if(e=Ft(e),e.length<this.rank+2)throw new H(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new H(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const s=e[t],r=this.kernelSize.concat([s,this.depthMultiplier]),i=[];for(let a=0;a<this.rank;++a)i.push(1);i.push(s*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new _n({ndim:this.rank+2,axes:{[t]:s}})],this.built=!0}call(e,t){return Y(()=>{e=Xe(e);let s;if(this.rank===1)throw new rt("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=vt(e,[0,2,3,1])),s=Vw(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=Ii(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=vt(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=hn(this.depthwiseInitializer),e.pointwiseInitializer=hn(this.pointwiseInitializer),e.depthwiseRegularizer=Ht(this.depthwiseRegularizer),e.pointwiseRegularizer=Ht(this.pointwiseRegularizer),e.depthwiseConstraint=Ln(this.depthwiseConstraint),e.pointwiseConstraint=Ln(this.pointwiseConstraint),e}}vz.className="SeparableConv";class jC extends vz{constructor(e){super(2,e)}}jC.className="SeparableConv2D";me(jC);class Zm extends Gh{constructor(e){super(1,e),Zm.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!dC(e.kernelSize,"number",1,1))throw new H(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}Zm.className="Conv1D";me(Zm);class UC extends mt{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return Y(()=>{if(e=Xe(e),this.dataFormat==="channelsLast"){const s=Mg(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Mg(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=Mg(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Mg(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}UC.className="Cropping2D";me(UC);class WC extends mt{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,In(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,use(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,s]}else{const t=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],t,s,e[3]]}}call(e,t){return Y(()=>{let s=Xe(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=vt(s,[0,2,3,1]);const i=this.size[0]*r[2],o=this.size[1]*r[3],a=this.interpolation==="nearest"?Vr.resizeNearestNeighbor(s,[i,o]):Vr.resizeBilinear(s,[i,o]);return vt(a,[0,3,1,2])}else{const i=this.size[0]*r[1],o=this.size[1]*r[2];return this.interpolation==="nearest"?Vr.resizeNearestNeighbor(s,[i,o]):Vr.resizeBilinear(s,[i,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}WC.className="UpSampling2D";me(WC);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sie(n,e,t=[1,1],s="valid",r,i){return Y(()=>{r==null&&(r=mi()),In(r);let o=zC(n,r);if(n.rank!==4)throw new H(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new H(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=Fh(o,e,t,s==="same"?"same":"valid","NHWC",i),r==="channelsFirst"&&(o=vt(o,[0,3,1,2])),o})}class GC extends S0{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=on(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Mn(e.depthwiseConstraint),this.depthwiseRegularizer=an(e.depthwiseRegularizer)}build(e){if(e=Ft(e),e.length<4)throw new H(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new H(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const s=e[t],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return Y(()=>{e=Xe(e);let s=sie(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=Ii(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=Ft(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=li(t,this.kernelSize[0],this.padding,this.strides[0]),o=li(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,i,o]:[e[0],i,o,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=hn(this.depthwiseInitializer),e.depthwiseRegularizer=Ht(this.depthwiseRegularizer),e.depthwiseConstraint=Ln(this.depthwiseRegularizer),e}}GC.className="DepthwiseConv2D";me(GC);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Iz(n,e,t,s){if(Array.isArray(n)){if(e!=null||t!=null)throw new H("When inputs is an array, neither initialState or constants should be provided");s!=null&&(t=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function r(i){return i==null||Array.isArray(i)?i:[i]}return e=r(e),t=r(t),{inputs:n,initialState:e,constants:t}}function Sz(n,e,t,s=!1,r,i,o=!1,a=!1){return Y(()=>{const l=e.shape.length;if(l<3)throw new H(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(fi(2,l));if(e=vt(e,c),i!=null)throw new rt("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=ve(ve(r,"bool"),"float32"),r.rank===l-1&&(r=es(r,-1)),r=vt(r,c)),s&&(e=Cr(e,0),r!=null&&(r=Cr(r,0)));const u=[];let h,d=t;const p=e.shape[0],f=Er(e);let g;r!=null&&(g=Er(r));for(let y=0;y<p;++y){const w=f[y],v=Y(()=>n(w,d));if(r==null)h=v[0],d=v[1];else{const I=Y(()=>{const _=g[y],N=Ne(cr(_),_),T=pe(W(v[0],_),W(d[0],N)),E=d.map((k,S)=>pe(W(v[1][S],_),W(k,N)));return{output:T,newStates:E}});h=I.output,d=I.newStates}a&&u.push(h)}let m;return a&&(m=Es(u,1)),[h,m,d]})}class Si extends mt{constructor(e){super(e);let t;if(e.cell==null)throw new H("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new C0({cells:e.cell}):t=e.cell,t.stateSize==null)throw new H("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new _n({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return fi(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){_I(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const s=t[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const i=[];for(const o of t)i.push([e[0],o]);return[r].concat(i)}else return r}computeMask(e,t){return Y(()=>{Array.isArray(t)&&(t=t[0]);const s=this.returnSequences?t:null;if(this.returnState){const r=this.states.map(i=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let s=0;s<e;++s)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new rt("Constants support is not implemented in RNN yet.");_I(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new _n({shape:[t,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!wt(this.stateSpec.map(o=>o.shape[o.shape.length-1]),i))throw new H(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(o=>new _n({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){Y(()=>{if(!this.stateful)throw new Ri("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new H("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>En([s,r])):this.states_=[En([s,this.cell.stateSize])];else if(e==null)et(this.states_),this.keptStates!=null&&(et(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>En([s,r])):this.states_[0]=En([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new H(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):et(this.states_);for(let r=0;r<this.states_.length;++r){const i=e[r],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,o];if(!wt(i.shape,a))throw new H(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${i.shape}`);this.states_[r]=i}}this.states_=this.states_.map(r=>Pn(r.clone()))})}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const i=Iz(e,s,r,this.numConstants);e=i.inputs,s=i.initialState,r=i.constants;let o=[],a=[];if(s!=null){t.initialState=s,o=o.concat(s),this.stateSpec=[];for(const c of s)this.stateSpec.push(new _n({shape:c.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(t.constants=r,o=o.concat(r),this.numConstants=r.length),o[0]instanceof gi){const c=[e].concat(o),u=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=u;const d=super.apply(c,t);return this.inputSpec=h,d}else return super.apply(e,t)}call(e,t){return Y(()=>{const s=t==null?null:t.mask,r=t==null?null:t.training;let i=t==null?null:t.initialState;e=Xe(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==o)throw new H(`RNN Layer has ${o} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},c=Sz((f,g)=>{const m=this.cell.call([f].concat(g),a);return[m[0],m.slice(1)]},e,i,this.goBackwards,s,null,this.unroll,this.returnSequences),u=c[0],h=c[1],d=c[2];this.stateful&&this.resetStates(d,r);const p=this.returnSequences?h:u;return this.returnState?[p].concat(d):p})}getInitialState(e){return Y(()=>{let t=En(e.shape);return t=Pe(t,[1,2]),t=qm(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?CI(t,[1,s]):t):this.cell.stateSize>1?[CI(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===Si.className&&(t.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),t)}static fromConfig(e,t,s={}){const r=t.cell,i=ai(r,s);return new e(Object.assign(t,{cell:i}))}}Si.className="RNN";me(Si);class Jm extends mt{}class k0 extends Jm{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Un(this.units,"units"),this.activation=Na(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=on(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=on(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=on(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=an(e.kernelRegularizer),this.recurrentRegularizer=an(e.recurrentRegularizer),this.biasRegularizer=an(e.biasRegularizer),this.kernelConstraint=Mn(e.kernelConstraint),this.recurrentConstraint=Mn(e.recurrentConstraint),this.biasConstraint=Mn(e.biasConstraint),this.dropout=ku([1,Ea([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ku([1,Ea([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ft(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return Y(()=>{if(e=e,e.length!==2)throw new H(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Aa({ones:()=>cr(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Aa({ones:()=>cr(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let i;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?i=Bi(W(e,o),this.kernel.read()):i=Bi(e,this.kernel.read()),this.bias!=null&&(i=Ii(i,this.bias.read())),a!=null&&(s=W(s,a));let l=pe(i,Bi(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:_a(this.activation),useBias:this.useBias,kernelInitializer:hn(this.kernelInitializer),recurrentInitializer:hn(this.recurrentInitializer),biasInitializer:hn(this.biasInitializer),kernelRegularizer:Ht(this.kernelRegularizer),recurrentRegularizer:Ht(this.recurrentRegularizer),biasRegularizer:Ht(this.biasRegularizer),activityRegularizer:Ht(this.activityRegularizer),kernelConstraint:Ln(this.kernelConstraint),recurrentConstraint:Ln(this.recurrentConstraint),biasConstraint:Ln(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}k0.className="SimpleRNNCell";me(k0);class HC extends Si{constructor(e){e.cell=new k0(e),super(e)}call(e,t){return Y(()=>{this.cell.dropoutMask!=null&&(et(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(et(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return new e(t)}}HC.className="SimpleRNN";me(HC);class T0 extends Jm{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new H("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Un(this.units,"units"),this.activation=Na(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Na(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=on(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=on(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=on(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=an(e.kernelRegularizer),this.recurrentRegularizer=an(e.recurrentRegularizer),this.biasRegularizer=an(e.biasRegularizer),this.kernelConstraint=Mn(e.kernelConstraint),this.recurrentConstraint=Mn(e.recurrentConstraint),this.biasConstraint=Mn(e.biasConstraint),this.dropout=ku([1,Ea([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ku([1,Ea([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ft(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return Y(()=>{if(e=e,e.length!==2)throw new H(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training==null?!1:t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Aa({ones:()=>cr(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Aa({ones:()=>cr(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,c;0<this.dropout&&this.dropout<1&&(e=W(e,i[0]));let u=Bi(e,this.kernel.read());this.useBias&&(u=Ii(u,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=W(r,o[0]));const h=this.recurrentKernel.read(),[d,p]=Bs(h,[2*this.units,this.units],h.rank-1),f=Bi(r,d),[g,m,y]=Bs(u,3,u.rank-1),[w,v]=Bs(f,2,f.rank-1);a=this.recurrentActivation.apply(pe(g,w)),l=this.recurrentActivation.apply(pe(m,v));const I=Bi(W(l,r),p);c=this.activation.apply(pe(y,I));const _=pe(W(a,r),W(pe(1,Yt(a)),c));return[_,_]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:_a(this.activation),recurrentActivation:_a(this.recurrentActivation),useBias:this.useBias,kernelInitializer:hn(this.kernelInitializer),recurrentInitializer:hn(this.recurrentInitializer),biasInitializer:hn(this.biasInitializer),kernelRegularizer:Ht(this.kernelRegularizer),recurrentRegularizer:Ht(this.recurrentRegularizer),biasRegularizer:Ht(this.biasRegularizer),activityRegularizer:Ht(this.activityRegularizer),kernelConstraint:Ln(this.kernelConstraint),recurrentConstraint:Ln(this.recurrentConstraint),biasConstraint:Ln(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}T0.className="GRUCell";me(T0);class qC extends Si{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new T0(e),super(e)}call(e,t){return Y(()=>{this.cell.dropoutMask!=null&&(et(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(et(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}qC.className="GRU";me(qC);class eg extends Jm{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Un(this.units,"units"),this.activation=Na(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Na(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=on(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=on(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=on(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=an(e.kernelRegularizer),this.recurrentRegularizer=an(e.recurrentRegularizer),this.biasRegularizer=an(e.biasRegularizer),this.kernelConstraint=Mn(e.kernelConstraint),this.recurrentConstraint=Mn(e.recurrentConstraint),this.biasConstraint=Mn(e.biasConstraint),this.dropout=ku([1,Ea([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ku([1,Ea([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=Ft(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,o=this.units;r=new(t=class extends qr{apply(l,c){const u=i.apply([o]),h=new d0().apply([o]),d=i.apply([o*2]);return PR(PR(u,h),d)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return Y(()=>{const s=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new H(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Aa({ones:()=>cr(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Aa({ones:()=>cr(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let l,c,u,h;0<this.dropout&&this.dropout<1&&(e=W(e,o[0]));let d=Bi(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=W(r,a[0])),d=pe(d,Bi(r,this.recurrentKernel.read())),this.useBias&&(d=Ii(d,this.bias.read()));const[p,f,g,m]=Bs(d,4,d.rank-1);l=this.recurrentActivation.apply(p),c=this.recurrentActivation.apply(f),u=pe(W(c,i),W(l,this.activation.apply(g))),h=this.recurrentActivation.apply(m);const y=W(h,this.activation.apply(u));return[y,y,u]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:_a(this.activation),recurrentActivation:_a(this.recurrentActivation),useBias:this.useBias,kernelInitializer:hn(this.kernelInitializer),recurrentInitializer:hn(this.recurrentInitializer),biasInitializer:hn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Ht(this.kernelRegularizer),recurrentRegularizer:Ht(this.recurrentRegularizer),biasRegularizer:Ht(this.biasRegularizer),activityRegularizer:Ht(this.activityRegularizer),kernelConstraint:Ln(this.kernelConstraint),recurrentConstraint:Ln(this.recurrentConstraint),biasConstraint:Ln(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}eg.className="LSTMCell";me(eg);class KC extends Si{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new eg(e),super(e)}call(e,t){return Y(()=>{this.cell.dropoutMask!=null&&(et(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(et(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}KC.className="LSTM";me(KC);class C0 extends Jm{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return Y(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const i=[];let o;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=r[a],a===0?o=[e[0]].concat(s):o=[o[0]].concat(s),o=l.call(o,t),i.push(o.slice(1))}s=[];for(const a of i.slice().reverse())s.push(...a);return[o[0]].concat(s)})}build(e){_I(e)&&(e=e[0]),e=e;let t;this.cells.forEach((s,r)=>{Dl(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?t=s.stateSize[0]:t=s.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=i=>({className:i.getClassName(),config:i.getConfig()}),r={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,t,s={}){const r=[];for(const i of t.cells)r.push(ai(i,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.cells)t.push(...s.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return NI(e)}setWeights(e){const t=[];for(const s of this.cells){const r=s.weights.length,i=e.splice(r);for(let o=0;o<s.weights.length;++o)t.push([s.weights[o],i[o]])}vC(t)}}C0.className="StackedRNNCells";me(C0);function Aa(n){const{ones:e,rate:t,training:s=!1,count:r=1,dropoutFunc:i}=n,o=()=>i!=null?i(e(),t):MM(e(),t),a=()=>Xm(o,e,s);return!r||r<=1?Pn(a().clone()):Array(r).fill(void 0).map(a).map(c=>Pn(c.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var rie=globalThis&&globalThis.__rest||function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class kz extends Si{constructor(e){if(e.unroll)throw new rt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new rt("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new _n({ndim:5})]}call(e,t){return Y(()=>{if(this.cell.dropoutMask!=null&&(et(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(et(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new H("ConvRNN2D cell does not support constants");const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return Y(()=>{const{stateSize:t}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)],o=En(i);return Array.isArray(t)?Array(t.length).fill(o):[o]})}resetStates(e,t=!1){Y(()=>{if(!this.stateful)throw new Ri("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)];if(s[0]==null)throw new H("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>En(i)):this.states_=[En(i)];else if(e==null)et(this.states_),this.keptStates!=null&&(et(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>En(i)):this.states_[0]=En(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new H(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):et(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],c=i;if(!wt(l.shape,c))throw new H(`State ${a} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>Pn(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:s,kernelSize:r,padding:i,strides:o,dilationRate:a}=this.cell,l=t==="channelsFirst",c=e[l?3:2],u=e[l?4:3],h=li(c,r[0],i,o[0],a[0]),d=li(u,r[1],i,o[1],a[1]);return[...e.slice(0,2),...l?[s,h,d]:[h,d,s]]}}kz.className="ConvRNN2D";class E0 extends eg{constructor(e){const{filters:t,kernelSize:s,strides:r,padding:i,dataFormat:o,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,Un(this.filters,"filters"),this.kernelSize=tu(s,2,"kernelSize"),this.kernelSize.forEach(l=>Un(l,"kernelSize")),this.strides=tu(r||1,2,"strides"),this.strides.forEach(l=>Un(l,"strides")),this.padding=i||"valid",_r(this.padding),this.dataFormat=o||"channelsLast",In(this.dataFormat),this.dilationRate=tu(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>Un(l,"dilationRate"))}build(e){var t;e=Ft(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new H(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],i=4,o=this.kernelSize.concat([r,this.filters*i]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const c=this.biasInitializer,u=this.filters;l=new(t=class extends qr{apply(d,p){const f=c.apply([u]),g=Vs([u]),m=c.apply([u*2]);return pC([f,g,m])}},t.className="CustomInit",t)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return Y(()=>{if(e.length!==3)throw new H(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training||!1,r=e[0],i=e[1],o=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Aa({ones:()=>cr(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,c=(L,ae,ce)=>!ae||!ae[ce]?L:W(ae[ce],L);let u=c(r,l,0),h=c(r,l,1),d=c(r,l,2),p=c(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Aa({ones:()=>cr(i),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const f=this.recurrentDropoutMask;let g=c(i,f,0),m=c(i,f,1),y=c(i,f,2),w=c(i,f,3);const v=3,[I,_,N,T]=Bs(this.kernel.read(),a,v),[E,k,S,A]=this.useBias?Bs(this.bias.read(),a):[null,null,null,null];u=this.inputConv(u,I,E,this.padding),h=this.inputConv(h,_,k,this.padding),d=this.inputConv(d,N,S,this.padding),p=this.inputConv(p,T,A,this.padding);const[P,D,V,U]=Bs(this.recurrentKernel.read(),a,v);g=this.recurrentConv(g,P),m=this.recurrentConv(m,D),y=this.recurrentConv(y,V),w=this.recurrentConv(w,U);const q=this.recurrentActivation.apply(pe(u,g)),J=this.recurrentActivation.apply(pe(h,m)),K=pe(W(J,o),W(q,this.activation.apply(pe(d,y)))),ee=W(this.recurrentActivation.apply(pe(p,w)),this.activation.apply(K));return[ee,ee,K]})}getConfig(){const e=super.getConfig(),t=rie(e,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},t),s)}inputConv(e,t,s,r){const i=ko(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?Ii(i,s,this.dataFormat):i}recurrentConv(e,t){return ko(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}E0.className="ConvLSTM2DCell";me(E0);class XC extends kz{constructor(e){const t=new E0(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}XC.className="ConvLSTM2D";me(XC);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class _0 extends mt{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return s}call(e,t){return Y(()=>{this.invokeCallHook(e,t);const s=Xe(e);if(0<this.rate&&this.rate<1){const r=t.training==null?!1:t.training,i=this.getNoiseShape(s);return Xm(()=>MM(s,this.rate,i,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}_0.className="Dropout";me(_0);class YC extends _0{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}YC.className="SpatialDropout1D";me(YC);class QC extends mt{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,Un(this.units,"units"),this.activation=Na(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=on(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=on(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Mn(e.kernelConstraint),this.biasConstraint=Mn(e.biasConstraint),this.kernelRegularizer=an(e.kernelRegularizer),this.biasRegularizer=an(e.biasRegularizer),this.activityRegularizer=an(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Ft(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=Ft(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return Y(()=>{this.invokeCallHook(e,t);const s=Xe(e),r=RM(this.activation.getClassName());let i;return r!=null?i=Bi(s,this.kernel.read(),r,this.bias?this.bias.read():null):(i=Bi(s,this.kernel.read()),this.bias!=null&&(i=Ii(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:_a(this.activation),useBias:this.useBias,kernelInitializer:hn(this.kernelInitializer),biasInitializer:hn(this.biasInitializer),kernelRegularizer:Ht(this.kernelRegularizer),biasRegularizer:Ht(this.biasRegularizer),activityRegularizer:Ht(this.activityRegularizer),kernelConstraint:Ln(this.kernelConstraint),biasConstraint:Ln(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}QC.className="Dense";me(QC);class ZC extends mt{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Ft(e);for(const t of e.slice(1))if(t==null)throw new H(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],ga(e,1)]}call(e,t){return Y(()=>{this.invokeCallHook(e,t);let s=Xe(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let i=2;i<s.rank;++i)r.push(i);r.push(1),s=vt(s,r)}return gse(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}ZC.className="Flatten";me(ZC);class JC extends mt{constructor(e){super(e),this.supportsMasking=!0,this.activation=Na(e.activation)}call(e,t){return Y(()=>{this.invokeCallHook(e,t);const s=Xe(e);return this.activation.apply(s)})}getConfig(){const e={activation:_a(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}JC.className="Activation";me(JC);class eE extends mt{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return Y(()=>(e=Xe(e),fse(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}eE.className="RepeatVector";me(eE);class tE extends mt{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const s="Total size of new array must be unchanged.",r=t.slice();let i=1,o=null;for(let l=0;l<r.length;++l){const c=r[l];if(this.isUnknown(c))if(o===null)o=l;else throw new H("Can only specifiy one unknown dimension.");else i*=c}const a=ga(e);if(o!==null){if(i===0||a%i!==0)throw new H(s);r[o]=a/i}else if(a!==i)throw new H(s);return r}computeOutputShape(e){let t=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return Y(()=>{this.invokeCallHook(e,t);const s=Xe(e),r=s.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return G(s,i)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}tE.className="Reshape";me(tE);class nE extends mt{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=fi(1,e.dims.length+1);if(!wt(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new _n({ndim:this.dims.length+1})]}computeOutputShape(e){e=Ft(e);const t=e.slice();return this.dims.forEach((s,r)=>{t[r+1]=e[s]}),t}call(e,t){return vt(Xe(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}nE.className="Permute";me(nE);class sE extends mt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const s=Xe(e),r=-1;return jp(Gl(s,this.maskValue),r)}call(e,t){return Y(()=>{this.invokeCallHook(e,t);const s=Xe(e),r=-1,i=!0,o=jp(Gl(s,this.maskValue),r,i);return W(s,ve(o,s.dtype))})}}sE.className="Masking";me(sE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class rE extends mt{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(Gt(e.inputLength))}this.inputDim=e.inputDim,Un(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Un(this.outputDim,"outputDim"),this.embeddingsInitializer=on(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=an(e.embeddingsRegularizer),this.activityRegularizer=an(e.activityRegularizer),this.embeddingsConstraint=Mn(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return Y(()=>this.maskZero?(e=Xe(e),Gl(e,Ct(e))):null)}computeOutputShape(e){if(e=Ft(e),this.inputLength==null)return[...e,this.outputDim];const t=Gt(this.inputLength);if(t.length!==e.length-1)throw new H(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<t.length;++r){const i=t[r],o=e[r+1];if(i!=null&&o!=null&&i!==o)throw new H(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(t[s]=o),s++}}return[e[0],...t,this.outputDim]}call(e,t){return Y(()=>{this.invokeCallHook(e,t);let s=Xe(e);s.dtype!=="int32"&&(s=Vi(s,"int32"));const r=LM(this.embeddings.read(),G(s,[s.size]));return G(r,Ft(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:hn(this.embeddingsInitializer),embeddingsRegularizer:Ht(this.embeddingsRegularizer),activityRegularizer:Ht(this.activityRegularizer),embeddingsConstraint:Ln(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}rE.className="Embedding";me(rE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class wc extends mt{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new rt}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const s=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const i=e[e.length-t.length+r],o=t[r];if(i==null||o==null||i<0||o<0)s.push(null);else if(i===1)s.push(o);else if(o===1)s.push(i);else{if(i!==o)throw new H("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));s.push(i)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Ft(e)]),e=e,e.length<2)throw new H(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const i of e)i!=null&&i[0]!==null&&t.push(i[0]);if(t=ma(t),t.length>1)throw new H(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let i=1;i<e.length;++i){const o=e[i]==null?null:e[i].slice(1);s=this.computeElementwiseOpOutputShape(s,o)}const r=e.map(i=>i.length);e.indexOf(null)===-1&&ma(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return Y(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(i=>i.rank);if(r.indexOf(null)===-1){const i=Ea(r);for(let o of e){const a=o.rank;for(let l=0;l<i-a;++l)o=qm(o,1);s.push(o)}return this.mergeFunction(s)}else{let i=!1;for(const l of e){const c=l.rank;if(c==null){const u=l.shape,h=u[0],d=u.slice(1).concat([h]);let p=G(l,[h].concat(ga(u.slice(1))));p=vt(p,[1,0]),p=G(p,d),s.push(p),i=!0}else if(c>1){const u=fi(1,c).concat([0]);s.push(vt(l,u)),i=!0}else s.push(l)}let o=this.mergeFunction(s);const a=o.rank;if(i){if(a==null){const l=o.shape,c=l.length,u=l[c-1],h=[u].concat(l.slice(0,l.length-1));o=G(vt(G(o,[-1,u]),[1,0]),h)}else if(a>1){const l=[a-1].concat(fi(0,a-1));o=vt(o,l)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){const i=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,i)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=ma(s),s.length===1?t=s.concat(t):t=[null].concat(t),t}computeMask(e,t){return Y(()=>{if(t==null)return null;if(!Array.isArray(t))throw new H("`mask` should be an Array");if(!Array.isArray(e))throw new H("`inputs` should be an Array");if(t.length!==e.length)throw new H(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:es(r,0));let s=t[0];for(let r=1;r<t.length-1;++r)s=Wr(s,t[r]);return s})}}class iE extends wc{constructor(e){super(e)}mergeFunction(e){return Y(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=pe(t,e[s]);return t})}}iE.className="Add";me(iE);class oE extends wc{constructor(e){super(e)}mergeFunction(e){return Y(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=W(t,e[s]);return t})}}oE.className="Multiply";me(oE);class aE extends wc{constructor(e){super(e)}mergeFunction(e){return Y(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=pe(t,e[s]);return W(1/e.length,t)})}}aE.className="Average";me(aE);class lE extends wc{constructor(e){super(e)}mergeFunction(e){return Y(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=to(t,e[s]);return t})}}lE.className="Maximum";me(lE);class cE extends wc{constructor(e){super(e)}mergeFunction(e){return Y(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=Ca(t,e[s]);return t})}}cE.className="Minimum";me(cE);class uE extends wc{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new H("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(r!=null){t=!1;break}if(t)return;const s=[];for(let r=0;r<e.length;++r){const i=e[r].slice();i.splice(this.axis,1);let o=!1;for(const a of s)if(wt(a,i)){o=!0;break}o||s.push(i)}if(s.length>1)throw new H("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return Y(()=>pC(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new H("A `Concatenate` layer should be called on a list of inputs.");const t=e,s=t[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const i of t.slice(1)){if(s[r]==null||i[r]==null){s[r]=null;break}s[r]+=i[r]}return s}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new H("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new H("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new H(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return Y(()=>{let s=!0;if(t.forEach(o=>{if(o!=null){s=!1;return}}),s)return null;const r=[];for(let o=0;o<e.length;++o)t[o]==null?r.push(ve(cr(e[o]),"bool")):t[o].rank<e[o].rank?r.push(es(t[o],-1)):r.push(t[o]);const i=xn(r,this.axis);return Tw(i,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}uE.className="Concatenate";me(uE);function Nd(n,e){for(;n<0;)n+=e;return n}function iie(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new rt("batchDot is not implemented for tensors of 4D or higher rank yet");if(O(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),O(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new rt("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=e.shape.length;t==null&&(t=[s-1,r-2]);const i=t;return Y(()=>{let o;if(s>r){o=s-r;const l=[];for(let c=0;c<o;++c)l.push(1);e=G(e,e.shape.concat(l))}else if(r>s){o=r-s;const l=[];for(let c=0;c<o;++c)l.push(1);n=G(n,n.shape.concat(l))}else o=0;let a;if(n.shape.length===2&&e.shape.length===2)i[0]===i[1]?a=Pe(W(n,e),i[0]):a=Pe(W(vt(n,[1,0]),e),i[1]);else{const l=i[0]!==n.shape.length-1,c=i[1]===e.shape.length-1;a=pt(n,e,l,c)}if(o>0){let l;s>r?l=s+r-3:l=s-1;const c=[];for(let u=l;u<l+o;++u)c.push(u);a=Ga(a,c)}return a.shape.length===1&&(a=es(a,1)),a})}class hE extends wc{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){O(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],s=e[1];if(t.length>3||s.length>3)throw new rt("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);if(t[r[0]]!==s[r[1]])throw new H(`Dimension incompatibility: ${t[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new H(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((i,o)=>Nd(i,e[o].shape.length)):r=[Nd(this.axes,t.shape.length),Nd(this.axes,s.shape.length)],this.normalize&&(t=gb(t,r[0]),s=gb(s,r[1])),iie(t,s,r)}interpretAxes(e,t){let s;return Array.isArray(this.axes)?s=this.axes:s=[Nd(this.axes,e.length),Nd(this.axes,t.length)],s}computeOutputShape(e){O(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),s=e[1].slice();if(t.length>3||s.length>3)throw new rt("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);t.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const i=t.concat(s);return i.length===1&&i.push(1),i}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}hE.className="Dot";me(hE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class dE extends mt{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return Y(()=>{this.invokeCallHook(e,t);const s=Xe(e);return Xm(()=>pe(h0(s.shape,0,this.stddev),s),()=>s,t.training||!1)})}}dE.className="GaussianNoise";me(dE);class pE extends mt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return Y(()=>{this.invokeCallHook(e,t);const s=Xe(e);return this.rate>0&&this.rate<1?Xm(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return W(s,h0(s.shape,1,i))},()=>s,t.training||!1):s})}}pE.className="GaussianDropout";me(pE);class fE extends mt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Xe(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return Y(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return Xm(()=>{const i=Xe(e),o=1.6732632423543772,a=1.0507009873554805,l=-o*a;let c=Lo(Wa(s),this.rate);c=Vi(c,"float32");const u=((1-this.rate)*(1+this.rate*l**2))**-.5,h=-u*l*this.rate,d=pe(W(i,c),W(pe(c,-1),l));return pe(W(d,u),h)},()=>Xe(e),t.training||!1)}return e})}}fE.className="AlphaDropout";me(fE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Kp(n,e,t,s,r,i=.001){let o;if(n.rank===2)o=Ek(n,e,t,s,r,i);else if(n.rank===3)o=_k(n,e,t,s,r,i);else if(n.rank===4)o=Nk(n,e,t,s,r,i);else throw new rt(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return o}function oie(n,e,t,s,r=.001){return Y(()=>{const i=Pm(n,s),o=i.mean,a=i.variance;return[Kp(n,o,a,t,e,r),o,a]})}function aie(n,e,t,s,r=.001){return Y(()=>{const i=Pm(n,s),o=i.mean,a=i.variance,l=[];for(const f of fi(0,n.rank))s.indexOf(f)!==-1?l.push(1):l.push(n.shape[f]);const c=G(o,l),u=G(a,l),h=e==null?null:G(e,l),d=t==null?null:G(t,l);return[Kp(n,c,u,d,h,r),o,a]})}function lie(n,e,t,s,r=.001){return wt(s.slice().sort(),fi(0,n.rank-1))?oie(n,e,t,s,r):aie(n,e,t,s,r)}class mE extends mt{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=on(e.betaInitializer||"zeros"),this.gammaInitializer=on(e.gammaInitializer||"ones"),this.movingMeanInitializer=on(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=on(e.movingVarianceInitializer||"ones"),this.betaConstraint=Mn(e.betaConstraint),this.gammaConstraint=Mn(e.gammaConstraint),this.betaRegularizer=an(e.betaRegularizer),this.gammaRegularizer=an(e.gammaRegularizer)}build(e){e=Ft(e);const t=this.axis>=0?this.axis:this.axis+e.length,s=e[t];if(s==null)throw new H(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new _n({ndim:e.length,axes:{[t]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return Y(()=>{const s=t.training==null?!1:t.training,r=Xe(e),i=r.shape,o=i.length,a=fi(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const c=Kl(1,o);c[l]=i[l];const u=a.slice();u.sort();const h=!wt(u,fi(0,o).slice(0,o-1)),d=()=>{if(h){const w=G(this.movingMean.read(),c),v=G(this.movingVariance.read(),c),I=this.center?G(this.beta.read(),c):null,_=this.scale?G(this.gamma.read(),c):null;return Kp(r,w,v,I,_,this.epsilon)}else return Kp(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return d();const[p,f,g]=lie(r,this.gamma.read(),this.beta.read(),a,this.epsilon),m=(w,v,I)=>{Y(()=>{const _=1-I,N=w.read(),T=W(Ne(N,v),_);w.write(Ne(N,T))})};return(()=>{m(this.movingMean,f,this.momentum),m(this.movingVariance,g,this.momentum)})(),p})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:hn(this.betaInitializer),gammaInitializer:hn(this.gammaInitializer),movingMeanInitializer:hn(this.movingMeanInitializer),movingVarianceInitializer:hn(this.movingVarianceInitializer),betaRegularizer:Ht(this.betaRegularizer),gammaRegularizer:Ht(this.gammaRegularizer),betaConstraint:Ln(this.betaConstraint),gammaConstraint:Ln(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}mE.className="BatchNormalization";me(mE);class gE extends mt{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=on(e.betaInitializer||"zeros"),this.gammaInitializer=on(e.gammaInitializer||"ones"),this.betaRegularizer=an(e.betaRegularizer),this.gammaRegularizer=an(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Ft(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=t);for(const i of this.axis)if(i<0||i>=t)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==ma(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(i=>e[i]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const s=Xe(e),r=s.shape,i=r.length;return Y(()=>{let{mean:a,variance:l}=Pm(s,this.axis,!0);const c=Kl(1,i);for(const g of this.axis)c[g]=r[g];const u=g=>g!=null&&g.shape.length!==i?G(g,c):g;let h=this.scale?u(this.gamma.read()):null,d=this.center?u(this.beta.read()):null;const p=[],f=[];for(let g=0;g<i;++g)this.axis.indexOf(g)!==-1?(p.push(r[g]),f.push(1)):(p.push(1),f.push(r[g]));return a=xr(a,p),l=xr(l,p),h!=null&&(h=xr(h,f)),d!=null&&(d=xr(d,f)),Kp(s,a,l,d,h,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:hn(this.betaInitializer),gammaInitializer:hn(this.gammaInitializer),betaRegularizer:Ht(this.betaRegularizer),gammaRegularizer:Ht(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}gE.className="LayerNormalization";me(gE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function cie(n,e,t){return Y(()=>{if(n.rank!==4)throw new H(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new H("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=mi()),t!=="channelsLast"&&t!=="channelsFirst")throw new H(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return t==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],Mo(n,s)})}class yE extends mt{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?mi():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new H(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,s;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new H(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new H(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[t,s]}this.inputSpec=[new _n({ndim:4})]}computeOutputShape(e){e=Ft(e);let t,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],t,s]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],t,s,e[3]])}call(e,t){return Y(()=>cie(Xe(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}yE.className="ZeroPadding2D";me(yE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function N0(n,e,t,s,r,i){return Y(()=>{In(r),DM(i),_r(s),t==null&&(t=[1,1]),s==null&&(s="valid"),r==null&&(r=mi()),i==null&&(i="max"),n=zC(n,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=Dm(n,e,t,a):o=Tm(n,e,t,a),r==="channelsFirst"&&(o=vt(o,[0,3,1,2])),o})}function Tz(n,e,t,s,r,i){return Y(()=>{In(r),DM(i),_r(s),t==null&&(t=[1,1,1]),s==null&&(s="valid"),r==null&&(r=mi()),i==null&&(i="max"),n=wz(n,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=Jk(n,e,t,a):o=Ck(n,e,t,a),r==="channelsFirst"&&(o=vt(o,[0,4,1,2,3])),o})}class Cz extends mt{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new H(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Un(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new H(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Un(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,_r(this.padding),this.inputSpec=[new _n({ndim:3})]}computeOutputShape(e){e=Ft(e);const t=li(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return Y(()=>{this.invokeCallHook(e,t),e=qm(Xe(e),2);const s=this.poolingFunction(Xe(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Ga(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class bE extends Cz{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return In(i),_r(r),N0(e,t,s,r,i,"max")}}bE.className="MaxPooling1D";me(bE);class xE extends Cz{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return In(i),_r(r),N0(e,t,s,r,i,"avg")}}xE.className="AveragePooling1D";me(xE);class Ez extends mt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new H(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Un(this.poolSize,"poolSize"),Un(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,In(this.dataFormat),_r(this.padding),this.inputSpec=[new _n({ndim:4})]}computeOutputShape(e){e=Ft(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=li(t,this.poolSize[0],this.padding,this.strides[0]),s=li(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s]:[e[0],t,s,e[3]]}call(e,t){return Y(()=>(this.invokeCallHook(e,t),this.poolingFunction(Xe(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class wE extends Ez{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return In(i),_r(r),N0(e,t,s,r,i,"max")}}wE.className="MaxPooling2D";me(wE);class vE extends Ez{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return In(i),_r(r),N0(e,t,s,r,i,"avg")}}vE.className="AveragePooling2D";me(vE);class _z extends mt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new H(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Un(this.poolSize,"poolSize"),Un(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,In(this.dataFormat),_r(this.padding),this.inputSpec=[new _n({ndim:5})]}computeOutputShape(e){e=Ft(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=li(t,this.poolSize[0],this.padding,this.strides[0]),s=li(s,this.poolSize[1],this.padding,this.strides[1]),r=li(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s,r]:[e[0],t,s,r,e[4]]}call(e,t){return Y(()=>(this.invokeCallHook(e,t),this.poolingFunction(Xe(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class IE extends _z{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return In(i),_r(r),Tz(e,t,s,r,i,"max")}}IE.className="MaxPooling3D";me(IE);class SE extends _z{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return In(i),_r(r),Tz(e,t,s,r,i,"avg")}}SE.className="AveragePooling3D";me(SE);class Nz extends mt{constructor(e){super(e),this.inputSpec=[new _n({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new rt}}class kE extends Nz{constructor(e){super(e||{})}call(e,t){return Y(()=>{const s=Xe(e);return un(s,1)})}}kE.className="GlobalAveragePooling1D";me(kE);class TE extends Nz{constructor(e){super(e||{})}call(e,t){return Y(()=>{const s=Xe(e);return Sr(s,1)})}}TE.className="GlobalMaxPooling1D";me(TE);class Az extends mt{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,In(this.dataFormat),this.inputSpec=[new _n({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new rt}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class CE extends Az{call(e,t){return Y(()=>{const s=Xe(e);return this.dataFormat==="channelsLast"?un(s,[1,2]):un(s,[2,3])})}}CE.className="GlobalAveragePooling2D";me(CE);class EE extends Az{call(e,t){return Y(()=>{const s=Xe(e);return this.dataFormat==="channelsLast"?Sr(s,[1,2]):Sr(s,[2,3])})}}EE.className="GlobalMaxPooling2D";me(EE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Rz extends mt{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,s={}){const r=t.layer,i=ai(r,s);delete t.layer;const o={layer:i};return Object.assign(o,t),new e(o)}}class _E extends Rz{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Ft(e),e.length<3)throw new H(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Ft(e);const t=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(t),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,t){return Y(()=>(e=Xe(e),Sz((o,a)=>[Xe(this.layer.call(o,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}_E.className="TimeDistributed";me(_E);function uie(n){bc(cse,"BidirectionalMergeMode",n)}const hie="concat";class NE extends Rz{constructor(e){super(e);const t=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=t,this.forwardLayer=ai(s),t.goBackwards=t.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=ai(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?hie:e.mergeMode,uie(this.mergeMode),e.weights)throw new rt("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,s=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let s,r,i;return this.returnState&&(i=t.slice(1)),s=t[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(i).concat(i.slice()):[s].concat(i).concat(i.slice()):Ls(r)}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const i=Iz(e,s,r,this.numConstants);if(e=i.inputs,s=i.initialState,r=i.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,t);const o=[],a=[];if(s!=null){const c=s.length;if(c%2>0)throw new H("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=s,o.push(...s);const u=s.map(h=>new _n({shape:h.shape}));this.forwardLayer.stateSpec=u.slice(0,c/2),this.backwardLayer.stateSpec=u.slice(c/2),a.push(...u)}if(r!=null)throw new rt("Support for constants in Bidirectional layers is not implemented yet.");const l=o[0]instanceof gi;for(const c of o)if(c instanceof gi!==l)throw new H("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const c=[e].concat(o),u=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=u;const d=super.apply(c,t);return this.inputSpec=h,d}else return super.apply(e,t)}call(e,t){return Y(()=>{const s=t.initialState;let r,i;if(s==null)r=this.forwardLayer.call(e,t),i=this.backwardLayer.call(e,t);else{const l=s.slice(0,s.length/2),c=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:l})),i=this.backwardLayer.call(e,Object.assign(t,{initialState:c}))}let o;this.returnState&&(Array.isArray(r)&&(o=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=Cr(i,1));let a;return this.mergeMode==="concat"?a=pC([r,i]):this.mergeMode==="sum"?a=pe(r,i):this.mergeMode==="ave"?a=W(.5,pe(r,i)):this.mergeMode==="mul"?a=W(r,i):this.mergeMode==null&&(a=[r,i]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Dl(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Dl(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[t,t]:s=t:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(s)?s.concat(i).concat(i):[s].concat(i).concat(i)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const s=ai(t.layer);if(delete t.layer,t.numConstants!=null)throw new rt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=s,new e(r)}}NE.className="Bidirectional";me(NE);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class AE extends mt{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return Y(()=>(e=Xe(e),e.dtype!=="float32"&&(e=Vi(e,"float32")),pe(W(e,this.scale),this.offset)))}}AE.className="Rescaling";me(AE);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:die,cropAndResize:pie}=Vr;class RE extends mt{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,s,r,i,o,a,l){return Y(()=>{let c,u=!1;const h=t/o,d=s/a,p=(r+t)/o,f=(i+s)/a,g=[h,d,p,f],m=[];e.rank===3?(u=!0,c=Es([e])):c=e;for(let _=0;_<c.shape[0];_++)m.push(g);const y=ir(m,[m.length,4]),w=Hl(0,m.length,1,"int32"),I=pie(c,y,w,[r,i],"nearest");return Vi(u?Xe(Er(I)):I,l)})}upsize(e,t,s,r){return Y(()=>{const i=die(e,[t,s]);return Vi(i,r)})}call(e,t){return Y(()=>{const s=Xe(e),r=s.dtype,i=s.shape,o=i[i.length-3],a=i[i.length-2];let l=0;o!==this.height&&(l=Math.floor((o-this.height)/2));let c=0;return a!==this.width&&(c=Math.floor((a-this.width)/2),c===0&&(c=1)),l>=0&&c>=0?this.centerCrop(s,l,c,this.height,this.width,o,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Ft(e);const t=e.length-3,s=e.length-2;return e[t]=this.height,e[s]=this.width,e}}RE.className="CenterCrop";me(RE);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function fie(n,e,t,s){let r=Xe(n);if(r.dtype!=="int32"&&(r=Vi(r,"int32")),e==="int")return r;const i=r.shape;if(r.rank===0&&(r=es(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=es(r,-1)),r.rank>2)throw new H(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${i} which would result in output rank ${r.rank}.`);const o=["multiHot","oneHot"].includes(e),a=r;let l;if(typeof s<"u"&&e==="count"?l=cb(a,s,t,o):l=cb(a,[],t,o),e!=="tfIdf")return l;if(s)return W(l,s);throw new H("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class $E extends mt{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=Ft(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return Y(()=>{e=Xe(e),e.dtype!=="int32"&&(e=Vi(e,"int32"));let s;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new H(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);s=Xe(t.countWeights)}const r=Sr(e),i=bu(e),o=Rs(this.numTokens,r).bufferSync().get(0),a=Lo(i,0).bufferSync().get(0);if(!(o&&a))throw new H(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return fie(e,this.outputMode,this.numTokens,s)})}}$E.className="CategoryEncoding";me($E);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const mie=["bilinear","nearest"],ZR=new Set(mie);class DE extends mt{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(ZR.has(e.interpolation))this.interpolation=e.interpolation;else throw new H(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Ft(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return Y(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Vr.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Vr.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...ZR]} are supported`)})}}DE.className="Resizing";me(DE);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class $z{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}$z.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Dz extends mt{constructor(e){super(e),this.randomGenerator=new $z(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}Dz.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const gie=["bilinear","nearest"],JR=new Set(gie);class PE extends Dz{constructor(e){super(e);const{factor:t,interpolation:s="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new H(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new H(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new H(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(JR.has(s))this.interpolation=s;else throw new H(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Ft(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return Y(()=>{const s=Xe(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=Wa([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*r;i=Math.round(i);const o=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return Vr.resizeBilinear(e,o);case"nearest":return Vr.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...JR]} are supported`)}})}}PE.className="RandomWidth";me(PE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yie(n){return new Uh(n)}function bie(n){return new FC(n)}function xie(n){return new DC(n)}function wie(n){return new PC(n)}function vie(n){return new OC(n)}function Iie(n){return new MC(n)}function Sie(n){return new LC(n)}function kie(n){return new Zm(n)}function Tie(n){return new Hh(n)}function Cie(n){return new VC(n)}function Eie(n){return new qh(n)}function _ie(n){return new BC(n)}function Nie(n){return new jC(n)}function Aie(n){return new UC(n)}function Rie(n){return new WC(n)}function $ie(n){return new GC(n)}function Die(n){return new JC(n)}function Pie(n){return new QC(n)}function Oie(n){return new _0(n)}function Fie(n){return new YC(n)}function Lie(n){return new ZC(n)}function Mie(n){return new eE(n)}function zie(n){return new tE(n)}function Vie(n){return new nE(n)}function Bie(n){return new rE(n)}function jie(n){return new iE(n)}function Uie(n){return new aE(n)}function Wie(n){return new uE(n)}function Gie(n){return new lE(n)}function Hie(n){return new cE(n)}function qie(n){return new oE(n)}function Kie(n){return new hE(n)}function Xie(n){return new mE(n)}function Yie(n){return new gE(n)}function Qie(n){return new yE(n)}function OE(n){return new xE(n)}function Zie(n){return OE(n)}function Jie(n){return OE(n)}function FE(n){return new vE(n)}function eoe(n){return FE(n)}function toe(n){return FE(n)}function LE(n){return new SE(n)}function noe(n){return LE(n)}function soe(n){return LE(n)}function roe(n){return new kE(n)}function ioe(n){return new CE(n)}function Pz(n){return new TE(n)}function Oz(n){return new EE(n)}function Fz(n){return new bE(n)}function Lz(n){return new wE(n)}function ooe(n){return new IE(n)}function aoe(n){return new qC(n)}function loe(n){return new T0(n)}function coe(n){return new KC(n)}function uoe(n){return new eg(n)}function hoe(n){return new HC(n)}function doe(n){return new k0(n)}function poe(n){return new XC(n)}function foe(n){return new E0(n)}function moe(n){return new Si(n)}function goe(n){return new C0(n)}function yoe(n){return new NE(n)}function boe(n){return new _E(n)}const xoe=Pz,woe=Oz,voe=Fz,Ioe=Lz;function Soe(n){return new dE(n)}function koe(n){return new pE(n)}function Toe(n){return new fE(n)}function Coe(n){return new sE(n)}function Eoe(n){return new AE(n)}function _oe(n){return new RE(n)}function Noe(n){return new DE(n)}function Aoe(n){return new $E(n)}function Roe(n){return new PE(n)}const $oe=Object.freeze(Object.defineProperty({__proto__:null,Layer:mt,RNN:Si,RNNCell:Jm,activation:Die,add:jie,alphaDropout:Toe,average:Uie,averagePooling1d:OE,averagePooling2d:FE,averagePooling3d:LE,avgPool1d:Zie,avgPool2d:eoe,avgPool3d:noe,avgPooling1d:Jie,avgPooling2d:toe,avgPooling3d:soe,batchNormalization:Xie,bidirectional:yoe,categoryEncoding:Aoe,centerCrop:_oe,concatenate:Wie,conv1d:kie,conv2d:Tie,conv2dTranspose:Cie,conv3d:Eie,conv3dTranspose:_ie,convLstm2d:poe,convLstm2dCell:foe,cropping2D:Aie,dense:Pie,depthwiseConv2d:$ie,dot:Kie,dropout:Oie,elu:bie,embedding:Bie,flatten:Lie,gaussianDropout:koe,gaussianNoise:Soe,globalAveragePooling1d:roe,globalAveragePooling2d:ioe,globalMaxPool1d:xoe,globalMaxPool2d:woe,globalMaxPooling1d:Pz,globalMaxPooling2d:Oz,gru:aoe,gruCell:loe,input:iz,inputLayer:yie,layerNormalization:Yie,leakyReLU:wie,lstm:coe,lstmCell:uoe,masking:Coe,maxPool1d:voe,maxPool2d:Ioe,maxPooling1d:Fz,maxPooling2d:Lz,maxPooling3d:ooe,maximum:Gie,minimum:Hie,multiply:qie,permute:Vie,prelu:vie,randomWidth:Roe,reLU:xie,repeatVector:Mie,rescaling:Eoe,reshape:zie,resizing:Noe,rnn:moe,separableConv2d:Nie,simpleRNN:hoe,simpleRNNCell:doe,softmax:Iie,spatialDropout1d:Fie,stackedRNNCells:goe,thresholdedReLU:Sie,timeDistributed:boe,upSampling2d:Rie,zeroPadding2d:Qie},Symbol.toStringTag,{value:"Module"}));function Doe(n,e){return _C(n,e)}function Poe(n,e){return YM(n,e)}function Ooe(n,e){return QM(n,e)}function Foe(n,e){return NC(n,e)}function Loe(n,e){return AC(n,e)}function Moe(n,e){return XM(n,e)}function zoe(n,e){return yre(n,e)}function Voe(n,e){return EC(n,e)}function Boe(n,e){return w0(n,e)}function joe(n,e){return Wh(n,e)}function Uoe(n,e){return Wh(n,e)}function Woe(n,e){return Wh(n,e)}function Goe(n,e){return xc(n,e)}function Hoe(n,e){return xc(n,e)}function qoe(n,e){return xc(n,e)}const Koe=Object.freeze(Object.defineProperty({__proto__:null,MAPE:Uoe,MSE:Hoe,binaryAccuracy:Doe,binaryCrossentropy:Poe,categoricalAccuracy:Foe,categoricalCrossentropy:Loe,cosineProximity:Voe,mape:Woe,meanAbsoluteError:Boe,meanAbsolutePercentageError:joe,meanSquaredError:Goe,mse:qoe,precision:Moe,recall:zoe,sparseCategoricalAccuracy:Ooe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Xoe=Object.freeze(Object.defineProperty({__proto__:null,modelFromJSON:Hre},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Yoe(n){return new Qm(n)}function Qoe(n){return Jre(n)}function Zoe(n){return eie(n)}const Joe=Object.freeze(Object.defineProperty({__proto__:null,l1:Qoe,l1l2:Yoe,l2:Zoe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Mz extends Tu{constructor(){super(...arguments),this.model=null}setModel(e){if(!(e instanceof yo))throw new Error("model must be a LayersModel, not some other Container");this.model=e}}function Vg(n,e){return n<e}function e2(n,e){return n>e}class zz extends Mz{constructor(e){if(super(),e==null&&(e={}),e.restoreBestWeights)throw new rt("restoreBestWeights = True is not implemented in EarlyStopping yet.");this.monitor=e.monitor||"val_loss",this.minDelta=Math.abs(e.minDelta||0),this.patience=e.patience||0,this.verbose=e.verbose||0,this.mode=e.mode||"auto",this.baseline=e.baseline,["auto","min","max"].indexOf(this.mode)===-1&&(console.warn(`EarlyStopping mode '${this.mode}' is invalid. Falling back to mode 'auto'.`),this.mode="auto"),this.mode==="min"?this.monitorFunc=Vg:this.mode==="max"?this.monitorFunc=e2:this.monitor.indexOf("acc")!==-1?this.monitorFunc=e2:this.monitorFunc=Vg,this.monitorFunc===Vg&&(this.minDelta*=-1)}async onTrainBegin(e){this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===Vg?1/0:-1/0}async onEpochEnd(e,t){await Jo(t);const s=this.getMonitorValue(t);s!=null&&(this.monitorFunc(s-this.minDelta,this.best)?(this.best=s,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=e,this.model.stopTraining=!0)))}async onTrainEnd(e){this.stoppedEpoch>0&&this.verbose&&console.log(`Epoch ${this.stoppedEpoch}: early stopping.`)}getMonitorValue(e){e==null&&(e={});const t=e[this.monitor];return t==null&&console.warn(`Metric for EarlyStopping ${this.monitor} is not available. Available metrics are: ${Object.keys(e)}`),t}}function eae(n){return new zz(n)}const tae={earlyStopping:eae};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nae=X();nae.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var $r;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})($r||($r={}));var t2;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(t2||(t2={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ME={};function sae(n,e){const t={tfOpName:n,category:"custom",inputs:[],attrs:[],customExecutor:e};ME[n]=t}function Vz(n){return ME[n]}function rae(n){delete ME[n]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R(n,e,t,s,r){const i=e.inputParams[n];if(i&&i.inputIndexStart!==void 0){const a=i.inputIndexStart,l=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?a+1:i.inputIndexEnd,c=a<0?e.inputNames.length+a:a;if(i.type==="tensor")return ts(e.inputNames[c],t,s,r);if(i.type==="tensors"){const d=e.inputs.slice(a,l);return e.inputNames.slice(a,l).filter((f,g)=>{var m;return((m=d[g])===null||m===void 0?void 0:m.op)!=="NoOp"}).map(f=>ts(f,t,s,r))}const u=ts(e.inputNames[c],t,s,r),h=u.dataSync();return i.type==="number"?h[0]:Ir(u.shape,h)}const o=e.attrParams[n];return o&&o.value}function ts(n,e,t,s){const[r,i]=tr(n,t);if(s!=null){const a=s.getHashTableHandleByName(r);if(a!=null)return a}const o=t.currentContextIds.find(a=>!!e[vb(r,a)]);return o!==void 0?e[vb(r,o)][i]:void 0}function n2(n,e,t){return e[vb(n,t.currentContextId)]}function lo(n,e){const[t,s,r]=tr(n,e);return[vb(t,e&&e.currentContextId),s,r]}function vb(n,e){return e?`${n}-${e}`:n}function tr(n,e){if(n==="")return["",0,void 0];const t=e!=null&&e.parseNodeNameCache!=null;if(t){const i=e.parseNodeNameCache.get(n);if(i!=null)return i}const s=n.split(":");let r;if(s.length===1)r=[n,0,void 0];else{const i=s[0],o=s.length===3?s[1]:void 0,a=Number(s[s.length-1]);r=[i,a,o]}return t&&e.parseNodeNameCache.set(n,r),r}function by(n,e,t){let s=R("pad",n,e,t);if(s==="explicit"){s=R("explicitPaddings",n,e,t);const r=[[0,0],[0,0],[0,0],[0,0]];for(let i=0;i<4;i++)r[i][0]=s[i*2],r[i][1]=s[i*2+1];return r}return s}function co(n){return n.kept?n:Mi(n)}/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iae=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],oae=Object.freeze(Object.defineProperty({__proto__:null,json:iae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aae=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],lae=Object.freeze(Object.defineProperty({__proto__:null,json:aae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cae=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],uae=Object.freeze(Object.defineProperty({__proto__:null,json:cae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hae=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],dae=Object.freeze(Object.defineProperty({__proto__:null,json:hae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pae=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],fae=Object.freeze(Object.defineProperty({__proto__:null,json:pae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mae=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],gae=Object.freeze(Object.defineProperty({__proto__:null,json:mae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yae=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],bae=Object.freeze(Object.defineProperty({__proto__:null,json:yae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xae=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],wae=Object.freeze(Object.defineProperty({__proto__:null,json:xae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vae=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],Iae=Object.freeze(Object.defineProperty({__proto__:null,json:vae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sae=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],kae=Object.freeze(Object.defineProperty({__proto__:null,json:Sae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tae=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],Cae=Object.freeze(Object.defineProperty({__proto__:null,json:Tae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eae=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],_ae=Object.freeze(Object.defineProperty({__proto__:null,json:Eae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nae=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],Aae=Object.freeze(Object.defineProperty({__proto__:null,json:Nae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rae=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],$ae=Object.freeze(Object.defineProperty({__proto__:null,json:Rae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dae=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],Pae=Object.freeze(Object.defineProperty({__proto__:null,json:Dae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oae=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],Fae=Object.freeze(Object.defineProperty({__proto__:null,json:Oae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lae=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],Mae=Object.freeze(Object.defineProperty({__proto__:null,json:Lae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zae=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],Vae=Object.freeze(Object.defineProperty({__proto__:null,json:zae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bae=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],jae=Object.freeze(Object.defineProperty({__proto__:null,json:Bae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class s2{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[oae,lae,uae,dae,fae,gae,bae,wae,Iae,kae,Cae,_ae,Aae,$ae,Pae,Fae,Mae,Vae,jae],t=[].concat(...e.map(s=>s.json));this.opMappers=t.reduce((s,r)=>(s[r.tfOpName]=r,s),{})}transformGraph(e,t={}){const s=e.node,r=[],i=[],o=[],a=s.reduce((g,m)=>(g[m.name]=this.mapNode(m),m.op.startsWith("Placeholder")?r.push(g[m.name]):m.op==="Const"?i.push(g[m.name]):(m.input==null||m.input.length===0)&&o.push(g[m.name]),g),{});let l=[];const c=[];let u={},h={};t!=null&&(u=this.mapSignatureEntries(t.inputs),h=this.mapSignatureEntries(t.outputs));const d=Object.keys(a);d.forEach(g=>{const m=a[g];m.inputNames.forEach((y,w)=>{const[v,,I]=lo(y),_=a[v];if(_.outputs!=null){const N=_.outputs.indexOf(I);if(N!==-1){const T=`${v}:${N}`;m.inputNames[w]=T}}m.inputs.push(_),_.children.push(m)})}),Object.keys(h).length===0?d.forEach(g=>{const m=a[g];m.children.length===0&&c.push(m)}):Object.keys(h).forEach(g=>{const[m]=lo(g),y=a[m];y!=null&&(y.signatureKey=h[g],c.push(y))}),Object.keys(u).length>0?Object.keys(u).forEach(g=>{const[m]=lo(g),y=a[m];y&&(y.signatureKey=u[g],l.push(y))}):l=r;let p={};e.library!=null&&e.library.function!=null&&(p=e.library.function.reduce((g,m)=>(g[m.signature.name]=this.mapFunction(m),g),{}));const f={nodes:a,inputs:l,outputs:c,weights:i,placeholders:r,signature:t,functions:p};return o.length>0&&(f.initNodes=o),f}mapSignatureEntries(e){return Object.keys(e||{}).reduce((t,s)=>(t[e[s].name]=s,t),{})}mapNode(e){const t=Vz(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});const s={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(r=>r.startsWith("^")?r.slice(1):r),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return t.inputs!=null&&(s.inputParams=t.inputs.reduce((r,i)=>(r[i.name]={type:i.type,inputIndexStart:i.start,inputIndexEnd:i.end},r),{})),t.attrs!=null&&(s.attrParams=t.attrs.reduce((r,i)=>{const o=i.type;let a;switch(i.type){case"string":a=PI(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=PI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"string[]":a=BI(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=BI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number":a=FI(e.attr,i.tfName,i.defaultValue||0),a===void 0&&i.tfDeprecatedName&&(a=FI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number[]":a=VI(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=VI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool":a=OI(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=OI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool[]":a=UI(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=UI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape":a=zI(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=zI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape[]":a=jI(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=jI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype":a=LI(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=LI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype[]":a=MI(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=MI(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"func":a=r2(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=r2(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${i.type} for op: ${e.op}`)}return r[i.name]={value:a,type:o},r},{})),s}mapFunction(e){const t=e.nodeDef,s=[],r=[];let i={};t!=null&&(i=t.reduce((h,d)=>(h[d.name]=this.mapNode(d),d.op==="Const"&&r.push(h[d.name]),h),{}));const o=[],a=[];e.signature.inputArg.forEach(h=>{const[d]=lo(h.name),p={name:d,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:zE(h.type),type:"dtype"}},children:[]};p.signatureKey=h.name,o.push(p),i[d]=p}),Object.keys(i).forEach(h=>{const d=i[h];d.inputNames.forEach((p,f)=>{const[g,,m]=lo(p),y=i[g];if(y.outputs!=null){const w=y.outputs.indexOf(m);if(w!==-1){const v=`${g}:${w}`;d.inputNames[f]=v}}d.inputs.push(y),y.children.push(d)})});const c=e.ret;e.signature.outputArg.forEach(h=>{const[d,p]=lo(c[h.name]),f=i[d];f!=null&&(f.defaultOutput=p,a.push(f))});const u=this.mapArgsToSignature(e);return{nodes:i,inputs:o,outputs:a,weights:r,placeholders:s,signature:u}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((t,s)=>(t[s.name]=this.mapArgToTensorInfo(s),t),{}),outputs:e.signature.outputArg.reduce((t,s)=>(t[s.name]=this.mapArgToTensorInfo(s,e.ret),t),{})}}mapArgToTensorInfo(e,t){let s=e.name;return t!=null&&(s=t[s]),{name:s,dtype:e.type}}}function Uae(n){const e=X().global;if(typeof e.atob<"u")return e.atob(n);if(typeof Buffer<"u")return new Buffer(n,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function Bz(n,e){const t=Array.isArray(n)?String.fromCharCode.apply(null,n):Uae(n);return e?t:t.toLowerCase()}function PI(n,e,t,s=!1){const r=n[e];return r!=null?Bz(r.s,s):t}function OI(n,e,t){const s=n[e];return s?s.b:t}function FI(n,e,t){const s=n[e]||{},r=s.i!=null?s.i:s.f!=null?s.f:t;return typeof r=="number"?r:parseInt(r,10)}function zE(n){switch(typeof n=="string"&&(n=$r[n]),n){case $r.DT_FLOAT:case $r.DT_HALF:return"float32";case $r.DT_INT32:case $r.DT_INT64:case $r.DT_INT8:case $r.DT_UINT8:return"int32";case $r.DT_BOOL:return"bool";case $r.DT_DOUBLE:return"float32";case $r.DT_STRING:return"string";default:return null}}function r2(n,e,t){const s=n[e];return s&&s.func?s.func.name:t}function LI(n,e,t){const s=n[e];return s&&s.type?zE(s.type):t}function MI(n,e,t){const s=n[e];return s&&s.list&&s.list.type?s.list.type.map(r=>zE(r)):t}function jz(n){if(!n.unknownRank)return n.dim!=null?n.dim.map(e=>typeof e.size=="number"?e.size:parseInt(e.size,10)):[]}function zI(n,e,t){const s=n[e];return s&&s.shape?jz(s.shape):t}function VI(n,e,t){const s=n[e];return s?((s.list.f&&s.list.f.length?s.list.f:s.list.i)||[]).map(r=>typeof r=="number"?r:parseInt(r,10)):t}function BI(n,e,t,s=!1){const r=n[e];return r&&r.list&&r.list.s?r.list.s.map(i=>Bz(i,s)):t}function jI(n,e,t){const s=n[e];return s&&s.list&&s.list.shape?s.list.shape.map(r=>jz(r)):t}function UI(n,e,t){const s=n[e];return s&&s.list&&s.list.b?s.list.b:t}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wae{constructor(e,t,s){this.node=e,this.tensorMap=t,this.context=s,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(r=>this.getInput(r)),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce((r,i)=>(r[i]=this.getAttr(i),r),{}))}getInput(e){return ts(e,this.tensorMap,this.context)}getAttr(e,t){const s=this.node.rawAttrs[e];if(s.tensor!=null)return ts(e,this.tensorMap,this.context);if(s.i!=null||s.f!=null)return FI(this.node.rawAttrs,e,t);if(s.s!=null)return PI(this.node.rawAttrs,e,t);if(s.b!=null)return OI(this.node.rawAttrs,e,t);if(s.shape!=null)return zI(this.node.rawAttrs,e,t);if(s.type!=null)return LI(this.node.rawAttrs,e,t);if(s.list!=null){if(s.list.i!=null||s.list.f!=null)return VI(this.node.rawAttrs,e,t);if(s.list.s!=null)return BI(this.node.rawAttrs,e,t);if(s.list.shape!=null)return jI(this.node.rawAttrs,e,t);if(s.list.b!=null)return UI(this.node.rawAttrs,e,t);if(s.list.type!=null)return MI(this.node.rawAttrs,e,t)}return t}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const us=Object.freeze(Object.defineProperty({__proto__:null,OP_SCOPE_SUFFIX:ck,abs:Tn,acos:yk,acosh:bk,add:pe,addN:vF,all:Tw,any:jp,argMax:Bl,argMin:xk,asin:wk,asinh:vk,atan:Ik,atan2:Sk,atanh:kk,avgPool:Tm,avgPool3d:Ck,basicLSTMCell:IF,batchNorm:Oh,batchNorm2d:Ek,batchNorm3d:_k,batchNorm4d:Nk,batchToSpaceND:Cm,bincount:Ak,bitwiseAnd:SF,booleanMaskAsync:lL,broadcastArgs:kF,broadcastTo:Rl,buffer:ct,cast:ve,ceil:Rk,clipByValue:Hs,clone:Mi,complex:So,concat:xn,concat1d:$k,concat2d:Dk,concat3d:Pk,concat4d:Ok,conv1d:Cw,conv2d:ko,conv2dTranspose:Ew,conv3d:Lk,conv3dTranspose:Mk,cos:Em,cosh:_w,cosineWindow:Yw,cumprod:Gp,cumsum:Nw,denseBincount:cb,depthToSpace:zk,depthwiseConv2d:Fh,diag:CF,dilation2d:Vk,div:Me,divNoNan:Bk,dot:jk,dropout:ST,einsum:hl,elu:Lh,enclosingPowerOfTwo:kT,ensureShape:EF,equal:ar,erf:Uk,euclideanNorm:Gk,exp:qs,expandDims:es,expm1:Hk,eye:Aw,fft:Vm,fill:pc,floor:zh,floorDiv:kw,fused:yL,gather:Vh,gatherND:dL,greater:Rs,greaterEqual:Lo,ifft:Su,imag:_m,image:Vr,inTopKAsync:pL,irfft:Ww,isFinite:qk,isInf:Kk,isNaN:Xk,leakyRelu:Nm,less:xu,lessEqual:Ua,linalg:ET,linspace:AF,localResponseNormalization:Yk,log:lr,log1p:Am,logSigmoid:Qk,logSoftmax:$w,logSumExp:Rm,logicalAnd:Wr,logicalNot:$m,logicalOr:Dw,logicalXor:Zk,losses:kL,lowerBound:$F,matMul:pt,max:Sr,maxPool:Dm,maxPool3d:Jk,maxPoolWithArgmax:DF,maximum:to,mean:un,meshgrid:PF,min:bu,minimum:Ca,mirrorPad:eT,mod:tT,moments:Pm,movingAverage:cL,mul:W,multiRNNCell:OF,multinomial:FF,neg:Yt,norm:Mh,notEqual:Gl,oneHot:wu,ones:Vs,onesLike:cr,op:j,outerProduct:LF,pad:Mo,pad1d:MF,pad2d:zF,pad3d:VF,pad4d:BF,pool:nT,pow:To,prelu:Fm,print:mk,prod:sT,raggedGather:jF,raggedRange:UF,raggedTensorToTensor:WF,rand:GF,randomGamma:XF,randomNormal:Ow,randomStandardNormal:YF,randomUniform:Wa,randomUniformInt:QF,range:Hl,real:vu,reciprocal:pT,relu:vi,relu6:Fw,reshape:G,reverse:Cr,reverse1d:ZF,reverse2d:JF,reverse3d:eL,reverse4d:tL,rfft:Bm,round:Lw,rsqrt:Mw,scalar:Ue,scatterND:uL,searchSorted:Pw,selu:zw,separableConv2d:Vw,setdiff1dAsync:nL,sigmoid:oi,sign:fT,signal:SL,sin:Bw,sinh:jw,slice:St,slice1d:Lm,slice2d:Uw,slice3d:Mm,slice4d:Iu,softmax:zm,softplus:fc,spaceToBatchND:Om,sparse:TL,sparseToDense:hL,spectral:IL,split:Bs,sqrt:os,square:jt,squaredDifference:Gw,squeeze:Ga,stack:Es,step:gc,stridedSlice:mT,string:CL,sub:Ne,sum:Pe,tan:gT,tanh:Ul,tensor:ir,tensor1d:ss,tensor2d:fa,tensor3d:yT,tensor4d:sL,tensor5d:rL,tensor6d:iL,tensorScatterUpdate:oL,tile:xr,topk:xT,transpose:vt,truncatedNormal:qw,unique:wT,unsortedSegmentSum:Kw,unstack:Er,upperBound:aL,variable:vT,where:Wn,whereAsync:IT,zeros:En,zerosLike:Ct},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gae=(n,e,t,s=us)=>{switch(n.op){case"BiasAdd":case"AddV2":case"Add":return[s.add(R("a",n,e,t),R("b",n,e,t))];case"AddN":return[s.addN(R("tensors",n,e,t))];case"FloorMod":case"Mod":return[s.mod(R("a",n,e,t),R("b",n,e,t))];case"Mul":return[s.mul(R("a",n,e,t),R("b",n,e,t))];case"RealDiv":case"Div":return[s.div(R("a",n,e,t),R("b",n,e,t))];case"DivNoNan":return[s.divNoNan(R("a",n,e,t),R("b",n,e,t))];case"FloorDiv":return[s.floorDiv(R("a",n,e,t),R("b",n,e,t))];case"Sub":return[s.sub(R("a",n,e,t),R("b",n,e,t))];case"Minimum":return[s.minimum(R("a",n,e,t),R("b",n,e,t))];case"Maximum":return[s.maximum(R("a",n,e,t),R("b",n,e,t))];case"Pow":return[s.pow(R("a",n,e,t),R("b",n,e,t))];case"SquaredDifference":return[s.squaredDifference(R("a",n,e,t),R("b",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hae=(n,e,t,s=us)=>{switch(n.op){case"Abs":case"ComplexAbs":return[s.abs(R("x",n,e,t))];case"Acos":return[s.acos(R("x",n,e,t))];case"Acosh":return[s.acosh(R("x",n,e,t))];case"Asin":return[s.asin(R("x",n,e,t))];case"Asinh":return[s.asinh(R("x",n,e,t))];case"Atan":return[s.atan(R("x",n,e,t))];case"Atan2":return[s.atan2(R("x",n,e,t),R("y",n,e,t))];case"Atanh":return[s.atanh(R("x",n,e,t))];case"Ceil":return[s.ceil(R("x",n,e,t))];case"Complex":return[s.complex(R("real",n,e,t),R("imag",n,e,t))];case"Cos":return[s.cos(R("x",n,e,t))];case"Cosh":return[s.cosh(R("x",n,e,t))];case"Elu":return[s.elu(R("x",n,e,t))];case"Erf":return[s.erf(R("x",n,e,t))];case"Exp":return[s.exp(R("x",n,e,t))];case"Expm1":return[s.expm1(R("x",n,e,t))];case"Floor":return[s.floor(R("x",n,e,t))];case"Log":return[s.log(R("x",n,e,t))];case"Log1p":return[s.log1p(R("x",n,e,t))];case"Imag":return[s.imag(R("x",n,e,t))];case"Neg":return[s.neg(R("x",n,e,t))];case"Reciprocal":return[s.reciprocal(R("x",n,e,t))];case"Real":return[s.real(R("x",n,e,t))];case"Relu":return[s.relu(R("x",n,e,t))];case"Round":return[s.round(R("x",n,e,t))];case"Selu":return[s.selu(R("x",n,e,t))];case"Sigmoid":return[s.sigmoid(R("x",n,e,t))];case"Sin":return[s.sin(R("x",n,e,t))];case"Sign":return[s.sign(R("x",n,e,t))];case"Sinh":return[s.sinh(R("x",n,e,t))];case"Softplus":return[s.softplus(R("x",n,e,t))];case"Sqrt":return[s.sqrt(R("x",n,e,t))];case"Square":return[s.square(R("x",n,e,t))];case"Tanh":return[s.tanh(R("x",n,e,t))];case"Tan":return[s.tan(R("x",n,e,t))];case"ClipByValue":return[s.clipByValue(R("x",n,e,t),R("clipValueMin",n,e,t),R("clipValueMax",n,e,t))];case"Relu6":return[s.relu6(R("x",n,e,t))];case"Rsqrt":return[s.rsqrt(ts(n.inputNames[0],e,t))];case"LeakyRelu":return[s.leakyRelu(R("x",n,e,t),R("alpha",n,e,t))];case"Prelu":return[s.prelu(R("x",n,e,t),R("alpha",n,e,t))];case"IsNan":return[s.isNaN(ts(n.inputNames[0],e,t))];case"IsInf":return[s.isInf(ts(n.inputNames[0],e,t))];case"IsFinite":return[s.isFinite(ts(n.inputNames[0],e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dr(n,e,t=""){if(!(typeof n=="number"||typeof e=="number")){O(n.length===e.length,()=>t+` Shapes ${n} and ${e} must match`);for(let s=0;s<n.length;s++){const r=n[s],i=e[s];O(r<0||i<0||r===i,()=>t+` Shapes ${n} and ${e} must match`)}}}function i2(n){return!(typeof n=="number"||n.some(e=>e<0))}function Ad(n,e,t){let s=WI(n,t);const r=!i2(s);if(r&&e.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${s}`);if(r&&e.forEach(i=>{s=WI(i.shape,s)}),!i2(s))throw new Error(`Non-fully-defined elementShape: ${s}`);return s}function WI(n,e){if(typeof n=="number")return e;if(typeof e=="number")return n;if(n.length!==e.length)throw new Error(`Incompatible ranks during merge: ${n} vs. ${e}`);const t=[];for(let s=0;s<n.length;++s){const r=n[s],i=e[s];if(r>=0&&i>=0&&r!==i)throw new Error(`Incompatible shape during merge: ${n} vs. ${e}`);t[s]=r>=0?r:i}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qae{constructor(e,t,s,r,i,o,a){this.name=e,this.dtype=t,this.maxSize=s,this.elementShape=r,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=a,this.tensors=[],this.closed_=!1,this.idTensor=Ue(0),Pn(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(t=>{(e==null||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const t=this.tensors[e];if(t.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}readMany(e){return e.map(t=>this.read(t))}write(e,t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const s=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},
          because the value dtype is ${t.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=t.shape),Dr(this.elementShape,t.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),s.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(s.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);s.tensor=t,Pn(t),s.written=!0,this.tensors[e]=s}writeMany(e,t){if(e.length!==t.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${t.length}.`);e.forEach((s,r)=>this.write(s,t[r]))}gather(e,t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${t}`);if(e)e=e.slice(0,this.size());else{e=[];for(let r=0;r<this.size();r++)e.push(r)}if(e.length===0)return ir([],[0].concat(this.elementShape));const s=this.readMany(e);return Dr(this.elementShape,s[0].shape,"TensorArray shape mismatch: "),Es(s,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(this.size()===0)return ir([],[0].concat(this.elementShape));const t=[];for(let r=0;r<this.size();r++)t.push(r);const s=this.readMany(t);return Dr(this.elementShape,s[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${s[0].shape})`),xn(s,0)}scatter(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const s=Math.max(...e);if(!this.dynamicSize&&s>=this.maxSize)throw new Error(`Max index must be < array size (${s}  vs. ${this.maxSize})`);this.writeMany(e,Er(t,0))}split(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);let s=0;const r=e.map(l=>(s+=l,s));if(s!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${t.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const i=s===0?0:t.size/s,o=[];Y(()=>{t=G(t,[1,s,i]);for(let l=0;l<e.length;++l){const u=[0,l===0?0:r[l-1],0],h=[1,e[l],i];o[l]=G(St(t,u,h),this.elementShape)}return o});const a=[];for(let l=0;l<e.length;l++)a[l]=l;this.writeMany(a,o)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yl{get id(){return this.idTensor.id}constructor(e,t,s,r=-1){this.tensors=e,this.elementShape=t,this.elementDtype=s,e!=null&&e.forEach(i=>{if(s!==i.dtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${i.dtype}`);Dr(t,i.shape,"TensorList shape mismatch: "),Pn(i)}),this.idTensor=Ue(0),this.maxNumElements=r,Pn(this.idTensor)}copy(){return new Yl([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(t=>{(e==null||!e.has(t.id))&&t.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,t,s=-1){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(s!==-1&&this.tensors.length!==s)throw new Error(`Operation expected a list with ${s} elements but got a list with ${this.tensors.length} elements.`);Dr(e,this.elementShape,"TensorList shape mismatch: ");const r=Ad(this.elementShape,this.tensors,e);return Y(()=>{const i=this.tensors.map(o=>G(o,r));return Es(i,0)})}popBack(e,t){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");const s=Ad(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,Dr(r.shape,e,"TensorList shape mismatch: "),G(r,s)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(Dr(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Pn(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);const t=new Yl([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(let s=0;s<Math.min(this.tensors.length,e);++s)t.tensors[s]=this.tensors[s];return t}getItem(e,t,s){if(s!==this.elementDtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(this.tensors[e]==null)throw new Error(`element at index ${e} is null.`);Dr(this.tensors[e].shape,t,"TensorList shape mismatch: ");const r=Ad(this.elementShape,this.tensors,t);return G(this.tensors[e],r)}setItem(e,t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);Dr(this.elementShape,t.shape,"TensorList shape mismatch: "),Pn(t),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=t}gather(e,t,s){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);Dr(this.elementShape,s,"TensorList shape mismatch: "),e=e.slice(0,this.size());const r=Ad(this.elementShape,this.tensors,s);return e.length===0?ir([],[0].concat(r)):Y(()=>{const i=e.map(o=>G(this.tensors[o],r));return Es(i,0)})}concat(e,t){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);Dr(this.elementShape,t,"TensorList shape mismatch: ");const s=Ad(this.elementShape,this.tensors,t);return this.size()===0?ir([],[0].concat(s)):Y(()=>{const r=this.tensors.map(i=>G(i,s));return xn(r,0)})}}function Kae(n,e,t){const s=n.dtype;if(n.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${n.shape}`);if(n.dtype!==t)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${t}`);const r=n.shape.slice(1);Dr(r,e,"TensorList shape mismatch: ");const i=Er(n);return new Yl(i,e,s)}function Xae(n,e,t,s){return new Yl([],n,e,s)}function Yae(n,e,t,s){if(e.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${n.shape[0]}`);const r=Math.max(...e);if(s!=null&&s!==-1&&r>=s)throw new Error(`Max index must be < array size (${r}  vs. ${s})`);const i=new Yl([],t,n.dtype,s),o=Er(n,0);return e.forEach((a,l)=>{i.setItem(a,o[l])}),i}function Qae(n,e,t){let s=0;const r=e.map(u=>(s+=u,s));if(s!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${n.shape}`);const i=n.shape.slice(1),o=WI(i,t),a=s===0?0:n.size/s,l=Y(()=>{const u=[];n=G(n,[1,s,a]);for(let h=0;h<e.length;++h){const p=[0,h===0?0:r[h-1],0],f=[1,e[h],a];u[h]=G(St(n,p,f),o)}return n.dispose(),u}),c=new Yl([],t,n.dtype,e.length);for(let u=0;u<l.length;u++)c.setItem(u,l[u]);return c}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zae=async(n,e,t)=>{switch(n.op){case"If":case"StatelessIf":{const s=R("thenBranch",n,e,t),r=R("elseBranch",n,e,t),i=R("cond",n,e,t),o=R("args",n,e,t);return(await i.data())[0]?t.functionMap[s].executeFunctionAsync(o,t.tensorArrayMap,t.tensorListMap):t.functionMap[r].executeFunctionAsync(o,t.tensorArrayMap,t.tensorListMap)}case"While":case"StatelessWhile":{const s=R("body",n,e,t),r=R("cond",n,e,t),i=R("args",n,e,t),o=await t.functionMap[r].executeFunctionAsync(i,t.tensorArrayMap,t.tensorListMap),a=i.map(u=>u.id);let l=await o[0].data();o.forEach(u=>{!u.kept&&a.indexOf(u.id)===-1&&u.dispose()});let c=i;for(;l[0];){const u=c;c=await t.functionMap[s].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap);const h=c.map(p=>p.id);u.forEach(p=>{!p.kept&&a.indexOf(p.id)===-1&&h.indexOf(p.id)===-1&&p.dispose()});const d=await t.functionMap[r].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap);l=await d[0].data(),d.forEach(p=>{!p.kept&&a.indexOf(p.id)===-1&&h.indexOf(p.id)===-1&&p.dispose()})}return c}case"LoopCond":{const s=R("pred",n,e,t);return[co(s)]}case"Switch":{const s=R("pred",n,e,t);let r=R("data",n,e,t);return r.kept||(r=co(r)),(await s.data())[0]?[void 0,r]:[r,void 0]}case"Merge":{const s=n.inputNames.find(r=>ts(r,e,t)!==void 0);if(s){const r=ts(s,e,t);return[co(r)]}return}case"Enter":{const s=R("frameName",n,e,t),r=R("tensor",n,e,t);return t.enterFrame(s),[co(r)]}case"Exit":{const s=R("tensor",n,e,t);return t.exitFrame(),[co(s)]}case"NextIteration":{const s=R("tensor",n,e,t);return t.nextIteration(),[co(s)]}case"TensorArrayV3":{const s=R("size",n,e,t),r=R("dtype",n,e,t),i=R("elementShape",n,e,t),o=R("dynamicSize",n,e,t),a=R("clearAfterRead",n,e,t),l=R("identicalElementShapes",n,e,t),c=R("name",n,e,t),u=new qae(c,r,s,i,l,o,a);return t.addTensorArray(u),[u.idTensor,Ue(1)]}case"TensorArrayWriteV3":{const s=R("tensorArrayId",n,e,t),r=R("index",n,e,t),i=R("tensor",n,e,t),o=t.getTensorArray(s.id);return o.write(r,i),[o.idTensor]}case"TensorArrayReadV3":{const s=R("tensorArrayId",n,e,t),r=R("index",n,e,t);return[t.getTensorArray(s.id).read(r)]}case"TensorArrayGatherV3":{const s=R("tensorArrayId",n,e,t),r=R("indices",n,e,t),i=R("dtype",n,e,t);return[t.getTensorArray(s.id).gather(r,i)]}case"TensorArrayScatterV3":{const s=R("tensorArrayId",n,e,t),r=R("indices",n,e,t),i=R("tensor",n,e,t),o=t.getTensorArray(s.id);return o.scatter(r,i),[o.idTensor]}case"TensorArrayConcatV3":{const s=R("tensorArrayId",n,e,t),r=t.getTensorArray(s.id),i=R("dtype",n,e,t);return[r.concat(i)]}case"TensorArraySplitV3":{const s=R("tensorArrayId",n,e,t),r=R("tensor",n,e,t),i=R("lengths",n,e,t),o=t.getTensorArray(s.id);return o.split(i,r),[o.idTensor]}case"TensorArraySizeV3":{const s=R("tensorArrayId",n,e,t),r=t.getTensorArray(s.id);return[Ue(r.size(),"int32")]}case"TensorArrayCloseV3":{const s=R("tensorArrayId",n,e,t),r=t.getTensorArray(s.id);return r.clearAndClose(),[r.idTensor]}case"TensorListSetItem":{const s=R("tensorListId",n,e,t),r=R("index",n,e,t),i=R("tensor",n,e,t),o=t.getTensorList(s.id);return o.setItem(r,i),[o.idTensor]}case"TensorListGetItem":{const s=R("tensorListId",n,e,t),r=R("index",n,e,t),i=R("elementShape",n,e,t),o=R("elementDType",n,e,t);return[t.getTensorList(s.id).getItem(r,i,o)]}case"TensorListScatterV2":case"TensorListScatter":{const s=R("indices",n,e,t),r=R("tensor",n,e,t),i=R("elementShape",n,e,t),o=R("numElements",n,e,t),a=Yae(r,s,i,o);return t.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const s=R("elementShape",n,e,t),r=R("elementDType",n,e,t);let i;n.op==="TensorListReserve"?i="numElements":i="maxNumElements";const o=R(i,n,e,t),a=n.op==="TensorListReserve"?-1:o,l=Xae(s,r,o,a);return t.addTensorList(l),[l.idTensor]}case"TensorListGather":{const s=R("tensorListId",n,e,t),r=R("indices",n,e,t),i=R("elementShape",n,e,t),o=R("elementDType",n,e,t);return[t.getTensorList(s.id).gather(r,o,i)]}case"TensorListStack":{const s=R("tensorListId",n,e,t),r=R("elementShape",n,e,t),i=R("elementDType",n,e,t),o=R("numElements",n,e,t);return[t.getTensorList(s.id).stack(r,i,o)]}case"TensorListFromTensor":{const s=R("tensor",n,e,t),r=R("elementShape",n,e,t),i=R("elementDType",n,e,t),o=Kae(s,r,i);return t.addTensorList(o),[o.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const s=R("tensorListId",n,e,t),r=t.getTensorList(s.id),i=R("dtype",n,e,t),o=R("elementShape",n,e,t);return[r.concat(i,o)]}case"TensorListPushBack":{const s=R("tensorListId",n,e,t),r=R("tensor",n,e,t),i=t.getTensorList(s.id);return i.pushBack(r),[i.idTensor]}case"TensorListPopBack":{const s=R("tensorListId",n,e,t),r=R("elementShape",n,e,t),i=R("elementDType",n,e,t);return[t.getTensorList(s.id).popBack(r,i)]}case"TensorListSplit":{const s=R("tensor",n,e,t),r=R("elementShape",n,e,t),i=R("lengths",n,e,t),o=Qae(s,i,r);return t.addTensorList(o),[o.idTensor]}case"TensorListLength":{const s=R("tensorListId",n,e,t),r=t.getTensorList(s.id);return[Ue(r.size(),"int32")]}case"TensorListResize":{const s=R("tensorListId",n,e,t),r=R("size",n,e,t),o=t.getTensorList(s.id).resize(r);return t.addTensorList(o),[o.idTensor]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o2(n,e,t){const[s,r]=R("fusedOps",n,e,t),i=s==="biasadd",o=!i,a=r==="prelu",l=s==="fusedbatchnorm",c=R("numArgs",n,e,t);if(i){if(a&&c!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&i&&c!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const u=R("strides",n,e,t),h=by(n,e,t),d=R("dataFormat",n,e,t).toUpperCase(),p=R("dilations",n,e,t);let[f,g]=R("args",n,e,t);o&&(g=f,f=void 0);const m=R("leakyreluAlpha",n,e,t);return{stride:u,pad:h,dataFormat:d,dilations:p,biasArg:f,preluArg:g,activationFunc:r,leakyreluAlpha:m}}const Jae=(n,e,t,s=us)=>{switch(n.op){case"Conv1D":{const r=R("stride",n,e,t),i=R("pad",n,e,t),o=R("dataFormat",n,e,t).toUpperCase(),a=R("dilation",n,e,t);return[s.conv1d(R("x",n,e,t),R("filter",n,e,t),r,i,o,a)]}case"Conv2D":{const r=R("strides",n,e,t),i=by(n,e,t),o=R("dataFormat",n,e,t).toUpperCase(),a=R("dilations",n,e,t);return[s.conv2d(R("x",n,e,t),R("filter",n,e,t),[r[1],r[2]],i,o,[a[1],a[2]])]}case"_FusedConv2D":{const{stride:r,pad:i,dataFormat:o,dilations:a,biasArg:l,preluArg:c,activationFunc:u,leakyreluAlpha:h}=o2(n,e,t);return[s.fused.conv2d({x:R("x",n,e,t),filter:R("filter",n,e,t),strides:[r[1],r[2]],pad:i,dataFormat:o,dilations:[a[1],a[2]],bias:l,activation:u,preluActivationWeights:c,leakyreluAlpha:h})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:i,dataFormat:o,dilations:a,biasArg:l,preluArg:c,activationFunc:u,leakyreluAlpha:h}=o2(n,e,t);return[s.fused.depthwiseConv2d({x:R("x",n,e,t),filter:R("filter",n,e,t),strides:[r[1],r[2]],pad:i,dataFormat:o,dilations:[a[1],a[2]],bias:l,activation:u,preluActivationWeights:c,leakyreluAlpha:h})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=R("outputShape",n,e,t),i=R("strides",n,e,t),o=by(n,e,t);return[s.conv2dTranspose(R("x",n,e,t),R("filter",n,e,t),r,[i[1],i[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=R("strides",n,e,t),i=by(n,e,t),o=R("dilations",n,e,t),a=R("dataFormat",n,e,t).toUpperCase();return[s.depthwiseConv2d(R("input",n,e,t),R("filter",n,e,t),[r[1],r[2]],i,a,[o[1],o[2]])]}case"Conv3D":{const r=R("strides",n,e,t),i=R("pad",n,e,t),o=R("dataFormat",n,e,t).toUpperCase(),a=R("dilations",n,e,t);return[s.conv3d(R("x",n,e,t),R("filter",n,e,t),[r[1],r[2],r[3]],i,o,[a[1],a[2],a[3]])]}case"AvgPool":{const r=R("strides",n,e,t),i=R("pad",n,e,t),o=R("kernelSize",n,e,t);return[s.avgPool(R("x",n,e,t),[o[1],o[2]],[r[1],r[2]],i)]}case"MaxPool":{const r=R("strides",n,e,t),i=R("pad",n,e,t),o=R("kernelSize",n,e,t);return[s.maxPool(R("x",n,e,t),[o[1],o[2]],[r[1],r[2]],i)]}case"MaxPoolWithArgmax":{const r=R("strides",n,e,t),i=R("pad",n,e,t),o=R("kernelSize",n,e,t),a=R("includeBatchInIndex",n,e,t),{result:l,indexes:c}=s.maxPoolWithArgmax(R("x",n,e,t),[o[1],o[2]],[r[1],r[2]],i,a);return[l,c]}case"AvgPool3D":{const r=R("strides",n,e,t),i=R("pad",n,e,t),o=R("kernelSize",n,e,t);return[s.avgPool3d(R("x",n,e,t),[o[1],o[2],o[3]],[r[1],r[2],r[3]],i)]}case"MaxPool3D":{const r=R("strides",n,e,t),i=R("pad",n,e,t),o=R("kernelSize",n,e,t);return[s.maxPool3d(R("x",n,e,t),[o[1],o[2],o[3]],[r[1],r[2],r[3]],i)]}case"Dilation2D":{const r=R("strides",n,e,t),i=R("pad",n,e,t),o=R("dilations",n,e,t),a=r[1],l=r[2],c=o[1],u=o[2];return[s.dilation2d(R("x",n,e,t),R("filter",n,e,t),[a,l],i,[c,u],"NHWC")]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ele=(n,e,t,s=us)=>{switch(n.op){case"Fill":{const r=R("shape",n,e,t),i=R("dtype",n,e,t),o=R("value",n,e,t);return[s.fill(r,o,i)]}case"LinSpace":{const r=R("start",n,e,t),i=R("stop",n,e,t),o=R("num",n,e,t);return[s.linspace(r,i,o)]}case"Multinomial":{const r=R("logits",n,e,t),i=R("numSamples",n,e,t),o=R("seed",n,e,t);return[s.multinomial(r,i,o)]}case"OneHot":{const r=R("indices",n,e,t),i=R("depth",n,e,t),o=R("onValue",n,e,t),a=R("offValue",n,e,t),l=R("dtype",n,e,t);return[s.oneHot(r,i,o,a,l)]}case"Ones":return[s.ones(R("shape",n,e,t),R("dtype",n,e,t))];case"OnesLike":return[s.onesLike(R("x",n,e,t))];case"RandomStandardNormal":return[s.randomStandardNormal(R("shape",n,e,t),R("dtype",n,e,t),R("seed",n,e,t))];case"RandomUniform":return[s.randomUniform(R("shape",n,e,t),R("minval",n,e,t),R("maxval",n,e,t),R("dtype",n,e,t))];case"RandomUniformInt":return[s.randomUniformInt(R("shape",n,e,t),R("minval",n,e,t),R("maxval",n,e,t),R("seed",n,e,t))];case"Range":{const r=R("start",n,e,t),i=R("stop",n,e,t),o=R("step",n,e,t);return[s.range(r,i,o,R("dtype",n,e,t))]}case"TruncatedNormal":{const r=R("shape",n,e,t),i=R("mean",n,e,t),o=R("stdDev",n,e,t),a=R("seed",n,e,t);return[s.truncatedNormal(r,i,o,R("dtype",n,e,t),a)]}case"Zeros":return[s.zeros(R("shape",n,e,t),R("dtype",n,e,t))];case"ZerosLike":return[s.zerosLike(R("x",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kv(n,e,t){const s=R("boxes",n,e,t),r=R("scores",n,e,t),i=R("maxOutputSize",n,e,t),o=R("iouThreshold",n,e,t),a=R("scoreThreshold",n,e,t),l=R("softNmsSigma",n,e,t);return{boxes:s,scores:r,maxOutputSize:i,iouThreshold:o,scoreThreshold:a,softNmsSigma:l}}const tle=async(n,e,t,s,r=us)=>{switch(n.op){case"NonMaxSuppressionV5":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:c,softNmsSigma:u}=Kv(n,e,t),h=await r.image.nonMaxSuppressionWithScoreAsync(i,o,a,l,c,u);return[h.selectedIndices,h.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:c}=Kv(n,e,t),u=R("padToMaxOutputSize",n,e,t),h=await r.image.nonMaxSuppressionPaddedAsync(i,o,a,l,c,u);return[h.selectedIndices,h.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:c}=Kv(n,e,t);return[await r.image.nonMaxSuppressionAsync(i,o,a,l,c)]}case"Where":{const i=r.cast(R("condition",n,e,t),"bool"),o=[await r.whereAsync(i)];return i.dispose(),o}case"ListDiff":return r.setdiff1dAsync(R("x",n,e,t),R("y",n,e,t));default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nle=(n,e,t,s=us)=>{switch(n.op){case"LowerBound":{const r=R("sortedSequence",n,e,t),i=R("values",n,e,t);return[s.lowerBound(r,i)]}case"TopKV2":{const r=R("x",n,e,t),i=R("k",n,e,t),o=R("sorted",n,e,t),a=s.topk(r,i,o);return[a.values,a.indices]}case"UpperBound":{const r=R("sortedSequence",n,e,t),i=R("values",n,e,t);return[s.upperBound(r,i)]}case"Unique":{const r=R("x",n,e,t),i=s.unique(r);return[i.values,i.indices]}case"UniqueV2":{const r=R("x",n,e,t),i=R("axis",n,e,t),o=s.unique(r,i);return[o.values,o.indices]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sle=(n,e,t,s=us)=>{switch(n.op){case"Const":return e[n.name];case"PlaceholderWithDefault":const r=R("default",n,e,t);return[ts(n.name,e,t)||r];case"Placeholder":return[ts(n.name,e,t)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{const u=R("x",n,e,t);return[co(u)]}case"IdentityN":return R("x",n,e,t).map(u=>co(u));case"Snapshot":const i=R("x",n,e,t);return[co(i)];case"Shape":return[s.tensor1d(R("x",n,e,t).shape,"int32")];case"ShapeN":return R("x",n,e,t).map(u=>s.tensor1d(u.shape));case"Size":return[s.scalar(R("x",n,e,t).size,"int32")];case"Rank":return[s.scalar(R("x",n,e,t).rank,"int32")];case"NoOp":return[s.scalar(1)];case"Print":const o=R("x",n,e,t),a=R("data",n,e,t),l=R("message",n,e,t),c=R("summarize",n,e,t);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(l);for(let u=0;u<a.length;u++)console.log(Array.prototype.slice.call(a[u].dataSync()).slice(0,c));return[o];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rle{get id(){return this.handle.id}constructor(e,t){this.keyDType=e,this.valueDType=t,this.handle=Ue(0),this.tensorMap=new Map,Pn(this.handle)}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Ue(this.size(),"int32")}async import(e,t){this.checkKeyAndValueTensor(e,t);const s=await e.data();return this.tensorMap.forEach(r=>r.dispose()),this.tensorMap.clear(),Y(()=>{const r=Er(t),i=s.length,o=r.length;O(i===o,()=>`The number of elements doesn't match, keys has ${i} elements, the values has ${o} elements.`);for(let a=0;a<i;a++){const l=s[a],c=r[a];Pn(c),this.tensorMap.set(l,c)}return this.handle})}async find(e,t){this.checkKeyAndValueTensor(e,t);const s=await e.data();return Y(()=>{const r=[];for(let i=0;i<s.length;i++){const o=s[i],a=this.findWithDefault(o,t);r.push(a)}return Es(r)})}findWithDefault(e,t){const s=this.tensorMap.get(e);return s??t}checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(t.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${t.dtype}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ile=async(n,e,t,s)=>{switch(n.op){case"HashTable":case"HashTableV2":{const r=s.getHashTableHandleByName(n.name);if(r!=null)return[r];{const i=R("keyDType",n,e,t),o=R("valueDType",n,e,t),a=new rle(i,o);return s.addHashTable(n.name,a),[a.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{const r=R("tableHandle",n,e,t,s),i=R("keys",n,e,t),o=R("values",n,e,t);return[await s.getHashTableById(r.id).import(i,o)]}case"LookupTableFind":case"LookupTableFindV2":{const r=R("tableHandle",n,e,t,s),i=R("keys",n,e,t),o=R("defaultValue",n,e,t);return[await s.getHashTableById(r.id).find(i,o)]}case"LookupTableSize":case"LookupTableSizeV2":{const r=R("tableHandle",n,e,t,s);return[s.getHashTableById(r.id).tensorSize()]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ole=(n,e,t,s=us)=>{switch(n.op){case"ResizeBilinear":{const r=R("images",n,e,t),i=R("size",n,e,t),o=R("alignCorners",n,e,t),a=R("halfPixelCenters",n,e,t);return[s.image.resizeBilinear(r,[i[0],i[1]],o,a)]}case"ResizeNearestNeighbor":{const r=R("images",n,e,t),i=R("size",n,e,t),o=R("alignCorners",n,e,t),a=R("halfPixelCenters",n,e,t);return[s.image.resizeNearestNeighbor(r,[i[0],i[1]],o,a)]}case"CropAndResize":{const r=R("image",n,e,t),i=R("boxes",n,e,t),o=R("boxInd",n,e,t),a=R("cropSize",n,e,t),l=R("method",n,e,t),c=R("extrapolationValue",n,e,t);return[s.image.cropAndResize(r,i,o,a,l,c)]}case"ImageProjectiveTransformV3":{const r=R("images",n,e,t),i=R("transforms",n,e,t),o=R("outputShape",n,e,t),a=R("fillValue",n,e,t),l=R("interpolation",n,e,t),c=R("fillMode",n,e,t);return[s.image.transform(r,i,l.toLowerCase(),c.toLowerCase(),a,o)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ale=(n,e,t,s=us)=>{switch(n.op){case"Equal":return[s.equal(R("a",n,e,t),R("b",n,e,t))];case"NotEqual":return[s.notEqual(R("a",n,e,t),R("b",n,e,t))];case"Greater":return[s.greater(R("a",n,e,t),R("b",n,e,t))];case"GreaterEqual":return[s.greaterEqual(R("a",n,e,t),R("b",n,e,t))];case"Less":return[s.less(R("a",n,e,t),R("b",n,e,t))];case"LessEqual":return[s.lessEqual(R("a",n,e,t),R("b",n,e,t))];case"LogicalAnd":return[s.logicalAnd(R("a",n,e,t),R("b",n,e,t))];case"LogicalNot":return[s.logicalNot(R("a",n,e,t))];case"LogicalOr":return[s.logicalOr(R("a",n,e,t),R("b",n,e,t))];case"Select":case"SelectV2":return[s.where(R("condition",n,e,t),R("a",n,e,t),R("b",n,e,t))];case"BitwiseAnd":return[s.bitwiseAnd(R("a",n,e,t),R("b",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lle=(n,e,t,s=us)=>{switch(n.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[s.matMul(R("a",n,e,t),R("b",n,e,t),R("transposeA",n,e,t),R("transposeB",n,e,t))];case"Einsum":return[s.einsum(R("equation",n,e,t),...R("tensors",n,e,t))];case"Transpose":return[s.transpose(R("x",n,e,t),R("perm",n,e,t))];case"_FusedMatMul":const[r,i]=R("fusedOps",n,e,t),o=r==="biasadd",a=i==="prelu",l=R("numArgs",n,e,t),c=R("leakyreluAlpha",n,e,t);if(o){if(a&&l!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&l!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[u,h]=R("args",n,e,t);return[s.fused.matMul({a:R("a",n,e,t),b:R("b",n,e,t),transposeA:R("transposeA",n,e,t),transposeB:R("transposeB",n,e,t),bias:u,activation:i,preluActivationWeights:h,leakyreluAlpha:c})];case"MatrixBandPart":return[s.linalg.bandPart(R("a",n,e,t),R("numLower",n,e,t),R("numUpper",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cle=(n,e,t,s=us)=>{switch(n.op){case"EuclideanNorm":return[s.euclideanNorm(R("x",n,e,t),R("axis",n,e,t),R("keepDims",n,e,t))];case"FusedBatchNorm":case"FusedBatchNormV2":return[s.batchNorm(R("x",n,e,t),R("mean",n,e,t),R("variance",n,e,t),R("offset",n,e,t),R("scale",n,e,t),R("epsilon",n,e,t))];case"FusedBatchNormV3":return[s.batchNorm(R("x",n,e,t),R("mean",n,e,t),R("variance",n,e,t),R("offset",n,e,t),R("scale",n,e,t),R("epsilon",n,e,t))];case"LRN":return[s.localResponseNormalization(R("x",n,e,t),R("radius",n,e,t),R("bias",n,e,t),R("alpha",n,e,t),R("beta",n,e,t))];case"Softmax":return[s.softmax(R("x",n,e,t))];case"LogSoftmax":return[s.logSoftmax(R("x",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ule=(n,e,t,s=us)=>{switch(n.op){case"RaggedGather":{const{outputNestedSplits:r,outputDenseValues:i}=s.raggedGather(R("paramsNestedSplits",n,e,t),R("paramsDenseValues",n,e,t),R("indices",n,e,t),R("outputRaggedRank",n,e,t));return r.concat(i)}case"RaggedRange":{const{rtNestedSplits:r,rtDenseValues:i}=s.raggedRange(R("starts",n,e,t),R("limits",n,e,t),R("splits",n,e,t));return[r,i]}case"RaggedTensorToTensor":return[s.raggedTensorToTensor(R("shape",n,e,t),R("values",n,e,t),R("defaultValue",n,e,t),R("rowPartitionTensors",n,e,t),R("rowPartitionTypes",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hle=(n,e,t,s=us)=>{switch(n.op){case"Max":{const a=R("axis",n,e,t),l=R("keepDims",n,e,t);return[s.max(R("x",n,e,t),a,l)]}case"Mean":{const a=R("axis",n,e,t),l=R("keepDims",n,e,t);return[s.mean(R("x",n,e,t),a,l)]}case"Min":{const a=R("axis",n,e,t),l=R("keepDims",n,e,t);return[s.min(R("x",n,e,t),a,l)]}case"Sum":{const a=R("axis",n,e,t),l=R("keepDims",n,e,t);return[s.sum(R("x",n,e,t),a,l)]}case"All":{const a=R("axis",n,e,t),l=R("keepDims",n,e,t);return[s.all(R("x",n,e,t),a,l)]}case"Any":{const a=R("axis",n,e,t),l=R("keepDims",n,e,t);return[s.any(R("x",n,e,t),a,l)]}case"ArgMax":{const a=R("axis",n,e,t);return[s.argMax(R("x",n,e,t),a)]}case"ArgMin":{const a=R("axis",n,e,t);return[s.argMin(R("x",n,e,t),a)]}case"Prod":{const a=R("axis",n,e,t),l=R("keepDims",n,e,t);return[s.prod(R("x",n,e,t),a,l)]}case"Cumprod":{const a=R("axis",n,e,t),l=R("exclusive",n,e,t),c=R("reverse",n,e,t);return[s.cumprod(R("x",n,e,t),a,l,c)]}case"Cumsum":{const a=R("axis",n,e,t),l=R("exclusive",n,e,t),c=R("reverse",n,e,t);return[s.cumsum(R("x",n,e,t),a,l,c)]}case"Bincount":const r=R("x",n,e,t),i=R("weights",n,e,t),o=R("size",n,e,t);return[s.bincount(r,i,o)];case"DenseBincount":{const a=R("x",n,e,t),l=R("weights",n,e,t),c=R("size",n,e,t),u=R("binaryOutput",n,e,t);return[s.denseBincount(a,l,c,u)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dle=(n,e,t,s=us)=>{switch(n.op){case"ConcatV2":case"Concat":{const r=R("n",n,e,t),i=R("axis",n,e,t);let o=R("tensors",n,e,t);return o=o.slice(0,r),[s.concat(o,i)]}case"Gather":{const r=R("x",n,e,t),i=R("indices",n,e,t);return[s.gather(r,s.cast(i,"int32"),0)]}case"GatherV2":{const r=R("axis",n,e,t),i=R("batchDims",n,e,t),o=R("x",n,e,t),a=R("indices",n,e,t);return[s.gather(o,s.cast(a,"int32"),r,i)]}case"Reverse":{const r=R("dims",n,e,t),i=[];for(let a=0;a<r.length;a++)r[a]&&i.push(a);const o=R("x",n,e,t);return[s.reverse(o,i)]}case"ReverseV2":{const r=R("axis",n,e,t),i=R("x",n,e,t);return[s.reverse(i,r)]}case"Slice":{const r=R("begin",n,e,t),i=R("size",n,e,t);return[s.slice(R("x",n,e,t),r,i)]}case"StridedSlice":{const r=R("begin",n,e,t),i=R("end",n,e,t),o=R("strides",n,e,t),a=R("beginMask",n,e,t),l=R("endMask",n,e,t),c=R("ellipsisMask",n,e,t),u=R("newAxisMask",n,e,t),h=R("shrinkAxisMask",n,e,t),d=R("x",n,e,t);return[s.stridedSlice(d,r,i,o,a,l,c,u,h)]}case"Pack":return Y(()=>{const r=R("axis",n,e,t),i=R("tensors",n,e,t),o=i[0].shape,a=s.squeeze(i[0]).shape,l=i.map(c=>{const u=wt(c.shape,o);if(!u&&!wt(s.squeeze(c).shape,a))throw new Error("the input tensors shape does not match");return u?c:s.reshape(c,o)});return[s.stack(l,r)]});case"Unpack":{const r=R("axis",n,e,t),i=R("tensor",n,e,t);return s.unstack(i,r)}case"Tile":{const r=R("reps",n,e,t);return[s.tile(R("x",n,e,t),r)]}case"Split":case"SplitV":{const r=R("axis",n,e,t),i=R("numOrSizeSplits",n,e,t),o=R("x",n,e,t);return s.split(o,i,r)}case"ScatterNd":{const r=R("indices",n,e,t),i=R("values",n,e,t),o=R("shape",n,e,t);return[s.scatterND(r,i,o)]}case"GatherNd":{const r=R("x",n,e,t),i=R("indices",n,e,t);return[s.gatherND(r,i)]}case"SparseToDense":{const r=R("sparseIndices",n,e,t),i=R("outputShape",n,e,t),o=R("sparseValues",n,e,t),a=R("defaultValue",n,e,t);return[s.sparseToDense(r,o,i,o.dtype===a.dtype?a:s.cast(a,o.dtype))]}case"TensorScatterUpdate":{const r=R("indices",n,e,t),i=R("values",n,e,t),o=R("tensor",n,e,t);return[s.tensorScatterUpdate(o,r,i)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ple=(n,e,t,s=us)=>{switch(n.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:i,emptyRowIndicator:o,reverseIndexMap:a}=s.sparse.sparseFillEmptyRows(R("indices",n,e,t),R("values",n,e,t),R("denseShape",n,e,t),R("defaultValue",n,e,t));return[r,i,o,a]}case"SparseReshape":{const{outputIndices:r,outputShape:i}=s.sparse.sparseReshape(R("inputIndices",n,e,t),R("inputShape",n,e,t),R("newShape",n,e,t));return[r,i]}case"SparseSegmentMean":return[s.sparse.sparseSegmentMean(R("data",n,e,t),R("indices",n,e,t),R("segmentIds",n,e,t))];case"SparseSegmentSum":return[s.sparse.sparseSegmentSum(R("data",n,e,t),R("indices",n,e,t),R("segmentIds",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fle=(n,e,t,s=us)=>{switch(n.op){case"FFT":return[s.fft(R("x",n,e,t))];case"IFFT":return[s.ifft(R("x",n,e,t))];case"RFFT":return[s.rfft(R("x",n,e,t))];case"IRFFT":return[s.irfft(R("x",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mle=(n,e,t,s=us)=>{switch(n.op){case"StaticRegexReplace":return[s.string.staticRegexReplace(R("input",n,e,t),R("pattern",n,e,t),R("rewrite",n,e,t),R("replaceGlobal",n,e,t))];case"StringNGrams":{const{nGrams:r,nGramsSplits:i}=s.string.stringNGrams(R("data",n,e,t),R("dataSplits",n,e,t),R("separator",n,e,t),R("nGramWidths",n,e,t),R("leftPad",n,e,t),R("rightPad",n,e,t),R("padWidth",n,e,t),R("preserveShortSequences",n,e,t));return[r,i]}case"StringSplit":{const{indices:r,values:i,shape:o}=s.string.stringSplit(R("input",n,e,t),R("delimiter",n,e,t),R("skipEmpty",n,e,t));return[r,i,o]}case"StringToHashBucketFast":return[s.string.stringToHashBucketFast(R("input",n,e,t),R("numBuckets",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gle=(n,e,t,s=us)=>{switch(n.op){case"Cast":return[s.cast(R("x",n,e,t),R("dtype",n,e,t))];case"ExpandDims":{const r=R("axis",n,e,t);return[s.expandDims(R("x",n,e,t),r)]}case"Squeeze":{const r=R("axis",n,e,t);return[s.squeeze(R("x",n,e,t),r)]}case"Reshape":return[s.reshape(R("x",n,e,t),R("shape",n,e,t))];case"EnsureShape":return[s.ensureShape(R("x",n,e,t),R("shape",n,e,t))];case"MirrorPad":return[s.mirrorPad(R("x",n,e,t),R("padding",n,e,t),R("mode",n,e,t))];case"PadV2":case"Pad":return[s.pad(R("x",n,e,t),R("padding",n,e,t),R("constantValue",n,e,t))];case"SpaceToBatchND":{const r=R("blockShape",n,e,t),i=R("paddings",n,e,t);return[s.spaceToBatchND(R("x",n,e,t),r,i)]}case"BatchToSpaceND":{const r=R("blockShape",n,e,t),i=R("crops",n,e,t);return[s.batchToSpaceND(R("x",n,e,t),r,i)]}case"DepthToSpace":{const r=R("blockSize",n,e,t),i=R("dataFormat",n,e,t).toUpperCase();return[s.depthToSpace(R("x",n,e,t),r,i)]}case"BroadcastTo":return[s.broadcastTo(R("x",n,e,t),R("shape",n,e,t))];case"BroadcastArgs":return[s.broadcastArgs(R("s0",n,e,t),R("s1",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a2(n,e,t,s,r=Y){const i=((o,a,l)=>{switch(o.category){case"arithmetic":return r(()=>Gae(o,a,l));case"basic_math":return r(()=>Hae(o,a,l));case"control":return Zae(o,a,l);case"convolution":return r(()=>Jae(o,a,l));case"creation":return r(()=>ele(o,a,l));case"dynamic":return tle(o,a,l);case"evaluation":return r(()=>nle(o,a,l));case"image":return r(()=>ole(o,a,l));case"graph":return r(()=>sle(o,a,l));case"logical":return r(()=>ale(o,a,l));case"matrices":return r(()=>lle(o,a,l));case"normalization":return r(()=>cle(o,a,l));case"ragged":return r(()=>ule(o,a,l));case"reduction":return r(()=>hle(o,a,l));case"slice_join":return r(()=>dle(o,a,l));case"sparse":return r(()=>ple(o,a,l));case"spectral":return r(()=>fle(o,a,l));case"string":return r(()=>mle(o,a,l));case"transformation":return r(()=>gle(o,a,l));case"hash_table":return ile(o,a,l,s);case"custom":const c=Vz(o.op);if(c&&c.customExecutor)return c.customExecutor(new Wae(o,a,l));throw TypeError(`Custom op ${o.op} is not registered.`);default:throw TypeError(`Unknown op '${o.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(n,e,t);return wo(i)?i.then(o=>[].concat(o)):[].concat(i)}class l2{constructor(e={},t={},s={},r={},i){this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=s,this.functionMap=r,this.parseNodeNameCache=i,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,t){return{id:e,frameName:t,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let t=0;t<this.contexts.length-1;t++){const s=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(s))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(t=>t.id===0&&t.iterationId===0?"":`${t.frameName}-${t.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(const t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c2(n,e,t,s){const r=new Set,i=[];let o=null,a=null;const l=new Set,c=new Set(Object.keys(n).map(d=>tr(d)[0]));s=s||[];const u=new Set(s.map(d=>tr(d.name)[0])),h=[...e];for(;h.length>0;){const d=h.pop();if((pl(d)||kle(d)||Tle(d))&&o==null&&(o=d,a=o.children.map(p=>p.name).filter(p=>r.has(p))),r.add(d.name),t[d.name]==null&&!c.has(d.name)&&!u.has(d.name)){if(d.inputs.length===0){i.push(d.name);continue}d.inputs.forEach(p=>{l.has(p.name)||(l.add(p.name),h.push(p))})}}return{inputs:n,outputs:e,usedNodes:r,missingInputs:i,dynamicNode:o,syncInputs:a}}function yle(n,e){const{usedNodes:t,inputs:s}=e,r=Object.keys(s).map(m=>tr(m)[0]).map(m=>n.nodes[m]),i=n.initNodes||[],o=m=>t.has(typeof m=="string"?m:m.name);function a(m){return[...new Map(m.map(y=>[y.name,y])).values()]}const l=a([...r,...n.weights,...i]).filter(o),c=a([...l,...Object.values(n.nodes)]).filter(o),u=new Map(c.map(m=>[m.name,m])),h={};for(const m of c){h[m.name]=h[m.name]||0;for(const y of m.children)o(y)||(h[y.name]=Number.POSITIVE_INFINITY),h[y.name]=(h[y.name]||0)+1}const d=Object.entries(h).filter(([,m])=>m===0).map(([m])=>m),p=[...d];for(;d.length>0;){const m=d.pop(),y=u.get(m);for(const w of y.children.filter(o))--h[w.name]===0&&(p.push(w.name),d.push(w.name))}const f=p.map(m=>u.get(m)),g=ble(f,l);return xle(g,l),g}function ble(n,e){const t=new Map(n.map(o=>[o.name,o])),s=e.map(o=>o.name),r=new Set(s);for(;s.length>0;){const o=s.pop(),a=t.get(o);for(const l of a.children)!t.has(l.name)||r.has(l.name)||(r.add(l.name),s.push(l.name))}return n.filter(o=>r.has(o.name))}class Bg extends Error{constructor(e){super(`NodesExecutionOrderError: ${e}`)}}function xle(n,e){const t=new Map(n.map((a,l)=>[a.name,l])),s=new Set(e.map(a=>a.name)),r=a=>s.has(typeof a=="string"?a:a.name),i=new Set(n.map(a=>a.name)),o=a=>i.has(typeof a=="string"?a:a.name);for(const a of n){for(const l of a.children.filter(o)){if(!t.has(l.name))throw new Bg(`Child ${l.name} of node ${a.name} is unreachable.`);if(t.get(a.name)>t.get(l.name))throw new Bg(`Node ${a.name} is scheduled to run after its child ${l.name}.`)}if(!r(a))for(const l of a.inputs){if(!t.has(l.name))throw new Bg(`Input ${l.name} of node ${a.name} is unreachable.`);if(t.get(l.name)>t.get(a.name))throw new Bg(`Node ${a.name} is scheduled to run before its input ${l.name}.`)}}}function wle(n){const e=new Map(n.map((a,l)=>[a.name,l])),t=Number.MAX_SAFE_INTEGER,s=n.map((a,l)=>pl(a)?t:l),r=a=>{const l=s[e.get(a.name)];return l??-1},i=n.map((a,l)=>a.children.map(r).reduce((c,u)=>Math.max(c,u),s[l])),o=new Map;for(let a=0;a<n.length;++a){const l=i[a];if(l===t)continue;const c=n[a],u=n[l];o.has(u.name)||o.set(u.name,[]),o.get(u.name).push(c)}return o}const vle=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),Ile=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),Sle=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function pl(n){return vle.has(n.op)}function kle(n){return Ile.has(n.op)}function Tle(n){return Sle.has(n.op)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ib{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const t=Object.keys(e).map(s=>e[s].map(r=>r.id));this._weightIds=[].concat(...t),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{const t=e.signatureKey||e.name;return e.defaultOutput?`${t}:${e.defaultOutput}`:t})}get functions(){return Object.keys(this._functions).reduce((e,t)=>(e[t]=this._functions[t].signature,e),{})}constructor(e,t){this.graph=e,this.parent=t,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(s=>{this._functionExecutorMap[s]=new Ib(e.functions[s],this)})}getCompilationKey(e,t){const s=e.map(i=>i.name).sort(),r=t.map(i=>i.name).sort();return s.join(this.SEPARATOR)+"--"+r.join(this.SEPARATOR)}compile(e,t){const s=c2(e,t,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:i,syncInputs:o}=s;if(i!=null)throw new Error(`This execution contains the node '${i.name}', which has the dynamic op '${i.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(r.length>0){const c=t.map(h=>h.name),u=Object.keys(e);throw new Error(`Cannot compute the outputs [${c}] from the provided inputs [${u}]. Missing the following inputs: [${r}]`)}const a=yle(this.graph,s),l=wle(a);return{orderedNodes:a,nodeLiveUntilMap:l}}cloneAndKeepTensor(e){if(e==null)return null;const t=e.clone();return Pn(t),t}cloneTensorList(e){return e?e.map(s=>this.cloneAndKeepTensor(s)):null}cloneTensorMap(e){return Object.fromEntries(Object.entries(e).map(([t,s])=>[t,this.cloneTensorList(s)]))}execute(e,t){this.disposeIntermediateTensors(),e=this.mapInputs(e);const s=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);const r=s.map(d=>this.graph.nodes[tr(d)[0]]),i=t.map(d=>tr(d)[0]),o=new Set(i);let a=i.map(d=>this.graph.nodes[d]);a.length===0&&(a=this._outputs);const l=this.getCompilationKey(r,a);let c=this.compiledMap.get(l);c==null&&(c=this.compile(e,a),this.compiledMap.set(l,c));try{this.keepIntermediateTensors=X().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(d){this.keepIntermediateTensors=!1,console.warn(d.message)}const u={},h={};return Y(()=>{const d=new l2(this.weightMap,u,h,this.functionExecutorMap,this.parseNodeNameCache),p=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(e).forEach(y=>{const[w,v]=tr(y,d),I=[];I[v]=e[y],p[w]=I,this.keepIntermediateTensors&&(this.clonedTensorsMap[w]=this.cloneTensorList(I))});const f=this.getFrozenTensorIds(p),{orderedNodes:g,nodeLiveUntilMap:m}=c;for(const y of g){if(p[y.name])continue;const w=a2(y,p,d,this._resourceManager);if(wo(w))throw new Error(`The execution of the op '${y.op}' returned a promise. Please use model.executeAsync() instead.`);p[y.name]=w,this.keepIntermediateTensors&&(this.clonedTensorsMap[y.name]=this.cloneTensorList(w)),this.checkTensorForDisposalWithNodeLiveUntilInfo(y,p,d,f,o,m.get(y.name))}return this.parent==null&&d.dispose(f),t.map(y=>ts(y,p,d))})}getFrozenTensorIds(e){const t=[].concat.apply([],Object.keys(e).map(s=>e[s]).map(s=>s.map(r=>r.id)));return new Set(t)}checkTensorForDisposal(e,t,s,r,i,o,a){if(!(pl(t)||o.has(e))){for(const l of s[e])l!=null&&(a[l.id]=(a[l.id]||0)+t.children.length);for(const l of t.inputs){if(pl(l))continue;const c=n2(l.name,s,r);if(c!=null)for(const u of c){if(!u||u.kept||i.has(u.id))continue;const h=a[u.id];h===1?(u.dispose(),delete a[u.id]):h!=null&&a[u.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(e,t,s,r,i,o){function a(l){return pl(l)||i.has(l.name)}if(!(pl(e)||o==null))for(const l of o){if(a(l))continue;const c=n2(l.name,t,s);for(const u of c)!u||u.kept||r.has(u.id)||u.dispose()}}async executeAsync(e,t){return this._executeAsync(e,t)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(e=>{for(const t of e)t&&!t.isDisposed&&t.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(e,t,s=!1,r={},i={}){this.disposeIntermediateTensors(),s||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepIntermediateTensors=X().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(d){this.keepIntermediateTensors=!1,console.warn(d.message)}const o=new l2(this.weightMap,r,i,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));const a=await this.executeWithControlFlow(e,o,t,s),l=t.map(d=>ts(d,a,o)),c=l.map(d=>d.id),u=Object.keys(e).map(d=>e[d].id),h=new Set([...c,...u,...this.weightIds]);return Object.values(a).forEach(d=>{d.forEach(p=>{p&&!p.isDisposed&&!h.has(p.id)&&p.dispose()})}),this.parent==null&&o.dispose(h),l}async executeFunctionAsync(e,t,s){const r=e.reduce((i,o,a)=>(i[this.inputs[a].name]=o,i),{});return this._executeAsync(r,this.outputNodes,!0,t,s)}async executeWithControlFlow(e,t,s,r){const i=Object.keys(e),o=i.map(I=>this.graph.nodes[tr(I)[0]]),a=s.map(I=>tr(I)[0]),l=new Set(a);let c=a.map(I=>this.graph.nodes[I]);c.length===0&&(c=this._outputs);const{usedNodes:u,missingInputs:h,dynamicNode:d,syncInputs:p}=c2(e,c,this.weightMap,this._initNodes),f=[...o,...this.graph.weights,...this._initNodes||[]].map(I=>({node:I,contexts:t.currentContext})),g=Object.assign({},this.weightMap);Object.keys(e).forEach(I=>{const[_,N]=tr(I),T=[];T[N]=e[I],g[_]=T});const m={},y=this.getFrozenTensorIds(g),w={};for(;f.length>0;){const I=this.processStack(o,f,t,g,w,y,l,m,u);await Promise.all(I)}d==null&&!r&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const v=c.filter(I=>!pl(I)&&!ts(I.name,g,t)).map(I=>I.name);if(v.length>0){let I="";throw d!=null&&(I=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${p}]`),new Error(`Cannot compute the outputs [${v}] from the provided inputs [${i}]. Consider providing the following inputs: [${h}]. ${I}`)}return g}processStack(e,t,s,r,i,o,a,l,c){const u=[];for(;t.length>0;){const h=t.pop();s.currentContext=h.contexts;let d="";if(h.node.op==="Enter"&&R("isConstant",h.node,r,s)&&([d]=lo(h.node.name,s)),r[h.node.name]==null){const p=a2(h.node,r,s,this._resourceManager);d||([d]=lo(h.node.name,s));const f=s.currentContext;wo(p)?u.push(p.then(g=>(r[d]=g,this.keepIntermediateTensors&&(this.clonedTensorsMap[d]=this.cloneTensorList(g)),s.currentContext=f,this.checkTensorForDisposal(d,h.node,r,s,o,a,l),this.processChildNodes(h.node,t,s,r,i,c),g))):(r[d]=p,this.keepIntermediateTensors&&(this.clonedTensorsMap[d]=this.cloneTensorList(p)),this.checkTensorForDisposal(d,h.node,r,s,o,a,l),this.processChildNodes(h.node,t,s,r,i,c))}else this.processChildNodes(h.node,t,s,r,i,c)}return u}processChildNodes(e,t,s,r,i,o){e.children.forEach(a=>{const[l]=lo(a.name,s);i[l]||!o.has(a.name)||(a.op==="Merge"?a.inputNames.some(c=>!!ts(c,r,s))&&(i[l]=!0,t.push({contexts:s.currentContext,node:a})):a.inputNames.every(c=>!!ts(c,r,s))&&(i[l]=!0,t.push({contexts:s.currentContext,node:a})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(t=>t.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(t=>{const s=e[t],[r]=tr(t),i=this.graph.nodes[r];if(i.attrParams.shape&&i.attrParams.shape.value){const o=i.attrParams.shape.value,a=o.length===s.shape.length&&s.shape.every((l,c)=>o[c]===-1||o[c]===l);O(a,()=>`The shape of dict['${i.name}'] provided in model.execute(dict) must be [${o}], but was [${s.shape}]`)}i.attrParams.dtype&&i.attrParams.dtype.value&&O(s.dtype===i.attrParams.dtype.value,()=>`The dtype of dict['${i.name}'] provided in model.execute(dict) must be ${i.attrParams.dtype.value}, but was ${s.dtype}`)})}mapInputs(e){var t,s;const r={};for(const i in e){const o=(s=(t=this._signature)===null||t===void 0?void 0:t.inputs)===null||s===void 0?void 0:s[i];o!=null?r[o.name]=e[i]:r[i]=e[i]}return r}checkInputs(e){const t=Object.keys(e).filter(s=>{const[r]=tr(s);return this.graph.nodes[r]==null});if(t.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${t}] that are not part of graph`)}mapOutputs(e){return e.map(t=>{var s,r;const i=(r=(s=this._signature)===null||s===void 0?void 0:s.outputs)===null||r===void 0?void 0:r[t];return i!=null?i.name:t},{})}checkOutputs(e){e.forEach(t=>{const[s]=tr(t);if(!this.graph.nodes[s])throw new Error(`The output '${t}' is not found in the graph`)})}}class Cle{constructor(e={},t={}){this.hashTableNameToHandle=e,this.hashTableMap=t}addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ele="?tfjs-format=file",_le="model.json";class VE{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e,t={},s=FT){this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=s,t==null&&(this.loadOptions={}),this.resourceManager=new Cle}findIOHandler(){const e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{const t=this.io.getLoadHandlers(e,this.loadOptions);if(t.length===0)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error(`Found more than one (${t.length}) load handlers for URL '${[e]}'`);this.handler=t[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return wo(e)?e.then(t=>this.loadSync(t)):this.loadSync(e)}loadSync(e){this.artifacts=e;const t=this.artifacts.modelTopology;let s=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){const i=this.artifacts.userDefinedMetadata;i.signature!=null&&(s=i.signature),i.structuredOutputKeys!=null&&(this.structuredOutputKeys=i.structuredOutputKeys)}this.signature=s,this.version=`${t.versions.producer}.${t.versions.minConsumer}`;const r=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new Ib(s2.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){const i=s2.Instance.transformGraph(e.modelInitializer);this.initializer=new Ib(i),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,t){if(typeof e=="string"){const s=this.io.getSaveHandlers(e);if(s.length===0)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(s.length>1)throw new Error(`Found more than one (${s.length}) save handlers for URL '${e}'`);e=s[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){const t=e instanceof kt?[e]:e,s={};return t.forEach((r,i)=>s[this.structuredOutputKeys[i]]=r),s}return e}predict(e,t){const s=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(s)}async predictAsync(e,t){const s=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(s)}normalizeInputs(e){var t;if(!(e instanceof kt)&&!Array.isArray(e)){const i=(t=this.signature)===null||t===void 0?void 0:t.inputs;if(i!=null)for(const o in i){const a=i[o];a.resourceId!=null&&(e[o]=this.resourceIdToCapturedInput[a.resourceId])}return e}e=Array.isArray(e)?e:[e];const s=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+s!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-s} non-resource placeholders, while there are ${e.length} input tensors provided.`);let r=0;return this.inputNodes.reduce((i,o)=>{var a,l,c;const u=(c=(l=(a=this.signature)===null||a===void 0?void 0:a.inputs)===null||l===void 0?void 0:l[o])===null||c===void 0?void 0:c.resourceId;return u!=null?i[o]=this.resourceIdToCapturedInput[u]:i[o]=e[r++],i},{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){const t=this.initializerSignature.outputs,s=Object.keys(t);for(let r=0;r<s.length;r++){const i=s[r],o=t[i];this.resourceIdToCapturedInput[o.resourceId]=e[r]}}}execute(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const s=this.executor.execute(e,t);return s.length>1?s:s[0]}async executeAsync(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const s=await this.executor.executeAsync(e,t);return s.length>1?s:s[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((t,s)=>(t[s]=[e[s]],t),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&et(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}async function Nle(n,e={},t=FT){if(n==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");e==null&&(e={}),e.fromTFHub&&typeof n=="string"&&(n=Rle(n));const s=new VE(n,e,t);return await s.load(),s}function Ale(n){if(n==null)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");let e;if(n instanceof Array){const[s,r]=n;if(!s)throw new Error("modelJSON must be the first element of the array");if(!r||!(r instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in s))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in s))throw new Error("Model JSON is missing 'weightsManifest'");const i=fk(s.weightsManifest),o=dk(s,i,r);e=ub(o)}else if("load"in n)e=n;else if("modelTopology"in n&&"weightSpecs"in n&&"weightData"in n)e=ub(n);else throw new Error("Unknown model format");const t=new VE(e);return t.load(),t}function Rle(n){return n.endsWith("/")||(n=n+"/"),`${n}${_le}${Ele}`}/** @license See the LICENSE file. */const Uz="4.11.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function $le(n,e){return Sb(n,e)}function Sb(n,e,t=new Map,s=new Set){if(n==null)return null;if(typeof Blob=="function"&&n instanceof Blob)return n.slice();if(s.has(n))throw new Error("Circular references are not supported.");if(t.has(n))return t.get(n);const r=e(n);if(r.recurse&&r.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(r.recurse)if(Cu(n)){const i=Array.isArray(n)?[]:{};s.add(n);for(const o in n){const a=n[o],l=Sb(a,e,t,s);i[o]=l}return s.delete(n),n.__proto__&&(i.__proto__=n.__proto__),i}else throw new Error(`Can't recurse into non-iterable type: ${n}`);else return t.set(n,r.value),r.value}function Dle(n,e=Gz){return Wz(n,e)}function Wz(n,e,t=new Set){const s=n[0];if(t.has(s))throw new Error("Circular references are not supported.");const r=e(n);if(r.recurse&&r.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(r.recurse)if(Cu(s)){const i=Array.isArray(s)?[]:{};t.add(s);for(const o in s){const a=n.map(c=>c[o]),l=Wz(a,e,t);i[o]=l}return t.delete(s),i}else throw new Error(`Can't recurse into non-iterable type: ${s}`);else return r.value}function Gz(n){return n===null?null:Cu(n[0])?{value:null,recurse:!0}:{value:n,recurse:!1}}async function Hz(n,e){const t=new Map;Sb(n,e,t);for(const r of Array.from(t.keys())){const i=t.get(r);if(wo(i)){const o=await i;t.set(r,o)}}return Sb(n,e,t)}function Cu(n){let e=!1;if(X().get("IS_BROWSER"))e=n instanceof TextDecoder;else{const{StringDecoder:t}=require("string_decoder");e=n instanceof t}return n!=null&&!ArrayBuffer.isView(n)&&(Array.isArray(n)||typeof n=="object"&&!(n instanceof kt)&&!(n instanceof Promise)&&!e)}function Ple(n){return n==null||Ole(n)||Array.isArray(n)||typeof n=="object"&&n instanceof kt||Dn(n)}function Ole(n){return n===null||typeof n!="object"&&typeof n!="function"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function Fle(n){return $le(n,Lle)}function Lle(n){return n instanceof kt?{value:n.clone(),recurse:!1}:Cu(n)?{value:null,recurse:!0}:{value:n,recurse:!1}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class qz{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return this.length()===0}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(const t of e)this.push(t)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.wrap(this.begin+e),s=this.get(t);return this.set(t,this.pop()),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class A0 extends qz{constructor(){super(A0.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){const e=this.capacity*2,t=new Array(e),s=this.length();for(let r=0;r<s;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=s}}A0.INITIAL_CAPACITY=32;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function Kz(n){return new Vle(n)}function BE(n){return new Ble(n)}function Mle(n,e){return new Xz(n,e)}function zle(n,e=ua.FAIL){return new Yle(n,e)}class qn{async toArray(){const e=[];let t=await this.next();for(;!t.done;)e.push(t.value),t=await this.next();return e}async toArrayForTest(){const e=this.prefetch(100),t=[];let s=await e.next();for(;!s.done;)t.push(s.value),s=await e.next();return t}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let t=await this.next(),s=e(t.value);for(;!t.done&&s;)t=await this.next(),s=e(t.value)}handleErrors(e){return new Kle(this,e)}filter(e){return new Hle(this,e)}map(e){return new qle(this,e)}mapAsync(e){return new u2(this,e)}serialMapAsync(e){return new u2(this,e).serial()}flatmap(e){return new Xle(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile(t=>t===!0)}rowMajorBatch(e,t=!0){return new Gle(this,e,t)}columnMajorBatch(e,t=!0,s=Gz){return this.rowMajorBatch(e,t).map(i=>Dle(i,s))}concatenate(e,t){return new Xz(Kz([this,e]),t)}take(e){return e<0||e==null?this:new Wle(this,e)}skip(e){return e<0||e==null?this:new Ule(this,e)}prefetch(e){return new Yz(this,e)}shuffle(e,t){return new Qle(this,e,t)}serial(){return new jle(this)}}class Vle extends qn{constructor(e){super(),this.items=e,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const e=this.items[this.trav];return this.trav++,{value:Fle(e),done:!1}}}class Ble extends qn{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(e){throw e.message=`Error thrown while iterating through a dataset: ${e.message}`,e}}}class jle extends qn{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}}class Ule extends qn{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const e=await this.upstream.next();if(e.done)return e;et(e.value)}return this.upstream.next()}}class Wle extends qn{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class Gle extends qn{constructor(e,t,s=!0){super(),this.upstream=e,this.batchSize=t,this.enableSmallLastBatch=s,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){const e=[];for(;e.length<this.batchSize;){const t=await this.upstream.next();if(t.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(t.value)}return{value:e,done:!1}}}class Hle extends qn{constructor(e,t){super(),this.upstream=e,this.predicate=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){const e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;et(e.value)}}}class qle extends qn{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> Map`}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=Io(e.value),s=this.transform(e.value),r=Io(s);for(const i of t)Sw(i,r)||i.dispose();return{value:s,done:!1}}}class Kle extends qn{constructor(e,t){super(),this.upstream=e,this.handler=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(e){if(!this.handler(e))return{value:null,done:!0}}}}class u2 extends qn{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=Io(e.value),s=await this.transform(e.value),r=Io(s);for(const i of t)Sw(i,r)||i.dispose();return{value:s,done:!1}}}class jE extends qn{constructor(){super(),this.outputQueue=new A0,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.outputQueue.length()===0;)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class Xle extends jE{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){const e=await this.upstream.next();if(e.done)return!1;const t=Io(e.value),s=this.transform(e.value),r=Io(s);this.outputQueue.pushAll(s);for(const i of t)Sw(i,r)||i.dispose();return!0}}class Xz extends qn{constructor(e,t){super(),this.baseErrorHandler=t,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,this.iterator==null){const s=await this.moreIterators.next();if(s.done)return{value:null,done:!0};this.iterator=s.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const t=await this.iterator.next();return t.done?(this.iterator=null,this.readFromChain(e)):t}}var ua;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(ua||(ua={}));class Yle extends qn{constructor(e,t=ua.FAIL){super(),this.iterators=e,this.mismatchMode=t,this.count=0,this.currentPromise=null}summary(){return"{TODO: fill in upstream of zip summaries} -> Zip"}async nextState(e){await e;let t=0,s=0;function r(o){return o instanceof qn?{value:o.next().then(l=>(t++,l.done&&s++,l.value)),recurse:!1}:{value:null,recurse:!0}}const i=await Hz(this.iterators,r);if(t===s)return{value:null,done:!0};if(s>0)switch(this.mismatchMode){case ua.FAIL:throw new Error(`Zipped streams should have the same length. Mismatched at element ${this.count}.`);case ua.SHORTEST:return{value:null,done:!0};case ua.LONGEST:}return this.count++,{value:i,done:!1}}async next(){return this.currentPromise=this.nextState(this.currentPromise),this.currentPromise}}class Yz extends qn{constructor(e,t){super(),this.upstream=e,this.bufferSize=t,this.buffer=new qz(t)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){const e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}}class Qle extends Yz{constructor(e,t,s){super(e,t),this.upstream=e,this.windowSize=t,this.upstreamExhausted=!1,this.random=Bh.alea(s||Jn().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const e=this.chooseIndex(),t=await this.buffer.shuffleExcise(e);if(t.done)this.upstreamExhausted=!0;else return this.refill(),t}return{value:null,done:!0}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class Kh{constructor(){this.size=null}batch(e,t=!0){const s=this;O(e>0,()=>`batchSize needs to be positive, but it is
      ${e}`);let r;return this.size===1/0||this.size==null?r=this.size:t?r=Math.ceil(this.size/e):r=Math.floor(this.size/e),er(async()=>(await s.iterator()).columnMajorBatch(e,t,ece),r)}concatenate(e){const t=this;let s;return this.size===1/0||e.size===1/0?s=1/0:this.size!=null&&e.size!=null?s=this.size+e.size:s=null,er(async()=>(await t.iterator()).concatenate(await e.iterator()),s)}filter(e){const t=this;let s;return this.size===1/0?s=1/0:s=null,er(async()=>(await t.iterator()).filter(r=>Y(()=>e(r))),s)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){const t=this;return er(async()=>(await t.iterator()).map(s=>Y(()=>e(s))),this.size)}mapAsync(e){const t=this;return er(async()=>(await t.iterator()).mapAsync(e),this.size)}prefetch(e){if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const t=this;return er(async()=>(await t.iterator()).prefetch(e),this.size)}repeat(e){const t=this;let s;return this.size!=null&&e>0?s=this.size*e:e===0?s=0:this.size!=null&&(e===void 0||e<0)?s=1/0:s=null,er(async()=>{const r=BE(async()=>({value:await t.iterator(),done:!1}));return Mle(r.take(e))},s)}skip(e){const t=this;let s;return this.size!=null&&e>=0&&this.size>=e?s=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?s=0:s=null,er(async()=>(await t.iterator()).skip(e),s)}shuffle(e,t,s=!0){if(e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);const r=this,i=Bh.alea(t||Jn().toString());return er(async()=>{let o=i.int32();return s&&(o+=i.int32()),(await r.iterator()).shuffle(e,o.toString())},this.size)}take(e){const t=this;let s;return this.size!=null&&this.size>e?s=e:this.size!=null&&this.size<=e?s=this.size:s=null,er(async()=>(await t.iterator()).take(e),s)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}Kh.MAX_BUFFER_SIZE=1e4;function er(n,e=null){return new class extends Kh{constructor(){super(...arguments),this.size=e}async iterator(){return n()}}}function Zle(n){return er(async()=>Kz(n),n.length)}function Jle(n){if(!Cu(n))throw new Error("The argument to zip() must be an object or array.");let e;if(Array.isArray(n))for(let t=0;t<n.length;t++)e=e==null?n[t].size:Math.min(e,n[t].size);else if(n instanceof Object)for(const t in n)e=e==null?n[t].size:Math.min(e,n[t].size);return er(async()=>{const t=await Hz(n,s=>{if(s instanceof Kh)return{value:s.iterator(),recurse:!1};if(Cu(s))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")});return zle(t,ua.SHORTEST)},e)}function ece(n){if(n===null)return null;const e=n[0];return Ple(e)?{value:tce(n),recurse:!1}:{value:null,recurse:!0}}function tce(n){if(n.length===0)throw new Error("Can't make a batch of zero elements.");return n[0]instanceof kt?Es(n):ir(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class Qz extends Kh{constructor(e){super(),this.input=e}async iterator(){return(await this.input.iterator()).decodeUTF8().split(`
`).map(r=>(r.endsWith("\r")&&(r=r.slice(0,-1)),r))}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */const jg='"',Rd=Symbol("out"),h2=Symbol("field"),Ug=Symbol("quote"),Xv=Symbol("quoteafterquote"),d2=Symbol("quoteinquote");class Zz extends Kh{async columnNames(){return this.columnNamesValidated||await this.setColumnNames(),this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames}async setColumnNames(){const e=await this.maybeReadHeaderLine();if(!this.fullColumnNames&&!e)throw new Error("Column names must be provided if there is no header line.");this.fullColumnNames&&e&&O(e.length===this.fullColumnNames.length,()=>"The length of provided columnNames ("+this.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+e.length.toString()+")."),this.fullColumnNames||(this.fullColumnNames=e);const t=this.fullColumnNames.reduce((r,i)=>(r[i]=r[i]+1||1,r),{}),s=Object.keys(t).filter(r=>t[r]>1);if(O(s.length===0,()=>"Duplicate column names found: "+s.toString()),this.columnConfigs){for(const r of Object.keys(this.columnConfigs))if(this.fullColumnNames.indexOf(r)===-1)throw new Error('The key "'+r+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}this.columnNamesValidated=!0}async maybeReadHeaderLine(){if(this.hasHeader){const t=await(await this.base.iterator()).next();if(t.done)throw new Error("No data was found for CSV parsing.");const s=t.value;return this.parseRow(s,!1)}else return null}constructor(e,t){super(),this.input=e,this.hasHeader=!0,this.fullColumnNames=null,this.columnNamesValidated=!1,this.columnConfigs=null,this.configuredColumnsOnly=!1,this.delimiter=",",this.delimWhitespace=!1,this.base=new Qz(e),t||(t={}),this.hasHeader=t.hasHeader!==!1,this.fullColumnNames=t.columnNames,this.columnConfigs=t.columnConfigs,this.configuredColumnsOnly=t.configuredColumnsOnly,t.delimWhitespace?(O(t.delimiter==null,()=>"Delimiter should not be provided when delimWhitespace is true."),this.delimWhitespace=!0,this.delimiter=" "):this.delimiter=t.delimiter?t.delimiter:","}async iterator(){this.columnNamesValidated||await this.setColumnNames();let e=await this.base.iterator();return this.hasHeader&&(e=e.skip(1)),e.map(t=>this.makeDataElement(t))}makeDataElement(e){const t=this.parseRow(e),s={},r={};for(let i=0;i<this.fullColumnNames.length;i++){const o=this.fullColumnNames[i],a=this.columnConfigs?this.columnConfigs[o]:null;if(!(this.configuredColumnsOnly&&!a)){const l=t[i];let c=null;if(l==="")if(a&&a.default!==void 0)c=a.default;else{if(a&&(a.required||a.isLabel))throw new Error(`Required column ${o} is empty in this line: ${e}`);c=void 0}else{const u=Number(l);if(isNaN(u))a&&a.dtype==="bool"?c=this.getBoolean(l):c=l;else if(!a||!a.dtype)c=u;else switch(a.dtype){case"float32":c=u;break;case"int32":c=Math.floor(u);break;case"bool":c=this.getBoolean(l);break;default:c=u}}a&&a.isLabel?r[o]=c:s[o]=c}}return Object.keys(r).length===0?s:{xs:s,ys:r}}getBoolean(e){return e==="1"||e.toLowerCase()==="true"?1:0}parseRow(e,t=!0){const s=[];let r=0;const i=e.length;let o=Rd;for(let a=0;a<i;a++)switch(o){case Rd:switch(e.charAt(a)){case jg:r=a+1,o=Ug;break;case this.delimiter:if(r=a+1,this.delimiter===" "&&this.delimWhitespace)break;s.push(""),o=Rd;break;default:o=h2,r=a;break}break;case h2:switch(e.charAt(a)){case this.delimiter:s.push(e.substring(r,a)),o=Rd,r=a+1;break}break;case Ug:switch(e.charAt(a)){case jg:o=Xv;break}break;case Xv:switch(e.charAt(a)){case this.delimiter:s.push(e.substring(r,a-1)),o=Rd,r=a+1;break;case jg:o=Ug;break;default:o=d2;break}break;case d2:switch(e.charAt(a)){case jg:o=Ug;break}break}if(o===Xv?s.push(e.substring(r,i-1)):s.push(e.substring(r)),t&&s.length!==this.fullColumnNames.length)throw new Error(`Invalid row in csv file. Should have ${this.fullColumnNames.length} elements in a row, but got ${s}`);return s}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class UE extends qn{constructor(e){super(),this.microphoneConfig=e,this.isClosed=!1,this.fftSize=e.fftSize||1024;const t=Math.log2(this.fftSize);if(this.fftSize<0||t<4||t>14||!Number.isInteger(t))throw new Error(`Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got ${this.fftSize}`);if(this.numFrames=e.numFramesPerSpectrogram||43,this.sampleRateHz=e.sampleRateHz,this.columnTruncateLength=e.columnTruncateLength||this.fftSize,this.audioTrackConstraints=e.audioTrackConstraints,this.smoothingTimeConstant=e.smoothingTimeConstant||0,this.includeSpectrogram=e.includeSpectrogram!==!1,this.includeWaveform=e.includeWaveform===!0,!this.includeSpectrogram&&!this.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.")}summary(){return"microphone"}static async create(e={}){if(!X().get("IS_BROWSER"))throw new Error("microphone API is only supported in browser environment.");const t=new UE(e);return await t.start(),t}async start(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null?!0:this.audioTrackConstraints,video:!1})}catch(s){throw new Error(`Error thrown while initializing video stream: ${s.message}`)}if(!this.stream)throw new Error("Could not obtain audio from microphone.");const e=window.AudioContext||window.webkitAudioContext;if(this.audioContext=new e,!this.sampleRateHz)this.sampleRateHz=this.audioContext.sampleRate;else if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error(`Mismatch in sampling rate: Expected: ${this.sampleRateHz}; Actual: ${this.audioContext.sampleRate}`);const t=this.audioContext.createMediaStreamSource(this.stream);this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize*2,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,t.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize)}async next(){if(this.isClosed)return{value:null,done:!0};let e,t;const s=await this.getAudioData();if(this.includeSpectrogram){const r=this.flattenQueue(s.freqDataQueue);e=this.getTensorFromAudioDataArray(r,[this.numFrames,this.columnTruncateLength,1])}if(this.includeWaveform){const r=this.flattenQueue(s.timeDataQueue);t=this.getTensorFromAudioDataArray(r,[this.numFrames*this.fftSize,1])}return{value:{spectrogram:e,waveform:t},done:!1}}async capture(){return(await this.next()).value}async getAudioData(){const e=[],t=[];let s=0;return new Promise(r=>{const i=setInterval(()=>{this.includeSpectrogram&&(this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0&&r({freqDataQueue:e,timeDataQueue:t}),e.push(this.freqData.slice(0,this.columnTruncateLength))),this.includeWaveform&&(this.analyser.getFloatTimeDomainData(this.timeData),t.push(this.timeData.slice())),++s===this.numFrames&&(clearInterval(i),r({freqDataQueue:e,timeDataQueue:t}))},this.fftSize/this.sampleRateHz*1e3)})}stop(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}toArray(){throw new Error("Can not convert infinite audio stream to array.")}getSampleRate(){return this.sampleRateHz}flattenQueue(e){const t=e[0].length,s=new Float32Array(e.length*t);return e.forEach((r,i)=>s.set(r,i*t)),s}getTensorFromAudioDataArray(e,t){const s=new Float32Array(re(t));return s.set(e,s.length-e.length),ir(s,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class WE extends qn{constructor(e,t){if(super(),this.webcamVideoElement=e,this.webcamConfig=t,this.isClosed=!0,this.resize=!1,this.needToResize())if(this.resize=!0,this.cropSize=[this.webcamConfig.resizeHeight,this.webcamConfig.resizeWidth],this.cropBoxInd=ss([0],"int32"),this.webcamConfig.centerCrop){const s=this.webcamConfig.resizeWidth*1/this.webcamVideoElement.width,r=this.webcamConfig.resizeHeight*1/this.webcamVideoElement.height,i=(1-s)/2,o=(1-r)/2,a=i+s,l=r+o;this.cropBox=fa([o,i,l,a],[1,4])}else this.cropBox=fa([0,0,1,1],[1,4])}summary(){return"webcam"}static async create(e,t={}){if(!X().get("IS_BROWSER"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!e){if(e=document.createElement("video"),!t.resizeWidth||!t.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");e.width=t.resizeWidth,e.height=t.resizeHeight}const s=new WE(e,t);return await s.start(),s}async start(){this.webcamConfig.facingMode&&O(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",()=>`Invalid webcam facing mode: ${this.webcamConfig.facingMode}. Please provide 'user' or 'environment'`);try{this.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})}catch(e){throw e.message=`Error thrown while initializing video stream: ${e.message}`,e}if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(e){console.log(e),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,new Promise(e=>{this.webcamVideoElement.onloadedmetadata=()=>{e()}})}async next(){if(this.isClosed)return{value:null,done:!0};let e;try{e=FL(this.webcamVideoElement)}catch(t){throw new Error(`Error thrown converting video to pixels: ${JSON.stringify(t)}`)}if(this.resize)try{return{value:this.cropAndResizeFrame(e),done:!1}}catch(t){throw new Error(`Error thrown cropping the video: ${t.message}`)}finally{e.dispose()}else return{value:e,done:!1}}needToResize(){return!!(this.webcamConfig.resizeWidth&&this.webcamConfig.resizeHeight&&(this.webcamVideoElement.width!==this.webcamConfig.resizeWidth||this.webcamVideoElement.height!==this.webcamConfig.resizeHeight))}cropAndResizeFrame(e){return Y(()=>{const t=es(ve(e,"float32"),0);let s;s=Vr.cropAndResize(t,this.cropBox,this.cropBoxInd,this.cropSize,"bilinear");const r=s.shape;return G(s,r.slice(1))})}async capture(){return(await this.next()).value}stop(){this.stream.getTracks().forEach(t=>t.stop());try{this.webcamVideoElement.srcObject=null}catch(t){console.log(t),this.webcamVideoElement.src=null}this.isClosed=!0}toArray(){throw new Error("Can not convert infinite video stream to array.")}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class Jz{}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class e3 extends qn{split(e){return new nce(this,e)}}class nce extends e3{constructor(e,t){super(),this.upstream=e,this.impl=new sce(e,t)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class sce extends jE{constructor(e,t){super(),this.upstream=e,this.separator=t,this.carryover=""}summary(){return`${this.upstream.summary()} -> Split('${this.separator}')`}async pump(){const e=await this.upstream.next();if(e.done)return this.carryover===""?!1:(this.outputQueue.push(this.carryover),this.carryover="",!0);const t=e.value.split(this.separator);t[0]=this.carryover+t[0];for(const s of t.slice(0,-1))this.outputQueue.push(s);return this.carryover=t[t.length-1],!0}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class rce extends qn{decodeUTF8(){return new ice(this)}}class ice extends e3{constructor(e){super(),this.upstream=e,this.impl=new oce(e)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class oce extends jE{constructor(e){if(super(),this.upstream=e,X().get("IS_BROWSER"))this.decoder=new TextDecoder("utf-8");else{const{StringDecoder:t}=require("string_decoder");this.decoder=new t("utf8")}}summary(){return`${this.upstream.summary()} -> Utf8`}async pump(){const e=await this.upstream.next();let t;if(e.done)return!1;t=e.value;let s;return X().get("IS_BROWSER")?s=this.decoder.decode(t,{stream:!0}):s=this.decoder.write(Buffer.from(t.buffer)),this.outputQueue.push(s),!0}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class t3 extends rce{constructor(e,t={}){super(),this.file=e,this.options=t,O(e instanceof Uint8Array||(X().get("IS_BROWSER")?e instanceof File||e instanceof Blob:!1),()=>"FileChunkIterator only supports File, Blob and Uint8Array right now."),this.offset=t.offset||0,this.chunkSize=t.chunkSize||1024*1024}summary(){return`FileChunks ${this.file}`}async next(){return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?{value:null,done:!0}:{value:await new Promise((t,s)=>{const r=this.offset+this.chunkSize;if(this.file instanceof Uint8Array)t(new Uint8Array(this.file.slice(this.offset,r)));else{const i=new FileReader;i.onload=a=>{let l=i.result;if(l instanceof ArrayBuffer&&(l=new Uint8Array(l)),!(l instanceof Uint8Array))return s(new TypeError("FileReader returned unknown type."));t(l)},i.onabort=a=>s(new Error("Aborted")),i.onerror=a=>s(new Error(a.type));const o=this.file.slice(this.offset,r);i.readAsArrayBuffer(o)}this.offset=r}),done:!1}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */async function ace(n,e={},t){let s,r;typeof n=="string"?s=n:(s=n.url,r=lce(n));const i=await(t||tF)(s,r);if(i.ok){const o=new Uint8Array(await i.arrayBuffer());return new t3(o,e)}else throw new Error(i.statusText)}const lce=n=>({method:n.method,headers:n.headers,body:n.body,mode:n.mode,credentials:n.credentials,cache:n.cache,redirect:n.redirect,referrer:n.referrer,integrity:n.integrity});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function n3(n){return typeof n=="string"&&n.slice(0,7)==="file://"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class s3 extends Jz{constructor(e,t={}){super(),this.input=e,this.options=t}async iterator(){if(n3(this.input)&&X().get("IS_NODE")){const e=require("fs");this.input=e.readFileSync(this.input.slice(7))}return new t3(this.input,this.options)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class r3 extends Jz{constructor(e,t={}){super(),this.url=e,this.fileOptions=t}async iterator(){return n3(this.url)?new s3(this.url,this.fileOptions).iterator():ace(this.url,this.fileOptions)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function cce(n,e={}){return new Zz(new r3(n),e)}function uce(n){const e=BE(n);return er(async()=>e)}function hce(n){return er(async()=>{const e=await n();return BE(()=>e.next())})}async function dce(n,e){return WE.create(n,e)}async function pce(n){return UE.create(n)}/** @license See the LICENSE file. */const i3="4.11.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fce=Object.freeze(Object.defineProperty({__proto__:null,CSVDataset:Zz,Dataset:Kh,FileDataSource:s3,TextLineDataset:Qz,URLDataSource:r3,array:Zle,csv:cce,func:uce,generator:hce,microphone:pce,version_data:i3,webcam:dce,zip:Jle},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oe(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&O(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mce=Xw;class tg extends px{nextDataId(){return tg.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new ZS(this,Jr())}write(e,t,s){this.firstUse&&(this.firstUse=!1,X().get("IS_NODE")&&yr(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&Pi(s[0])){const i=s.map(o=>Li(o));r=this.write(i,e,t)}else r=this.write(s,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,s,r,i){this.data.set(e,{values:t,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:s}=this.data.get(e);if(t==="complex64"){const r=this.readSync(s.real.dataId),i=this.readSync(s.imag.dataId);return Co(r,i)}return zO(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>vo(r));return ct(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ct(e.shape,e.dtype,t)}makeOutput(e,t,s){return Jr().makeTensorFromTensorInfo(this.makeTensorInfo(t,s,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=Jn();return e(),{kernelMs:Jn()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Oe([e],"where");const t=this.readSync(e.dataId);return mce(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}tg.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o3(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const gce=n=>{const{x:e}=n.inputs,t=n.backend;Oe(e,"abs");let s=new Float32Array(re(e.shape));const r=t.data.get(e.dataId).values;return s=o3(r),t.makeOutput(s,e.shape,e.dtype)},yce={kernelName:xf,backendName:"cpu",kernelFunc:gce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sn(n){return(e,t,s,r,i)=>{const o=tt(e,t),a=o.length,l=Be(o),c=re(o),u=Hn(i,c),h=e.length,d=t.length,p=Be(e),f=Be(t),g=Wl(e,o),m=Wl(t,o);if(g.length+m.length===0)for(let y=0;y<u.length;++y)u[y]=n(s[y%s.length],r[y%r.length]);else for(let y=0;y<u.length;++y){const w=uc(y,a,l),v=w.slice(-h);g.forEach(T=>v[T]=0);const I=ii(v,h,p),_=w.slice(-d);m.forEach(T=>_[T]=0);const N=ii(_,d,f);u[y]=n(s[I],r[N])}return[u,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sr(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,a=t.makeTensorInfo(s.shape,"complex64"),l=t.data.get(a.dataId);return l.complexTensorInfos={real:t.makeTensorInfo(s.shape,"float32",i),imag:t.makeTensorInfo(r.shape,"float32",o)},a}const bce={kernelName:Ix,backendName:"cpu",kernelFunc:sr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kb(n,e,t="float32"){if(t==="complex64"){const r=kb(n,e,"float32"),i=kb(n,e,"float32");return sr({inputs:{real:r,imag:i},backend:n})}const s=is(re(e),t);return n.makeTensorInfo(e,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qi(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const xce={kernelName:oh,backendName:"cpu",kernelFunc:Qi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ql(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.real,i=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,i)}const wce={kernelName:tw,backendName:"cpu",kernelFunc:Ql};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a3(n,e,t,s){if(s==="int32"){const r=Int32Array.from(n);return[e,"int32",r]}if(s==="bool"){const r=za([0],t),[i,o]=Sn((a,l)=>a!==l?1:0)(e,[],n,r,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${t} to ${s}`)}function Ra(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return Qi({inputs:{x:r},backend:t});const u=kb(t,r.shape,r.dtype),h=Ra({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),d=sr({inputs:{real:h,imag:u},backend:t});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(h),d}if(r.dtype==="complex64"){const u=Ql({inputs:{input:r},backend:t}),h=Ra({inputs:{x:u},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(u),h}if(!tk(r.dtype,i)){const u=Qi({inputs:{x:r},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:i}}const o=t.data.get(r.dataId).values,[a,l,c]=a3(o,r.shape,r.dtype,i);return t.makeTensorInfo(a,l,c)}const vce={kernelName:qu,backendName:"cpu",kernelFunc:Ra};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zn(n,e,t,s){return t==null?({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;Oe([o,a],n);const c=l.data.get(o.dataId).values,u=l.data.get(a.dataId).values,h=o.dtype==="string"?Eo(c):c,d=o.dtype==="string"?Eo(u):u,p=s||o.dtype,[f,g]=e(o.shape,a.shape,h,d,p);return l.makeTensorInfo(g,p,f)}:({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;if(o.dtype==="complex64"||a.dtype==="complex64"){const c=Ra({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),u=l.data.get(c.dataId),h=u.complexTensorInfos.real,d=u.complexTensorInfos.imag,p=l.data.get(h.dataId).values,f=l.data.get(d.dataId).values,g=Ra({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),m=l.data.get(g.dataId),y=m.complexTensorInfos.real,w=m.complexTensorInfos.imag,v=l.data.get(y.dataId).values,I=l.data.get(w.dataId).values,[_,N,T]=t(o.shape,a.shape,p,f,v,I),E=l.makeTensorInfo(T,"float32",_),k=l.makeTensorInfo(T,"float32",N),S=sr({inputs:{real:E,imag:k},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(g),l.disposeIntermediateTensorInfo(E),l.disposeIntermediateTensorInfo(k),S}else{const c=l.data.get(o.dataId).values,u=l.data.get(a.dataId).values,h=s||o.dtype,[d,p]=e(o.shape,a.shape,c,u,h);return l.makeTensorInfo(p,h,d)}}}function GE(n){return(e,t,s,r,i,o)=>{const a=tt(e,t),l=re(a),c=a.length,u=Be(a),h=Hn("float32",l),d=Hn("float32",l),p=Wl(e,a),f=Wl(t,a),g=Co(s,r),m=Co(i,o),y=e.length,w=Be(e),v=t.length,I=Be(t);if(p.length+f.length===0)for(let _=0;_<h.length;_++){const N=_%g.length,T=_%m.length,E=n(g[N*2],g[N*2+1],m[T*2],m[T*2+1]);h[_]=E.real,d[_]=E.imag}else for(let _=0;_<h.length;_++){const N=uc(_,c,u),T=N.slice(-y);p.forEach(P=>T[P]=0);const E=ii(T,y,w),k=N.slice(-v);f.forEach(P=>k[P]=0);const S=ii(k,v,I),A=n(g[E*2],g[E*2+1],m[S*2],m[S*2+1]);h[_]=A.real,d[_]=A.imag}return[h,d,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l3=Sn((n,e)=>n+e),Ice=GE((n,e,t,s)=>({real:n+t,imag:e+s})),Eu=zn(hc,l3,Ice),Sce={kernelName:hc,backendName:"cpu",kernelFunc:Eu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HE(n,e,t,s,r){const i=re(s),o=is(r,t);for(let a=0;a<n.length;a++){const l=n[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(i>0?o[l]+=e[a]:o[l]+=1)}return o}function c3(n,e,t,s=!1){const r=n.shape[0],i=n.shape[1],o=ct([r,t],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<i;l++){const c=n.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(s?o.set(1,a,c):e.size>0?o.set(o.get(a,c)+e.get(a,l),a,c):o.set(o.get(a,c)+1,a,c))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u3=Sn((n,e)=>n&e),kce=zn(Ef,u3),Tce={kernelName:Ef,backendName:"cpu",kernelFunc:kce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function no(n){return(e,t,s)=>{const r=mn(t,e.length);for(let i=0;i<e.length;++i)r[i]=n(e[i],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bt(n,e,t){const s=no(e);return qa(n,s,t)}function qa(n,e,t){return({inputs:s,attrs:r,backend:i})=>{const{x:o}=s;Oe(o,n);const a=i,l=a.data.get(o.dataId).values;let c;if(o.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");c=Eo(l)}else c=l;const u=t||o.dtype,h=e(c,u,r);return a.makeTensorInfo(o.shape,u,h)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h3=no(n=>Math.ceil(n)),Cce=qa(Ku,h3),Ece={kernelName:Ku,backendName:"cpu",kernelFunc:Cce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d3(n,e,t,s){const r=mn(t,re(e));if(s&&t!=="string"){let i=0;n.forEach(o=>{const a=re(o.shape);r.set(o.vals,i),i+=a})}else{let i=0;n.forEach(o=>{const a=t==="string"?Eo(o.vals):o.vals;let l=0;for(let c=0;c<o.shape[0];++c){const u=c*e[1]+i;for(let h=0;h<o.shape[1];++h)r[u+h]=a[l++]}i+=o.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p3=Sn((n,e)=>n===e?1:0),f3=zn(Ff,p3,null,"bool"),_ce={kernelName:Ff,backendName:"cpu",kernelFunc:f3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m3=no(n=>Math.exp(n)),g3=qa(th,m3,"float32"),Nce={kernelName:th,backendName:"cpu",kernelFunc:g3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y3=no(n=>Math.expm1(n)),Ace=qa(nh,y3),Rce={kernelName:nh,backendName:"cpu",kernelFunc:Ace};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b3=no(n=>Math.floor(n)),$ce=qa(sh,b3),Dce={kernelName:sh,backendName:"cpu",kernelFunc:$ce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x3=Sn((n,e)=>Math.floor(n/e)),Pce=zn(rh,x3,null,"int32"),Oce={kernelName:rh,backendName:"cpu",kernelFunc:Pce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w3(n,e,t,s,r,i,o,a,l){const c=ct([s,i],t);for(let u=0;u<s;u++){const h=[];let d=0;for(let p=0;p<r;p++){const f=n[u*r+p];d+=f*o[p],h.push(f)}if(d<0||d>=l/i)throw new Error(`Invalid indices: ${h} does not index into ${a}`);for(let p=0;p<i;p++)c.values[u*i+p]=e.get(...e.indexToLoc(d*i+p))}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v3(n,e,t){const s=ct(t,n.dtype);for(let r=0;r<s.size;++r){const o=s.indexToLoc(r).slice(),a=o[0],l=o[2],c=e.locToIndex([a,l]);o[2]=e.values[c];const u=n.locToIndex(o);0<=u&&u<n.values.length&&(s.values[r]=n.values[u])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I3=Sn((n,e)=>n>e?1:0),Fce=zn(Vf,I3,null,"bool"),Lce={kernelName:Vf,backendName:"cpu",kernelFunc:Fce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S3=Sn((n,e)=>n>=e?1:0),Mce=zn(ih,S3,null,"bool"),zce={kernelName:ih,backendName:"cpu",kernelFunc:Mce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k3=Sn((n,e)=>n<e?1:0),Vce=zn(jf,k3,null,"bool"),Bce={kernelName:jf,backendName:"cpu",kernelFunc:Vce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T3=Sn((n,e)=>n<=e?1:0),jce=zn(Uf,T3,null,"bool"),Uce={kernelName:Uf,backendName:"cpu",kernelFunc:jce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C3(n,e,t){const s=(e-n)/(t-1),r=is(t,"float32");r[0]=n;for(let i=1;i<r.length;i++)r[i]=r[i-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E3=no(n=>Math.log(n)),Wce=qa(uh,E3),Gce={kernelName:uh,backendName:"cpu",kernelFunc:Wce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _3(n,e,t,s){const r=Hn(s,re(t));for(let i=0;i<r.length;++i){const o=i*e;let a=n[o];for(let l=0;l<e;++l){const c=n[o+l];(Number.isNaN(c)||c>a)&&(a=c)}r[i]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N3=Sn((n,e)=>Math.max(n,e)),Hce=zn(dh,N3),qce={kernelName:dh,backendName:"cpu",kernelFunc:Hce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A3=Sn((n,e)=>Math.min(n,e)),Kce=zn(ph,A3),Xce={kernelName:ph,backendName:"cpu",kernelFunc:Kce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qE=Sn((n,e)=>n*e),Yce=GE((n,e,t,s)=>({real:n*t-e*s,imag:n*s+e*t})),R0=zn(mh,qE,Yce),Qce={kernelName:mh,backendName:"cpu",kernelFunc:R0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R3(n,e,t){const s=Po(-1,t);return qE([],e,s,n,t)}function Zce(n){const{inputs:e,backend:t}=n,{x:s}=e;Oe(s,"neg");const r=t.data.get(s.dataId).values,[i,o]=R3(r,s.shape,s.dtype);return t.makeTensorInfo(o,s.dtype,i)}const Jce={kernelName:em,backendName:"cpu",kernelFunc:Zce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $3=Sn((n,e)=>n!==e?1:0),eue=zn(tm,$3,null,"bool"),tue={kernelName:tm,backendName:"cpu",kernelFunc:eue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KE(n,e,t,s,r){const i=e.length,o=re(e),a=Be(e),l=Be(r),c=Hn(t,re(r));for(let u=0;u<o;++u){const h=uc(u,i,a),d=new Array(h.length);for(let f=0;f<d.length;f++)d[f]=h[s[f]];const p=ii(d,i,l);c[p]=n[u]}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xs(n){const{inputs:e,attrs:t,backend:s}=n,{x:r}=e,{perm:i}=t;Oe(r,"transpose");const o=r.shape.length,a=new Array(o);for(let h=0;h<a.length;h++)a[h]=r.shape[i[h]];const l=s.data.get(r.dataId).values,c=KE(l,r.shape,r.dtype,i,a);return{dataId:s.write(c,a,r.dtype),shape:a,dtype:r.dtype}}const nue={kernelName:Al,backendName:"cpu",kernelFunc:Xs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D3(n,e,t,s){const[r,i]=Xn(n,s),o=Ws(e,"int32"),a=is(re(r),o),l=re(i);for(let c=0;c<a.length;++c){const u=c*l;let h=1;for(let d=0;d<l;++d)h*=t[u+d];a[c]=h}return{outVals:a,outShape:r,outDtype:o}}function sue(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;Oe(r,"prod");const a=r.shape.length,l=ft(i,r.shape),c=pn(l,a);let u=l,h=r;const d=[];c!=null&&(h=Xs({inputs:{x:r},backend:t,attrs:{perm:c}}),d.push(h),u=vn(u.length,a));const p=t.data.get(h.dataId).values,{outVals:f,outShape:g,outDtype:m}=D3(h.shape,h.dtype,p,u);let y=g;return o&&(y=wn(g,l)),d.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.makeTensorInfo(y,m,f)}const rue={kernelName:am,backendName:"cpu",kernelFunc:sue};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iue(n,e,t){n.forEach((s,r)=>{if(s<0||s>=t){const i=uc(r,e.length,Be(e)).join(",");throw new Error(`indices[${i}] = ${s} is not in [0, ${t})`)}})}function oue(n,e){for(let t=0;t<n.length;++t){const s=n[t],r=t===n.length-1?e:n[t+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let i=1;i<s.length;++i)if(s[i-1]>s[i])throw new Error("Ragged splits must be sorted in ascending order")}}function aue(n,e,t,s){const r=[];let i=0;const o=e.length-1+t.length,a=new Array(o).fill(null).map(()=>[0]);oue(t,s);let l=1;for(let c=0;c<e.length-1;++c){l*=e[c];const u=e[c+1];for(let h=1;h<l+1;++h)a[c].push(h*u)}for(let c=0;c<n.length;++c){let u=n[c],h=n[c]+1;for(let d=0;d<t.length;++d){const p=t[d],f=d+e.length-1;if(f>=0){const g=a[f],m=g[g.length-1]-p[u];for(let y=u;y<h;++y)a[f].push(p[y+1]+m)}u=p[u],h=p[h]}h!==u&&(r.push([u,h]),i+=h-u)}return{outSplits:a,valueSlices:r,numValues:i}}function lue(n){const e=[];for(let t=0;t<n.length;++t){const s=n[t].length,r=mn("int32",s);e.push(r),n[t].forEach((i,o)=>r[o]=i)}return e}function p2(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let s=e;s<n.length;s++)t[e-1]*=n[s];return t}function cue(n,e,t,s,r,i){const o=p2(e,2)[1],a=p2(i,2)[1];let l=0;for(const c of t)for(let u=c[0];u<c[1];++u){for(let h=0;h<s;++h)r[l*a+h]=n[u*o+h];++l}}function uue(n,e,t,s,r){const i=e.slice();i[0]=r;const o=mn(t,re(i)),a=n.length,l=a===0?0:a/e[0];return cue(n,e,s,l,o,i),[o,i]}function P3(n,e,t,s,r,i,o,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(iue(i,o,l),s.length===0)throw new Error("params.rank must be nonzero");const c=s[0],{outSplits:u,valueSlices:h,numValues:d}=aue(i,o,n,c),p=lue(u),f=uue(t,s,r,h,d);return[p,f[0],f[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f2=2147483647;function O3(n,e,t,s,r,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,c=o.length===0,u=[];a||u.push(e[0]),l||u.push(r[0]),c||u.push(o[0]);for(let m=1;m<u.length;++m)if(u[m]!==u[m-1])throw new Error("starts, limits, and deltas must have the same shape");const h=u.length===0?1:u[0],d=mn("int32",h+1);d[0]=0;for(let m=0;m<h;++m){const y=a?n[0]:n[m],w=l?s[0]:s[m],v=c?i[0]:i[m];if(v===0)throw new Error("Requires delta != 0");let I;if(v>0&&w<y||v<0&&w>y)I=0;else if(I=Math.ceil(Math.abs((w-y)/v)),I>f2)throw new Error(`Requires ((limit - start) / delta) <= ${f2}`);d[m+1]=d[m]+I}const p=d[h],f=mn(t,p);let g=0;for(let m=0;m<h;++m){const y=d[m+1]-d[m];let w=a?n[0]:n[m];const v=c?i[0]:i[m];for(let I=0;I<y;++I)f[g++]=w,w+=v}return[d,f]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Ar=ti;class Tb{constructor(e,t,s,r,i,o,a,l,c,u){this.shape=e,this.shapeShape=t,this.values=s,this.valuesShape=r,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=XL(u),this.raggedRank=YL(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Ar.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Ar.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Ar.VALUE_ROWIDS:return Tb.getMaxWidthValueRowID(t);case Ar.ROW_SPLITS:return Tb.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${Ar[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let s=0;for(let r=0;r<t-1;++r){const i=e[r+1]-e[r];i>s&&(s=i)}return s}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let s=0,r=e[0],i=0;for(let o=1;o<t;++o){const a=e[o];a!==r&&(r=a,i=Math.max(o-s,i),s=o)}return Math.max(t-s,i)}tensorShapeFromTensor(e,t,s=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return g2(e,s)}calculateOutputSize(e){const t=this.valuesShape,s=this.defaultValueShape;QL(s,t);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=KL(this.raggedRank,r,t);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,t,s){const r=Math.min(e,s),i=[];let o=0;for(let a=0;a<r;++a,o+=t)i.push(o);for(let a=r;a<e;++a)i.push(-1);return O(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,t,s,r){const i=e.length,o=[];for(let a=0;a<i-1;++a){const l=e[a+1]-e[a];let c=Math.min(r,l),u=t[a];u===-1&&(c=0);for(let h=0;h<c;++h)o.push(u),u+=s;for(let h=0;h<l-c;++h)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,t,s,r){const i=e.length,o=[];if(i===0)return[];let a=0,l=e[0];if(l>=t.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${t.length}`);let c=t[l];o.push(c);for(let u=1;u<i;++u){const h=e[u];if(h===l)c>=0&&(++a,a<r?c+=s:c=-1);else{if(a=0,l=h,h>=t.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${t.length}`);c=t[h]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,t,s,r){const i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Ar.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,s,r);case Ar.ROW_SPLITS:if(i.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(i,t,s,r);default:throw new Error(`Unsupported partition type: ${Ar[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case Ar.FIRST_DIM_SIZE:return e[0];case Ar.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Ar.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Ar[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),s=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const i=g2(s,!1),o=mn(this.valuesDType,re(i));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(t,r[0],s[0]);for(let c=1;c<=this.raggedRank;++c)l=this.calculateOutputIndex(c-1,l,r[c],s[c]);this.setOutput(this.raggedRank,l,o,i)}return[i,o]}setOutput(e,t,s,r){if(s.length===0)return;const i=this.values,o=s;let a=r.slice();a=a.slice(e+1);const l=re(a),c=t.length;let u=this.defaultValue;if(u.length!==l&&u.length!==1){const f=this.defaultValueShape;Y(()=>{const g=G(u,f);u=Rl(g,a).dataSync()})}let h=0,d=0,p=0;for(let f=0;f<=c;++f){let g=f<c?t[f]:-1;if(g===p){++p;continue}if(d<p){const m=i.subarray(h*l),y=o.subarray(d*l),w=(p-d)*l;m2(y,m,w)}if(f>=c){const m=s.length;g=Math.floor(m/l)}if(g>p)if(this.defaultValue.length===1)o.subarray(p*l,g*l).fill(this.defaultValue[0]),p=g;else for(;g>p;){const m=o.slice(p*l);m2(m,u,l),++p}g<0?(h=f+1,d=p):(h=f,d=p,p=d+1)}}}function m2(n,e,t){for(let s=0;s<t;s++)n[s]=e[s]}function g2(n,e){const t=[];for(let s of n){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}t.push(s)}return t}function F3(n,e,t,s,r,i,o,a,l,c){return new Tb(n,e,t,s,r,i,o,a,l,c).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L3(n,e,t,s){const r=n===e,i=n<e&&t<0,o=e<n&&t>1;if(r||i||o)return is(0,s);const a=Math.abs(Math.ceil((e-n)/t)),l=is(a,s);e<n&&t===1&&(t=-1),l[0]=n;for(let c=1;c<l.length;c++)l[c]=l[c-1]+t;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M3=no(n=>1/Math.sqrt(n)),hue=qa(vh,M3),due={kernelName:vh,backendName:"cpu",kernelFunc:hue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sl(n,e,t,s,r,i,o,a,l,c){const u=[s/r,r],h=n.values,d=e.values;if(s===0)return ct(t,e.dtype);const p=l instanceof Nn?l:ct(u,e.dtype);typeof l=="string"||typeof l=="number"?p.values.fill(l):typeof l=="boolean"&&p.values.fill(+l);for(let f=0;f<i;f++){const g=[];let m=0;for(let y=0;y<o;y++){const w=h[f*o+y];g.push(w),m+=w*a[y]}if(m<0||m>=s/r)throw new Error(`Invalid indices: ${g} does not index into ${t}`);for(let y=0;y<r;y++)c?p.values[m*r+y]+=d[f*r+y]:p.values[m*r+y]=e.rank===0?d[0]:d[f*r+y]}return p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pue=no(n=>1/(1+Math.exp(-n))),z3=Bt(Ch,n=>1/(1+Math.exp(-n))),fue={kernelName:Ch,backendName:"cpu",kernelFunc:z3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V3(n,e,t,s,r){const i=zT(s,e,t),o=re(t),a=Be(s);if(i){const h=VT(e,a);return r==="string"?n.slice(h,h+o):n.subarray(h,h+o)}const l=r==="string"?Eo(n):n,c=ct(s,r,l),u=ct(t,r);for(let h=0;h<u.size;++h){const d=u.indexToLoc(h),p=d.map((f,g)=>f+e[g]);u.set(c.get(...p),...d)}return r==="string"?yM(u.values):u.values}function Zl(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,size:o}=s;Oe(r,"slice");const[a,l]=o0(r,i,o);LT(r,a,l);const c=t.data.get(r.dataId).values,u=V3(c,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,u)}const mue={kernelName:pm,backendName:"cpu",kernelFunc:Zl};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B3(n,e,t,s,r,i,o){const a=e[0],l=i[0],c=new Array(l),u=new Array(a),h=e[1];if(l===0){if(a!==0)throw new Error(rM(a));const m=mn(t,0),y=mn(r,0);return[m,[0,h],y,c,u]}let d=!0,p=0;const f=new Array(l).fill(0);for(let m=0;m<a;++m){const y=n[m*h];if(y<0)throw new Error(iM(m,y));if(y>=l)throw new Error(oM(m,y,l));++f[y],d=d&&y>=p,p=y}let g=!0;for(let m=0;m<l;++m){const y=f[m]===0;c[m]=y,g=g&&!y,f[m]=Math.max(f[m],1),m>0&&(f[m]+=f[m-1])}if(g&&d){const m=n,y=s;for(let w=0;w<a;++w)u[w]=w;return[m,[a,h],y,c,u]}else{const m=f[l-1],y=mn(t,m*h),w=mn(r,m),v=new Array(l).fill(0);for(let I=0;I<a;++I){const _=n[I*h],N=v[_],T=(_===0?0:f[_-1])+N;v[_]++;for(let E=0;E<h;++E)y[T*h+E]=n[I*h+E];w[T]=s[I],u[I]=T}for(let I=0;I<l;++I)if(v[I]===0){const N=I===0?0:f[I-1];y[N*h+0]=I;for(let T=1;T<h;++T)y[N*h+T]=0;w[N]=o}return[y,[m,h],w,c,u]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j3(n,e,t,s,r){const i=re(s),o=e[0],a=r.length,l=[];let c=1,u=-1;for(let m=0;m<a;++m){const y=r[m];if(y===-1){if(u!==-1)throw new Error(aM(u,m));u=m,l.push(1)}else{if(y<0)throw new Error(lM(m,y));c*=y,l.push(y)}}if(u!==-1){if(c<=0)throw new Error(cM());const m=Math.trunc(i/c);if(c*m!==i)throw new Error(uM(s,l));l[u]=m}if(re(l)!==i)throw new Error(hM(s,l));const d=s.length,p=[];if(d>0){p[d-1]=1;for(let m=d-2;m>=0;--m)p[m]=p[m+1]*s[m+1]}const f=[];if(a>0){f[a-1]=1;for(let m=a-2;m>=0;--m)f[m]=f[m+1]*l[m+1]}const g=mn(t,o*a);for(let m=0;m<o;++m){let y=0;for(let w=0;w<d;++w)y+=n[m*d+w]*p[w];for(let w=0;w<a;++w)g[m*a+w]=Math.trunc(y/f[w]),y%=f[w]}return[g,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XE(n,e,t,s,r,i=!1,o=0){const a=s.length,l=[e[0],n.length/e[0]],c=l[1],h=a>0?r[a-1]+1:0;if(h<0)throw new Error(II());const d=e.slice();d[0]=h;const p=d.reduce((v,I)=>v*I,1),f=mn(t,p);if(a===0)return h>0&&f.fill(o),[f,d];if(h<=0)throw new Error(II());let g=0,m=1,y=0,w=r[g];for(;;){let v=0;if(m<a){if(v=r[m],w===v){++m;continue}if(w>=v)throw new Error(dM())}if(w<0||w>=h)throw new Error(pM(w,h));w>y&&f.fill(o,y*c,w*c);for(let I=g;I<m;++I){const _=s[I];if(_<0||_>=l[0])throw new Error(fM(I,s[I],l[0]));for(let N=0;N<c;N++)f[w*c+N]+=n[_*c+N]}if(i)for(let I=0;I<c;I++)f[w*c+I]/=m-g;if(g=m,++m,y=w+1,w=v,m>a)break}return y<h&&f.fill(o,y*c,h*c),[f,d]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gue=no(n=>Math.sqrt(n)),yue=Bt(_h,n=>Math.sqrt(n)),bue={kernelName:_h,backendName:"cpu",kernelFunc:yue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U3=Sn((n,e)=>{const t=n-e;return t*t}),xue=zn(Nh,U3),wue={kernelName:Nh,backendName:"cpu",kernelFunc:xue};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W3=no((n,e)=>{const{pattern:t,replaceGlobal:s,rewrite:r}=e;return n.replace(new RegExp(t,s?"g":""),r)}),vue=qa(bm,W3),Iue={kernelName:bm,backendName:"cpu",kernelFunc:vue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G3(n,e,t,s){const r=ct(n,e.dtype);for(let i=0;i<r.size;i++){const o=r.indexToLoc(i),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*t[l]+s[l];r.set(e.get(...a),...o)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sue{constructor(e,t,s,r,i,o){this.separator=Li(e),this.nGramWidths=t,this.leftPad=Li(s),this.rightPad=Li(r),this.padWidth=i,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const s=this.getPadWidth(t);return Math.max(0,e+2*s-t+1)}createNGrams(e,t,s,r,i,o){for(let a=0;a<i;++a){const l=this.getPadWidth(o),c=Math.max(0,l-a),u=Math.max(0,l-(i-(a+1))),h=o-(c+u),d=t+(c>0?0:a-l);let p=0;p+=c*this.leftPad.length;for(let w=0;w<h;++w)p+=e[d+w].length;p+=u*this.rightPad.length;const f=c+u+h-1;p+=f*this.separator.length,s[r+a]=new Uint8Array(p);const g=s[r+a];let m=0;const y=w=>w.forEach(v=>g[m++]=v);for(let w=0;w<c;++w)y(this.leftPad),y(this.separator);for(let w=0;w<h-1;++w)y(e[d+w]),y(this.separator);if(h>0){y(e[d+h-1]);for(let w=0;w<u;++w)y(this.separator),y(this.rightPad)}else{for(let w=0;w<u-1;++w)y(this.rightPad),y(this.separator);y(this.rightPad)}}}compute(e,t){const s=e.length,r=t.length;if(r>0){let l=t[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let c=1;c<r;++c){let u=t[c]>=l;if(u=u&&t[c]<=s,!u)throw new Error(`Invalid split value ${t[c]}, must be in [${l}, ${s}]`);l=t[c]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const i=r-1,o=mn("int32",r);if(s===0||r===0){const l=new Array(s);for(let c=0;c<=i;++c)o[c]=0;return[l,o]}o[0]=0;for(let l=1;l<=i;++l){const c=t[l]-t[l-1];let u=0;this.nGramWidths.forEach(h=>{u+=this.getNumNGrams(c,h)}),this.preserveShort&&c>0&&u===0&&(u=1),o[l]=o[l-1]+u}const a=new Array(o[i]);for(let l=0;l<i;++l){const c=t[l];let u=o[l];if(this.nGramWidths.forEach(h=>{const d=t[l+1]-t[l],p=this.getNumNGrams(d,h);this.createNGrams(e,c,a,u,p,h),u+=p}),this.preserveShort&&u===o[l]){const h=t[l+1]-t[l];if(h===0)continue;const d=h+2*this.padWidth,p=1;this.createNGrams(e,c,a,u,p,d)}}return[a,o]}}function H3(n,e,t,s,r,i,o,a){return new Sue(t,s,r,i,o,a).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kue(n,e,t,s){if(!n.length)return;if(e.length===0){for(let i=0;i<n.length;++i)s.push(n.subarray(i,i+1));return}if(e.length===1){const i=e[0];let o=n.indexOf(i);for(;o!==-1;){const a=n.subarray(0,o);(!t||a.length!==0)&&s.push(a),n=n.subarray(o+1),o=n.indexOf(i)}(!t||n.length!==0)&&s.push(n);return}let r=0;for(let i=0;i<n.length+1;i++)if(i===n.length||e.indexOf(n[i])!==-1){const o=n.subarray(r,i);(!t||o.length!==0)&&s.push(o),r=i+1}}function q3(n,e,t){const s=n.length,r=[];let i=0,o=0;const a=new Array(s);for(let d=0;d<s;++d){const p=r.length;kue(n[d],e,t,r);const f=r.length-p;a[d]=f,i+=f,o=Math.max(o,f)}const l=mn("int32",i*2),c=new Array(i),u=[s,o];let h=0;for(let d=0;d<s;++d)for(let p=0;p<a[d];++p)l[h*2]=d,l[h*2+1]=p,c[h]=r[h],++h;return[l,c,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K3(n,e){const t=mn("int32",n.length);for(let s=0;s<n.length;++s)t[s]=eF(n[s]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X3=Sn((n,e)=>n-e),Tue=GE((n,e,t,s)=>({real:n-t,imag:e-s})),YE=zn(Ah,X3,Tue),Cue={kernelName:Ah,backendName:"cpu",kernelFunc:YE};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y3(n,e){const t=new Array(n.rank);for(let r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];const s=ct(t,n.dtype);for(let r=0;r<s.values.length;++r){const i=s.indexToLoc(r),o=new Array(n.rank);for(let l=0;l<o.length;l++)o[l]=i[l]%n.shape[l];const a=n.locToIndex(o);s.values[r]=n.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ud=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function Q3(n,e,t=0,s=n.length-1){for(;s>t;){if(s-t>600){const a=s-t+1,l=e-t+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*Math.sign(l-a/2),d=Math.max(t,Math.floor(e-l*u/a+h)),p=Math.min(s,Math.floor(e+(a-l)*u/a+h));Q3(n,e,d,p)}const r=n[e];let i=t,o=s;for(ho(n,t,e),Ud(n[s],r)>0&&ho(n,t,s);i<o;){for(ho(n,i,o),i++,o--;Ud(n[i],r)<0;)i=i+1;for(;Ud(n[o],r)>0;)o=o-1}Ud(n[t],r)===0?ho(n,t,o):(o=o+1,ho(n,o,s)),o<=e&&(t=o+1),e<=o&&(s=o-1)}}function Z3(n,e,t,s,r){const i=e[e.length-1],[o,a]=[n.length/i,i],l=Hn(t,o*s),c=Hn("int32",o*s);for(let h=0;h<o;h++){const d=h*a,p=n.subarray(d,d+a);let f=new Array(p.length);p.forEach((w,v)=>f[v]={value:w,index:v}),s<f.length&&(Q3(f,s),f=f.slice(0,s)),r&&f.sort(Ud);const g=h*s,m=l.subarray(g,g+s),y=c.subarray(g,g+s);for(let w=0;w<s;w++)m[w]=f[w].value,y[w]=f[w].index}const u=e.slice();return u[u.length-1]=s,[ct(u,t,l),ct(u,"int32",c)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J3(n,e,t,s){const r=ft(e,t)[0],i=[1,t[0],1];for(let f=0;f<r;f++)i[0]*=t[f];i[1]=t[r];for(let f=r+1;f<t.length;f++)i[2]*=t[f];const o=new Map,a=new Int32Array(t[r]),l=new Nn(i,s,n),c=[],u=i[0]===1&&i[2]===1;for(let f=0;f<t[r];f++){let g;if(u)g=n[f].toString();else{const y=[];for(let w=0;w<i[0];w++)for(let v=0;v<i[2];v++)y.push(l.get(w,f,v));g=y.join(",")}const m=o.get(g);if(m!=null)a[f]=m;else{const y=o.size;o.set(g,y),a[f]=y,c.push(f)}}const h=i.slice();h[1]=o.size;const d=new Nn(h,s);c.forEach((f,g)=>{for(let m=0;m<i[0];m++)for(let y=0;y<i[2];y++)d.set(l.get(m,f,y),m,g,y)});const p=t.slice();return p[r]=h[1],{outputValues:d.values,outputShape:p,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eV=Object.freeze(Object.defineProperty({__proto__:null,addImpl:l3,bincountImpl:HE,bincountReduceImpl:c3,bitwiseAndImpl:u3,castImpl:a3,ceilImpl:h3,concatImpl:d3,equalImpl:p3,expImpl:m3,expm1Impl:y3,floorDivImpl:x3,floorImpl:b3,gatherNdImpl:w3,gatherV2Impl:v3,greaterEqualImpl:S3,greaterImpl:I3,lessEqualImpl:T3,lessImpl:k3,linSpaceImpl:C3,logImpl:E3,maxImpl:_3,maximumImpl:N3,minimumImpl:A3,multiplyImpl:qE,negImpl:R3,notEqualImpl:$3,prodImpl:D3,raggedGatherImpl:P3,raggedRangeImpl:O3,raggedTensorToTensorImpl:F3,rangeImpl:L3,rsqrtImpl:M3,scatterImpl:Sl,sigmoidImpl:pue,simpleAbsImpl:o3,sliceImpl:V3,sparseFillEmptyRowsImpl:B3,sparseReshapeImpl:j3,sparseSegmentReductionImpl:XE,sqrtImpl:gue,squaredDifferenceImpl:U3,staticRegexReplaceImpl:W3,stridedSliceImpl:G3,stringNGramsImpl:H3,stringSplitImpl:q3,stringToHashBucketFastImpl:K3,subImpl:X3,tileImpl:Y3,topKImpl:Z3,transposeImpl:KE,uniqueImpl:J3},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. */const tV="4.11.0";/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */gk("cpu",()=>new tg,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nV=Bt(Ju,n=>n>=0?n:Math.exp(n)-1),Eue={kernelName:Ju,backendName:"cpu",kernelFunc:nV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sV(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:i}=s;Oe([r],"leakyRelu");const o=re(r.shape),a=t.data.get(r.dataId).values,l=Hn("float32",o);for(let c=0;c<a.length;c++)l[c]=a[c]<0?i*a[c]:a[c];return t.makeTensorInfo(r.shape,"float32",l)}const _ue={kernelName:Bf,backendName:"cpu",kernelFunc:sV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nue=Sn((n,e)=>n<0?e*n:n);function rV(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e;Oe([s,r],"prelu");const i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,[a,l]=Nue(s.shape,r.shape,i,o,"float32");return t.makeTensorInfo(l,"float32",a)}const Aue={kernelName:om,backendName:"cpu",kernelFunc:rV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iV=Bt(bh,n=>Math.max(0,n)),Rue={kernelName:bh,backendName:"cpu",kernelFunc:iV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oV=Bt(xh,n=>Math.min(Math.max(0,n),6)),$ue={kernelName:xh,backendName:"cpu",kernelFunc:oV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cb(n,e,t,s,r){if(t==="linear")return Qi({inputs:{x:e},backend:n});if(t==="relu")return iV({inputs:{x:e},backend:n});if(t==="elu")return nV({inputs:{x:e},backend:n});if(t==="relu6")return oV({inputs:{x:e},backend:n});if(t==="prelu")return rV({inputs:{x:e,alpha:s},backend:n});if(t==="leakyrelu")return sV({inputs:{x:e},backend:n,attrs:{alpha:r}});if(t==="sigmoid")return z3({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zt(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:i}=s,o=re(r.shape),a=ek(i,o),l=re(a);O(o===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${r.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),t.incRef(r.dataId);const c=t.data.get(r.dataId);if(c.complexTensorInfos!=null){const u=c.complexTensorInfos.real,h=c.complexTensorInfos.imag;u.shape=a,h.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const Due={kernelName:lm,backendName:"cpu",kernelFunc:Zt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aV(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;Oe([r,i],"matMul");const l=r.shape.length,c=i.shape.length,u=o?r.shape[l-2]:r.shape[l-1],h=a?i.shape[c-1]:i.shape[c-2],d=o?r.shape[l-1]:r.shape[l-2],p=a?i.shape[c-2]:i.shape[c-1],f=r.shape.slice(0,-2),g=i.shape.slice(0,-2),m=re(f),y=re(g),v=tt(r.shape.slice(0,-2),i.shape.slice(0,-2)).concat([d,p]);O(u===h,()=>`Error in matMul: inner shapes (${u}) and (${h}) of Tensors with shapes ${r.shape} and ${i.shape} and transposeA=${o} and transposeB=${a} must match.`);const I=o?[m,u,d]:[m,d,u],_=a?[y,p,h]:[y,h,p],N=Zt({inputs:{x:r},backend:t,attrs:{shape:I}}),T=Zt({inputs:{x:i},backend:t,attrs:{shape:_}}),E=o?N.shape[1]:N.shape[2],k=o?N.shape[2]:N.shape[1],S=a?T.shape[1]:T.shape[2],A=Math.max(m,y),P=t.data.get(N.dataId).values,D=t.data.get(T.dataId).values,V=Be(N.shape),U=Be(T.shape),[q,J,K]=o?[V[0],1,V[1]]:[V[0],V[1],1],[ee,L,ae]=a?[1,U[1],U[0]]:[U[1],1,U[0]],ce=k*S,z=ct([A,k,S],N.dtype),ue=z.values,de=t.blockSize;for(let be=0;be<A;be++){const Ee=be%m,Re=be%y;for(let _e=0;_e<k;_e+=de){const Ae=Math.min(_e+de,k);for(let je=0;je<S;je+=de){const qe=Math.min(je+de,S);for(let gt=0;gt<E;gt+=de){const Et=Math.min(gt+de,E);for(let ot=_e;ot<Ae;ot++)for(let xt=je;xt<qe;xt++){let Rt=0;for(let It=gt;It<Et;It++){const yn=P[Ee*q+ot*J+It*K],at=D[It*ee+xt*L+Re*ae];Rt+=yn*at}ue[be*ce+(ot*S+xt)]+=Rt}}}}}return t.disposeIntermediateTensorInfo(N),t.disposeIntermediateTensorInfo(T),t.makeTensorInfo(v,z.dtype,z.values)}const Pue={kernelName:Tf,backendName:"cpu",kernelFunc:aV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oue(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:h}=s;let d,p,f;const g=[];d=aV({inputs:{a:r,b:i},attrs:{transposeA:l,transposeB:c},backend:t}),o&&(p=Eu({inputs:{a:d,b:o},backend:t}),g.push(d),d=p),u&&(f=Cb(t,d,u,a,h),g.push(d),d=f);for(const y of g)t.disposeIntermediateTensorInfo(y);return d}const Fue={kernelName:Op,backendName:"cpu",kernelFunc:Oue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lue=Bt(Vu,n=>Math.acos(n)),Mue={kernelName:Vu,backendName:"cpu",kernelFunc:Lue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zue=Bt(Bu,n=>Math.acosh(n)),Vue={kernelName:Bu,backendName:"cpu",kernelFunc:zue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bue(n){const{inputs:e,backend:t}=n,s=e;Oe(e,"addN");const r=s.map(a=>t.data.get(a.dataId).values),i=ct(s[0].shape,s[0].dtype),o=i.values;for(let a=0;a<s.length;a++){const l=r[a];for(let c=0;c<o.length;c++)o[c]+=l[c]}return t.makeTensorInfo(i.shape,i.dtype,i.values)}const jue={kernelName:wf,backendName:"cpu",kernelFunc:Bue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uue(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;Oe(r,"all");const a=ft(i,r.shape);let l=a;const c=pn(l,r.shape.length);let u=r;c!=null&&(u=Xs({inputs:{x:r},backend:t,attrs:{perm:c}}),l=vn(l.length,r.shape.length)),cs("all",l,u.shape.length);const[h,d]=Xn(u.shape,l),p=re(d),f=is(re(h),u.dtype),g=t.data.get(u.dataId).values;for(let y=0;y<f.length;++y){const w=y*p;let v=g[w];for(let I=0;I<p;++I){const _=g[w+I];v=v&&_}f[y]=v}c!=null&&t.disposeIntermediateTensorInfo(u);const m=t.makeTensorInfo(h,u.dtype,f);if(o){const y=wn(h,a),w=Zt({inputs:{x:m},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(m),w}return m}const Wue={kernelName:gx,backendName:"cpu",kernelFunc:Uue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gue(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;Oe(r,"any");const a=ft(i,r.shape);let l=a;const c=pn(l,r.shape.length);let u=r;c!=null&&(u=Xs({inputs:{x:r},backend:t,attrs:{perm:c}}),l=vn(l.length,r.shape.length)),cs("any",l,u.shape.length);const[h,d]=Xn(u.shape,l),p=re(d),f=is(re(h),u.dtype),g=t.data.get(u.dataId).values;for(let y=0;y<f.length;++y){const w=y*p;let v=g[w];for(let I=0;I<p;++I){const _=g[w+I];v=v||_}f[y]=v}c!=null&&t.disposeIntermediateTensorInfo(u);const m=t.makeTensorInfo(h,u.dtype,f);if(o){const y=wn(h,a),w=Zt({inputs:{x:m},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(m),w}return m}const Hue={kernelName:yx,backendName:"cpu",kernelFunc:Gue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function que(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;Oe(r,"argMax");let o=ft(i,r.shape);const a=pn(o,r.shape.length);let l=r;const c=[];a!=null&&(l=Xs({inputs:{x:r},backend:t,attrs:{perm:a}}),c.push(l),o=vn(o.length,l.shape.length)),o=[o[0]],cs("argMax",o,l.shape.length);const[u,h]=Xn(l.shape,o),d=re(u),p=is(d,"int32"),f=re(h),g=t.data.get(l.dataId).values;for(let m=0;m<p.length;++m){const y=m*f;let w=g[y],v=0;for(let I=0;I<f;++I){const _=g[y+I];_>w&&(w=_,v=I)}p[m]=v}return c.forEach(m=>t.disposeIntermediateTensorInfo(m)),t.makeTensorInfo(u,"int32",p)}const Kue={kernelName:vf,backendName:"cpu",kernelFunc:que};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xue(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;Oe(r,"argMin");let o=ft(i,r.shape);const a=pn(o,r.shape.length);let l=r;const c=[];a!=null&&(l=Xs({inputs:{x:r},backend:t,attrs:{perm:a}}),c.push(l),o=vn(o.length,l.shape.length)),o=[o[0]],cs("argMin",o,l.shape.length);const[u,h]=Xn(l.shape,o),d=re(u),p=is(d,"int32"),f=re(h),g=t.data.get(l.dataId).values;for(let m=0;m<p.length;++m){const y=m*f;let w=g[y],v=0;for(let I=0;I<f;++I){const _=g[y+I];_<w&&(w=_,v=I)}p[m]=v}return c.forEach(m=>t.disposeIntermediateTensorInfo(m)),t.makeTensorInfo(u,"int32",p)}const Yue={kernelName:If,backendName:"cpu",kernelFunc:Xue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Que=Bt(ju,n=>Math.asin(n)),Zue={kernelName:ju,backendName:"cpu",kernelFunc:Que};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jue=Bt(Uu,n=>Math.asinh(n)),ehe={kernelName:Uu,backendName:"cpu",kernelFunc:Jue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const the=Bt(Wu,n=>Math.atan(n)),nhe={kernelName:Wu,backendName:"cpu",kernelFunc:the};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const she=Sn((n,e)=>Math.atan2(n,e)),rhe=zn(Hu,she),ihe={kernelName:Hu,backendName:"cpu",kernelFunc:rhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ohe=Bt(Gu,n=>Math.atanh(n)),ahe={kernelName:Gu,backendName:"cpu",kernelFunc:ohe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QE(n,e,t,s,r,i){const o=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,u=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,f=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=ct(r.outShape,t),m=g.values,y=r.outShape[1]*r.outShape[2]*r.outShape[3],w=r.outShape[2]*r.outShape[3],v=r.outShape[3];for(let I=0;I<r.batchSize;++I){const _=I*y,N=I*s[0];for(let T=0;T<r.inChannels;++T)for(let E=0;E<r.outHeight;++E){const k=E*o-d,S=Math.max(0,k),A=Math.min(r.inHeight,u+k),P=_+E*w;for(let D=0;D<r.outWidth;++D){const V=D*a-p,U=Math.max(0,V),q=Math.min(r.inWidth,h+V);let J=f,K=0,ee=0;for(let ae=S;ae<A;ae+=l){const ce=N+ae*s[1];for(let z=U;z<q;z+=c){const ue=ce+z*s[2],de=n[ue+T];i==="max"&&de>J?J=de:i==="avg"&&(K+=de,ee++)}if(isNaN(J))break}const L=P+D*v+T;m[L]=i==="avg"?K/ee:J}}}return g}function lV(n,e,t,s,r=!1,i=!1){const o=ct(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,c=s.dilationHeight,u=s.dilationWidth,h=s.effectiveFilterHeight,d=s.effectiveFilterWidth,p=s.padInfo.top,f=s.padInfo.left,g=ct(e,t,n);for(let m=0;m<s.batchSize;++m)for(let y=0;y<s.inChannels;++y)for(let w=0;w<s.outHeight;++w){const v=w*a-p;let I=v;for(;I<0;)I+=c;const _=Math.min(s.inHeight,h+v);for(let N=0;N<s.outWidth;++N){const T=N*l-f;let E=T;for(;E<0;)E+=u;const k=Math.min(s.inWidth,d+T);let S=Number.NEGATIVE_INFINITY,A=-1;for(let P=I;P<_;P+=c){const D=P-v;for(let V=E;V<k;V+=u){const U=V-T,q=g.get(m,P,V,y);q>S&&(S=q,r?A=i?((m*s.inHeight+P)*s.inWidth+V)*s.inChannels+y:(P*s.inWidth+V)*s.inChannels+y:A=D*d+U)}}o.set(A,m,w,N,y)}}return o}function cV(n,e,t,s,r,i){const o=r.strideDepth,a=r.strideHeight,l=r.strideWidth,c=r.dilationDepth,u=r.dilationHeight,h=r.dilationWidth,d=r.effectiveFilterDepth,p=r.effectiveFilterHeight,f=r.effectiveFilterWidth,g=r.padInfo.front,m=r.padInfo.top,y=r.padInfo.left,w=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=ct(r.outShape,t),I=v.values,_=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],N=r.outShape[2]*r.outShape[3]*r.outShape[4],T=r.outShape[3]*r.outShape[4],E=r.outShape[4];for(let k=0;k<r.batchSize;++k){const S=k*_,A=k*s[0];for(let P=0;P<r.inChannels;++P)for(let D=0;D<r.outDepth;++D){const V=D*o-g;let U=V;for(;U<0;)U+=c;const q=Math.min(r.inDepth,d+V),J=S+D*N;for(let K=0;K<r.outHeight;++K){const ee=K*a-m;let L=ee;for(;L<0;)L+=u;const ae=Math.min(r.inHeight,p+ee),ce=J+K*T;for(let z=0;z<r.outWidth;++z){const ue=z*l-y;let de=ue;for(;de<0;)de+=h;const be=Math.min(r.inWidth,f+ue),Ee=ce+z*E;let Re=w,_e=0,Ae=0;for(let qe=U;qe<q;qe+=c){const gt=A+qe*s[1];for(let Et=L;Et<ae;Et+=u){const ot=gt+Et*s[2];for(let xt=de;xt<be;xt+=h){const Rt=ot+xt*s[3],It=n[Rt+P];if(i==="max"&&It>Re?Re=It:i==="avg"&&(_e+=It,Ae++),isNaN(Re))break}if(isNaN(Re))break}if(isNaN(Re))break}const je=Ee+P;I[je]=i==="avg"?_e/Math.max(Ae,1):Re}}}}return v}function lhe(n,e){const t=ct(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,u=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.front,p=e.padInfo.top,f=e.padInfo.left;for(let g=0;g<e.batchSize;++g)for(let m=0;m<e.inChannels;++m)for(let y=0;y<e.outDepth;++y){const w=y*s-d;let v=w;for(;v<0;)v+=o;const I=Math.min(e.inDepth,c+w);for(let _=0;_<e.outHeight;++_){const N=_*r-p;let T=N;for(;T<0;)T+=a;const E=Math.min(e.inHeight,u+N);for(let k=0;k<e.outWidth;++k){const S=k*i-f;let A=S;for(;A<0;)A+=l;const P=Math.min(e.inWidth,h+S);let D=Number.NEGATIVE_INFINITY,V=-1;for(let U=v;U<I;U+=o){const q=U-w;for(let J=T;J<E;J+=a){const K=J-N;for(let ee=A;ee<P;ee+=l){const L=ee-S,ae=n.get(g,U,J,ee,m);ae>=D&&(D=ae,V=q*u*h+K*u+L)}}}t.set(V,g,y,_,k,m)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function che(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Oe(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,c=1;O(ls(o,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=Hr(r.shape,i,o,c,a,l);let h;if(u.filterWidth===1&&u.filterHeight===1&&wt(u.inShape,u.outShape))h=Qi({inputs:{x:r},backend:t});else{const d=t.data.get(r.dataId).values,p=Be(r.shape),f=QE(d,r.shape,r.dtype,p,u,"avg");h=t.makeTensorInfo(u.outShape,r.dtype,f.values)}return h}const uhe={kernelName:Sf,backendName:"cpu",kernelFunc:che};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hhe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=s;Oe(r,"avgPool3d");const u=Oo(r.shape,i,o,1,a,l,c),h=t.data.get(r.dataId).values,d=cV(h,r.shape,r.dtype,Be(r.shape),u,"avg");return t.makeTensorInfo(d.shape,"float32",d.values)}const dhe={kernelName:kf,backendName:"cpu",kernelFunc:hhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function phe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:c}=s;Oe([r,i],"avgPool3DGrad");const u=Oo(i.shape,o,a,1,l,c),h=u.strideDepth,d=u.strideHeight,p=u.strideWidth,f=u.filterDepth,g=u.filterHeight,m=u.filterWidth,y=u.dilationDepth,w=u.dilationHeight,v=u.dilationWidth,I=u.effectiveFilterDepth,_=u.effectiveFilterHeight,N=u.effectiveFilterWidth,T=I-1-u.padInfo.front,E=N-1-u.padInfo.left,k=_-1-u.padInfo.top,S=ct(i.shape,"float32"),A=1/(f*g*m),P=t.bufferSync(r);for(let D=0;D<u.batchSize;++D)for(let V=0;V<u.inChannels;++V)for(let U=0;U<u.inDepth;++U)for(let q=0;q<u.inHeight;++q)for(let J=0;J<u.inWidth;++J){const K=U-T,ee=q-k,L=J-E;let ae=0;for(let ce=0;ce<I;ce+=y){const z=(K+ce)/h;if(!(z<0||z>=u.outDepth||Math.floor(z)!==z))for(let ue=0;ue<_;ue+=w){const de=(ee+ue)/d;if(!(de<0||de>=u.outHeight||Math.floor(de)!==de))for(let be=0;be<N;be+=v){const Ee=(L+be)/p;if(Ee<0||Ee>=u.outWidth||Math.floor(Ee)!==Ee)continue;const Re=P.get(D,z,de,Ee,V);ae+=Re}}}S.set(ae*A,D,U,q,J,V)}return t.makeTensorInfo(S.shape,S.dtype,S.values)}const fhe={kernelName:xx,backendName:"cpu",kernelFunc:phe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mhe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i;Oe([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=s,u=Hr(o.shape,a,l,1,c),h=u.strideHeight,d=u.strideWidth,p=u.filterHeight,f=u.filterWidth,g=u.dilationHeight,m=u.dilationWidth,y=u.effectiveFilterHeight,w=u.effectiveFilterWidth,v=w-1-u.padInfo.left,I=y-1-u.padInfo.top,_=ct(o.shape,"float32"),N=1/(p*f),T=t.data.get(r.dataId).values,E=ct(r.shape,"float32",T);for(let k=0;k<u.batchSize;++k)for(let S=0;S<u.inChannels;++S)for(let A=0;A<u.inHeight;++A)for(let P=0;P<u.inWidth;++P){const D=A-I,V=P-v;let U=0;for(let q=0;q<y;q+=g){const J=(D+q)/h;if(!(J<0||J>=u.outHeight||Math.floor(J)!==J))for(let K=0;K<w;K+=m){const ee=(V+K)/d;if(ee<0||ee>=u.outWidth||Math.floor(ee)!==ee)continue;const L=E.get(k,J,ee,S);U+=L}}_.set(U*N,k,A,P,S)}return t.makeTensorInfo(_.shape,_.dtype,_.values)}const ghe={kernelName:bx,backendName:"cpu",kernelFunc:mhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yhe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,scale:i,offset:o,mean:a,variance:l}=e;O(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),O(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),O(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Oe([r,a,l,i,o],"batchNorm");let{varianceEpsilon:c}=s;c==null&&(c=.001);const u=t.data.get(r.dataId).values,h=t.data.get(a.dataId).values,d=t.data.get(l.dataId).values,p=i?t.data.get(i.dataId).values:new Float32Array([1]),f=o?t.data.get(o.dataId).values:new Float32Array([0]),g=new Float32Array(u.length),m=f.length,y=p.length,w=d.length,v=h.length;let I=0,_=0,N=0,T=0;for(let E=0;E<u.length;++E)g[E]=f[I++]+(u[E]-h[_++])*p[N++]/Math.sqrt(d[T++]+c),I>=m&&(I=0),_>=v&&(_=0),N>=y&&(N=0),T>=w&&(T=0);return t.makeTensorInfo(r.shape,r.dtype,g)}const bhe={kernelName:Mf,backendName:"cpu",kernelFunc:yhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xhe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,crops:o}=s;Oe([r],"batchToSpaceND");const a=i.reduce((y,w)=>y*w),l=jm(r.shape,i,a),c=Um(l.length,i.length),u=Wm(r.shape,i,a),h=HT(o,i.length),d=qT(u,o,i.length),p=Zt({inputs:{x:r},backend:t,attrs:{shape:l}}),f=Xs({inputs:{x:p},backend:t,attrs:{perm:c}}),g=Zt({inputs:{x:f},backend:t,attrs:{shape:u}}),m=Zl({inputs:{x:g},backend:t,attrs:{begin:h,size:d}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(g),m}const whe={kernelName:Cf,backendName:"cpu",kernelFunc:xhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vhe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o}=s,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,c=HE(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}const Ihe={kernelName:wx,backendName:"cpu",kernelFunc:vhe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function She(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,a=tt(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const khe={kernelName:vx,backendName:"cpu",kernelFunc:She};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const The=Bt(Xu,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),Che={kernelName:Xu,backendName:"cpu",kernelFunc:The};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ehe=n=>{const{x:e}=n.inputs,t=n.backend,s=new Float32Array(re(e.shape)),r=t.data.get(e.dataId),i=r.complexTensorInfos.real,o=r.complexTensorInfos.imag,a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values;for(let c=0;c<a.length;c++){const u=a[c],h=l[c];s[c]=Math.hypot(u,h)}return t.makeOutput(s,e.shape,"float32")},_he={kernelName:_f,backendName:"cpu",kernelFunc:Ehe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _u(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.imag,i=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,i)}const Nhe={kernelName:Bx,backendName:"cpu",kernelFunc:_u};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nu(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,i=ft(r,e[0].shape)[0],o=e.map(g=>g.shape);UT(o,i);let a=zi(e.map(g=>g.shape),i);if(re(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(g=>re(g.shape)>0);if(l.length===1)return Qi({inputs:{x:l[0]},backend:t});if(l[0].dtype==="complex64"){const g=l.map(I=>Ql({inputs:{input:I},backend:t})),m=l.map(I=>_u({inputs:{input:I},backend:t})),y=Nu({inputs:g,backend:t,attrs:{axis:i}}),w=Nu({inputs:m,backend:t,attrs:{axis:i}}),v=sr({inputs:{real:y,imag:w},backend:t});return g.forEach(I=>t.disposeIntermediateTensorInfo(I)),m.forEach(I=>t.disposeIntermediateTensorInfo(I)),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),v}const c=l.map(g=>{const y=[-1,re(g.shape.slice(i))];return Zt({inputs:{x:g},backend:t,attrs:{shape:y}})}),u=c.map(g=>({vals:t.data.get(g.dataId).values,shape:g.shape}));a=zi(c.map(g=>g.shape),1);const h=c[0].shape[0]===1,d=d3(u,a,e[0].dtype,h),p=zi(l.map(g=>g.shape),i),f=t.makeTensorInfo(p,e[0].dtype,d);return c.forEach(g=>t.disposeIntermediateTensorInfo(g)),f}const Ahe={kernelName:Nf,backendName:"cpu",kernelFunc:Nu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uV(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=s;Oe([r,i],"conv2d");const h=Fo(l),d=Kn(r.shape,i.shape,o,c,a,u,!1,h),p=d.filterHeight,f=d.filterWidth,g=d.dilationHeight,m=d.dilationWidth,y=d.padInfo.left,w=d.padInfo.top,v=d.dataFormat==="channelsLast",I=new Nn(d.outShape,r.dtype),_=Be(r.shape),N=Be(i.shape),T=_[0],E=v?_[1]:_[2],k=v?_[2]:1,S=v?1:_[1],A=I.strides[0],P=v?I.strides[1]:I.strides[2],D=v?I.strides[2]:1,V=v?1:I.strides[1],U=t.data.get(r.dataId).values,q=t.data.get(i.dataId).values,J=I.values;for(let K=0;K<d.batchSize;++K){const ee=K*T,L=K*A;for(let ae=0;ae<d.outHeight;++ae){const ce=L+ae*P,z=ae*d.strideHeight-w;for(let ue=0;ue<p;++ue){const de=z+ue*g;if(de<0||de>=d.inHeight)continue;const be=ue*N[0],Ee=ee+de*E;for(let Re=0;Re<d.outWidth;++Re){const _e=ce+Re*D,Ae=Re*d.strideWidth-y;for(let je=0;je<f;++je){const qe=Ae+je*m;if(qe<0||qe>=d.inWidth)continue;const gt=be+je*N[1],Et=Ee+qe*k;let ot=gt;for(let xt=0;xt<d.inChannels;++xt){const Rt=U[Et+xt*S];for(let It=0;It<d.outChannels;++It)J[_e+It*V]+=Rt*q[ot+It];ot+=d.outChannels}}}}}}return t.makeTensorInfo(I.shape,I.dtype,J)}const Rhe={kernelName:Af,backendName:"cpu",kernelFunc:uV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $he(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=s;Oe([r,i],"conv2dBackpropFilter");const h=Fo(l),d=Kn(r.shape,u,o,1,a,c,!1,h),{strideHeight:p,strideWidth:f,filterHeight:g,filterWidth:m}=d,y=d.dataFormat==="channelsLast",w=new Nn(d.filterShape,"float32"),v=d.padInfo.left,I=d.padInfo.top,_=t.data.get(r.dataId).values,N=t.data.get(i.dataId).values,T=new Nn(r.shape,r.dtype,_),E=new Nn(i.shape,i.dtype,N);for(let k=0;k<g;++k){const S=Math.max(0,Math.ceil((I-k)/p)),A=Math.min(d.outHeight,(d.inHeight+I-k)/p);for(let P=0;P<m;++P){const D=Math.max(0,Math.ceil((v-P)/f)),V=Math.min(d.outWidth,(d.inWidth+v-P)/f);for(let U=0;U<d.inChannels;++U)for(let q=0;q<d.outChannels;++q){let J=0;for(let K=0;K<d.batchSize;++K)for(let ee=S;ee<A;++ee){const L=k+ee*p-I;for(let ae=D;ae<V;++ae){const ce=P+ae*f-v;y?J+=T.get(K,L,ce,U)*E.get(K,ee,ae,q):J+=T.get(K,U,L,ce)*E.get(K,q,ee,ae)}}w.set(J,k,P,U,q)}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const Dhe={kernelName:Sx,backendName:"cpu",kernelFunc:$he};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Phe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=s;Oe([r,i],"conv2dBackpropInput");const h=Be(i.shape),d=Be(r.shape);let p=Fo(c);const f=Kn(o,i.shape,a,1,l,u,!1,p),g=new Nn(f.inShape,"float32"),m=g.values,y=t.data.get(r.dataId).values,w=t.data.get(i.dataId).values,[v,I,_]=h,{batchSize:N,filterHeight:T,filterWidth:E,inChannels:k,inHeight:S,inWidth:A,outChannels:P,outHeight:D,outWidth:V,strideHeight:U,strideWidth:q}=f;p=f.dataFormat;const J=T-1-f.padInfo.top,K=E-1-f.padInfo.left,ee=p==="channelsLast",L=g.strides[0],ae=ee?g.strides[1]:g.strides[2],ce=ee?g.strides[2]:1,z=ee?1:g.strides[1],ue=d[0],de=ee?d[1]:d[2],be=ee?d[2]:1,Ee=ee?1:d[1];for(let Re=0;Re<N;++Re)for(let _e=0;_e<k;++_e)for(let Ae=0;Ae<S;++Ae){const je=Ae-J,qe=Math.max(0,Math.ceil(je/U)),gt=Math.min(D,(T+je)/U);for(let Et=0;Et<A;++Et){const ot=Et-K,xt=Math.max(0,Math.ceil(ot/q)),Rt=Math.min(V,(E+ot)/q);let It=0;for(let at=qe;at<gt;++at){const zt=at*U-je;for(let ln=xt;ln<Rt;++ln){const Ps=ln*q-ot,qt=ue*Re+de*at+be*ln,Yn=v*(T-1-zt)+I*(E-1-Ps)+_*_e;for(let ie=0;ie<P;++ie){const fe=y[qt+Ee*ie],ze=w[Yn+ie];It+=fe*ze}}}const yn=L*Re+ae*Ae+ce*Et+z*_e;m[yn]=It}}return t.makeTensorInfo(g.shape,g.dtype,g.values)}const Ohe={kernelName:Rf,backendName:"cpu",kernelFunc:Phe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fhe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s;Oe([r,i],"conv3d");const c=Ba(r.shape,i.shape,o,l,a),{filterDepth:u,filterHeight:h,filterWidth:d,dilationDepth:p,dilationHeight:f,dilationWidth:g,padInfo:m}=c,y=m.front,w=m.left,v=m.top,I=new Nn(c.outShape,r.dtype),_=t.data.get(r.dataId).values,N=t.data.get(i.dataId).values,T=I.values,E=Be(r.shape),k=Be(i.shape);for(let S=0;S<c.batchSize;++S){const A=S*E[0],P=S*I.strides[0];for(let D=0;D<c.outDepth;++D){const V=P+D*I.strides[1],U=D*c.strideDepth-y;for(let q=0;q<u;++q){const J=U+q*p;if(J<0||J>=c.inDepth)continue;const K=q*k[0],ee=A+J*E[1];for(let L=0;L<c.outHeight;++L){const ae=V+L*I.strides[2],ce=L*c.strideHeight-v;for(let z=0;z<h;++z){const ue=ce+z*f;if(ue<0||ue>=c.inHeight)continue;const de=K+z*k[1],be=ee+ue*E[2];for(let Ee=0;Ee<c.outWidth;++Ee){const Re=ae+Ee*c.outChannels,_e=Ee*c.strideWidth-w;for(let Ae=0;Ae<d;++Ae){const je=_e+Ae*g;if(je<0||je>=c.inWidth)continue;const qe=de+Ae*k[2],gt=be+je*c.inChannels;let Et=qe;for(let ot=0;ot<c.inChannels;++ot){const xt=_[gt+ot];for(let Rt=0;Rt<c.outChannels;++Rt)T[Re+Rt]+=xt*N[Et+Rt];Et+=c.outChannels}}}}}}}}return t.makeTensorInfo(I.shape,I.dtype,I.values)}const Lhe={kernelName:$f,backendName:"cpu",kernelFunc:Fhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mhe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s;Oe([r,i],"conv3dBackpropFilterV2");const c=Be(r.shape),u=Be(i.shape),h=Ba(r.shape,l,o,1,a),d=h.strideDepth,p=h.strideHeight,f=h.strideWidth,g=h.filterDepth,m=h.filterHeight,y=h.filterWidth,w=new Nn(h.filterShape,"float32"),v=w.values,[I,_,N,T]=w.strides,E=t.data.get(i.dataId).values,[k,S,A,P]=u,D=t.data.get(r.dataId).values,[V,U,q,J]=c,K=h.padInfo.front,ee=h.padInfo.left,L=h.padInfo.top;for(let ae=0;ae<g;++ae){const ce=Math.max(0,Math.ceil((K-ae)/d)),z=Math.min(h.outDepth,(h.inDepth+K-ae)/d),ue=ae*I;for(let de=0;de<m;++de){const be=Math.max(0,Math.ceil((L-de)/p)),Ee=Math.min(h.outHeight,(h.inHeight+L-de)/p),Re=de*_+ue;for(let _e=0;_e<y;++_e){const Ae=Math.max(0,Math.ceil((ee-_e)/f)),je=Math.min(h.outWidth,(h.inWidth+ee-_e)/f),qe=_e*N+Re;for(let gt=0;gt<h.inChannels;++gt){const Et=gt*T+qe;for(let ot=0;ot<h.outChannels;++ot){let xt=0;for(let Rt=0;Rt<h.batchSize;++Rt){const It=Rt*V,yn=Rt*k;for(let at=ce;at<z;++at){const ln=(ae+at*d-K)*U+It,Ps=at*S+yn;for(let qt=be;qt<Ee;++qt){const ie=(de+qt*p-L)*q+ln,fe=qt*A+Ps;for(let ze=Ae;ze<je;++ze){const ne=(_e+ze*f-ee)*J+ie,Z=ze*P+fe;xt+=D[ne+gt]*E[Z+ot]}}}}v[Et+ot]=xt}}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const zhe={kernelName:kx,backendName:"cpu",kernelFunc:Mhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vhe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s;Oe([r],"conv3dBackpropInputV2");const c=Be(r.shape),u=Be(i.shape),h=Ba(l,i.shape,a,1,o),d=new Nn(h.inShape,"float32"),p=d.values,[f,g,m,y]=d.strides,w=t.data.get(r.dataId).values,[v,I,_,N]=c,T=t.data.get(i.dataId).values,[E,k,S,A]=u,{batchSize:P,filterDepth:D,filterHeight:V,filterWidth:U,inChannels:q,inDepth:J,inHeight:K,inWidth:ee,outChannels:L,outDepth:ae,outHeight:ce,outWidth:z,strideDepth:ue,strideHeight:de,strideWidth:be}=h,Ee=D-1-h.padInfo.front,Re=V-1-h.padInfo.top,_e=U-1-h.padInfo.left;for(let Ae=0;Ae<P;++Ae)for(let je=0;je<q;++je)for(let qe=0;qe<J;++qe){const gt=qe-Ee,Et=Math.max(0,Math.ceil(gt/ue)),ot=Math.min(ae,(D+gt)/ue);for(let xt=0;xt<K;++xt){const Rt=xt-Re,It=Math.max(0,Math.ceil(Rt/de)),yn=Math.min(ce,(V+Rt)/de);for(let at=0;at<ee;++at){const zt=at-_e,ln=Math.max(0,Math.ceil(zt/be)),Ps=Math.min(z,(U+zt)/be);let qt=0;for(let Yn=Et;Yn<ot;++Yn){const ie=Yn*ue-gt;for(let fe=It;fe<yn;++fe){const ze=fe*de-Rt;for(let Ke=ln;Ke<Ps;++Ke){const ne=Ke*be-zt,Z=v*Ae+I*Yn+_*fe+N*Ke,ye=E*(D-1-ie)+k*(V-1-ze)+S*(U-1-ne)+A*je;for(let Le=0;Le<L;++Le){const nt=w[Z+Le],Lt=T[ye+Le];qt+=nt*Lt}}}}p[f*Ae+g*qe+m*xt+y*at+je]=qt}}}return t.makeTensorInfo(d.shape,d.dtype,d.values)}const Bhe={kernelName:Tx,backendName:"cpu",kernelFunc:Vhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jhe=Bt(Yu,n=>Math.cos(n)),Uhe={kernelName:Yu,backendName:"cpu",kernelFunc:jhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Whe=Bt(Qu,n=>Math.cosh(n)),Ghe={kernelName:Qu,backendName:"cpu",kernelFunc:Whe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hhe(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=s,[u,h,d,p]=r.shape,f=i.shape[0],[g,m]=a,y=ct([f,g,m,p],"float32"),w=t.data.get(i.dataId).values,v=t.data.get(o.dataId).values,I=t.data.get(r.dataId).values,_=Be(r.shape),N=Be(y.shape);for(let T=0;T<f;T++){const E=T*4,k=w[E],S=w[E+1],A=w[E+2],P=w[E+3],D=v[T];if(D>=u)continue;const V=g>1?(A-k)*(h-1)/(g-1):0,U=m>1?(P-S)*(d-1)/(m-1):0;for(let q=0;q<g;q++){const J=g>1?k*(h-1)+q*V:.5*(k+A)*(h-1);if(J<0||J>h-1){for(let K=0;K<m;K++)for(let ee=0;ee<p;ee++){const L=ee+K*N[2]+q*N[1]+T*N[0];y.values[L]=c}continue}if(l==="bilinear"){const K=Math.floor(J),ee=Math.ceil(J),L=J-K;for(let ae=0;ae<m;ae++){const ce=m>1?S*(d-1)+ae*U:.5*(S+P)*(d-1);if(ce<0||ce>d-1){for(let be=0;be<p;be++){const Ee=be+ae*N[2]+q*N[1]+T*N[0];y.values[Ee]=c}continue}const z=Math.floor(ce),ue=Math.ceil(ce),de=ce-z;for(let be=0;be<p;be++){let Ee=be+z*_[2]+K*_[1]+D*_[0];const Re=I[Ee];Ee=be+ue*_[2]+K*_[1]+D*_[0];const _e=I[Ee];Ee=be+z*_[2]+ee*_[1]+D*_[0];const Ae=I[Ee];Ee=be+ue*_[2]+ee*_[1]+D*_[0];const je=I[Ee],qe=Re+(_e-Re)*de,gt=Ae+(je-Ae)*de;Ee=be+ae*N[2]+q*N[1]+T*N[0],y.values[Ee]=qe+(gt-qe)*L}}}else for(let K=0;K<m;++K){const ee=m>1?S*(d-1)+K*U:.5*(S+P)*(d-1);if(ee<0||ee>d-1){for(let ce=0;ce<p;ce++){const z=ce+K*N[2]+q*N[1]+T*N[0];y.values[z]=c}continue}const L=Math.round(ee),ae=Math.round(J);for(let ce=0;ce<p;ce++){const z=ce+L*_[2]+ae*_[1]+D*_[0],ue=ce+K*N[2]+q*N[1]+T*N[0];y.values[ue]=I[z]}}}}return t.makeTensorInfo(y.shape,y.dtype,y.values)}const qhe={kernelName:Ex,backendName:"cpu",kernelFunc:Hhe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Khe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;Oe(r,"cumprod");const l=pn([i],r.shape.length);let c=r;l!=null&&(c=Xs({inputs:{x:r},backend:t,attrs:{perm:l}}));const u=vn(1,r.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const h=Ws(c.dtype,"int32"),d=mx(re(c.shape),h),p=t.data.get(c.dataId).values,f=c.shape[c.shape.length-1],g=a?(y,w)=>y+f-w-1:(y,w)=>y+w;for(let y=0;y<p.length;y+=f)for(let w=0;w<f;w++){const v=g(y,w);if(w===0)d[v]=o?1:p[v];else{const I=g(y,w-1);d[v]=o?p[I]*d[I]:p[v]*d[I]}}const m=t.makeTensorInfo(c.shape,h,d);if(l!=null){const y=ja(l),w=Xs({inputs:{x:m},backend:t,attrs:{perm:y}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(c),w}return m}const Xhe={kernelName:Cx,backendName:"cpu",kernelFunc:Khe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yhe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;Oe(r,"cumsum");const l=pn([i],r.shape.length);let c=r;l!=null&&(c=Xs({inputs:{x:r},backend:t,attrs:{perm:l}}));const u=vn(1,r.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const h=Ws(c.dtype,"int32"),d=is(re(c.shape),h),p=t.data.get(c.dataId).values,f=c.shape[c.shape.length-1],g=a?(y,w)=>y+f-w-1:(y,w)=>y+w;for(let y=0;y<p.length;y+=f)for(let w=0;w<f;w++){const v=g(y,w);if(w===0)d[v]=o?0:p[v];else{const I=g(y,w-1);d[v]=o?p[I]+d[I]:p[v]+d[I]}}const m=t.makeTensorInfo(c.shape,h,d);if(l!=null){const y=ja(l),w=Xs({inputs:{x:m},backend:t,attrs:{perm:y}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(c),w}return m}const Qhe={kernelName:Df,backendName:"cpu",kernelFunc:Yhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zhe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=t.data.get(r.dataId).values,c=t.data.get(i.dataId).values,u=HE(l,c,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,u)}else if(r.shape.length===2){const l=t.bufferSync(r),c=t.bufferSync(i),u=c3(l,c,o,a);return t.makeTensorInfo(u.shape,i.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const Jhe={kernelName:_x,backendName:"cpu",kernelFunc:Zhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ede(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:i,dataFormat:o}=s;O(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=r.shape[0],l=r.shape[1],c=r.shape[2],u=r.shape[3],h=l*i,d=c*i,p=u/(i*i),f=t.data.get(r.dataId).values,g=new Float32Array(a*h*d*p);let m=0;for(let y=0;y<a;++y)for(let w=0;w<h;++w){const v=Math.floor(w/i),I=w%i;for(let _=0;_<d;++_){const N=Math.floor(_/i),T=_%i,E=(I*i+T)*p;for(let k=0;k<p;++k){const A=k+E+u*(N+c*(v+l*y));g[m++]=f[A]}}}return t.makeTensorInfo([a,h,d,p],r.dtype,g)}const tde={kernelName:Nx,backendName:"cpu",kernelFunc:ede};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hV(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:c}=s;Oe([r,i],"depthwiseConv2DNative");const u=Be(r.shape),h=Be(i.shape);let d=l;d==null&&(d=[1,1]),O(ls(o,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);const p=Kn(r.shape,i.shape,o,d,a,c,!0),{filterHeight:f,filterWidth:g,dilationHeight:m,dilationWidth:y,padInfo:w}=p,v=w.left,I=w.top,_=p.outChannels/p.inChannels,N=new Nn(p.outShape,r.dtype),T=t.data.get(r.dataId).values,E=t.data.get(i.dataId).values,k=N.values;for(let S=0;S<p.batchSize;++S){const A=S*u[0],P=S*N.strides[0];for(let D=0;D<p.outHeight;++D){const V=P+D*N.strides[1],U=D*p.strideHeight-I;for(let q=0;q<f;++q){const J=U+q*m;if(J<0||J>=p.inHeight)continue;const K=q*h[0],ee=A+J*u[1];for(let L=0;L<p.outWidth;++L){const ae=V+L*N.strides[2],ce=L*p.strideWidth-v;for(let z=0;z<g;++z){const ue=ce+z*y;if(ue<0||ue>=p.inWidth)continue;const de=K+z*h[1],be=ee+ue*p.inChannels;let Ee=ae,Re=de;for(let _e=0;_e<p.inChannels;++_e){const Ae=T[be+_e];for(let je=0;je<_;++je)k[Ee+je]+=Ae*E[Re+je];Ee+=_,Re+=_}}}}}}return t.makeTensorInfo(N.shape,N.dtype,N.values)}const nde={kernelName:Pf,backendName:"cpu",kernelFunc:hV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sde(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=s;Oe([r,i],"depthwiseConv2dNativeBackpropFilter");const h=Kn(r.shape,u,o,a,l,c,!0),{strideHeight:d,strideWidth:p,filterHeight:f,filterWidth:g}=h,m=new Nn(h.filterShape,"float32"),y=h.padInfo.left,w=h.padInfo.top,v=h.outChannels/h.inChannels,I=t.data.get(r.dataId).values,_=new Nn(r.shape,r.dtype,I),N=t.data.get(i.dataId).values,T=new Nn(i.shape,i.dtype,N);for(let E=0;E<f;++E){const k=Math.max(0,Math.ceil((w-E)/d)),S=Math.min(h.outHeight,(h.inHeight+w-E)/d);for(let A=0;A<g;++A){const P=Math.max(0,Math.ceil((y-A)/p)),D=Math.min(h.outWidth,(h.inWidth+y-A)/p);for(let V=0;V<h.outChannels;++V){const U=Math.trunc(V/v),q=V%v;let J=0;for(let K=0;K<h.batchSize;++K)for(let ee=k;ee<S;++ee){const L=E+ee*d-w;for(let ae=P;ae<D;++ae){const ce=A+ae*p-y;J+=_.get(K,L,ce,U)*T.get(K,ee,ae,V)}}m.set(J,E,A,U,q)}}}return t.makeTensorInfo(m.shape,m.dtype,m.values)}const rde={kernelName:Ax,backendName:"cpu",kernelFunc:sde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ide(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=s;Oe([r,i],"depthwiseConv2DNativeBackpropInput");const h=Be(r.shape),d=Be(i.shape),p=Kn(u,i.shape,o,a,l,c,!0),f=new Nn(p.inShape,"float32"),g=f.values,[m,y,w]=f.strides,v=t.data.get(r.dataId).values,[I,_,N]=h,T=t.data.get(i.dataId).values,[E,k,S]=d,{batchSize:A,filterHeight:P,filterWidth:D,inChannels:V,inHeight:U,inWidth:q,outChannels:J,outHeight:K,outWidth:ee,strideHeight:L,strideWidth:ae}=p,ce=P-1-p.padInfo.top,z=D-1-p.padInfo.left,ue=J/V;for(let de=0;de<A;++de)for(let be=0;be<V;++be)for(let Ee=0;Ee<U;++Ee){const Re=Ee-ce,_e=Math.max(0,Math.ceil(Re/L)),Ae=Math.min(K,(P+Re)/L);for(let je=0;je<q;++je){const qe=je-z,gt=Math.max(0,Math.ceil(qe/ae)),Et=Math.min(ee,(D+qe)/ae);let ot=0;for(let xt=_e;xt<Ae;++xt){const Rt=xt*L-Re;for(let It=gt;It<Et;++It){const yn=It*ae-qe,at=I*de+_*xt+N*It,zt=E*(P-1-Rt)+k*(D-1-yn)+S*be;for(let ln=0;ln<ue;++ln){const Ps=be*ue+ln,qt=v[at+Ps],Yn=T[zt+ln];ot+=qt*Yn}}}g[m*de+y*Ee+w*je+be]=ot}}return t.makeTensorInfo(f.shape,f.dtype,f.values)}const ode={kernelName:Rx,backendName:"cpu",kernelFunc:ide};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ade(n){const{inputs:e,backend:t}=n,{x:s}=e,r=re(s.shape),i=t.data.get(s.dataId).values,o=ct([r,r],s.dtype),a=o.values;for(let c=0;c<i.length;c++)a[c*r+c]=i[c];const l=[...s.shape,...s.shape];return t.makeTensorInfo(l,o.dtype,o.values)}const lde={kernelName:$x,backendName:"cpu",kernelFunc:ade};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cde={kernelName:Of,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r}=n,{strides:i,pad:o,dilations:a}=t,l=e,c=l.data.get(s.dataId).values,u=s.shape.length,h=l.data.get(r.dataId).values,d=r.shape.length,{batchSize:p,inHeight:f,inWidth:g,inChannels:m,outHeight:y,outWidth:w,padInfo:v,strideHeight:I,strideWidth:_,filterHeight:N,filterWidth:T,dilationHeight:E,dilationWidth:k,outShape:S}=km(s.shape,r.shape,i,o,"NHWC",a),A=re(S),P=S.length,D=mn(s.dtype,A);for(let U=0;U<p;++U)for(let q=0;q<y;++q){const J=q*I-v.top;for(let K=0;K<w;++K){const ee=K*_-v.left;for(let L=0;L<m;++L){let ae=Number.MIN_SAFE_INTEGER;for(let z=0;z<N;++z){const ue=J+z*E;if(ue>=0&&ue<f)for(let de=0;de<T;++de){const be=ee+de*k;if(be>=0&&be<g){const Ee=ii([U,ue,be,L],u,Be(s.shape)),Re=ii([z,de,L],d,Be(r.shape)),_e=c[Ee]+h[Re];_e>ae&&(ae=_e)}}}const ce=ii([U,q,K,L],P,Be(S));D[ce]=ae}}}return{dataId:l.write(za(D,s.dtype),S,s.dtype),shape:S,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ude={kernelName:sb,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:i}=n,{strides:o,pad:a,dilations:l}=t,c=e,u=Ir(s.shape,c.data.get(s.dataId).values),h=Ir(r.shape,c.data.get(r.dataId).values),{batchSize:d,inHeight:p,inWidth:f,inChannels:g,outHeight:m,outWidth:y,padInfo:w,strideHeight:v,strideWidth:I,filterHeight:_,filterWidth:N,dilationHeight:T,dilationWidth:E,outShape:k}=km(s.shape,r.shape,o,a,"NHWC",l);O(i.rank===k.length,()=>`Error in ${sb}, dy must have the same rank as output ${k.length}, but got ${i.rank}`);const S=Ir(k,c.data.get(i.dataId).values),A=nk(r.shape,r.dtype);for(let D=0;D<d;++D)for(let V=0;V<m;++V){const U=V*v-w.top;for(let q=0;q<y;++q){const J=q*I-w.left;for(let K=0;K<g;++K){let ee=Number.MIN_SAFE_INTEGER,L=0,ae=0;for(let ce=0;ce<_;++ce){const z=U+ce*T;if(z>=0&&z<p)for(let ue=0;ue<N;++ue){const de=J+ue*E;if(de>=0&&de<f){const be=u[D][z][de][K]+h[ce][ue][K];be>ee&&(ee=be,L=ce,ae=ue)}}}A[L][ae][K]+=S[D][V][q][K]}}}return{dataId:c.write(za(A,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hde={kernelName:nb,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:i}=n,{strides:o,pad:a,dilations:l}=t,c=e,u=Ir(s.shape,c.data.get(s.dataId).values),h=Ir(r.shape,c.data.get(r.dataId).values),{batchSize:d,inHeight:p,inWidth:f,inChannels:g,outHeight:m,outWidth:y,padInfo:w,strideHeight:v,strideWidth:I,filterHeight:_,filterWidth:N,dilationHeight:T,dilationWidth:E,outShape:k}=km(s.shape,r.shape,o,a,"NHWC",l);O(i.rank===k.length,()=>`Error in ${nb}, dy must have the same rank as output ${k.length}, but got ${i.rank}`);const S=Ir(k,c.data.get(i.dataId).values),A=nk(s.shape,s.dtype);for(let D=0;D<d;++D)for(let V=0;V<m;++V){const U=V*v-w.top;for(let q=0;q<y;++q){const J=q*I-w.left;for(let K=0;K<g;++K){let ee=Number.MIN_SAFE_INTEGER,L=U<0?0:U,ae=J<0?0:J;for(let ce=0;ce<_;++ce){const z=U+ce*T;if(z>=0&&z<p)for(let ue=0;ue<N;++ue){const de=J+ue*E;if(de>=0&&de<f){const be=u[D][z][de][K]+h[ce][ue][K];be>ee&&(ee=be,L=z,ae=de)}}}A[D][L][ae][K]+=S[D][V][q][K]}}}return{dataId:c.write(za(A,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dde(n){const{inputs:e,backend:t,attrs:s}=n,{image:r}=e,{canvas:i,options:o}=s,{contextOptions:a,imageOptions:l}=o||{},c=(l==null?void 0:l.alpha)||1,u=(a==null?void 0:a.contextType)||"2d";if(u!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const h=i.getContext(u,(a==null?void 0:a.contextAttributes)||{});if(h==null)throw new Error(`Could not get the context with ${u} type.`);const[d,p]=r.shape.slice(0,2),f=r.shape.length===2?1:r.shape[2],g=t.data.get(r.dataId).values,m=r.dtype==="float32"?255:1,y=new Uint8ClampedArray(p*d*4);for(let v=0;v<d*p;++v){const I=[0,0,0,255*c];for(let N=0;N<f;N++){const T=g[v*f+N];if(r.dtype==="float32"){if(T<0||T>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${T}.`)}else if(r.dtype==="int32"&&(T<0||T>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${T}.`);f===1?(I[0]=T*m,I[1]=T*m,I[2]=T*m):I[N]=T*m}const _=v*4;y[_+0]=Math.round(I[0]),y[_+1]=Math.round(I[1]),y[_+2]=Math.round(I[2]),y[_+3]=Math.round(I[3])}i.width=p,i.height=d;const w=new ImageData(y,p,d);return h.putImageData(w,0,0),r}const pde={kernelName:Dx,backendName:"cpu",kernelFunc:dde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ng(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;Oe(r,"sum");let a;r.dtype==="bool"?a=Ra({inputs:{x:r},backend:t,attrs:{dtype:"int32"}}):a=Qi({inputs:{x:r},backend:t});const l=a.shape.length,c=ft(i,a.shape),u=pn(c,l);let h=c,d=a;u!=null&&(d=Xs({inputs:{x:a},backend:t,attrs:{perm:u}}),h=vn(h.length,l)),cs("sum",h,d.shape.length);const[p,f]=Xn(d.shape,h),g=Ws(d.dtype,"int32");let m=kb(t,p,g);const y=re(f),w=t.data.get(m.dataId).values,v=t.data.get(d.dataId).values;for(let I=0;I<w.length;++I){const _=I*y;let N=0;for(let T=0;T<y;++T)N+=v[_+T];w[I]=N}if(o){const I=wn(m.shape,c),_=m;m=Zt({inputs:{x:m},backend:t,attrs:{shape:I}}),t.disposeIntermediateTensorInfo(_)}return t.disposeIntermediateTensorInfo(a),u!=null&&t.disposeIntermediateTensorInfo(d),m}const fde={kernelName:fm,backendName:"cpu",kernelFunc:ng};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mde(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=tC(r,i.length);sC(o.length,l,i);const{path:c,steps:u}=rC(a,l),h=u.length;let d=null,p=o.length;const f=[];for(let g=0;g<h;++g){for(const m of u[g]){const{permutationIndices:y,expandDims:w}=nC(p,l[m]);let v;iC(y)?v=i[m]:(v=Xs({inputs:{x:i[m]},backend:t,attrs:{perm:y}}),f.push(v));const I=v.shape.slice();for(let _=0;_<w.length;++_)I.splice(w[_],0,1);wt(v.shape,I)||(v=Zt({inputs:{x:v},backend:t,attrs:{shape:I}}),f.push(v)),d===null?d=v:(d=R0({inputs:{a:v,b:d},backend:t}),f.push(d))}g<h-1&&(c[g]>=0&&(d=ng({inputs:{x:d},backend:t,attrs:{axis:c[g]-(o.length-p),keepDims:!1}}),f.push(d)),p--)}for(const g of f)g!==d&&t.disposeIntermediateTensorInfo(g);return d}const gde={kernelName:Px,backendName:"cpu",kernelFunc:mde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yde(n){const{inputs:e,backend:t}=n,{dy:s,y:r}=e;Oe([s,r],"eluGrad");const i=new Float32Array(re(r.shape)),o=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values;for(let l=0;l<o.length;++l){const c=o[l];c>=0?i[l]=a[l]:i[l]=a[l]*(c+1)}return t.makeTensorInfo(r.shape,"float32",i)}const bde={kernelName:Ox,backendName:"cpu",kernelFunc:yde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xde=KT,wde=XT,vde=YT,Ide=QT,Sde=ZT,kde=JT,Tde=Bt(eh,n=>{const e=Math.sign(n),t=Math.abs(n),s=1/(1+xde*t);return e*(1-((((kde*s+Sde)*s+Ide)*s+vde)*s+wde)*s*Math.exp(-t*t))}),Cde={kernelName:eh,backendName:"cpu",kernelFunc:Tde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eb(n){const{inputs:e,backend:t,attrs:s}=n,{input:r}=e,{dim:i}=s,o=r.shape.length,a=r.shape.slice();let l=i;return i<0&&(O(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),a.splice(l,0,1),Zt({inputs:{x:r},backend:t,attrs:{shape:a}})}const Ede={kernelName:Lf,backendName:"cpu",kernelFunc:Eb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _de=Sn((n,e)=>n/e),ZE=zn(Zu,_de),GI={kernelName:Zu,backendName:"cpu",kernelFunc:ZE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dV(n,e,t){const s=n.shape,r=s[0],i=s[1],o=t.data.get(n.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,c=[r,i],u=re(c),h=Hn("float32",u),d=Hn("float32",u);for(let m=0;m<r;m++){const y=Zl({inputs:{x:a},backend:t,attrs:{begin:[m,0],size:[1,i]}}),w=Zl({inputs:{x:l},backend:t,attrs:{begin:[m,0],size:[1,i]}}),v=sr({inputs:{real:y,imag:w},backend:t}),{real:I,imag:_}=Nde(v,e,t),N=Co(I,_);for(let T=0;T<i;T++){const E=eC(N,T);h[m*i+T]=E.real,d[m*i+T]=E.imag}t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(v)}const p=t.makeTensorInfo(c,"float32",h),f=t.makeTensorInfo(c,"float32",d),g=sr({inputs:{real:p,imag:f},backend:t});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),g}function Nde(n,e,t){const s=re(n.shape),r=t.data.get(n.dataId),i=t.data.get(r.complexTensorInfos.real.dataId).values,o=t.data.get(r.complexTensorInfos.imag.dataId).values;if(Ade(s)){const a=HI(i,o,s,e,t),l=[n.shape[0],n.shape[1]];if(e){const c=t.makeTensorInfo(l,"float32",a.real),u=t.makeTensorInfo(l,"float32",a.imag),h=t.makeTensorInfo([],"float32",Po(s,"float32")),d=Qi({inputs:{x:h},backend:t}),p=GI.kernelFunc({inputs:{a:c,b:h},backend:t}),f=GI.kernelFunc({inputs:{a:u,b:d},backend:t}),g=t.data.get(p.dataId).values,m=t.data.get(f.dataId).values;return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),{real:g,imag:m}}return a}else{const a=Co(i,o),l=Rde(a,s,e);return ZL(l)}}function Ade(n){return(n&n-1)===0}function HI(n,e,t,s,r){if(t===1)return{real:n,imag:e};const i=Co(n,e),o=t/2,a=JL(i),l=a.real,c=a.imag,u=[l.length],h=r.makeTensorInfo(u,"float32",l),d=r.makeTensorInfo(u,"float32",c),p=sr({inputs:{real:h,imag:d},backend:r}),f=eM(i),g=f.real,m=f.imag,y=[g.length],w=r.makeTensorInfo(y,"float32",g),v=r.makeTensorInfo(y,"float32",m),I=sr({inputs:{real:w,imag:v},backend:r}),_=HI(l,c,o,s,r),N=_.real,T=_.imag,E=[N.length],k=r.makeTensorInfo(E,"float32",N),S=r.makeTensorInfo(E,"float32",T),A=sr({inputs:{real:k,imag:S},backend:r}),P=HI(g,m,o,s,r),D=P.real,V=P.imag,U=[D.length],q=r.makeTensorInfo(U,"float32",D),J=r.makeTensorInfo(U,"float32",V),K=sr({inputs:{real:q,imag:J},backend:r}),ee=nM(t,s),L=[ee.real.length],ae=r.makeTensorInfo(L,"float32",ee.real),ce=r.makeTensorInfo(L,"float32",ee.imag),z=sr({inputs:{real:ae,imag:ce},backend:r}),ue=R0({inputs:{a:z,b:K},backend:r}),de=Eu({inputs:{a:A,b:ue},backend:r}),be=YE({inputs:{a:A,b:ue},backend:r}),Ee=Ql({inputs:{input:de},backend:r}),Re=Ql({inputs:{input:be},backend:r}),_e=_u({inputs:{input:de},backend:r}),Ae=_u({inputs:{input:be},backend:r}),je=Nu({inputs:[Ee,Re],backend:r,attrs:{axis:0}}),qe=Nu({inputs:[_e,Ae],backend:r,attrs:{axis:0}}),gt=r.data.get(je.dataId).values,Et=r.data.get(qe.dataId).values;return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(w),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(I),r.disposeIntermediateTensorInfo(k),r.disposeIntermediateTensorInfo(S),r.disposeIntermediateTensorInfo(A),r.disposeIntermediateTensorInfo(q),r.disposeIntermediateTensorInfo(J),r.disposeIntermediateTensorInfo(K),r.disposeIntermediateTensorInfo(ae),r.disposeIntermediateTensorInfo(ce),r.disposeIntermediateTensorInfo(z),r.disposeIntermediateTensorInfo(ue),r.disposeIntermediateTensorInfo(de),r.disposeIntermediateTensorInfo(be),r.disposeIntermediateTensorInfo(Ee),r.disposeIntermediateTensorInfo(_e),r.disposeIntermediateTensorInfo(Re),r.disposeIntermediateTensorInfo(Ae),r.disposeIntermediateTensorInfo(je),r.disposeIntermediateTensorInfo(qe),{real:gt,imag:Et}}function Rde(n,e,t){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let i=0,o=0;for(let a=0;a<e;a++){const l=sM(r*a,e,t),c=eC(n,a);i+=c.real*l.real-c.imag*l.imag,o+=c.real*l.imag+c.imag*l.real}t&&(i/=e,o/=e),tM(s,i,o,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $de(n){const{inputs:e,backend:t}=n,{input:s}=e,r=re(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=Zt({inputs:{x:s},backend:t,attrs:{shape:[o,i]}}),l=dV(a,!1,t),c=Zt({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),c}const Dde={kernelName:Fx,backendName:"cpu",kernelFunc:$de};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JE(n){const{backend:e,attrs:t}=n,{shape:s,value:r,dtype:i}=t,o=i||cc(r),a=mn(o,re(s));return Ode(a,r,o),e.makeTensorInfo(s,o,a)}const Pde={kernelName:Lx,backendName:"cpu",kernelFunc:JE};function Ode(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fde={kernelName:Mx,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,r=t,i=Hn(s.dtype,re(s.shape)),[o,a,l,c]=s.shape,u=r.data.get(s.dataId).values;for(let d=0;d<o;d++){const p=d*l*a*c;for(let f=0;f<a;f++){const g=f*(l*c);for(let m=0;m<l;m++){const y=m*c;for(let w=0;w<c;w++){const v=Math.round(l-m-1),I=p+g+y+w;let _=u[I];if(v>=0&&v<l){const N=v*c,T=p+g+N+w;_=u[T]}i[I]=_}}}}return{dataId:r.write(i,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lde(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=s;let g=uV({inputs:{x:r,filter:i},backend:t,attrs:{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d}});if(o){const m=g;if(u==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const y=Zt({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});g=Eu({inputs:{a:g,b:y},backend:t}),t.disposeIntermediateTensorInfo(y)}else g=Eu({inputs:{a:g,b:o},backend:t});t.disposeIntermediateTensorInfo(m)}if(p){const m=g;if(u==="NCHW"&&p==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const y=Zt({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});g=Cb(t,g,p,y,f),t.disposeIntermediateTensorInfo(y)}else g=Cb(t,g,p,a,f);t.disposeIntermediateTensorInfo(m)}return g}const Mde={kernelName:Fp,backendName:"cpu",kernelFunc:Lde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zde(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=s;let g=hV({inputs:{x:r,filter:i},backend:t,attrs:{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d}});if(o){const m=g;g=Eu({inputs:{a:g,b:o},backend:t}),t.disposeIntermediateTensorInfo(m)}if(p){const m=g;g=Cb(t,g,p,a,f),t.disposeIntermediateTensorInfo(m)}return g}const Vde={kernelName:Lp,backendName:"cpu",kernelFunc:zde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bde(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,i=re(s.shape),o=r.shape,a=o[o.length-1],[l,c,u,h]=i0(s,r);if(c===0)return t.makeTensorInfo(l,s.dtype,[]);const d=t.data.get(r.dataId).values,p=t.bufferSync(s),f=w3(d,p,s.dtype,c,a,u,h,s.shape,i);return t.makeTensorInfo(l,s.dtype,f.values)}const jde={kernelName:zx,backendName:"cpu",kernelFunc:Bde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ude(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:i}=e,{axis:o,batchDims:a}=s;Oe([r,i],"gatherV2");const l=ft(o,r.shape)[0],c=t.data.get(i.dataId).values,u=r.shape[l];for(let I=0;I<c.length;++I){const _=c[I];O(_<=u-1&&_>=0,()=>`GatherV2: the index value ${_} is not in [0, ${u-1}]`)}let h=a;a==null&&(h=0);const d=re(i.shape),p=aC(r,i,l,h),f=Zt({inputs:{x:r},backend:t,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),g=Zt({inputs:{x:i},backend:t,attrs:{shape:[p.batchSize,d/p.batchSize]}}),m=[p.batchSize,p.outerSize,d/p.batchSize,p.sliceSize],y=t.bufferSync(g),w=t.bufferSync(f),v=v3(w,y,m);return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(g),t.makeTensorInfo(p.outputShape,v.dtype,v.values)}const Wde={kernelName:zf,backendName:"cpu",kernelFunc:Ude};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gde(n){const{inputs:e,backend:t}=n,{input:s}=e,r=re(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=Zt({inputs:{x:s},backend:t,attrs:{shape:[o,i]}}),l=dV(a,!0,t),c=Zt({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),c}const Hde={kernelName:Vx,backendName:"cpu",kernelFunc:Gde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qde=Bt(ah,n=>Number.isFinite(n)?1:0,"bool"),Kde={kernelName:ah,backendName:"cpu",kernelFunc:qde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xde=Bt(lh,n=>Math.abs(n)===1/0?1:0,"bool"),Yde={kernelName:lh,backendName:"cpu",kernelFunc:Xde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qde=Bt(ch,n=>Number.isNaN(n)?1:0,"bool"),Zde={kernelName:ch,backendName:"cpu",kernelFunc:Qde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jde(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:i}=t,o=C3(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const epe={kernelName:jx,backendName:"cpu",kernelFunc:Jde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tpe=Bt(hh,n=>Math.log1p(n)),npe={kernelName:hh,backendName:"cpu",kernelFunc:tpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const spe=Sn((n,e)=>n&&e),rpe=zn(Wf,spe,null,"bool"),ipe={kernelName:Wf,backendName:"cpu",kernelFunc:rpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ope=Bt(Gf,n=>n?0:1,"bool"),ape={kernelName:Gf,backendName:"cpu",kernelFunc:ope};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lpe=Sn((n,e)=>n||e),cpe=zn(Hf,lpe,null,"bool"),upe={kernelName:Hf,backendName:"cpu",kernelFunc:cpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hpe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s;Oe(r,"LRN");const c=r.shape[3],u=c-1,h=t.data.get(r.dataId).values,d=re(r.shape),p=new Float32Array(d);function f(g){const m=g%c;let y=g-m+Math.max(0,m-i);const w=g-m+Math.min(m+i,u);let v=0;for(;y<=w;y++){const I=h[y];v+=I*I}return v}for(let g=0;g<d;g++){const m=f(g),y=h[g]*Math.pow(o+a*m,-l);p[g]=y}return t.makeTensorInfo(r.shape,r.dtype,p)}const dpe={kernelName:qf,backendName:"cpu",kernelFunc:hpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ppe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=s;Oe(o,"LRNGrad");const h=re(o.shape),d=o.shape[3],p=t.data.get(o.dataId).values,f=t.data.get(r.dataId).values,g=t.data.get(i.dataId).values,m=new Float32Array(h),y=h;for(let w=0;w<y;w++){const v=w%d,I=w-v+Math.max(0,v-a),_=w-v+Math.min(d,v+a+1);let N=0;for(let T=I;T<_;T++)N+=Math.pow(f[T],2);N=c*N+l;for(let T=I;T<_;T++){let E=-2*c*u*f[T]*g[w]/N;w===T&&(E+=Math.pow(N,-u)),E*=p[w],m[T]+=E}}return t.makeTensorInfo(o.shape,r.dtype,m)}const fpe={kernelName:Ux,backendName:"cpu",kernelFunc:ppe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pV(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=t;let l=r.shape;const c=l.length,u=ft(i,l);let h=u;const d=pn(h,c);let p=a.data.get(r.dataId).values;if(d!=null){const I=new Array(c);for(let _=0;_<I.length;_++)I[_]=l[d[_]];p=KE(p,l,r.dtype,d,I),h=vn(h.length,c),l=I}Oe(r,"max"),cs("max",h,c);const[f,g]=Xn(l,h),m=re(g),y=_3(p,m,f,r.dtype),w=a.write(y,f,r.dtype);let v=f;return o&&(v=wn(f,u)),{dataId:w,shape:v,dtype:r.dtype}}const mpe={kernelName:Kf,backendName:"cpu",kernelFunc:pV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gpe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Oe(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,c=1;O(ls(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=Hr(r.shape,i,o,c,a,l);let h;if(u.filterWidth===1&&u.filterHeight===1&&wt(u.inShape,u.outShape))h=Qi({inputs:{x:r},backend:t});else{const d=t.data.get(r.dataId).values,p=Be(r.shape),f=QE(d,r.shape,r.dtype,p,u,"max");h=t.makeTensorInfo(u.outShape,r.dtype,f.values)}return h}const ype={kernelName:Xf,backendName:"cpu",kernelFunc:gpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bpe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=s;Oe(r,"maxPool3d");const u=Oo(r.shape,i,o,1,a,l,c),h=t.data.get(r.dataId).values,d=cV(h,r.shape,r.dtype,Be(r.shape),u,"max");return t.makeTensorInfo(d.shape,"float32",d.values)}const xpe={kernelName:Yf,backendName:"cpu",kernelFunc:bpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wpe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:c}=s;Oe([r,i],"maxPool3DGrad");const u=Oo(i.shape,o,a,1,l,c),h=t.bufferSync(i),d=lhe(h,u),p=u.strideDepth,f=u.strideHeight,g=u.strideWidth,m=u.dilationDepth,y=u.dilationHeight,w=u.dilationWidth,v=u.effectiveFilterDepth,I=u.effectiveFilterHeight,_=u.effectiveFilterWidth,N=v-1-u.padInfo.front,T=_-1-u.padInfo.left,E=I-1-u.padInfo.top,k=ct(i.shape,"float32"),S=t.bufferSync(r);for(let A=0;A<u.batchSize;++A)for(let P=0;P<u.inChannels;++P)for(let D=0;D<u.inDepth;++D)for(let V=0;V<u.inHeight;++V)for(let U=0;U<u.inWidth;++U){const q=D-N,J=V-E,K=U-T;let ee=0;for(let L=0;L<v;L+=m){const ae=(q+L)/p;if(!(ae<0||ae>=u.outDepth||Math.floor(ae)!==ae))for(let ce=0;ce<I;ce+=y){const z=(J+ce)/f;if(!(z<0||z>=u.outHeight||Math.floor(z)!==z))for(let ue=0;ue<_;ue+=w){const de=(K+ue)/g;if(de<0||de>=u.outWidth||Math.floor(de)!==de)continue;const be=v*I*_-1-d.get(A,ae,z,de,P),Ee=L*I*_+ce*_+ue,Re=be===Ee?1:0;if(Re===0)continue;const _e=S.get(A,ae,z,de,P);ee+=_e*Re}}}k.set(ee,A,D,V,U,P)}return t.makeTensorInfo(k.shape,k.dtype,k.values)}const vpe={kernelName:Gx,backendName:"cpu",kernelFunc:wpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ipe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i,output:o}=e,a=i;Oe([i,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:h}=s,d=Hr(a.shape,l,c,1,u,h),p=t.data.get(a.dataId).values,f=ct(d.outShape,a.dtype,lV(p,a.shape,a.dtype,d).values),g=d.strideHeight,m=d.strideWidth,y=d.dilationHeight,w=d.dilationWidth,v=d.effectiveFilterHeight,I=d.effectiveFilterWidth,_=I-1-d.padInfo.left,N=v-1-d.padInfo.top,T=ct(a.shape,"float32"),E=t.data.get(r.dataId).values,k=ct(r.shape,"float32",E);for(let S=0;S<d.batchSize;++S)for(let A=0;A<d.inChannels;++A)for(let P=0;P<d.inHeight;++P)for(let D=0;D<d.inWidth;++D){const V=P-N,U=D-_;let q=0;for(let J=0;J<v;J+=y){const K=(V+J)/g;if(!(K<0||K>=d.outHeight||Math.floor(K)!==K))for(let ee=0;ee<I;ee+=w){const L=(U+ee)/m;if(L<0||L>=d.outWidth||Math.floor(L)!==L)continue;const ae=v*I-1-f.get(S,K,L,A),ce=J*I+ee,z=ae===ce?1:0;if(z===0)continue;const ue=k.get(S,K,L,A);q+=ue*z}}T.set(q,S,P,D,A)}return t.makeTensorInfo(T.shape,T.dtype,T.values)}const Spe={kernelName:Wx,backendName:"cpu",kernelFunc:Ipe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kpe(n,e,t,s,r){const i=Be(e),o=QE(n,e,t,i,r,"max"),a=lV(n,e,t,r,!0,s);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tpe={kernelName:Hx,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;Oe(s,"MaxPoolWithArgmax");const c=l.data.get(s.dataId).values,u=Hr(s.shape,r,i,[1,1],o),[h,d]=kpe(c,s.shape,s.dtype,a,u),p=l.write(h,u.outShape,s.dtype),f=l.write(d,u.outShape,s.dtype);return[{dataId:p,shape:u.outShape,dtype:s.dtype},{dataId:f,shape:u.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cpe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=ft(i,r.shape),c=Xn(r.shape,a)[1],u=re(c),h=[],d=t.makeTensorInfo([],"float32",new Float32Array([u]));h.push(d);const p=Ra({inputs:{x:r},backend:t,attrs:{dtype:"float32"}});h.push(p);const f=ZE({inputs:{a:p,b:d},backend:t});h.push(f);const g=ng({inputs:{x:f},backend:t,attrs:{axis:i,keepDims:o}});return h.forEach(m=>t.disposeIntermediateTensorInfo(m)),g}const Epe={kernelName:Qf,backendName:"cpu",kernelFunc:Cpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _pe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;Oe(r,"min");const a=ft(i,r.shape);let l=a;const c=pn(l,r.shape.length);let u=r;c!=null&&(u=Xs({inputs:{x:r},backend:t,attrs:{perm:c}}),l=vn(l.length,r.shape.length)),cs("min",l,u.shape.length);const[h,d]=Xn(u.shape,l),p=re(d),f=is(re(h),u.dtype),g=t.data.get(u.dataId).values;for(let y=0;y<f.length;++y){const w=y*p;let v=g[w];for(let I=0;I<p;++I){const _=g[w+I];(Number.isNaN(_)||_<v)&&(v=_)}f[y]=v}c!=null&&t.disposeIntermediateTensorInfo(u);const m=t.makeTensorInfo(h,u.dtype,f);if(o){const y=wn(h,a),w=Zt({inputs:{x:m},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(m),w}return m}const Npe={kernelName:Zf,backendName:"cpu",kernelFunc:_pe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ape(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,mode:o}=s;Oe(r,"mirrorPad");const a=i.map((v,I)=>v[0]+r.shape[I]+v[1]),l=i.map(v=>v[0]),c=i.map((v,I)=>v[0]+r.shape[I]),u=o==="reflect"?0:1,h=t.data.get(r.dataId).values,d=r.shape.length,p=Be(r.shape),f=re(a),g=a.length,m=Be(a),y=Hn(r.dtype,f);for(let v=0;v<f;v++){let I=uc(v,g,m);for(let N=0;N<g;N++)I[N]<l[N]?I[N]=l[N]*2-I[N]-u:I[N]>=c[N]&&(I[N]=(c[N]-1)*2-I[N]+u);I=I.map((N,T)=>N-l[T]);const _=ii(I,d,p);y[v]=h[_]}return{dataId:t.write(y,a,r.dtype),shape:a,dtype:r.dtype}}const Rpe={kernelName:Jf,backendName:"cpu",kernelFunc:Ape};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $pe=Sn((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e}),Dpe=zn(fh,$pe),Ppe={kernelName:fh,backendName:"cpu",kernelFunc:Dpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fV(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:i}=s,o=r.shape.length;let a=i;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=ft([a],r.shape),c=pV({inputs:{x:r},backend:t,attrs:{reductionIndices:l,keepDims:!1}}),u=wn(c.shape,l),h=Zt({inputs:{x:c},backend:t,attrs:{shape:u}}),d=YE({inputs:{a:r,b:h},backend:t}),p=g3({inputs:{x:d},backend:t}),f=ng({inputs:{x:p},backend:t,attrs:{axis:l,keepDims:!1}}),g=Zt({inputs:{x:f},backend:t,attrs:{shape:u}}),m=ZE({inputs:{a:p,b:g},backend:t});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(g),m}const Ope={kernelName:ym,backendName:"cpu",kernelFunc:fV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fpe(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s;Oe(r,"multinomial");const l=a?r:fV({inputs:{logits:r},backend:t,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],h=t.data.get(l.dataId).values,d=[c,i],p=is(re(d),"int32");for(let f=0;f<c;++f){const g=f*u,m=new Float32Array(u-1);m[0]=h[g];for(let v=1;v<m.length;++v)m[v]=m[v-1]+h[g+v];const y=Bh.alea(o.toString()),w=f*i;for(let v=0;v<i;++v){const I=y();p[w+v]=m.length;for(let _=0;_<m.length;_++)if(I<m[_]){p[w+v]=_;break}}}return a||t.disposeIntermediateTensorInfo(l),t.makeTensorInfo(d,"int32",p)}const Lpe={kernelName:qx,backendName:"cpu",kernelFunc:Fpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mpe=t0;function zpe(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s;Oe(r,"NonMaxSuppression");const c=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,{selectedIndices:h}=Mpe(c,u,o,a,l);return t.makeTensorInfo([h.length],"int32",new Int32Array(h))}const Vpe={kernelName:Kx,backendName:"cpu",kernelFunc:zpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bpe=n0;function jpe(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=s;Oe(r,"NonMaxSuppressionPadded");const u=t.data.get(r.dataId).values,h=t.data.get(i.dataId).values,{selectedIndices:d,validOutputs:p}=Bpe(u,h,o,a,l,c);return[t.makeTensorInfo([d.length],"int32",new Int32Array(d)),t.makeTensorInfo([],"int32",new Int32Array([p]))]}const Upe={kernelName:Xx,backendName:"cpu",kernelFunc:jpe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wpe=s0;function Gpe(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=s;Oe(r,"NonMaxSuppressionWithScore");const u=t.data.get(r.dataId).values,h=t.data.get(i.dataId).values,d=o,p=a,f=l,g=c,{selectedIndices:m,selectedScores:y}=Wpe(u,h,d,p,f,g);return[t.makeTensorInfo([m.length],"int32",new Int32Array(m)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const Hpe={kernelName:Yx,backendName:"cpu",kernelFunc:Gpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qpe(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s;Oe(r,"oneHot");const c=re(r.shape),u=new Float32Array(c*o);u.fill(l);const h=t.data.get(r.dataId).values;for(let d=0;d<c;++d)h[d]>=0&&h[d]<o&&(u[d*o+h[d]]=a);return t.makeTensorInfo([...r.shape,o],i,u)}const Kpe={kernelName:sm,backendName:"cpu",kernelFunc:qpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _b(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Ql({inputs:{input:s},backend:t}),i=_b({inputs:{x:r},backend:t}),o=_u({inputs:{input:s},backend:t}),a=_b({inputs:{x:o},backend:t}),l=sr({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return JE({backend:t,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const Xpe={kernelName:vm,backendName:"cpu",kernelFunc:_b};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mV(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Ql({inputs:{input:s},backend:t}),i=mV({inputs:{x:r},backend:t}),o=_u({inputs:{input:s},backend:t}),a=_b({inputs:{x:o},backend:t}),l=sr({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return JE({backend:t,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const Ype={kernelName:nm,backendName:"cpu",kernelFunc:mV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gV(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return Eb({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(u=>{as(i,u.shape,"All tensors passed to stack must have matching shapes"),O(o===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const h=Eb({inputs:{input:u},backend:t,attrs:{dim:r}});return a.push(h),h}),c=Nu({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(u=>t.disposeIntermediateTensorInfo(u)),c}const Qpe={kernelName:rm,backendName:"cpu",kernelFunc:gV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zpe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,constantValue:o}=s;Oe(r,"pad");const a=i.map((w,v)=>w[0]+r.shape[v]+w[1]),l=i.map(w=>w[0]),c=t.data.get(r.dataId).values,u=re(r.shape),h=r.shape.length,d=Be(r.shape),p=re(a),f=a.length,g=Be(a),m=Hn(r.dtype,p);o!==0&&m.fill(o);for(let w=0;w<u;w++){const I=uc(w,h,d).map((N,T)=>N+l[T]),_=ii(I,f,g);m[_]=c[w]}return{dataId:t.write(m,a,r.dtype),shape:a,dtype:r.dtype}}const yV={kernelName:im,backendName:"cpu",kernelFunc:Zpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jpe=Sn((n,e)=>Math.pow(n,e)),efe=zn(gh,Jpe),tfe={kernelName:gh,backendName:"cpu",kernelFunc:efe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nfe(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,a=r.map(m=>t.data.get(m.dataId).values),l=r.map(m=>m.shape),c=t.data.get(i.dataId).values,u=t.data.get(o.dataId).values,[h,d,p]=P3(a,l,c,i.shape,i.dtype,u,o.shape),f=h.map(m=>t.makeTensorInfo([m.length],"int32",m)),g=t.makeTensorInfo(p,i.dtype,d);return f.concat([g])}const sfe={kernelName:Qx,backendName:"cpu",kernelFunc:nfe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rfe(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:i}=e,o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[c,u]=O3(o,s.shape,s.dtype,a,r.shape,l,i.shape),h=t.makeTensorInfo([c.length],"int32",c),d=t.makeTensorInfo([u.length],s.dtype,u);return[h,d]}const ife={kernelName:Zx,backendName:"cpu",kernelFunc:rfe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ofe(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,c=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,h=t.data.get(o.dataId).values,d=a.map(m=>t.data.get(m.dataId).values),p=a.map(m=>m.shape),[f,g]=F3(c,r.shape,u,i.shape,i.dtype,h,o.shape,d,p,l);return t.makeTensorInfo(f,i.dtype,g)}const afe={kernelName:Jx,backendName:"cpu",kernelFunc:ofe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lfe(n){const{backend:e,attrs:t}=n,{start:s,stop:r,dtype:i,step:o}=t,a=L3(s,r,o,i);return e.makeTensorInfo([a.length],i,a)}const cfe={kernelName:ew,backendName:"cpu",kernelFunc:lfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ufe=Bt(yh,n=>1/n),hfe={kernelName:yh,backendName:"cpu",kernelFunc:ufe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dfe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;Oe(r,"resizeBilinear");const l=Be(r.shape),[c,u]=a,[h,d,p,f]=r.shape,g=t.data.get(r.dataId).values,m=new Float32Array(re([h,c,u,f])),y=[i&&c>1?d-1:d,i&&u>1?p-1:p],w=[i&&c>1?c-1:c,i&&u>1?u-1:u];let v=0;const I=y[0]/w[0],_=y[1]/w[1];for(let N=0;N<h;N++)for(let T=0;T<c;T++){let E;o?E=I*(T+.5)-.5:E=I*T;const k=Math.max(0,Math.floor(E)),S=E-k,A=Math.min(d-1,Math.ceil(E)),P=N*l[0]+k*l[1],D=N*l[0]+A*l[1];for(let V=0;V<u;V++){let U;o?U=_*(V+.5)-.5:U=_*V;const q=Math.max(0,Math.floor(U)),J=U-q,K=Math.min(p-1,Math.ceil(U)),ee=P+q*l[2],L=D+q*l[2],ae=P+K*l[2],ce=D+K*l[2];for(let z=0;z<f;z++){const ue=g[ee+z],de=g[L+z],be=g[ae+z],Ee=g[ce+z],Re=ue+(be-ue)*J,_e=de+(Ee-de)*J,Ae=Re+(_e-Re)*S;m[v++]=Ae}}}return t.makeTensorInfo([h,c,u,f],"float32",m)}const pfe={kernelName:um,backendName:"cpu",kernelFunc:dfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ffe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s;Oe([i,r],"resizeBilinearGrad");const a=Be(r.shape),[l,c,u,h]=r.shape,[,d,p]=i.shape,f=new Float32Array(l*c*u*h),g=[o&&d>1?c-1:c,o&&p>1?u-1:u],m=[o&&d>1?d-1:d,o&&p>1?p-1:p],y=g[0]/m[0],w=g[1]/m[1],v=t.data.get(i.dataId).values;let I=0;for(let _=0;_<l;_++){const N=_*a[0];for(let T=0;T<d;T++){const E=T*y,k=Math.floor(E),S=Math.min(Math.ceil(E),c-1),A=N+k*a[1],P=N+S*a[1],D=E-k,V=1-D;for(let U=0;U<p;U++){const q=U*w,J=Math.floor(q),K=Math.min(Math.ceil(q),u-1),ee=q-J,L=1-ee,ae=A+J*a[2],ce=A+K*a[2],z=P+J*a[2],ue=P+K*a[2],de=V*L,be=V*ee,Ee=D*L,Re=D*ee;for(let _e=0;_e<h;_e++){const Ae=v[I++];f[ae+_e]+=Ae*de,f[ce+_e]+=Ae*be,f[z+_e]+=Ae*Ee,f[ue+_e]+=Ae*Re}}}}return t.makeTensorInfo([l,u,c,h],"float32",f)}const mfe={kernelName:sw,backendName:"cpu",kernelFunc:ffe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gfe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;Oe(r,"resizeNearestNeighbor");const l=Be(r.shape),[c,u]=a,[h,d,p,f]=r.shape,g=t.data.get(r.dataId).values,m=new Float32Array(h*c*u*f),y=[i&&c>1?d-1:d,i&&u>1?p-1:p],w=[i&&c>1?c-1:c,i&&u>1?u-1:u],v=y[0]/w[0],I=y[1]/w[1];let _=0;for(let N=0;N<h;N++){const T=N*l[0];for(let E=0;E<c;E++){const k=o?v*(E+.5):v*E;let S=Math.min(d-1,i?Math.round(k):Math.floor(k));o&&(S=Math.max(0,S));const A=T+S*l[1];for(let P=0;P<u;P++){const D=o?I*(P+.5):I*P;let V=Math.min(p-1,i?Math.round(D):Math.floor(D));o&&(V=Math.max(0,V));const U=A+V*l[2];for(let q=0;q<f;q++){const J=g[U+q];m[_++]=J}}}}return t.makeTensorInfo([h,c,u,f],r.dtype,m)}const yfe={kernelName:cm,backendName:"cpu",kernelFunc:gfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bfe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s;Oe([i,r],"resizeNearestNeighborGrad");const a=Be(r.shape),l=Be(i.shape),[c,u,h,d]=r.shape,[,p,f]=i.shape,g=new Float32Array(c*u*h*d),m=t.data.get(i.dataId).values,y=[o&&p>1?u-1:u,o&&f>1?h-1:h],w=[o&&p>1?p-1:p,o&&f>1?f-1:f],v=y[0]/w[0],I=y[1]/w[1],_=1/v,N=1/I,T=Math.ceil(_)*2+2,E=Math.ceil(N)*2+2;for(let k=0;k<c;k++){const S=k*a[0];for(let A=0;A<u;A++){const P=S+A*a[1],D=Math.floor(A*_),V=Math.floor(D-T/2);for(let U=0;U<h;U++){const q=P+U*a[2],J=Math.floor(U*N),K=Math.floor(J-E/2);for(let ee=0;ee<d;ee++){let L=0;for(let ae=0;ae<T;ae++){const ce=ae+V;if(ce<0||ce>=p)continue;const z=S+ce*l[1],ue=ce*v,de=Math.min(u-1,o?Math.round(ue):Math.floor(ue));if(A===de)for(let be=0;be<E;be++){const Ee=be+K;if(Ee<0||Ee>=f)continue;const Re=z+Ee*l[2],_e=Ee*I,Ae=Math.min(h-1,o?Math.round(_e):Math.floor(_e));U===Ae&&(L+=m[Re+ee])}}g[q+ee]=L}}}}return t.makeTensorInfo(r.shape,r.dtype,g)}const xfe={kernelName:nw,backendName:"cpu",kernelFunc:bfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wfe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:i}=s;Oe(r,"reverse");const o=r.shape.length,a=ft(i,r.shape);if(o===0)return Qi({inputs:{x:r},backend:t});const l=new Nn(r.shape,r.dtype),c=t.bufferSync(r);for(let u=0;u<l.size;u++){const h=l.indexToLoc(u),d=h.slice();a.forEach(p=>d[p]=r.shape[p]-1-d[p]),l.set(c.get(...d),...h)}return t.makeTensorInfo(l.shape,l.dtype,l.values)}const vfe={kernelName:hm,backendName:"cpu",kernelFunc:wfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ife={kernelName:ww,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:i,center:o}=e,a=t,l=Hn(s.dtype,re(s.shape)),[c,u,h,d]=s.shape,[p,f]=GT(o,u,h),g=255,m=Math.sin(r),y=Math.cos(r),w=a.data.get(s.dataId).values;for(let I=0;I<c;I++){const _=I*h*u*d;for(let N=0;N<u;N++){const T=N*(h*d);for(let E=0;E<h;E++){const k=E*d;for(let S=0;S<d;S++){const A=[c,N,E,S],P=A[2],D=A[1];let V=(P-p)*y-(D-f)*m,U=(P-p)*m+(D-f)*y;V=Math.round(V+p),U=Math.round(U+f);let q=i;if(typeof i!="number"&&(S===3?q=g:q=i[S]),V>=0&&V<h&&U>=0&&U<u){const K=U*(h*d),ee=V*d,L=_+K+ee+S;q=w[L]}const J=_+T+k+S;l[J]=q}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sfe=Bt(wh,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),kfe={kernelName:wh,backendName:"cpu",kernelFunc:Sfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tfe(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:h}=Ha(i,r,o),d=!0,p=t.bufferSync(r),f=t.bufferSync(i),g=Sl(p,f,o,h,c,l,a,u,0,d);return t.makeTensorInfo(o,g.dtype,g.values)}const Cfe={kernelName:rw,backendName:"cpu",kernelFunc:Tfe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Efe(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<e?t=r+1:s=r;return s}function _fe(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<=e?t=r+1:s=r;return s}function Nfe(n,e,t,s,r,i){const o=mn("int32",t*r);for(let a=0;a<t;++a){const l=n.slice(a*s,(a+1)*s),c=a*r;for(let u=0;u<r;++u)o[c+u]=i==="left"?Efe(l,e[u+c]):_fe(l,e[u+c])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Afe(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:i}=e,{side:o}=s,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,c=Nfe(a,l,r.shape[0],r.shape[1],i.shape[1],o);return t.makeTensorInfo(i.shape,"int32",c)}const Rfe={kernelName:ow,backendName:"cpu",kernelFunc:Afe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $fe(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:i}=e;Oe([s,r,i],"select");const o=s.shape.length,a=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,c=t.data.get(i.dataId).values,u=Ws(r.dtype,i.dtype),h=is(re(r.shape),u);let d=0;const p=o===0||o>1||r.shape.length===1?1:re(r.shape.slice(1));for(let f=0;f<a.length;f++)for(let g=0;g<p;g++)a[f]===1?h[d++]=l[f]:h[d++]=c[f];return t.makeTensorInfo(r.shape,u,h)}const Dfe={kernelName:dm,backendName:"cpu",kernelFunc:$fe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pfe=l0,Ofe=c0,Ffe=Bt(Ih,n=>n>=0?Ofe*n:Pfe*(Math.exp(n)-1)),Lfe={kernelName:Ih,backendName:"cpu",kernelFunc:Ffe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mfe=Bt(Th,n=>n<0?-1:n>0?1:0),zfe={kernelName:Th,backendName:"cpu",kernelFunc:Mfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vfe=Bt(Sh,n=>Math.sin(n)),Bfe={kernelName:Sh,backendName:"cpu",kernelFunc:Vfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jfe=Bt(kh,n=>Math.sinh(n)),Ufe={kernelName:kh,backendName:"cpu",kernelFunc:jfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wfe=11920928955078125e-23,y2=Math.log(Wfe)+2,Gfe=Bt(Eh,n=>{const e=n>-y2,t=n<y2,s=Math.exp(n);let r;return t?r=s:e?r=n:r=Math.log(1+s),r}),Hfe={kernelName:Eh,backendName:"cpu",kernelFunc:Gfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qfe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,paddings:o}=s;Oe([r],"spaceToBatchND");const a=re(i),l=[[0,0]];l.push(...o);for(let N=1+i.length;N<r.shape.length;++N)l.push([0,0]);const c=yV.kernelFunc({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),u=jm(c.shape,i,a,!1),h=Um(u.length,i.length,!1),d=Wm(c.shape,i,a,!1),g=Zt({inputs:{x:c},backend:t,attrs:{shape:u}}),w=Xs({inputs:{x:g},backend:t,attrs:{perm:h}}),_=Zt({inputs:{x:w},backend:t,attrs:{shape:d}});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(w),_}const Kfe={kernelName:mm,backendName:"cpu",kernelFunc:qfe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xfe(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,c=t.data.get(i.dataId).values,u=t.data.get(o.dataId).values[0],[h,d,p,f,g]=B3(a,s.shape,s.dtype,l,r.dtype,c,u);return[t.makeTensorInfo(d,s.dtype,h),t.makeTensorInfo([d[0]],r.dtype,p),t.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(m=>Number(m)))),t.makeTensorInfo([g.length],s.dtype,new Int32Array(g))]}const Yfe={kernelName:aw,backendName:"cpu",kernelFunc:Xfe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qfe(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.data.get(r.dataId).values),a=t.data.get(s.dataId).values,l=Array.from(t.data.get(i.dataId).values),[c,u,h]=j3(a,s.shape,s.dtype,o,l);return[t.makeTensorInfo(u,s.dtype,c),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}const Zfe={kernelName:lw,backendName:"cpu",kernelFunc:Qfe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jfe(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[c,u]=XE(o,s.shape,s.dtype,a,l,!0);return t.makeTensorInfo(u,s.dtype,c)}const eme={kernelName:cw,backendName:"cpu",kernelFunc:Jfe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tme(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[c,u]=XE(o,s.shape,s.dtype,a,l);return t.makeTensorInfo(u,s.dtype,c)}const nme={kernelName:uw,backendName:"cpu",kernelFunc:tme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sme(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:c,sliceSize:u,strides:h,outputSize:d}=Ha(i,r,a),p=!1,f=t.bufferSync(r);let g;switch(i.dtype){case"bool":{const m=t.bufferSync(i),y=!!t.data.get(o.dataId).values[0];g=Sl(f,m,a,d,u,c,l,h,y,p);break}case"float32":{const m=t.bufferSync(i),y=t.data.get(o.dataId).values[0];g=Sl(f,m,a,d,u,c,l,h,y,p);break}case"int32":{const m=t.bufferSync(i),y=t.data.get(o.dataId).values[0];g=Sl(f,m,a,d,u,c,l,h,y,p);break}case"string":{const m=t.bufferSync(i),y=vo(t.data.get(o.dataId).values[0]);g=Sl(f,m,a,d,u,c,l,h,y,p);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return t.makeTensorInfo(a,g.dtype,g.values)}const rme={kernelName:hw,backendName:"cpu",kernelFunc:sme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ime(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=ft(o,r.shape)[0],l=oC(r,i,a),c=new Array(r.shape.length).fill(0),u=r.shape.slice();return l.map(h=>{const d=[...u];d[a]=h;const p=Zl({inputs:{x:r},backend:t,attrs:{begin:c,size:d}});return c[a]+=h,p})}const ome={kernelName:gm,backendName:"cpu",kernelFunc:ime};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ame={kernelName:dw,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,s=e;Oe(t,"square");const r=s.data.get(t.dataId).values,i=new Float32Array(r.length);for(let a=0;a<r.length;++a){const l=r[a];i[a]=l*l}return{dataId:s.write(i,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lme=Bt(Ph,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),cme={kernelName:Ph,backendName:"cpu",kernelFunc:lme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ume(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:d}=s;Oe(r,"stridedSlice");const{finalShapeSparse:p,finalShape:f,isIdentity:g,sliceDim0:m,isSimpleSlice:y,begin:w,end:v,strides:I}=BT(r.shape,i,o,a,l,c,u,h,d);let _;if(g)_=Zt({inputs:{x:r},backend:t,attrs:{shape:f}});else if(m||y){O(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const N=MT(w,v,I),T=Zl({inputs:{x:r},backend:t,attrs:{begin:w,size:N}});_=Zt({inputs:{x:T},backend:t,attrs:{shape:f}}),t.disposeIntermediateTensorInfo(T)}else{const N=t.bufferSync(r),T=G3(p,N,I,w);_=t.makeTensorInfo(f,T.dtype,T.values)}return _}const hme={kernelName:pw,backendName:"cpu",kernelFunc:ume};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dme(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=s,{data:u,dataSplits:h}=e,d=t.data.get(u.dataId).values,p=t.data.get(h.dataId).values,[f,g]=H3(d,p,r,i,o,a,l,c);return[t.makeTensorInfo([f.length],"string",f),t.makeTensorInfo(h.shape,"int32",g)]}const pme={kernelName:fw,backendName:"cpu",kernelFunc:dme};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fme(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values[0],[c,u,h]=q3(a,l,r),d=u.length;return[t.makeTensorInfo([d,2],"int32",c),t.makeTensorInfo([d],"string",u),t.makeTensorInfo([2],"int32",new Int32Array(h))]}const mme={kernelName:mw,backendName:"cpu",kernelFunc:fme};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gme(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=t.data.get(i.dataId).values,a=K3(o,r);return t.makeTensorInfo(i.shape,"int32",a)}const yme={kernelName:gw,backendName:"cpu",kernelFunc:gme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bme=Bt(Rh,n=>Math.tan(n)),xme={kernelName:Rh,backendName:"cpu",kernelFunc:bme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wme=Bt($h,n=>Math.tanh(n)),vme={kernelName:$h,backendName:"cpu",kernelFunc:wme};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ime(n){const{inputs:e,backend:t}=n,{tensor:s,indices:r,updates:i}=e,{sliceRank:o,numUpdates:a,sliceSize:l,strides:c,outputSize:u}=Ha(i,r,s.shape),h=!1,d=t.bufferSync(r),p=t.bufferSync(i),f=t.bufferSync(s),g=Sl(d,p,s.shape,u,l,a,o,c,f,h);return t.makeTensorInfo(s.shape,g.dtype,g.values)}const Sme={kernelName:iw,backendName:"cpu",kernelFunc:Ime};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kme(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:i}=s;Oe(r,"tile");const o=Y3(t.bufferSync(r),i);return t.makeTensorInfo(o.shape,o.dtype,o.values)}const Tme={kernelName:Dh,backendName:"cpu",kernelFunc:kme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cme(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:i,sorted:o}=s;Oe(r,"topk");const a=t.data.get(r.dataId).values,[l,c]=Z3(a,r.shape,r.dtype,i,o);return[t.makeTensorInfo(l.shape,l.dtype,l.values),t.makeTensorInfo(c.shape,c.dtype,c.values)]}const Eme={kernelName:yw,backendName:"cpu",kernelFunc:Cme};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _me(n){const{inputs:e,attrs:t,backend:s}=n,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=t,[u,h,d,p]=r.shape,[f,g]=c??[h,d],m=[u,f,g,p],y=Be(r.shape),w=y[0],v=y[1],I=y[2],_=Be(m),N=_[0],T=_[1],E=_[2],k=Hn(r.dtype,re(m));k.fill(l);const S=s.data.get(r.dataId).values,A=s.data.get(i.dataId).values;for(let D=0;D<u;++D){const V=i.shape[0]===1?A:A.subarray(D*8,D*8+8);for(let U=0;U<f;++U)for(let q=0;q<g;++q)for(let J=0;J<p;++J){let K;const ee=V[6]*q+V[7]*U+1;if(ee===0)continue;const L=(V[0]*q+V[1]*U+V[2])/ee,ae=(V[3]*q+V[4]*U+V[5])/ee,ce=b2(L,d,a),z=b2(ae,h,a);switch(o){case"nearest":K=Pme(S,h,d,w,v,I,D,z,ce,J,l);break;case"bilinear":K=Ome(S,h,d,w,v,I,D,z,ce,J,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const ue=D*N+U*T+q*E+J;k[ue]=K}return s.makeTensorInfo(m,r.dtype,k)}return{dataId:s.write(k,m,r.dtype),shape:r.shape,dtype:r.dtype}}const Nme={kernelName:bw,backendName:"cpu",kernelFunc:_me};function b2(n,e,t){switch(t){case"reflect":return Ame(n,e);case"wrap":return Rme(n,e);case"nearest":return Dme(n,e);case"constant":default:return $me(n)}}function Ame(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=2*e;t<s&&(t=s*Math.trunc(-t/s)+t),t=t<-e?t+s:-t-1}else if(t>e-1)if(e<=1)t=0;else{const s=2*e;t-=s*Math.trunc(t/s),t>=e&&(t=s-t-1)}return Sa(0,t,e-1)}function Rme(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=e-1;t+=e*(Math.trunc(-t/s)+1)}else if(t>e-1)if(e<=1)t=0;else{const s=e-1;t-=e*Math.trunc(t/s)}return Sa(0,t,e-1)}function $me(n,e){return n}function Dme(n,e){return Sa(0,n,e-1)}function Wd(n,e,t,s,r,i,o,a,l,c,u){const h=o*s+a*r+l*i+c;return 0<=a&&a<e&&0<=l&&l<t?n[h]:u}function Pme(n,e,t,s,r,i,o,a,l,c,u){const h=Math.round(a),d=Math.round(l);return Wd(n,e,t,s,r,i,o,h,d,c,u)}function Ome(n,e,t,s,r,i,o,a,l,c,u){const h=Math.floor(a),d=Math.floor(l),p=h+1,f=d+1,g=(f-l)*Wd(n,e,t,s,r,i,o,h,d,c,u)+(l-d)*Wd(n,e,t,s,r,i,o,h,f,c,u),m=(f-l)*Wd(n,e,t,s,r,i,o,p,d,c,u)+(l-d)*Wd(n,e,t,s,r,i,o,p,f,c,u);return(p-a)*g+(a-h)*m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fme(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:i}=e;Oe(i,"unique");const o=s.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:c}=J3(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([c.length],"int32",c)]}const Lme={kernelName:xw,backendName:"cpu",kernelFunc:Fme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mme(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r.shape.length,a=r.shape[i],l=new Array(o-1);let c=0;for(let p=0;p<o;p++)p!==i&&(l[c++]=r.shape[p]);const u=new Array(o).fill(0),h=r.shape.slice();h[i]=1;const d=new Array(a);for(let p=0;p<d.length;p++){u[i]=p;const f=Zl({inputs:{x:r},backend:t,attrs:{begin:u,size:h}});d[p]=Zt({inputs:{x:f},backend:t,attrs:{shape:l}}),t.disposeIntermediateTensorInfo(f)}return d}const zme={kernelName:xm,backendName:"cpu",kernelFunc:Mme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vme(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:i}=e,{numSegments:o}=s;Oe(r,"unsortedSegmentSum");const a=r.shape.length,l=i.shape.length,c=[],u=[],h=a-l;let d=i;for(let f=0;f<h;++f){const g=Eb({inputs:{input:d},backend:t,attrs:{dim:f+1}});d=g,u.push(g)}for(let f=0;f<o;++f){const g=Po(f,"int32"),m=t.makeTensorInfo([],"int32",g),y=f3({inputs:{a:m,b:d},backend:t}),w=Ra({inputs:{x:y},backend:t,attrs:{dtype:"float32"}}),v=R0({inputs:{a:w,b:r},backend:t}),I=ng({inputs:{x:v},backend:t,attrs:{axis:0,keepDims:!1}});c.push(I),u.push(m),u.push(y),u.push(w),u.push(v),u.push(I)}const p=gV({inputs:c,backend:t,attrs:{axis:0}});return u.forEach(f=>t.disposeIntermediateTensorInfo(f)),p}const Bme={kernelName:wm,backendName:"cpu",kernelFunc:Vme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jme=[Fue,yce,Mue,Vue,Sce,jue,Wue,Hue,Kue,Yue,Zue,ehe,nhe,ihe,ahe,uhe,dhe,fhe,ghe,Pue,bhe,whe,Ihe,Tce,khe,vce,Ece,Che,bce,_he,Ahe,Rhe,Dhe,Ohe,Lhe,zhe,Bhe,Uhe,Ghe,qhe,Xhe,Qhe,Jhe,tde,nde,rde,ode,lde,cde,ude,hde,pde,gde,Eue,bde,_ce,Cde,Nce,Ede,Rce,Dde,Pde,Fde,Dce,Oce,Mde,Vde,jde,Wde,Lce,zce,xce,Hde,Nhe,Kde,Yde,Zde,_ue,Bce,Uce,epe,Gce,npe,ipe,ape,upe,dpe,fpe,mpe,qce,ype,xpe,vpe,Spe,Tpe,Epe,Npe,Xce,Rpe,Ppe,Lpe,Qce,Jce,Vpe,Upe,Hpe,tue,Kpe,Ype,Qpe,yV,tfe,Aue,rue,sfe,ife,afe,cfe,wce,GI,hfe,Rue,$ue,Due,pfe,mfe,yfe,xfe,vfe,Ife,kfe,due,Cfe,Rfe,Dfe,Lfe,fue,zfe,Bfe,Ufe,mue,Ope,Hfe,Kfe,Yfe,Zfe,eme,nme,rme,ome,bue,ame,wue,Iue,cme,hme,pme,mme,yme,Cue,fde,xme,vme,Sme,Tme,Eme,Nme,nue,Lme,zme,Bme,Xpe];for(const n of jme)vw(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fl={},Wg={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function bV(n,e){fl[n]=e}function yi(n,e){if(!(n in fl)||e!=null){const s=Wme(n,e);if(s!==null)fl[n]=s;else return console.log("Could not get context for WebGL version",n),null}const t=fl[n];return t==null||t.isContextLost()?(delete fl[n],yi(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),fl[n])}function Ume(n){if(!X().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function Wme(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??Ume(n);return t.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete fl[n]},!1),X().getBool("SOFTWARE_WEBGL_ENABLED")&&(Wg.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",Wg)||t.getContext("experimental-webgl",Wg):t.getContext("webgl2",Wg)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Xp;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(Xp||(Xp={}));var wr;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(wr||(wr={}));var ns;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(ns||(ns={}));function sg(n,e){return[e,n]}function Gme(n,e){return n*e}function Gg(n){const e=re(n),t=Math.ceil(e/4);return Jy(t)}function Xh(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function Hme(n,e){const[t,s]=Xh(n,e);return t*s*4}function e_(n,e){const t=n;let s,r,i,o,a,l,c,u,h,d;return X().getNumber("WEBGL_VERSION")===2?(s=t.R32F,r=t.R16F,i=t.RGBA16F,o=t.RGBA32F,a=t.RED,c=4,u=1,h=t.HALF_FLOAT,d=t.FLOAT,l=t.RGBA8):(s=n.RGBA,r=n.RGBA,i=n.RGBA,o=t.RGBA,a=n.RGBA,c=4,u=4,h=e!=null?e.HALF_FLOAT_OES:null,d=n.FLOAT,l=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:h,textureTypeFloat:d}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ke(n,e){const t=e();return X().getBool("DEBUG")&&qme(n),t}function qme(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+wV(n,e))}const Kme=596e-10,Xme=65504;function xV(n){return!!(X().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||Kme<Math.abs(n)&&Math.abs(n)<Xme)}function wV(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function Gd(n,e){return Bo(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function vV(n,e){const t=Bo(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(ke(n,()=>n.shaderSource(t,e)),ke(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function IV(n,e){const t=Bo(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(ke(n,()=>n.shaderSource(t,e)),ke(n,()=>n.compileShader(t)),X().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw t_(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const Yme=/ERROR: [0-9]+:([0-9]+):/g;function t_(n,e){const t=Yme.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const s=+t[1],r=n.split(`
`),i=r.length.toString().length+2,o=r.map((h,d)=>Nl((d+1).toString(),i)+h);let a=0;for(let h=0;h<o.length;h++)a=Math.max(o[h].length,a);const l=o.slice(0,s-1),c=o.slice(s-1,s),u=o.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${Nl(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function SV(n){return Bo(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function kV(n,e){if(ke(n,()=>n.linkProgram(e)),!X().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function xy(n,e){if(ke(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function TV(n,e){const t=Bo(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return ke(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),ke(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function CV(n,e){const t=Bo(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return ke(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),ke(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function Qme(){return X().getNumber("WEBGL_VERSION")===2?1:4}function EV(n){return Bo(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function _V(n,e){const t=X().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const s=`[${n}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>t||e>t){const s=`[${n}x${e}]`,r=`[${t}x${t}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function NV(n){return Bo(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function qI(n,e,t,s,r,i,o){const a=n.getAttribLocation(e,t);return a===-1?!1:(ke(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),ke(n,()=>n.vertexAttribPointer(a,r,n.FLOAT,!1,i,o)),ke(n,()=>n.enableVertexAttribArray(a)),!0)}function AV(n,e,t){OV(n,t),ke(n,()=>n.activeTexture(n.TEXTURE0+t)),ke(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function Zme(n,e){OV(n,e),ke(n,()=>n.activeTexture(n.TEXTURE0+e)),ke(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function RV(n,e,t){return Bo(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function $V(n,e,t){return n.getUniformLocation(e,t)}function DV(n,e,t,s){ke(n,()=>AV(n,e,s)),ke(n,()=>n.uniform1i(t,s))}function Jme(n){ke(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,null)),ke(n,()=>n.viewport(0,0,n.canvas.width,n.canvas.height)),ke(n,()=>n.scissor(0,0,n.canvas.width,n.canvas.height))}function wy(n,e,t){ke(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),ke(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function KI(n,e){ke(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),ke(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function Hd(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+PV(n,e))}function PV(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function Bo(n,e,t){const s=ke(n,()=>e());if(s==null)throw new Error(t);return s}function OV(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+n.TEXTURE0;if(s<n.TEXTURE0||s>t){const r=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${r}.`)}}function Jl(n,e=2){return re(n.slice(0,n.length-e))}function ec(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function qd(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[Jl(n),...ec(n)]),e}function FV(n,e=!1){let t=X().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=X().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&X().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=t/2),e&&(t=t*2,s=s*2,n=n.map((a,l)=>l>=n.length-2?fx(n[l]):n[l]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=Do(n).newShape);let r=re(n),i=null;n.length<=1&&r<=t?i=[1,r]:n.length===2&&n[0]<=t&&n[1]<=t?i=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?i=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?i=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?i=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(i=[n[0],n[1]*n[2]*n[3]]);const o=i!=null&&Math.max(...i)>s&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||o)if(e){const a=Jl(n);let l=2,c=2;n.length&&([l,c]=ec(n)),r=a*(l/2)*(c/2),i=Jy(r).map(u=>u*2)}else i=Jy(r);return i}function Hg(n){return n%2===0}function Yp(n,e){if(n=n.slice(-2),e=e.slice(-2),wt(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],s=e[e.length-1];if(t===s||Hg(t)&&Hg(s)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Hg(n[0])&&Hg(e[0])}let vy,Iy;function LV(n){if(vy==null){const e=yi(n);vy=e.getParameter(e.MAX_TEXTURE_SIZE)}return vy}function ege(){vy=null}function tge(){Iy=null}function MV(n){if(Iy==null){const e=yi(n);Iy=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Iy)}function zV(n){if(n===0)return 0;let e;const t=yi(n);return vr(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:vr(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function vr(n,e){return n.getExtension(e)!=null}function XI(n){try{if(yi(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function VV(n){if(n===0)return!1;const e=yi(n);if(n===1){if(!vr(e,"OES_texture_float"))return!1}else if(!vr(e,"EXT_color_buffer_float"))return!1;return YI(e)}function BV(n){if(n===0)return!1;const e=yi(n);if(n===1){if(!vr(e,"OES_texture_float")||!vr(e,"WEBGL_color_buffer_float"))return!1}else{if(vr(e,"EXT_color_buffer_float"))return YI(e);const s="EXT_color_buffer_half_float";if(vr(e,s)){const r=e.getExtension(s);return nge(e,r)}return!1}return YI(e)}function YI(n){const e=e_(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t);const s=1,r=1;n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,s,r,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(i),o}function nge(n,e){const t=e_(n,e),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s);const r=1,i=1;n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,r,i,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(o),a}function jV(n){return n!==2?!1:yi(n).fenceSync!=null}function Yh(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&O(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}const sge=Object.freeze(Object.defineProperty({__proto__:null,assertNotComplex:Yh,bindCanvasToFramebuffer:Jme,bindColorTextureToFramebuffer:wy,bindTextureToProgramUniformSampler:DV,bindTextureUnit:AV,bindVertexBufferToProgramAttribute:qI,callAndCheck:ke,canBeRepresented:xV,createFragmentShader:IV,createFramebuffer:NV,createProgram:SV,createStaticIndexBuffer:CV,createStaticVertexBuffer:TV,createTexture:EV,createVertexShader:vV,getBatchDim:Jl,getExtensionOrThrow:Gd,getFramebufferErrorMessage:PV,getMaxTexturesInShader:MV,getNumChannels:Qme,getProgramUniformLocation:$V,getProgramUniformLocationOrThrow:RV,getRowsCols:ec,getShapeAs3D:qd,getTextureShapeFromLogicalShape:FV,getWebGLDisjointQueryTimerVersion:zV,getWebGLErrorMessage:wV,getWebGLMaxTextureSize:LV,hasExtension:vr,isCapableOfRenderingToFloatTexture:VV,isDownloadFloatTextureEnabled:BV,isReshapeFree:Yp,isWebGLFenceEnabled:jV,isWebGLVersionEnabled:XI,linkProgram:kV,logShaderSourceAndInfoLog:t_,resetMaxTextureSize:ege,resetMaxTexturesInShader:tge,unbindColorTextureFromFramebuffer:KI,unbindTextureUnit:Zme,validateFramebuffer:Hd,validateProgram:xy,validateTextureSize:_V},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fe=X();Fe.registerFlag("HAS_WEBGL",()=>Fe.getNumber("WEBGL_VERSION")>0);Fe.registerFlag("WEBGL_VERSION",()=>XI(2)?2:XI(1)?1:0);Fe.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Fe.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Fe.get("WEBGL_VERSION")===2);Fe.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Fe.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Fe.registerFlag("WEBGL_PACK",()=>Fe.getBool("HAS_WEBGL"));Fe.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_CLIP",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_REDUCE",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_LAZILY_UNPACK",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_CONV_IM2COL",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>LV(Fe.getNumber("WEBGL_VERSION")));Fe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>MV(Fe.getNumber("WEBGL_VERSION")));Fe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=Fe.getNumber("WEBGL_VERSION");return n===0?0:zV(n)});Fe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Fe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!ak());Fe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>VV(Fe.getNumber("WEBGL_VERSION")));Fe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Fe.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Fe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Fe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>BV(Fe.getNumber("WEBGL_VERSION")));Fe.registerFlag("WEBGL_FENCE_API_ENABLED",()=>jV(Fe.getNumber("WEBGL_VERSION")));Fe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Fe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Fe.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});Fe.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>ak()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});Fe.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Fe.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Fe.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Fe.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Fe.registerFlag("WEBGL_EXP_CONV",()=>!1);Fe.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Fe.getBool("IS_TEST"));Fe.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Fe.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Fe.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Fe.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $s(){let n,e,t,s,r,i,o,a,l,c;return X().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",s="in",r="texture",i="outputColor",o="out vec4 outputColor;",a=X().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",s="varying",r="texture2D",i="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:s,texture2D:r,output:i,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vc(n,e,t="index"){const s=Be(e);return s.map((r,i)=>{const o=`int ${n[i]} = ${t} / ${r}`,a=i===s.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${r}`:`index -= ${n[i]} * ${r}`;return`${o}; ${a};`}).join("")}function $0(n,e,t="index"){const s=Be(e);return s.map((r,i)=>{const o=`int ${n[i]} = ${t} / outShapeStrides[${i}]`,a=i===s.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * outShapeStrides[${i}]`:`index -= ${n[i]} * outShapeStrides[${i}]`;return`${o}; ${a};`}).join("")}function rge(n,e){const t=n.length,s=n.map(i=>`${e}[${i}]`),r=new Array(t-1);r[t-2]=s[t-1];for(let i=t-3;i>=0;--i)r[i]=`(${r[i+1]} * ${s[i+1]})`;return r}function ige(n,e,t="index"){const s=n.map((i,o)=>o),r=rge(s,e);return r.map((i,o)=>{const a=`int ${n[o]} = ${t} / ${r[o]}`,l=o===r.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${r[o]}`:`index -= ${n[o]} * ${r[o]}`;return`${a}; ${l};`}).join("")}function n_(n){const e=Be(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function s_(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const UV=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:WV}=bM;function oge(n,e,t){const s=[];if(n.forEach(p=>{const f=re(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?s.push(`uniform float ${p.name}${f>1?`[${f}]`:""};`):(s.push(`uniform sampler2D ${p.name};`),s.push(`uniform int offset${p.name};`)),t.enableShapeUniforms){const{uniformShape:g}=r_(t.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape);switch(g.length){case 1:s.push(`uniform int ${p.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${p.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${p.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${p.name}Shape;`);break}s.push(`uniform ivec2 ${p.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(p=>{s.push(`uniform ${p.type} ${p.name}${p.arrayIndex?`[${p.arrayIndex}]`:""};`)});const r=s.join(`
`),i=n.map(p=>age(p,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),o=e.texShape,a=$s(),l=uge(a);let c,u,h=pge(a);return e.isPacked?(c=lge(e.logicalShape,o,t.enableShapeUniforms),u=dge(a)):(c=cge(e.logicalShape,o,t.enableShapeUniforms),u=hge(a)),t.packedInputs&&(h+=yge),[h,l,u,r,c,i,t.userCode].join(`
`)}function Qh(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return Nge(n,e);case 1:return Rge(n,e);case 2:return Dge(n,e);case 3:return Oge(n,e);case 4:return Lge(n,e);case 5:return Mge(n);case 6:return zge(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function GV(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return _ge(n);case 1:return Age(n,e);case 2:return $ge(n,e);case 3:return Pge(n,e);default:return Fge(n,e)}}function age(n,e,t=!1,s){let r="";t?r+=GV(n,s):r+=Qh(n,s);const i=n.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(t?r+=Vge(n,e):r+=Bge(n,e)),r}function lge(n,e,t){switch(n.length){case 0:return HV();case 1:return bge(n,e,t);case 2:return Cge(n,e,t);case 3:return wge(n,e,t);default:return Ige(n,e,t)}}function cge(n,e,t){switch(n.length){case 0:return HV();case 1:return xge(n,e,t);case 2:return Ege(n,e,t);case 3:return vge(n,e,t);case 4:return Sge(n,e,t);case 5:return kge(n,e);case 6:return Tge(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function uge(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function hge(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function dge(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function pge(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${fge}
    ${mge}
    ${gge}
  `}const fge=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,mge=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,gge=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,yge=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function HV(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function bge(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function xge(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function wge(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),i=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function vge(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${$0(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=vc(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function Ige(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),i=r*Math.ceil(n[n.length-2]/2);let o=i,a="",l="b, r, c";for(let c=2;c<n.length-1;c++)o*=n[n.length-c-1],a=`
      int b${c} = index / ${o};
      index -= b${c} * ${o};
    `+a,l=`b${c}, `+l;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${l});
    }
  `}function Sge(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${$0(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=vc(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function kge(n,e){const t=vc(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function Tge(n,e){const t=vc(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function Cge(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(wt(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function Ege(n,e,t){return wt(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function Ic(n){return`offset${n}`}function _ge(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),s=$s();return`
    vec4 ${t}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function Nge(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${t};}`;const[r,i]=n.shapeInfo.texShape;if(r===1&&i===1)return`
      float ${s}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const o=Ic(t);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${o});
      return sampleTexture(${t}, uv);
    }
  `;const[a,l]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${t}, uv);
    }
  `}function Age(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,i=$s();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${t}, uv);
    }
  `;const o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${t}, uv);
    }
  `}function Rge(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Zh(n)}
      }
    `;const r=n.shapeInfo.texShape,i=r[0],o=r[1];if(o===1&&i===1)return`
      float ${s}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=Ic(t);return o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${t}, uv);
      }
    `:i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function $ge(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,o=i[0],a=i[1],l=$s();if(i!=null&&wt(t,i))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],u=Math.ceil(t[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${u}, ${c[0]}, ${c[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function Dge(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape;if(i!=null&&wt(t,i)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const d=i[0],p=i[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${p}.0, ${d}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:o,keptDims:a}=Do(t),l=o;if(l.length<t.length){const d=Jh(n,l),p=["row","col"];return`
      ${Qh(d,e)}
      float ${r}(int row, int col) {
        return ${r}(${ed(p,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${Zh(n)}
      }
    `;const c=i[0],u=i[1],h=Ic(s);return u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);
      return sampleTexture(${s}, uv);
    }
  `:c===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${h};
    vec2 uv = uvFromFlat(${c}, ${u}, index);
    return sampleTexture(${s}, uv);
  }
`}function Pge(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){const d=t.slice(1),p=[1,2],f=Jh(n,d),g=["b","row","col"];return`
        ${GV(f,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${ed(g,p)});
        }
      `}const a=$s();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=o[0],c=o[1],u=Math.ceil(t[2]/2),h=u*Math.ceil(t[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${c}, ${h}, ${u}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function Oge(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t[1]*t[2],o=t[2],{newShape:a,keptDims:l}=Do(t),c=a;if(c.length<t.length){const g=Jh(n,c),m=["row","col","depth"];return`
        ${Qh(g,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${ed(m,l)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${Zh(n)}
      }
    `;const u=n.shapeInfo.texShape,h=u[0],d=u[1],p=n.shapeInfo.flatOffset;if(d===i&&p==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${d}.0, ${h}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(d===o&&p==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `;const f=Ic(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${f};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${f};
        vec2 uv = uvFromFlat(${h}, ${d}, index);
        return sampleTexture(${s}, uv);
      }
  `}function Fge(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=$s();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${t}, uv);
    }
  `;const i=n.shapeInfo.logicalShape,o=i.length,a=n.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=l[0],u=l[1],h=Math.ceil(i[o-1]/2);let d=h*Math.ceil(i[o-2]/2),p="int b, int row, int col",f=`b * ${d} + (row / 2) * ${h} + (col / 2)`;for(let g=2;g<o-1;g++)p=`int b${g}, `+p,d*=i[o-g-1],f=`b${g} * ${d} + `+f;return`
    vec4 ${s}(${p}) {
      int index = ${f};
      int texR = index / ${u};
      int texC = index - texR * ${u};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${c});
      return ${r.texture2D}(${t}, uv);
    }
  `}function Lge(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t[3],o=t[2]*i,a=t[1]*o,{newShape:l,keptDims:c}=Do(t);if(l.length<t.length){const w=Jh(n,l),v=["row","col","depth","depth2"];return`
      ${Qh(w,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${ed(v,c)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${i}, 1)));
        ${Zh(n)}
      }
    `;const u=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,d=h[0],p=h[1],f=`int stride2 = ${s}Shape[3];`,g=`int stride1 = ${s}Shape[2] * stride2;`,m=`int stride0 = ${s}Shape[1] * stride1;`;if(p===a&&u==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${f}
        ${g}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(p===i&&u==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${s}, uv);
      }
    `;const y=Ic(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${f}
      ${g}
      ${m}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${y});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${d}, ${p}, index + ${y});
      return sampleTexture(${s}, uv);
    }
  `}function Mge(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],i=e[3]*r,o=e[2]*i,a=e[1]*o,{newShape:l,keptDims:c}=Do(e);if(l.length<e.length){const g=Jh(n,l),m=["row","col","depth","depth2","depth3"];return`
      ${Qh(g)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${ed(m,c)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${i}, ${r})) +
          depth3;
        ${Zh(n)}
      }
    `;const u=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,d=h[0],p=h[1];if(p===a&&u==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(p===r&&u==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${t}, uv);
      }
    `;const f=Ic(t);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${i} +
          depth2 * ${r} + depth3 + ${f};
      vec2 uv = uvFromFlat(${d}, ${p}, index);
      return sampleTexture(${t}, uv);
    }
  `}function zge(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:r,keptDims:i}=Do(e);if(r.length<e.length){const m=Jh(n,r),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${Qh(m)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${ed(y,i)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,c=e[2]*l,u=e[1]*c;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${Zh(n)}
      }
    `;const h=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,p=d[0],f=d[1];if(f===u&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(f===o&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;const g=Ic(t);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${g};
      vec2 uv = uvFromFlat(${p}, ${f}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Zh(n){const e=n.name,t=re(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function Vge(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",i=n.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=WV(n.shapeInfo.logicalShape,e.logicalShape),l=Ut(o),c=o-i;let u;const h=["x","y","z","w","u","v"];i===0?u="":o<2&&a.length>=1?u="coords = 0;":u=a.map(w=>`coords.${h[w+c]} = 0;`).join(`
`);let d="";o<2&&i>0?d="coords":d=n.shapeInfo.logicalShape.map((w,v)=>`coords.${h[v+c]}`).join(", ");let p="return outputValue;";const g=re(n.shapeInfo.logicalShape)===1,y=re(e.logicalShape)===1;if(i===1&&!g&&!y)p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(g&&!y)o===1?p=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:p=`
        return vec4(outputValue.x);
      `;else if(a.length){const w=i-2,v=i-1;a.indexOf(w)>-1&&a.indexOf(v)>-1?p="return vec4(outputValue.x);":a.indexOf(w)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(v)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${s}(${d});
      ${p}
    }
  `}function Bge(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",i=e.texShape,o=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!n.shapeInfo.isUniform&&a===l&&n.shapeInfo.flatOffset==null&&wt(o,i))return`
      float ${r}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const c=Ut(l),u=WV(n.shapeInfo.logicalShape,e.logicalShape),h=l-a;let d;const p=["x","y","z","w","u","v"];a===0?d="":l<2&&u.length>=1?d="coords = 0;":d=u.map(g=>`coords.${p[g+h]} = 0;`).join(`
`);let f="";return l<2&&a>0?f="coords":f=n.shapeInfo.logicalShape.map((g,m)=>`coords.${p[m+h]}`).join(", "),`
    float ${r}() {
      ${c} coords = getOutputCoords();
      ${d}
      return get${s}(${f});
    }
  `}function Ut(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function r_(n,e,t){const{newShape:s,keptDims:r}=Do(e),i=e.length,o=n&&i===3&&e[0]===1,a=o?e.slice(1):s,l=!n&&i>1&&!wt(e,t)&&s.length<i||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function Jh(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function ed(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jge(n,e,t,s){const r=t.map((u,h)=>{const d={logicalShape:u.shape,texShape:u.isUniform?null:u.texData.texShape,isUniform:u.isUniform,isPacked:u.isUniform?!1:u.texData.isPacked,flatOffset:null};return u.texData!=null&&u.texData.slice!=null&&u.texData.slice.flatOffset>0&&(d.flatOffset=u.texData.slice.flatOffset),{name:e.variableNames[h],shapeInfo:d}}),i=r.map(u=>u.shapeInfo),o={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=oge(r,o,e),l=IV(n.gl,a),c=n.createProgram(l);return X().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(c),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},qV(n,e,c)))}function qV(n,e,t){const s=[],r=[];let i,o,a,l=null,c=null;c=n.getUniformLocation(t,"NAN",!1),X().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));const u=!1;for(const h of e.variableNames){const d={name:h,uniform:n.getUniformLocation(t,h,u),offset:n.getUniformLocation(t,`offset${h}`,u)};e.enableShapeUniforms&&(d.shape=n.getUniformLocation(t,`${h}Shape`,u),d.texShape=n.getUniformLocation(t,`${h}TexShape`,u)),s.push(d)}if(e.enableShapeUniforms&&(i=n.getUniformLocation(t,"outShape",u),a=n.getUniformLocation(t,"outShapeStrides",u),o=n.getUniformLocation(t,"outTexShape",u)),e.customUniforms)for(const h of e.customUniforms)r.push(n.getUniformLocation(t,h.name,u));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:c,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:o}}function x2(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,s)=>{const r=t.logicalShape,i=e[s],o=i.shape;if(!wt(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(t.isUniform&&i.isUniform)return;const a=t.texShape,l=i.isUniform?null:i.texData.texShape;if(!wt(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function Uge(n,e,t,s,r){e.program.enableShapeUniforms||(x2(e.inShapeInfos,t),x2([e.outShapeInfo],[s]));const i=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):n.setOutputMatrixTexture(i.texture,o[0],o[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),X().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<t.length;++l){const c=t[l],{uniform:u,offset:h,shape:d,texShape:p}=e.variablesLocations[l];if(d){const{uniformShape:f}=r_(e.program.packedInputs,c.shape,c.texData.texShape);switch(f.length){case 1:n.gl.uniform1iv(d,new Int32Array(f));break;case 2:n.gl.uniform2iv(d,new Int32Array(f));break;case 3:n.gl.uniform3iv(d,new Int32Array(f));break;case 4:n.gl.uniform4iv(d,new Int32Array(f));break}}if(p&&n.gl.uniform2i(p,c.texData.texShape[0],c.texData.texShape[1]),u!=null){if(c.isUniform){if(re(c.shape)<2)n.gl.uniform1f(u,c.uniformValues[0]);else{let f=c.uniformValues;f instanceof Float32Array||(f=new Float32Array(f)),n.gl.uniform1fv(u,f)}continue}c.texData.slice!=null&&h!=null&&n.gl.uniform1i(h,c.texData.slice.flatOffset),n.setInputMatrixTexture(c.texData.texture.texture,u,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=Be(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const c=e.program.customUniforms[l],u=e.customUniformLocations[l],h=r[l];if(c.type==="float")n.gl.uniform1fv(u,h);else if(c.type==="vec2")n.gl.uniform2fv(u,h);else if(c.type==="vec3")n.gl.uniform3fv(u,h);else if(c.type==="vec4")n.gl.uniform4fv(u,h);else if(c.type==="int")n.gl.uniform1iv(u,h);else if(c.type==="ivec2")n.gl.uniform2iv(u,h);else if(c.type==="ivec3")n.gl.uniform3iv(u,h);else if(c.type==="ivec4")n.gl.uniform4iv(u,h);else throw Error(`uniform type ${c.type} is not supported yet.`)}n.executeProgram()}function Wge(n,e,t){let s="";e.concat(t).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:c,uniformShape:u,keptDims:h}=r_(n.packedInputs,o.shape,l);let d="",p="",f="";if(u.length===1&&n.packedInputs){const _=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];d=`${_[0]>1}_${_[1]>1}`}else if(u.length===2&&!n.packedInputs)p=`${u[0]>1}_${u[1]>1}`;else if(u.length>2&&!n.packedInputs){const _=Be(u);f=`${_[0]===l[1]}_${_[_.length-1]===l[1]}`}const g=o.shape.length,m=u.length===2&&wt(o.shape,l),y=re(o.shape)===1,w=Wl(o.shape,t.shape),v=!n.packedInputs&&g===t.shape.length&&wt(l,t.texData.texShape),I=n.packedInputs||u.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${g}_${v}_${c?h:""}_${u.length}_${y}_${w}_${m}_${d}_${p}_${f}_${I}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;s+=`${o.shape}_${l}_${a}`}});const r=n.userCode;let i=n.constructor.name;return i+="_"+s+"_"+r+`${X().getNumber("WEBGL_VERSION")}`,i}function ys(n){return X().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gge{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Xp.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=$s();this.outputShape=e,this.enableShapeUniforms=ys(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?$0(["r","c","d"],e):vc(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hge{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Xp.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=$s();this.outputShape=e,this.enableShapeUniforms=ys(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?$0(["r","c","d"],e):vc(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qge{constructor(e){this.variableNames=["A"],this.outTexUsage=wr.DOWNLOAD;const t=$s();this.outputShape=e,this.userCode=`
      ${UV}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kge{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=wr.DOWNLOAD;const t=$s();this.outputShape=e,this.userCode=`
      ${UV}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xge={R:0,G:1,B:2,A:3};class w2{constructor(e,t=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=$s();this.outputShape=e,this.enableShapeUniforms=ys(this.outputShape.length);let i="result";t&&(i="floor(result * 255. + 0.5)");let o="";for(let a=0;a<s.length;a++){const l=s[a];o+=`
          if(offset == ${a}) {
            result = values[${Xge[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?s_():n_(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${o}
        }
        ${r.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yge{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=$s();this.outputShape=e,this.enableShapeUniforms=ys(this.outputShape.length);let r="",i="result";t&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?s_():n_(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KV(n){const e=$s(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return vV(n,t)}function XV(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return TV(n,e)}function YV(n){const e=new Uint16Array([0,1,2,2,1,3]);return CV(n,e)}function rg(n,e,t,s,r,i){_V(e,t);const o=EV(n),a=n.TEXTURE_2D;return ke(n,()=>n.bindTexture(a,o)),ke(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),ke(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),ke(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),ke(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),X().getNumber("WEBGL_VERSION")===1?ke(n,()=>n.texImage2D(a,0,s,e,t,0,r,i,null)):ke(n,()=>n.texStorage2D(a,1,s,e,t)),ke(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:o,texShape:[t,e]}}function i_(n){return n.internalFormatFloat}function QV(n,e,t,s){const[r,i]=sg(e,t);return rg(n,r,i,i_(s),s.textureFormatFloat,n.FLOAT)}function o_(n){return n.internalFormatHalfFloat}function ZV(n,e,t,s){const[r,i]=sg(e,t);return rg(n,r,i,o_(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function a_(n){return n.downloadTextureFormat}function JV(n,e,t,s){const[r,i]=sg(e,t);return rg(n,r,i,a_(s),n.RGBA,n.UNSIGNED_BYTE)}function l_(n){return n.internalFormatPackedFloat}function eB(n,e,t,s){const[r,i]=Xh(e,t);return rg(n,r,i,l_(s),n.RGBA,n.FLOAT)}function c_(n){return n.internalFormatPackedHalfFloat}function tB(n,e,t,s){const[r,i]=Xh(e,t);return rg(n,r,i,c_(s),n.RGBA,s.textureTypeHalfFloat)}function nB(n,e,t){return ke(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),qI(n,e,"clipSpacePos",t,3,20,0)&&qI(n,e,"uv",t,2,20,12)}function sB(n,e,t,s,r,i){ke(n,()=>n.bindTexture(n.TEXTURE_2D,e));let o,a,l;r instanceof Uint8Array?(o=new Uint8Array(t*s*4),a=n.UNSIGNED_BYTE,l=n.RGBA):(o=new Float32Array(t*s*4),a=n.FLOAT,l=i.internalFormatPackedFloat),o.set(r),X().getNumber("WEBGL_VERSION")===2?ke(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,s,n.RGBA,a,o)):ke(n,()=>n.texImage2D(n.TEXTURE_2D,0,l,t,s,0,n.RGBA,a,o)),ke(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function rB(n,e,t){ke(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?X().getNumber("WEBGL_VERSION")===2?ke(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):ke(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):X().getNumber("WEBGL_VERSION")===2?ke(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):ke(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),ke(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function iB(n,e,t,s){const r=n.createBuffer();ke(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const a=4*4*e*t;return ke(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),ke(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),ke(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function oB(n,e,t){const s=n,r=new Float32Array(t);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function aB(n,e,t,s){const[r,i]=sg(e,t),o=4,a=new Uint8Array(Gme(e*t,o));return ke(n,()=>n.readPixels(0,0,r,i,s.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function lB(n,e,t,s,r,i,o,a){const l=n,c=new Float32Array(Hme(i,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function cB(n,e,t){const s=new Float32Array(e*t*4);return ke(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,s)),s}const Qge=Object.freeze(Object.defineProperty({__proto__:null,bindVertexProgramAttributeStreams:nB,createBufferFromOutputTexture:iB,createFloat16MatrixTexture:ZV,createFloat16PackedMatrixTexture:tB,createFloat32MatrixTexture:QV,createIndexBuffer:YV,createPackedMatrixTexture:eB,createUnsignedBytesMatrixTexture:JV,createVertexBuffer:XV,createVertexShader:KV,downloadByteEncodedFloatMatrixFromOutputTexture:aB,downloadFloat32MatrixFromBuffer:oB,downloadMatrixFromPackedOutputTexture:cB,downloadPackedMatrixFromBuffer:lB,getInternalFormatForFloat16MatrixTexture:o_,getInternalFormatForFloat16PackedMatrixTexture:c_,getInternalFormatForFloat32MatrixTexture:i_,getInternalFormatForPackedMatrixTexture:l_,getInternalFormatForUnsignedBytesMatrixTexture:a_,uploadDenseMatrixToTexture:sB,uploadPixelDataToTexture:rB},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sy{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=X().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,bV(t,e)):this.gl=yi(t),e=this.gl,X().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>ke(i,()=>i.createVertexArray()),this.bindVertexArray=o=>ke(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>ke(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>ke(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>ke(e,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>ke(e,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>ke(e,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>ke(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),X().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=Gd(this.gl,i),vr(this.gl,o))this.textureHalfFloatExtension=Gd(this.gl,o);else if(X().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),vr(this.gl,r))this.colorBufferHalfFloatExtension=Gd(this.gl,r);else if(X().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",vr(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(vr(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=XV(this.gl),this.indexBuffer=YV(this.gl),this.framebuffer=NV(this.gl),this.textureConfig=e_(this.gl,this.textureHalfFloatExtension)}get debug(){return X().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;ke(e,()=>e.finish()),ke(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),ke(e,()=>e.deleteFramebuffer(this.framebuffer)),ke(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),ke(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),ke(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),QV(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),ZV(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),JV(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),rB(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,s,r){this.throwIfDisposed(),sB(this.gl,e,t,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),tB(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),eB(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(KI(this.gl,this.framebuffer),this.outputTexture=null),ke(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,s){return this.downloadMatrixDriver(e,()=>aB(this.gl,t,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,s,r,i,o){return lB(this.gl,e,t,s,r,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return oB(this.gl,e,t)}createBufferFromTexture(e,t,s){this.bindTextureToFrameBuffer(e);const r=iB(this.gl,t,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,s;if(X().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const o=r.clientWaitSync(i,0,0);return o===r.ALREADY_SIGNALED||o===r.CONDITION_SATISFIED},t=i}else X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(t,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:t,isFencePassed:s}}downloadMatrixFromPackedTexture(e,t,s){return this.downloadMatrixDriver(e,()=>cB(this.gl,t,s))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=KV(t));const s=SV(t);ke(t,()=>t.attachShader(s,this.vertexShader)),ke(t,()=>t.attachShader(s,e)),kV(t,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&xy(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;ke(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),nB(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(ke(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&xy(this.gl,this.program),ke(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,s=!0){return this.throwIfDisposed(),s?RV(this.gl,e,t):$V(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),ke(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,s){this.throwIfDisposed(),this.throwIfNoProgram(),DV(this.gl,e,t,s)}setOutputMatrixTexture(e,t,s){this.setOutputMatrixTextureDriver(e,s,t)}setOutputPackedMatrixTexture(e,t,s){this.throwIfDisposed();const[r,i]=Xh(t,s);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,t,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&xy(this.gl,this.program),Hd(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}ke(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),ke(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Gd(this.gl,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,s=this.getQueryTimerExtensionWebGL2();t.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await tI(()=>this.disposed||this.isQueryAvailable(e,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=Zge(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:s}=this.itemsToPoll[t];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in X().platform&&(s=X().platform.setTimeoutCustom.bind(X().platform)),tI(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),wy(this.gl,e,this.framebuffer),this.debug&&Hd(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(wy(this.gl,this.outputTexture,this.framebuffer),this.debug&&Hd(this.gl)):KI(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const s=t();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,t,s){this.throwIfDisposed();const r=this.gl;wy(r,e,this.framebuffer),this.debug&&Hd(r),this.outputTexture=e,ke(r,()=>r.viewport(0,0,t,s)),ke(r,()=>r.scissor(0,0,t,s))}setOutputMatrixWriteRegionDriver(e,t,s,r){this.throwIfDisposed(),ke(this.gl,()=>this.gl.scissor(e,t,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function Zge(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:Jge,bincountImpl:uB,bincountReduceImpl:eye,bitwiseAndImpl:tye,castImpl:nye,ceilImpl:sye,concatImpl:rye,equalImpl:iye,expImpl:oye,expm1Impl:aye,floorImpl:lye,gatherNdImpl:cye,gatherV2Impl:uye,greaterImpl:hye,greaterEqualImpl:dye,lessImpl:pye,lessEqualImpl:fye,linSpaceImpl:mye,logImpl:gye,maxImpl:yye,maximumImpl:bye,minimumImpl:xye,multiplyImpl:wye,negImpl:vye,notEqualImpl:Iye,prodImpl:Sye,raggedGatherImpl:kye,raggedRangeImpl:Tye,raggedTensorToTensorImpl:Cye,rangeImpl:Eye,rsqrtImpl:_ye,scatterImpl:Nye,sigmoidImpl:Aye,simpleAbsImpl:hB,sliceImpl:Rye,sparseFillEmptyRowsImpl:$ye,sparseReshapeImpl:Dye,sparseSegmentReductionImpl:dB,sqrtImpl:Pye,staticRegexReplaceImpl:Oye,stridedSliceImpl:Fye,stringNGramsImpl:Lye,stringSplitImpl:Mye,stringToHashBucketFastImpl:zye,subImpl:Vye,tileImpl:Bye,topKImpl:jye,transposeImpl:u_,uniqueImpl:Uye}=eV;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pB(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function Ts(n,e){return e===1?[n]:pB(n,e)}function Wye(n,e){if(n===1)return"rc";let t="";for(let s=0;s<n;s++)t+=e[s],s<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gye{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=ys(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=Ts("rc",this.rank),s=Ut(this.rank),r=this.getOutOfBoundsCondition(t),i=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let i=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${e[e.length-1-o]},`+i;t.push(i)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let s=this.rank-2;s<this.rank;s++)t+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fB{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=ys(this.outputShape.length);let s="";for(let r=0;r<4;r++){let i="thisRC = rc;";r%2===1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),s+=`
        ${i}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${Hye(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?s_():n_(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function Hye(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?ige(["r","c","d"],"inputShape"):vc(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qye{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,s){const r=I2(t,s),i=S2(e,r,s);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=v2(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let a;return r===ns.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===ns.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===ns.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===ns.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===ns.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,t,s,r){if(this.freeTextures==null)return;const i=I2(s,r),o=S2(t,i,r);o in this.freeTextures||(this.freeTextures[o]=[]);const a=v2(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=X().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const c=this.usedTextures[o],u=c&&c.indexOf(e);if(u==null||u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[u]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function Kye(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function v2(n,e,t,s,r){const i=Xye(e,s);let o;if(r){const[l,c]=Xh(n[0],n[1]);o=l*c}else{const[l,c]=sg(n[0],n[1]);o=l*c}const a=Kye(t,i);return o*a}function Xye(n,e){switch(n){case ns.PACKED_2X2_FLOAT32:return l_(e);case ns.PACKED_2X2_FLOAT16:return c_(e);case ns.UNPACKED_FLOAT32:return i_(e);case ns.UNPACKED_FLOAT16:return o_(e);case ns.PACKED_4X1_UNSIGNED_BYTE:return a_(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function Yye(n){return X().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?ns.PACKED_2X2_FLOAT32:ns.UNPACKED_FLOAT32:n?ns.PACKED_2X2_FLOAT16:ns.UNPACKED_FLOAT16}function I2(n,e){if(n===wr.UPLOAD)return ns.PACKED_2X2_FLOAT32;if(n===wr.RENDER||n==null)return Yye(e);if(n===wr.DOWNLOAD||n===wr.PIXELS)return ns.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function S2(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oi{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=ys(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Kr="if (isnan(x)) return x;",Qye="return x;",k2="return abs(x);",Zye="return (x >= 0.0) ? x : (exp(x) - 1.0);",Jye=Kr+`
  return (x < 0.0) ? 0.0 : x;
`,ebe=Kr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,ta="return x;",tbe="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nbe="return x;",sbe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,rbe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ibe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,obe="return 1.0 / (1.0 + exp(-1.0 * x));";class ha{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=ys(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class abe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=ys(this.outputShape.length);const t=e.length,s=Ts("rc",t),r=Ut(t),i=Wye(t,s),o=s.slice(-2),a=t<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lbe=Xw,cbe=1e-7,ube=1e-4,qg={};function hbe(n){return n in qg||(qg[n]={}),qg[n]}const dbe=X().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),pbe=600;function fbe(){return X().global.screen==null?1024:X().global.screen.height*X().global.screen.width*window.devicePixelRatio*pbe/1024/1024}class ig extends px{nextDataId(){return ig.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!X().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof Sy)t=e;else{const s=yi(X().getNumber("WEBGL_VERSION"),e);t=new Sy(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=yi(X().getNumber("WEBGL_VERSION"));t=new Sy(s),this.binaryCache=hbe(X().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new qye(this.gpgpu),this.numMBBeforeWarning=fbe(),this.texData=new ZS(this,Jr())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,s,r,i,o){const a=this.makeTensorInfo(t,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,i]},l.texShape=[r,i];const c=qd(t),u=new w2(c,!1,o),h=this.runWebGLProgram(u,[a],s,[[r,i]]);return h.shape=t,l.texture=null,this.disposeIntermediateTensorInfo(a),h.dataId}write(e,t,s){if((X().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||X().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:s,values:e,usage:wr.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,s,r,i){if(X().getBool("DEBUG")&&this.checkNumericalProblems(t),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:t,usage:wr.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:i,slice:o,shape:a,isPacked:l}=t;if(o!=null){let d;l?d=new ha(a,ta):d=new Oi(a,ta);const p=this.runWebGLProgram(d,[{dataId:e,shape:a,dtype:r}],r),f=this.readSync(p.dataId);return this.disposeIntermediateTensorInfo(p),f}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const c=this.activeTimers!=null;let u;c&&(u=Jn());let h;if(r==="complex64"){const d=this.readSync(i.real.dataId),p=this.readSync(i.imag.dataId);h=Co(d,p)}else h=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=Jn()-u),this.convertAndCacheOnCPU(e,h)}async read(e){if(this.pendingRead.has(e)){const f=this.pendingRead.get(e);return new Promise(g=>f.push(g))}const t=this.texData.get(e),{values:s,shape:r,slice:i,dtype:o,complexTensorInfos:a,isPacked:l}=t;if(i!=null){let f;l?f=new ha(r,ta):f=new Oi(r,ta);const g=this.runWebGLProgram(f,[{dataId:e,shape:r,dtype:o}],o),m=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),m}if(s!=null)return this.convertAndCacheOnCPU(e);if(X().getBool("DEBUG")&&!X().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&X().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c=null,u;if(o!=="complex64"&&X().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(e);const f=this.texData.get(u.dataId);c=this.gpgpu.createBufferFromTexture(f.texture.texture,...Gg(r))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(o==="complex64"){const f=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),g=f[0],m=f[1];h=Co(g,m)}else if(c==null)h=this.getValuesFromTexture(e);else{const f=re(r);h=this.gpgpu.downloadFloat32MatrixFromBuffer(c,f)}if(u!=null&&this.disposeIntermediateTensorInfo(u),c!=null){const f=this.gpgpu.gl;ke(f,()=>f.deleteBuffer(c))}const d=this.convertAndCacheOnCPU(e,h),p=this.pendingRead.get(e);return this.pendingRead.delete(e),p.forEach(f=>f(d)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Jr().removeDataId(e,this),this.pendingDeletes--),d}readToGPU(e,t={}){const s=this.texData.get(e),{values:r,shape:i,slice:o,dtype:a,isPacked:l,texture:c}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let p;l?p=new ha(i,ta):p=new Oi(i,ta);const f=this.runWebGLProgram(p,[{dataId:e,shape:i,dtype:a}],a),g=this.readToGPU(f,t);return this.disposeIntermediateTensorInfo(f),g}if(c==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const u=this.decode(e,t.customTexShape),h=Jr().makeTensorFromTensorInfo(u),d=this.texData.get(u.dataId);return Object.assign({tensorRef:h},d.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>vo(r));return ct(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ct(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const s=e[t];if(!xV(s))throw X().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:s,isPacked:r}=this.texData.get(e),i=re(t);if(X().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const d=this.decode(e),p=this.texData.get(d.dataId),f=this.gpgpu.downloadMatrixFromPackedTexture(p.texture.texture,...Gg(t)).subarray(0,i);return this.disposeIntermediateTensorInfo(d),f}const o=X().getBool("WEBGL_PACK")&&r===!0,a=o?qd(t):t,l=o?new Kge(a):new qge(a),c=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),u=this.texData.get(c.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture.texture,u.texShape[0],u.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(c),h}timerAvailable(){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const i=Ki(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=Ki(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=t,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(i);a.kernelMs=$O(l),a.getExtraProfileInfo=()=>l.map((c,u)=>({name:o[u],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Jn(),endMs:null}}endTimer(e){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Jn(),e)}async getQueryTime(e){if(X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,t),this.disposeData(s.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:s,texShape:r,usage:i,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),t!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(t,r,i,o)));const u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=dbe){return X().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&re(s.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){yr("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return lbe(e.shape,t)}packedUnaryOp(e,t,s){const r=new ha(e.shape,t),i=this.compileAndRun(r,[e],s);return Jr().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=hB(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,k2,e.dtype);const t=new Oi(e.shape,k2),s=this.compileAndRun(t,[e]);return Jr().makeTensorFromTensorInfo(s)}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&Pi(s[0])){const i=s.map(o=>Li(o));r=this.write(i,e,t)}else r=this.write(s,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,s){return Jr().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,s),this)}unpackTensor(e){const t=new abe(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new Gye(e.shape),s=!0;return this.runWebGLProgram(t,[e],e.dtype,null,s)}packedReshape(e,t){const s=[Jl(e.shape),...ec(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},i=[Jl(t),...ec(t)],o=new fB(i,s),a=!0,l=[s],c=this.runWebGLProgram(o,[r],e.dtype,l,a);return{dataId:c.dataId,shape:t,dtype:c.dtype}}decode(e,t){const s=this.texData.get(e),{isPacked:r,shape:i,dtype:o}=s;if(t!=null){const d=re(i),p=t[0]*t[1]*4;O(d<=p,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=qd(i);let l;r?l=new Hge(a):l=new Gge(a);const c=!0,u=[t??Gg(a)],h=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,u,c,t);return{dtype:o,shape:i,dataId:h.dataId}}runWebGLProgram(e,t,s,r,i=!1,o){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===Xp.DENSE){const y=o??Gg(e.outputShape);l.texShape=y.map(w=>w*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),re(a.shape)===0)return l.values=Hn(a.dtype,0),a;const c=[],u=t.map(y=>{if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let w=this.texData.get(y.dataId);if(w.texture==null){if(!e.packedInputs&&re(y.shape)<=X().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:w.values};e.packedInputs&&(w.isPacked=!0,w.shape=y.shape)}if(this.uploadToGPU(y.dataId),!!w.isPacked!=!!e.packedInputs)y=w.isPacked?this.unpackTensor(y):this.packTensor(y),c.push(y),w=this.texData.get(y.dataId);else if(w.isPacked&&!Yp(w.shape,y.shape)){const v=y,I=y.shape;y.shape=w.shape,y=this.packedReshape(y,I),c.push(y),w=this.texData.get(y.dataId),v.shape=I}return{shape:y.shape,texData:w,isUniform:!1}});this.uploadToGPU(a.dataId);const h={shape:a.shape,texData:l,isUniform:!1},d=Wge(e,u,h),p=this.getAndSaveBinary(d,()=>jge(this.gpgpu,e,u,h)),f=this.activeTimers!=null;let g;f&&(g=this.startTimer()),X().get("ENGINE_COMPILE_ONLY")||Uge(this.gpgpu,p,u,h,r),c.forEach(y=>this.disposeIntermediateTensorInfo(y)),f&&(g=this.endTimer(g),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(g)}));const m=X().getNumber("WEBGL_FLUSH_THRESHOLD");if(m>0){const y=Jn();y-this.lastGlFlushTime>m&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!X().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){const y=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),y}return a}compileAndRun(e,t,s,r,i=!1){return s=s||t[0].dtype,this.runWebGLProgram(e,t,s,r,i)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(X().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Y(()=>{if(!X().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=X().getBool("DEBUG");X().set("DEBUG",!1);const t=this.abs(Ue(1e-8)).dataSync()[0];if(X().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?cbe:ube}uploadToGPU(e){const t=this.texData.get(e),{shape:s,dtype:r,values:i,texture:o,usage:a,isPacked:l}=t;if(o!=null)return;const c=this.activeTimers!=null;let u;c&&(u=Jn());let h=t.texShape;if(h==null&&(h=FV(s,l),t.texShape=h),i!=null){const d=qd(s);let p,f=h[1],g=h[0];const m=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(l||!m)&&([f,g]=Xh(h[0],h[1])),l?p=new Yge(d,m):p=new w2(d,m);const y=m?[g,f]:h,w=this.makeTensorInfo(y,r),v=this.texData.get(w.dataId);m?v.usage=wr.PIXELS:v.usage=wr.UPLOAD,v.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),f,g,i);const I=[[g,f]],_=!0,N=this.runWebGLProgram(p,[w],r,I,_),T=this.texData.get(N.dataId);t.texShape=T.texShape,t.isPacked=T.isPacked,t.usage=T.usage,X().get("ENGINE_COMPILE_ONLY")?this.disposeData(N.dataId):(t.texture=T.texture,t.values=null,this.texData.delete(N.dataId)),this.disposeIntermediateTensorInfo(w),c&&(this.uploadWaitMs+=Jn()-u)}else{const d=this.acquireTexture(h,a,r,l);t.texture=d}}convertAndCacheOnCPU(e,t){const s=this.texData.get(e),{dtype:r}=s;return t!=null&&(s.values=mbe(t,r)),s.values}acquireTexture(e,t,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*Pp(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(t),r(!0)}catch(i){throw i}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await jT(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(t_(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:s,infLoc:r,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=qV(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=i,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,t,s){e.channels=e.channels||"RGBA";const{texture:r,height:i,width:o,channels:a}=e,l=Jr().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const c=l.writeTexture(r,t,s,i,o,a);return Jr().makeTensorFromDataId(c,t,s,l)}}ig.nextDataId=0;function mbe(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<t.length;++s)t[s]=Math.round(n[s]);return t}else throw new Error(`Unknown dtype ${e}`)}/** @license See the LICENSE file. */const mB="4.11.0";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gB(){X().set("WEBGL_FORCE_F16_TEXTURES",!0)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */lk()&&gk("webgl",()=>new ig,2);const gbe={forceHalfFloat:gB};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h_=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class tc{constructor(e,t,s){this.variableNames=["A","B"],this.outputShape=tt(t,s),this.enableShapeUniforms=ys(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sc=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class td{constructor(e,t,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=tt(t,s);const i=this.outputShape.length;this.enableShapeUniforms=ys(i);let o="";if(r)if(i===0||re(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${Ut(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=Ts("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ur(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const ybe={kernelName:oh,backendName:"webgl",kernelFunc:ur};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ka(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,i=t.makeTensorInfo(s.shape,"complex64"),o=t.texData.get(i.dataId),a=ur({inputs:{x:s},backend:t}),l=ur({inputs:{x:r},backend:t});return o.complexTensorInfos={real:a,imag:l},i}const bbe={kernelName:Ix,backendName:"webgl",kernelFunc:Ka};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yB="return (a < 0.) ? b * a : a;",bB=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function xbe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:i}=s,o=t.makeTensorInfo([],"float32",Po(i,"float32")),a=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new td(bB,r.shape,o.shape):new tc(yB,r.shape,o.shape),l=t.runWebGLProgram(a,[r,o],"float32");return t.disposeIntermediateTensorInfo(o),l}const wbe={kernelName:Bf,backendName:"webgl",kernelFunc:xbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xB="return (a < 0.) ? b * a : a;",wB=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function vbe(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e,i=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new td(wB,s.shape,r.shape):new tc(xB,s.shape,r.shape);return t.runWebGLProgram(i,[s,r],"float32")}const Ibe={kernelName:om,backendName:"webgl",kernelFunc:vbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nd="if (isnan(x)) return x;";function $t({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:s}){return({inputs:r,backend:i})=>{const{x:o}=r,a=i,l=s||o.dtype;if(a.shouldExecuteOnCPU([o])&&t!=null){const h=a.texData.get(o.dataId),d=t(h.values,l);return a.makeTensorInfo(o.shape,l,d)}const c=X().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let u;return c?u=new ha(o.shape,e):u=new Oi(o.shape,n),a.runWebGLProgram(u,[o],l)}}function hs({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:i}){return({inputs:o,backend:a})=>{const{a:l,b:c}=o,u=a;if(s&&l.dtype==="complex64"){const f=u.texData.get(l.dataId),g=u.texData.get(c.dataId),[m,y]=[[f.complexTensorInfos.real,g.complexTensorInfos.real],[f.complexTensorInfos.imag,g.complexTensorInfos.imag]].map(v=>{const[I,_]=v,N={dataId:I.dataId,dtype:I.dtype,shape:l.shape},T={dataId:_.dataId,dtype:_.dtype,shape:c.shape},E=new tc(n,l.shape,c.shape);return u.runWebGLProgram(E,[N,T],Ws(I.dtype,_.dtype))}),w=Ka({inputs:{real:m,imag:y},backend:u});return u.disposeIntermediateTensorInfo(m),u.disposeIntermediateTensorInfo(y),w}const h=i||Ws(l.dtype,c.dtype);if((l.dtype==="string"||c.dtype==="string"||u.shouldExecuteOnCPU([l,c]))&&r!=null){const f=u.texData.get(l.dataId).values,g=u.texData.get(c.dataId).values,m=l.dtype==="string"?Eo(f):f,y=l.dtype==="string"?Eo(g):g,[w,v]=r(l.shape,c.shape,m,y,h),I=u.makeTensorInfo(v,h),_=u.texData.get(I.dataId);return _.values=w,I}const d=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let p;return d?p=new td(e,l.shape,c.shape,t):p=new tc(n,l.shape,c.shape),u.runWebGLProgram(p,[l,c],h)}}function Qp(n,e=!1){if(n==="linear")return e?nbe:Qye;if(n==="relu")return e?rbe:Jye;if(n==="elu")return e?sbe:Zye;if(n==="relu6")return e?ibe:ebe;if(n==="prelu")return e?wB:xB;if(n==="leakyrelu")return e?bB:yB;if(n==="sigmoid")return e?obe:tbe;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vB{constructor(e,t,s,r=!1,i=!1,o=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=ys(this.outputShape.length);const u=r?e[1]:e[2],h=Math.ceil(u/2),d=r?"i * 2, rc.y":"rc.y, i * 2",p=i?"rc.z, i * 2":"i * 2, rc.z",f=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],g=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let m="",y="";a&&(l?m=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?m=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:m=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");const w=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let v="rc.x",I="rc.x";e[0]<t[0]?v=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(I=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${m}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${h}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${v};
        int batchB = ${I};
        for (int i = 0; i < ${h}; i++) {
          vec4 a = getMatrixA(batchA, ${d});
          vec4 b = getMatrixB(batchB, ${p});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${f[0]} * ${g[0]});
          result += (${f[1]} * ${g[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${w}

        ${y}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T2={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class C2{constructor(e,t,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=tt(t,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E2="return a * b;";function d_(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,i=Ws(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=t.texData.get(s.dataId),l=t.texData.get(r.dataId),c=new C2(T2.REAL,s.shape,r.shape),u=new C2(T2.IMAG,s.shape,r.shape),h=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],d=t.runWebGLProgram(c,h,"float32"),p=t.runWebGLProgram(u,h,"float32"),f=Ka({inputs:{real:d,imag:p},backend:t});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),f}if(t.shouldExecuteOnCPU([s,r])){const a=t.texData.get(s.dataId),l=t.texData.get(r.dataId),[c,u]=wye(s.shape,r.shape,a.values,l.values,i),h=t.makeTensorInfo(u,i),d=t.texData.get(h.dataId);return d.values=c,h}let o;return X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new td(E2,s.shape,r.shape):o=new tc(E2,s.shape,r.shape),t.runWebGLProgram(o,[s,r],i)}const Sbe={kernelName:mh,backendName:"webgl",kernelFunc:d_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kbe(n,e,t){const s=[Jl(n.shape),...ec(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},i=[Jl(e),...ec(e)],o=new fB(i,s),a=!0,l=[s],c=t.runWebGLProgram(o,[r],n.dtype,l,a);return{dataId:c.dataId,shape:e,dtype:c.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Se(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:i}=s,o=t,a=re(r.shape),l=ek(i,a),c=re(l);O(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const u=o.texData.get(r.dataId);return u.isPacked&&!Yp(r.shape,l)&&!(u.texture!==null&&Yp(u.shape,l))?kbe(r,l,o):(o.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const Tbe={kernelName:lm,backendName:"webgl",kernelFunc:Se};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _2{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];const a=Math.floor(s/4)*4,l=s%4;let c="sumValue += dot(values, ones);";if(t!=null){const h=1/t;c=`sumValue += dot(values * ${Ml(h)?h.toPrecision(2):h}, ones);`}let u="";i%s>0&&(u=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cbe{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];let a="0.0",l="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",l="min"):t==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?c="sumValue":t==="prod"?c="prodValue":t==="all"?c="allValue":t==="any"&&(c="anyValue");const u=Math.floor(s/4)*4,h=s%4;let d=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,p="vec4";t==="all"?(a="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):t==="any"&&(a="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");let f="";i%s>0&&(f=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${d}
        }

        int inIdx = inOffset + ${u};
        if (${h===1}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${d}
        } else if (${h===2}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${d}
        } else if (${h===3}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${d}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ebe(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],s=a0(t);e.push({inSize:t,windowSize:s,outSize:Math.ceil(t/s)})}return e}function kc(n,e,t,s){const r=Ebe(n.shape);let i=n;for(let o=0;o<r.length;o++){const{inSize:a,windowSize:l,outSize:c}=r[o];let u,h;t==="mean"?u=o===0?new _2({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:c},a):new _2({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:c}):u=new Cbe({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:c},t),h=i,i=s.runWebGLProgram(u,[i],e),h.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(h)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _be{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[t[o]];this.outputShape=s,this.rank=s.length;const r=Ut(this.rank),i=Nbe(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function Nbe(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<n.length;r++)s[n[r]]=t[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Abe{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let u=0;u<s.length;u++)s[u]=e[t[u]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=Ut(this.rank),i=pB("rc",this.rank),o=new Array(this.rank);for(let u=0;u<t.length;u++)o[t[u]]=i[u];const a=`vec2(${o.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${s[this.rank-1]}`,c=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D0(n,e,t){const s=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Abe(n.shape,e):new _be(n.shape,e);return t.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rbe(n,e,t,s){const r=e,i=n.shape.length,o=ft(r,n.shape);let a=o;const l=pn(a,i),c=l!=null;let u=n;c&&(u=D0(n,l,s),a=vn(a.length,i)),cs("sum",a,i);const[h,d]=Xn(u.shape,a);let p=h;t&&(p=wn(h,o));const f=re(d),m=re(n.shape)/f,y=Se({inputs:{x:u},attrs:{shape:[m,f]},backend:s}),w=Iw(n.dtype),v=kc(y,w,"sum",s),I=Se({inputs:{x:v},attrs:{shape:p},backend:s});return s.disposeIntermediateTensorInfo(y),s.disposeIntermediateTensorInfo(v),c&&s.disposeIntermediateTensorInfo(u),I}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P0(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;return Rbe(r,i,o,t)}const $be={kernelName:fm,backendName:"webgl",kernelFunc:P0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _s(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{perm:i}=s,o=t,a=r.shape.length,l=new Array(a);for(let u=0;u<l.length;u++)l[u]=r.shape[i[u]];let c;if(o.shouldExecuteOnCPU([r])){const h=o.texData.get(r.dataId).values,d=u_(h,r.shape,r.dtype,i,l);c=o.makeTensorInfo(l,r.dtype);const p=o.texData.get(c.dataId);p.values=d}else c=D0(r,i,o);return c}const Dbe={kernelName:Al,backendName:"webgl",kernelFunc:_s};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IB=1e3;function Nb({a:n,b:e,transposeA:t,transposeB:s,backend:r,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const c=n.shape.length,u=e.shape.length,h=t?n.shape[c-2]:n.shape[c-1],d=s?e.shape[u-1]:e.shape[u-2],p=t?n.shape[c-1]:n.shape[c-2],f=s?e.shape[u-2]:e.shape[u-1],g=n.shape.slice(0,-2),m=e.shape.slice(0,-2),y=re(g),w=re(m),I=tt(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([p,f]);O(h===d,()=>`Error in matMul: inner shapes (${h}) and (${d}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${s} must match.`);const _=t?[y,h,p]:[y,p,h],N=s?[w,f,d]:[w,d,f],T=Se({inputs:{x:n},backend:r,attrs:{shape:_}}),E=Se({inputs:{x:e},backend:r,attrs:{shape:N}}),k=[T,E],S=Math.max(y,w),A=t?T.shape[1]:T.shape[2],P=i!=null,D=o!=null,V=l==="leakyrelu",U=l!=null?Qp(l,!0):null,q=P||D||V||U!=null;let J;if((p===1||f===1)&&A>IB&&q===!1){let ee=T,L=E;t&&(ee=_s({inputs:{x:T},backend:r,attrs:{perm:[0,2,1]}}),k.push(ee)),s&&(L=_s({inputs:{x:E},backend:r,attrs:{perm:[0,2,1]}}),k.push(L));const ae=f!==1,ce=f===1;let z=ee;ae&&(z=Se({inputs:{x:ee},backend:r,attrs:{shape:[S,A,1]}}),k.push(z));const ue=f===1?2:1;let de=L;ce&&(de=Se({inputs:{x:L},backend:r,attrs:{shape:[S,1,A]}}),k.push(de));const be=d_({inputs:{a:z,b:de},backend:r});J=P0({inputs:{x:be},backend:r,attrs:{axis:ue,keepDims:!0}}),k.push(be)}else{const ee=Ws(n.dtype,e.dtype),L=new vB(_,N,[S,p,f],t,s,P,U,D,V),ae=[T,E];if(i!=null&&ae.push(i),D&&ae.push(o),V){const ce=r.makeTensorInfo([],"float32",Po(a,"float32"));ae.push(ce),k.push(ce)}J=r.runWebGLProgram(L,ae,ee)}const K=Se({inputs:{x:J},backend:r,attrs:{shape:I}});k.push(J);for(const ee of k)r.disposeIntermediateTensorInfo(ee);return K}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pbe(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:h}=s;return Nb({a:r,b:i,transposeA:l,transposeB:c,backend:t,bias:o,preluActivationWeights:a,leakyreluAlpha:h,activation:u})}const Obe={kernelName:Op,backendName:"webgl",kernelFunc:Pbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N2="return abs(x);";function Fbe(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const i=t.texData.get(s.dataId),o=hB(i.values);return t.makeTensorInfo(s.shape,s.dtype,o)}let r;return X().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new ha(s.shape,N2):r=new Oi(s.shape,N2),t.runWebGLProgram(r,[s],s.dtype)}const Lbe={kernelName:xf,backendName:"webgl",kernelFunc:Fbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mbe=Kr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,zbe=$t({opSnippet:Mbe}),Vbe={kernelName:Vu,backendName:"webgl",kernelFunc:zbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bbe=Kr+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,jbe=$t({opSnippet:Bbe}),Ube={kernelName:Bu,backendName:"webgl",kernelFunc:jbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A2="return a + b;",Wbe=hs({opSnippet:A2,packedOpSnippet:A2,supportsComplex:!0,cpuKernelImpl:Jge}),Gbe={kernelName:hc,backendName:"webgl",kernelFunc:Wbe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hbe{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`float v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qbe{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`vec4 v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ky(n){const{inputs:e,backend:t}=n,s=e;if(s.length===1)return ur({inputs:{x:s[0]},backend:t});if(s.length>X().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),c=ky({inputs:s.slice(0,l),backend:t}),u=ky({inputs:s.slice(l),backend:t});return ky({inputs:[c,u],backend:t})}const r=s.map(l=>l.dtype).reduce((l,c)=>Ws(l,c)),i=s.map(l=>l.shape),a=X().getBool("WEBGL_PACK")?new qbe(s[0].shape,i):new Hbe(s[0].shape,i);return t.runWebGLProgram(a,s,r)}const Kbe={kernelName:wf,backendName:"webgl",kernelFunc:ky};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xbe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=ft(i,r.shape);let c=l;const u=pn(c,a);let h=r;u!=null&&(h=_s({inputs:{x:r},backend:t,attrs:{perm:u}}),c=vn(c.length,a)),cs("all",c,a);const[d,p]=Xn(h.shape,c),f=re(p),g=Se({inputs:{x:h},backend:t,attrs:{shape:[-1,f]}}),m=kc(g,g.dtype,"all",t);let y;if(o){const w=wn(d,l);y=Se({inputs:{x:m},backend:t,attrs:{shape:w}})}else y=Se({inputs:{x:m},backend:t,attrs:{shape:d}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(m),u!=null&&t.disposeIntermediateTensorInfo(h),y}const Ybe={kernelName:gx,backendName:"webgl",kernelFunc:Xbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qbe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=ft(i,r.shape);let c=l;const u=pn(c,a);let h=r;u!=null&&(h=_s({inputs:{x:r},backend:t,attrs:{perm:u}}),c=vn(c.length,a)),cs("any",c,a);const[d,p]=Xn(h.shape,c),f=re(p),g=Se({inputs:{x:h},backend:t,attrs:{shape:[-1,f]}}),m=kc(g,g.dtype,"any",t);let y;if(o){const w=wn(d,l);y=Se({inputs:{x:m},backend:t,attrs:{shape:w}})}else y=Se({inputs:{x:m},backend:t,attrs:{shape:d}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(m),u!=null&&t.disposeIntermediateTensorInfo(h),y}const Zbe={kernelName:yx,backendName:"webgl",kernelFunc:Qbe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jbe{constructor(e,t,s){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:o}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a=t==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class exe{constructor(e,t,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,O(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],o=Math.ceil(i/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,c=Ut(l),u=Ts("coords",l);let h,d;if(o===1){d=l+1;const E=Ut(d);h=`
        ${E} sourceLocR = ${E}(${u.join()}, 0);
        ++${u[l-1]};
        ${E} sourceLocG = ${E}(${u.join()}, 0);
        ++${u[l-2]};
        ${E} sourceLocA = ${E}(${u.join()}, 0);
        --${u[l-1]};
        ${E} sourceLocB = ${E}(${u.join()}, 0);
        --${u[l-2]};`}else d=l,h=`
        ${c} sourceLocR = coords;
        ++${u[l-1]};
        ${c} sourceLocG = coords;
        ++${u[l-2]};
        ${c} sourceLocA = coords;
        --${u[l-1]};
        ${c} sourceLocB = coords;
        --${u[l-2]};`;const p=["x","y","z","w","u","v"].slice(0,d),f="."+p[d-1],g=p.map(E=>"int "+E),m=Ts("sourceLocR",d-1).concat("inIdx.r"),y=Ts("sourceLocG",d-1).concat("inIdx.g"),w=Ts("sourceLocB",d-1).concat("inIdx.b"),v=Ts("sourceLocA",d-1).concat("inIdx.a"),I=s==="max"?"greaterThan":"lessThan",_=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${m.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${w.join()}),
                             getBestIndicesAChannel(${v.join()})));`,N=`vec4(
            getAChannel(${m.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${w.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${v.join()}) : 0.)`,T=r?"":`
      float getBestIndicesAChannel(${g.join()}) {
        return getChannel(getBestIndicesA(${p.join()}),
                                          vec2(${p.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${g.join()}) {
        return getChannel(getA(${p.join()}),
                               vec2(${p.slice(-2).join()}));
      }
      ${T}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${u[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${u[l-2]} < ${a[l-2]-1};
        ${h}
        ivec4 srcIdx = ivec4(sourceLocR${f}, sourceLocG${f},
          sourceLocB${f}, sourceLocA${f}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${N};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${_}
          vec4 candidate = ${N};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${I}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SB(n,e,t,s=null){let r=e.shape[0],i=e.shape[1];s!=null&&(r=s.shape[0],i=s.shape[1]);const o=a0(i),a={windowSize:o,inSize:i,batchSize:r,outSize:Math.ceil(i/o)},l=new Jbe(a,t,s==null),c=[e];s!=null&&c.push(s);const u=n.runWebGLProgram(l,c,"int32");if(u.shape[1]===1)return u;const h=SB(n,e,t,u);return n.disposeIntermediateTensorInfo(u),h}function kB(n,e,t,s=null){const r=s!=null?s.shape:e.shape,i=r[r.length-1],o=a0(i),a=new exe(r,o,t,s==null),l=s==null?[e]:[e,s],c=n.runWebGLProgram(a,l,"int32");if(c.shape.length===e.shape.length){const u=kB(n,e,t,c);return n.disposeIntermediateTensorInfo(c),u}return c}function TB(n,e,t,s){const r=[t];if(cs("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!X().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],o=n.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=n.unpackTensor(e),i.push(l));const[c,u]=Xn(l.shape,r),h=re(u),d=Se({inputs:{x:l},backend:n,attrs:{shape:[-1,h]}});i.push(d);const p=SB(n,d,s);i.push(p);const f=Se({inputs:{x:p},backend:n,attrs:{shape:c}});return i.forEach(g=>n.disposeIntermediateTensorInfo(g)),f}return kB(n,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function txe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;let o=ft(i,r.shape);const a=pn(o,r.shape.length);let l=r;const c=[];a!=null&&(l=_s({inputs:{x:r},backend:t,attrs:{perm:a}}),c.push(l),o=vn(o.length,l.shape.length)),cs("argMax",[o[0]],l.shape.length);const u=TB(t,l,o[0],"max");return c.forEach(h=>t.disposeIntermediateTensorInfo(h)),u}const nxe={kernelName:vf,backendName:"webgl",kernelFunc:txe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sxe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;let o=ft(i,r.shape);const a=pn(o,r.shape.length);let l=r;const c=[];a!=null&&(l=_s({inputs:{x:r},backend:t,attrs:{perm:a}}),c.push(l),o=vn(o.length,l.shape.length)),cs("argMin",[o[0]],l.shape.length);const u=TB(t,l,o[0],"min");return c.forEach(h=>t.disposeIntermediateTensorInfo(h)),u}const rxe={kernelName:If,backendName:"webgl",kernelFunc:sxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ixe=Kr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,oxe=$t({opSnippet:ixe}),axe={kernelName:ju,backendName:"webgl",kernelFunc:oxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lxe=Kr+"return log(x + sqrt(x * x + 1.0));",cxe=$t({opSnippet:lxe}),uxe={kernelName:Uu,backendName:"webgl",kernelFunc:cxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hxe=Kr+`
  return atan(x);
`,dxe=$t({opSnippet:hxe}),pxe={kernelName:Wu,backendName:"webgl",kernelFunc:dxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fxe=h_+`
  return atan(a, b);
`,mxe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Sc+`
  return result;
`,gxe=hs({opSnippet:fxe,packedOpSnippet:mxe}),yxe={kernelName:Hu,backendName:"webgl",kernelFunc:gxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bxe=Kr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,xxe=$t({opSnippet:bxe}),wxe={kernelName:Gu,backendName:"webgl",kernelFunc:xxe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zp{constructor(e,t,s,r=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,p=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;const g=t==="avg",m=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,y=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let w="0.0";if(g||(w="-1.0 / 1e-20"),s){const E=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${p}, ${f});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${h};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${E} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?i?m:y:`wR * ${d} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const v="max";let I=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(I="avgValue / max(count, 1.0)");const _=Math.floor(o/4)*4,N=o%4,T=`
      if (${g}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${v}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${p}, ${f});
      const float initializationValue = ${w};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${w});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${h};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${_}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${T}
          }

          int xC = xCCorner + ${_};
          if (${N===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${T}
          } else if (${N===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${T}
          } else if (${N===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${T}
          }
        }
        setOutput(${I});
      }
    `}}class p_{constructor(e,t,s,r=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,c=e.strideWidth,u=e.dilationDepth,h=e.dilationHeight,d=e.dilationWidth,p=e.effectiveFilterDepth,f=e.effectiveFilterHeight,g=e.effectiveFilterWidth,m=e.padInfo.front,y=e.padInfo.top,w=e.padInfo.left;this.outputShape=e.outShape;const v=t==="avg";let I="0.0";if(v||(I="-1.0 / 1e-20"),s){const S=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${m}, ${y}, ${w});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${p};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${f};
                wR += ${h}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${g};
                  wC += ${d}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${S} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${f} * ${g} +
                      wR * ${g} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const _="max";let N=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(N="avgValue / max(count, 1.0)");const T=Math.floor(o/4)*4,E=o%4,k=`
      if (${v}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${_}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${m}, ${y}, ${w});
      const float initializationValue = ${I};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${I});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f};
            wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${T}; wC += 4) {
              int xC = xCCorner + wC * ${d};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                getValue(batch, xD, xR, xC + 2 * ${d}, ch),
                getValue(batch, xD, xR, xC + 3 * ${d}, ch)
              );

              ${k}
            }

            int xC = xCCorner + ${T};
            if (${E===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${k}
            } else if (${E===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                initializationValue,
                initializationValue
              );

              ${k}
            } else if (${E===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                getValue(batch, xD, xR, xC + 2 * ${d}, ch),
                initializationValue
              );

              ${k}
            }
          }
        }
        setOutput(${N});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vxe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Yh(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,c=1;O(ls(o,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=Hr(r.shape,i,o,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&wt(u.inShape,u.outShape))return ur({inputs:{x:r},backend:t});const h=new Zp(u,"avg",!1);return t.runWebGLProgram(h,[r],"float32")}const Ixe={kernelName:Sf,backendName:"webgl",kernelFunc:vxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sxe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=s,u=[1,1,1],h=Oo(r.shape,i,o,u,a,l,c),d=new p_(h,"avg",!1);return t.runWebGLProgram(d,[r],"float32")}const kxe={kernelName:kf,backendName:"webgl",kernelFunc:Sxe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Txe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=l-1-e.padInfo.top,h=c-1-e.padInfo.left,d=1/(t*s);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${h});
      const float avgMultiplier = float(${d});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class Cxe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,h=e.effectiveFilterDepth,d=e.effectiveFilterHeight,p=e.effectiveFilterWidth,f=h-1-e.padInfo.front,g=d-1-e.padInfo.top,m=p-1-e.padInfo.left,y=1/(t*s*r);this.userCode=`
      const ivec3 pads = ivec3(${f}, ${g}, ${m});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${d};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${p};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Exe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=s,h=[1,1,1],d=Oo(o.shape,a,l,h,c,u),p=new Cxe(d);return t.runWebGLProgram(p,[r],o.dtype)}const _xe={kernelName:xx,backendName:"webgl",kernelFunc:Exe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nxe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i;Yh([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=s,u=Hr(o.shape,a,l,1,c),h=new Txe(u);return t.runWebGLProgram(h,[r],o.dtype)}const Axe={kernelName:bx,backendName:"webgl",kernelFunc:Nxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rxe(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;return Nb({a:r,b:i,transposeA:o,transposeB:a,backend:t})}const $xe={kernelName:Tf,backendName:"webgl",kernelFunc:Rxe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dxe{constructor(e,t,s,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],tt(e,t),tt(e,s);let a="0.0";r!=null&&(tt(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(tt(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pxe{constructor(e,t,s,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],tt(e,t),tt(e,s);let a="vec4(0.0)";r!=null&&(tt(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(tt(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oxe=({inputs:n,backend:e,attrs:t})=>{const{x:s,mean:r,variance:i,offset:o,scale:a}=n;O(r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),O(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),O(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=t;l==null&&(l=.001);const c=[s,r,i];let u=null;o!=null&&(u=o.shape,c.push(o));let h=null;a!=null&&(h=a.shape,c.push(a));const d=X().getBool("WEBGL_PACK_NORMALIZATION")?new Pxe(s.shape,r.shape,i.shape,u,h,l):new Dxe(s.shape,r.shape,i.shape,u,h,l);return e.runWebGLProgram(d,c,c[0].dtype)},Fxe={kernelName:Mf,backendName:"webgl",kernelFunc:Oxe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lxe{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=Ut(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=Mxe(this.rank);let r;const i=e.map((o,a)=>`sourceLoc.${QI[a]} = start[${a}] + coords.${QI[a]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const QI=["x","y","z","w","u","v"];function Mxe(n){if(n===1)return"sourceLoc";if(n<=6)return QI.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zxe{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=Ut(this.rank),s=Ts("coords",this.rank),r=Ts("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${i})`,a=`
      result.x = ${o};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${o};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${o};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${o};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((u,h)=>`start[${h}]`).join()});`:e.map((u,h)=>`${r[h]} = ${s[h]} + start[${h}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vxe(n,e,t,s){const r=s.texData.get(n.dataId),i=s.makeTensorInfo(t,n.dtype),o=s.texData.get(i.dataId);Object.assign(o,r),o.refCount=1,o.shape=t,o.dtype=n.dtype;let a=VT(e,Be(n.shape));r.slice&&(a+=r.slice.flatOffset),o.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||n.dataId};const l=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,l+1),i}function sd(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,size:o}=s,[a,l]=o0(r,i,o);if(LT(r,a,l),re(l)===0)return t.makeTensorInfo(l,r.dtype,[]);if(t.shouldExecuteOnCPU([r])||r.dtype==="string"){const h=t.texData.get(r.dataId),d=Rye(h.values,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,d)}const{isPacked:c}=t.texData.get(r.dataId),u=zT(r.shape,a,l);if(c||!u){const h=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zxe(l):new Lxe(l),d=[a];return t.runWebGLProgram(h,[r],r.dtype,d)}return t.uploadToGPU(r.dataId),Vxe(r,a,l,t)}const Bxe={kernelName:pm,backendName:"webgl",kernelFunc:sd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jxe=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,crops:o}=s;O(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((w,v)=>w*v),l=jm(r.shape,i,a),c=Um(l.length,i.length),u=Wm(r.shape,i,a),h=HT(o,i.length),d=qT(u,o,i.length),p=[],f=Se({inputs:{x:r},backend:t,attrs:{shape:l}}),g=_s({inputs:{x:f},backend:t,attrs:{perm:c}}),m=Se({inputs:{x:g},backend:t,attrs:{shape:u}}),y=sd({inputs:{x:m},backend:t,attrs:{begin:h,size:d}});return p.push(f),p.push(g),p.push(m),p.forEach(w=>t.disposeIntermediateTensorInfo(w)),y},Uxe={kernelName:Cf,backendName:"webgl",kernelFunc:jxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wxe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o}=s,a=t.readSync(r.dataId),l=t.readSync(i.dataId),c=uB(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}const Gxe={kernelName:wx,backendName:"webgl",kernelFunc:Wxe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hxe=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,qxe=`
  return float(int(a.r) & int(b.r));
`;function Kxe(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,i=X().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=X().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([s,r])||o===1){const l=t.texData.get(s.dataId).values,c=t.texData.get(r.dataId).values,[u,h]=tye(s.shape,r.shape,l,c,s.dtype),d=t.makeTensorInfo(h,s.dtype),p=t.texData.get(d.dataId);return p.values=u,d}let a;return i?a=new td(Hxe,s.shape,r.shape,!1):a=new tc(qxe,s.shape,r.shape),t.runWebGLProgram(a,[s,r],s.dtype)}const Xxe={kernelName:Ef,backendName:"webgl",kernelFunc:Kxe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yxe(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,i=t.readSync(s.dataId),o=t.readSync(r.dataId),a=tt(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const Qxe={kernelName:vx,backendName:"webgl",kernelFunc:Yxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zxe="return float(a != b);",CB=hs({opSnippet:Zxe,cpuKernelImpl:Iye,dtype:"bool"}),Jxe={kernelName:tm,backendName:"webgl",kernelFunc:CB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function og(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return ur({inputs:{x:r.complexTensorInfos.real},backend:t})}const ewe={kernelName:tw,backendName:"webgl",kernelFunc:og};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const twe="return float(int(x));";function nwe(n,e){const t=new Oi(n.shape,twe),s=e.runWebGLProgram(t,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZI(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return ur({inputs:{x:r},backend:t});const o=En(r.shape),a=ZI({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),l=Ka({inputs:{real:a,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const o=og({inputs:{input:r},backend:t}),a=ZI({inputs:{x:o},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(o),a}if(!tk(r.dtype,i)){const o=ur({inputs:{x:r},backend:t});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(t.shouldExecuteOnCPU([r])){const o=t.texData.get(r.dataId).values,[a,l,c]=nye(o,r.shape,r.dtype,i);return t.makeTensorInfo(a,l,c)}if(i==="int32")return nwe(r,t);if(i==="bool"){const o=t.makeTensorInfo([],"bool",Hn("bool",1)),l=CB({inputs:{a:r,b:o},backend:t});return t.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${i}`)}const swe={kernelName:qu,backendName:"webgl",kernelFunc:ZI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R2="return ceil(x);",rwe=$t({opSnippet:R2,packedOpSnippet:R2,cpuKernelImpl:sye}),iwe={kernelName:Ku,backendName:"webgl",kernelFunc:rwe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class owe{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class awe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lwe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{clipValueMin:i,clipValueMax:o}=s;let a;X().getBool("WEBGL_PACK_CLIP")?a=new awe(r.shape):a=new owe(r.shape);const l=[[i],[o]];return t.runWebGLProgram(a,[r],r.dtype,l)}const cwe={kernelName:Xu,backendName:"webgl",kernelFunc:lwe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uwe{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $2(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function hwe(n){const{inputs:e,backend:t}=n,{x:s}=e,r=t.texData.get(s.dataId),i=new uwe(s.shape),o=[$2(s,r.complexTensorInfos.real),$2(s,r.complexTensorInfos.imag)];return t.runWebGLProgram(i,o,o[0].dtype)}const dwe={kernelName:_f,backendName:"webgl",kernelFunc:hwe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pwe{constructor(e){this.outputShape=[],this.outputShape=zi(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let o=1;o<t.length;o++)t[o]=t[o-1]+e[o][1];const s=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<t.length;o++){const a=t[o-1];s.push(`else if (yC < ${t[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const r=t.length,i=t[t.length-1];s.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fwe{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=zi(e,t);const s=this.outputShape,r=s.length,i=Ut(r),o=Ts("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((g,m)=>`T${m}`);const l=new Array(e.length-1);l[0]=e[0][t];for(let g=1;g<l.length;g++)l[g]=l[g-1]+e[g][t];const c=a[t],u=a.slice(-2),h=a.join();let d=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${h}), vec2(${u.join()}));
        }`;for(let g=1;g<l.length;g++){const m=l[g-1];d+=`
        if (${c} < ${l[g]}  && ${c} >= ${l[g-1]}) {
          return getChannel(
            getT${g}(${Kg(a,c,m)}),
            vec2(${Kg(u,c,m)}));
        }`}const p=l.length,f=l[l.length-1];d+=`
        return getChannel(
          getT${p}(${Kg(a,c,f)}),
          vec2(${Kg(u,c,f)}));`,this.userCode=`
      float getValue(${a.map(g=>"int "+g)}) {
        ${d}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[r-1]} = ${o[r-1]} + 1;
        if (${o[r-1]} < ${s[r-1]}) {
          result.g = getValue(${o});
        }

        ${o[r-2]} = ${o[r-2]} + 1;
        if (${o[r-2]} < ${s[r-2]}) {
          result.a = getValue(${o});
        }

        ${o[r-1]} = ${o[r-1]} - 1;
        if (${o[r-2]} < ${s[r-2]} &&
            ${o[r-1]} < ${s[r-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function Kg(n,e,t){const s=n.indexOf(e);return n.map((i,o)=>o===s?`${i} - ${t}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O0(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return ur({inputs:{x:r.complexTensorInfos.imag},backend:t})}const mwe={kernelName:Bx,backendName:"webgl",kernelFunc:O0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kd(n,e,t){const s=n[0].dtype;if(s==="complex64"){const p=n.map(w=>og({inputs:{input:w},backend:t})),f=n.map(w=>O0({inputs:{input:w},backend:t})),g=Kd(p,e,t),m=Kd(f,e,t),y=Ka({inputs:{real:g,imag:m},backend:t});return p.forEach(w=>t.disposeIntermediateTensorInfo(w)),f.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(m),y}let r=t.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const p=n.map(I=>{const N=[-1,re(I.shape.slice(e))];return Se({inputs:{x:I},backend:t,attrs:{shape:N}})}),f=p.map(I=>({vals:t.readSync(I.dataId),shape:I.shape})),g=zi(p.map(I=>I.shape),1),m=p[0].shape[0]===1,y=rye(f,g,s,m),w=zi(n.map(I=>I.shape),e),v=t.makeTensorInfo(w,s,y);return p.forEach(I=>t.disposeIntermediateTensorInfo(I)),v}const i=n.filter(p=>re(p.shape)>0),o=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const p=o?new Oi(n[0].shape,ta):new ha(n[0].shape,ta);return t.runWebGLProgram(p,n,s)}const a=X().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){const p=[];for(let g=0;g<i.length;g+=a){const m=i.slice(g,g+a);p.push(Kd(m,e,t))}const f=Kd(p,e,t);for(const g of p)t.disposeIntermediateTensorInfo(g);return f}if(o){const p=new fwe(i.map(f=>f.shape),e);return t.runWebGLProgram(p,i,s)}const{tensors2D:l,outShape:c}=gwe(i,e,t),u=new pwe(l.map(p=>p.shape)),h=t.runWebGLProgram(u,l,s);l.forEach(p=>t.disposeIntermediateTensorInfo(p));const d=Se({inputs:{x:h},attrs:{shape:c},backend:t});return t.disposeIntermediateTensorInfo(h),d}function gwe(n,e,t){const s=zi(n.map(i=>i.shape),e);return{tensors2D:n.map(i=>Se({inputs:{x:i},attrs:{shape:[-1,re(i.shape.slice(e))]},backend:t})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EB(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,i=ft(r,e[0].shape)[0],o=e.map(c=>c.shape);UT(o,i);const a=zi(e.map(c=>c.shape),i);if(re(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(c=>re(c.shape)>0);return l.length===1?ur({inputs:{x:l[0]},backend:t}):Kd(l,i,t)}const ywe={kernelName:Nf,backendName:"webgl",kernelFunc:EB};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _B{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,u=e.dilationHeight,h=e.dilationWidth,d=e.filterHeight,p=e.filterWidth,f=Math.floor(e.inChannels/4)*4,g=e.inChannels%4,m=e.dataFormat==="channelsLast",y=m?1:2,w=m?2:3,v=m?3:1;let I="",_="";s&&(r?I=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?I=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:I=`
          float activation(float x) {
            ${s}
          }
        `,_="result = activation(result);");const N=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${I}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${v}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${w}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${d}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${p}; wC++) {
            int xC = xCCorner + wC * ${h};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${f}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${m}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${g===1}) {

              if (${m}) {
                dotProd +=
                    getX(batch, xR, xC, ${f}) *
                    getW(wR, wC, ${f}, d2);
              } else {
                dotProd +=
                    getX(batch, ${f}, xR, xC) *
                    getW(wR, wC, ${f}, d2);
              }

            } else if (${g===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${f}, d2),
                getW(wR, wC, ${f} + 1, d2)
              );

              if (${m}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${f}),
                  getX(batch, xR, xC, ${f} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${f}, xR, xC),
                  getX(batch, ${f} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${g===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${f}, d2),
                getW(wR, wC, ${f} + 1, d2),
                getW(wR, wC, ${f} + 2, d2)
              );

              if (${m}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${f}),
                  getX(batch, xR, xC, ${f} + 1),
                  getX(batch, xR, xC, ${f} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${f}, xR, xC),
                  getX(batch, ${f} + 1, xR, xC),
                  getX(batch, ${f} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${N}
        ${_}
        setOutput(result);
      }
    `}}class bwe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,h=e.filterDepth,d=e.filterHeight,p=e.filterWidth,f=Math.floor(e.inChannels/4)*4,g=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${a});
      const ivec3 pads = ivec3(${t}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${h}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${d}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${f}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${g===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${f}) *
                  getW(wF, wR, wC, ${f}, d2);
              } else if (${g===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${f}),
                  getX(batch, xF, xR, xC, ${f} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${f}, d2),
                  getW(wF, wR, wC, ${f} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${g===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${f}),
                  getX(batch, xF, xR, xC, ${f} + 1),
                  getX(batch, xF, xR, xC, ${f} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${f}, d2),
                  getW(wF, wR, wC, ${f} + 1, d2),
                  getW(wF, wR, wC, ${f} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NB{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ys(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,u=e.filterWidth,h=u;let d=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let m=0;m<u;m++)d+=`
           vec4 xTexelC${m*2};
           int xTexelC${m*2}Ready;
           vec4 xTexelC${m*2+1};
           int xTexelC${m*2+1}Ready;
           vec4 xC${m};`;d+=`
     for (int r = 0; r < ${c}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let m=0;m<u;m++)d+=`
           xTexelC${m*2} = vec4(0.0);
           xTexelC${m*2}Ready = 0;
           xTexelC${m*2+1} = vec4(0.0);
           xTexelC${m*2+1}Ready = 0;
           xC${m} = vec4(0.0);`;d+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let m=0;m<(h+1)/2;m++){const y=m*2;if(d+=`
           xC = xCCorner + ${y*l};
           `,a===1){if(y<u&&(o%2===1?(d+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }
               `,l===1&&y>0?d+=`
                 xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                 `:d+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                   } else {
                     xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                   }
                   `):d+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xC${y} = xTexelC${y};
                 `,y+1<u)){const w=o%2===0?fx(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(d+=`
                   xCOffset = xC + imod(pads[1], 2) + ${w};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                     xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${y+1}.zw = vec2(0.0);
                     }
                     xTexelC${y+1}Ready = 1;
                   }
                   `,l>1?d+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                     } else {
                      xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                     }
                     `:d+=`
                     xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                     `):w===1?d+=`
                     xC${y+1} = xTexelC${y};
                     `:d+=`
                     xCOffset = xC + ${w};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                       xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${y+1}.zw = vec2(0.0);
                       }
                       xTexelC${y+1}Ready = 1;
                     }

                     xC${y+1} = xTexelC${y+1};
                     `}}else y<u&&(o%2===1?(d+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.0);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
               `,y+1<u&&(d+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                 `)):(d+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(
                   xTexelC${y}.xy, xTexelC${y+1}.xy);
               `,y+1<u&&(d+=`
                   xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                 `)));y<u&&(d+=`
             wTexel = getW(r, ${y}, d1, d2);
             dotProd += xC${y}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${y}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,y+1<u&&(d+=`
               wTexel = getW(r, ${y+1}, d1, d2);
               dotProd += xC${y+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${y+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}d+=`
     }
   `,d+=`
     }
   `,d+=`
     }
   `;let p="",f="";s&&(r?p=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:i?p=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:p=`vec4 activation(vec4 x) {
           ${s}
         }`,f="result = activation(result);");const g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${p}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${d}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${g}
         ${f}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xwe{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=ys(this.outputShape.length);const{dataFormat:s}=t,r=$s(),i=s==="channelsLast",o=i?1:2,a=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let c="";for(let u=0;u<=1;u++)for(let h=0;h<=1;h++)c+=`
          blockIndex = rc.z + ${h};
          pos = rc.y + ${u};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${u*2+h}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${u*2+h}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ab(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function AB({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const l=n.shape,c=s.texData.get(n.dataId),u=t.inChannels,h=l[0]*l[1]*l[2],d=t.outChannels,p=t.dataFormat==="channelsLast",f=!1,g=!1;let m;const y=[];if(i!=null){const I=Ab(i.shape,p);I!=null&&(i=Se({inputs:{x:i},backend:s,attrs:{shape:I}}),y.push(i))}if(r!=null){const I=Ab(r.shape,p);I!=null&&(r=Se({inputs:{x:r},backend:s,attrs:{shape:I}}),y.push(r))}if(!((h===1||d===1)&&u>IB)&&c.isPacked&&p&&c.texture!=null&&l[2]%2!==0&&wt(c.shape.slice(-3),l.slice(-3))){const I=l[0]*l[1]*(l[2]+1),_={dataId:n.dataId,shape:[1,I,t.inChannels],dtype:n.dtype},N=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,O(Yp(c.shape,_.shape),()=>`packed reshape ${c.shape} to ${_.shape} isn't free`);const T=Se({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}});y.push(T);const E=Nb({a:_,b:T,backend:s,transposeA:f,transposeB:g,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),k=s.texData.get(E.dataId);O(k.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=N,k.shape=t.outShape,m=ur({inputs:{x:E},backend:s}),m.shape=t.outShape,y.push(E)}else{const I=t.outHeight*t.outWidth,_=Se({inputs:{x:n},backend:s,attrs:{shape:p?[t.batchSize,I,t.inChannels]:[t.batchSize,t.inChannels,I]}}),N=Se({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}}),T=Nb({a:p?_:N,b:p?N:_,transposeA:!p,transposeB:g,backend:s,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o});m=Se({inputs:{x:T},backend:s,attrs:{shape:t.outShape}}),y.push(_),y.push(N),y.push(T)}for(const I of y)s.disposeIntermediateTensorInfo(I);return m}function RB({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:c,inChannels:u,outWidth:h,outHeight:d,dataFormat:p}=t,f=p==="channelsLast",g=l*c*u,m=d*h,y=[t.batchSize,g,m],w=!0,v=!1,I=[];if(i!=null){const K=Ab(i.shape,f);K!=null&&(i=Se({inputs:{x:i},backend:s,attrs:{shape:K}}),I.push(i))}if(r!=null){const K=Ab(r.shape,f);K!=null&&(r=Se({inputs:{x:r},backend:s,attrs:{shape:K}}),I.push(r))}const _=Se({inputs:{x:e},backend:s,attrs:{shape:[1,g,re(e.shape)/g]}});I.push(_);const N=new xwe(y,t),T=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],E=s.runWebGLProgram(N,[n],"float32",T),k=Se({inputs:{x:E},backend:s,attrs:{shape:y}});I.push(E),I.push(k);const S=r!=null,A=i!=null,P=a==="leakyrelu",D=a?Qp(a,!0):null,V=new vB(f?k.shape:_.shape,f?_.shape:k.shape,f?[t.batchSize,m,t.outChannels]:[t.batchSize,t.outChannels,m],w,v,S,D,A,P),U=f?[k,_]:[_,k];if(r&&U.push(r),A&&U.push(i),P){const K=s.makeTensorInfo([],"float32",Po(o,"float32"));U.push(K),I.push(K)}const q=s.runWebGLProgram(V,U,"float32"),J=Se({inputs:{x:q},backend:s,attrs:{shape:t.outShape}});I.push(q);for(const K of I)s.disposeIntermediateTensorInfo(K);return J}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wwe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=s,h=Fo(l),d=Kn(r.shape,i.shape,o,c,a,u,!1,h);let p;if(d.filterHeight===1&&d.filterWidth===1&&d.dilationHeight===1&&d.dilationWidth===1&&d.strideHeight===1&&d.strideWidth===1&&(d.padInfo.type==="SAME"||d.padInfo.type==="VALID"))p=AB({x:r,filter:i,convInfo:d,backend:t});else if(d.strideWidth<=2&&h==="channelsLast"&&X().getBool("WEBGL_EXP_CONV")){const g=new NB(d),m=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];p=t.runWebGLProgram(g,[r,i],"float32",m)}else if(X().getBool("WEBGL_CONV_IM2COL"))p=RB({x:r,filter:i,convInfo:d,backend:t});else{const g=new _B(d);p=t.runWebGLProgram(g,[r,i],"float32")}const f=Se({inputs:{x:p},backend:t,attrs:{shape:d.outShape}});return t.disposeIntermediateTensorInfo(p),f}const vwe={kernelName:Af,backendName:"webgl",kernelFunc:wwe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Iwe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Swe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,l=s-1-e.padInfo.left,c=o?1:2,u=o?2:3,h=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${h}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class kwe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Twe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=t-1-e.padInfo.front,c=s-1-e.padInfo.top,u=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cwe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=s,h=Fo(l),d=Kn(r.shape,u,o,1,a,c,!1,h),p=new Iwe(d);return t.runWebGLProgram(p,[r,i],"float32")}const Ewe={kernelName:Sx,backendName:"webgl",kernelFunc:Cwe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _we{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=ys(this.outputShape.length);const t=e.filterHeight,s=e.filterWidth,r=t-1-e.padInfo.top,i=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nwe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=s,h=Fo(c),d=Kn(o,i.shape,a,1,l,u,!1,h);if(X().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&h==="channelsLast"){const p=[[d.strideHeight,d.strideWidth]],f=new _we(d);return t.runWebGLProgram(f,[r,i],"float32",p)}else{const p=new Swe(d);return t.runWebGLProgram(p,[r,i],"float32")}}const Awe={kernelName:Rf,backendName:"webgl",kernelFunc:Nwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rwe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,c=Ba(r.shape,i.shape,o,l,a),u=new bwe(c);return t.runWebGLProgram(u,[r,i],"float32")}const $we={kernelName:$f,backendName:"webgl",kernelFunc:Rwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dwe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s,c=Ba(r.shape,l,o,1,a),u=new kwe(c);return t.runWebGLProgram(u,[r,i],"float32")}const Pwe={kernelName:kx,backendName:"webgl",kernelFunc:Dwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Owe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s,c=Ba(l,i.shape,a,1,o),u=new Twe(c);return t.runWebGLProgram(u,[r,i],"float32")}const Fwe={kernelName:Tx,backendName:"webgl",kernelFunc:Owe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lwe=nd+`
  return cos(x);
`,Mwe=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Sc}
  return result;
`,zwe=$t({opSnippet:Lwe,packedOpSnippet:Mwe}),Vwe={kernelName:Yu,backendName:"webgl",kernelFunc:zwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bwe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,jwe=$t({opSnippet:Bwe}),Uwe={kernelName:Qu,backendName:"webgl",kernelFunc:jwe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wwe{constructor(e,t,s,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,c]=e,[u]=t,[h,d]=s;this.outputShape=[u,h,d,c];const p=r==="bilinear"?1:0,[f,g]=[`${a-1}.0`,`${l-1}.0`],[m,y,w]=h>1?[`${(a-1)/(h-1)}`,"(y2-y1) * height_ratio",`y1*${f} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${f}`],[v,I,_]=d>1?[`${(l-1)/(d-1)}`,"(x2-x1) * width_ratio",`x1*${g} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${g}`];this.userCode=`
      const float height_ratio = float(${m});
      const float width_ratio = float(${v});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${I};

        float in_y = ${w};
        if( in_y < 0.0 || in_y > ${f} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${_};
        if( in_x < 0.0 || in_x > ${g} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${p} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gwe=n=>{const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=s,u=new Wwe(r.shape,i.shape,a,l,c);return t.runWebGLProgram(u,[r,i,o],"float32")},Hwe={kernelName:Ex,backendName:"webgl",kernelFunc:Gwe};var Jp;(function(n){n.Prod="*",n.Sum="+"})(Jp||(Jp={}));class D2{constructor(e,t,s,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===Jp.Prod?"1.0":"0.0",a=s?o:`getX(${P2(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let c="",u="";s?(c=r?`end != ${l-1}`:"end != 0",u=r?"end + 1":"end - 1"):(c=r?`end + pow2 < ${l}`:"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Ut(i)} coords = getOutputCoords();
        int end = ${O2(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${c}) {
          int idx = ${u};
          ${O2(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${P2(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function P2(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function O2(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $B(n,e,t,s,r,i){const o=e.shape.length,a=pn([s],o);let l=e;a!=null&&(l=_s({inputs:{x:e},backend:t,attrs:{perm:a}}));const c=vn(1,o)[0];if(c!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const u=l.shape[c];let h=ur({inputs:{x:l},backend:t});for(let d=0;d<=Math.ceil(Math.log2(u))-1;d++){const p=new D2(n,l.shape,!1,i),f=[[d]],g=h;h=t.runWebGLProgram(p,[h],h.dtype,f),t.disposeIntermediateTensorInfo(g)}if(r){const d=new D2(n,l.shape,r,i),p=h;h=t.runWebGLProgram(d,[h],h.dtype),t.disposeIntermediateTensorInfo(p)}if(a!=null){const d=ja(a),p=_s({inputs:{x:h},backend:t,attrs:{perm:d}});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(l),p}return h}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qwe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return $B(Jp.Prod,r,t,i,o,a)}const Kwe={kernelName:Cx,backendName:"webgl",kernelFunc:qwe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xwe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return $B(Jp.Sum,r,t,i,o,a)}const Ywe={kernelName:Df,backendName:"webgl",kernelFunc:Xwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qwe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=t.readSync(r.dataId),c=t.readSync(i.dataId),u=uB(l,c,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,u)}else if(r.shape.length===2){const l=t.bufferSync(r),c=t.bufferSync(i),u=eye(l,c,o,a);return t.makeTensorInfo(u.shape,i.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const Zwe={kernelName:_x,backendName:"webgl",kernelFunc:Qwe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jwe{constructor(e,t,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e0e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:i,dataFormat:o}=s,a=r.shape[0],l=o==="NHWC"?r.shape[1]:r.shape[2],c=o==="NHWC"?r.shape[2]:r.shape[3],u=o==="NHWC"?r.shape[3]:r.shape[1],h=l*i,d=c*i,p=u/(i*i),f=o==="NHWC"?[a,h,d,p]:[a,p,h,d],g=new Jwe(f,i,o);return t.runWebGLProgram(g,[r],r.dtype)}const t0e={kernelName:Nx,backendName:"webgl",kernelFunc:e0e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DB{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ys(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let c="",u="";s&&(r?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:c=`
          float activation(float x) {
            ${s}
          }
        `,u="result = activation(result);");const h=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${h}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PB{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ys(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,c=e.dilationWidth,u=e.filterHeight,h=e.filterWidth,d=h;let p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<h;y++)p+=`
          vec4 xTexelC${y*2};
          int xTexelC${y*2}Ready;
          vec4 xTexelC${y*2+1};
          int xTexelC${y*2+1}Ready;
          vec4 xC${y};`;p+=`
    for (int r = 0; r < ${u}; r++) {
      `;for(let y=0;y<h;y++)p+=`
          xTexelC${y*2} = vec4(0.0);
          xTexelC${y*2}Ready = 0;
          xTexelC${y*2+1} = vec4(0.0);
          xTexelC${y*2+1}Ready = 0;
          xC${y} = vec4(0.0);`;p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let y=0;y<(d+1)/2;y++){const w=y*2;if(p+=`
          xC = xCCorner + ${w*c};
          `,l===1){if(w<h&&(a%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }
              `,c===1&&w>0?p+=`
                xC${w} = vec4(xTexelC${w-2}.zw, xTexelC${w}.xy);
                `:p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${w} = vec4(previous.zw, xTexelC${w}.xy);
                  } else {
                    xC${w} = vec4(0.0, 0.0, xTexelC${w}.xy);
                  }
                  `):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xC${w} = xTexelC${w};
                `,w+1<h)){const v=a%2===0?fx(c):c;c%2===0&&a%2===1||c%2!==0&&a%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + ${v};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                    xTexelC${w+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${w+1}.zw = vec2(0.0);
                    }
                    xTexelC${w+1}Ready = 1;
                  }
                  `,c>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${w+1} = vec4(previous.zw, xTexelC${w+1}.xy);
                    } else {
                     xC${w+1} = vec4(0.0, 0.0, xTexelC${w+1}.xy);
                    }
                    `:p+=`
                    xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.xy);
                    `):v===1?p+=`
                    xC${w+1} = xTexelC${w};
                    `:p+=`
                    xCOffset = xC + ${v};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                      xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${w+1}.zw = vec2(0.0);
                      }
                      xTexelC${w+1}Ready = 1;
                    }

                    xC${w+1} = xTexelC${w+1};
                    `}}else w<h&&(a%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.0);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
              `,w+1<h&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${w+1} = vec4(xTexelC${w+1}.xy, final.xy);
                `)):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(
                  xTexelC${w}.xy, xTexelC${w+1}.xy);
              `,w+1<h&&(p+=`
                  xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
                `)));w<h&&(p+=`
            wTexel = getW(r, ${w}, d1, q);
            dotProd += xC${w} * vec4(wTexel.xz, wTexel.xz);
          `,w+1<h&&(p+=`
              wTexel = getW(r, ${w+1}, d1, q);
              dotProd += xC${w+1} * vec4(wTexel.xz, wTexel.xz);
            `))}p+=`
    }
  `,p+=`
      }
    `;let f="",g="";s&&(r?f=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?f=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:f=`vec4 activation(vec4 x) {
          ${s}
        }`,g="result = activation(result);");const m=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${f}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${p}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${m}
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n0e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:c}=s;let u=l;u==null&&(u=[1,1]),O(ls(o,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const h=Kn(r.shape,i.shape,o,u,a,c,!0);let d;X().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?d=new PB(h):d=new DB(h);const p=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return t.runWebGLProgram(d,[r,i],"float32",p)}const s0e={kernelName:Pf,backendName:"webgl",kernelFunc:n0e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class r0e{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class i0e{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o0e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=s,h=Kn(r.shape,u,o,a,l,c,!0),d=new r0e(h);return t.runWebGLProgram(d,[r,i],"float32")}const a0e={kernelName:Ax,backendName:"webgl",kernelFunc:o0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l0e(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=s,h=Kn(u,i.shape,o,a,l,c,!0),d=new i0e(h);return t.runWebGLProgram(d,[r,i],"float32")}const c0e={kernelName:Rx,backendName:"webgl",kernelFunc:l0e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class u0e{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h0e(n){const{inputs:e,backend:t}=n,{x:s}=e,r=[...s.shape,...s.shape],i=re(s.shape),o=Se({inputs:{x:s},backend:t,attrs:{shape:[i]}}),a=new u0e(i),l=t.runWebGLProgram(a,[o],o.dtype),c=Se({inputs:{x:l},backend:t,attrs:{shape:r}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),c}const d0e={kernelName:$x,backendName:"webgl",kernelFunc:h0e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p0e{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:s,padInfo:r,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:u}=e,{top:h,left:d}=r;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${h}, ${d});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f0e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,c=km(r.shape,i.shape,o,a,"NHWC",l);let u;const h=new p0e(c);u=t.runWebGLProgram(h,[r,i],"float32");const d=Se({inputs:{x:u},backend:t,attrs:{shape:c.outShape}});return t.disposeIntermediateTensorInfo(u),d}const m0e={kernelName:Of,backendName:"webgl",kernelFunc:f0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g0e(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=tC(r,i.length);sC(o.length,l,i);const{path:c,steps:u}=rC(a,l),h=u.length;let d=null,p=o.length;const f=[];for(let g=0;g<h;++g){for(const m of u[g]){const{permutationIndices:y,expandDims:w}=nC(p,l[m]);let v;iC(y)?v=i[m]:(v=_s({inputs:{x:i[m]},backend:t,attrs:{perm:y}}),f.push(v));const I=v.shape.slice();for(let _=0;_<w.length;++_)I.splice(w[_],0,1);wt(v.shape,I)||(v=Se({inputs:{x:v},backend:t,attrs:{shape:I}}),f.push(v)),d===null?d=v:(d=d_({inputs:{a:v,b:d},backend:t}),f.push(d))}g<h-1&&(c[g]>=0&&(d=P0({inputs:{x:d},backend:t,attrs:{axis:c[g]-(o.length-p),keepDims:!1}}),f.push(d)),p--)}for(const g of f)g!==d&&t.disposeIntermediateTensorInfo(g);return d}const y0e={kernelName:Px,backendName:"webgl",kernelFunc:g0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b0e="return (x >= 0.0) ? x : (exp(x) - 1.0);",x0e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,w0e=$t({opSnippet:b0e,packedOpSnippet:x0e}),v0e={kernelName:Ju,backendName:"webgl",kernelFunc:w0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I0e="return (b >= 0.0) ? a : a * (b + 1.0);",S0e=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,k0e=n=>{const{inputs:e,backend:t}=n,{dy:s,y:r}=e,i=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new td(S0e,s.shape,r.shape):new tc(I0e,s.shape,r.shape);return t.runWebGLProgram(i,[s,r],s.dtype)},T0e={kernelName:Ox,backendName:"webgl",kernelFunc:k0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C0e=`
  return vec4(equal(a, b));
`,E0e="return float(a == b);",_0e=hs({opSnippet:E0e,packedOpSnippet:C0e,dtype:"bool",cpuKernelImpl:iye}),N0e={kernelName:Ff,backendName:"webgl",kernelFunc:_0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A0e=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${KT};
  float a1 = ${XT};
  float a2 = ${YT};
  float a3 = ${QT};
  float a4 = ${ZT};
  float a5 = ${JT};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,R0e=$t({opSnippet:A0e}),$0e={kernelName:eh,backendName:"webgl",kernelFunc:R0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D0e=nd+`
  return exp(x);
`,P0e=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,OB=$t({opSnippet:D0e,packedOpSnippet:P0e,cpuKernelImpl:oye,dtype:"float32"}),O0e={kernelName:th,backendName:"webgl",kernelFunc:OB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JI(n){const{inputs:e,attrs:t,backend:s}=n,{dim:r}=t,{input:i}=e,o=i.shape.length,a=i.shape.slice();let l=r;return r<0&&(O(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+r+1),a.splice(l,0,1),Se({inputs:{x:i},backend:s,attrs:{shape:a}})}const F0e={kernelName:Lf,backendName:"webgl",kernelFunc:JI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F2="return exp(x) - 1.0;",L0e=$t({opSnippet:F2,packedOpSnippet:F2,cpuKernelImpl:aye}),M0e={kernelName:nh,backendName:"webgl",kernelFunc:L0e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L2{constructor(e,t,s){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const i=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FB(n,e,t){const s=t.texData.get(n.dataId),r=re(n.shape),i=n.shape[n.shape.length-1],o=r/i,a=Se({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),l=a.shape,c=new L2("real",l,e),u=new L2("imag",l,e),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],d=t.runWebGLProgram(c,h,"float32"),p=t.runWebGLProgram(u,h,"float32"),f=Ka({inputs:{real:d,imag:p},backend:t});t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p);const g=Se({inputs:{x:f},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(f),g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z0e(n){const{inputs:e,backend:t}=n,{input:s}=e;return FB(s,!1,t)}const V0e={kernelName:Fx,backendName:"webgl",kernelFunc:z0e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B0e{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ag(n){const{backend:e,attrs:t}=n,{shape:s,value:r}=t;let{dtype:i}=t;if(i=i||cc(r),i==="string"){const o=mn(i,re(s));return o.fill(r),e.makeTensorInfo(s,i,o)}else{const o=new B0e(s,r),a=[[r]];return e.runWebGLProgram(o,[],i,a)}}const j0e={kernelName:Lx,backendName:"webgl",kernelFunc:ag};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class U0e{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W0e={kernelName:Mx,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,s=e,r=new U0e(t.shape);return s.runWebGLProgram(r,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M2="return floor(x);",G0e=$t({opSnippet:M2,packedOpSnippet:M2,cpuKernelImpl:lye}),H0e={kernelName:sh,backendName:"webgl",kernelFunc:G0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q0e=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,K0e=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,X0e=hs({opSnippet:q0e,packedOpSnippet:K0e,dtype:"int32"}),Y0e={kernelName:rh,backendName:"webgl",kernelFunc:X0e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Q0e{constructor(e){this.variableNames=["A"];const t=$s(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Z0e{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=$s(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J0e={kernelName:rb,backendName:"webgl",kernelFunc:eve};let zc,Yv=X().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function eve(n){const{inputs:e,backend:t,attrs:s}=n;let{pixels:r}=e;const{numChannels:i}=s,o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,c]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],u=[c,l],h=[c,l,i];if(a||o){const g=X().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(zc==null||g!==Yv)&&(Yv=g,zc=document.createElement("canvas").getContext("2d",{willReadFrequently:Yv})),zc.canvas.width=l,zc.canvas.height=c,zc.drawImage(r,0,0,l,c),r=zc.canvas}const d=t.makeTensorInfo(u,"int32");t.texData.get(d.dataId).usage=wr.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(d.dataId),r);const p=X().getBool("WEBGL_PACK")?new Z0e(h):new Q0e(h),f=t.runWebGLProgram(p,[d],"int32");return t.disposeData(d.dataId),f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tve(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=s,g=Fo(u),m=Kn(r.shape,i.shape,l,h,c,d,!1,g);let y;const w=[],v=o!=null,I=a!=null,_=p==="leakyrelu",N=()=>{const E=[r,i],k=(S,A)=>{if(A==="NCHW"&&S.shape.length===1&&S.shape[0]!==1){const P=Se({inputs:{x:S},backend:t,attrs:{shape:[S.shape[0],1,1]}});return w.push(P),P}return S};if(v&&E.push(k(o,u)),I&&E.push(k(a,u)),_){const S=t.makeTensorInfo([],"float32",Po(f,"float32"));E.push(S),w.push(S)}return E};if(m.filterHeight===1&&m.filterWidth===1&&m.dilationHeight===1&&m.dilationWidth===1&&m.strideHeight===1&&m.strideWidth===1&&(m.padInfo.type==="SAME"||m.padInfo.type==="VALID"))y=AB({x:r,filter:i,convInfo:m,backend:t,bias:o,activation:p,preluActivationWeights:a,leakyreluAlpha:f});else if(m.strideWidth<=2&&g==="channelsLast"&&X().getBool("WEBGL_EXP_CONV")){const E=p?Qp(p,!0):null,k=new NB(m,v,E,I,_),S=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],A=N();y=t.runWebGLProgram(k,A,"float32",S)}else if(X().getBool("WEBGL_CONV_IM2COL"))y=RB({x:r,filter:i,convInfo:m,backend:t,bias:o,activation:p,preluActivationWeights:a,leakyreluAlpha:f});else{const E=p?Qp(p,!1):null,k=new _B(m,v,E,I,_),S=N();y=t.runWebGLProgram(k,S,"float32")}const T=Se({inputs:{x:y},backend:t,attrs:{shape:m.outShape}});return w.push(y),w.forEach(E=>t.disposeIntermediateTensorInfo(E)),T}const nve={kernelName:Fp,backendName:"webgl",kernelFunc:tve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sve(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dilations:u,dimRoundingMode:h,activation:d,leakyreluAlpha:p}=s,f=[];let g=u;g==null&&(g=[1,1]),O(ls(l,g),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${g}'`);const m=Kn(r.shape,i.shape,l,g,c,h,!0),y=X().getBool("WEBGL_PACK_DEPTHWISECONV")&&m.strideWidth<=2&&m.outChannels/m.inChannels===1,w=d?Qp(d,y):null,v=[r,i],I=o!=null,_=a!=null,N=d==="leakyrelu";if(I&&v.push(o),_&&v.push(a),N){const S=t.makeTensorInfo([],"float32",Po(p,"float32"));v.push(S),f.push(S)}let T;y?T=new PB(m,I,w,_,N):T=new DB(m,I,w,_,N);const E=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],k=t.runWebGLProgram(T,v,"float32",E);return f.forEach(S=>t.disposeIntermediateTensorInfo(S)),k}const rve={kernelName:Lp,backendName:"webgl",kernelFunc:sve};class ive{constructor(e,t,s,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const i=Ut(s.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ove(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,i=r.shape,o=i[i.length-1],a=re(s.shape),[l,c,u,h]=i0(s,r),d=Se({inputs:{x:r},backend:t,attrs:{shape:[c,o]}}),p=Se({inputs:{x:s},backend:t,attrs:{shape:[re(s.shape)/u,u]}});if(t.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const y=t.readSync(r.dataId),w=t.bufferSync(s),v=cye(y,w,s.dtype,c,o,u,h,s.shape,a);return t.makeTensorInfo(l,s.dtype,v.values)}const f=new ive(o,h,[c,u],s.shape),g=t.runWebGLProgram(f,[p,d],p.dtype),m=Se({inputs:{x:g},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),m}const ave={kernelName:zx,backendName:"webgl",kernelFunc:ove};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lve{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const s=Ut(this.rank),r=cve(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function cve(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${t[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LB(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:i}=e,{axis:o,batchDims:a}=s,l=ft(o,r.shape)[0];if(X().get("DEBUG")){const w=t.readSync(i.dataId),v=r.shape[l];for(let I=0;I<w.length;++I){const _=w[I];O(_<=v-1&&_>=0,()=>`GatherV2: the index value ${_} is not in [0, ${v-1}]`)}}const c=aC(r,i,l,a),u=re(i.shape),h=[],d=Se({inputs:{x:r},backend:t,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),p=Se({inputs:{x:i},backend:t,attrs:{shape:[c.batchSize,u/c.batchSize]}});h.push(d),h.push(p);const f=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(t.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const w=t.bufferSync(p),v=t.bufferSync(d),I=uye(v,w,f);return h.forEach(_=>t.disposeIntermediateTensorInfo(_)),t.makeTensorInfo(c.outputShape,I.dtype,I.values)}const g=new lve(d.shape,f),m=t.runWebGLProgram(g,[d,p],d.dtype);h.push(m);const y=Se({inputs:{x:m},backend:t,attrs:{shape:c.outputShape}});return h.forEach(w=>t.disposeIntermediateTensorInfo(w)),y}const uve={kernelName:zf,backendName:"webgl",kernelFunc:LB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hve="return float(a > b);",dve=`
  return vec4(greaterThan(a, b));
`,pve=hs({opSnippet:hve,packedOpSnippet:dve,cpuKernelImpl:hye,dtype:"bool"}),fve={kernelName:Vf,backendName:"webgl",kernelFunc:pve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mve="return float(a >= b);",gve=`
  return vec4(greaterThanEqual(a, b));
`,yve=hs({opSnippet:mve,packedOpSnippet:gve,dtype:"bool",cpuKernelImpl:dye}),bve={kernelName:ih,backendName:"webgl",kernelFunc:yve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xve(n){const{inputs:e,backend:t}=n,{input:s}=e;return FB(s,!0,t)}const wve={kernelName:Vx,backendName:"webgl",kernelFunc:xve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vve="return float(!isnan(x) && !isinf(x));",Ive=$t({opSnippet:vve,dtype:"bool"}),Sve={kernelName:ah,backendName:"webgl",kernelFunc:Ive};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kve="return float(isinf(x));",Tve=$t({opSnippet:kve,dtype:"bool"}),Cve={kernelName:lh,backendName:"webgl",kernelFunc:Tve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eve="return float(isnan(x));",_ve=$t({opSnippet:Eve,dtype:"bool"}),Nve={kernelName:ch,backendName:"webgl",kernelFunc:_ve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ave="return float(a < b);",Rve=`
  return vec4(lessThan(a, b));
`,$ve=hs({opSnippet:Ave,packedOpSnippet:Rve,cpuKernelImpl:pye,dtype:"bool"}),Dve={kernelName:jf,backendName:"webgl",kernelFunc:$ve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pve="return float(a <= b);",Ove=`
  return vec4(lessThanEqual(a, b));
`,Fve=hs({opSnippet:Pve,packedOpSnippet:Ove,cpuKernelImpl:fye,dtype:"bool"}),Lve={kernelName:Uf,backendName:"webgl",kernelFunc:Fve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mve(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:i}=t,o=mye(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const zve={kernelName:jx,backendName:"webgl",kernelFunc:Mve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vve=nd+`
  return x < 0.0 ? 0./0. : log(x);
`,Bve=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,jve=$t({opSnippet:Vve,packedOpSnippet:Bve,cpuKernelImpl:gye}),Uve={kernelName:uh,backendName:"webgl",kernelFunc:jve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wve=nd+`
  return log(1.0 + x);
`,Gve=$t({opSnippet:Wve}),Hve={kernelName:hh,backendName:"webgl",kernelFunc:Gve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qve="return float(a >= 1.0 && b >= 1.0);",Kve=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,Xve=hs({opSnippet:qve,packedOpSnippet:Kve,dtype:"bool"}),Yve={kernelName:Wf,backendName:"webgl",kernelFunc:Xve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qve="return float(!(x >= 1.0));",Zve=$t({opSnippet:Qve}),Jve={kernelName:Gf,backendName:"webgl",kernelFunc:Zve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e1e="return float(a >= 1.0 || b >= 1.0);",t1e=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,n1e=hs({opSnippet:e1e,packedOpSnippet:t1e,dtype:"bool"}),s1e={kernelName:Hf,backendName:"webgl",kernelFunc:n1e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class r1e{constructor(e,t,s,r,i){this.variableNames=["x"],this.outputShape=[];const o=t,a=e[3]-1;this.outputShape=e;let l;const c=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i1e{constructor(e,t,s,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=t,a=e[3]-1;this.outputShape=e;let l;const c=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o1e=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s,c=X().getBool("WEBGL_PACK_NORMALIZATION")?new i1e(r.shape,i,o,a,l):new r1e(r.shape,i,o,a,l);return t.runWebGLProgram(c,[r],r.dtype)},a1e={kernelName:qf,backendName:"webgl",kernelFunc:o1e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l1e{constructor(e,t,s,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=s,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c1e=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=s,h=new l1e(r.shape,a,l,c,u);return t.runWebGLProgram(h,[r,i,o],r.dtype)},u1e={kernelName:Ux,backendName:"webgl",kernelFunc:c1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h1e(n,e,t,s){const r=re(e),o=re(n.shape)/r,a=Se({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),l=kc(a,n.dtype,"max",s),c=Se({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MB(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=r.shape.length,l=ft(i,r.shape);let c=l;const u=pn(c,a),h=u!=null,d=t.shouldExecuteOnCPU([r]);let p=r;if(h){if(d){const v=t.texData.get(p.dataId).values,I=new Array(a);for(let T=0;T<I.length;T++)I[T]=r.shape[u[T]];const _=u_(v,r.shape,r.dtype,u,I);p=t.makeTensorInfo(I,r.dtype);const N=t.texData.get(p.dataId);N.values=_}else p=D0(r,u,t);c=vn(c.length,a)}cs("max",c,a);const[f,g]=Xn(p.shape,c);let m=f;o&&(m=wn(f,l));let y;if(d){const v=t.texData.get(p.dataId).values,I=yye(v,re(g),m,r.dtype);y=t.makeTensorInfo(m,r.dtype);const _=t.texData.get(y.dataId);_.values=I}else y=h1e(p,g,m,t);return h&&t.disposeIntermediateTensorInfo(p),y}const d1e={kernelName:Kf,backendName:"webgl",kernelFunc:MB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p1e=h_+`
  return max(a, b);
`,f1e=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Sc+`
  return result;
`,m1e=hs({opSnippet:p1e,packedOpSnippet:f1e,cpuKernelImpl:bye}),g1e={kernelName:dh,backendName:"webgl",kernelFunc:m1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y1e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Yh(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,c=1;O(ls(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=Hr(r.shape,i,o,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&wt(u.inShape,u.outShape))return ur({inputs:{x:r},backend:t});const h=new Zp(u,"max",!1);return t.runWebGLProgram(h,[r],r.dtype)}const b1e={kernelName:Xf,backendName:"webgl",kernelFunc:y1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x1e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dataFormat:l,dimRoundingMode:c}=s,u=[1,1,1],h=Oo(r.shape,i,o,u,a,c,l),d=new p_(h,"max",!1);return t.runWebGLProgram(d,[r],r.dtype)}const w1e={kernelName:Yf,backendName:"webgl",kernelFunc:x1e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class v1e{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=i-1-e.padInfo.top,l=o-1-e.padInfo.left,c=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class I1e{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,h=l-1-e.padInfo.front,d=c-1-e.padInfo.top,p=u-1-e.padInfo.left,f=l*c*u-1;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${d}, ${p});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${f} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S1e(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=s,h=[1,1,1],d=Oo(o.shape,a,l,h,c,u),p=new p_(d,"max",!0),f=t.runWebGLProgram(p,[o],o.dtype),g=new I1e(d),m=t.runWebGLProgram(g,[r,f],o.dtype);return t.disposeIntermediateTensorInfo(f),m}const k1e={kernelName:Gx,backendName:"webgl",kernelFunc:S1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T1e(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i,output:o}=e,a=i;Yh([i,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:h}=s,d=Hr(a.shape,l,c,1,u,h),p=!0,f=new Zp(d,"max",p),g=t.runWebGLProgram(f,[a],a.dtype),m=new v1e(d),y=t.runWebGLProgram(m,[r,g],a.dtype);return t.disposeIntermediateTensorInfo(g),y}const C1e={kernelName:Wx,backendName:"webgl",kernelFunc:T1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E1e(n,e,t,s){let r=new Zp(t,"max",!1);const i=s.runWebGLProgram(r,[n],"float32");r=new Zp(t,"max",!0,!0,e);const o=s.runWebGLProgram(r,[n],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _1e={kernelName:Hx,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;O(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const c=[1,1];O(ls(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const u=Hr(s.shape,r,i,c,o),[h,d]=E1e(s,a,u,l);return[h,d]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N1e(n,e,t,s){const r=re(e),o=re(n.shape)/r,a=Se({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),l=kc(a,"float32","mean",s),c=Se({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A1e={kernelName:Qf,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{keepDims:r,axis:i}=e,o=t,a=s.shape.length,l=ft(i,s.shape);let c=l;const u=pn(c,a),h=u!=null,d=o.shouldExecuteOnCPU([s]),p=[];let f=s;if(h){if(d){const I=o.texData.get(f.dataId).values,_=new Array(a);for(let E=0;E<_.length;E++)_[E]=s.shape[u[E]];const N=u_(I,s.shape,s.dtype,u,_);f=o.makeTensorInfo(_,s.dtype);const T=o.texData.get(f.dataId);T.values=N}else f=D0(s,u,o);p.push(f),c=vn(c.length,a)}cs("sum",c,a);const[g,m]=Xn(f.shape,c);let y=g;r&&(y=wn(g,l));const w=N1e(f,m,y,o);for(const v of p)o.disposeIntermediateTensorInfo(v);return w}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R1e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=ft(i,r.shape);let c=l;const u=pn(c,a);let h=r;u!=null&&(h=_s({inputs:{x:r},backend:t,attrs:{perm:u}}),c=vn(c.length,r.shape.length)),cs("min",c,a);const[d,p]=Xn(h.shape,c),f=re(p),g=Se({inputs:{x:h},backend:t,attrs:{shape:[-1,f]}}),m=kc(g,g.dtype,"min",t);let y;if(o){const w=wn(d,l);y=Se({inputs:{x:m},backend:t,attrs:{shape:w}})}else y=Se({inputs:{x:m},backend:t,attrs:{shape:d}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(m),u!=null&&t.disposeIntermediateTensorInfo(h),y}const $1e={kernelName:Zf,backendName:"webgl",kernelFunc:R1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D1e=h_+`
  return min(a, b);
`,P1e=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Sc+`
  return result;
`,O1e=hs({opSnippet:D1e,packedOpSnippet:P1e,cpuKernelImpl:xye}),F1e={kernelName:ph,backendName:"webgl",kernelFunc:O1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L1e{constructor(e,t,s){this.variableNames=["x"],this.outputShape=t.map((u,h)=>u[0]+e[h]+u[1]);const r=e.length,i=Ut(r),o=t.map(u=>u[0]).join(","),a=t.map((u,h)=>u[0]+e[h]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),c=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M1e{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((f,g)=>f[0]+e[g]+f[1]);const r=e.length,i=Ut(r),o=t.map(f=>f[0]).join(","),a=t.map((f,g)=>f[0]+e[g]).join(","),l=Ts("rc",r),c=Ts("source",r),u=`${l[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${c.slice(-2).join()})`,d=s==="reflect"?0:1;let p="";if(r===1){const f=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${d};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${d};
        }
        source -= start;
      `;p=`
        ${i} rc = outputLoc;
        ${f}
        result[0] = getChannel(getX(${c.join()}), ${h});
        ${l[r-1]} += 1;
        if(${u}) {
          ${f}
          result[1] = getChannel(getX(${c.join()}), ${h});
        }
      `}else{const f=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${d}) +
                gte * ((end - 1) * 2 - source + ${d});
        source -= start;
      `;p=`
        ${i} rc = outputLoc;
        ${f}
        result[0] = getChannel(getX(${c.join()}), ${h});
        ${l[r-1]} += 1;
        if(${u}) {
          ${f}
          result[1] = getChannel(getX(${c.join()}), ${h});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${f}
          result[2] = getChannel(getX(${c.join()}), ${h});
          ${l[r-1]} += 1;
          if(${u}) {
            ${f}
            result[3] = getChannel(getX(${c.join()}), ${h});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z1e=({inputs:n,backend:e,attrs:t})=>{const{x:s}=n,{paddings:r,mode:i}=t,o=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new M1e(s.shape,r,i):new L1e(s.shape,r,i);return e.runWebGLProgram(o,[s],s.dtype)},V1e={kernelName:Jf,backendName:"webgl",kernelFunc:z1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B1e=`if (b == 0.0) return NAN;
  return mod(a, b);`,j1e=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Sc+`
  return result;
`,U1e=hs({opSnippet:B1e,packedOpSnippet:j1e}),W1e={kernelName:fh,backendName:"webgl",kernelFunc:U1e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class G1e{constructor(e,t,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H1e=`
if (a == b) {
  return 1.0;
};
return a / b;`,q1e=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,zB=hs({opSnippet:H1e,packedOpSnippet:q1e,checkOutOfBounds:!0}),K1e={kernelName:Zu,backendName:"webgl",kernelFunc:zB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z2="return a - b;",VB=hs({opSnippet:z2,packedOpSnippet:z2,supportsComplex:!0,cpuKernelImpl:Vye}),X1e={kernelName:Ah,backendName:"webgl",kernelFunc:VB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BB(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:i}=s,o=ft([i],r.shape),a=MB({inputs:{x:r},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),l=wn(a.shape,o),c=Se({inputs:{x:a},backend:t,attrs:{shape:l}}),u=VB({inputs:{a:r,b:c},backend:t}),h=OB({inputs:{x:u},backend:t}),d=P0({inputs:{x:h},backend:t,attrs:{axis:o,keepDims:!1}}),p=Se({inputs:{x:d},backend:t,attrs:{shape:l}}),f=zB({inputs:{a:h,b:p},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),f}const Y1e={kernelName:ym,backendName:"webgl",kernelFunc:BB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q1e(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s,l=a?r:BB({inputs:{logits:r},backend:t,attrs:{dim:r.shape.length-1}}),c=l.shape[0],u=l.shape[1],h=new G1e(c,u,i),d=[[o]],p=t.runWebGLProgram(h,[l],"int32",d);return a||t.disposeIntermediateTensorInfo(l),p}const Z1e={kernelName:qx,backendName:"webgl",kernelFunc:Q1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J1e=Kr+`
  return -x;
`,eIe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function tIe(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])){const i=t.texData.get(s.dataId),[o,a]=vye(i.values,s.shape,s.dtype);return t.makeTensorInfo(a,s.dtype,o)}let r;return X().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new ha(s.shape,eIe):r=new Oi(s.shape,J1e),t.runWebGLProgram(r,[s],s.dtype)}const nIe={kernelName:em,backendName:"webgl",kernelFunc:tIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sIe=t0;function rIe(n){yr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s,c=t.readSync(r.dataId),u=t.readSync(i.dataId),{selectedIndices:h}=sIe(c,u,o,a,l);return t.makeTensorInfo([h.length],"int32",new Int32Array(h))}const iIe={kernelName:Kx,backendName:"webgl",kernelFunc:rIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oIe=n0;function aIe(n){yr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=s,u=t.readSync(r.dataId),h=t.readSync(i.dataId),{selectedIndices:d,validOutputs:p}=oIe(u,h,o,a,l,c);return[t.makeTensorInfo([d.length],"int32",new Int32Array(d)),t.makeTensorInfo([],"int32",new Int32Array([p]))]}const lIe={kernelName:Xx,backendName:"webgl",kernelFunc:aIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cIe=s0;function uIe(n){yr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=s,u=t.readSync(r.dataId),h=t.readSync(i.dataId),d=o,p=a,f=l,g=c,{selectedIndices:m,selectedScores:y}=cIe(u,h,d,p,f,g);return[t.makeTensorInfo([m.length],"int32",new Int32Array(m)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const hIe={kernelName:Yx,backendName:"webgl",kernelFunc:uIe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dIe{constructor(e,t,s,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pIe=n=>{const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s,c=re(r.shape),u=new dIe(c,o,a,l),h=Se({inputs:{x:r},backend:t,attrs:{shape:[c]}}),d=t.runWebGLProgram(u,[h],i);t.disposeIntermediateTensorInfo(h);const p=[...r.shape,o],f=Se({inputs:{x:d},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(d),f},fIe={kernelName:sm,backendName:"webgl",kernelFunc:pIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rb(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="complex64"){const r=og({inputs:{input:s},backend:t}),i=Rb({inputs:{x:r},backend:t}),o=O0({inputs:{input:s},backend:t}),a=Rb({inputs:{x:o},backend:t}),l=Ka({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return ag({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:t})}const mIe={kernelName:vm,backendName:"webgl",kernelFunc:Rb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jB(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=og({inputs:{input:s},backend:t}),i=jB({inputs:{x:r},backend:t}),o=O0({inputs:{input:s},backend:t}),a=Rb({inputs:{x:o},backend:t}),l=Ka({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return ag({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:t})}const gIe={kernelName:nm,backendName:"webgl",kernelFunc:jB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yIe(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return JI({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(u=>{as(i,u.shape,"All tensors passed to stack must have matching shapes"),O(o===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const h=JI({inputs:{input:u},backend:t,attrs:{dim:r}});return a.push(h),h}),c=EB({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(u=>t.disposeIntermediateTensorInfo(u)),c}const bIe={kernelName:rm,backendName:"webgl",kernelFunc:yIe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xIe{constructor(e,t,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((c,u)=>c[0]+e[u]+c[1]);const r=e.length,i=Ut(r),o=t.map(c=>c[0]).join(","),a=t.map((c,u)=>c[0]+e[u]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wIe{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((g,m)=>g[0]+e[m]+g[1]);const r=e.length,i=Ut(r),o=t.map(g=>g[0]).join(","),a=t.map((g,m)=>g[0]+e[m]).join(","),l=Ts("rc",r),c=Ts("source",r),u=`${l[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${c.slice(-2).join()})`,d=[`${i} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${u}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${u}) {`],p=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let f="";for(let g=0,m=r===1?2:4;g<m;g++)f+=`
        ${d[g]}
        if (${p}) {
          result[${g}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${g}] = getChannel(getX(${c.join()}), ${h});
        }
      `;f+=r===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UB=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,constantValue:o}=s;if(re(r.shape)===0){const c=i.map((u,h)=>u[0]+r.shape[h]+u[1]);return ag({backend:t,attrs:{shape:c,value:o,dtype:r.dtype}})}const a=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wIe(r.shape,i,o):new xIe(r.shape,i,o),l=[[o]];return t.runWebGLProgram(a,[r],r.dtype,l)},vIe={kernelName:im,backendName:"webgl",kernelFunc:UB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IIe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,SIe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Sc+`
  return result;
`,kIe=hs({opSnippet:IIe,packedOpSnippet:SIe}),TIe={kernelName:gh,backendName:"webgl",kernelFunc:kIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=[],c=ft(i,r.shape);let u=c;const h=pn(u,a);let d=r;h!=null&&(d=_s({inputs:{x:r},backend:t,attrs:{perm:h}}),u=vn(u.length,a),l.push(d)),cs("prod",u,a);let p;if(t.shouldExecuteOnCPU([d])){const f=t.texData.get(d.dataId).values,{outVals:g,outShape:m,outDtype:y}=Sye(d.shape,d.dtype,f,u);p=t.makeTensorInfo(m,y,g)}else{const[f,g]=Xn(d.shape,u),m=re(g),y=Se({inputs:{x:d},backend:t,attrs:{shape:[-1,m]}}),w=Iw(r.dtype),v=kc(y,w,"prod",t);p=Se({inputs:{x:v},backend:t,attrs:{shape:f}}),l.push(y),l.push(v)}if(o){l.push(p);const f=wn(p.shape,c);p=Se({inputs:{x:p},backend:t,attrs:{shape:f}})}return l.forEach(f=>t.disposeIntermediateTensorInfo(f)),p}const EIe={kernelName:am,backendName:"webgl",kernelFunc:CIe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ie(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(y=>t.readSync(y.dataId)),c=r.map(y=>y.shape),u=t.readSync(i.dataId),h=t.readSync(o.dataId),[d,p,f]=kye(l,c,u,i.shape,i.dtype,h,o.shape,a),g=d.map(y=>t.makeTensorInfo([y.length],"int32",y)),m=t.makeTensorInfo(f,i.dtype,p);return g.concat([m])}const NIe={kernelName:Qx,backendName:"webgl",kernelFunc:_Ie};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AIe(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:i}=e,o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[c,u]=Tye(o,s.shape,s.dtype,a,r.shape,l,i.shape),h=t.makeTensorInfo([c.length],"int32",c),d=t.makeTensorInfo([u.length],s.dtype,u);return[h,d]}const RIe={kernelName:Zx,backendName:"webgl",kernelFunc:AIe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Ie(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,c=t.readSync(r.dataId),u=t.readSync(i.dataId),h=t.readSync(o.dataId),d=a.map(m=>t.readSync(m.dataId)),p=a.map(m=>m.shape),[f,g]=Cye(c,r.shape,u,i.shape,i.dtype,h,o.shape,d,p,l);return t.makeTensorInfo(f,i.dtype,g)}const DIe={kernelName:Jx,backendName:"webgl",kernelFunc:$Ie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WB=n=>{const{backend:e,attrs:t}=n,{start:s,stop:r,step:i,dtype:o}=t,a=Eye(s,r,i,o);return e.makeTensorInfo([a.length],o,a)},PIe={kernelName:ew,backendName:"webgl",kernelFunc:WB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OIe="return 1.0 / x;",FIe=$t({opSnippet:OIe}),LIe={kernelName:yh,backendName:"webgl",kernelFunc:FIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MIe=Kr+`
  return (x < 0.0) ? 0.0 : x;
`,zIe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,VIe=$t({opSnippet:MIe,packedOpSnippet:zIe}),BIe={kernelName:bh,backendName:"webgl",kernelFunc:VIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jIe=Kr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,UIe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,WIe=$t({opSnippet:jIe,packedOpSnippet:UIe}),GIe={kernelName:xh,backendName:"webgl",kernelFunc:WIe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HIe{constructor(e,t,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,t,s,c];const u=[r&&t>1?a-1:a,r&&s>1?l-1:l],h=[r&&t>1?t-1:t,r&&s>1?s-1:s];let d;i?d="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/h[0]},
          ${u[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qIe{constructor(e,t,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,t,s,c];const u=[r&&t>1?a-1:a,r&&s>1?l-1:l],h=[r&&t>1?t-1:t,r&&s>1?s-1:s];let d;i?d="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/h[0]},
          ${u[1]/h[1]},
          ${u[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${d};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KIe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,c]=a,u=X().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new qIe(r.shape,l,c,i,o):new HIe(r.shape,l,c,i,o);return t.runWebGLProgram(u,[r],"float32")}const XIe={kernelName:um,backendName:"webgl",kernelFunc:KIe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YIe{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],c=[s&&o>1?o-1:o,s&&a>1?a-1:a],u=l[0]/c[0],h=l[1]/c[1],d=1/u,p=1/h,f=Math.ceil(d)*2+2,g=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${h});

        const float invHeightScale = float(${d});
        const float invWidthScale = float(${p});

        const int winHeight = int(${f});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QIe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s,a=new YIe(i.shape,r.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const ZIe={kernelName:sw,backendName:"webgl",kernelFunc:QIe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JIe{constructor(e,t,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,t,s,c];const u=[r&&t>1?a-1:a,r&&s>1?l-1:l],h=[r&&t>1?t-1:t,r&&s>1?s-1:s],d=r?"0.5":"0.0";let p;i?p="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/h[0]},
          ${u[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eSe{constructor(e,t,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,t,s,c];const u=[r&&t>1?a-1:a,r&&s>1?l-1:l],h=[r&&t>1?t-1:t,r&&s>1?s-1:s],d=r?"0.5":"0.0";let p;i?p="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/h[0]},
          ${u[1]/h[1]},
          ${u[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tSe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,c]=a,u=X().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new eSe(r.shape,l,c,i,o):new JIe(r.shape,l,c,i,o);return t.runWebGLProgram(u,[r],r.dtype)}const nSe={kernelName:cm,backendName:"webgl",kernelFunc:tSe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sSe{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],c=[s&&o>1?o-1:o,s&&a>1?a-1:a],u=l[0]/c[0],h=l[1]/c[1],d=1/u,p=1/h,f=Math.ceil(d)*2+2,g=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${h});

        const float invHeightScale = float(${d});
        const float invWidthScale = float(${p});

        const int winHeight = int(${f});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rSe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s,a=new sSe(i.shape,r.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const iSe={kernelName:nw,backendName:"webgl",kernelFunc:rSe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oSe{constructor(e,t){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,i=e.map((a,l)=>r(l)).join(","),o=Ut(s);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aSe{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=Ts("rc",s),i=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,o=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=Ut(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${i}){
            result.g = ${c(r.slice())};
          }
          if(${o}) {
            result.b = ${u(r.slice())};
            if(${i}) {
              result.a = ${h(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(f){return d(f)}function c(f){return f[s-1]="("+f[s-1]+" + 1)",d(f)}function u(f){return f[s-2]="("+f[s-2]+" + 1)",d(f)}function h(f){return f[s-1]="("+f[s-1]+" + 1)",f[s-2]="("+f[s-2]+" + 1)",d(f)}function d(f){const g=e.map((w,v)=>p(v,f)),m=g.join(","),y=g.slice(-2).join(",");return`getChannel(getX(${m}), vec2(${y}))`}function p(f,g){return t.indexOf(f)!==-1&&e[f]!==1?`${e[f]} - ${g[f]} - 1`:`${g[f]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lSe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:i}=s,o=r.shape.length,a=ft(i,r.shape);if(o===0)return ur({inputs:{x:r},backend:t});const l=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new aSe(r.shape,a):new oSe(r.shape,a);return t.runWebGLProgram(l,[r],r.dtype)}const cSe={kernelName:hm,backendName:"webgl",kernelFunc:lSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uSe{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let i="";typeof t=="number"?i=`float outputValue = ${t.toFixed(2)};`:i=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hSe={kernelName:ww,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:i,center:o}=e,a=t,l=new uSe(s.shape,i),[c,u]=GT(o,s.shape[1],s.shape[2]),h=[[c,u,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[s],s.dtype,h)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dSe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,pSe=$t({opSnippet:dSe}),fSe={kernelName:wh,backendName:"webgl",kernelFunc:pSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mSe="return inversesqrt(x);",gSe=$t({opSnippet:mSe,cpuKernelImpl:_ye}),ySe={kernelName:vh,backendName:"webgl",kernelFunc:gSe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f_{constructor(e,t,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const c=Ut(i.length),u=Ut(o.length);let h="";s===1?h="i":s===2&&(h="i, j");const d=`getIndices(${h})`;let p="";r===1?p="i":r===2&&(p="i, coords[1]");const f=`getUpdates(${p})`;let g="";l&&(g="coords[0], coords[1]");const m=`getDefaultValue(${g})`,y=t>1?"strides[j]":"strides";this.userCode=`
        ${c} strides = ${c}(${i});

        void main() {
          ${u} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${d});
              flattenedIndex += index * ${y};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${f};
              found = true;
            }
          }
          setOutput(mix(${m}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bSe{constructor(e,t,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const c=Ut(i.length),u=Ut(o.length);let h="";s===1?h="i":s===2&&(h="i, j");const d=`getIndices(${h})`;let p="";r===1?p="i":r===2&&(p="i, coords[1]");const f=`getUpdates(${p})`;let g="";l&&(g="coords[0], coords[1]");const m=`getDefaultValue(${g})`,y=t>1?"strides[j]":"strides",w=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${c} strides = ${c}(${i});

        void main() {
          ${u} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${d});
              flattenedIndex += index.xz * ${y};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${w};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${f};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${m}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xSe(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:h}=Ha(i,r,o),d=[h/c,c];if(h===0)return t.makeTensorInfo(o,r.dtype);const p=Se({inputs:{x:r},backend:t,attrs:{shape:[l,a]}}),f=Se({inputs:{x:i},backend:t,attrs:{shape:[l,c]}}),g=t.makeTensorInfo([],"float32",new Float32Array([0]));let m;X().getBool("WEBGL_PACK")?m=new bSe(l,a,p.shape.length,f.shape.length,u,d):m=new f_(l,a,p.shape.length,f.shape.length,u,d);const y=t.runWebGLProgram(m,[f,p,g],f.dtype),w=Se({inputs:{x:y},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(g),w}const wSe={kernelName:rw,backendName:"webgl",kernelFunc:xSe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vSe{constructor(e,t,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=X().getNumber("WEBGL_VERSION")===2?i:o,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ISe(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:i}=e,{side:o}=s,a=new vSe(r.shape[0],r.shape[1],i.shape[1],o),l=[[r.shape[1]]];return t.runWebGLProgram(a,[r,i],"int32",l)}const SSe={kernelName:ow,backendName:"webgl",kernelFunc:ISe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kSe{constructor(e,t,s){this.variableNames=["c","a","b"],this.outputShape=t;let r,i;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)i="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let u=0;u<t.length;u++)c.push(`${a[u]}`),u<e&&l.push(`${a[u]}`);r=l.join(),i=c.join()}const o=Ut(s);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TSe(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:i}=e,o=new kSe(s.shape.length,r.shape,r.shape.length);return t.runWebGLProgram(o,[s,r,i],Ws(r.dtype,i.dtype))}const CSe={kernelName:dm,backendName:"webgl",kernelFunc:TSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ESe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${l0};
  float scale = ${c0};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,_Se=$t({opSnippet:ESe}),NSe={kernelName:Ih,backendName:"webgl",kernelFunc:_Se};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ASe=nd+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,RSe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,$Se=$t({opSnippet:ASe,packedOpSnippet:RSe,cpuKernelImpl:Aye}),DSe={kernelName:Ch,backendName:"webgl",kernelFunc:$Se};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PSe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,OSe=$t({opSnippet:PSe}),FSe={kernelName:Th,backendName:"webgl",kernelFunc:OSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LSe=nd+`
  return sin(x);
`,MSe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Sc}
  return result;
`,zSe=$t({opSnippet:LSe,packedOpSnippet:MSe}),VSe={kernelName:Sh,backendName:"webgl",kernelFunc:zSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BSe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,jSe=$t({opSnippet:BSe}),USe={kernelName:kh,backendName:"webgl",kernelFunc:jSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WSe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,GSe=$t({opSnippet:WSe}),HSe={kernelName:Eh,backendName:"webgl",kernelFunc:GSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qSe=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,paddings:o}=s;O(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((y,w)=>y*w),l=[[0,0]];l.push(...o);for(let y=1+i.length;y<r.shape.length;++y)l.push([0,0]);const c=[],u=UB({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),h=jm(u.shape,i,a,!1),d=Um(h.length,i.length,!1),p=Wm(u.shape,i,a,!1),f=Se({inputs:{x:u},backend:t,attrs:{shape:h}}),g=_s({inputs:{x:f},backend:t,attrs:{perm:d}}),m=Se({inputs:{x:g},backend:t,attrs:{shape:p}});return c.push(u),c.push(f),c.push(g),c.forEach(y=>t.disposeIntermediateTensorInfo(y)),m},KSe={kernelName:mm,backendName:"webgl",kernelFunc:qSe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XSe(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.readSync(s.dataId),l=t.readSync(r.dataId),c=t.readSync(i.dataId),u=t.readSync(o.dataId)[0],[h,d,p,f,g]=$ye(a,s.shape,s.dtype,l,r.dtype,c,u);return[t.makeTensorInfo(d,s.dtype,h),t.makeTensorInfo([d[0]],r.dtype,p),t.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(m=>Number(m)))),t.makeTensorInfo([g.length],s.dtype,new Int32Array(g))]}const YSe={kernelName:aw,backendName:"webgl",kernelFunc:XSe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QSe(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.readSync(r.dataId)),a=t.readSync(s.dataId),l=Array.from(t.readSync(i.dataId)),[c,u,h]=Dye(a,s.shape,s.dtype,o,l);return[t.makeTensorInfo(u,s.dtype,c),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}const ZSe={kernelName:lw,backendName:"webgl",kernelFunc:QSe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JSe(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[c,u]=dB(o,s.shape,s.dtype,a,l,!0);return t.makeTensorInfo(u,s.dtype,c)}const eke={kernelName:cw,backendName:"webgl",kernelFunc:JSe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tke(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[c,u]=dB(o,s.shape,s.dtype,a,l);return t.makeTensorInfo(u,s.dtype,c)}const nke={kernelName:uw,backendName:"webgl",kernelFunc:tke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ske(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:c,sliceSize:u,strides:h,outputSize:d}=Ha(i,r,a),p=!1;if(i.dtype==="string"){const y=t.bufferSync(r),w=t.bufferSync(i),v=vo(t.readSync(o.dataId)[0]),I=Nye(y,w,a,d,u,c,l,h,v,p);return t.makeTensorInfo(a,I.dtype,I.values)}const f=new f_(c,l,r.shape.length,i.shape.length,h,[d,1],p),g=t.runWebGLProgram(f,[i,r,o],i.dtype),m=Se({inputs:{x:g},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(g),m}const rke={kernelName:hw,backendName:"webgl",kernelFunc:ske};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ike(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=ft(o,r.shape)[0],l=oC(r,i,a),c=r.shape.length,u=new Array(c).fill(0),h=r.shape.slice();return l.map(d=>{const p=[...h];p[a]=d;const f=sd({inputs:{x:r},backend:t,attrs:{begin:u,size:p}});return u[a]+=d,f})}const oke={kernelName:gm,backendName:"webgl",kernelFunc:ike};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V2="return sqrt(x);",ake=$t({opSnippet:V2,packedOpSnippet:V2,cpuKernelImpl:Pye}),lke={kernelName:_h,backendName:"webgl",kernelFunc:ake};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cke="return x * x;",uke=$t({opSnippet:cke}),hke={kernelName:dw,backendName:"webgl",kernelFunc:uke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B2="return (a - b) * (a - b);",dke=hs({opSnippet:B2,packedOpSnippet:B2}),pke={kernelName:Nh,backendName:"webgl",kernelFunc:dke};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fke(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const i=t.readSync(r.dataId),o=Eo(i),a=Oye(o,"string",s);return t.makeTensorInfo(r.shape,"string",a)}const mke={kernelName:bm,backendName:"webgl",kernelFunc:fke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gke({inputs:n,attrs:e,backend:t}){const{x:s}=n,r=Kr+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new Oi(s.shape,r);return t.runWebGLProgram(i,[s],s.dtype)}const yke={kernelName:Ph,backendName:"webgl",kernelFunc:gke};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bke{constructor(e,t,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,i=Ut(s.length),o=Ut(s.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=s.map((c,u)=>(l++,s.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${l-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${t});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xke(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:d}=s,{finalShapeSparse:p,finalShape:f,isIdentity:g,sliceDim0:m,isSimpleSlice:y,begin:w,end:v,strides:I}=BT(r.shape,i,o,a,l,c,u,h,d);let _;if(g)_=Se({inputs:{x:r},backend:t,attrs:{shape:f}});else if(m||y){O(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const T=MT(w,v,I),E=sd({inputs:{x:r},backend:t,attrs:{begin:w,size:T}});_=Se({inputs:{x:E},backend:t,attrs:{shape:f}}),t.disposeIntermediateTensorInfo(E)}else if(t.shouldExecuteOnCPU([r])){const E=t.readSync(r.dataId),k=ct(r.shape,r.dtype,E),S=Fye(p,k,I,w);_=t.makeTensorInfo(f,r.dtype,S.values)}else{const E=new bke(w,I,p);_=t.runWebGLProgram(E,[r],r.dtype)}const N=Se({inputs:{x:_},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(_),N}const wke={kernelName:pw,backendName:"webgl",kernelFunc:xke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vke(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=s,{data:u,dataSplits:h}=e,d=t.readSync(u.dataId),p=t.readSync(h.dataId),[f,g]=Lye(d,p,r,i,o,a,l,c);return[t.makeTensorInfo([f.length],"string",f),t.makeTensorInfo(h.shape,"int32",g)]}const Ike={kernelName:fw,backendName:"webgl",kernelFunc:vke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ske(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.readSync(i.dataId),l=t.readSync(o.dataId)[0],[c,u,h]=Mye(a,l,r),d=u.length;return[t.makeTensorInfo([d,2],"int32",c),t.makeTensorInfo([d],"string",u),t.makeTensorInfo([2],"int32",new Int32Array(h))]}const kke={kernelName:mw,backendName:"webgl",kernelFunc:Ske};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tke(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=t.readSync(i.dataId),a=zye(o,r);return t.makeTensorInfo(i.shape,"int32",a)}const Cke={kernelName:gw,backendName:"webgl",kernelFunc:Tke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eke="return tan(x);",_ke=$t({opSnippet:Eke}),Nke={kernelName:Rh,backendName:"webgl",kernelFunc:_ke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ake=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Rke=$t({opSnippet:Ake}),$ke={kernelName:$h,backendName:"webgl",kernelFunc:Rke};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dke(n){const{inputs:e,backend:t,attrs:s}=n,{tensor:r,indices:i,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:h}=Ha(o,i,r.shape),d=[h/c,c];if(h===0)return t.makeTensorInfo(r.shape,i.dtype);const p=Se({inputs:{x:i},backend:t,attrs:{shape:[l,a]}}),f=Se({inputs:{x:o},backend:t,attrs:{shape:[l,c]}}),g=Se({inputs:{x:r},backend:t,attrs:{shape:d}}),m=new f_(l,a,p.shape.length,f.shape.length,u,d,!1,!0),y=t.runWebGLProgram(m,[f,p,g],g.dtype),w=Se({inputs:{x:y},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),w}const Pke={kernelName:iw,backendName:"webgl",kernelFunc:Dke};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oke{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[o]*t[o];this.outputShape=s,this.rank=s.length;const r=Ut(this.rank),i=Fke(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function Fke(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${t[r]}, ${n[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GB(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:i}=s;if(r.dtype==="string"||r.shape.length>5){const l=t.readSync(r.dataId),c=r.dtype==="string"?l.map(d=>vo(d)):l,u=ct(r.shape,r.dtype,c),h=Bye(u,i);return t.makeTensorInfo(h.shape,h.dtype,h.values)}const o=new Oke(r.shape,i);return t.runWebGLProgram(o,[r],r.dtype)}const Lke={kernelName:Dh,backendName:"webgl",kernelFunc:GB};class Mke{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class zke{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sl(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function j2(n){let e=1;for(;e<n;)e*=2;return e}function Vke(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:i,sorted:o}=s,a=X().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=X().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=r.shape,u=c[c.length-1];if(t.shouldExecuteOnCPU([r])||u<a||i>l){const S=t.readSync(r.dataId),[A,P]=jye(S,c,r.dtype,i,o);return[t.makeTensorInfo(A.shape,A.dtype,A.values),t.makeTensorInfo(P.shape,P.dtype,P.values)]}if(i===0)return c[c.length-1]=0,[t.makeTensorInfo(c,r.dtype,[]),t.makeTensorInfo(c,"int32",[])];if(u===1)return[r,ag({attrs:{shape:c,dtype:"int32",value:0},backend:t})];const h=t.texData.get(r.dataId),d=h!==null&&h.isPacked,p=d?t.unpackTensor(r):r,g=re(c)/u,m=Se({inputs:{x:p},attrs:{shape:[g,u]},backend:t});d&&sl(t,p);const y=j2(i),w=j2(u);let v=null;const I=()=>v===null?[m,m]:[m,v],_=(S,A,P)=>{const D=I(),V=new Mke(P),q=[[u],[v===null?1:0],[Number.NEGATIVE_INFINITY],[S],[A]],J=v;v=t.runWebGLProgram(V,D,"int32",q),sl(t,J)};for(let S=1;S<y;S*=2){const A=S*2;for(let P=S;P>=1;P/=2)_(A,P,[g,w])}for(let S=w;S>y;S/=2){const A=I(),P=new zke([g,S/2]),V=[[u],[v===null?1:0],[y]],U=v;v=t.runWebGLProgram(P,A,"int32",V),sl(t,U);const q=y/2,J=q*2;for(let K=q;K>=1;K/=2)_(J,K,v.shape)}let N=v;v=sd({inputs:{x:v},backend:t,attrs:{begin:0,size:[g,i]}}),sl(t,N);let T=LB({inputs:{x:m,indices:v},backend:t,attrs:{axis:1,batchDims:1}});sl(t,m);const E=c.slice(0,-1);E.push(i),N=v,v=Se({inputs:{x:v},attrs:{shape:E},backend:t}),sl(t,N);const k=T;return T=Se({inputs:{x:T},attrs:{shape:E},backend:t}),sl(t,k),[T,v]}const Bke={kernelName:yw,backendName:"webgl",kernelFunc:Vke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jke{constructor(e,t,s,r,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uke(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=s,[u,h,d,p]=r.shape,[f,g]=c??[h,d],m=[u,f,g,p],y=new jke(h,d,o,a,l,m);return t.runWebGLProgram(y,[r,i],"float32")}const Wke={kernelName:bw,backendName:"webgl",kernelFunc:Uke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gke(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:i}=e;Yh(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(i.dataId),{outputValues:a,outputShape:l,indices:c}=Uye(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([c.length],"int32",c)]}const Hke={kernelName:xw,backendName:"webgl",kernelFunc:Gke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qke(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r,a=o.shape.length,l=r.shape[i],c=new Array(a-1);let u=0;for(let g=0;g<a;g++)g!==i&&(c[u++]=o.shape[g]);const h=[],d=new Array(a).fill(0),p=o.shape.slice();p[i]=1;const f=new Array(l);for(let g=0;g<f.length;g++){d[i]=g;const m=sd({inputs:{x:o},backend:t,attrs:{begin:d,size:p}}),y=Se({inputs:{x:m},backend:t,attrs:{shape:c}});f[g]=y,h.push(m)}return h.forEach(g=>t.disposeIntermediateTensorInfo(g)),f}const Kke={kernelName:xm,backendName:"webgl",kernelFunc:qke};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xke{constructor(e,t){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/s);this.outputShape=[r,a];const l="0.0",c="sumValue",u=Math.floor(s/4)*4,h=s%4,d=`
        sumValue += dot(values, segFilter);
    `;let p="";i%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let f="";i%s>0&&(f=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${f}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${d}
        }

        int inIdx = inOffset + ${u};
        if (${h===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${d}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${d}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${d}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yke(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:i}=e,{numSegments:o}=s,a=r.shape.length,l=[];let c=0;const u=pn([c],a);let h=r;u!=null&&(h=_s({inputs:{x:r},backend:t,attrs:{perm:u}}),l.push(h),c=vn(1,a)[0]);const d=gM(h.shape,c,o),p=re([h.shape[c]]),f=Se({inputs:{x:h},backend:t,attrs:{shape:[-1,p]}});l.push(f);const g=Iw(r.dtype),m=(I,_,N,T,E)=>{const k=I.shape[0],S=I.shape[1],A=mM(S,E),P={windowSize:A,inSize:S,batchSize:k,numSegments:E},D=new Xke(P,_),V=t.compileAndRun(D,[I,N],T);if(l.push(V),V.shape[1]===E)return V;const U=WB({backend:t,attrs:{start:0,stop:E,step:1,dtype:"float32"}}),q=GB({inputs:{x:U},backend:t,attrs:{reps:[S/A]}});return l.push(U),l.push(q),m(V,_,q,T,E)},y=m(f,"unsortedSegmentSum",i,g,o),w=Se({inputs:{x:y},backend:t,attrs:{shape:d}});let v=w;if(u!=null){l.push(w);const I=ja(u);v=_s({inputs:{x:v},backend:t,attrs:{perm:I}})}return l.forEach(I=>t.disposeIntermediateTensorInfo(I)),v}const Qke={kernelName:wm,backendName:"webgl",kernelFunc:Yke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zke=[Obe,Lbe,Vbe,Ube,Gbe,Kbe,Ybe,Zbe,nxe,rxe,axe,uxe,pxe,yxe,wxe,Ixe,kxe,_xe,Axe,$xe,Fxe,Uxe,Gxe,Xxe,Qxe,swe,iwe,cwe,bbe,dwe,ywe,vwe,Ewe,Awe,$we,Pwe,Fwe,Vwe,Uwe,Hwe,Kwe,Ywe,Zwe,t0e,s0e,a0e,c0e,d0e,m0e,y0e,v0e,T0e,N0e,$0e,O0e,F0e,M0e,V0e,j0e,W0e,H0e,Y0e,J0e,nve,rve,ave,uve,fve,bve,ybe,wve,mwe,Sve,Cve,Nve,wbe,Dve,Lve,zve,Uve,Hve,Yve,Jve,s1e,a1e,u1e,d1e,g1e,b1e,w1e,k1e,C1e,_1e,A1e,$1e,F1e,V1e,W1e,Z1e,Sbe,nIe,iIe,lIe,hIe,Jxe,fIe,gIe,bIe,vIe,TIe,Ibe,EIe,NIe,RIe,DIe,PIe,ewe,K1e,LIe,BIe,GIe,Tbe,XIe,ZIe,nSe,iSe,cSe,hSe,fSe,ySe,wSe,SSe,CSe,NSe,DSe,FSe,VSe,USe,Bxe,Y1e,HSe,KSe,YSe,ZSe,eke,nke,rke,oke,lke,hke,pke,mke,yke,wke,Ike,kke,Cke,X1e,$be,Nke,$ke,Pke,Lke,Bke,Wke,Dbe,Hke,Kke,Qke,mIe];for(const n of Zke)vw(n);/** @license See the LICENSE file. */const Jke="4.11.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eTe={"tfjs-core":HL,"tfjs-backend-cpu":tV,"tfjs-backend-webgl":mB,"tfjs-data":i3,"tfjs-layers":I0,"tfjs-converter":Uz,tfjs:Jke},tTe=Object.freeze(Object.defineProperty({__proto__:null,Abs:xf,Acos:Vu,Acosh:Bu,AdadeltaOptimizer:_T,AdagradOptimizer:NT,AdamOptimizer:AT,AdamaxOptimizer:RT,Add:hc,AddN:wf,All:gx,Any:yx,ArgMax:vf,ArgMin:If,Asin:ju,Asinh:Uu,Atan:Wu,Atan2:Hu,Atanh:Gu,AvgPool:Sf,AvgPool3D:kf,AvgPool3DGrad:xx,AvgPoolGrad:bx,BatchMatMul:Tf,BatchToSpaceND:Cf,Bincount:wx,BitwiseAnd:Ef,BroadcastArgs:vx,BroadcastTo:jO,Callback:Mz,CallbackList:UM,Cast:qu,Ceil:Ku,ClipByValue:Xu,Complex:Ix,ComplexAbs:_f,Concat:Nf,Conv2D:Af,Conv2DBackpropFilter:Sx,Conv2DBackpropInput:Rf,Conv3D:$f,Conv3DBackpropFilterV2:kx,Conv3DBackpropInputV2:Tx,Cos:Yu,Cosh:Qu,CropAndResize:Ex,Cumprod:Cx,Cumsum:Df,CustomCallback:GM,DataStorage:ZS,DenseBincount:_x,DepthToSpace:Nx,DepthwiseConv2dNative:Pf,DepthwiseConv2dNativeBackpropFilter:Ax,DepthwiseConv2dNativeBackpropInput:Rx,Diag:$x,Dilation2D:Of,Dilation2DBackpropFilter:sb,Dilation2DBackpropInput:nb,Draw:Dx,get ENV(){return sk},EarlyStopping:zz,Einsum:Px,Elu:Ju,EluGrad:Ox,Environment:VO,Equal:Ff,Erf:eh,Exp:th,ExpandDims:Lf,Expm1:nh,FFT:Fx,Fill:Lx,FlipLeftRight:Mx,Floor:sh,FloorDiv:rh,FromPixels:rb,FusedBatchNorm:Mf,FusedConv2D:Fp,FusedDepthwiseConv2D:Lp,GPGPUContext:Sy,GatherNd:zx,GatherV2:zf,GraphModel:VE,Greater:Vf,GreaterEqual:ih,History:WM,IFFT:Vx,Identity:oh,Imag:Bx,InputSpec:_n,IsFinite:ah,IsInf:lh,IsNan:ch,KernelBackend:px,LRN:qf,LRNGrad:Ux,LayerVariable:zM,LayersModel:yo,LeakyRelu:Bf,Less:jf,LessEqual:Uf,LinSpace:jx,Log:uh,Log1p:hh,LogSoftmax:UO,LogicalAnd:Wf,LogicalNot:Gf,LogicalOr:Hf,LogicalXor:B9,LowerBound:j9,MathBackendCPU:tg,MathBackendWebGL:ig,MatrixBandPart:U9,Max:Kf,MaxPool:Xf,MaxPool3D:Yf,MaxPool3DGrad:Gx,MaxPoolGrad:Wx,MaxPoolWithArgmax:Hx,Maximum:dh,Mean:Qf,Min:Zf,Minimum:ph,MirrorPad:Jf,Mod:fh,MomentumOptimizer:$T,Multinomial:qx,Multiply:mh,Neg:em,NonMaxSuppressionV3:Kx,NonMaxSuppressionV4:Xx,NonMaxSuppressionV5:Yx,NotEqual:tm,OP_SCOPE_SUFFIX:ck,OneHot:sm,OnesLike:nm,Optimizer:Vo,OptimizerConstructors:qL,Pack:rm,PadV2:im,Pool:W9,Pow:gh,Prelu:om,Prod:am,RMSPropOptimizer:DT,RNN:Si,RaggedGather:Qx,RaggedRange:Zx,RaggedTensorToTensor:Jx,Range:ew,get Rank(){return iI},Real:tw,RealDiv:Zu,Reciprocal:yh,get Reduction(){return ks},Relu:bh,Relu6:xh,Reshape:lm,ResizeBilinear:um,ResizeBilinearGrad:sw,ResizeNearestNeighbor:cm,ResizeNearestNeighborGrad:nw,Reverse:hm,RotateWithOffset:ww,Round:wh,Rsqrt:vh,SGDOptimizer:r0,ScatterNd:rw,SearchSorted:ow,Select:dm,Selu:Ih,Sequential:Xl,Sigmoid:Ch,Sign:Th,Sin:Sh,Sinh:kh,Slice:pm,Softmax:ym,Softplus:Eh,SpaceToBatchND:mm,SparseFillEmptyRows:aw,SparseReshape:lw,SparseSegmentMean:cw,SparseSegmentSum:uw,SparseToDense:hw,SplitV:gm,Sqrt:_h,Square:dw,SquaredDifference:Nh,StaticRegexReplace:bm,Step:Ph,StridedSlice:pw,StringNGrams:fw,StringSplit:mw,StringToHashBucketFast:gw,Sub:Ah,Sum:fm,SymbolicTensor:gi,Tan:Rh,Tanh:$h,Tensor:kt,TensorBuffer:Nn,TensorScatterUpdate:iw,Tile:Dh,TopK:yw,Transform:bw,Transpose:Al,Unique:xw,Unpack:xm,UnsortedSegmentSum:wm,UpperBound:G9,Variable:Vp,ZerosLike:vm,_FusedMatMul:Op,abs:Tn,acos:yk,acosh:bk,add:pe,addN:vF,all:Tw,any:jp,argMax:Bl,argMin:xk,asin:wk,asinh:vk,atan:Ik,atan2:Sk,atanh:kk,avgPool:Tm,avgPool3d:Ck,backend:wF,backend_util:bM,basicLSTMCell:IF,batchNorm:Oh,batchNorm2d:Ek,batchNorm3d:_k,batchNorm4d:Nk,batchToSpaceND:Cm,bincount:Ak,bitwiseAnd:SF,booleanMaskAsync:lL,broadcastArgs:kF,broadcastTo:Rl,broadcast_util:v7,browser:OJ,buffer:ct,callbacks:tae,cast:ve,ceil:Rk,clipByValue:Hs,clone:Mi,complex:So,concat:xn,concat1d:$k,concat2d:Dk,concat3d:Pk,concat4d:Ok,constraints:jse,conv1d:Cw,conv2d:ko,conv2dTranspose:Ew,conv3d:Lk,conv3dTranspose:Mk,copyRegisteredKernels:X9,cos:Em,cosh:_w,cosineWindow:Yw,cumprod:Gp,cumsum:Nw,customGrad:Yi,data:fce,denseBincount:cb,deprecationWarn:nK,depthToSpace:zk,depthwiseConv2d:Fh,deregisterOp:rae,device_util:w8,diag:CF,dilation2d:Vk,disableDeprecationWarnings:tK,dispose:et,disposeVariables:sK,div:Me,divNoNan:Bk,dot:jk,dropout:ST,einsum:hl,elu:Lh,enableDebugMode:eK,enableProdMode:J8,enclosingPowerOfTwo:kT,engine:Jr,ensureShape:EF,env:X,equal:ar,erf:Uk,euclideanNorm:Gk,exp:qs,expandDims:es,expm1:Hk,eye:Aw,fft:Vm,fill:pc,findBackend:uK,findBackendFactory:hK,floor:zh,floorDiv:kw,forceHalfFloat:gB,fused:yL,gather:Vh,gatherND:dL,gather_util:FJ,getBackend:lK,getGradient:nI,getKernel:zp,getKernelsForBackend:ib,gpgpu_util:Qge,grad:rX,grads:iX,greater:Rs,greaterEqual:Lo,ifft:Su,imag:_m,image:Vr,inTopKAsync:pL,initializers:rre,input:iz,io:FT,irfft:Ww,isFinite:qk,isInf:Kk,isNaN:Xk,keep:Pn,kernel_impls:GJ,layers:$oe,leakyRelu:Nm,less:xu,lessEqual:Ua,linalg:ET,linspace:AF,loadGraphModel:Nle,loadGraphModelSync:Ale,loadLayersModel:qre,localResponseNormalization:Yk,log:lr,log1p:Am,logSigmoid:Qk,logSoftmax:$w,logSumExp:Rm,logicalAnd:Wr,logicalNot:$m,logicalOr:Dw,logicalXor:Zk,losses:kL,lowerBound:$F,matMul:pt,math:EJ,max:Sr,maxPool:Dm,maxPool3d:Jk,maxPoolWithArgmax:DF,maximum:to,mean:un,memory:lb,meshgrid:PF,metrics:Koe,min:bu,minimum:Ca,mirrorPad:eT,mod:tT,model:Yre,models:Xoe,moments:Pm,movingAverage:cL,mul:W,multiRNNCell:OF,multinomial:FF,neg:Yt,nextFrame:jT,norm:Mh,notEqual:Gl,oneHot:wu,ones:Vs,onesLike:cr,op:j,outerProduct:LF,pad:Mo,pad1d:MF,pad2d:zF,pad3d:VF,pad4d:BF,pool:nT,pow:To,prelu:Fm,print:mk,prod:sT,profile:rK,raggedGather:jF,raggedRange:UF,raggedTensorToTensor:WF,rand:GF,randomGamma:XF,randomNormal:Ow,randomStandardNormal:YF,randomUniform:Wa,randomUniformInt:QF,range:Hl,ready:aK,real:vu,reciprocal:pT,registerBackend:gk,registerCallbackConstructor:Zre,registerGradient:WO,registerKernel:vw,registerOp:sae,regularizers:Joe,relu:vi,relu6:Fw,removeBackend:cK,reshape:G,reverse:Cr,reverse1d:ZF,reverse2d:JF,reverse3d:eL,reverse4d:tL,rfft:Bm,round:Lw,rsqrt:Mw,scalar:Ue,scatterND:uL,scatter_util:aQ,searchSorted:Pw,selu:zw,separableConv2d:Vw,sequential:Qre,serialization:lJ,setBackend:oK,setPlatform:dK,setWebGLContext:bV,setdiff1dAsync:nL,shared:eV,sigmoid:oi,sign:fT,signal:SL,sin:Bw,sinh:jw,slice:St,slice1d:Lm,slice2d:Uw,slice3d:Mm,slice4d:Iu,slice_util:GL,softmax:zm,softplus:fc,spaceToBatchND:Om,sparse:TL,sparseToDense:hL,spectral:IL,split:Bs,sqrt:os,square:jt,squaredDifference:Gw,squeeze:Ga,stack:Es,step:gc,stridedSlice:mT,string:CL,sub:Ne,sum:Pe,sumOutType:Iw,tan:gT,tanh:Ul,tensor:ir,tensor1d:ss,tensor2d:fa,tensor3d:yT,tensor4d:sL,tensor5d:rL,tensor6d:iL,tensorScatterUpdate:oL,tensor_util:m8,test_util:wY,tidy:Y,tile:xr,time:iK,topk:xT,train:al,transpose:vt,truncatedNormal:qw,unique:wT,unregisterGradient:K9,unregisterKernel:q9,unsortedSegmentSum:Kw,unstack:Er,upcastType:Ws,upperBound:aL,util:s8,valueAndGrad:oX,valueAndGrads:aX,variable:vT,variableGrads:RF,version:eTe,version_converter:Uz,version_core:HL,version_cpu:tV,version_layers:I0,version_webgl:mB,webgl:gbe,webgl_util:sge,where:Wn,whereAsync:IT,zeros:En,zerosLike:Ct},Symbol.toStringTag,{value:"Module"})),U2=n=>n==="tensor"?"tensor":"base64",nTe=({output:n,progressOutput:e,...t}={})=>({...t,output:U2(n),progressOutput:U2(e||n)}),sTe={jsdelivr:(n,e,t)=>`https://cdn.jsdelivr.net/npm/${n}@${e}/${t}`,unpkg:(n,e,t)=>`https://unpkg.com/${n}@${e}/${t}`},rTe=["jsdelivr","unpkg"],iTe=(n,e,t)=>new Error([`Could not resolve URL ${e} for package ${t==null?void 0:t.name}@${t==null?void 0:t.version}`,"Errors include:",...n.map(([s,r])=>`- ${s}: ${r.message}`)].join(`
`));async function oTe(n,e){const{modelType:t,_internals:s,path:r}=e;if(r)return await wR(n,r,t);if(!s)throw new Error(cC);const i=[];for(const o of rTe){const a=sTe[o];try{const l=a(s.name,s.version,s.path);return await wR(n,l,t)}catch(l){i.push([o,l instanceof Error?l:new Error(`There was an unknown error: ${JSON.stringify(l)}`)])}}throw iTe(i,r||s.path,s)}const aTe=async(n,e)=>{const t=await e;try{XJ(t)}catch(i){throw eee(i)?Cee(i.type,t):new Error(cC)}const s=Dee(t);return{model:await oTe(n,s),modelDefinition:s}},lTe="https://upscalerjs.com/documentation/troubleshooting#environment-disallows-base64",cTe="https://upscalerjs.com/documentation/troubleshooting#environment-disallows-string-input",uTe=()=>new Error(["Environment does not support a string URL as an input format.",`For more information, see ${cTe}.`].join(`
`)),hTe=()=>new Error(["Environment does not support base64 as an output format.",`For more information, see ${lTe}.`].join(`
`)),dTe=n=>new Error([`Unsupported dimensions for incoming pixels: ${n.shape.length}.`,"Only 3 or 4 rank tensors are supported."].join(`
`)),pTe=()=>new Error(["Failed to load image"].join(" ")),fTe=n=>new Promise((e,t)=>{const s=new Image;s.src=n,s.crossOrigin="anonymous",s.onload=()=>e(s),s.onerror=()=>t(pTe())}),W2=n=>PL(n),mTe=async(n,e)=>{if(Gm(n))return n;if(qJ(n)){const t=await fTe(n);return W2(t)}return W2(n)},gTe=async(n,e)=>{const t=await mTe(e);if(HJ(t)){const s=t.expandDims(0);return t.dispose(),s}if(IM(t))return t;throw dTe(t)},yTe=(n,e)=>{const t=jee(n,e),[s,r]=e.shape,i=new ImageData(r,s);i.data.set(t);const o=document.createElement("canvas");o.width=r,o.height=s;const a=o.getContext("2d");if(!a)throw new Error("No context found");return a.putImageData(i,0,0),o.toDataURL()},G2=n=>{try{if((new Image&&"createElement"in document)!==!0)throw n()}catch{throw n()}},bTe=(n,{output:e="base64",progressOutput:t})=>{typeof n=="string"&&G2(uTe),(t==="base64"||e==="base64")&&G2(hTe)},xTe=Yee({tf:tTe,getUpscaleOptions:nTe,loadModel:aTe,getImageAsTensor:gTe,tensorAsBase64:yTe,checkValidEnvironment:bTe});let Vc=null,H2="idle",wTe=null;const m_=()=>{const n=te.useRef(null);return{initWorker:()=>(Vc||(Vc=new Worker(new URL("/assets/llm.worker-89b52568.js",self.location),{type:"module"}),H2="loading",Vc.postMessage({type:"load",model:"Xenova/LaMini-Flan-T5-248M"})),n.current=Vc,Vc),getWorker:()=>Vc,getStatus:()=>H2,getProgress:()=>wTe}},vTe={print:{numberofcolors:8,pathomit:12,blurradius:0},logo:{numberofcolors:4,ltres:.5,qtres:.5,rightangleenhance:!0},illustration:{numberofcolors:32,ltres:1,qtres:1},cnc:{numberofcolors:2,colorsampling:0,blurradius:0,blurdelta:0},embroidery:{numberofcolors:6,pathomit:20}},ht={container:{width:"100%",height:"100%",display:"flex",flexDirection:"column",padding:"20px",color:"#e9eef6",fontFamily:'"JetBrains Mono", monospace',boxSizing:"border-box"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",borderBottom:"1px solid #222",paddingBottom:"12px",flexShrink:0},title:{fontSize:"1.25rem",fontWeight:800,color:"#0aff6a",display:"flex",alignItems:"center",gap:"12px",textTransform:"uppercase",letterSpacing:"1px"},tabContainer:{display:"flex",gap:"4px",background:"#111",padding:"4px",borderRadius:"8px",marginBottom:"20px",flexShrink:0},tab:n=>({flex:1,padding:"10px",border:"none",background:n?"#222":"transparent",color:n?"#0aff6a":"#666",borderRadius:"6px",cursor:"pointer",fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s ease",fontSize:"0.85rem"}),section:{flex:1,display:"flex",flexDirection:"column",gap:"16px",overflow:"hidden"},grid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:"12px",overflowY:"auto",paddingRight:"4px"},inputGroup:{display:"flex",flexDirection:"column",gap:"4px"},label:{fontSize:"0.7rem",color:"#888",textTransform:"uppercase",letterSpacing:"0.5px",fontWeight:600},input:{background:"#050505",border:"1px solid #333",padding:"10px",borderRadius:"6px",color:"white",fontSize:"0.85rem",fontFamily:"inherit",outline:"none",transition:"border-color 0.2s"},select:{background:"#050505",border:"1px solid #333",padding:"10px",borderRadius:"6px",color:"white",fontSize:"0.85rem",fontFamily:"inherit",cursor:"pointer"},button:{background:"#0aff6a",color:"black",border:"none",padding:"14px",borderRadius:"8px",fontWeight:700,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",fontSize:"0.9rem",textTransform:"uppercase",transition:"transform 0.1s"},resultBox:{background:"#1a1a1a",border:"1px dashed #444",borderRadius:"8px",padding:"24px",marginTop:"16px",position:"relative"},promptText:{color:"#ccc",lineHeight:1.6,fontSize:"0.95rem",whiteSpace:"pre-wrap"},dropZone:{border:"2px dashed #333",borderRadius:"12px",padding:"48px",textAlign:"center",cursor:"pointer",transition:"border-color 0.2s",background:"#080808"},svgPreview:{width:"100%",height:"300px",background:"transparent",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",border:"1px solid #333",borderRadius:"8px"}};function ITe(){const[n,e]=te.useState("architect"),[t,s]=te.useState({subject:"",industry:"tech",assetType:"logo",style:"minimal",composition:"centered",mood:"professional",palette:"monochrome",customColors:["#000000","#ffffff","#333333","#666666","#999999"]}),[r,i]=te.useState(""),[o,a]=te.useState(!1),[l,c]=te.useState(null),[u,h]=te.useState(null),[d,p]=te.useState(50),[f,g]=te.useState(1),[m,y]=te.useState(!1),[w,v]=te.useState(!1),[I,_]=te.useState(!1),[N,T]=te.useState(!1),[E,k]=te.useState(null),S=te.useRef(null),A=te.useRef(null),[P,D]=te.useState(!1),[V,U]=te.useState("pro"),[q,J]=te.useState(!1),[K,ee]=te.useState(!1),[L,ae]=te.useState(!1),[ce,z]=te.useState(null),[ue,de]=te.useState(null),[be,Ee]=te.useState(null),[Re,_e]=te.useState(null),Ae=te.useRef(null),je=te.useRef(!1),{getWorker:qe,getStatus:gt}=m_(),Et=()=>{const ne=navigator.deviceMemory||4;return ne<4?{compatible:!1,reason:`Insufficient RAM (${ne}GB detected). The Max Power AI requires at least 4GB.`}:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&ne<6?{compatible:!1,reason:"Mobile device detected. High-performance AI requires a desktop environment or high-end mobile device."}:{compatible:!0}},ot=(ne="Xenova/LaMini-Flan-T5-248M")=>{const Z=qe();Ae.current&&Ae.current!==Z&&Ae.current.terminate();try{const ye=Z||new eH;if(ye.onmessage=Le=>{const{type:nt,data:Lt,text:lt,error:Wt}=Le.data;if(nt==="progress")z(Lt);else if(nt==="ready")ae(!0),je.current||ee(!1),z(null);else if(nt==="result"){je.current=!1;let Mt=lt.replace(/^The professional vector logo for ".*?" is: /i,"").replace(/^The visual elements.*?are:\s*/i,"").replace(/^The design concept is a /,"A ").replace(/^The design concept is /,"").replace(/^This is a /,"A ").replace(/^Here is a /,"A ").replace(/^\d+\.\s*Title:.*?(?=\d+\.|A )/i,"").trim();Mt.startsWith("A The ")&&(Mt=Mt.replace("A The ","A ")),Mt.match(/^\d+\./)&&(Mt=Mt.replace(/^\d+\.\s*/,"")),Mt=Mt.charAt(0).toUpperCase()+Mt.slice(1),de(Mt),ee(!1)}else nt==="error"&&(console.error("AI Worker Error:",Wt),ee(!1),Wt.message&&Wt.message.includes("offset is out of bounds")?_e("Browser Memory Limit Reached. The 'Ultra' model is too large for this browser tab's allocated memory (WASM Limit), even with 16GB RAM."):_e("AI Engine Failure: "+(Wt.message||"Unknown error.")),J(!1))},ye.onerror=Le=>{console.error("Worker Script Error:",Le),ee(!1),_e("Critical Worker Failure. The AI model crashed the browser tab (Out of Memory)."),J(!1)},Ae.current=ye,!Z)ye.postMessage({type:"load",model:ne});else{const Le=gt();Le==="ready"?(ae(!0),ee(!1)):Le==="loading"&&ee(!0)}}catch(ye){console.error("Failed to initialize AI Worker",ye)}};te.useEffect(()=>{if(Et().compatible)return ot(),()=>{Ae.current&&(Ae.current.onmessage=null,Ae.current.onerror=null)}},[]);const xt=()=>{Ae.current&&(Ae.current.terminate(),Ae.current=null),ee(!1),z(null),ae(!1),je.current=!1},Rt=()=>{ee(!0),z(null);let ne="Xenova/LaMini-Flan-T5-248M";V==="lite"&&(ne="Xenova/LaMini-Flan-T5-77M"),ot(ne)},It=ne=>{if(ne!==V&&(U(ne),ae(!1),z(null),Ae.current)){let Z="Xenova/LaMini-Flan-T5-248M";ne==="lite"&&(Z="Xenova/LaMini-Flan-T5-77M"),Ae.current.postMessage({type:"load",model:Z})}},yn=()=>{const ne=Et();if(!ne.compatible){_e(ne.reason||"System incompatible");return}if(!Ae.current){alert("AI Brain is initializing... Please wait a moment.");return}if(!t.subject.trim()){alert("Please type a subject (e.g. 'Cyberpunk Wolf') in the text box first!");return}ee(!0),je.current=!0,de(null),Ee(t.subject);const Z=`${t.subject} in ${t.style} style for ${t.industry}`;Ae.current.postMessage({type:"enhance",text:Z,id:Date.now(),model:"Xenova/LaMini-Flan-T5-783M"})},at=()=>{const{subject:ne,industry:Z,assetType:ye,style:Le,composition:nt,mood:Lt,palette:lt,customColors:Wt}=t,Mt=VA[ye].keywords,Qs=MA[Z].keywords,bs=zA[Le].keywords,Uo=BA[nt].keywords,$c=jA[Lt].keywords;let Jt="";if(lt==="custom")Jt=`custom palette: ${Wt.join(", ")}`;else{const pd=Rv[lt];pd?Jt=`${pd.keywords}, palette: ${pd.colors.join(", ")}`:Jt=`custom palette: ${Wt.join(", ")}`}const Wo=`/imagine prompt: professional vector graphics of ${ne}, ${Mt}, ${Qs}, ${bs}, ${$c}, ${Uo}, ${Jt}, award winning, behance feature, dribbble style, vectorizer.ai ready, perfect composition, white background, flat color, 2d, no gradients, clean lines, svg style, high contrast --v 6.0 --stylize 250 --no photorealistic, 3d render, blur, noise, watermark, text, realistic photo, shading, complex details`;i(Wo),D(!0)},zt=()=>{navigator.clipboard.writeText(r),a(!0),setTimeout(()=>a(!1),2e3)},ln=ne=>{var Le;const Z=(Le=ne.target.files)==null?void 0:Le[0];if(!Z)return;v(!0);const ye=new FileReader;ye.onload=nt=>{var Wt;const Lt=(Wt=nt.target)==null?void 0:Wt.result;h(Lt);const lt=new Image;lt.src=Lt,lt.onload=()=>{const Mt=document.createElement("canvas");Mt.width=lt.width,Mt.height=lt.height;const Qs=Mt.getContext("2d");if(!Qs){v(!1);return}Qs.drawImage(lt,0,0);const bs=Qs.getImageData(0,0,lt.width,lt.height),$c={...{ltres:1,qtres:1,pathomit:8,rightangleenhance:!0,colorsampling:2,numberofcolors:16,mincolorratio:0,colorquantcycles:3,scale:1,simplifytolerance:0,roundcoords:1,lcpr:0,qcpr:0,desc:!1,viewbox:!0,blurradius:0,blurdelta:20},...E?vTe[E]:{}},Jt=new J6;Jt.onmessage=ro=>{ro.data.type==="success"?c(ro.data.svg):console.error("Vectorization failed:",ro.data.error),v(!1),Jt.terminate()},Jt.onerror=ro=>{console.error("Worker error:",ro),v(!1),Jt.terminate()},Jt.postMessage({imageData:{width:bs.width,height:bs.height,data:bs.data},options:$c})}},ye.readAsDataURL(Z)},Ps=async()=>{if(u){_(!0);try{const ne=await v9(u),Z=URL.createObjectURL(ne);h(Z)}catch(ne){console.error("Background removal failed:",ne),alert("Failed to remove background. Please try a different image.")}finally{_(!1)}}},qt=async()=>{if(u){T(!0);try{const Z=await new xTe().upscale(u);h(Z)}catch(ne){console.error("Upscaling failed:",ne),alert("Failed to upscale image. It might be too large or format unsupported.")}finally{T(!1)}}},Yn=()=>{if(!l)return;const ne=new Blob([l],{type:"image/svg+xml"}),Z=URL.createObjectURL(ne),ye=document.createElement("a");ye.href=Z,ye.download="vector-trace.svg",document.body.appendChild(ye),ye.click(),document.body.removeChild(ye)},ie=async()=>{if(l)try{const{jsPDF:ne}=await gp(()=>import("./jspdf.es.min-82389a91.js").then(lt=>lt.j),[]);await gp(()=>import("./svg2pdf.es.min-d4bac280.js"),["assets/svg2pdf.es.min-d4bac280.js","assets/vendor-e72fc605.js","assets/jspdf.es.min-82389a91.js","assets/utils-e8ee15a8.js"]);const Z=document.createElement("div");Z.innerHTML=l;const ye=Z.firstElementChild;if(!ye)return;let Le=595.28,nt=841.89;if(ye.hasAttribute("viewBox")){const lt=ye.getAttribute("viewBox").split(" ").map(Number);Le=lt[2],nt=lt[3]}else ye.hasAttribute("width")&&ye.hasAttribute("height")&&(Le=parseFloat(ye.getAttribute("width")),nt=parseFloat(ye.getAttribute("height")));const Lt=new ne({orientation:Le>nt?"landscape":"portrait",unit:"pt",format:[Le,nt]});await Lt.svg(ye,{x:0,y:0,width:Le,height:nt}),Lt.save("vector-trace.pdf")}catch(ne){console.error("PDF generation failed:",ne),alert("Failed to generate PDF. Please try downloading SVG instead.")}},fe=ne=>{if(!A.current)return;const Z=A.current.getBoundingClientRect(),ye="touches"in ne?ne.touches[0].clientX:ne.clientX,Le=Math.max(0,Math.min(ye-Z.left,Z.width));p(Le/Z.width*100)},ze=()=>{y(!m),g(1)},Ke=ne=>{g(Z=>Math.max(.5,Math.min(5,Z+ne)))};return x.jsxs("div",{style:ht.container,children:[x.jsxs("div",{style:ht.header,children:[x.jsxs("div",{style:ht.title,children:[x.jsx(lu,{size:24}),"Vector Command Center"]}),x.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[x.jsxs("a",{href:"/downloads/WordHacker404-Setup.zip",download:!0,style:{display:"flex",alignItems:"center",gap:"8px",background:"rgba(10, 255, 106, 0.1)",border:"1px solid rgba(10, 255, 106, 0.3)",padding:"6px 12px",borderRadius:"4px",color:"#0aff6a",fontSize:"0.8rem",textDecoration:"none",cursor:"pointer",fontWeight:600},title:"Download Desktop App for better performance",children:[x.jsx(mp,{size:14}),x.jsx("span",{children:"GET DESKTOP APP"})]}),x.jsx("div",{style:{fontSize:"0.8rem",color:"#444"},children:"v1.0.0"})]})]}),x.jsxs("div",{style:ht.tabContainer,children:[x.jsxs("button",{style:ht.tab(n==="architect"),onClick:()=>e("architect"),children:[x.jsx(BS,{size:18}),"Prompt Architect"]}),x.jsxs("button",{style:ht.tab(n==="vectorizer"),onClick:()=>e("vectorizer"),children:[x.jsx(NG,{size:18}),"Vectorizer"]})]}),n==="architect"&&x.jsxs("div",{style:ht.section,children:[x.jsxs("div",{style:ht.grid,children:[x.jsxs("div",{style:{...ht.inputGroup,gridColumn:"1 / -1"},children:[x.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[x.jsx("label",{style:ht.label,children:"Subject / Concept"}),x.jsx("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:q?x.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[x.jsxs("div",{style:{display:"flex",background:"#111",borderRadius:"4px",border:"1px solid #333",overflow:"hidden"},children:[x.jsx("button",{onClick:()=>It("lite"),style:{background:V==="lite"?"#222":"transparent",color:V==="lite"?"#fff":"#666",border:"none",padding:"4px 8px",fontSize:"0.7rem",cursor:"pointer",fontWeight:600},title:"Fast (77M) - Good for simple ideas",children:"LITE"}),x.jsx("button",{onClick:()=>It("pro"),style:{background:V==="pro"?"#0aff6a":"transparent",color:V==="pro"?"#000":"#666",border:"none",padding:"4px 8px",fontSize:"0.7rem",cursor:"pointer",fontWeight:800},title:"Balanced (248M) - Recommended for most users",children:"PRO"})]}),x.jsxs("span",{style:{color:"#0aff6a",fontSize:"0.75rem",display:"flex",alignItems:"center",gap:"6px",fontWeight:"600"},children:[x.jsx(kv,{size:14})," AI Active"]})]}):x.jsxs("button",{onClick:()=>J(!0),style:{background:"rgba(10, 255, 106, 0.1)",border:"1px solid #0aff6a",borderRadius:"4px",color:"#0aff6a",fontSize:"0.75rem",padding:"4px 12px",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",fontWeight:"600",boxShadow:"0 0 10px rgba(10, 255, 106, 0.1)"},children:[x.jsx(kv,{size:14})," Enable AI Brain"]})})]}),x.jsxs("div",{style:{display:"flex",gap:"8px"},children:[x.jsx("input",{style:{...ht.input,flex:1},placeholder:"e.g. A cybernetic wolf head...",value:t.subject,onChange:ne=>s({...t,subject:ne.target.value})}),q&&x.jsx("button",{onClick:yn,disabled:K,style:{background:K?"#222":"#1a1a1a",border:"1px solid #333",borderRadius:"8px",color:"#0aff6a",padding:"0 16px",cursor:K?"wait":"pointer",display:"flex",alignItems:"center",gap:"8px",boxShadow:K?"none":"0 0 8px rgba(10, 255, 106, 0.2)",minWidth:"110px",justifyContent:"center",transition:"all 0.2s"},title:"Enhance with AI",children:K?x.jsxs(x.Fragment,{children:[x.jsx(uy,{size:16,className:"spin",style:{animation:"spin 1s linear infinite"}}),x.jsx("span",{children:"Thinking"})]}):x.jsxs(x.Fragment,{children:[x.jsx(sa,{size:16}),x.jsx("span",{children:"Enhance"})]})})]}),(K||ce&&!L)&&x.jsx("div",{style:{marginTop:"8px",padding:"12px",background:"#0b0b0d",border:"1px solid #222",borderRadius:"8px"},children:ce||!L&&K?x.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",alignItems:"center",padding:"20px"},children:[x.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",color:"#0aff6a",fontSize:"0.9rem",fontWeight:"bold"},children:[x.jsx(uy,{size:20,className:"spin",style:{animation:"spin 1s linear infinite"}}),x.jsx("span",{children:ce?`DOWNLOADING NEURAL CORE (${Math.round(ce.progress||0)}%)`:"CONNECTING..."})]}),x.jsx("div",{style:{width:"100%",maxWidth:"300px",height:"6px",background:"#222",borderRadius:"3px",overflow:"hidden",position:"relative"},children:x.jsx("div",{style:{width:`${Math.round((ce==null?void 0:ce.progress)||0)}%`,height:"100%",background:"#0aff6a",transition:"width 0.2s ease-out"}})}),x.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",maxWidth:"300px",fontSize:"0.7rem",color:"#666",fontFamily:"monospace"},children:[x.jsx("span",{children:(ce==null?void 0:ce.file)||"Initializing..."}),x.jsx("span",{children:ce!=null&&ce.loaded?(ce.loaded/1024/1024).toFixed(1)+"MB":""})]}),x.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"8px"},children:[x.jsx("button",{onClick:xt,style:{background:"transparent",border:"1px solid #333",color:"#666",padding:"6px 12px",borderRadius:"4px",fontSize:"0.7rem",cursor:"pointer",textTransform:"uppercase",letterSpacing:"1px"},children:"Cancel"}),x.jsx("button",{onClick:Rt,style:{background:"rgba(10, 255, 106, 0.1)",border:"1px solid rgba(10, 255, 106, 0.3)",color:"#0aff6a",padding:"6px 12px",borderRadius:"4px",fontSize:"0.7rem",cursor:"pointer",textTransform:"uppercase",letterSpacing:"1px"},children:"Retry / Resume"})]})]}):x.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",color:"#0aff6a",fontSize:"0.8rem"},children:[x.jsx(uy,{size:14,className:"spin",style:{animation:"spin 1s linear infinite"}}),x.jsx("span",{style:{animation:"pulse 1.5s infinite"},children:"AI is dreaming up concepts..."})]})}),ue&&x.jsxs("div",{style:{marginTop:"24px",display:"flex",flexDirection:"column",gap:"16px"},children:[x.jsxs("div",{style:{padding:"12px 16px",background:"rgba(255, 255, 255, 0.02)",border:"1px dashed #333",borderRadius:"8px",fontSize:"0.85rem",color:"#888",position:"relative",display:"flex",alignItems:"center",gap:"12px"},children:[x.jsx("div",{style:{background:"#222",padding:"2px 6px",borderRadius:"4px",fontSize:"0.65rem",color:"#666",letterSpacing:"1px",textTransform:"uppercase",whiteSpace:"nowrap"},children:"Original Input"}),x.jsxs("div",{style:{fontStyle:"italic",color:"#aaa"},children:['"',be,'"']})]}),x.jsx("div",{style:{display:"flex",justifyContent:"center",color:"#0aff6a",opacity:.5},children:x.jsx(IA,{size:20,style:{transform:"rotate(180deg)"}})}),x.jsxs("div",{style:{padding:"24px",background:"linear-gradient(145deg, rgba(10, 255, 106, 0.05) 0%, rgba(0,0,0,0.4) 100%)",border:"1px solid #0aff6a",borderRadius:"12px",position:"relative",display:"flex",flexDirection:"column",boxShadow:"0 0 20px rgba(10, 255, 106, 0.05)"},children:[x.jsxs("div",{style:{position:"absolute",top:"-10px",left:"20px",background:"#0b0b0d",padding:"0 8px",fontSize:"0.75rem",color:"#0aff6a",fontWeight:"bold",display:"flex",alignItems:"center",gap:"6px",border:"1px solid #0aff6a",borderRadius:"4px"},children:[x.jsx(sa,{size:12})," AI ENHANCED CONCEPT"]}),x.jsx("div",{style:{marginTop:"8px",marginBottom:"20px",color:"#fff",fontSize:"1.15rem",lineHeight:"1.6",whiteSpace:"pre-wrap",fontWeight:"500",textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:ue}),x.jsxs("button",{onClick:()=>{s({...t,subject:ue}),de(null),Ee(null)},style:{display:"flex",alignItems:"center",gap:"8px",background:"#0aff6a",border:"none",borderRadius:"6px",padding:"12px 20px",color:"#000",fontSize:"0.9rem",fontWeight:"800",cursor:"pointer",width:"100%",justifyContent:"center",transition:"all 0.2s",boxShadow:"0 4px 12px rgba(10, 255, 106, 0.2)",textTransform:"uppercase",letterSpacing:"0.5px"},children:[x.jsx(sa,{size:16})," Use This Concept"]})]})]})]}),x.jsxs("div",{style:ht.inputGroup,children:[x.jsx("label",{style:ht.label,children:"Industry / Niche"}),x.jsx("select",{style:ht.select,value:t.industry,onChange:ne=>s({...t,industry:ne.target.value}),children:Object.entries(MA).map(([ne,Z])=>x.jsx("option",{value:ne,children:Z.label},ne))})]}),x.jsxs("div",{style:ht.inputGroup,children:[x.jsx("label",{style:ht.label,children:"Asset Type"}),x.jsx("select",{style:ht.select,value:t.assetType,onChange:ne=>s({...t,assetType:ne.target.value}),children:Object.entries(VA).map(([ne,Z])=>x.jsx("option",{value:ne,children:Z.label},ne))})]}),x.jsxs("div",{style:ht.inputGroup,children:[x.jsx("label",{style:ht.label,children:"Art Style"}),x.jsx("select",{style:ht.select,value:t.style,onChange:ne=>s({...t,style:ne.target.value}),children:Object.entries(zA).map(([ne,Z])=>x.jsx("option",{value:ne,children:Z.label},ne))})]}),x.jsxs("div",{style:ht.inputGroup,children:[x.jsx("label",{style:ht.label,children:"Composition"}),x.jsx("select",{style:ht.select,value:t.composition,onChange:ne=>s({...t,composition:ne.target.value}),children:Object.entries(BA).map(([ne,Z])=>x.jsx("option",{value:ne,children:Z.label},ne))})]}),x.jsxs("div",{style:ht.inputGroup,children:[x.jsx("label",{style:ht.label,children:"Mood / Vibe"}),x.jsx("select",{style:ht.select,value:t.mood,onChange:ne=>s({...t,mood:ne.target.value}),children:Object.entries(jA).map(([ne,Z])=>x.jsx("option",{value:ne,children:Z.label},ne))})]}),x.jsxs("div",{style:{...ht.inputGroup,gridColumn:"1 / -1"},children:[x.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[x.jsx("label",{style:ht.label,children:"Project Palette (5 Colors)"}),x.jsx("button",{onClick:()=>{const ne=Object.keys(Rv),Z=ne[Math.floor(Math.random()*ne.length)],Le=[...Rv[Z].colors];for(;Le.length<5;)Le.push(Le[Le.length-1]||"#000000");s({...t,palette:"custom",customColors:Le.slice(0,5)})},style:{background:"none",border:"none",color:"#0aff6a",fontSize:"0.75rem",cursor:"pointer",textDecoration:"underline"},children:"Shuffle Preset"})]}),x.jsx("div",{style:{display:"flex",gap:"8px"},children:t.customColors.map((ne,Z)=>x.jsx("div",{style:{flex:1,height:"48px",background:ne,borderRadius:"8px",border:"1px solid #333",position:"relative",cursor:"pointer",overflow:"hidden",transition:"transform 0.1s"},title:"Click to change color",children:x.jsx("input",{type:"color",value:ne,onChange:ye=>{const Le=[...t.customColors];Le[Z]=ye.target.value,s({...t,palette:"custom",customColors:Le})},style:{position:"absolute",top:"-50%",left:"-50%",width:"200%",height:"200%",opacity:0,cursor:"pointer"}})},Z))})]})]}),x.jsxs("button",{style:{...ht.button,marginTop:"auto"},onClick:at,children:[x.jsx(sa,{size:18})," Generate Engineering Prompt"]}),ue&&x.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(12px)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",animation:"fadeIn 0.3s ease-out"},children:x.jsxs("div",{style:{width:"90%",maxWidth:"600px",background:"#0b0b0d",border:"1px solid #0aff6a",borderRadius:"16px",boxShadow:"0 0 50px rgba(10, 255, 106, 0.15)",overflow:"hidden",display:"flex",flexDirection:"column",animation:"slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1)"},children:[x.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid #222",display:"flex",justifyContent:"space-between",alignItems:"center",background:"linear-gradient(90deg, rgba(10, 255, 106, 0.05) 0%, transparent 100%)"},children:[x.jsxs("span",{style:{color:"#0aff6a",fontWeight:"800",display:"flex",alignItems:"center",gap:"10px",letterSpacing:"1px",fontSize:"0.9rem"},children:[x.jsx(kv,{size:20})," AI ARCHITECT"]}),x.jsx("button",{onClick:()=>de(null),style:{background:"none",border:"none",color:"#666",cursor:"pointer",padding:"4px",borderRadius:"4px",transition:"all 0.2s"},onMouseEnter:ne=>ne.currentTarget.style.color="#fff",onMouseLeave:ne=>ne.currentTarget.style.color="#666",children:x.jsx(El,{size:24})})]}),x.jsxs("div",{style:{padding:"32px 24px",color:"#e9eef6",fontSize:"1.15rem",lineHeight:"1.6",fontFamily:'"Inter", sans-serif',fontWeight:"500"},children:[x.jsx("div",{style:{fontSize:"0.75rem",color:"#666",marginBottom:"12px",textTransform:"uppercase",letterSpacing:"1px"},children:"Enhanced Concept"}),ue]}),x.jsxs("div",{style:{padding:"24px",display:"flex",gap:"16px",background:"#111",borderTop:"1px solid #222"},children:[x.jsx("button",{onClick:yn,style:{flex:.5,background:"transparent",border:"1px solid #333",color:"#888",padding:"14px",borderRadius:"8px",cursor:"pointer",fontWeight:"600",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},title:"Regenerate",onMouseEnter:ne=>{ne.currentTarget.style.borderColor="#666",ne.currentTarget.style.color="#fff"},onMouseLeave:ne=>{ne.currentTarget.style.borderColor="#333",ne.currentTarget.style.color="#888"},children:x.jsx(AG,{size:18})}),x.jsx("button",{onClick:()=>de(null),style:{flex:1,background:"transparent",border:"1px solid #333",color:"#888",padding:"14px",borderRadius:"8px",cursor:"pointer",fontWeight:"600",transition:"all 0.2s"},onMouseEnter:ne=>{ne.currentTarget.style.borderColor="#666",ne.currentTarget.style.color="#fff"},onMouseLeave:ne=>{ne.currentTarget.style.borderColor="#333",ne.currentTarget.style.color="#888"},children:"Discard"}),x.jsxs("button",{onClick:()=>{s({...t,subject:ue}),de(null),Ee(null)},style:{flex:2,background:"#0aff6a",border:"none",color:"#000",padding:"14px",borderRadius:"8px",cursor:"pointer",fontWeight:"800",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",boxShadow:"0 4px 12px rgba(10, 255, 106, 0.25)",transition:"transform 0.1s"},onMouseDown:ne=>ne.currentTarget.style.transform="scale(0.98)",onMouseUp:ne=>ne.currentTarget.style.transform="scale(1)",children:[x.jsx(sa,{size:18})," Use Concept"]})]})]})}),Re&&x.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.9)",backdropFilter:"blur(10px)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:x.jsxs("div",{style:{background:"#0b0b0d",border:"1px solid #d92e2e",borderRadius:"16px",padding:"32px",maxWidth:"500px",width:"100%",boxShadow:"0 0 50px rgba(217, 46, 46, 0.2)",animation:"popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)"},children:[x.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px",color:"#d92e2e"},children:[x.jsx(By,{size:32}),x.jsx("h2",{style:{margin:0,fontSize:"1.5rem",textTransform:"uppercase",letterSpacing:"1px"},children:"System Incompatible"})]}),x.jsx("p",{style:{color:"#e9eef6",lineHeight:"1.6",marginBottom:"24px",fontSize:"1rem"},children:Re}),x.jsxs("div",{style:{background:"#1a1a1a",padding:"16px",borderRadius:"8px",marginBottom:"24px",borderLeft:"4px solid #d92e2e"},children:[x.jsx("div",{style:{color:"#888",fontSize:"0.8rem",textTransform:"uppercase",marginBottom:"8px",fontWeight:"bold"},children:"Recommendation"}),x.jsx("div",{style:{color:"#ccc",fontSize:"0.9rem"},children:'Please try accessing this tool from a desktop computer with at least 8GB of RAM and a modern GPU. The "Max Power" AI model is too heavy for this device.'})]}),x.jsx("button",{onClick:()=>_e(null),style:{width:"100%",background:"#d92e2e",color:"#fff",border:"none",padding:"14px",borderRadius:"8px",fontWeight:"bold",cursor:"pointer",textTransform:"uppercase",letterSpacing:"1px"},children:"Acknowledge & Close"})]})}),P&&x.jsxs("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.8)",backdropFilter:"blur(8px)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},onClick:()=>D(!1),children:[x.jsxs("div",{style:{background:"#111",border:"1px solid #333",borderRadius:"16px",padding:"32px",width:"100%",maxWidth:"900px",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 20px 50px rgba(0,0,0,0.5)",position:"relative",animation:"popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)"},onClick:ne=>ne.stopPropagation(),children:[x.jsx("button",{onClick:()=>D(!1),style:{position:"absolute",top:"16px",right:"16px",background:"none",border:"none",color:"#666",cursor:"pointer"},children:x.jsx(El,{size:24})}),x.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"24px",color:"#0aff6a"},children:[x.jsx(L1,{size:32}),x.jsx("h2",{style:{margin:0,fontSize:"1.5rem"},children:"Prompt Generated"})]}),x.jsx("div",{style:{background:"#050505",padding:"20px",borderRadius:"8px",border:"1px dashed #333",marginBottom:"24px"},children:x.jsx("div",{style:ht.promptText,children:r})}),x.jsx("div",{style:{display:"flex",gap:"12px"},children:x.jsxs("button",{onClick:zt,style:{...ht.button,flex:1},children:[o?x.jsx(L1,{size:18}):x.jsx(RG,{size:18}),o?"Copied to Clipboard":"Copy Prompt"]})}),x.jsxs("div",{style:{marginTop:"24px",paddingTop:"24px",borderTop:"1px solid #222"},children:[x.jsx("h3",{style:{color:"#fff",fontSize:"1rem",marginBottom:"12px"},children:"Prompt Engineering Breakdown"}),x.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px"},children:[x.jsxs("div",{style:{background:"#1a1a1a",padding:"12px",borderRadius:"8px"},children:[x.jsx("div",{style:{color:"#0aff6a",fontSize:"0.75rem",fontWeight:700,marginBottom:"4px"},children:"ROLE & CONTEXT"}),x.jsx("div",{style:{color:"#888",fontSize:"0.8rem"},children:'Sets the AI behavior to "Professional Vector Artist" to ensure high-quality output.'})]}),x.jsxs("div",{style:{background:"#1a1a1a",padding:"12px",borderRadius:"8px"},children:[x.jsx("div",{style:{color:"#0aff6a",fontSize:"0.75rem",fontWeight:700,marginBottom:"4px"},children:"STYLE MODIFIERS"}),x.jsx("div",{style:{color:"#888",fontSize:"0.8rem"},children:'Keywords like "flat color", "clean lines", and "svg style" force the AI to avoid photorealism.'})]}),x.jsxs("div",{style:{background:"#1a1a1a",padding:"12px",borderRadius:"8px"},children:[x.jsx("div",{style:{color:"#0aff6a",fontSize:"0.75rem",fontWeight:700,marginBottom:"4px"},children:"QUALITY BOOSTERS"}),x.jsx("div",{style:{color:"#888",fontSize:"0.8rem"},children:'"Behance feature" and "award winning" trigger higher aesthetic standards in the model.'})]}),x.jsxs("div",{style:{background:"#1a1a1a",padding:"12px",borderRadius:"8px"},children:[x.jsx("div",{style:{color:"#0aff6a",fontSize:"0.75rem",fontWeight:700,marginBottom:"4px"},children:"NEGATIVE PROMPTS"}),x.jsx("div",{style:{color:"#888",fontSize:"0.8rem"},children:'Explicitly forbids "3d render", "blur", and "shading" to ensure a clean vector-ready result.'})]})]}),x.jsxs("div",{style:{marginTop:"16px",display:"flex",alignItems:"center",gap:"8px",color:"#888",fontSize:"0.9rem"},children:[x.jsx("span",{style:{background:"#222",padding:"2px 8px",borderRadius:"4px",color:"#0aff6a",fontSize:"0.75rem",fontWeight:700},children:"PRO TIP"}),x.jsx("span",{children:'This prompt is optimized for Midjourney v6. For DALL-E 3, remove the "--v 6.0" parameter.'})]})]})]}),x.jsx("style",{children:`
                @keyframes popIn {
                  from { opacity: 0; transform: scale(0.9); }
                  to { opacity: 1; transform: scale(1); }
                }
                @keyframes spin {
                  from { transform: rotate(0deg); }
                  to { transform: rotate(360deg); }
                }
                @keyframes pulse {
                  0% { opacity: 0.6; }
                  50% { opacity: 1; }
                  100% { opacity: 0.6; }
                }
              `})]})]}),n==="vectorizer"&&x.jsx("div",{style:ht.section,children:E?l?x.jsxs("div",{style:ht.section,children:[x.jsxs("div",{style:{...ht.resultBox,padding:0,overflow:"hidden",height:m?"85vh":"400px",position:m?"fixed":"relative",top:m?"50%":"auto",left:m?"50%":"auto",transform:m?"translate(-50%, -50%)":"none",width:m?"95vw":"100%",maxWidth:m?"1200px":"100%",zIndex:m?1e3:1,cursor:"col-resize",background:"#000",border:m?"1px solid #333":ht.resultBox.border},ref:A,onMouseMove:ne=>ne.buttons===1&&fe(ne),onTouchMove:fe,onClick:fe,children:[x.jsxs("div",{style:{position:"absolute",top:"16px",right:"16px",zIndex:20,display:"flex",gap:"8px",background:"rgba(0,0,0,0.6)",padding:"4px",borderRadius:"8px",backdropFilter:"blur(4px)"},children:[x.jsx("button",{onClick:ne=>{ne.stopPropagation(),Ke(-.25)},style:{background:"none",border:"none",color:"#fff",cursor:"pointer"},children:x.jsx($G,{size:20})}),x.jsxs("span",{style:{color:"#0aff6a",fontSize:"0.8rem",display:"flex",alignItems:"center"},children:[Math.round(f*100),"%"]}),x.jsx("button",{onClick:ne=>{ne.stopPropagation(),Ke(.25)},style:{background:"none",border:"none",color:"#fff",cursor:"pointer"},children:x.jsx(DG,{size:20})}),x.jsx("div",{style:{width:"1px",background:"#444",margin:"0 4px"}}),x.jsx("button",{onClick:ne=>{ne.stopPropagation(),ze()},style:{background:"none",border:"none",color:"#fff",cursor:"pointer"},children:m?x.jsx(PG,{size:20}):x.jsx(OG,{size:20})})]}),x.jsxs("div",{style:{width:"100%",height:"100%",position:"relative",transform:`scale(${f})`,transformOrigin:"center",transition:"transform 0.1s ease-out"},children:[u&&x.jsx("img",{src:u,alt:"Original",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"contain",opacity:.5,filter:"grayscale(100%)"}}),x.jsx("div",{style:{position:"absolute",top:0,left:0,width:`${d}%`,height:"100%",overflow:"hidden",borderRight:"2px solid #0aff6a",background:"#1a1a1a"},children:x.jsx("div",{style:{width:m?"95vw":"100%",maxWidth:m?"1200px":"900px",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:x.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},dangerouslySetInnerHTML:{__html:l}})})})]}),x.jsxs("div",{style:{position:"absolute",top:"50%",left:`${d}%`,transform:"translate(-50%, -50%)",width:"32px",height:"32px",background:"#0aff6a",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 0 10px rgba(0,0,0,0.5)",pointerEvents:"none",zIndex:10},children:[x.jsx("div",{style:{width:"2px",height:"12px",background:"#000",margin:"0 2px"}}),x.jsx("div",{style:{width:"2px",height:"12px",background:"#000",margin:"0 2px"}})]}),x.jsx("div",{style:{position:"absolute",bottom:"12px",left:"12px",background:"rgba(0,0,0,0.7)",padding:"4px 8px",borderRadius:"4px",fontSize:"0.8rem",color:"#0aff6a",zIndex:10},children:"VECTOR"}),x.jsx("div",{style:{position:"absolute",bottom:"12px",right:"12px",background:"rgba(0,0,0,0.7)",padding:"4px 8px",borderRadius:"4px",fontSize:"0.8rem",color:"#888",zIndex:10},children:"ORIGINAL"})]}),m&&x.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.8)",zIndex:999},onClick:ze}),x.jsxs("div",{style:{display:"flex",gap:"16px",marginBottom:"16px"},children:[x.jsxs("button",{style:{...ht.button,flex:1,background:I?"#222":"#333",color:"#fff",opacity:I?.7:1},onClick:Ps,disabled:I||N,children:[I?x.jsx("div",{className:"spinner"}):x.jsx(FG,{size:18}),I?"Removing BG...":"Remove BG (AI)"]}),x.jsxs("button",{style:{...ht.button,flex:1,background:N?"#222":"#333",color:"#fff",opacity:N?.7:1},onClick:qt,disabled:I||N,children:[N?x.jsx("div",{className:"spinner"}):x.jsx(IA,{size:18}),N?"Upscaling (2x)...":"Upscale (AI)"]})]}),x.jsxs("div",{style:{display:"flex",gap:"16px"},children:[x.jsxs("button",{style:{...ht.button,flex:1,background:"#222",color:"white"},onClick:()=>{c(null),h(null)},children:[x.jsx(By,{size:18})," Reset"]}),x.jsxs("button",{style:{...ht.button,flex:1.5,background:"#333",color:"#fff"},onClick:ie,children:[x.jsx(LG,{size:18})," PDF"]}),x.jsxs("button",{style:{...ht.button,flex:2},onClick:Yn,children:[x.jsx(mp,{size:18})," SVG"]})]})]}):x.jsxs("div",{style:ht.dropZone,onClick:()=>{var ne;return(ne=S.current)==null?void 0:ne.click()},children:[x.jsxs("div",{style:{marginBottom:"16px",display:"flex",justifyContent:"center",gap:"12px"},children:[x.jsxs("span",{style:{background:"#222",padding:"4px 12px",borderRadius:"99px",fontSize:"0.8rem",color:"#0aff6a"},children:["Target: ",E.toUpperCase()]}),x.jsx("button",{onClick:ne=>{ne.stopPropagation(),k(null)},style:{background:"none",border:"none",color:"#666",cursor:"pointer",fontSize:"0.8rem",textDecoration:"underline"},children:"Change"})]}),x.jsx("input",{type:"file",ref:S,style:{display:"none"},accept:"image/png, image/jpeg",onChange:ln}),x.jsx(Vy,{size:48,color:"#333",style:{marginBottom:"16px"}}),x.jsx("h3",{style:{color:"#fff",marginBottom:"8px"},children:"Upload Raster Image"}),x.jsxs("p",{style:{color:"#666",fontSize:"0.9rem"},children:["Drag & drop or click to select PNG/JPG",x.jsx("br",{}),"Best results with high contrast images"]}),w&&x.jsx("div",{style:{marginTop:"24px",color:"#0aff6a"},children:"Processing Vector Paths..."})]}):x.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))",gap:"16px"},children:[{id:"print",label:"Screen Print",icon:"ðŸ–¨ï¸",desc:"Clean paths, low colors"},{id:"logo",label:"Logo Restore",icon:"ðŸŽ",desc:"Sharp corners, smooth"},{id:"illustration",label:"Illustration",icon:"ðŸŽ¨",desc:"High detail, full color"},{id:"cnc",label:"CNC / Laser",icon:"ðŸ—ï¸",desc:"B&W, machine ready"},{id:"embroidery",label:"Embroidery",icon:"ðŸ§¶",desc:"Simplified shapes"}].map(ne=>x.jsxs("button",{onClick:()=>k(ne.id),style:{background:"#1a1a1a",border:"1px solid #333",borderRadius:"12px",padding:"20px",cursor:"pointer",textAlign:"left",transition:"all 0.2s",display:"flex",flexDirection:"column",gap:"8px"},children:[x.jsx("span",{style:{fontSize:"2rem"},children:ne.icon}),x.jsx("span",{style:{fontWeight:700,color:"#fff"},children:ne.label}),x.jsx("span",{style:{fontSize:"0.8rem",color:"#888"},children:ne.desc})]},ne.id))})})]})}async function $b(n,e={},t){return window.__TAURI_INTERNALS__.invoke(n,e,t)}function STe({onScopeSelect:n}){const[e,t]=te.useState([]),[s,r]=te.useState("global");return te.useEffect(()=>{$b("get_system_drives").then(t).catch(console.error)},[]),x.jsxs("div",{className:"omni-selector glass p-6 rounded-xl border border-white/10",children:[x.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2 text-white",children:[x.jsx(SA,{className:"text-[#0aff6a]"})," Mission Control"]}),x.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[x.jsxs("button",{className:`p-4 border rounded-lg flex flex-col items-center gap-2 transition-all ${s==="global"?"border-[#0aff6a] bg-[#0aff6a]/10 text-white":"border-white/10 hover:bg-white/5 text-white/70"}`,onClick:()=>r("global"),children:[x.jsx(SA,{size:32}),x.jsx("span",{className:"font-mono text-sm",children:"GLOBAL"})]}),x.jsxs("button",{className:`p-4 border rounded-lg flex flex-col items-center gap-2 transition-all ${s==="drive"?"border-[#0aff6a] bg-[#0aff6a]/10 text-white":"border-white/10 hover:bg-white/5 text-white/70"}`,onClick:()=>r("drive"),children:[x.jsx(OP,{size:32}),x.jsx("span",{className:"font-mono text-sm",children:"SECTOR"})]}),x.jsxs("button",{className:`p-4 border rounded-lg flex flex-col items-center gap-2 transition-all ${s==="folder"?"border-[#0aff6a] bg-[#0aff6a]/10 text-white":"border-white/10 hover:bg-white/5 text-white/70"}`,onClick:()=>r("folder"),children:[x.jsx(MG,{size:32}),x.jsx("span",{className:"font-mono text-sm",children:"SURGICAL"})]})]}),s==="drive"&&x.jsx("div",{className:"drive-list grid grid-cols-1 md:grid-cols-2 gap-2 animate-in fade-in slide-in-from-top-2 mb-4",children:e.map(i=>x.jsxs("button",{className:"p-3 border border-white/10 rounded hover:border-[#0aff6a] text-left bg-black/20 transition-colors",onClick:()=>n("drive",i.mount_point),children:[x.jsxs("div",{className:"font-bold text-white",children:[i.name||"Local Disk"," (",i.mount_point,")"]}),x.jsxs("div",{className:"text-xs text-white/50 font-mono",children:["Free: ",(i.available_space/1024/1024/1024).toFixed(1)," GB"]})]},i.mount_point))}),s==="global"&&x.jsxs("button",{className:"w-full py-3 bg-[#0aff6a] text-black font-bold rounded hover:opacity-90 flex items-center justify-center gap-2 transition-opacity",onClick:()=>n("global"),children:["INITIATE GLOBAL SCAN ",x.jsx(cu,{})]}),s==="folder"&&x.jsx("div",{className:"text-center p-4 text-white/50 border border-dashed border-white/10 rounded",children:"Surgical Mode: Select a specific folder to analyze. (Coming Soon)"})]})}function kTe(){const[n,e]=te.useState([]),[t,s]=te.useState(!1),[r,i]=te.useState(null),o=async()=>{s(!0),i(null);try{const l=await $b("scan_shadow_copies");e(l)}catch(l){i(String(l))}finally{s(!1)}},a=async l=>{if(confirm("Are you sure? This cannot be undone."))try{await $b("delete_shadow_copy",{id:l}),e(c=>c.filter(u=>u.id!==l))}catch(c){alert("Failed to delete: "+c)}};return te.useEffect(()=>{o()},[]),x.jsxs("div",{className:"shadow-realm glass p-6 rounded-xl border border-white/10 mt-6",children:[x.jsxs("div",{className:"flex justify-between items-center mb-4",children:[x.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2 text-white",children:[x.jsx(zG,{className:"text-purple-400"})," The Shadow Realm"]}),x.jsx("button",{onClick:o,className:"p-2 hover:bg-white/10 rounded-full text-white",children:x.jsx(VG,{size:20,className:t?"animate-spin":""})})]}),x.jsx("p",{className:"text-sm text-white/60 mb-4",children:'System Restore points ("Shadow Copies") can take up 10-50GB of space. Keep the most recent one, delete the rest.'}),r&&x.jsxs("div",{className:"p-3 bg-red-500/20 border border-red-500/50 rounded text-red-200 text-sm mb-4 flex items-center gap-2",children:[x.jsx(FP,{size:16})," ",r]}),x.jsxs("div",{className:"space-y-2",children:[n.length===0&&!t&&!r&&x.jsx("div",{className:"text-center py-8 text-white/30",children:"No shadow copies found. The realm is empty."}),n.map((l,c)=>x.jsxs("div",{className:"flex items-center justify-between p-3 bg-black/30 rounded border border-white/5 hover:border-purple-400/50 transition-colors",children:[x.jsxs("div",{children:[x.jsx("div",{className:"text-white font-mono text-sm",children:l.created_at}),x.jsx("div",{className:"text-xs text-white/40 font-mono",children:l.id}),c===n.length-1&&x.jsx("span",{className:"inline-block mt-1 text-[10px] bg-green-500/20 text-green-400 px-2 py-0.5 rounded",children:"NEWEST (RECOMMENDED KEEP)"})]}),x.jsx("button",{onClick:()=>a(l.id),className:"p-2 hover:bg-red-500/20 text-white/50 hover:text-red-400 rounded transition-colors",title:"Annihilate",children:x.jsx(gf,{size:18})})]},l.id))]})]})}function TTe({onBack:n}){const[e,t]=te.useState("global"),[s,r]=te.useState(void 0),i=(o,a)=>{t(o),r(a),console.log(`Scope selected: ${o}, Target: ${a}`)};return x.jsxs("div",{className:"trash-hunter-page min-h-screen bg-[#0b0b0d] text-white p-6",children:[x.jsxs("button",{onClick:n,className:"flex items-center gap-2 text-white/50 hover:text-white mb-6 transition-colors",children:[x.jsx(ax,{size:20})," Back to Tools"]}),x.jsxs("header",{className:"mb-8",children:[x.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[x.jsx(gf,{className:"text-[#0aff6a]",size:32}),"Trash Hunter ",x.jsx("span",{className:"text-xs bg-[#0aff6a] text-black px-2 py-1 rounded font-mono",children:"GOD MODE"})]}),x.jsx("p",{className:"text-white/60 mt-2",children:"AI-Powered System Cleaner. Select your target and reclaim your space."})]}),x.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[x.jsx(STe,{onScopeSelect:i}),x.jsx(kTe,{}),x.jsxs("div",{className:"text-xs text-white/20 font-mono text-center",children:["Active Scope: ",e.toUpperCase()," ",s?`[${s}]`:""]})]})]})}function CTe({onBack:n}){var f;const[e,t]=te.useState([]),[s,r]=te.useState(!0),[i,o]=te.useState(null),[a,l]=te.useState(null),[c,u]=te.useState(!1),{getWorker:h}=m_(),d=async()=>{try{const g=await $b("get_running_processes");t(g.sort((m,y)=>y.memory-m.memory)),r(!1)}catch(g){console.error(g)}};te.useEffect(()=>{d();const g=setInterval(d,5e3);return()=>clearInterval(g)},[]);const p=async g=>{u(!0),l(null),o(g.pid);const m=h();if(!m){l("AI Engine not ready. Please wait..."),u(!1);return}const y=`Analyze this Windows process for security threats.
    Name: ${g.name}
    Path: ${g.path||"Unknown (System Protected)"}
    Memory: ${(g.memory/1024/1024).toFixed(2)} MB
    
    Is this safe? If it's a system process, say SAFE. If it looks like a miner or malware, say DANGER. Keep it short.`;m.onmessage=w=>{w.data.status==="complete"&&(l(w.data.output),u(!1))},m.postMessage({type:"generate",text:y})};return x.jsxs("div",{className:"system-monitor min-h-screen bg-[#0b0b0d] text-white p-6 font-mono",children:[x.jsxs("button",{onClick:n,className:"flex items-center gap-2 text-white/50 hover:text-white mb-6 transition-colors",children:[x.jsx(ax,{size:20})," Back to Tools"]}),x.jsxs("header",{className:"mb-8 flex justify-between items-end",children:[x.jsxs("div",{children:[x.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3 text-[#0aff6a]",children:[x.jsx(uu,{size:32}),"AI Overseer ",x.jsx("span",{className:"text-xs bg-[#0aff6a] text-black px-2 py-1 rounded",children:"LIVE"})]}),x.jsxs("p",{className:"text-white/60 mt-2",children:["Monitoring ",e.length," active processes. AI Analysis Ready."]})]}),x.jsxs("div",{className:"text-right text-xs text-white/30",children:[x.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[x.jsx(lu,{size:14})," CPU: NORMAL"]}),x.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[x.jsx(OP,{size:14})," RAM: OPTIMAL"]})]})]}),x.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[x.jsxs("div",{className:"lg:col-span-2 glass rounded-xl border border-white/10 overflow-hidden h-[600px] flex flex-col",children:[x.jsxs("div",{className:"p-4 border-b border-white/10 bg-white/5 flex justify-between text-xs text-white/50 uppercase tracking-wider",children:[x.jsx("span",{children:"Process Name"}),x.jsx("span",{children:"Memory / PID"})]}),x.jsx("div",{className:"overflow-y-auto flex-1 p-2 space-y-1 custom-scrollbar",children:s?x.jsx("div",{className:"text-center py-20 animate-pulse",children:"Scanning System..."}):e.map(g=>x.jsxs("div",{onClick:()=>o(g.pid),className:`flex items-center justify-between p-3 rounded cursor-pointer transition-all ${i===g.pid?"bg-[#0aff6a]/20 border-[#0aff6a]/50":"hover:bg-white/5 border-transparent"} border`,children:[x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx("div",{className:`w-2 h-2 rounded-full ${g.path?"bg-green-500":"bg-yellow-500"}`}),x.jsxs("div",{children:[x.jsx("div",{className:"font-bold text-sm",children:g.name}),x.jsx("div",{className:"text-[10px] text-white/40 truncate max-w-[200px]",children:g.path||"System Protected"})]})]}),x.jsxs("div",{className:"text-right",children:[x.jsxs("div",{className:"text-[#0aff6a] text-sm",children:[(g.memory/1024/1024).toFixed(1)," MB"]}),x.jsxs("div",{className:"text-[10px] text-white/30",children:["PID: ",g.pid]})]})]},g.pid))})]}),x.jsxs("div",{className:"glass rounded-xl border border-white/10 p-6 flex flex-col",children:[x.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[x.jsx(jy,{className:"text-purple-400"})," AI Analyst"]}),i?x.jsxs("div",{className:"flex-1 flex flex-col",children:[x.jsxs("div",{className:"mb-6",children:[x.jsx("div",{className:"text-xs text-white/40 uppercase mb-1",children:"Selected Target"}),x.jsx("div",{className:"text-2xl font-bold text-white break-all",children:(f=e.find(g=>g.pid===i))==null?void 0:f.name}),x.jsxs("div",{className:"text-xs text-white/50 font-mono mt-1",children:["PID: ",i]})]}),x.jsx("div",{className:"flex-1 bg-black/40 rounded-lg p-4 border border-white/5 mb-4 overflow-y-auto",children:c?x.jsxs("div",{className:"flex items-center gap-2 text-purple-400 animate-pulse",children:[x.jsx(jy,{size:16})," Analyzing process DNA..."]}):a?x.jsxs("div",{className:"prose prose-invert text-sm",children:[x.jsx("p",{className:"text-purple-300 font-bold mb-2",children:"Verdict:"}),a]}):x.jsx("div",{className:"text-white/30 text-center py-10 text-sm",children:"Select a process and ask the AI to analyze it for threats."})}),x.jsxs("button",{onClick:()=>{const g=e.find(m=>m.pid===i);g&&p(g)},disabled:c,className:"w-full py-3 bg-purple-600 hover:bg-purple-500 disabled:opacity-50 text-white rounded-lg font-bold flex items-center justify-center gap-2 transition-all",children:[c?x.jsx(uu,{className:"animate-spin"}):x.jsx(M1,{size:18}),c?"Scanning...":"Analyze with AI"]})]}):x.jsx("div",{className:"flex-1 flex items-center justify-center text-white/30 text-center",children:x.jsxs("div",{children:[x.jsx(Uy,{size:48,className:"mx-auto mb-4 opacity-20"}),x.jsx("p",{children:"Select a process from the list to begin analysis."})]})})]})]})]})}function ETe(n,e){const t=e||{};return(n[n.length-1]===""?[...n,""]:n).join((t.padRight?" ":"")+","+(t.padLeft===!1?"":" ")).trim()}const _Te=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,NTe=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,ATe={};function q2(n,e){return((e||ATe).jsx?NTe:_Te).test(n)}const RTe=/[ \t\n\f\r]/g;function $Te(n){return typeof n=="object"?n.type==="text"?K2(n.value):!1:K2(n)}function K2(n){return n.replace(RTe,"")===""}class lg{constructor(e,t,s){this.normal=t,this.property=e,s&&(this.space=s)}}lg.prototype.normal={};lg.prototype.property={};lg.prototype.space=void 0;function HB(n,e){const t={},s={};for(const r of n)Object.assign(t,r.property),Object.assign(s,r.normal);return new lg(t,s,e)}function eS(n){return n.toLowerCase()}class pr{constructor(e,t){this.attribute=t,this.property=e}}pr.prototype.attribute="";pr.prototype.booleanish=!1;pr.prototype.boolean=!1;pr.prototype.commaOrSpaceSeparated=!1;pr.prototype.commaSeparated=!1;pr.prototype.defined=!1;pr.prototype.mustUseProperty=!1;pr.prototype.number=!1;pr.prototype.overloadedBoolean=!1;pr.prototype.property="";pr.prototype.spaceSeparated=!1;pr.prototype.space=void 0;let DTe=0;const dt=Tc(),$n=Tc(),tS=Tc(),we=Tc(),en=Tc(),nu=Tc(),mr=Tc();function Tc(){return 2**++DTe}const nS=Object.freeze(Object.defineProperty({__proto__:null,boolean:dt,booleanish:$n,commaOrSpaceSeparated:mr,commaSeparated:nu,number:we,overloadedBoolean:tS,spaceSeparated:en},Symbol.toStringTag,{value:"Module"})),Qv=Object.keys(nS);class g_ extends pr{constructor(e,t,s,r){let i=-1;if(super(e,t),X2(this,"space",r),typeof s=="number")for(;++i<Qv.length;){const o=Qv[i];X2(this,Qv[i],(s&nS[o])===nS[o])}}}g_.prototype.defined=!0;function X2(n,e,t){t&&(n[e]=t)}function rd(n){const e={},t={};for(const[s,r]of Object.entries(n.properties)){const i=new g_(s,n.transform(n.attributes||{},s),r,n.space);n.mustUseProperty&&n.mustUseProperty.includes(s)&&(i.mustUseProperty=!0),e[s]=i,t[eS(s)]=s,t[eS(i.attribute)]=s}return new lg(e,t,n.space)}const qB=rd({properties:{ariaActiveDescendant:null,ariaAtomic:$n,ariaAutoComplete:null,ariaBusy:$n,ariaChecked:$n,ariaColCount:we,ariaColIndex:we,ariaColSpan:we,ariaControls:en,ariaCurrent:null,ariaDescribedBy:en,ariaDetails:null,ariaDisabled:$n,ariaDropEffect:en,ariaErrorMessage:null,ariaExpanded:$n,ariaFlowTo:en,ariaGrabbed:$n,ariaHasPopup:null,ariaHidden:$n,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:en,ariaLevel:we,ariaLive:null,ariaModal:$n,ariaMultiLine:$n,ariaMultiSelectable:$n,ariaOrientation:null,ariaOwns:en,ariaPlaceholder:null,ariaPosInSet:we,ariaPressed:$n,ariaReadOnly:$n,ariaRelevant:null,ariaRequired:$n,ariaRoleDescription:en,ariaRowCount:we,ariaRowIndex:we,ariaRowSpan:we,ariaSelected:$n,ariaSetSize:we,ariaSort:null,ariaValueMax:we,ariaValueMin:we,ariaValueNow:we,ariaValueText:null,role:null},transform(n,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function KB(n,e){return e in n?n[e]:e}function XB(n,e){return KB(n,e.toLowerCase())}const PTe=rd({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:nu,acceptCharset:en,accessKey:en,action:null,allow:null,allowFullScreen:dt,allowPaymentRequest:dt,allowUserMedia:dt,alt:null,as:null,async:dt,autoCapitalize:null,autoComplete:en,autoFocus:dt,autoPlay:dt,blocking:en,capture:null,charSet:null,checked:dt,cite:null,className:en,cols:we,colSpan:null,content:null,contentEditable:$n,controls:dt,controlsList:en,coords:we|nu,crossOrigin:null,data:null,dateTime:null,decoding:null,default:dt,defer:dt,dir:null,dirName:null,disabled:dt,download:tS,draggable:$n,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:dt,formTarget:null,headers:en,height:we,hidden:tS,high:we,href:null,hrefLang:null,htmlFor:en,httpEquiv:en,id:null,imageSizes:null,imageSrcSet:null,inert:dt,inputMode:null,integrity:null,is:null,isMap:dt,itemId:null,itemProp:en,itemRef:en,itemScope:dt,itemType:en,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:dt,low:we,manifest:null,max:null,maxLength:we,media:null,method:null,min:null,minLength:we,multiple:dt,muted:dt,name:null,nonce:null,noModule:dt,noValidate:dt,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:dt,optimum:we,pattern:null,ping:en,placeholder:null,playsInline:dt,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:dt,referrerPolicy:null,rel:en,required:dt,reversed:dt,rows:we,rowSpan:we,sandbox:en,scope:null,scoped:dt,seamless:dt,selected:dt,shadowRootClonable:dt,shadowRootDelegatesFocus:dt,shadowRootMode:null,shape:null,size:we,sizes:null,slot:null,span:we,spellCheck:$n,src:null,srcDoc:null,srcLang:null,srcSet:null,start:we,step:null,style:null,tabIndex:we,target:null,title:null,translate:null,type:null,typeMustMatch:dt,useMap:null,value:$n,width:we,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:en,axis:null,background:null,bgColor:null,border:we,borderColor:null,bottomMargin:we,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:dt,declare:dt,event:null,face:null,frame:null,frameBorder:null,hSpace:we,leftMargin:we,link:null,longDesc:null,lowSrc:null,marginHeight:we,marginWidth:we,noResize:dt,noHref:dt,noShade:dt,noWrap:dt,object:null,profile:null,prompt:null,rev:null,rightMargin:we,rules:null,scheme:null,scrolling:$n,standby:null,summary:null,text:null,topMargin:we,valueType:null,version:null,vAlign:null,vLink:null,vSpace:we,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:dt,disableRemotePlayback:dt,prefix:null,property:null,results:we,security:null,unselectable:null},space:"html",transform:XB}),OTe=rd({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:mr,accentHeight:we,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:we,amplitude:we,arabicForm:null,ascent:we,attributeName:null,attributeType:null,azimuth:we,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:we,by:null,calcMode:null,capHeight:we,className:en,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:we,diffuseConstant:we,direction:null,display:null,dur:null,divisor:we,dominantBaseline:null,download:dt,dx:null,dy:null,edgeMode:null,editable:null,elevation:we,enableBackground:null,end:null,event:null,exponent:we,externalResourcesRequired:null,fill:null,fillOpacity:we,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:nu,g2:nu,glyphName:nu,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:we,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:we,horizOriginX:we,horizOriginY:we,id:null,ideographic:we,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:we,k:we,k1:we,k2:we,k3:we,k4:we,kernelMatrix:mr,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:we,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:we,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:we,overlineThickness:we,paintOrder:null,panose1:null,path:null,pathLength:we,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:en,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:we,pointsAtY:we,pointsAtZ:we,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:mr,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:mr,rev:mr,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:mr,requiredFeatures:mr,requiredFonts:mr,requiredFormats:mr,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:we,specularExponent:we,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:we,strikethroughThickness:we,string:null,stroke:null,strokeDashArray:mr,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:we,strokeOpacity:we,strokeWidth:null,style:null,surfaceScale:we,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:mr,tabIndex:we,tableValues:null,target:null,targetX:we,targetY:we,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:mr,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:we,underlineThickness:we,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:we,values:null,vAlphabetic:we,vMathematical:we,vectorEffect:null,vHanging:we,vIdeographic:we,version:null,vertAdvY:we,vertOriginX:we,vertOriginY:we,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:we,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:KB}),YB=rd({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(n,e){return"xlink:"+e.slice(5).toLowerCase()}}),QB=rd({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:XB}),ZB=rd({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(n,e){return"xml:"+e.slice(3).toLowerCase()}}),FTe={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},LTe=/[A-Z]/g,Y2=/-[a-z]/g,MTe=/^data[-\w.:]+$/i;function zTe(n,e){const t=eS(e);let s=e,r=pr;if(t in n.normal)return n.property[n.normal[t]];if(t.length>4&&t.slice(0,4)==="data"&&MTe.test(e)){if(e.charAt(4)==="-"){const i=e.slice(5).replace(Y2,BTe);s="data"+i.charAt(0).toUpperCase()+i.slice(1)}else{const i=e.slice(4);if(!Y2.test(i)){let o=i.replace(LTe,VTe);o.charAt(0)!=="-"&&(o="-"+o),e="data"+o}}r=g_}return new r(s,e)}function VTe(n){return"-"+n.toLowerCase()}function BTe(n){return n.charAt(1).toUpperCase()}const jTe=HB([qB,PTe,YB,QB,ZB],"html"),y_=HB([qB,OTe,YB,QB,ZB],"svg");function UTe(n){return n.join(" ").trim()}var b_={},Q2=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,WTe=/\n/g,GTe=/^\s*/,HTe=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,qTe=/^:\s*/,KTe=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,XTe=/^[;\s]*/,YTe=/^\s+|\s+$/g,QTe=`
`,Z2="/",J2="*",ml="",ZTe="comment",JTe="declaration";function eCe(n,e){if(typeof n!="string")throw new TypeError("First argument must be a string");if(!n)return[];e=e||{};var t=1,s=1;function r(f){var g=f.match(WTe);g&&(t+=g.length);var m=f.lastIndexOf(QTe);s=~m?f.length-m:s+f.length}function i(){var f={line:t,column:s};return function(g){return g.position=new o(f),c(),g}}function o(f){this.start=f,this.end={line:t,column:s},this.source=e.source}o.prototype.content=n;function a(f){var g=new Error(e.source+":"+t+":"+s+": "+f);if(g.reason=f,g.filename=e.source,g.line=t,g.column=s,g.source=n,!e.silent)throw g}function l(f){var g=f.exec(n);if(g){var m=g[0];return r(m),n=n.slice(m.length),g}}function c(){l(GTe)}function u(f){var g;for(f=f||[];g=h();)g!==!1&&f.push(g);return f}function h(){var f=i();if(!(Z2!=n.charAt(0)||J2!=n.charAt(1))){for(var g=2;ml!=n.charAt(g)&&(J2!=n.charAt(g)||Z2!=n.charAt(g+1));)++g;if(g+=2,ml===n.charAt(g-1))return a("End of comment missing");var m=n.slice(2,g-2);return s+=2,r(m),n=n.slice(g),s+=2,f({type:ZTe,comment:m})}}function d(){var f=i(),g=l(HTe);if(g){if(h(),!l(qTe))return a("property missing ':'");var m=l(KTe),y=f({type:JTe,property:e$(g[0].replace(Q2,ml)),value:m?e$(m[0].replace(Q2,ml)):ml});return l(XTe),y}}function p(){var f=[];u(f);for(var g;g=d();)g!==!1&&(f.push(g),u(f));return f}return c(),p()}function e$(n){return n?n.replace(YTe,ml):ml}var tCe=eCe,nCe=di&&di.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(b_,"__esModule",{value:!0});b_.default=rCe;const sCe=nCe(tCe);function rCe(n,e){let t=null;if(!n||typeof n!="string")return t;const s=(0,sCe.default)(n),r=typeof e=="function";return s.forEach(i=>{if(i.type!=="declaration")return;const{property:o,value:a}=i;r?e(o,a,i):a&&(t=t||{},t[o]=a)}),t}var F0={};Object.defineProperty(F0,"__esModule",{value:!0});F0.camelCase=void 0;var iCe=/^--[a-zA-Z0-9_-]+$/,oCe=/-([a-z])/g,aCe=/^[^-]+$/,lCe=/^-(webkit|moz|ms|o|khtml)-/,cCe=/^-(ms)-/,uCe=function(n){return!n||aCe.test(n)||iCe.test(n)},hCe=function(n,e){return e.toUpperCase()},t$=function(n,e){return"".concat(e,"-")},dCe=function(n,e){return e===void 0&&(e={}),uCe(n)?n:(n=n.toLowerCase(),e.reactCompat?n=n.replace(cCe,t$):n=n.replace(lCe,t$),n.replace(oCe,hCe))};F0.camelCase=dCe;var pCe=di&&di.__importDefault||function(n){return n&&n.__esModule?n:{default:n}},fCe=pCe(b_),mCe=F0;function sS(n,e){var t={};return!n||typeof n!="string"||(0,fCe.default)(n,function(s,r){s&&r&&(t[(0,mCe.camelCase)(s,e)]=r)}),t}sS.default=sS;var gCe=sS;const yCe=VS(gCe),JB=e4("end"),x_=e4("start");function e4(n){return e;function e(t){const s=t&&t.position&&t.position[n]||{};if(typeof s.line=="number"&&s.line>0&&typeof s.column=="number"&&s.column>0)return{line:s.line,column:s.column,offset:typeof s.offset=="number"&&s.offset>-1?s.offset:void 0}}}function bCe(n){const e=x_(n),t=JB(n);if(e&&t)return{start:e,end:t}}function rp(n){return!n||typeof n!="object"?"":"position"in n||"type"in n?n$(n.position):"start"in n||"end"in n?n$(n):"line"in n||"column"in n?rS(n):""}function rS(n){return s$(n&&n.line)+":"+s$(n&&n.column)}function n$(n){return rS(n&&n.start)+"-"+rS(n&&n.end)}function s$(n){return n&&typeof n=="number"?n:1}class Ds extends Error{constructor(e,t,s){super(),typeof t=="string"&&(s=t,t=void 0);let r="",i={},o=!1;if(t&&("line"in t&&"column"in t?i={place:t}:"start"in t&&"end"in t?i={place:t}:"type"in t?i={ancestors:[t],place:t.position}:i={...t}),typeof e=="string"?r=e:!i.cause&&e&&(o=!0,r=e.message,i.cause=e),!i.ruleId&&!i.source&&typeof s=="string"){const l=s.indexOf(":");l===-1?i.ruleId=s:(i.source=s.slice(0,l),i.ruleId=s.slice(l+1))}if(!i.place&&i.ancestors&&i.ancestors){const l=i.ancestors[i.ancestors.length-1];l&&(i.place=l.position)}const a=i.place&&"start"in i.place?i.place.start:i.place;this.ancestors=i.ancestors||void 0,this.cause=i.cause||void 0,this.column=a?a.column:void 0,this.fatal=void 0,this.file="",this.message=r,this.line=a?a.line:void 0,this.name=rp(i.place)||"1:1",this.place=i.place||void 0,this.reason=this.message,this.ruleId=i.ruleId||void 0,this.source=i.source||void 0,this.stack=o&&i.cause&&typeof i.cause.stack=="string"?i.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}Ds.prototype.file="";Ds.prototype.name="";Ds.prototype.reason="";Ds.prototype.message="";Ds.prototype.stack="";Ds.prototype.column=void 0;Ds.prototype.line=void 0;Ds.prototype.ancestors=void 0;Ds.prototype.cause=void 0;Ds.prototype.fatal=void 0;Ds.prototype.place=void 0;Ds.prototype.ruleId=void 0;Ds.prototype.source=void 0;const w_={}.hasOwnProperty,xCe=new Map,wCe=/[A-Z]/g,vCe=new Set(["table","tbody","thead","tfoot","tr"]),ICe=new Set(["td","th"]),t4="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function SCe(n,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const t=e.filePath||void 0;let s;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");s=RCe(t,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");s=ACe(t,e.jsx,e.jsxs)}const r={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:s,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:t,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?y_:jTe,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},i=n4(r,n,void 0);return i&&typeof i!="string"?i:r.create(n,r.Fragment,{children:i||void 0},void 0)}function n4(n,e,t){if(e.type==="element")return kCe(n,e,t);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return TCe(n,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return ECe(n,e,t);if(e.type==="mdxjsEsm")return CCe(n,e);if(e.type==="root")return _Ce(n,e,t);if(e.type==="text")return NCe(n,e)}function kCe(n,e,t){const s=n.schema;let r=s;e.tagName.toLowerCase()==="svg"&&s.space==="html"&&(r=y_,n.schema=r),n.ancestors.push(e);const i=r4(n,e.tagName,!1),o=$Ce(n,e);let a=I_(n,e);return vCe.has(e.tagName)&&(a=a.filter(function(l){return typeof l=="string"?!$Te(l):!0})),s4(n,o,i,e),v_(o,a),n.ancestors.pop(),n.schema=s,n.create(e,i,o,t)}function TCe(n,e){if(e.data&&e.data.estree&&n.evaluater){const s=e.data.estree.body[0];return s.type,n.evaluater.evaluateExpression(s.expression)}ef(n,e.position)}function CCe(n,e){if(e.data&&e.data.estree&&n.evaluater)return n.evaluater.evaluateProgram(e.data.estree);ef(n,e.position)}function ECe(n,e,t){const s=n.schema;let r=s;e.name==="svg"&&s.space==="html"&&(r=y_,n.schema=r),n.ancestors.push(e);const i=e.name===null?n.Fragment:r4(n,e.name,!0),o=DCe(n,e),a=I_(n,e);return s4(n,o,i,e),v_(o,a),n.ancestors.pop(),n.schema=s,n.create(e,i,o,t)}function _Ce(n,e,t){const s={};return v_(s,I_(n,e)),n.create(e,n.Fragment,s,t)}function NCe(n,e){return e.value}function s4(n,e,t,s){typeof t!="string"&&t!==n.Fragment&&n.passNode&&(e.node=s)}function v_(n,e){if(e.length>0){const t=e.length>1?e:e[0];t&&(n.children=t)}}function ACe(n,e,t){return s;function s(r,i,o,a){const c=Array.isArray(o.children)?t:e;return a?c(i,o,a):c(i,o)}}function RCe(n,e){return t;function t(s,r,i,o){const a=Array.isArray(i.children),l=x_(s);return e(r,i,o,a,{columnNumber:l?l.column-1:void 0,fileName:n,lineNumber:l?l.line:void 0},void 0)}}function $Ce(n,e){const t={};let s,r;for(r in e.properties)if(r!=="children"&&w_.call(e.properties,r)){const i=PCe(n,r,e.properties[r]);if(i){const[o,a]=i;n.tableCellAlignToStyle&&o==="align"&&typeof a=="string"&&ICe.has(e.tagName)?s=a:t[o]=a}}if(s){const i=t.style||(t.style={});i[n.stylePropertyNameCase==="css"?"text-align":"textAlign"]=s}return t}function DCe(n,e){const t={};for(const s of e.attributes)if(s.type==="mdxJsxExpressionAttribute")if(s.data&&s.data.estree&&n.evaluater){const i=s.data.estree.body[0];i.type;const o=i.expression;o.type;const a=o.properties[0];a.type,Object.assign(t,n.evaluater.evaluateExpression(a.argument))}else ef(n,e.position);else{const r=s.name;let i;if(s.value&&typeof s.value=="object")if(s.value.data&&s.value.data.estree&&n.evaluater){const a=s.value.data.estree.body[0];a.type,i=n.evaluater.evaluateExpression(a.expression)}else ef(n,e.position);else i=s.value===null?!0:s.value;t[r]=i}return t}function I_(n,e){const t=[];let s=-1;const r=n.passKeys?new Map:xCe;for(;++s<e.children.length;){const i=e.children[s];let o;if(n.passKeys){const l=i.type==="element"?i.tagName:i.type==="mdxJsxFlowElement"||i.type==="mdxJsxTextElement"?i.name:void 0;if(l){const c=r.get(l)||0;o=l+"-"+c,r.set(l,c+1)}}const a=n4(n,i,o);a!==void 0&&t.push(a)}return t}function PCe(n,e,t){const s=zTe(n.schema,e);if(!(t==null||typeof t=="number"&&Number.isNaN(t))){if(Array.isArray(t)&&(t=s.commaSeparated?ETe(t):UTe(t)),s.property==="style"){let r=typeof t=="object"?t:OCe(n,String(t));return n.stylePropertyNameCase==="css"&&(r=FCe(r)),["style",r]}return[n.elementAttributeNameCase==="react"&&s.space?FTe[s.property]||s.property:s.attribute,t]}}function OCe(n,e){try{return yCe(e,{reactCompat:!0})}catch(t){if(n.ignoreInvalidStyle)return{};const s=t,r=new Ds("Cannot parse `style` attribute",{ancestors:n.ancestors,cause:s,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw r.file=n.filePath||void 0,r.url=t4+"#cannot-parse-style-attribute",r}}function r4(n,e,t){let s;if(!t)s={type:"Literal",value:e};else if(e.includes(".")){const r=e.split(".");let i=-1,o;for(;++i<r.length;){const a=q2(r[i])?{type:"Identifier",name:r[i]}:{type:"Literal",value:r[i]};o=o?{type:"MemberExpression",object:o,property:a,computed:!!(i&&a.type==="Literal"),optional:!1}:a}s=o}else s=q2(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(s.type==="Literal"){const r=s.value;return w_.call(n.components,r)?n.components[r]:r}if(n.evaluater)return n.evaluater.evaluateExpression(s);ef(n)}function ef(n,e){const t=new Ds("Cannot handle MDX estrees without `createEvaluater`",{ancestors:n.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw t.file=n.filePath||void 0,t.url=t4+"#cannot-handle-mdx-estrees-without-createevaluater",t}function FCe(n){const e={};let t;for(t in n)w_.call(n,t)&&(e[LCe(t)]=n[t]);return e}function LCe(n){let e=n.replace(wCe,MCe);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function MCe(n){return"-"+n.toLowerCase()}const Zv={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},zCe={};function S_(n,e){const t=e||zCe,s=typeof t.includeImageAlt=="boolean"?t.includeImageAlt:!0,r=typeof t.includeHtml=="boolean"?t.includeHtml:!0;return i4(n,s,r)}function i4(n,e,t){if(VCe(n)){if("value"in n)return n.type==="html"&&!t?"":n.value;if(e&&"alt"in n&&n.alt)return n.alt;if("children"in n)return r$(n.children,e,t)}return Array.isArray(n)?r$(n,e,t):""}function r$(n,e,t){const s=[];let r=-1;for(;++r<n.length;)s[r]=i4(n[r],e,t);return s.join("")}function VCe(n){return!!(n&&typeof n=="object")}const i$=document.createElement("i");function k_(n){const e="&"+n+";";i$.innerHTML=e;const t=i$.textContent;return t.charCodeAt(t.length-1)===59&&n!=="semi"||t===e?!1:t}function kr(n,e,t,s){const r=n.length;let i=0,o;if(e<0?e=-e>r?0:r+e:e=e>r?r:e,t=t>0?t:0,s.length<1e4)o=Array.from(s),o.unshift(e,t),n.splice(...o);else for(t&&n.splice(e,t);i<s.length;)o=s.slice(i,i+1e4),o.unshift(e,0),n.splice(...o),i+=1e4,e+=1e4}function Pr(n,e){return n.length>0?(kr(n,n.length,0,e),n):e}const o$={}.hasOwnProperty;function o4(n){const e={};let t=-1;for(;++t<n.length;)BCe(e,n[t]);return e}function BCe(n,e){let t;for(t in e){const r=(o$.call(n,t)?n[t]:void 0)||(n[t]={}),i=e[t];let o;if(i)for(o in i){o$.call(r,o)||(r[o]=[]);const a=i[o];jCe(r[o],Array.isArray(a)?a:a?[a]:[])}}}function jCe(n,e){let t=-1;const s=[];for(;++t<e.length;)(e[t].add==="after"?n:s).push(e[t]);kr(n,0,0,s)}function a4(n,e){const t=Number.parseInt(n,e);return t<9||t===11||t>13&&t<32||t>126&&t<160||t>55295&&t<57344||t>64975&&t<65008||(t&65535)===65535||(t&65535)===65534||t>1114111?"ï¿½":String.fromCodePoint(t)}function ci(n){return n.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const Ms=Xa(/[A-Za-z]/),Cs=Xa(/[\dA-Za-z]/),UCe=Xa(/[#-'*+\--9=?A-Z^-~]/);function Db(n){return n!==null&&(n<32||n===127)}const iS=Xa(/\d/),WCe=Xa(/[\dA-Fa-f]/),GCe=Xa(/[!-/:-@[-`{-~]/);function Ge(n){return n!==null&&n<-2}function Qt(n){return n!==null&&(n<0||n===32)}function Tt(n){return n===-2||n===-1||n===32}const L0=Xa(/\p{P}|\p{S}/u),nc=Xa(/\s/);function Xa(n){return e;function e(t){return t!==null&&t>-1&&n.test(String.fromCharCode(t))}}function id(n){const e=[];let t=-1,s=0,r=0;for(;++t<n.length;){const i=n.charCodeAt(t);let o="";if(i===37&&Cs(n.charCodeAt(t+1))&&Cs(n.charCodeAt(t+2)))r=2;else if(i<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(i))||(o=String.fromCharCode(i));else if(i>55295&&i<57344){const a=n.charCodeAt(t+1);i<56320&&a>56319&&a<57344?(o=String.fromCharCode(i,a),r=1):o="ï¿½"}else o=String.fromCharCode(i);o&&(e.push(n.slice(s,t),encodeURIComponent(o)),s=t+r+1,o=""),r&&(t+=r,r=0)}return e.join("")+n.slice(s)}function Ot(n,e,t,s){const r=s?s-1:Number.POSITIVE_INFINITY;let i=0;return o;function o(l){return Tt(l)?(n.enter(t),a(l)):e(l)}function a(l){return Tt(l)&&i++<r?(n.consume(l),a):(n.exit(t),e(l))}}const HCe={tokenize:qCe};function qCe(n){const e=n.attempt(this.parser.constructs.contentInitial,s,r);let t;return e;function s(a){if(a===null){n.consume(a);return}return n.enter("lineEnding"),n.consume(a),n.exit("lineEnding"),Ot(n,e,"linePrefix")}function r(a){return n.enter("paragraph"),i(a)}function i(a){const l=n.enter("chunkText",{contentType:"text",previous:t});return t&&(t.next=l),t=l,o(a)}function o(a){if(a===null){n.exit("chunkText"),n.exit("paragraph"),n.consume(a);return}return Ge(a)?(n.consume(a),n.exit("chunkText"),i):(n.consume(a),o)}}const KCe={tokenize:XCe},a$={tokenize:YCe};function XCe(n){const e=this,t=[];let s=0,r,i,o;return a;function a(v){if(s<t.length){const I=t[s];return e.containerState=I[1],n.attempt(I[0].continuation,l,c)(v)}return c(v)}function l(v){if(s++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,r&&w();const I=e.events.length;let _=I,N;for(;_--;)if(e.events[_][0]==="exit"&&e.events[_][1].type==="chunkFlow"){N=e.events[_][1].end;break}y(s);let T=I;for(;T<e.events.length;)e.events[T][1].end={...N},T++;return kr(e.events,_+1,0,e.events.slice(I)),e.events.length=T,c(v)}return a(v)}function c(v){if(s===t.length){if(!r)return d(v);if(r.currentConstruct&&r.currentConstruct.concrete)return f(v);e.interrupt=!!(r.currentConstruct&&!r._gfmTableDynamicInterruptHack)}return e.containerState={},n.check(a$,u,h)(v)}function u(v){return r&&w(),y(s),d(v)}function h(v){return e.parser.lazy[e.now().line]=s!==t.length,o=e.now().offset,f(v)}function d(v){return e.containerState={},n.attempt(a$,p,f)(v)}function p(v){return s++,t.push([e.currentConstruct,e.containerState]),d(v)}function f(v){if(v===null){r&&w(),y(0),n.consume(v);return}return r=r||e.parser.flow(e.now()),n.enter("chunkFlow",{_tokenizer:r,contentType:"flow",previous:i}),g(v)}function g(v){if(v===null){m(n.exit("chunkFlow"),!0),y(0),n.consume(v);return}return Ge(v)?(n.consume(v),m(n.exit("chunkFlow")),s=0,e.interrupt=void 0,a):(n.consume(v),g)}function m(v,I){const _=e.sliceStream(v);if(I&&_.push(null),v.previous=i,i&&(i.next=v),i=v,r.defineSkip(v.start),r.write(_),e.parser.lazy[v.start.line]){let N=r.events.length;for(;N--;)if(r.events[N][1].start.offset<o&&(!r.events[N][1].end||r.events[N][1].end.offset>o))return;const T=e.events.length;let E=T,k,S;for(;E--;)if(e.events[E][0]==="exit"&&e.events[E][1].type==="chunkFlow"){if(k){S=e.events[E][1].end;break}k=!0}for(y(s),N=T;N<e.events.length;)e.events[N][1].end={...S},N++;kr(e.events,E+1,0,e.events.slice(T)),e.events.length=N}}function y(v){let I=t.length;for(;I-- >v;){const _=t[I];e.containerState=_[1],_[0].exit.call(e,n)}t.length=v}function w(){r.write([null]),i=void 0,r=void 0,e.containerState._closeFlow=void 0}}function YCe(n,e,t){return Ot(n,n.attempt(this.parser.constructs.document,e,t),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function Au(n){if(n===null||Qt(n)||nc(n))return 1;if(L0(n))return 2}function M0(n,e,t){const s=[];let r=-1;for(;++r<n.length;){const i=n[r].resolveAll;i&&!s.includes(i)&&(e=i(e,t),s.push(i))}return e}const oS={name:"attention",resolveAll:QCe,tokenize:ZCe};function QCe(n,e){let t=-1,s,r,i,o,a,l,c,u;for(;++t<n.length;)if(n[t][0]==="enter"&&n[t][1].type==="attentionSequence"&&n[t][1]._close){for(s=t;s--;)if(n[s][0]==="exit"&&n[s][1].type==="attentionSequence"&&n[s][1]._open&&e.sliceSerialize(n[s][1]).charCodeAt(0)===e.sliceSerialize(n[t][1]).charCodeAt(0)){if((n[s][1]._close||n[t][1]._open)&&(n[t][1].end.offset-n[t][1].start.offset)%3&&!((n[s][1].end.offset-n[s][1].start.offset+n[t][1].end.offset-n[t][1].start.offset)%3))continue;l=n[s][1].end.offset-n[s][1].start.offset>1&&n[t][1].end.offset-n[t][1].start.offset>1?2:1;const h={...n[s][1].end},d={...n[t][1].start};l$(h,-l),l$(d,l),o={type:l>1?"strongSequence":"emphasisSequence",start:h,end:{...n[s][1].end}},a={type:l>1?"strongSequence":"emphasisSequence",start:{...n[t][1].start},end:d},i={type:l>1?"strongText":"emphasisText",start:{...n[s][1].end},end:{...n[t][1].start}},r={type:l>1?"strong":"emphasis",start:{...o.start},end:{...a.end}},n[s][1].end={...o.start},n[t][1].start={...a.end},c=[],n[s][1].end.offset-n[s][1].start.offset&&(c=Pr(c,[["enter",n[s][1],e],["exit",n[s][1],e]])),c=Pr(c,[["enter",r,e],["enter",o,e],["exit",o,e],["enter",i,e]]),c=Pr(c,M0(e.parser.constructs.insideSpan.null,n.slice(s+1,t),e)),c=Pr(c,[["exit",i,e],["enter",a,e],["exit",a,e],["exit",r,e]]),n[t][1].end.offset-n[t][1].start.offset?(u=2,c=Pr(c,[["enter",n[t][1],e],["exit",n[t][1],e]])):u=0,kr(n,s-1,t-s+3,c),t=s+c.length-u-2;break}}for(t=-1;++t<n.length;)n[t][1].type==="attentionSequence"&&(n[t][1].type="data");return n}function ZCe(n,e){const t=this.parser.constructs.attentionMarkers.null,s=this.previous,r=Au(s);let i;return o;function o(l){return i=l,n.enter("attentionSequence"),a(l)}function a(l){if(l===i)return n.consume(l),a;const c=n.exit("attentionSequence"),u=Au(l),h=!u||u===2&&r||t.includes(l),d=!r||r===2&&u||t.includes(s);return c._open=!!(i===42?h:h&&(r||!d)),c._close=!!(i===42?d:d&&(u||!h)),e(l)}}function l$(n,e){n.column+=e,n.offset+=e,n._bufferIndex+=e}const JCe={name:"autolink",tokenize:eEe};function eEe(n,e,t){let s=0;return r;function r(p){return n.enter("autolink"),n.enter("autolinkMarker"),n.consume(p),n.exit("autolinkMarker"),n.enter("autolinkProtocol"),i}function i(p){return Ms(p)?(n.consume(p),o):p===64?t(p):c(p)}function o(p){return p===43||p===45||p===46||Cs(p)?(s=1,a(p)):c(p)}function a(p){return p===58?(n.consume(p),s=0,l):(p===43||p===45||p===46||Cs(p))&&s++<32?(n.consume(p),a):(s=0,c(p))}function l(p){return p===62?(n.exit("autolinkProtocol"),n.enter("autolinkMarker"),n.consume(p),n.exit("autolinkMarker"),n.exit("autolink"),e):p===null||p===32||p===60||Db(p)?t(p):(n.consume(p),l)}function c(p){return p===64?(n.consume(p),u):UCe(p)?(n.consume(p),c):t(p)}function u(p){return Cs(p)?h(p):t(p)}function h(p){return p===46?(n.consume(p),s=0,u):p===62?(n.exit("autolinkProtocol").type="autolinkEmail",n.enter("autolinkMarker"),n.consume(p),n.exit("autolinkMarker"),n.exit("autolink"),e):d(p)}function d(p){if((p===45||Cs(p))&&s++<63){const f=p===45?d:h;return n.consume(p),f}return t(p)}}const cg={partial:!0,tokenize:tEe};function tEe(n,e,t){return s;function s(i){return Tt(i)?Ot(n,r,"linePrefix")(i):r(i)}function r(i){return i===null||Ge(i)?e(i):t(i)}}const l4={continuation:{tokenize:sEe},exit:rEe,name:"blockQuote",tokenize:nEe};function nEe(n,e,t){const s=this;return r;function r(o){if(o===62){const a=s.containerState;return a.open||(n.enter("blockQuote",{_container:!0}),a.open=!0),n.enter("blockQuotePrefix"),n.enter("blockQuoteMarker"),n.consume(o),n.exit("blockQuoteMarker"),i}return t(o)}function i(o){return Tt(o)?(n.enter("blockQuotePrefixWhitespace"),n.consume(o),n.exit("blockQuotePrefixWhitespace"),n.exit("blockQuotePrefix"),e):(n.exit("blockQuotePrefix"),e(o))}}function sEe(n,e,t){const s=this;return r;function r(o){return Tt(o)?Ot(n,i,"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o):i(o)}function i(o){return n.attempt(l4,e,t)(o)}}function rEe(n){n.exit("blockQuote")}const c4={name:"characterEscape",tokenize:iEe};function iEe(n,e,t){return s;function s(i){return n.enter("characterEscape"),n.enter("escapeMarker"),n.consume(i),n.exit("escapeMarker"),r}function r(i){return GCe(i)?(n.enter("characterEscapeValue"),n.consume(i),n.exit("characterEscapeValue"),n.exit("characterEscape"),e):t(i)}}const u4={name:"characterReference",tokenize:oEe};function oEe(n,e,t){const s=this;let r=0,i,o;return a;function a(h){return n.enter("characterReference"),n.enter("characterReferenceMarker"),n.consume(h),n.exit("characterReferenceMarker"),l}function l(h){return h===35?(n.enter("characterReferenceMarkerNumeric"),n.consume(h),n.exit("characterReferenceMarkerNumeric"),c):(n.enter("characterReferenceValue"),i=31,o=Cs,u(h))}function c(h){return h===88||h===120?(n.enter("characterReferenceMarkerHexadecimal"),n.consume(h),n.exit("characterReferenceMarkerHexadecimal"),n.enter("characterReferenceValue"),i=6,o=WCe,u):(n.enter("characterReferenceValue"),i=7,o=iS,u(h))}function u(h){if(h===59&&r){const d=n.exit("characterReferenceValue");return o===Cs&&!k_(s.sliceSerialize(d))?t(h):(n.enter("characterReferenceMarker"),n.consume(h),n.exit("characterReferenceMarker"),n.exit("characterReference"),e)}return o(h)&&r++<i?(n.consume(h),u):t(h)}}const c$={partial:!0,tokenize:lEe},u$={concrete:!0,name:"codeFenced",tokenize:aEe};function aEe(n,e,t){const s=this,r={partial:!0,tokenize:_};let i=0,o=0,a;return l;function l(N){return c(N)}function c(N){const T=s.events[s.events.length-1];return i=T&&T[1].type==="linePrefix"?T[2].sliceSerialize(T[1],!0).length:0,a=N,n.enter("codeFenced"),n.enter("codeFencedFence"),n.enter("codeFencedFenceSequence"),u(N)}function u(N){return N===a?(o++,n.consume(N),u):o<3?t(N):(n.exit("codeFencedFenceSequence"),Tt(N)?Ot(n,h,"whitespace")(N):h(N))}function h(N){return N===null||Ge(N)?(n.exit("codeFencedFence"),s.interrupt?e(N):n.check(c$,g,I)(N)):(n.enter("codeFencedFenceInfo"),n.enter("chunkString",{contentType:"string"}),d(N))}function d(N){return N===null||Ge(N)?(n.exit("chunkString"),n.exit("codeFencedFenceInfo"),h(N)):Tt(N)?(n.exit("chunkString"),n.exit("codeFencedFenceInfo"),Ot(n,p,"whitespace")(N)):N===96&&N===a?t(N):(n.consume(N),d)}function p(N){return N===null||Ge(N)?h(N):(n.enter("codeFencedFenceMeta"),n.enter("chunkString",{contentType:"string"}),f(N))}function f(N){return N===null||Ge(N)?(n.exit("chunkString"),n.exit("codeFencedFenceMeta"),h(N)):N===96&&N===a?t(N):(n.consume(N),f)}function g(N){return n.attempt(r,I,m)(N)}function m(N){return n.enter("lineEnding"),n.consume(N),n.exit("lineEnding"),y}function y(N){return i>0&&Tt(N)?Ot(n,w,"linePrefix",i+1)(N):w(N)}function w(N){return N===null||Ge(N)?n.check(c$,g,I)(N):(n.enter("codeFlowValue"),v(N))}function v(N){return N===null||Ge(N)?(n.exit("codeFlowValue"),w(N)):(n.consume(N),v)}function I(N){return n.exit("codeFenced"),e(N)}function _(N,T,E){let k=0;return S;function S(U){return N.enter("lineEnding"),N.consume(U),N.exit("lineEnding"),A}function A(U){return N.enter("codeFencedFence"),Tt(U)?Ot(N,P,"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(U):P(U)}function P(U){return U===a?(N.enter("codeFencedFenceSequence"),D(U)):E(U)}function D(U){return U===a?(k++,N.consume(U),D):k>=o?(N.exit("codeFencedFenceSequence"),Tt(U)?Ot(N,V,"whitespace")(U):V(U)):E(U)}function V(U){return U===null||Ge(U)?(N.exit("codeFencedFence"),T(U)):E(U)}}}function lEe(n,e,t){const s=this;return r;function r(o){return o===null?t(o):(n.enter("lineEnding"),n.consume(o),n.exit("lineEnding"),i)}function i(o){return s.parser.lazy[s.now().line]?t(o):e(o)}}const Jv={name:"codeIndented",tokenize:uEe},cEe={partial:!0,tokenize:hEe};function uEe(n,e,t){const s=this;return r;function r(c){return n.enter("codeIndented"),Ot(n,i,"linePrefix",4+1)(c)}function i(c){const u=s.events[s.events.length-1];return u&&u[1].type==="linePrefix"&&u[2].sliceSerialize(u[1],!0).length>=4?o(c):t(c)}function o(c){return c===null?l(c):Ge(c)?n.attempt(cEe,o,l)(c):(n.enter("codeFlowValue"),a(c))}function a(c){return c===null||Ge(c)?(n.exit("codeFlowValue"),o(c)):(n.consume(c),a)}function l(c){return n.exit("codeIndented"),e(c)}}function hEe(n,e,t){const s=this;return r;function r(o){return s.parser.lazy[s.now().line]?t(o):Ge(o)?(n.enter("lineEnding"),n.consume(o),n.exit("lineEnding"),r):Ot(n,i,"linePrefix",4+1)(o)}function i(o){const a=s.events[s.events.length-1];return a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):Ge(o)?r(o):t(o)}}const dEe={name:"codeText",previous:fEe,resolve:pEe,tokenize:mEe};function pEe(n){let e=n.length-4,t=3,s,r;if((n[t][1].type==="lineEnding"||n[t][1].type==="space")&&(n[e][1].type==="lineEnding"||n[e][1].type==="space")){for(s=t;++s<e;)if(n[s][1].type==="codeTextData"){n[t][1].type="codeTextPadding",n[e][1].type="codeTextPadding",t+=2,e-=2;break}}for(s=t-1,e++;++s<=e;)r===void 0?s!==e&&n[s][1].type!=="lineEnding"&&(r=s):(s===e||n[s][1].type==="lineEnding")&&(n[r][1].type="codeTextData",s!==r+2&&(n[r][1].end=n[s-1][1].end,n.splice(r+2,s-r-2),e-=s-r-2,s=r+2),r=void 0);return n}function fEe(n){return n!==96||this.events[this.events.length-1][1].type==="characterEscape"}function mEe(n,e,t){let s=0,r,i;return o;function o(h){return n.enter("codeText"),n.enter("codeTextSequence"),a(h)}function a(h){return h===96?(n.consume(h),s++,a):(n.exit("codeTextSequence"),l(h))}function l(h){return h===null?t(h):h===32?(n.enter("space"),n.consume(h),n.exit("space"),l):h===96?(i=n.enter("codeTextSequence"),r=0,u(h)):Ge(h)?(n.enter("lineEnding"),n.consume(h),n.exit("lineEnding"),l):(n.enter("codeTextData"),c(h))}function c(h){return h===null||h===32||h===96||Ge(h)?(n.exit("codeTextData"),l(h)):(n.consume(h),c)}function u(h){return h===96?(n.consume(h),r++,u):r===s?(n.exit("codeTextSequence"),n.exit("codeText"),e(h)):(i.type="codeTextData",c(h))}}class gEe{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,t){const s=t??Number.POSITIVE_INFINITY;return s<this.left.length?this.left.slice(e,s):e>this.left.length?this.right.slice(this.right.length-s+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-s+this.left.length).reverse())}splice(e,t,s){const r=t||0;this.setCursor(Math.trunc(e));const i=this.right.splice(this.right.length-r,Number.POSITIVE_INFINITY);return s&&$d(this.left,s),i.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),$d(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),$d(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const t=this.left.splice(e,Number.POSITIVE_INFINITY);$d(this.right,t.reverse())}else{const t=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);$d(this.left,t.reverse())}}}function $d(n,e){let t=0;if(e.length<1e4)n.push(...e);else for(;t<e.length;)n.push(...e.slice(t,t+1e4)),t+=1e4}function h4(n){const e={};let t=-1,s,r,i,o,a,l,c;const u=new gEe(n);for(;++t<u.length;){for(;t in e;)t=e[t];if(s=u.get(t),t&&s[1].type==="chunkFlow"&&u.get(t-1)[1].type==="listItemPrefix"&&(l=s[1]._tokenizer.events,i=0,i<l.length&&l[i][1].type==="lineEndingBlank"&&(i+=2),i<l.length&&l[i][1].type==="content"))for(;++i<l.length&&l[i][1].type!=="content";)l[i][1].type==="chunkText"&&(l[i][1]._isInFirstContentOfListItem=!0,i++);if(s[0]==="enter")s[1].contentType&&(Object.assign(e,yEe(u,t)),t=e[t],c=!0);else if(s[1]._container){for(i=t,r=void 0;i--;)if(o=u.get(i),o[1].type==="lineEnding"||o[1].type==="lineEndingBlank")o[0]==="enter"&&(r&&(u.get(r)[1].type="lineEndingBlank"),o[1].type="lineEnding",r=i);else if(!(o[1].type==="linePrefix"||o[1].type==="listItemIndent"))break;r&&(s[1].end={...u.get(r)[1].start},a=u.slice(r,t),a.unshift(s),u.splice(r,t-r+1,a))}}return kr(n,0,Number.POSITIVE_INFINITY,u.slice(0)),!c}function yEe(n,e){const t=n.get(e)[1],s=n.get(e)[2];let r=e-1;const i=[];let o=t._tokenizer;o||(o=s.parser[t.contentType](t.start),t._contentTypeTextTrailing&&(o._contentTypeTextTrailing=!0));const a=o.events,l=[],c={};let u,h,d=-1,p=t,f=0,g=0;const m=[g];for(;p;){for(;n.get(++r)[1]!==p;);i.push(r),p._tokenizer||(u=s.sliceStream(p),p.next||u.push(null),h&&o.defineSkip(p.start),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=!0),o.write(u),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=void 0)),h=p,p=p.next}for(p=t;++d<a.length;)a[d][0]==="exit"&&a[d-1][0]==="enter"&&a[d][1].type===a[d-1][1].type&&a[d][1].start.line!==a[d][1].end.line&&(g=d+1,m.push(g),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(o.events=[],p?(p._tokenizer=void 0,p.previous=void 0):m.pop(),d=m.length;d--;){const y=a.slice(m[d],m[d+1]),w=i.pop();l.push([w,w+y.length-1]),n.splice(w,2,y)}for(l.reverse(),d=-1;++d<l.length;)c[f+l[d][0]]=f+l[d][1],f+=l[d][1]-l[d][0]-1;return c}const bEe={resolve:wEe,tokenize:vEe},xEe={partial:!0,tokenize:IEe};function wEe(n){return h4(n),n}function vEe(n,e){let t;return s;function s(a){return n.enter("content"),t=n.enter("chunkContent",{contentType:"content"}),r(a)}function r(a){return a===null?i(a):Ge(a)?n.check(xEe,o,i)(a):(n.consume(a),r)}function i(a){return n.exit("chunkContent"),n.exit("content"),e(a)}function o(a){return n.consume(a),n.exit("chunkContent"),t.next=n.enter("chunkContent",{contentType:"content",previous:t}),t=t.next,r}}function IEe(n,e,t){const s=this;return r;function r(o){return n.exit("chunkContent"),n.enter("lineEnding"),n.consume(o),n.exit("lineEnding"),Ot(n,i,"linePrefix")}function i(o){if(o===null||Ge(o))return t(o);const a=s.events[s.events.length-1];return!s.parser.constructs.disable.null.includes("codeIndented")&&a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):n.interrupt(s.parser.constructs.flow,t,e)(o)}}function d4(n,e,t,s,r,i,o,a,l){const c=l||Number.POSITIVE_INFINITY;let u=0;return h;function h(y){return y===60?(n.enter(s),n.enter(r),n.enter(i),n.consume(y),n.exit(i),d):y===null||y===32||y===41||Db(y)?t(y):(n.enter(s),n.enter(o),n.enter(a),n.enter("chunkString",{contentType:"string"}),g(y))}function d(y){return y===62?(n.enter(i),n.consume(y),n.exit(i),n.exit(r),n.exit(s),e):(n.enter(a),n.enter("chunkString",{contentType:"string"}),p(y))}function p(y){return y===62?(n.exit("chunkString"),n.exit(a),d(y)):y===null||y===60||Ge(y)?t(y):(n.consume(y),y===92?f:p)}function f(y){return y===60||y===62||y===92?(n.consume(y),p):p(y)}function g(y){return!u&&(y===null||y===41||Qt(y))?(n.exit("chunkString"),n.exit(a),n.exit(o),n.exit(s),e(y)):u<c&&y===40?(n.consume(y),u++,g):y===41?(n.consume(y),u--,g):y===null||y===32||y===40||Db(y)?t(y):(n.consume(y),y===92?m:g)}function m(y){return y===40||y===41||y===92?(n.consume(y),g):g(y)}}function p4(n,e,t,s,r,i){const o=this;let a=0,l;return c;function c(p){return n.enter(s),n.enter(r),n.consume(p),n.exit(r),n.enter(i),u}function u(p){return a>999||p===null||p===91||p===93&&!l||p===94&&!a&&"_hiddenFootnoteSupport"in o.parser.constructs?t(p):p===93?(n.exit(i),n.enter(r),n.consume(p),n.exit(r),n.exit(s),e):Ge(p)?(n.enter("lineEnding"),n.consume(p),n.exit("lineEnding"),u):(n.enter("chunkString",{contentType:"string"}),h(p))}function h(p){return p===null||p===91||p===93||Ge(p)||a++>999?(n.exit("chunkString"),u(p)):(n.consume(p),l||(l=!Tt(p)),p===92?d:h)}function d(p){return p===91||p===92||p===93?(n.consume(p),a++,h):h(p)}}function f4(n,e,t,s,r,i){let o;return a;function a(d){return d===34||d===39||d===40?(n.enter(s),n.enter(r),n.consume(d),n.exit(r),o=d===40?41:d,l):t(d)}function l(d){return d===o?(n.enter(r),n.consume(d),n.exit(r),n.exit(s),e):(n.enter(i),c(d))}function c(d){return d===o?(n.exit(i),l(o)):d===null?t(d):Ge(d)?(n.enter("lineEnding"),n.consume(d),n.exit("lineEnding"),Ot(n,c,"linePrefix")):(n.enter("chunkString",{contentType:"string"}),u(d))}function u(d){return d===o||d===null||Ge(d)?(n.exit("chunkString"),c(d)):(n.consume(d),d===92?h:u)}function h(d){return d===o||d===92?(n.consume(d),u):u(d)}}function ip(n,e){let t;return s;function s(r){return Ge(r)?(n.enter("lineEnding"),n.consume(r),n.exit("lineEnding"),t=!0,s):Tt(r)?Ot(n,s,t?"linePrefix":"lineSuffix")(r):e(r)}}const SEe={name:"definition",tokenize:TEe},kEe={partial:!0,tokenize:CEe};function TEe(n,e,t){const s=this;let r;return i;function i(p){return n.enter("definition"),o(p)}function o(p){return p4.call(s,n,a,t,"definitionLabel","definitionLabelMarker","definitionLabelString")(p)}function a(p){return r=ci(s.sliceSerialize(s.events[s.events.length-1][1]).slice(1,-1)),p===58?(n.enter("definitionMarker"),n.consume(p),n.exit("definitionMarker"),l):t(p)}function l(p){return Qt(p)?ip(n,c)(p):c(p)}function c(p){return d4(n,u,t,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(p)}function u(p){return n.attempt(kEe,h,h)(p)}function h(p){return Tt(p)?Ot(n,d,"whitespace")(p):d(p)}function d(p){return p===null||Ge(p)?(n.exit("definition"),s.parser.defined.push(r),e(p)):t(p)}}function CEe(n,e,t){return s;function s(a){return Qt(a)?ip(n,r)(a):t(a)}function r(a){return f4(n,i,t,"definitionTitle","definitionTitleMarker","definitionTitleString")(a)}function i(a){return Tt(a)?Ot(n,o,"whitespace")(a):o(a)}function o(a){return a===null||Ge(a)?e(a):t(a)}}const EEe={name:"hardBreakEscape",tokenize:_Ee};function _Ee(n,e,t){return s;function s(i){return n.enter("hardBreakEscape"),n.consume(i),r}function r(i){return Ge(i)?(n.exit("hardBreakEscape"),e(i)):t(i)}}const NEe={name:"headingAtx",resolve:AEe,tokenize:REe};function AEe(n,e){let t=n.length-2,s=3,r,i;return n[s][1].type==="whitespace"&&(s+=2),t-2>s&&n[t][1].type==="whitespace"&&(t-=2),n[t][1].type==="atxHeadingSequence"&&(s===t-1||t-4>s&&n[t-2][1].type==="whitespace")&&(t-=s+1===t?2:4),t>s&&(r={type:"atxHeadingText",start:n[s][1].start,end:n[t][1].end},i={type:"chunkText",start:n[s][1].start,end:n[t][1].end,contentType:"text"},kr(n,s,t-s+1,[["enter",r,e],["enter",i,e],["exit",i,e],["exit",r,e]])),n}function REe(n,e,t){let s=0;return r;function r(u){return n.enter("atxHeading"),i(u)}function i(u){return n.enter("atxHeadingSequence"),o(u)}function o(u){return u===35&&s++<6?(n.consume(u),o):u===null||Qt(u)?(n.exit("atxHeadingSequence"),a(u)):t(u)}function a(u){return u===35?(n.enter("atxHeadingSequence"),l(u)):u===null||Ge(u)?(n.exit("atxHeading"),e(u)):Tt(u)?Ot(n,a,"whitespace")(u):(n.enter("atxHeadingText"),c(u))}function l(u){return u===35?(n.consume(u),l):(n.exit("atxHeadingSequence"),a(u))}function c(u){return u===null||u===35||Qt(u)?(n.exit("atxHeadingText"),a(u)):(n.consume(u),c)}}const $Ee=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],h$=["pre","script","style","textarea"],DEe={concrete:!0,name:"htmlFlow",resolveTo:FEe,tokenize:LEe},PEe={partial:!0,tokenize:zEe},OEe={partial:!0,tokenize:MEe};function FEe(n){let e=n.length;for(;e--&&!(n[e][0]==="enter"&&n[e][1].type==="htmlFlow"););return e>1&&n[e-2][1].type==="linePrefix"&&(n[e][1].start=n[e-2][1].start,n[e+1][1].start=n[e-2][1].start,n.splice(e-2,2)),n}function LEe(n,e,t){const s=this;let r,i,o,a,l;return c;function c(z){return u(z)}function u(z){return n.enter("htmlFlow"),n.enter("htmlFlowData"),n.consume(z),h}function h(z){return z===33?(n.consume(z),d):z===47?(n.consume(z),i=!0,g):z===63?(n.consume(z),r=3,s.interrupt?e:L):Ms(z)?(n.consume(z),o=String.fromCharCode(z),m):t(z)}function d(z){return z===45?(n.consume(z),r=2,p):z===91?(n.consume(z),r=5,a=0,f):Ms(z)?(n.consume(z),r=4,s.interrupt?e:L):t(z)}function p(z){return z===45?(n.consume(z),s.interrupt?e:L):t(z)}function f(z){const ue="CDATA[";return z===ue.charCodeAt(a++)?(n.consume(z),a===ue.length?s.interrupt?e:P:f):t(z)}function g(z){return Ms(z)?(n.consume(z),o=String.fromCharCode(z),m):t(z)}function m(z){if(z===null||z===47||z===62||Qt(z)){const ue=z===47,de=o.toLowerCase();return!ue&&!i&&h$.includes(de)?(r=1,s.interrupt?e(z):P(z)):$Ee.includes(o.toLowerCase())?(r=6,ue?(n.consume(z),y):s.interrupt?e(z):P(z)):(r=7,s.interrupt&&!s.parser.lazy[s.now().line]?t(z):i?w(z):v(z))}return z===45||Cs(z)?(n.consume(z),o+=String.fromCharCode(z),m):t(z)}function y(z){return z===62?(n.consume(z),s.interrupt?e:P):t(z)}function w(z){return Tt(z)?(n.consume(z),w):S(z)}function v(z){return z===47?(n.consume(z),S):z===58||z===95||Ms(z)?(n.consume(z),I):Tt(z)?(n.consume(z),v):S(z)}function I(z){return z===45||z===46||z===58||z===95||Cs(z)?(n.consume(z),I):_(z)}function _(z){return z===61?(n.consume(z),N):Tt(z)?(n.consume(z),_):v(z)}function N(z){return z===null||z===60||z===61||z===62||z===96?t(z):z===34||z===39?(n.consume(z),l=z,T):Tt(z)?(n.consume(z),N):E(z)}function T(z){return z===l?(n.consume(z),l=null,k):z===null||Ge(z)?t(z):(n.consume(z),T)}function E(z){return z===null||z===34||z===39||z===47||z===60||z===61||z===62||z===96||Qt(z)?_(z):(n.consume(z),E)}function k(z){return z===47||z===62||Tt(z)?v(z):t(z)}function S(z){return z===62?(n.consume(z),A):t(z)}function A(z){return z===null||Ge(z)?P(z):Tt(z)?(n.consume(z),A):t(z)}function P(z){return z===45&&r===2?(n.consume(z),q):z===60&&r===1?(n.consume(z),J):z===62&&r===4?(n.consume(z),ae):z===63&&r===3?(n.consume(z),L):z===93&&r===5?(n.consume(z),ee):Ge(z)&&(r===6||r===7)?(n.exit("htmlFlowData"),n.check(PEe,ce,D)(z)):z===null||Ge(z)?(n.exit("htmlFlowData"),D(z)):(n.consume(z),P)}function D(z){return n.check(OEe,V,ce)(z)}function V(z){return n.enter("lineEnding"),n.consume(z),n.exit("lineEnding"),U}function U(z){return z===null||Ge(z)?D(z):(n.enter("htmlFlowData"),P(z))}function q(z){return z===45?(n.consume(z),L):P(z)}function J(z){return z===47?(n.consume(z),o="",K):P(z)}function K(z){if(z===62){const ue=o.toLowerCase();return h$.includes(ue)?(n.consume(z),ae):P(z)}return Ms(z)&&o.length<8?(n.consume(z),o+=String.fromCharCode(z),K):P(z)}function ee(z){return z===93?(n.consume(z),L):P(z)}function L(z){return z===62?(n.consume(z),ae):z===45&&r===2?(n.consume(z),L):P(z)}function ae(z){return z===null||Ge(z)?(n.exit("htmlFlowData"),ce(z)):(n.consume(z),ae)}function ce(z){return n.exit("htmlFlow"),e(z)}}function MEe(n,e,t){const s=this;return r;function r(o){return Ge(o)?(n.enter("lineEnding"),n.consume(o),n.exit("lineEnding"),i):t(o)}function i(o){return s.parser.lazy[s.now().line]?t(o):e(o)}}function zEe(n,e,t){return s;function s(r){return n.enter("lineEnding"),n.consume(r),n.exit("lineEnding"),n.attempt(cg,e,t)}}const VEe={name:"htmlText",tokenize:BEe};function BEe(n,e,t){const s=this;let r,i,o;return a;function a(L){return n.enter("htmlText"),n.enter("htmlTextData"),n.consume(L),l}function l(L){return L===33?(n.consume(L),c):L===47?(n.consume(L),_):L===63?(n.consume(L),v):Ms(L)?(n.consume(L),E):t(L)}function c(L){return L===45?(n.consume(L),u):L===91?(n.consume(L),i=0,f):Ms(L)?(n.consume(L),w):t(L)}function u(L){return L===45?(n.consume(L),p):t(L)}function h(L){return L===null?t(L):L===45?(n.consume(L),d):Ge(L)?(o=h,J(L)):(n.consume(L),h)}function d(L){return L===45?(n.consume(L),p):h(L)}function p(L){return L===62?q(L):L===45?d(L):h(L)}function f(L){const ae="CDATA[";return L===ae.charCodeAt(i++)?(n.consume(L),i===ae.length?g:f):t(L)}function g(L){return L===null?t(L):L===93?(n.consume(L),m):Ge(L)?(o=g,J(L)):(n.consume(L),g)}function m(L){return L===93?(n.consume(L),y):g(L)}function y(L){return L===62?q(L):L===93?(n.consume(L),y):g(L)}function w(L){return L===null||L===62?q(L):Ge(L)?(o=w,J(L)):(n.consume(L),w)}function v(L){return L===null?t(L):L===63?(n.consume(L),I):Ge(L)?(o=v,J(L)):(n.consume(L),v)}function I(L){return L===62?q(L):v(L)}function _(L){return Ms(L)?(n.consume(L),N):t(L)}function N(L){return L===45||Cs(L)?(n.consume(L),N):T(L)}function T(L){return Ge(L)?(o=T,J(L)):Tt(L)?(n.consume(L),T):q(L)}function E(L){return L===45||Cs(L)?(n.consume(L),E):L===47||L===62||Qt(L)?k(L):t(L)}function k(L){return L===47?(n.consume(L),q):L===58||L===95||Ms(L)?(n.consume(L),S):Ge(L)?(o=k,J(L)):Tt(L)?(n.consume(L),k):q(L)}function S(L){return L===45||L===46||L===58||L===95||Cs(L)?(n.consume(L),S):A(L)}function A(L){return L===61?(n.consume(L),P):Ge(L)?(o=A,J(L)):Tt(L)?(n.consume(L),A):k(L)}function P(L){return L===null||L===60||L===61||L===62||L===96?t(L):L===34||L===39?(n.consume(L),r=L,D):Ge(L)?(o=P,J(L)):Tt(L)?(n.consume(L),P):(n.consume(L),V)}function D(L){return L===r?(n.consume(L),r=void 0,U):L===null?t(L):Ge(L)?(o=D,J(L)):(n.consume(L),D)}function V(L){return L===null||L===34||L===39||L===60||L===61||L===96?t(L):L===47||L===62||Qt(L)?k(L):(n.consume(L),V)}function U(L){return L===47||L===62||Qt(L)?k(L):t(L)}function q(L){return L===62?(n.consume(L),n.exit("htmlTextData"),n.exit("htmlText"),e):t(L)}function J(L){return n.exit("htmlTextData"),n.enter("lineEnding"),n.consume(L),n.exit("lineEnding"),K}function K(L){return Tt(L)?Ot(n,ee,"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(L):ee(L)}function ee(L){return n.enter("htmlTextData"),o(L)}}const T_={name:"labelEnd",resolveAll:GEe,resolveTo:HEe,tokenize:qEe},jEe={tokenize:KEe},UEe={tokenize:XEe},WEe={tokenize:YEe};function GEe(n){let e=-1;const t=[];for(;++e<n.length;){const s=n[e][1];if(t.push(n[e]),s.type==="labelImage"||s.type==="labelLink"||s.type==="labelEnd"){const r=s.type==="labelImage"?4:2;s.type="data",e+=r}}return n.length!==t.length&&kr(n,0,n.length,t),n}function HEe(n,e){let t=n.length,s=0,r,i,o,a;for(;t--;)if(r=n[t][1],i){if(r.type==="link"||r.type==="labelLink"&&r._inactive)break;n[t][0]==="enter"&&r.type==="labelLink"&&(r._inactive=!0)}else if(o){if(n[t][0]==="enter"&&(r.type==="labelImage"||r.type==="labelLink")&&!r._balanced&&(i=t,r.type!=="labelLink")){s=2;break}}else r.type==="labelEnd"&&(o=t);const l={type:n[i][1].type==="labelLink"?"link":"image",start:{...n[i][1].start},end:{...n[n.length-1][1].end}},c={type:"label",start:{...n[i][1].start},end:{...n[o][1].end}},u={type:"labelText",start:{...n[i+s+2][1].end},end:{...n[o-2][1].start}};return a=[["enter",l,e],["enter",c,e]],a=Pr(a,n.slice(i+1,i+s+3)),a=Pr(a,[["enter",u,e]]),a=Pr(a,M0(e.parser.constructs.insideSpan.null,n.slice(i+s+4,o-3),e)),a=Pr(a,[["exit",u,e],n[o-2],n[o-1],["exit",c,e]]),a=Pr(a,n.slice(o+1)),a=Pr(a,[["exit",l,e]]),kr(n,i,n.length,a),n}function qEe(n,e,t){const s=this;let r=s.events.length,i,o;for(;r--;)if((s.events[r][1].type==="labelImage"||s.events[r][1].type==="labelLink")&&!s.events[r][1]._balanced){i=s.events[r][1];break}return a;function a(d){return i?i._inactive?h(d):(o=s.parser.defined.includes(ci(s.sliceSerialize({start:i.end,end:s.now()}))),n.enter("labelEnd"),n.enter("labelMarker"),n.consume(d),n.exit("labelMarker"),n.exit("labelEnd"),l):t(d)}function l(d){return d===40?n.attempt(jEe,u,o?u:h)(d):d===91?n.attempt(UEe,u,o?c:h)(d):o?u(d):h(d)}function c(d){return n.attempt(WEe,u,h)(d)}function u(d){return e(d)}function h(d){return i._balanced=!0,t(d)}}function KEe(n,e,t){return s;function s(h){return n.enter("resource"),n.enter("resourceMarker"),n.consume(h),n.exit("resourceMarker"),r}function r(h){return Qt(h)?ip(n,i)(h):i(h)}function i(h){return h===41?u(h):d4(n,o,a,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(h)}function o(h){return Qt(h)?ip(n,l)(h):u(h)}function a(h){return t(h)}function l(h){return h===34||h===39||h===40?f4(n,c,t,"resourceTitle","resourceTitleMarker","resourceTitleString")(h):u(h)}function c(h){return Qt(h)?ip(n,u)(h):u(h)}function u(h){return h===41?(n.enter("resourceMarker"),n.consume(h),n.exit("resourceMarker"),n.exit("resource"),e):t(h)}}function XEe(n,e,t){const s=this;return r;function r(a){return p4.call(s,n,i,o,"reference","referenceMarker","referenceString")(a)}function i(a){return s.parser.defined.includes(ci(s.sliceSerialize(s.events[s.events.length-1][1]).slice(1,-1)))?e(a):t(a)}function o(a){return t(a)}}function YEe(n,e,t){return s;function s(i){return n.enter("reference"),n.enter("referenceMarker"),n.consume(i),n.exit("referenceMarker"),r}function r(i){return i===93?(n.enter("referenceMarker"),n.consume(i),n.exit("referenceMarker"),n.exit("reference"),e):t(i)}}const QEe={name:"labelStartImage",resolveAll:T_.resolveAll,tokenize:ZEe};function ZEe(n,e,t){const s=this;return r;function r(a){return n.enter("labelImage"),n.enter("labelImageMarker"),n.consume(a),n.exit("labelImageMarker"),i}function i(a){return a===91?(n.enter("labelMarker"),n.consume(a),n.exit("labelMarker"),n.exit("labelImage"),o):t(a)}function o(a){return a===94&&"_hiddenFootnoteSupport"in s.parser.constructs?t(a):e(a)}}const JEe={name:"labelStartLink",resolveAll:T_.resolveAll,tokenize:e_e};function e_e(n,e,t){const s=this;return r;function r(o){return n.enter("labelLink"),n.enter("labelMarker"),n.consume(o),n.exit("labelMarker"),n.exit("labelLink"),i}function i(o){return o===94&&"_hiddenFootnoteSupport"in s.parser.constructs?t(o):e(o)}}const e1={name:"lineEnding",tokenize:t_e};function t_e(n,e){return t;function t(s){return n.enter("lineEnding"),n.consume(s),n.exit("lineEnding"),Ot(n,e,"linePrefix")}}const Ty={name:"thematicBreak",tokenize:n_e};function n_e(n,e,t){let s=0,r;return i;function i(c){return n.enter("thematicBreak"),o(c)}function o(c){return r=c,a(c)}function a(c){return c===r?(n.enter("thematicBreakSequence"),l(c)):s>=3&&(c===null||Ge(c))?(n.exit("thematicBreak"),e(c)):t(c)}function l(c){return c===r?(n.consume(c),s++,l):(n.exit("thematicBreakSequence"),Tt(c)?Ot(n,a,"whitespace")(c):a(c))}}const Js={continuation:{tokenize:o_e},exit:l_e,name:"list",tokenize:i_e},s_e={partial:!0,tokenize:c_e},r_e={partial:!0,tokenize:a_e};function i_e(n,e,t){const s=this,r=s.events[s.events.length-1];let i=r&&r[1].type==="linePrefix"?r[2].sliceSerialize(r[1],!0).length:0,o=0;return a;function a(p){const f=s.containerState.type||(p===42||p===43||p===45?"listUnordered":"listOrdered");if(f==="listUnordered"?!s.containerState.marker||p===s.containerState.marker:iS(p)){if(s.containerState.type||(s.containerState.type=f,n.enter(f,{_container:!0})),f==="listUnordered")return n.enter("listItemPrefix"),p===42||p===45?n.check(Ty,t,c)(p):c(p);if(!s.interrupt||p===49)return n.enter("listItemPrefix"),n.enter("listItemValue"),l(p)}return t(p)}function l(p){return iS(p)&&++o<10?(n.consume(p),l):(!s.interrupt||o<2)&&(s.containerState.marker?p===s.containerState.marker:p===41||p===46)?(n.exit("listItemValue"),c(p)):t(p)}function c(p){return n.enter("listItemMarker"),n.consume(p),n.exit("listItemMarker"),s.containerState.marker=s.containerState.marker||p,n.check(cg,s.interrupt?t:u,n.attempt(s_e,d,h))}function u(p){return s.containerState.initialBlankLine=!0,i++,d(p)}function h(p){return Tt(p)?(n.enter("listItemPrefixWhitespace"),n.consume(p),n.exit("listItemPrefixWhitespace"),d):t(p)}function d(p){return s.containerState.size=i+s.sliceSerialize(n.exit("listItemPrefix"),!0).length,e(p)}}function o_e(n,e,t){const s=this;return s.containerState._closeFlow=void 0,n.check(cg,r,i);function r(a){return s.containerState.furtherBlankLines=s.containerState.furtherBlankLines||s.containerState.initialBlankLine,Ot(n,e,"listItemIndent",s.containerState.size+1)(a)}function i(a){return s.containerState.furtherBlankLines||!Tt(a)?(s.containerState.furtherBlankLines=void 0,s.containerState.initialBlankLine=void 0,o(a)):(s.containerState.furtherBlankLines=void 0,s.containerState.initialBlankLine=void 0,n.attempt(r_e,e,o)(a))}function o(a){return s.containerState._closeFlow=!0,s.interrupt=void 0,Ot(n,n.attempt(Js,e,t),"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a)}}function a_e(n,e,t){const s=this;return Ot(n,r,"listItemIndent",s.containerState.size+1);function r(i){const o=s.events[s.events.length-1];return o&&o[1].type==="listItemIndent"&&o[2].sliceSerialize(o[1],!0).length===s.containerState.size?e(i):t(i)}}function l_e(n){n.exit(this.containerState.type)}function c_e(n,e,t){const s=this;return Ot(n,r,"listItemPrefixWhitespace",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4+1);function r(i){const o=s.events[s.events.length-1];return!Tt(i)&&o&&o[1].type==="listItemPrefixWhitespace"?e(i):t(i)}}const d$={name:"setextUnderline",resolveTo:u_e,tokenize:h_e};function u_e(n,e){let t=n.length,s,r,i;for(;t--;)if(n[t][0]==="enter"){if(n[t][1].type==="content"){s=t;break}n[t][1].type==="paragraph"&&(r=t)}else n[t][1].type==="content"&&n.splice(t,1),!i&&n[t][1].type==="definition"&&(i=t);const o={type:"setextHeading",start:{...n[s][1].start},end:{...n[n.length-1][1].end}};return n[r][1].type="setextHeadingText",i?(n.splice(r,0,["enter",o,e]),n.splice(i+1,0,["exit",n[s][1],e]),n[s][1].end={...n[i][1].end}):n[s][1]=o,n.push(["exit",o,e]),n}function h_e(n,e,t){const s=this;let r;return i;function i(c){let u=s.events.length,h;for(;u--;)if(s.events[u][1].type!=="lineEnding"&&s.events[u][1].type!=="linePrefix"&&s.events[u][1].type!=="content"){h=s.events[u][1].type==="paragraph";break}return!s.parser.lazy[s.now().line]&&(s.interrupt||h)?(n.enter("setextHeadingLine"),r=c,o(c)):t(c)}function o(c){return n.enter("setextHeadingLineSequence"),a(c)}function a(c){return c===r?(n.consume(c),a):(n.exit("setextHeadingLineSequence"),Tt(c)?Ot(n,l,"lineSuffix")(c):l(c))}function l(c){return c===null||Ge(c)?(n.exit("setextHeadingLine"),e(c)):t(c)}}const d_e={tokenize:p_e};function p_e(n){const e=this,t=n.attempt(cg,s,n.attempt(this.parser.constructs.flowInitial,r,Ot(n,n.attempt(this.parser.constructs.flow,r,n.attempt(bEe,r)),"linePrefix")));return t;function s(i){if(i===null){n.consume(i);return}return n.enter("lineEndingBlank"),n.consume(i),n.exit("lineEndingBlank"),e.currentConstruct=void 0,t}function r(i){if(i===null){n.consume(i);return}return n.enter("lineEnding"),n.consume(i),n.exit("lineEnding"),e.currentConstruct=void 0,t}}const f_e={resolveAll:g4()},m_e=m4("string"),g_e=m4("text");function m4(n){return{resolveAll:g4(n==="text"?y_e:void 0),tokenize:e};function e(t){const s=this,r=this.parser.constructs[n],i=t.attempt(r,o,a);return o;function o(u){return c(u)?i(u):a(u)}function a(u){if(u===null){t.consume(u);return}return t.enter("data"),t.consume(u),l}function l(u){return c(u)?(t.exit("data"),i(u)):(t.consume(u),l)}function c(u){if(u===null)return!0;const h=r[u];let d=-1;if(h)for(;++d<h.length;){const p=h[d];if(!p.previous||p.previous.call(s,s.previous))return!0}return!1}}}function g4(n){return e;function e(t,s){let r=-1,i;for(;++r<=t.length;)i===void 0?t[r]&&t[r][1].type==="data"&&(i=r,r++):(!t[r]||t[r][1].type!=="data")&&(r!==i+2&&(t[i][1].end=t[r-1][1].end,t.splice(i+2,r-i-2),r=i+2),i=void 0);return n?n(t,s):t}}function y_e(n,e){let t=0;for(;++t<=n.length;)if((t===n.length||n[t][1].type==="lineEnding")&&n[t-1][1].type==="data"){const s=n[t-1][1],r=e.sliceStream(s);let i=r.length,o=-1,a=0,l;for(;i--;){const c=r[i];if(typeof c=="string"){for(o=c.length;c.charCodeAt(o-1)===32;)a++,o--;if(o)break;o=-1}else if(c===-2)l=!0,a++;else if(c!==-1){i++;break}}if(e._contentTypeTextTrailing&&t===n.length&&(a=0),a){const c={type:t===n.length||l||a<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:i?o:s.start._bufferIndex+o,_index:s.start._index+i,line:s.end.line,column:s.end.column-a,offset:s.end.offset-a},end:{...s.end}};s.end={...c.start},s.start.offset===s.end.offset?Object.assign(s,c):(n.splice(t,0,["enter",c,e],["exit",c,e]),t+=2)}t++}return n}const b_e={42:Js,43:Js,45:Js,48:Js,49:Js,50:Js,51:Js,52:Js,53:Js,54:Js,55:Js,56:Js,57:Js,62:l4},x_e={91:SEe},w_e={[-2]:Jv,[-1]:Jv,32:Jv},v_e={35:NEe,42:Ty,45:[d$,Ty],60:DEe,61:d$,95:Ty,96:u$,126:u$},I_e={38:u4,92:c4},S_e={[-5]:e1,[-4]:e1,[-3]:e1,33:QEe,38:u4,42:oS,60:[JCe,VEe],91:JEe,92:[EEe,c4],93:T_,95:oS,96:dEe},k_e={null:[oS,f_e]},T_e={null:[42,95]},C_e={null:[]},E_e=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:T_e,contentInitial:x_e,disable:C_e,document:b_e,flow:v_e,flowInitial:w_e,insideSpan:k_e,string:I_e,text:S_e},Symbol.toStringTag,{value:"Module"}));function __e(n,e,t){let s={_bufferIndex:-1,_index:0,line:t&&t.line||1,column:t&&t.column||1,offset:t&&t.offset||0};const r={},i=[];let o=[],a=[];const l={attempt:T(_),check:T(N),consume:w,enter:v,exit:I,interrupt:T(N,{interrupt:!0})},c={code:null,containerState:{},defineSkip:g,events:[],now:f,parser:n,previous:null,sliceSerialize:d,sliceStream:p,write:h};let u=e.tokenize.call(c,l);return e.resolveAll&&i.push(e),c;function h(A){return o=Pr(o,A),m(),o[o.length-1]!==null?[]:(E(e,0),c.events=M0(i,c.events,c),c.events)}function d(A,P){return A_e(p(A),P)}function p(A){return N_e(o,A)}function f(){const{_bufferIndex:A,_index:P,line:D,column:V,offset:U}=s;return{_bufferIndex:A,_index:P,line:D,column:V,offset:U}}function g(A){r[A.line]=A.column,S()}function m(){let A;for(;s._index<o.length;){const P=o[s._index];if(typeof P=="string")for(A=s._index,s._bufferIndex<0&&(s._bufferIndex=0);s._index===A&&s._bufferIndex<P.length;)y(P.charCodeAt(s._bufferIndex));else y(P)}}function y(A){u=u(A)}function w(A){Ge(A)?(s.line++,s.column=1,s.offset+=A===-3?2:1,S()):A!==-1&&(s.column++,s.offset++),s._bufferIndex<0?s._index++:(s._bufferIndex++,s._bufferIndex===o[s._index].length&&(s._bufferIndex=-1,s._index++)),c.previous=A}function v(A,P){const D=P||{};return D.type=A,D.start=f(),c.events.push(["enter",D,c]),a.push(D),D}function I(A){const P=a.pop();return P.end=f(),c.events.push(["exit",P,c]),P}function _(A,P){E(A,P.from)}function N(A,P){P.restore()}function T(A,P){return D;function D(V,U,q){let J,K,ee,L;return Array.isArray(V)?ce(V):"tokenize"in V?ce([V]):ae(V);function ae(be){return Ee;function Ee(Re){const _e=Re!==null&&be[Re],Ae=Re!==null&&be.null,je=[...Array.isArray(_e)?_e:_e?[_e]:[],...Array.isArray(Ae)?Ae:Ae?[Ae]:[]];return ce(je)(Re)}}function ce(be){return J=be,K=0,be.length===0?q:z(be[K])}function z(be){return Ee;function Ee(Re){return L=k(),ee=be,be.partial||(c.currentConstruct=be),be.name&&c.parser.constructs.disable.null.includes(be.name)?de():be.tokenize.call(P?Object.assign(Object.create(c),P):c,l,ue,de)(Re)}}function ue(be){return A(ee,L),U}function de(be){return L.restore(),++K<J.length?z(J[K]):q}}}function E(A,P){A.resolveAll&&!i.includes(A)&&i.push(A),A.resolve&&kr(c.events,P,c.events.length-P,A.resolve(c.events.slice(P),c)),A.resolveTo&&(c.events=A.resolveTo(c.events,c))}function k(){const A=f(),P=c.previous,D=c.currentConstruct,V=c.events.length,U=Array.from(a);return{from:V,restore:q};function q(){s=A,c.previous=P,c.currentConstruct=D,c.events.length=V,a=U,S()}}function S(){s.line in r&&s.column<2&&(s.column=r[s.line],s.offset+=r[s.line]-1)}}function N_e(n,e){const t=e.start._index,s=e.start._bufferIndex,r=e.end._index,i=e.end._bufferIndex;let o;if(t===r)o=[n[t].slice(s,i)];else{if(o=n.slice(t,r),s>-1){const a=o[0];typeof a=="string"?o[0]=a.slice(s):o.shift()}i>0&&o.push(n[r].slice(0,i))}return o}function A_e(n,e){let t=-1;const s=[];let r;for(;++t<n.length;){const i=n[t];let o;if(typeof i=="string")o=i;else switch(i){case-5:{o="\r";break}case-4:{o=`
`;break}case-3:{o=`\r
`;break}case-2:{o=e?" ":"	";break}case-1:{if(!e&&r)continue;o=" ";break}default:o=String.fromCharCode(i)}r=i===-2,s.push(o)}return s.join("")}function R_e(n){const s={constructs:o4([E_e,...(n||{}).extensions||[]]),content:r(HCe),defined:[],document:r(KCe),flow:r(d_e),lazy:{},string:r(m_e),text:r(g_e)};return s;function r(i){return o;function o(a){return __e(s,i,a)}}}function $_e(n){for(;!h4(n););return n}const p$=/[\0\t\n\r]/g;function D_e(){let n=1,e="",t=!0,s;return r;function r(i,o,a){const l=[];let c,u,h,d,p;for(i=e+(typeof i=="string"?i.toString():new TextDecoder(o||void 0).decode(i)),h=0,e="",t&&(i.charCodeAt(0)===65279&&h++,t=void 0);h<i.length;){if(p$.lastIndex=h,c=p$.exec(i),d=c&&c.index!==void 0?c.index:i.length,p=i.charCodeAt(d),!c){e=i.slice(h);break}if(p===10&&h===d&&s)l.push(-3),s=void 0;else switch(s&&(l.push(-5),s=void 0),h<d&&(l.push(i.slice(h,d)),n+=d-h),p){case 0:{l.push(65533),n++;break}case 9:{for(u=Math.ceil(n/4)*4,l.push(-2);n++<u;)l.push(-1);break}case 10:{l.push(-4),n=1;break}default:s=!0,n=1}h=d+1}return a&&(s&&l.push(-5),e&&l.push(e),l.push(null)),l}}const P_e=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function O_e(n){return n.replace(P_e,F_e)}function F_e(n,e,t){if(e)return e;if(t.charCodeAt(0)===35){const r=t.charCodeAt(1),i=r===120||r===88;return a4(t.slice(i?2:1),i?16:10)}return k_(t)||n}const y4={}.hasOwnProperty;function L_e(n,e,t){return typeof e!="string"&&(t=e,e=void 0),M_e(t)($_e(R_e(t).document().write(D_e()(n,e,!0))))}function M_e(n){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:i(yn),autolinkProtocol:k,autolinkEmail:k,atxHeading:i(ot),blockQuote:i(Ae),characterEscape:k,characterReference:k,codeFenced:i(je),codeFencedFenceInfo:o,codeFencedFenceMeta:o,codeIndented:i(je,o),codeText:i(qe,o),codeTextData:k,data:k,codeFlowValue:k,definition:i(gt),definitionDestinationString:o,definitionLabelString:o,definitionTitleString:o,emphasis:i(Et),hardBreakEscape:i(xt),hardBreakTrailing:i(xt),htmlFlow:i(Rt,o),htmlFlowData:k,htmlText:i(Rt,o),htmlTextData:k,image:i(It),label:o,link:i(yn),listItem:i(zt),listItemValue:d,listOrdered:i(at,h),listUnordered:i(at),paragraph:i(ln),reference:z,referenceString:o,resourceDestinationString:o,resourceTitleString:o,setextHeading:i(ot),strong:i(Ps),thematicBreak:i(Yn)},exit:{atxHeading:l(),atxHeadingSequence:_,autolink:l(),autolinkEmail:_e,autolinkProtocol:Re,blockQuote:l(),characterEscapeValue:S,characterReferenceMarkerHexadecimal:de,characterReferenceMarkerNumeric:de,characterReferenceValue:be,characterReference:Ee,codeFenced:l(m),codeFencedFence:g,codeFencedFenceInfo:p,codeFencedFenceMeta:f,codeFlowValue:S,codeIndented:l(y),codeText:l(U),codeTextData:S,data:S,definition:l(),definitionDestinationString:I,definitionLabelString:w,definitionTitleString:v,emphasis:l(),hardBreakEscape:l(P),hardBreakTrailing:l(P),htmlFlow:l(D),htmlFlowData:S,htmlText:l(V),htmlTextData:S,image:l(J),label:ee,labelText:K,lineEnding:A,link:l(q),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:ue,resourceDestinationString:L,resourceTitleString:ae,resource:ce,setextHeading:l(E),setextHeadingLineSequence:T,setextHeadingText:N,strong:l(),thematicBreak:l()}};b4(e,(n||{}).mdastExtensions||[]);const t={};return s;function s(ie){let fe={type:"root",children:[]};const ze={stack:[fe],tokenStack:[],config:e,enter:a,exit:c,buffer:o,resume:u,data:t},Ke=[];let ne=-1;for(;++ne<ie.length;)if(ie[ne][1].type==="listOrdered"||ie[ne][1].type==="listUnordered")if(ie[ne][0]==="enter")Ke.push(ne);else{const Z=Ke.pop();ne=r(ie,Z,ne)}for(ne=-1;++ne<ie.length;){const Z=e[ie[ne][0]];y4.call(Z,ie[ne][1].type)&&Z[ie[ne][1].type].call(Object.assign({sliceSerialize:ie[ne][2].sliceSerialize},ze),ie[ne][1])}if(ze.tokenStack.length>0){const Z=ze.tokenStack[ze.tokenStack.length-1];(Z[1]||f$).call(ze,void 0,Z[0])}for(fe.position={start:Qo(ie.length>0?ie[0][1].start:{line:1,column:1,offset:0}),end:Qo(ie.length>0?ie[ie.length-2][1].end:{line:1,column:1,offset:0})},ne=-1;++ne<e.transforms.length;)fe=e.transforms[ne](fe)||fe;return fe}function r(ie,fe,ze){let Ke=fe-1,ne=-1,Z=!1,ye,Le,nt,Lt;for(;++Ke<=ze;){const lt=ie[Ke];switch(lt[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{lt[0]==="enter"?ne++:ne--,Lt=void 0;break}case"lineEndingBlank":{lt[0]==="enter"&&(ye&&!Lt&&!ne&&!nt&&(nt=Ke),Lt=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:Lt=void 0}if(!ne&&lt[0]==="enter"&&lt[1].type==="listItemPrefix"||ne===-1&&lt[0]==="exit"&&(lt[1].type==="listUnordered"||lt[1].type==="listOrdered")){if(ye){let Wt=Ke;for(Le=void 0;Wt--;){const Mt=ie[Wt];if(Mt[1].type==="lineEnding"||Mt[1].type==="lineEndingBlank"){if(Mt[0]==="exit")continue;Le&&(ie[Le][1].type="lineEndingBlank",Z=!0),Mt[1].type="lineEnding",Le=Wt}else if(!(Mt[1].type==="linePrefix"||Mt[1].type==="blockQuotePrefix"||Mt[1].type==="blockQuotePrefixWhitespace"||Mt[1].type==="blockQuoteMarker"||Mt[1].type==="listItemIndent"))break}nt&&(!Le||nt<Le)&&(ye._spread=!0),ye.end=Object.assign({},Le?ie[Le][1].start:lt[1].end),ie.splice(Le||Ke,0,["exit",ye,lt[2]]),Ke++,ze++}if(lt[1].type==="listItemPrefix"){const Wt={type:"listItem",_spread:!1,start:Object.assign({},lt[1].start),end:void 0};ye=Wt,ie.splice(Ke,0,["enter",Wt,lt[2]]),Ke++,ze++,nt=void 0,Lt=!0}}}return ie[fe][1]._spread=Z,ze}function i(ie,fe){return ze;function ze(Ke){a.call(this,ie(Ke),Ke),fe&&fe.call(this,Ke)}}function o(){this.stack.push({type:"fragment",children:[]})}function a(ie,fe,ze){this.stack[this.stack.length-1].children.push(ie),this.stack.push(ie),this.tokenStack.push([fe,ze||void 0]),ie.position={start:Qo(fe.start),end:void 0}}function l(ie){return fe;function fe(ze){ie&&ie.call(this,ze),c.call(this,ze)}}function c(ie,fe){const ze=this.stack.pop(),Ke=this.tokenStack.pop();if(Ke)Ke[0].type!==ie.type&&(fe?fe.call(this,ie,Ke[0]):(Ke[1]||f$).call(this,ie,Ke[0]));else throw new Error("Cannot close `"+ie.type+"` ("+rp({start:ie.start,end:ie.end})+"): itâ€™s not open");ze.position.end=Qo(ie.end)}function u(){return S_(this.stack.pop())}function h(){this.data.expectingFirstListItemValue=!0}function d(ie){if(this.data.expectingFirstListItemValue){const fe=this.stack[this.stack.length-2];fe.start=Number.parseInt(this.sliceSerialize(ie),10),this.data.expectingFirstListItemValue=void 0}}function p(){const ie=this.resume(),fe=this.stack[this.stack.length-1];fe.lang=ie}function f(){const ie=this.resume(),fe=this.stack[this.stack.length-1];fe.meta=ie}function g(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function m(){const ie=this.resume(),fe=this.stack[this.stack.length-1];fe.value=ie.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function y(){const ie=this.resume(),fe=this.stack[this.stack.length-1];fe.value=ie.replace(/(\r?\n|\r)$/g,"")}function w(ie){const fe=this.resume(),ze=this.stack[this.stack.length-1];ze.label=fe,ze.identifier=ci(this.sliceSerialize(ie)).toLowerCase()}function v(){const ie=this.resume(),fe=this.stack[this.stack.length-1];fe.title=ie}function I(){const ie=this.resume(),fe=this.stack[this.stack.length-1];fe.url=ie}function _(ie){const fe=this.stack[this.stack.length-1];if(!fe.depth){const ze=this.sliceSerialize(ie).length;fe.depth=ze}}function N(){this.data.setextHeadingSlurpLineEnding=!0}function T(ie){const fe=this.stack[this.stack.length-1];fe.depth=this.sliceSerialize(ie).codePointAt(0)===61?1:2}function E(){this.data.setextHeadingSlurpLineEnding=void 0}function k(ie){const ze=this.stack[this.stack.length-1].children;let Ke=ze[ze.length-1];(!Ke||Ke.type!=="text")&&(Ke=qt(),Ke.position={start:Qo(ie.start),end:void 0},ze.push(Ke)),this.stack.push(Ke)}function S(ie){const fe=this.stack.pop();fe.value+=this.sliceSerialize(ie),fe.position.end=Qo(ie.end)}function A(ie){const fe=this.stack[this.stack.length-1];if(this.data.atHardBreak){const ze=fe.children[fe.children.length-1];ze.position.end=Qo(ie.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(fe.type)&&(k.call(this,ie),S.call(this,ie))}function P(){this.data.atHardBreak=!0}function D(){const ie=this.resume(),fe=this.stack[this.stack.length-1];fe.value=ie}function V(){const ie=this.resume(),fe=this.stack[this.stack.length-1];fe.value=ie}function U(){const ie=this.resume(),fe=this.stack[this.stack.length-1];fe.value=ie}function q(){const ie=this.stack[this.stack.length-1];if(this.data.inReference){const fe=this.data.referenceType||"shortcut";ie.type+="Reference",ie.referenceType=fe,delete ie.url,delete ie.title}else delete ie.identifier,delete ie.label;this.data.referenceType=void 0}function J(){const ie=this.stack[this.stack.length-1];if(this.data.inReference){const fe=this.data.referenceType||"shortcut";ie.type+="Reference",ie.referenceType=fe,delete ie.url,delete ie.title}else delete ie.identifier,delete ie.label;this.data.referenceType=void 0}function K(ie){const fe=this.sliceSerialize(ie),ze=this.stack[this.stack.length-2];ze.label=O_e(fe),ze.identifier=ci(fe).toLowerCase()}function ee(){const ie=this.stack[this.stack.length-1],fe=this.resume(),ze=this.stack[this.stack.length-1];if(this.data.inReference=!0,ze.type==="link"){const Ke=ie.children;ze.children=Ke}else ze.alt=fe}function L(){const ie=this.resume(),fe=this.stack[this.stack.length-1];fe.url=ie}function ae(){const ie=this.resume(),fe=this.stack[this.stack.length-1];fe.title=ie}function ce(){this.data.inReference=void 0}function z(){this.data.referenceType="collapsed"}function ue(ie){const fe=this.resume(),ze=this.stack[this.stack.length-1];ze.label=fe,ze.identifier=ci(this.sliceSerialize(ie)).toLowerCase(),this.data.referenceType="full"}function de(ie){this.data.characterReferenceType=ie.type}function be(ie){const fe=this.sliceSerialize(ie),ze=this.data.characterReferenceType;let Ke;ze?(Ke=a4(fe,ze==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):Ke=k_(fe);const ne=this.stack[this.stack.length-1];ne.value+=Ke}function Ee(ie){const fe=this.stack.pop();fe.position.end=Qo(ie.end)}function Re(ie){S.call(this,ie);const fe=this.stack[this.stack.length-1];fe.url=this.sliceSerialize(ie)}function _e(ie){S.call(this,ie);const fe=this.stack[this.stack.length-1];fe.url="mailto:"+this.sliceSerialize(ie)}function Ae(){return{type:"blockquote",children:[]}}function je(){return{type:"code",lang:null,meta:null,value:""}}function qe(){return{type:"inlineCode",value:""}}function gt(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Et(){return{type:"emphasis",children:[]}}function ot(){return{type:"heading",depth:0,children:[]}}function xt(){return{type:"break"}}function Rt(){return{type:"html",value:""}}function It(){return{type:"image",title:null,url:"",alt:null}}function yn(){return{type:"link",title:null,url:"",children:[]}}function at(ie){return{type:"list",ordered:ie.type==="listOrdered",start:null,spread:ie._spread,children:[]}}function zt(ie){return{type:"listItem",spread:ie._spread,checked:null,children:[]}}function ln(){return{type:"paragraph",children:[]}}function Ps(){return{type:"strong",children:[]}}function qt(){return{type:"text",value:""}}function Yn(){return{type:"thematicBreak"}}}function Qo(n){return{line:n.line,column:n.column,offset:n.offset}}function b4(n,e){let t=-1;for(;++t<e.length;){const s=e[t];Array.isArray(s)?b4(n,s):z_e(n,s)}}function z_e(n,e){let t;for(t in e)if(y4.call(e,t))switch(t){case"canContainEols":{const s=e[t];s&&n[t].push(...s);break}case"transforms":{const s=e[t];s&&n[t].push(...s);break}case"enter":case"exit":{const s=e[t];s&&Object.assign(n[t],s);break}}}function f$(n,e){throw n?new Error("Cannot close `"+n.type+"` ("+rp({start:n.start,end:n.end})+"): a different token (`"+e.type+"`, "+rp({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+rp({start:e.start,end:e.end})+") is still open")}function V_e(n){const e=this;e.parser=t;function t(s){return L_e(s,{...e.data("settings"),...n,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function B_e(n,e){const t={type:"element",tagName:"blockquote",properties:{},children:n.wrap(n.all(e),!0)};return n.patch(e,t),n.applyData(e,t)}function j_e(n,e){const t={type:"element",tagName:"br",properties:{},children:[]};return n.patch(e,t),[n.applyData(e,t),{type:"text",value:`
`}]}function U_e(n,e){const t=e.value?e.value+`
`:"",s={},r=e.lang?e.lang.split(/\s+/):[];r.length>0&&(s.className=["language-"+r[0]]);let i={type:"element",tagName:"code",properties:s,children:[{type:"text",value:t}]};return e.meta&&(i.data={meta:e.meta}),n.patch(e,i),i=n.applyData(e,i),i={type:"element",tagName:"pre",properties:{},children:[i]},n.patch(e,i),i}function W_e(n,e){const t={type:"element",tagName:"del",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function G_e(n,e){const t={type:"element",tagName:"em",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function H_e(n,e){const t=typeof n.options.clobberPrefix=="string"?n.options.clobberPrefix:"user-content-",s=String(e.identifier).toUpperCase(),r=id(s.toLowerCase()),i=n.footnoteOrder.indexOf(s);let o,a=n.footnoteCounts.get(s);a===void 0?(a=0,n.footnoteOrder.push(s),o=n.footnoteOrder.length):o=i+1,a+=1,n.footnoteCounts.set(s,a);const l={type:"element",tagName:"a",properties:{href:"#"+t+"fn-"+r,id:t+"fnref-"+r+(a>1?"-"+a:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(o)}]};n.patch(e,l);const c={type:"element",tagName:"sup",properties:{},children:[l]};return n.patch(e,c),n.applyData(e,c)}function q_e(n,e){const t={type:"element",tagName:"h"+e.depth,properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function K_e(n,e){if(n.options.allowDangerousHtml){const t={type:"raw",value:e.value};return n.patch(e,t),n.applyData(e,t)}}function x4(n,e){const t=e.referenceType;let s="]";if(t==="collapsed"?s+="[]":t==="full"&&(s+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+s}];const r=n.all(e),i=r[0];i&&i.type==="text"?i.value="["+i.value:r.unshift({type:"text",value:"["});const o=r[r.length-1];return o&&o.type==="text"?o.value+=s:r.push({type:"text",value:s}),r}function X_e(n,e){const t=String(e.identifier).toUpperCase(),s=n.definitionById.get(t);if(!s)return x4(n,e);const r={src:id(s.url||""),alt:e.alt};s.title!==null&&s.title!==void 0&&(r.title=s.title);const i={type:"element",tagName:"img",properties:r,children:[]};return n.patch(e,i),n.applyData(e,i)}function Y_e(n,e){const t={src:id(e.url)};e.alt!==null&&e.alt!==void 0&&(t.alt=e.alt),e.title!==null&&e.title!==void 0&&(t.title=e.title);const s={type:"element",tagName:"img",properties:t,children:[]};return n.patch(e,s),n.applyData(e,s)}function Q_e(n,e){const t={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};n.patch(e,t);const s={type:"element",tagName:"code",properties:{},children:[t]};return n.patch(e,s),n.applyData(e,s)}function Z_e(n,e){const t=String(e.identifier).toUpperCase(),s=n.definitionById.get(t);if(!s)return x4(n,e);const r={href:id(s.url||"")};s.title!==null&&s.title!==void 0&&(r.title=s.title);const i={type:"element",tagName:"a",properties:r,children:n.all(e)};return n.patch(e,i),n.applyData(e,i)}function J_e(n,e){const t={href:id(e.url)};e.title!==null&&e.title!==void 0&&(t.title=e.title);const s={type:"element",tagName:"a",properties:t,children:n.all(e)};return n.patch(e,s),n.applyData(e,s)}function eNe(n,e,t){const s=n.all(e),r=t?tNe(t):w4(e),i={},o=[];if(typeof e.checked=="boolean"){const u=s[0];let h;u&&u.type==="element"&&u.tagName==="p"?h=u:(h={type:"element",tagName:"p",properties:{},children:[]},s.unshift(h)),h.children.length>0&&h.children.unshift({type:"text",value:" "}),h.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),i.className=["task-list-item"]}let a=-1;for(;++a<s.length;){const u=s[a];(r||a!==0||u.type!=="element"||u.tagName!=="p")&&o.push({type:"text",value:`
`}),u.type==="element"&&u.tagName==="p"&&!r?o.push(...u.children):o.push(u)}const l=s[s.length-1];l&&(r||l.type!=="element"||l.tagName!=="p")&&o.push({type:"text",value:`
`});const c={type:"element",tagName:"li",properties:i,children:o};return n.patch(e,c),n.applyData(e,c)}function tNe(n){let e=!1;if(n.type==="list"){e=n.spread||!1;const t=n.children;let s=-1;for(;!e&&++s<t.length;)e=w4(t[s])}return e}function w4(n){const e=n.spread;return e??n.children.length>1}function nNe(n,e){const t={},s=n.all(e);let r=-1;for(typeof e.start=="number"&&e.start!==1&&(t.start=e.start);++r<s.length;){const o=s[r];if(o.type==="element"&&o.tagName==="li"&&o.properties&&Array.isArray(o.properties.className)&&o.properties.className.includes("task-list-item")){t.className=["contains-task-list"];break}}const i={type:"element",tagName:e.ordered?"ol":"ul",properties:t,children:n.wrap(s,!0)};return n.patch(e,i),n.applyData(e,i)}function sNe(n,e){const t={type:"element",tagName:"p",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function rNe(n,e){const t={type:"root",children:n.wrap(n.all(e))};return n.patch(e,t),n.applyData(e,t)}function iNe(n,e){const t={type:"element",tagName:"strong",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function oNe(n,e){const t=n.all(e),s=t.shift(),r=[];if(s){const o={type:"element",tagName:"thead",properties:{},children:n.wrap([s],!0)};n.patch(e.children[0],o),r.push(o)}if(t.length>0){const o={type:"element",tagName:"tbody",properties:{},children:n.wrap(t,!0)},a=x_(e.children[1]),l=JB(e.children[e.children.length-1]);a&&l&&(o.position={start:a,end:l}),r.push(o)}const i={type:"element",tagName:"table",properties:{},children:n.wrap(r,!0)};return n.patch(e,i),n.applyData(e,i)}function aNe(n,e,t){const s=t?t.children:void 0,i=(s?s.indexOf(e):1)===0?"th":"td",o=t&&t.type==="table"?t.align:void 0,a=o?o.length:e.children.length;let l=-1;const c=[];for(;++l<a;){const h=e.children[l],d={},p=o?o[l]:void 0;p&&(d.align=p);let f={type:"element",tagName:i,properties:d,children:[]};h&&(f.children=n.all(h),n.patch(h,f),f=n.applyData(h,f)),c.push(f)}const u={type:"element",tagName:"tr",properties:{},children:n.wrap(c,!0)};return n.patch(e,u),n.applyData(e,u)}function lNe(n,e){const t={type:"element",tagName:"td",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}const m$=9,g$=32;function cNe(n){const e=String(n),t=/\r?\n|\r/g;let s=t.exec(e),r=0;const i=[];for(;s;)i.push(y$(e.slice(r,s.index),r>0,!0),s[0]),r=s.index+s[0].length,s=t.exec(e);return i.push(y$(e.slice(r),r>0,!1)),i.join("")}function y$(n,e,t){let s=0,r=n.length;if(e){let i=n.codePointAt(s);for(;i===m$||i===g$;)s++,i=n.codePointAt(s)}if(t){let i=n.codePointAt(r-1);for(;i===m$||i===g$;)r--,i=n.codePointAt(r-1)}return r>s?n.slice(s,r):""}function uNe(n,e){const t={type:"text",value:cNe(String(e.value))};return n.patch(e,t),n.applyData(e,t)}function hNe(n,e){const t={type:"element",tagName:"hr",properties:{},children:[]};return n.patch(e,t),n.applyData(e,t)}const dNe={blockquote:B_e,break:j_e,code:U_e,delete:W_e,emphasis:G_e,footnoteReference:H_e,heading:q_e,html:K_e,imageReference:X_e,image:Y_e,inlineCode:Q_e,linkReference:Z_e,link:J_e,listItem:eNe,list:nNe,paragraph:sNe,root:rNe,strong:iNe,table:oNe,tableCell:lNe,tableRow:aNe,text:uNe,thematicBreak:hNe,toml:Xg,yaml:Xg,definition:Xg,footnoteDefinition:Xg};function Xg(){}const v4=-1,z0=0,op=1,Pb=2,C_=3,E_=4,__=5,N_=6,I4=7,S4=8,b$=typeof self=="object"?self:globalThis,pNe=(n,e)=>{const t=(r,i)=>(n.set(i,r),r),s=r=>{if(n.has(r))return n.get(r);const[i,o]=e[r];switch(i){case z0:case v4:return t(o,r);case op:{const a=t([],r);for(const l of o)a.push(s(l));return a}case Pb:{const a=t({},r);for(const[l,c]of o)a[s(l)]=s(c);return a}case C_:return t(new Date(o),r);case E_:{const{source:a,flags:l}=o;return t(new RegExp(a,l),r)}case __:{const a=t(new Map,r);for(const[l,c]of o)a.set(s(l),s(c));return a}case N_:{const a=t(new Set,r);for(const l of o)a.add(s(l));return a}case I4:{const{name:a,message:l}=o;return t(new b$[a](l),r)}case S4:return t(BigInt(o),r);case"BigInt":return t(Object(BigInt(o)),r);case"ArrayBuffer":return t(new Uint8Array(o).buffer,o);case"DataView":{const{buffer:a}=new Uint8Array(o);return t(new DataView(a),o)}}return t(new b$[i](o),r)};return s},x$=n=>pNe(new Map,n)(0),Bc="",{toString:fNe}={},{keys:mNe}=Object,Dd=n=>{const e=typeof n;if(e!=="object"||!n)return[z0,e];const t=fNe.call(n).slice(8,-1);switch(t){case"Array":return[op,Bc];case"Object":return[Pb,Bc];case"Date":return[C_,Bc];case"RegExp":return[E_,Bc];case"Map":return[__,Bc];case"Set":return[N_,Bc];case"DataView":return[op,t]}return t.includes("Array")?[op,t]:t.includes("Error")?[I4,t]:[Pb,t]},Yg=([n,e])=>n===z0&&(e==="function"||e==="symbol"),gNe=(n,e,t,s)=>{const r=(o,a)=>{const l=s.push(o)-1;return t.set(a,l),l},i=o=>{if(t.has(o))return t.get(o);let[a,l]=Dd(o);switch(a){case z0:{let u=o;switch(l){case"bigint":a=S4,u=o.toString();break;case"function":case"symbol":if(n)throw new TypeError("unable to serialize "+l);u=null;break;case"undefined":return r([v4],o)}return r([a,u],o)}case op:{if(l){let d=o;return l==="DataView"?d=new Uint8Array(o.buffer):l==="ArrayBuffer"&&(d=new Uint8Array(o)),r([l,[...d]],o)}const u=[],h=r([a,u],o);for(const d of o)u.push(i(d));return h}case Pb:{if(l)switch(l){case"BigInt":return r([l,o.toString()],o);case"Boolean":case"Number":case"String":return r([l,o.valueOf()],o)}if(e&&"toJSON"in o)return i(o.toJSON());const u=[],h=r([a,u],o);for(const d of mNe(o))(n||!Yg(Dd(o[d])))&&u.push([i(d),i(o[d])]);return h}case C_:return r([a,o.toISOString()],o);case E_:{const{source:u,flags:h}=o;return r([a,{source:u,flags:h}],o)}case __:{const u=[],h=r([a,u],o);for(const[d,p]of o)(n||!(Yg(Dd(d))||Yg(Dd(p))))&&u.push([i(d),i(p)]);return h}case N_:{const u=[],h=r([a,u],o);for(const d of o)(n||!Yg(Dd(d)))&&u.push(i(d));return h}}const{message:c}=o;return r([a,{name:l,message:c}],o)};return i},w$=(n,{json:e,lossy:t}={})=>{const s=[];return gNe(!(e||t),!!e,new Map,s)(n),s},Ob=typeof structuredClone=="function"?(n,e)=>e&&("json"in e||"lossy"in e)?x$(w$(n,e)):structuredClone(n):(n,e)=>x$(w$(n,e));function yNe(n,e){const t=[{type:"text",value:"â†©"}];return e>1&&t.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),t}function bNe(n,e){return"Back to reference "+(n+1)+(e>1?"-"+e:"")}function xNe(n){const e=typeof n.options.clobberPrefix=="string"?n.options.clobberPrefix:"user-content-",t=n.options.footnoteBackContent||yNe,s=n.options.footnoteBackLabel||bNe,r=n.options.footnoteLabel||"Footnotes",i=n.options.footnoteLabelTagName||"h2",o=n.options.footnoteLabelProperties||{className:["sr-only"]},a=[];let l=-1;for(;++l<n.footnoteOrder.length;){const c=n.footnoteById.get(n.footnoteOrder[l]);if(!c)continue;const u=n.all(c),h=String(c.identifier).toUpperCase(),d=id(h.toLowerCase());let p=0;const f=[],g=n.footnoteCounts.get(h);for(;g!==void 0&&++p<=g;){f.length>0&&f.push({type:"text",value:" "});let w=typeof t=="string"?t:t(l,p);typeof w=="string"&&(w={type:"text",value:w}),f.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+d+(p>1?"-"+p:""),dataFootnoteBackref:"",ariaLabel:typeof s=="string"?s:s(l,p),className:["data-footnote-backref"]},children:Array.isArray(w)?w:[w]})}const m=u[u.length-1];if(m&&m.type==="element"&&m.tagName==="p"){const w=m.children[m.children.length-1];w&&w.type==="text"?w.value+=" ":m.children.push({type:"text",value:" "}),m.children.push(...f)}else u.push(...f);const y={type:"element",tagName:"li",properties:{id:e+"fn-"+d},children:n.wrap(u,!0)};n.patch(c,y),a.push(y)}if(a.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:i,properties:{...Ob(o),id:"footnote-label"},children:[{type:"text",value:r}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:n.wrap(a,!0)},{type:"text",value:`
`}]}}const V0=function(n){if(n==null)return SNe;if(typeof n=="function")return B0(n);if(typeof n=="object")return Array.isArray(n)?wNe(n):vNe(n);if(typeof n=="string")return INe(n);throw new Error("Expected function, string, or object as test")};function wNe(n){const e=[];let t=-1;for(;++t<n.length;)e[t]=V0(n[t]);return B0(s);function s(...r){let i=-1;for(;++i<e.length;)if(e[i].apply(this,r))return!0;return!1}}function vNe(n){const e=n;return B0(t);function t(s){const r=s;let i;for(i in n)if(r[i]!==e[i])return!1;return!0}}function INe(n){return B0(e);function e(t){return t&&t.type===n}}function B0(n){return e;function e(t,s,r){return!!(kNe(t)&&n.call(this,t,typeof s=="number"?s:void 0,r||void 0))}}function SNe(){return!0}function kNe(n){return n!==null&&typeof n=="object"&&"type"in n}const k4=[],TNe=!0,aS=!1,CNe="skip";function T4(n,e,t,s){let r;typeof e=="function"&&typeof t!="function"?(s=t,t=e):r=e;const i=V0(r),o=s?-1:1;a(n,void 0,[])();function a(l,c,u){const h=l&&typeof l=="object"?l:{};if(typeof h.type=="string"){const p=typeof h.tagName=="string"?h.tagName:typeof h.name=="string"?h.name:void 0;Object.defineProperty(d,"name",{value:"node ("+(l.type+(p?"<"+p+">":""))+")"})}return d;function d(){let p=k4,f,g,m;if((!e||i(l,c,u[u.length-1]||void 0))&&(p=ENe(t(l,u)),p[0]===aS))return p;if("children"in l&&l.children){const y=l;if(y.children&&p[0]!==CNe)for(g=(s?y.children.length:-1)+o,m=u.concat(y);g>-1&&g<y.children.length;){const w=y.children[g];if(f=a(w,g,m)(),f[0]===aS)return f;g=typeof f[1]=="number"?f[1]:g+o}}return p}}}function ENe(n){return Array.isArray(n)?n:typeof n=="number"?[TNe,n]:n==null?k4:[n]}function A_(n,e,t,s){let r,i,o;typeof e=="function"&&typeof t!="function"?(i=void 0,o=e,r=t):(i=e,o=t,r=s),T4(n,i,a,r);function a(l,c){const u=c[c.length-1],h=u?u.children.indexOf(l):void 0;return o(l,h,u)}}const lS={}.hasOwnProperty,_Ne={};function NNe(n,e){const t=e||_Ne,s=new Map,r=new Map,i=new Map,o={...dNe,...t.handlers},a={all:c,applyData:RNe,definitionById:s,footnoteById:r,footnoteCounts:i,footnoteOrder:[],handlers:o,one:l,options:t,patch:ANe,wrap:DNe};return A_(n,function(u){if(u.type==="definition"||u.type==="footnoteDefinition"){const h=u.type==="definition"?s:r,d=String(u.identifier).toUpperCase();h.has(d)||h.set(d,u)}}),a;function l(u,h){const d=u.type,p=a.handlers[d];if(lS.call(a.handlers,d)&&p)return p(a,u,h);if(a.options.passThrough&&a.options.passThrough.includes(d)){if("children"in u){const{children:g,...m}=u,y=Ob(m);return y.children=a.all(u),y}return Ob(u)}return(a.options.unknownHandler||$Ne)(a,u,h)}function c(u){const h=[];if("children"in u){const d=u.children;let p=-1;for(;++p<d.length;){const f=a.one(d[p],u);if(f){if(p&&d[p-1].type==="break"&&(!Array.isArray(f)&&f.type==="text"&&(f.value=v$(f.value)),!Array.isArray(f)&&f.type==="element")){const g=f.children[0];g&&g.type==="text"&&(g.value=v$(g.value))}Array.isArray(f)?h.push(...f):h.push(f)}}}return h}}function ANe(n,e){n.position&&(e.position=bCe(n))}function RNe(n,e){let t=e;if(n&&n.data){const s=n.data.hName,r=n.data.hChildren,i=n.data.hProperties;if(typeof s=="string")if(t.type==="element")t.tagName=s;else{const o="children"in t?t.children:[t];t={type:"element",tagName:s,properties:{},children:o}}t.type==="element"&&i&&Object.assign(t.properties,Ob(i)),"children"in t&&t.children&&r!==null&&r!==void 0&&(t.children=r)}return t}function $Ne(n,e){const t=e.data||{},s="value"in e&&!(lS.call(t,"hProperties")||lS.call(t,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:n.all(e)};return n.patch(e,s),n.applyData(e,s)}function DNe(n,e){const t=[];let s=-1;for(e&&t.push({type:"text",value:`
`});++s<n.length;)s&&t.push({type:"text",value:`
`}),t.push(n[s]);return e&&n.length>0&&t.push({type:"text",value:`
`}),t}function v$(n){let e=0,t=n.charCodeAt(e);for(;t===9||t===32;)e++,t=n.charCodeAt(e);return n.slice(e)}function I$(n,e){const t=NNe(n,e),s=t.one(n,void 0),r=xNe(t),i=Array.isArray(s)?{type:"root",children:s}:s||{type:"root",children:[]};return r&&i.children.push({type:"text",value:`
`},r),i}function PNe(n,e){return n&&"run"in n?async function(t,s){const r=I$(t,{file:s,...e});await n.run(r,s)}:function(t,s){return I$(t,{file:s,...n||e})}}function S$(n){if(n)throw n}var Cy=Object.prototype.hasOwnProperty,C4=Object.prototype.toString,k$=Object.defineProperty,T$=Object.getOwnPropertyDescriptor,C$=function(e){return typeof Array.isArray=="function"?Array.isArray(e):C4.call(e)==="[object Array]"},E$=function(e){if(!e||C4.call(e)!=="[object Object]")return!1;var t=Cy.call(e,"constructor"),s=e.constructor&&e.constructor.prototype&&Cy.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!s)return!1;var r;for(r in e);return typeof r>"u"||Cy.call(e,r)},_$=function(e,t){k$&&t.name==="__proto__"?k$(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},N$=function(e,t){if(t==="__proto__")if(Cy.call(e,t)){if(T$)return T$(e,t).value}else return;return e[t]},ONe=function n(){var e,t,s,r,i,o,a=arguments[0],l=1,c=arguments.length,u=!1;for(typeof a=="boolean"&&(u=a,a=arguments[1]||{},l=2),(a==null||typeof a!="object"&&typeof a!="function")&&(a={});l<c;++l)if(e=arguments[l],e!=null)for(t in e)s=N$(a,t),r=N$(e,t),a!==r&&(u&&r&&(E$(r)||(i=C$(r)))?(i?(i=!1,o=s&&C$(s)?s:[]):o=s&&E$(s)?s:{},_$(a,{name:t,newValue:n(u,o,r)})):typeof r<"u"&&_$(a,{name:t,newValue:r}));return a};const t1=VS(ONe);function cS(n){if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)}function FNe(){const n=[],e={run:t,use:s};return e;function t(...r){let i=-1;const o=r.pop();if(typeof o!="function")throw new TypeError("Expected function as last argument, not "+o);a(null,...r);function a(l,...c){const u=n[++i];let h=-1;if(l){o(l);return}for(;++h<r.length;)(c[h]===null||c[h]===void 0)&&(c[h]=r[h]);r=c,u?LNe(u,a)(...c):o(null,...c)}}function s(r){if(typeof r!="function")throw new TypeError("Expected `middelware` to be a function, not "+r);return n.push(r),e}}function LNe(n,e){let t;return s;function s(...o){const a=n.length>o.length;let l;a&&o.push(r);try{l=n.apply(this,o)}catch(c){const u=c;if(a&&t)throw u;return r(u)}a||(l&&l.then&&typeof l.then=="function"?l.then(i,r):l instanceof Error?r(l):i(l))}function r(o,...a){t||(t=!0,e(o,...a))}function i(o){r(null,o)}}const Ni={basename:MNe,dirname:zNe,extname:VNe,join:BNe,sep:"/"};function MNe(n,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');ug(n);let t=0,s=-1,r=n.length,i;if(e===void 0||e.length===0||e.length>n.length){for(;r--;)if(n.codePointAt(r)===47){if(i){t=r+1;break}}else s<0&&(i=!0,s=r+1);return s<0?"":n.slice(t,s)}if(e===n)return"";let o=-1,a=e.length-1;for(;r--;)if(n.codePointAt(r)===47){if(i){t=r+1;break}}else o<0&&(i=!0,o=r+1),a>-1&&(n.codePointAt(r)===e.codePointAt(a--)?a<0&&(s=r):(a=-1,s=o));return t===s?s=o:s<0&&(s=n.length),n.slice(t,s)}function zNe(n){if(ug(n),n.length===0)return".";let e=-1,t=n.length,s;for(;--t;)if(n.codePointAt(t)===47){if(s){e=t;break}}else s||(s=!0);return e<0?n.codePointAt(0)===47?"/":".":e===1&&n.codePointAt(0)===47?"//":n.slice(0,e)}function VNe(n){ug(n);let e=n.length,t=-1,s=0,r=-1,i=0,o;for(;e--;){const a=n.codePointAt(e);if(a===47){if(o){s=e+1;break}continue}t<0&&(o=!0,t=e+1),a===46?r<0?r=e:i!==1&&(i=1):r>-1&&(i=-1)}return r<0||t<0||i===0||i===1&&r===t-1&&r===s+1?"":n.slice(r,t)}function BNe(...n){let e=-1,t;for(;++e<n.length;)ug(n[e]),n[e]&&(t=t===void 0?n[e]:t+"/"+n[e]);return t===void 0?".":jNe(t)}function jNe(n){ug(n);const e=n.codePointAt(0)===47;let t=UNe(n,!e);return t.length===0&&!e&&(t="."),t.length>0&&n.codePointAt(n.length-1)===47&&(t+="/"),e?"/"+t:t}function UNe(n,e){let t="",s=0,r=-1,i=0,o=-1,a,l;for(;++o<=n.length;){if(o<n.length)a=n.codePointAt(o);else{if(a===47)break;a=47}if(a===47){if(!(r===o-1||i===1))if(r!==o-1&&i===2){if(t.length<2||s!==2||t.codePointAt(t.length-1)!==46||t.codePointAt(t.length-2)!==46){if(t.length>2){if(l=t.lastIndexOf("/"),l!==t.length-1){l<0?(t="",s=0):(t=t.slice(0,l),s=t.length-1-t.lastIndexOf("/")),r=o,i=0;continue}}else if(t.length>0){t="",s=0,r=o,i=0;continue}}e&&(t=t.length>0?t+"/..":"..",s=2)}else t.length>0?t+="/"+n.slice(r+1,o):t=n.slice(r+1,o),s=o-r-1;r=o,i=0}else a===46&&i>-1?i++:i=-1}return t}function ug(n){if(typeof n!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(n))}const WNe={cwd:GNe};function GNe(){return"/"}function uS(n){return!!(n!==null&&typeof n=="object"&&"href"in n&&n.href&&"protocol"in n&&n.protocol&&n.auth===void 0)}function HNe(n){if(typeof n=="string")n=new URL(n);else if(!uS(n)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+n+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(n.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return qNe(n)}function qNe(n){if(n.hostname!==""){const s=new TypeError('File URL host must be "localhost" or empty on darwin');throw s.code="ERR_INVALID_FILE_URL_HOST",s}const e=n.pathname;let t=-1;for(;++t<e.length;)if(e.codePointAt(t)===37&&e.codePointAt(t+1)===50){const s=e.codePointAt(t+2);if(s===70||s===102){const r=new TypeError("File URL path must not include encoded / characters");throw r.code="ERR_INVALID_FILE_URL_PATH",r}}return decodeURIComponent(e)}const n1=["history","path","basename","stem","extname","dirname"];class E4{constructor(e){let t;e?uS(e)?t={path:e}:typeof e=="string"||KNe(e)?t={value:e}:t=e:t={},this.cwd="cwd"in t?"":WNe.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let s=-1;for(;++s<n1.length;){const i=n1[s];i in t&&t[i]!==void 0&&t[i]!==null&&(this[i]=i==="history"?[...t[i]]:t[i])}let r;for(r in t)n1.includes(r)||(this[r]=t[r])}get basename(){return typeof this.path=="string"?Ni.basename(this.path):void 0}set basename(e){r1(e,"basename"),s1(e,"basename"),this.path=Ni.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?Ni.dirname(this.path):void 0}set dirname(e){A$(this.basename,"dirname"),this.path=Ni.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?Ni.extname(this.path):void 0}set extname(e){if(s1(e,"extname"),A$(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Ni.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){uS(e)&&(e=HNe(e)),r1(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?Ni.basename(this.path,this.extname):void 0}set stem(e){r1(e,"stem"),s1(e,"stem"),this.path=Ni.join(this.dirname||"",e+(this.extname||""))}fail(e,t,s){const r=this.message(e,t,s);throw r.fatal=!0,r}info(e,t,s){const r=this.message(e,t,s);return r.fatal=void 0,r}message(e,t,s){const r=new Ds(e,t,s);return this.path&&(r.name=this.path+":"+r.name,r.file=this.path),r.fatal=!1,this.messages.push(r),r}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function s1(n,e){if(n&&n.includes(Ni.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+Ni.sep+"`")}function r1(n,e){if(!n)throw new Error("`"+e+"` cannot be empty")}function A$(n,e){if(!n)throw new Error("Setting `"+e+"` requires `path` to be set too")}function KNe(n){return!!(n&&typeof n=="object"&&"byteLength"in n&&"byteOffset"in n)}const XNe=function(n){const s=this.constructor.prototype,r=s[n],i=function(){return r.apply(i,arguments)};return Object.setPrototypeOf(i,s),i},YNe={}.hasOwnProperty;class R_ extends XNe{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=FNe()}copy(){const e=new R_;let t=-1;for(;++t<this.attachers.length;){const s=this.attachers[t];e.use(...s)}return e.data(t1(!0,{},this.namespace)),e}data(e,t){return typeof e=="string"?arguments.length===2?(a1("data",this.frozen),this.namespace[e]=t,this):YNe.call(this.namespace,e)&&this.namespace[e]||void 0:e?(a1("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[t,...s]=this.attachers[this.freezeIndex];if(s[0]===!1)continue;s[0]===!0&&(s[0]=void 0);const r=t.call(e,...s);typeof r=="function"&&this.transformers.use(r)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const t=Qg(e),s=this.parser||this.Parser;return i1("parse",s),s(String(t),t)}process(e,t){const s=this;return this.freeze(),i1("process",this.parser||this.Parser),o1("process",this.compiler||this.Compiler),t?r(void 0,t):new Promise(r);function r(i,o){const a=Qg(e),l=s.parse(a);s.run(l,a,function(u,h,d){if(u||!h||!d)return c(u);const p=h,f=s.stringify(p,d);JNe(f)?d.value=f:d.result=f,c(u,d)});function c(u,h){u||!h?o(u):i?i(h):t(void 0,h)}}}processSync(e){let t=!1,s;return this.freeze(),i1("processSync",this.parser||this.Parser),o1("processSync",this.compiler||this.Compiler),this.process(e,r),$$("processSync","process",t),s;function r(i,o){t=!0,S$(i),s=o}}run(e,t,s){R$(e),this.freeze();const r=this.transformers;return!s&&typeof t=="function"&&(s=t,t=void 0),s?i(void 0,s):new Promise(i);function i(o,a){const l=Qg(t);r.run(e,l,c);function c(u,h,d){const p=h||e;u?a(u):o?o(p):s(void 0,p,d)}}}runSync(e,t){let s=!1,r;return this.run(e,t,i),$$("runSync","run",s),r;function i(o,a){S$(o),r=a,s=!0}}stringify(e,t){this.freeze();const s=Qg(t),r=this.compiler||this.Compiler;return o1("stringify",r),R$(e),r(e,s)}use(e,...t){const s=this.attachers,r=this.namespace;if(a1("use",this.frozen),e!=null)if(typeof e=="function")l(e,t);else if(typeof e=="object")Array.isArray(e)?a(e):o(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function i(c){if(typeof c=="function")l(c,[]);else if(typeof c=="object")if(Array.isArray(c)){const[u,...h]=c;l(u,h)}else o(c);else throw new TypeError("Expected usable value, not `"+c+"`")}function o(c){if(!("plugins"in c)&&!("settings"in c))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");a(c.plugins),c.settings&&(r.settings=t1(!0,r.settings,c.settings))}function a(c){let u=-1;if(c!=null)if(Array.isArray(c))for(;++u<c.length;){const h=c[u];i(h)}else throw new TypeError("Expected a list of plugins, not `"+c+"`")}function l(c,u){let h=-1,d=-1;for(;++h<s.length;)if(s[h][0]===c){d=h;break}if(d===-1)s.push([c,...u]);else if(u.length>0){let[p,...f]=u;const g=s[d][1];cS(g)&&cS(p)&&(p=t1(!0,g,p)),s[d]=[c,p,...f]}}}}const QNe=new R_().freeze();function i1(n,e){if(typeof e!="function")throw new TypeError("Cannot `"+n+"` without `parser`")}function o1(n,e){if(typeof e!="function")throw new TypeError("Cannot `"+n+"` without `compiler`")}function a1(n,e){if(e)throw new Error("Cannot call `"+n+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function R$(n){if(!cS(n)||typeof n.type!="string")throw new TypeError("Expected node, got `"+n+"`")}function $$(n,e,t){if(!t)throw new Error("`"+n+"` finished async. Use `"+e+"` instead")}function Qg(n){return ZNe(n)?n:new E4(n)}function ZNe(n){return!!(n&&typeof n=="object"&&"message"in n&&"messages"in n)}function JNe(n){return typeof n=="string"||eAe(n)}function eAe(n){return!!(n&&typeof n=="object"&&"byteLength"in n&&"byteOffset"in n)}const tAe="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",D$=[],P$={allowDangerousHtml:!0},nAe=/^(https?|ircs?|mailto|xmpp)$/i,sAe=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function rAe(n){const e=iAe(n),t=oAe(n);return aAe(e.runSync(e.parse(t),t),n)}function iAe(n){const e=n.rehypePlugins||D$,t=n.remarkPlugins||D$,s=n.remarkRehypeOptions?{...n.remarkRehypeOptions,...P$}:P$;return QNe().use(V_e).use(t).use(PNe,s).use(e)}function oAe(n){const e=n.children||"",t=new E4;return typeof e=="string"&&(t.value=e),t}function aAe(n,e){const t=e.allowedElements,s=e.allowElement,r=e.components,i=e.disallowedElements,o=e.skipHtml,a=e.unwrapDisallowed,l=e.urlTransform||lAe;for(const u of sAe)Object.hasOwn(e,u.from)&&(""+u.from+(u.to?"use `"+u.to+"` instead":"remove it")+tAe+u.id,void 0);return A_(n,c),SCe(n,{Fragment:x.Fragment,components:r,ignoreInvalidStyle:!0,jsx:x.jsx,jsxs:x.jsxs,passKeys:!0,passNode:!0});function c(u,h,d){if(u.type==="raw"&&d&&typeof h=="number")return o?d.children.splice(h,1):d.children[h]={type:"text",value:u.value},h;if(u.type==="element"){let p;for(p in Zv)if(Object.hasOwn(Zv,p)&&Object.hasOwn(u.properties,p)){const f=u.properties[p],g=Zv[p];(g===null||g.includes(u.tagName))&&(u.properties[p]=l(String(f||""),p,u))}}if(u.type==="element"){let p=t?!t.includes(u.tagName):i?i.includes(u.tagName):!1;if(!p&&s&&typeof h=="number"&&(p=!s(u,h,d)),p&&d&&typeof h=="number")return a&&u.children?d.children.splice(h,1,...u.children):d.children.splice(h,1),h}}}function lAe(n){const e=n.indexOf(":"),t=n.indexOf("?"),s=n.indexOf("#"),r=n.indexOf("/");return e===-1||r!==-1&&e>r||t!==-1&&e>t||s!==-1&&e>s||nAe.test(n.slice(0,e))?n:""}function O$(n,e){const t=String(n);if(typeof e!="string")throw new TypeError("Expected character");let s=0,r=t.indexOf(e);for(;r!==-1;)s++,r=t.indexOf(e,r+e.length);return s}function cAe(n){if(typeof n!="string")throw new TypeError("Expected a string");return n.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function uAe(n,e,t){const r=V0((t||{}).ignore||[]),i=hAe(e);let o=-1;for(;++o<i.length;)T4(n,"text",a);function a(c,u){let h=-1,d;for(;++h<u.length;){const p=u[h],f=d?d.children:void 0;if(r(p,f?f.indexOf(p):void 0,d))return;d=p}if(d)return l(c,u)}function l(c,u){const h=u[u.length-1],d=i[o][0],p=i[o][1];let f=0;const m=h.children.indexOf(c);let y=!1,w=[];d.lastIndex=0;let v=d.exec(c.value);for(;v;){const I=v.index,_={index:v.index,input:v.input,stack:[...u,c]};let N=p(...v,_);if(typeof N=="string"&&(N=N.length>0?{type:"text",value:N}:void 0),N===!1?d.lastIndex=I+1:(f!==I&&w.push({type:"text",value:c.value.slice(f,I)}),Array.isArray(N)?w.push(...N):N&&w.push(N),f=I+v[0].length,y=!0),!d.global)break;v=d.exec(c.value)}return y?(f<c.value.length&&w.push({type:"text",value:c.value.slice(f)}),h.children.splice(m,1,...w)):w=[c],m+w.length}}function hAe(n){const e=[];if(!Array.isArray(n))throw new TypeError("Expected find and replace tuple or list of tuples");const t=!n[0]||Array.isArray(n[0])?n:[n];let s=-1;for(;++s<t.length;){const r=t[s];e.push([dAe(r[0]),pAe(r[1])])}return e}function dAe(n){return typeof n=="string"?new RegExp(cAe(n),"g"):n}function pAe(n){return typeof n=="function"?n:function(){return n}}const l1="phrasing",c1=["autolink","link","image","label"];function fAe(){return{transforms:[vAe],enter:{literalAutolink:gAe,literalAutolinkEmail:u1,literalAutolinkHttp:u1,literalAutolinkWww:u1},exit:{literalAutolink:wAe,literalAutolinkEmail:xAe,literalAutolinkHttp:yAe,literalAutolinkWww:bAe}}}function mAe(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:l1,notInConstruct:c1},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:l1,notInConstruct:c1},{character:":",before:"[ps]",after:"\\/",inConstruct:l1,notInConstruct:c1}]}}function gAe(n){this.enter({type:"link",title:null,url:"",children:[]},n)}function u1(n){this.config.enter.autolinkProtocol.call(this,n)}function yAe(n){this.config.exit.autolinkProtocol.call(this,n)}function bAe(n){this.config.exit.data.call(this,n);const e=this.stack[this.stack.length-1];e.type,e.url="http://"+this.sliceSerialize(n)}function xAe(n){this.config.exit.autolinkEmail.call(this,n)}function wAe(n){this.exit(n)}function vAe(n){uAe(n,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,IAe],[new RegExp("(?<=^|\\s|\\p{P}|\\p{S})([-.\\w+]+)@([-\\w]+(?:\\.[-\\w]+)+)","gu"),SAe]],{ignore:["link","linkReference"]})}function IAe(n,e,t,s,r){let i="";if(!_4(r)||(/^w/i.test(e)&&(t=e+t,e="",i="http://"),!kAe(t)))return!1;const o=TAe(t+s);if(!o[0])return!1;const a={type:"link",title:null,url:i+e+o[0],children:[{type:"text",value:e+o[0]}]};return o[1]?[a,{type:"text",value:o[1]}]:a}function SAe(n,e,t,s){return!_4(s,!0)||/[-\d_]$/.test(t)?!1:{type:"link",title:null,url:"mailto:"+e+"@"+t,children:[{type:"text",value:e+"@"+t}]}}function kAe(n){const e=n.split(".");return!(e.length<2||e[e.length-1]&&(/_/.test(e[e.length-1])||!/[a-zA-Z\d]/.test(e[e.length-1]))||e[e.length-2]&&(/_/.test(e[e.length-2])||!/[a-zA-Z\d]/.test(e[e.length-2])))}function TAe(n){const e=/[!"&'),.:;<>?\]}]+$/.exec(n);if(!e)return[n,void 0];n=n.slice(0,e.index);let t=e[0],s=t.indexOf(")");const r=O$(n,"(");let i=O$(n,")");for(;s!==-1&&r>i;)n+=t.slice(0,s+1),t=t.slice(s+1),s=t.indexOf(")"),i++;return[n,t]}function _4(n,e){const t=n.input.charCodeAt(n.index-1);return(n.index===0||nc(t)||L0(t))&&(!e||t!==47)}N4.peek=PAe;function CAe(){this.buffer()}function EAe(n){this.enter({type:"footnoteReference",identifier:"",label:""},n)}function _Ae(){this.buffer()}function NAe(n){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},n)}function AAe(n){const e=this.resume(),t=this.stack[this.stack.length-1];t.type,t.identifier=ci(this.sliceSerialize(n)).toLowerCase(),t.label=e}function RAe(n){this.exit(n)}function $Ae(n){const e=this.resume(),t=this.stack[this.stack.length-1];t.type,t.identifier=ci(this.sliceSerialize(n)).toLowerCase(),t.label=e}function DAe(n){this.exit(n)}function PAe(){return"["}function N4(n,e,t,s){const r=t.createTracker(s);let i=r.move("[^");const o=t.enter("footnoteReference"),a=t.enter("reference");return i+=r.move(t.safe(t.associationId(n),{after:"]",before:i})),a(),o(),i+=r.move("]"),i}function OAe(){return{enter:{gfmFootnoteCallString:CAe,gfmFootnoteCall:EAe,gfmFootnoteDefinitionLabelString:_Ae,gfmFootnoteDefinition:NAe},exit:{gfmFootnoteCallString:AAe,gfmFootnoteCall:RAe,gfmFootnoteDefinitionLabelString:$Ae,gfmFootnoteDefinition:DAe}}}function FAe(n){let e=!1;return n&&n.firstLineBlank&&(e=!0),{handlers:{footnoteDefinition:t,footnoteReference:N4},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function t(s,r,i,o){const a=i.createTracker(o);let l=a.move("[^");const c=i.enter("footnoteDefinition"),u=i.enter("label");return l+=a.move(i.safe(i.associationId(s),{before:l,after:"]"})),u(),l+=a.move("]:"),s.children&&s.children.length>0&&(a.shift(4),l+=a.move((e?`
`:" ")+i.indentLines(i.containerFlow(s,a.current()),e?A4:LAe))),c(),l}}function LAe(n,e,t){return e===0?n:A4(n,e,t)}function A4(n,e,t){return(t?"":"    ")+n}const MAe=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];R4.peek=UAe;function zAe(){return{canContainEols:["delete"],enter:{strikethrough:BAe},exit:{strikethrough:jAe}}}function VAe(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:MAe}],handlers:{delete:R4}}}function BAe(n){this.enter({type:"delete",children:[]},n)}function jAe(n){this.exit(n)}function R4(n,e,t,s){const r=t.createTracker(s),i=t.enter("strikethrough");let o=r.move("~~");return o+=t.containerPhrasing(n,{...r.current(),before:o,after:"~"}),o+=r.move("~~"),i(),o}function UAe(){return"~"}function WAe(n){return n.length}function GAe(n,e){const t=e||{},s=(t.align||[]).concat(),r=t.stringLength||WAe,i=[],o=[],a=[],l=[];let c=0,u=-1;for(;++u<n.length;){const g=[],m=[];let y=-1;for(n[u].length>c&&(c=n[u].length);++y<n[u].length;){const w=HAe(n[u][y]);if(t.alignDelimiters!==!1){const v=r(w);m[y]=v,(l[y]===void 0||v>l[y])&&(l[y]=v)}g.push(w)}o[u]=g,a[u]=m}let h=-1;if(typeof s=="object"&&"length"in s)for(;++h<c;)i[h]=F$(s[h]);else{const g=F$(s);for(;++h<c;)i[h]=g}h=-1;const d=[],p=[];for(;++h<c;){const g=i[h];let m="",y="";g===99?(m=":",y=":"):g===108?m=":":g===114&&(y=":");let w=t.alignDelimiters===!1?1:Math.max(1,l[h]-m.length-y.length);const v=m+"-".repeat(w)+y;t.alignDelimiters!==!1&&(w=m.length+w+y.length,w>l[h]&&(l[h]=w),p[h]=w),d[h]=v}o.splice(1,0,d),a.splice(1,0,p),u=-1;const f=[];for(;++u<o.length;){const g=o[u],m=a[u];h=-1;const y=[];for(;++h<c;){const w=g[h]||"";let v="",I="";if(t.alignDelimiters!==!1){const _=l[h]-(m[h]||0),N=i[h];N===114?v=" ".repeat(_):N===99?_%2?(v=" ".repeat(_/2+.5),I=" ".repeat(_/2-.5)):(v=" ".repeat(_/2),I=v):I=" ".repeat(_)}t.delimiterStart!==!1&&!h&&y.push("|"),t.padding!==!1&&!(t.alignDelimiters===!1&&w==="")&&(t.delimiterStart!==!1||h)&&y.push(" "),t.alignDelimiters!==!1&&y.push(v),y.push(w),t.alignDelimiters!==!1&&y.push(I),t.padding!==!1&&y.push(" "),(t.delimiterEnd!==!1||h!==c-1)&&y.push("|")}f.push(t.delimiterEnd===!1?y.join("").replace(/ +$/,""):y.join(""))}return f.join(`
`)}function HAe(n){return n==null?"":String(n)}function F$(n){const e=typeof n=="string"?n.codePointAt(0):0;return e===67||e===99?99:e===76||e===108?108:e===82||e===114?114:0}function qAe(n,e,t,s){const r=t.enter("blockquote"),i=t.createTracker(s);i.move("> "),i.shift(2);const o=t.indentLines(t.containerFlow(n,i.current()),KAe);return r(),o}function KAe(n,e,t){return">"+(t?"":" ")+n}function XAe(n,e){return L$(n,e.inConstruct,!0)&&!L$(n,e.notInConstruct,!1)}function L$(n,e,t){if(typeof e=="string"&&(e=[e]),!e||e.length===0)return t;let s=-1;for(;++s<e.length;)if(n.includes(e[s]))return!0;return!1}function M$(n,e,t,s){let r=-1;for(;++r<t.unsafe.length;)if(t.unsafe[r].character===`
`&&XAe(t.stack,t.unsafe[r]))return/[ \t]/.test(s.before)?"":" ";return`\\
`}function YAe(n,e){const t=String(n);let s=t.indexOf(e),r=s,i=0,o=0;if(typeof e!="string")throw new TypeError("Expected substring");for(;s!==-1;)s===r?++i>o&&(o=i):i=1,r=s+e.length,s=t.indexOf(e,r);return o}function QAe(n,e){return!!(e.options.fences===!1&&n.value&&!n.lang&&/[^ \r\n]/.test(n.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(n.value))}function ZAe(n){const e=n.options.fence||"`";if(e!=="`"&&e!=="~")throw new Error("Cannot serialize code with `"+e+"` for `options.fence`, expected `` ` `` or `~`");return e}function JAe(n,e,t,s){const r=ZAe(t),i=n.value||"",o=r==="`"?"GraveAccent":"Tilde";if(QAe(n,t)){const h=t.enter("codeIndented"),d=t.indentLines(i,eRe);return h(),d}const a=t.createTracker(s),l=r.repeat(Math.max(YAe(i,r)+1,3)),c=t.enter("codeFenced");let u=a.move(l);if(n.lang){const h=t.enter(`codeFencedLang${o}`);u+=a.move(t.safe(n.lang,{before:u,after:" ",encode:["`"],...a.current()})),h()}if(n.lang&&n.meta){const h=t.enter(`codeFencedMeta${o}`);u+=a.move(" "),u+=a.move(t.safe(n.meta,{before:u,after:`
`,encode:["`"],...a.current()})),h()}return u+=a.move(`
`),i&&(u+=a.move(i+`
`)),u+=a.move(l),c(),u}function eRe(n,e,t){return(t?"":"    ")+n}function $_(n){const e=n.options.quote||'"';if(e!=='"'&&e!=="'")throw new Error("Cannot serialize title with `"+e+"` for `options.quote`, expected `\"`, or `'`");return e}function tRe(n,e,t,s){const r=$_(t),i=r==='"'?"Quote":"Apostrophe",o=t.enter("definition");let a=t.enter("label");const l=t.createTracker(s);let c=l.move("[");return c+=l.move(t.safe(t.associationId(n),{before:c,after:"]",...l.current()})),c+=l.move("]: "),a(),!n.url||/[\0- \u007F]/.test(n.url)?(a=t.enter("destinationLiteral"),c+=l.move("<"),c+=l.move(t.safe(n.url,{before:c,after:">",...l.current()})),c+=l.move(">")):(a=t.enter("destinationRaw"),c+=l.move(t.safe(n.url,{before:c,after:n.title?" ":`
`,...l.current()}))),a(),n.title&&(a=t.enter(`title${i}`),c+=l.move(" "+r),c+=l.move(t.safe(n.title,{before:c,after:r,...l.current()})),c+=l.move(r),a()),o(),c}function nRe(n){const e=n.options.emphasis||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize emphasis with `"+e+"` for `options.emphasis`, expected `*`, or `_`");return e}function tf(n){return"&#x"+n.toString(16).toUpperCase()+";"}function Fb(n,e,t){const s=Au(n),r=Au(e);return s===void 0?r===void 0?t==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:r===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:s===1?r===void 0?{inside:!1,outside:!1}:r===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:r===void 0?{inside:!1,outside:!1}:r===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}$4.peek=sRe;function $4(n,e,t,s){const r=nRe(t),i=t.enter("emphasis"),o=t.createTracker(s),a=o.move(r);let l=o.move(t.containerPhrasing(n,{after:r,before:a,...o.current()}));const c=l.charCodeAt(0),u=Fb(s.before.charCodeAt(s.before.length-1),c,r);u.inside&&(l=tf(c)+l.slice(1));const h=l.charCodeAt(l.length-1),d=Fb(s.after.charCodeAt(0),h,r);d.inside&&(l=l.slice(0,-1)+tf(h));const p=o.move(r);return i(),t.attentionEncodeSurroundingInfo={after:d.outside,before:u.outside},a+l+p}function sRe(n,e,t){return t.options.emphasis||"*"}function rRe(n,e){let t=!1;return A_(n,function(s){if("value"in s&&/\r?\n|\r/.test(s.value)||s.type==="break")return t=!0,aS}),!!((!n.depth||n.depth<3)&&S_(n)&&(e.options.setext||t))}function iRe(n,e,t,s){const r=Math.max(Math.min(6,n.depth||1),1),i=t.createTracker(s);if(rRe(n,t)){const u=t.enter("headingSetext"),h=t.enter("phrasing"),d=t.containerPhrasing(n,{...i.current(),before:`
`,after:`
`});return h(),u(),d+`
`+(r===1?"=":"-").repeat(d.length-(Math.max(d.lastIndexOf("\r"),d.lastIndexOf(`
`))+1))}const o="#".repeat(r),a=t.enter("headingAtx"),l=t.enter("phrasing");i.move(o+" ");let c=t.containerPhrasing(n,{before:"# ",after:`
`,...i.current()});return/^[\t ]/.test(c)&&(c=tf(c.charCodeAt(0))+c.slice(1)),c=c?o+" "+c:o,t.options.closeAtx&&(c+=" "+o),l(),a(),c}D4.peek=oRe;function D4(n){return n.value||""}function oRe(){return"<"}P4.peek=aRe;function P4(n,e,t,s){const r=$_(t),i=r==='"'?"Quote":"Apostrophe",o=t.enter("image");let a=t.enter("label");const l=t.createTracker(s);let c=l.move("![");return c+=l.move(t.safe(n.alt,{before:c,after:"]",...l.current()})),c+=l.move("]("),a(),!n.url&&n.title||/[\0- \u007F]/.test(n.url)?(a=t.enter("destinationLiteral"),c+=l.move("<"),c+=l.move(t.safe(n.url,{before:c,after:">",...l.current()})),c+=l.move(">")):(a=t.enter("destinationRaw"),c+=l.move(t.safe(n.url,{before:c,after:n.title?" ":")",...l.current()}))),a(),n.title&&(a=t.enter(`title${i}`),c+=l.move(" "+r),c+=l.move(t.safe(n.title,{before:c,after:r,...l.current()})),c+=l.move(r),a()),c+=l.move(")"),o(),c}function aRe(){return"!"}O4.peek=lRe;function O4(n,e,t,s){const r=n.referenceType,i=t.enter("imageReference");let o=t.enter("label");const a=t.createTracker(s);let l=a.move("![");const c=t.safe(n.alt,{before:l,after:"]",...a.current()});l+=a.move(c+"]["),o();const u=t.stack;t.stack=[],o=t.enter("reference");const h=t.safe(t.associationId(n),{before:l,after:"]",...a.current()});return o(),t.stack=u,i(),r==="full"||!c||c!==h?l+=a.move(h+"]"):r==="shortcut"?l=l.slice(0,-1):l+=a.move("]"),l}function lRe(){return"!"}F4.peek=cRe;function F4(n,e,t){let s=n.value||"",r="`",i=-1;for(;new RegExp("(^|[^`])"+r+"([^`]|$)").test(s);)r+="`";for(/[^ \r\n]/.test(s)&&(/^[ \r\n]/.test(s)&&/[ \r\n]$/.test(s)||/^`|`$/.test(s))&&(s=" "+s+" ");++i<t.unsafe.length;){const o=t.unsafe[i],a=t.compilePattern(o);let l;if(o.atBreak)for(;l=a.exec(s);){let c=l.index;s.charCodeAt(c)===10&&s.charCodeAt(c-1)===13&&c--,s=s.slice(0,c)+" "+s.slice(l.index+1)}}return r+s+r}function cRe(){return"`"}function L4(n,e){const t=S_(n);return!!(!e.options.resourceLink&&n.url&&!n.title&&n.children&&n.children.length===1&&n.children[0].type==="text"&&(t===n.url||"mailto:"+t===n.url)&&/^[a-z][a-z+.-]+:/i.test(n.url)&&!/[\0- <>\u007F]/.test(n.url))}M4.peek=uRe;function M4(n,e,t,s){const r=$_(t),i=r==='"'?"Quote":"Apostrophe",o=t.createTracker(s);let a,l;if(L4(n,t)){const u=t.stack;t.stack=[],a=t.enter("autolink");let h=o.move("<");return h+=o.move(t.containerPhrasing(n,{before:h,after:">",...o.current()})),h+=o.move(">"),a(),t.stack=u,h}a=t.enter("link"),l=t.enter("label");let c=o.move("[");return c+=o.move(t.containerPhrasing(n,{before:c,after:"](",...o.current()})),c+=o.move("]("),l(),!n.url&&n.title||/[\0- \u007F]/.test(n.url)?(l=t.enter("destinationLiteral"),c+=o.move("<"),c+=o.move(t.safe(n.url,{before:c,after:">",...o.current()})),c+=o.move(">")):(l=t.enter("destinationRaw"),c+=o.move(t.safe(n.url,{before:c,after:n.title?" ":")",...o.current()}))),l(),n.title&&(l=t.enter(`title${i}`),c+=o.move(" "+r),c+=o.move(t.safe(n.title,{before:c,after:r,...o.current()})),c+=o.move(r),l()),c+=o.move(")"),a(),c}function uRe(n,e,t){return L4(n,t)?"<":"["}z4.peek=hRe;function z4(n,e,t,s){const r=n.referenceType,i=t.enter("linkReference");let o=t.enter("label");const a=t.createTracker(s);let l=a.move("[");const c=t.containerPhrasing(n,{before:l,after:"]",...a.current()});l+=a.move(c+"]["),o();const u=t.stack;t.stack=[],o=t.enter("reference");const h=t.safe(t.associationId(n),{before:l,after:"]",...a.current()});return o(),t.stack=u,i(),r==="full"||!c||c!==h?l+=a.move(h+"]"):r==="shortcut"?l=l.slice(0,-1):l+=a.move("]"),l}function hRe(){return"["}function D_(n){const e=n.options.bullet||"*";if(e!=="*"&&e!=="+"&&e!=="-")throw new Error("Cannot serialize items with `"+e+"` for `options.bullet`, expected `*`, `+`, or `-`");return e}function dRe(n){const e=D_(n),t=n.options.bulletOther;if(!t)return e==="*"?"-":"*";if(t!=="*"&&t!=="+"&&t!=="-")throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(t===e)throw new Error("Expected `bullet` (`"+e+"`) and `bulletOther` (`"+t+"`) to be different");return t}function pRe(n){const e=n.options.bulletOrdered||".";if(e!=="."&&e!==")")throw new Error("Cannot serialize items with `"+e+"` for `options.bulletOrdered`, expected `.` or `)`");return e}function V4(n){const e=n.options.rule||"*";if(e!=="*"&&e!=="-"&&e!=="_")throw new Error("Cannot serialize rules with `"+e+"` for `options.rule`, expected `*`, `-`, or `_`");return e}function fRe(n,e,t,s){const r=t.enter("list"),i=t.bulletCurrent;let o=n.ordered?pRe(t):D_(t);const a=n.ordered?o==="."?")":".":dRe(t);let l=e&&t.bulletLastUsed?o===t.bulletLastUsed:!1;if(!n.ordered){const u=n.children?n.children[0]:void 0;if((o==="*"||o==="-")&&u&&(!u.children||!u.children[0])&&t.stack[t.stack.length-1]==="list"&&t.stack[t.stack.length-2]==="listItem"&&t.stack[t.stack.length-3]==="list"&&t.stack[t.stack.length-4]==="listItem"&&t.indexStack[t.indexStack.length-1]===0&&t.indexStack[t.indexStack.length-2]===0&&t.indexStack[t.indexStack.length-3]===0&&(l=!0),V4(t)===o&&u){let h=-1;for(;++h<n.children.length;){const d=n.children[h];if(d&&d.type==="listItem"&&d.children&&d.children[0]&&d.children[0].type==="thematicBreak"){l=!0;break}}}}l&&(o=a),t.bulletCurrent=o;const c=t.containerFlow(n,s);return t.bulletLastUsed=o,t.bulletCurrent=i,r(),c}function mRe(n){const e=n.options.listItemIndent||"one";if(e!=="tab"&&e!=="one"&&e!=="mixed")throw new Error("Cannot serialize items with `"+e+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return e}function gRe(n,e,t,s){const r=mRe(t);let i=t.bulletCurrent||D_(t);e&&e.type==="list"&&e.ordered&&(i=(typeof e.start=="number"&&e.start>-1?e.start:1)+(t.options.incrementListMarker===!1?0:e.children.indexOf(n))+i);let o=i.length+1;(r==="tab"||r==="mixed"&&(e&&e.type==="list"&&e.spread||n.spread))&&(o=Math.ceil(o/4)*4);const a=t.createTracker(s);a.move(i+" ".repeat(o-i.length)),a.shift(o);const l=t.enter("listItem"),c=t.indentLines(t.containerFlow(n,a.current()),u);return l(),c;function u(h,d,p){return d?(p?"":" ".repeat(o))+h:(p?i:i+" ".repeat(o-i.length))+h}}function yRe(n,e,t,s){const r=t.enter("paragraph"),i=t.enter("phrasing"),o=t.containerPhrasing(n,s);return i(),r(),o}const bRe=V0(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function xRe(n,e,t,s){return(n.children.some(function(o){return bRe(o)})?t.containerPhrasing:t.containerFlow).call(t,n,s)}function wRe(n){const e=n.options.strong||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize strong with `"+e+"` for `options.strong`, expected `*`, or `_`");return e}B4.peek=vRe;function B4(n,e,t,s){const r=wRe(t),i=t.enter("strong"),o=t.createTracker(s),a=o.move(r+r);let l=o.move(t.containerPhrasing(n,{after:r,before:a,...o.current()}));const c=l.charCodeAt(0),u=Fb(s.before.charCodeAt(s.before.length-1),c,r);u.inside&&(l=tf(c)+l.slice(1));const h=l.charCodeAt(l.length-1),d=Fb(s.after.charCodeAt(0),h,r);d.inside&&(l=l.slice(0,-1)+tf(h));const p=o.move(r+r);return i(),t.attentionEncodeSurroundingInfo={after:d.outside,before:u.outside},a+l+p}function vRe(n,e,t){return t.options.strong||"*"}function IRe(n,e,t,s){return t.safe(n.value,s)}function SRe(n){const e=n.options.ruleRepetition||3;if(e<3)throw new Error("Cannot serialize rules with repetition `"+e+"` for `options.ruleRepetition`, expected `3` or more");return e}function kRe(n,e,t){const s=(V4(t)+(t.options.ruleSpaces?" ":"")).repeat(SRe(t));return t.options.ruleSpaces?s.slice(0,-1):s}const j4={blockquote:qAe,break:M$,code:JAe,definition:tRe,emphasis:$4,hardBreak:M$,heading:iRe,html:D4,image:P4,imageReference:O4,inlineCode:F4,link:M4,linkReference:z4,list:fRe,listItem:gRe,paragraph:yRe,root:xRe,strong:B4,text:IRe,thematicBreak:kRe};function TRe(){return{enter:{table:CRe,tableData:z$,tableHeader:z$,tableRow:_Re},exit:{codeText:NRe,table:ERe,tableData:h1,tableHeader:h1,tableRow:h1}}}function CRe(n){const e=n._align;this.enter({type:"table",align:e.map(function(t){return t==="none"?null:t}),children:[]},n),this.data.inTable=!0}function ERe(n){this.exit(n),this.data.inTable=void 0}function _Re(n){this.enter({type:"tableRow",children:[]},n)}function h1(n){this.exit(n)}function z$(n){this.enter({type:"tableCell",children:[]},n)}function NRe(n){let e=this.resume();this.data.inTable&&(e=e.replace(/\\([\\|])/g,ARe));const t=this.stack[this.stack.length-1];t.type,t.value=e,this.exit(n)}function ARe(n,e){return e==="|"?e:n}function RRe(n){const e=n||{},t=e.tableCellPadding,s=e.tablePipeAlign,r=e.stringLength,i=t?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:d,table:o,tableCell:l,tableRow:a}};function o(p,f,g,m){return c(u(p,g,m),p.align)}function a(p,f,g,m){const y=h(p,g,m),w=c([y]);return w.slice(0,w.indexOf(`
`))}function l(p,f,g,m){const y=g.enter("tableCell"),w=g.enter("phrasing"),v=g.containerPhrasing(p,{...m,before:i,after:i});return w(),y(),v}function c(p,f){return GAe(p,{align:f,alignDelimiters:s,padding:t,stringLength:r})}function u(p,f,g){const m=p.children;let y=-1;const w=[],v=f.enter("table");for(;++y<m.length;)w[y]=h(m[y],f,g);return v(),w}function h(p,f,g){const m=p.children;let y=-1;const w=[],v=f.enter("tableRow");for(;++y<m.length;)w[y]=l(m[y],p,f,g);return v(),w}function d(p,f,g){let m=j4.inlineCode(p,f,g);return g.stack.includes("tableCell")&&(m=m.replace(/\|/g,"\\$&")),m}}function $Re(){return{exit:{taskListCheckValueChecked:V$,taskListCheckValueUnchecked:V$,paragraph:PRe}}}function DRe(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:ORe}}}function V$(n){const e=this.stack[this.stack.length-2];e.type,e.checked=n.type==="taskListCheckValueChecked"}function PRe(n){const e=this.stack[this.stack.length-2];if(e&&e.type==="listItem"&&typeof e.checked=="boolean"){const t=this.stack[this.stack.length-1];t.type;const s=t.children[0];if(s&&s.type==="text"){const r=e.children;let i=-1,o;for(;++i<r.length;){const a=r[i];if(a.type==="paragraph"){o=a;break}}o===t&&(s.value=s.value.slice(1),s.value.length===0?t.children.shift():t.position&&s.position&&typeof s.position.start.offset=="number"&&(s.position.start.column++,s.position.start.offset++,t.position.start=Object.assign({},s.position.start)))}}this.exit(n)}function ORe(n,e,t,s){const r=n.children[0],i=typeof n.checked=="boolean"&&r&&r.type==="paragraph",o="["+(n.checked?"x":" ")+"] ",a=t.createTracker(s);i&&a.move(o);let l=j4.listItem(n,e,t,{...s,...a.current()});return i&&(l=l.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,c)),l;function c(u){return u+o}}function FRe(){return[fAe(),OAe(),zAe(),TRe(),$Re()]}function LRe(n){return{extensions:[mAe(),FAe(n),VAe(),RRe(n),DRe()]}}const MRe={tokenize:WRe,partial:!0},U4={tokenize:GRe,partial:!0},W4={tokenize:HRe,partial:!0},G4={tokenize:qRe,partial:!0},zRe={tokenize:KRe,partial:!0},H4={name:"wwwAutolink",tokenize:jRe,previous:K4},q4={name:"protocolAutolink",tokenize:URe,previous:X4},jo={name:"emailAutolink",tokenize:BRe,previous:Y4},so={};function VRe(){return{text:so}}let rl=48;for(;rl<123;)so[rl]=jo,rl++,rl===58?rl=65:rl===91&&(rl=97);so[43]=jo;so[45]=jo;so[46]=jo;so[95]=jo;so[72]=[jo,q4];so[104]=[jo,q4];so[87]=[jo,H4];so[119]=[jo,H4];function BRe(n,e,t){const s=this;let r,i;return o;function o(h){return!hS(h)||!Y4.call(s,s.previous)||P_(s.events)?t(h):(n.enter("literalAutolink"),n.enter("literalAutolinkEmail"),a(h))}function a(h){return hS(h)?(n.consume(h),a):h===64?(n.consume(h),l):t(h)}function l(h){return h===46?n.check(zRe,u,c)(h):h===45||h===95||Cs(h)?(i=!0,n.consume(h),l):u(h)}function c(h){return n.consume(h),r=!0,l}function u(h){return i&&r&&Ms(s.previous)?(n.exit("literalAutolinkEmail"),n.exit("literalAutolink"),e(h)):t(h)}}function jRe(n,e,t){const s=this;return r;function r(o){return o!==87&&o!==119||!K4.call(s,s.previous)||P_(s.events)?t(o):(n.enter("literalAutolink"),n.enter("literalAutolinkWww"),n.check(MRe,n.attempt(U4,n.attempt(W4,i),t),t)(o))}function i(o){return n.exit("literalAutolinkWww"),n.exit("literalAutolink"),e(o)}}function URe(n,e,t){const s=this;let r="",i=!1;return o;function o(h){return(h===72||h===104)&&X4.call(s,s.previous)&&!P_(s.events)?(n.enter("literalAutolink"),n.enter("literalAutolinkHttp"),r+=String.fromCodePoint(h),n.consume(h),a):t(h)}function a(h){if(Ms(h)&&r.length<5)return r+=String.fromCodePoint(h),n.consume(h),a;if(h===58){const d=r.toLowerCase();if(d==="http"||d==="https")return n.consume(h),l}return t(h)}function l(h){return h===47?(n.consume(h),i?c:(i=!0,l)):t(h)}function c(h){return h===null||Db(h)||Qt(h)||nc(h)||L0(h)?t(h):n.attempt(U4,n.attempt(W4,u),t)(h)}function u(h){return n.exit("literalAutolinkHttp"),n.exit("literalAutolink"),e(h)}}function WRe(n,e,t){let s=0;return r;function r(o){return(o===87||o===119)&&s<3?(s++,n.consume(o),r):o===46&&s===3?(n.consume(o),i):t(o)}function i(o){return o===null?t(o):e(o)}}function GRe(n,e,t){let s,r,i;return o;function o(c){return c===46||c===95?n.check(G4,l,a)(c):c===null||Qt(c)||nc(c)||c!==45&&L0(c)?l(c):(i=!0,n.consume(c),o)}function a(c){return c===95?s=!0:(r=s,s=void 0),n.consume(c),o}function l(c){return r||s||!i?t(c):e(c)}}function HRe(n,e){let t=0,s=0;return r;function r(o){return o===40?(t++,n.consume(o),r):o===41&&s<t?i(o):o===33||o===34||o===38||o===39||o===41||o===42||o===44||o===46||o===58||o===59||o===60||o===63||o===93||o===95||o===126?n.check(G4,e,i)(o):o===null||Qt(o)||nc(o)?e(o):(n.consume(o),r)}function i(o){return o===41&&s++,n.consume(o),r}}function qRe(n,e,t){return s;function s(a){return a===33||a===34||a===39||a===41||a===42||a===44||a===46||a===58||a===59||a===63||a===95||a===126?(n.consume(a),s):a===38?(n.consume(a),i):a===93?(n.consume(a),r):a===60||a===null||Qt(a)||nc(a)?e(a):t(a)}function r(a){return a===null||a===40||a===91||Qt(a)||nc(a)?e(a):s(a)}function i(a){return Ms(a)?o(a):t(a)}function o(a){return a===59?(n.consume(a),s):Ms(a)?(n.consume(a),o):t(a)}}function KRe(n,e,t){return s;function s(i){return n.consume(i),r}function r(i){return Cs(i)?t(i):e(i)}}function K4(n){return n===null||n===40||n===42||n===95||n===91||n===93||n===126||Qt(n)}function X4(n){return!Ms(n)}function Y4(n){return!(n===47||hS(n))}function hS(n){return n===43||n===45||n===46||n===95||Cs(n)}function P_(n){let e=n.length,t=!1;for(;e--;){const s=n[e][1];if((s.type==="labelLink"||s.type==="labelImage")&&!s._balanced){t=!0;break}if(s._gfmAutolinkLiteralWalkedInto){t=!1;break}}return n.length>0&&!t&&(n[n.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),t}const XRe={tokenize:s2e,partial:!0};function YRe(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:e2e,continuation:{tokenize:t2e},exit:n2e}},text:{91:{name:"gfmFootnoteCall",tokenize:JRe},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:QRe,resolveTo:ZRe}}}}function QRe(n,e,t){const s=this;let r=s.events.length;const i=s.parser.gfmFootnotes||(s.parser.gfmFootnotes=[]);let o;for(;r--;){const l=s.events[r][1];if(l.type==="labelImage"){o=l;break}if(l.type==="gfmFootnoteCall"||l.type==="labelLink"||l.type==="label"||l.type==="image"||l.type==="link")break}return a;function a(l){if(!o||!o._balanced)return t(l);const c=ci(s.sliceSerialize({start:o.end,end:s.now()}));return c.codePointAt(0)!==94||!i.includes(c.slice(1))?t(l):(n.enter("gfmFootnoteCallLabelMarker"),n.consume(l),n.exit("gfmFootnoteCallLabelMarker"),e(l))}}function ZRe(n,e){let t=n.length;for(;t--;)if(n[t][1].type==="labelImage"&&n[t][0]==="enter"){n[t][1];break}n[t+1][1].type="data",n[t+3][1].type="gfmFootnoteCallLabelMarker";const s={type:"gfmFootnoteCall",start:Object.assign({},n[t+3][1].start),end:Object.assign({},n[n.length-1][1].end)},r={type:"gfmFootnoteCallMarker",start:Object.assign({},n[t+3][1].end),end:Object.assign({},n[t+3][1].end)};r.end.column++,r.end.offset++,r.end._bufferIndex++;const i={type:"gfmFootnoteCallString",start:Object.assign({},r.end),end:Object.assign({},n[n.length-1][1].start)},o={type:"chunkString",contentType:"string",start:Object.assign({},i.start),end:Object.assign({},i.end)},a=[n[t+1],n[t+2],["enter",s,e],n[t+3],n[t+4],["enter",r,e],["exit",r,e],["enter",i,e],["enter",o,e],["exit",o,e],["exit",i,e],n[n.length-2],n[n.length-1],["exit",s,e]];return n.splice(t,n.length-t+1,...a),n}function JRe(n,e,t){const s=this,r=s.parser.gfmFootnotes||(s.parser.gfmFootnotes=[]);let i=0,o;return a;function a(h){return n.enter("gfmFootnoteCall"),n.enter("gfmFootnoteCallLabelMarker"),n.consume(h),n.exit("gfmFootnoteCallLabelMarker"),l}function l(h){return h!==94?t(h):(n.enter("gfmFootnoteCallMarker"),n.consume(h),n.exit("gfmFootnoteCallMarker"),n.enter("gfmFootnoteCallString"),n.enter("chunkString").contentType="string",c)}function c(h){if(i>999||h===93&&!o||h===null||h===91||Qt(h))return t(h);if(h===93){n.exit("chunkString");const d=n.exit("gfmFootnoteCallString");return r.includes(ci(s.sliceSerialize(d)))?(n.enter("gfmFootnoteCallLabelMarker"),n.consume(h),n.exit("gfmFootnoteCallLabelMarker"),n.exit("gfmFootnoteCall"),e):t(h)}return Qt(h)||(o=!0),i++,n.consume(h),h===92?u:c}function u(h){return h===91||h===92||h===93?(n.consume(h),i++,c):c(h)}}function e2e(n,e,t){const s=this,r=s.parser.gfmFootnotes||(s.parser.gfmFootnotes=[]);let i,o=0,a;return l;function l(f){return n.enter("gfmFootnoteDefinition")._container=!0,n.enter("gfmFootnoteDefinitionLabel"),n.enter("gfmFootnoteDefinitionLabelMarker"),n.consume(f),n.exit("gfmFootnoteDefinitionLabelMarker"),c}function c(f){return f===94?(n.enter("gfmFootnoteDefinitionMarker"),n.consume(f),n.exit("gfmFootnoteDefinitionMarker"),n.enter("gfmFootnoteDefinitionLabelString"),n.enter("chunkString").contentType="string",u):t(f)}function u(f){if(o>999||f===93&&!a||f===null||f===91||Qt(f))return t(f);if(f===93){n.exit("chunkString");const g=n.exit("gfmFootnoteDefinitionLabelString");return i=ci(s.sliceSerialize(g)),n.enter("gfmFootnoteDefinitionLabelMarker"),n.consume(f),n.exit("gfmFootnoteDefinitionLabelMarker"),n.exit("gfmFootnoteDefinitionLabel"),d}return Qt(f)||(a=!0),o++,n.consume(f),f===92?h:u}function h(f){return f===91||f===92||f===93?(n.consume(f),o++,u):u(f)}function d(f){return f===58?(n.enter("definitionMarker"),n.consume(f),n.exit("definitionMarker"),r.includes(i)||r.push(i),Ot(n,p,"gfmFootnoteDefinitionWhitespace")):t(f)}function p(f){return e(f)}}function t2e(n,e,t){return n.check(cg,e,n.attempt(XRe,e,t))}function n2e(n){n.exit("gfmFootnoteDefinition")}function s2e(n,e,t){const s=this;return Ot(n,r,"gfmFootnoteDefinitionIndent",4+1);function r(i){const o=s.events[s.events.length-1];return o&&o[1].type==="gfmFootnoteDefinitionIndent"&&o[2].sliceSerialize(o[1],!0).length===4?e(i):t(i)}}function r2e(n){let t=(n||{}).singleTilde;const s={name:"strikethrough",tokenize:i,resolveAll:r};return t==null&&(t=!0),{text:{126:s},insideSpan:{null:[s]},attentionMarkers:{null:[126]}};function r(o,a){let l=-1;for(;++l<o.length;)if(o[l][0]==="enter"&&o[l][1].type==="strikethroughSequenceTemporary"&&o[l][1]._close){let c=l;for(;c--;)if(o[c][0]==="exit"&&o[c][1].type==="strikethroughSequenceTemporary"&&o[c][1]._open&&o[l][1].end.offset-o[l][1].start.offset===o[c][1].end.offset-o[c][1].start.offset){o[l][1].type="strikethroughSequence",o[c][1].type="strikethroughSequence";const u={type:"strikethrough",start:Object.assign({},o[c][1].start),end:Object.assign({},o[l][1].end)},h={type:"strikethroughText",start:Object.assign({},o[c][1].end),end:Object.assign({},o[l][1].start)},d=[["enter",u,a],["enter",o[c][1],a],["exit",o[c][1],a],["enter",h,a]],p=a.parser.constructs.insideSpan.null;p&&kr(d,d.length,0,M0(p,o.slice(c+1,l),a)),kr(d,d.length,0,[["exit",h,a],["enter",o[l][1],a],["exit",o[l][1],a],["exit",u,a]]),kr(o,c-1,l-c+3,d),l=c+d.length-2;break}}for(l=-1;++l<o.length;)o[l][1].type==="strikethroughSequenceTemporary"&&(o[l][1].type="data");return o}function i(o,a,l){const c=this.previous,u=this.events;let h=0;return d;function d(f){return c===126&&u[u.length-1][1].type!=="characterEscape"?l(f):(o.enter("strikethroughSequenceTemporary"),p(f))}function p(f){const g=Au(c);if(f===126)return h>1?l(f):(o.consume(f),h++,p);if(h<2&&!t)return l(f);const m=o.exit("strikethroughSequenceTemporary"),y=Au(f);return m._open=!y||y===2&&!!g,m._close=!g||g===2&&!!y,a(f)}}}class i2e{constructor(){this.map=[]}add(e,t,s){o2e(this,e,t,s)}consume(e){if(this.map.sort(function(i,o){return i[0]-o[0]}),this.map.length===0)return;let t=this.map.length;const s=[];for(;t>0;)t-=1,s.push(e.slice(this.map[t][0]+this.map[t][1]),this.map[t][2]),e.length=this.map[t][0];s.push(e.slice()),e.length=0;let r=s.pop();for(;r;){for(const i of r)e.push(i);r=s.pop()}this.map.length=0}}function o2e(n,e,t,s){let r=0;if(!(t===0&&s.length===0)){for(;r<n.map.length;){if(n.map[r][0]===e){n.map[r][1]+=t,n.map[r][2].push(...s);return}r+=1}n.map.push([e,t,s])}}function a2e(n,e){let t=!1;const s=[];for(;e<n.length;){const r=n[e];if(t){if(r[0]==="enter")r[1].type==="tableContent"&&s.push(n[e+1][1].type==="tableDelimiterMarker"?"left":"none");else if(r[1].type==="tableContent"){if(n[e-1][1].type==="tableDelimiterMarker"){const i=s.length-1;s[i]=s[i]==="left"?"center":"right"}}else if(r[1].type==="tableDelimiterRow")break}else r[0]==="enter"&&r[1].type==="tableDelimiterRow"&&(t=!0);e+=1}return s}function l2e(){return{flow:{null:{name:"table",tokenize:c2e,resolveAll:u2e}}}}function c2e(n,e,t){const s=this;let r=0,i=0,o;return a;function a(S){let A=s.events.length-1;for(;A>-1;){const V=s.events[A][1].type;if(V==="lineEnding"||V==="linePrefix")A--;else break}const P=A>-1?s.events[A][1].type:null,D=P==="tableHead"||P==="tableRow"?N:l;return D===N&&s.parser.lazy[s.now().line]?t(S):D(S)}function l(S){return n.enter("tableHead"),n.enter("tableRow"),c(S)}function c(S){return S===124||(o=!0,i+=1),u(S)}function u(S){return S===null?t(S):Ge(S)?i>1?(i=0,s.interrupt=!0,n.exit("tableRow"),n.enter("lineEnding"),n.consume(S),n.exit("lineEnding"),p):t(S):Tt(S)?Ot(n,u,"whitespace")(S):(i+=1,o&&(o=!1,r+=1),S===124?(n.enter("tableCellDivider"),n.consume(S),n.exit("tableCellDivider"),o=!0,u):(n.enter("data"),h(S)))}function h(S){return S===null||S===124||Qt(S)?(n.exit("data"),u(S)):(n.consume(S),S===92?d:h)}function d(S){return S===92||S===124?(n.consume(S),h):h(S)}function p(S){return s.interrupt=!1,s.parser.lazy[s.now().line]?t(S):(n.enter("tableDelimiterRow"),o=!1,Tt(S)?Ot(n,f,"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(S):f(S))}function f(S){return S===45||S===58?m(S):S===124?(o=!0,n.enter("tableCellDivider"),n.consume(S),n.exit("tableCellDivider"),g):_(S)}function g(S){return Tt(S)?Ot(n,m,"whitespace")(S):m(S)}function m(S){return S===58?(i+=1,o=!0,n.enter("tableDelimiterMarker"),n.consume(S),n.exit("tableDelimiterMarker"),y):S===45?(i+=1,y(S)):S===null||Ge(S)?I(S):_(S)}function y(S){return S===45?(n.enter("tableDelimiterFiller"),w(S)):_(S)}function w(S){return S===45?(n.consume(S),w):S===58?(o=!0,n.exit("tableDelimiterFiller"),n.enter("tableDelimiterMarker"),n.consume(S),n.exit("tableDelimiterMarker"),v):(n.exit("tableDelimiterFiller"),v(S))}function v(S){return Tt(S)?Ot(n,I,"whitespace")(S):I(S)}function I(S){return S===124?f(S):S===null||Ge(S)?!o||r!==i?_(S):(n.exit("tableDelimiterRow"),n.exit("tableHead"),e(S)):_(S)}function _(S){return t(S)}function N(S){return n.enter("tableRow"),T(S)}function T(S){return S===124?(n.enter("tableCellDivider"),n.consume(S),n.exit("tableCellDivider"),T):S===null||Ge(S)?(n.exit("tableRow"),e(S)):Tt(S)?Ot(n,T,"whitespace")(S):(n.enter("data"),E(S))}function E(S){return S===null||S===124||Qt(S)?(n.exit("data"),T(S)):(n.consume(S),S===92?k:E)}function k(S){return S===92||S===124?(n.consume(S),E):E(S)}}function u2e(n,e){let t=-1,s=!0,r=0,i=[0,0,0,0],o=[0,0,0,0],a=!1,l=0,c,u,h;const d=new i2e;for(;++t<n.length;){const p=n[t],f=p[1];p[0]==="enter"?f.type==="tableHead"?(a=!1,l!==0&&(B$(d,e,l,c,u),u=void 0,l=0),c={type:"table",start:Object.assign({},f.start),end:Object.assign({},f.end)},d.add(t,0,[["enter",c,e]])):f.type==="tableRow"||f.type==="tableDelimiterRow"?(s=!0,h=void 0,i=[0,0,0,0],o=[0,t+1,0,0],a&&(a=!1,u={type:"tableBody",start:Object.assign({},f.start),end:Object.assign({},f.end)},d.add(t,0,[["enter",u,e]])),r=f.type==="tableDelimiterRow"?2:u?3:1):r&&(f.type==="data"||f.type==="tableDelimiterMarker"||f.type==="tableDelimiterFiller")?(s=!1,o[2]===0&&(i[1]!==0&&(o[0]=o[1],h=Zg(d,e,i,r,void 0,h),i=[0,0,0,0]),o[2]=t)):f.type==="tableCellDivider"&&(s?s=!1:(i[1]!==0&&(o[0]=o[1],h=Zg(d,e,i,r,void 0,h)),i=o,o=[i[1],t,0,0])):f.type==="tableHead"?(a=!0,l=t):f.type==="tableRow"||f.type==="tableDelimiterRow"?(l=t,i[1]!==0?(o[0]=o[1],h=Zg(d,e,i,r,t,h)):o[1]!==0&&(h=Zg(d,e,o,r,t,h)),r=0):r&&(f.type==="data"||f.type==="tableDelimiterMarker"||f.type==="tableDelimiterFiller")&&(o[3]=t)}for(l!==0&&B$(d,e,l,c,u),d.consume(e.events),t=-1;++t<e.events.length;){const p=e.events[t];p[0]==="enter"&&p[1].type==="table"&&(p[1]._align=a2e(e.events,t))}return n}function Zg(n,e,t,s,r,i){const o=s===1?"tableHeader":s===2?"tableDelimiter":"tableData",a="tableContent";t[0]!==0&&(i.end=Object.assign({},Gc(e.events,t[0])),n.add(t[0],0,[["exit",i,e]]));const l=Gc(e.events,t[1]);if(i={type:o,start:Object.assign({},l),end:Object.assign({},l)},n.add(t[1],0,[["enter",i,e]]),t[2]!==0){const c=Gc(e.events,t[2]),u=Gc(e.events,t[3]),h={type:a,start:Object.assign({},c),end:Object.assign({},u)};if(n.add(t[2],0,[["enter",h,e]]),s!==2){const d=e.events[t[2]],p=e.events[t[3]];if(d[1].end=Object.assign({},p[1].end),d[1].type="chunkText",d[1].contentType="text",t[3]>t[2]+1){const f=t[2]+1,g=t[3]-t[2]-1;n.add(f,g,[])}}n.add(t[3]+1,0,[["exit",h,e]])}return r!==void 0&&(i.end=Object.assign({},Gc(e.events,r)),n.add(r,0,[["exit",i,e]]),i=void 0),i}function B$(n,e,t,s,r){const i=[],o=Gc(e.events,t);r&&(r.end=Object.assign({},o),i.push(["exit",r,e])),s.end=Object.assign({},o),i.push(["exit",s,e]),n.add(t+1,0,i)}function Gc(n,e){const t=n[e],s=t[0]==="enter"?"start":"end";return t[1][s]}const h2e={name:"tasklistCheck",tokenize:p2e};function d2e(){return{text:{91:h2e}}}function p2e(n,e,t){const s=this;return r;function r(l){return s.previous!==null||!s._gfmTasklistFirstContentOfListItem?t(l):(n.enter("taskListCheck"),n.enter("taskListCheckMarker"),n.consume(l),n.exit("taskListCheckMarker"),i)}function i(l){return Qt(l)?(n.enter("taskListCheckValueUnchecked"),n.consume(l),n.exit("taskListCheckValueUnchecked"),o):l===88||l===120?(n.enter("taskListCheckValueChecked"),n.consume(l),n.exit("taskListCheckValueChecked"),o):t(l)}function o(l){return l===93?(n.enter("taskListCheckMarker"),n.consume(l),n.exit("taskListCheckMarker"),n.exit("taskListCheck"),a):t(l)}function a(l){return Ge(l)?e(l):Tt(l)?n.check({tokenize:f2e},e,t)(l):t(l)}}function f2e(n,e,t){return Ot(n,s,"whitespace");function s(r){return r===null?t(r):e(r)}}function m2e(n){return o4([VRe(),YRe(),r2e(n),l2e(),d2e()])}const g2e={};function y2e(n){const e=this,t=n||g2e,s=e.data(),r=s.micromarkExtensions||(s.micromarkExtensions=[]),i=s.fromMarkdownExtensions||(s.fromMarkdownExtensions=[]),o=s.toMarkdownExtensions||(s.toMarkdownExtensions=[]);r.push(m2e(t)),i.push(FRe()),o.push(LRe(t))}const b2e={}.VITE_AI_GATEWAY_URL||"https://my-ai-brain.workers.dev",x2e={}.VITE_AI_ACCESS_SECRET||"my-secret-password";class w2e{async chat(e,t){try{const s={messages:e,system:t||"You are a helpful AI assistant specialized in word games and coding.",temperature:.7},r=await fetch(`${b2e}/v1/chat`,{method:"POST",headers:{"Content-Type":"application/json","x-access-secret":x2e},body:JSON.stringify(s)});if(!r.ok)throw new Error(`Brain connection failed: ${r.statusText}`);const i=await r.json();return{content:i.content,model:i.model}}catch(s){return console.error("âŒ AI Brain Error:",s),{content:"",model:"error",error:s.message||"Unknown error occurred"}}}async*chatStreamSimulated(e,t){const s=await this.chat(e,t);if(s.error){yield`Error: ${s.error}`;return}const r=s.content.split(" ");for(const i of r)yield i+" ",await new Promise(o=>setTimeout(o,Math.random()*30+10))}}const v2e=new w2e,I2e=()=>{};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q4=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},S2e=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const r=n[t++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=n[t++];e[s++]=String.fromCharCode((r&31)<<6|i&63)}else if(r>239&&r<365){const i=n[t++],o=n[t++],a=n[t++],l=((r&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[s++]=String.fromCharCode((r&15)<<12|(i&63)<<6|o&63)}}return e.join("")},Z4={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<n.length;r+=3){const i=n[r],o=r+1<n.length,a=o?n[r+1]:0,l=r+2<n.length,c=l?n[r+2]:0,u=i>>2,h=(i&3)<<4|a>>4;let d=(a&15)<<2|c>>6,p=c&63;l||(p=64,o||(d=64)),s.push(t[u],t[h],t[d],t[p])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Q4(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):S2e(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<n.length;){const i=t[n.charAt(r++)],a=r<n.length?t[n.charAt(r)]:0;++r;const c=r<n.length?t[n.charAt(r)]:64;++r;const h=r<n.length?t[n.charAt(r)]:64;if(++r,i==null||a==null||c==null||h==null)throw new k2e;const d=i<<2|a>>4;if(s.push(d),c!==64){const p=a<<4&240|c>>2;if(s.push(p),h!==64){const f=c<<6&192|h;s.push(f)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class k2e extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const T2e=function(n){const e=Q4(n);return Z4.encodeByteArray(e,!0)},Lb=function(n){return T2e(n).replace(/\./g,"")},J4=function(n){try{return Z4.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C2e(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E2e=()=>C2e().__FIREBASE_DEFAULTS__,_2e=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},N2e=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&J4(n[1]);return e&&JSON.parse(e)},j0=()=>{try{return I2e()||E2e()||_2e()||N2e()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},ej=n=>{var e,t;return(t=(e=j0())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},A2e=n=>{const e=ej(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},tj=()=>{var n;return(n=j0())==null?void 0:n.config},nj=n=>{var e;return(e=j0())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R2e{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function od(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function sj(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $2e(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",r=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n},a="";return[Lb(JSON.stringify(t)),Lb(JSON.stringify(o)),a].join(".")}const ap={};function D2e(){const n={prod:[],emulator:[]};for(const e of Object.keys(ap))ap[e]?n.emulator.push(e):n.prod.push(e);return n}function P2e(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let j$=!1;function rj(n,e){if(typeof window>"u"||typeof document>"u"||!od(window.location.host)||ap[n]===e||ap[n]||j$)return;ap[n]=e;function t(d){return`__firebase__banner__${d}`}const s="__firebase__banner",i=D2e().prod.length>0;function o(){const d=document.getElementById(s);d&&d.remove()}function a(d){d.style.display="flex",d.style.background="#7faaf0",d.style.position="fixed",d.style.bottom="5px",d.style.left="5px",d.style.padding=".5em",d.style.borderRadius="5px",d.style.alignItems="center"}function l(d,p){d.setAttribute("width","24"),d.setAttribute("id",p),d.setAttribute("height","24"),d.setAttribute("viewBox","0 0 24 24"),d.setAttribute("fill","none"),d.style.marginLeft="-6px"}function c(){const d=document.createElement("span");return d.style.cursor="pointer",d.style.marginLeft="16px",d.style.fontSize="24px",d.innerHTML=" &times;",d.onclick=()=>{j$=!0,o()},d}function u(d,p){d.setAttribute("id",p),d.innerText="Learn more",d.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",d.setAttribute("target","__blank"),d.style.paddingLeft="5px",d.style.textDecoration="underline"}function h(){const d=P2e(s),p=t("text"),f=document.getElementById(p)||document.createElement("span"),g=t("learnmore"),m=document.getElementById(g)||document.createElement("a"),y=t("preprendIcon"),w=document.getElementById(y)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(d.created){const v=d.element;a(v),u(m,g);const I=c();l(w,y),v.append(w,f,m,I),document.body.appendChild(v)}i?(f.innerText="Preview backend disconnected.",w.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(w.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,f.innerText="Preview backend running in this workspace."),f.setAttribute("id",p)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ns(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function O2e(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ns())}function F2e(){var e;const n=(e=j0())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function L2e(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function O_(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function M2e(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function z2e(){const n=Ns();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function V2e(){return!F2e()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function F_(){try{return typeof indexedDB=="object"}catch{return!1}}function L_(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var i;e(((i=r.error)==null?void 0:i.message)||"")}}catch(t){e(t)}})}function ij(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B2e="FirebaseError";class ki extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=B2e,Object.setPrototypeOf(this,ki.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Cc.prototype.create)}}class Cc{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],o=i?j2e(i,s):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new ki(r,a,s)}}function j2e(n,e){return n.replace(U2e,(t,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const U2e=/\{\$([^}]+)}/g;function W2e(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function $a(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const r of t){if(!s.includes(r))return!1;const i=n[r],o=e[r];if(U$(i)&&U$(o)){if(!$a(i,o))return!1}else if(i!==o)return!1}for(const r of s)if(!t.includes(r))return!1;return!0}function U$(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hg(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function Xd(n){const e={};return n.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[r,i]=s.split("=");e[decodeURIComponent(r)]=decodeURIComponent(i)}}),e}function Yd(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function G2e(n,e){const t=new H2e(n,e);return t.subscribe.bind(t)}class H2e{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let r;if(e===void 0&&t===void 0&&s===void 0)throw new Error("Missing Observer.");q2e(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:s},r.next===void 0&&(r.next=d1),r.error===void 0&&(r.error=d1),r.complete===void 0&&(r.complete=d1);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function q2e(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function d1(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K2e=1e3,X2e=2,Y2e=4*60*60*1e3,Q2e=.5;function W$(n,e=K2e,t=X2e){const s=e*Math.pow(t,n),r=Math.round(Q2e*s*(Math.random()-.5)*2);return Math.min(Y2e,s+r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ms(n){return n&&n._delegate?n._delegate:n}class bi{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ll="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z2e{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new R2e;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(e$e(e))try{this.getOrInitializeService({instanceIdentifier:ll})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:r});s.resolve(i)}catch{}}}}clearInstance(e=ll){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ll){return this.instances.has(e)}getOptions(e=ll){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);s===a&&o.resolve(r)}return r}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(s)??new Set;r.add(e),this.onInitCallbacks.set(s,r);const i=this.instances.get(s);return i&&e(i,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const r of s)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:J2e(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=ll){return this.component?this.component.multipleInstances?e:ll:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function J2e(n){return n===ll?void 0:n}function e$e(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t$e{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Z2e(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _t;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(_t||(_t={}));const n$e={debug:_t.DEBUG,verbose:_t.VERBOSE,info:_t.INFO,warn:_t.WARN,error:_t.ERROR,silent:_t.SILENT},s$e=_t.INFO,r$e={[_t.DEBUG]:"log",[_t.VERBOSE]:"log",[_t.INFO]:"info",[_t.WARN]:"warn",[_t.ERROR]:"error"},i$e=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),r=r$e[e];if(r)console[r](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class U0{constructor(e){this.name=e,this._logLevel=s$e,this._logHandler=i$e,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in _t))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?n$e[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,_t.DEBUG,...e),this._logHandler(this,_t.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,_t.VERBOSE,...e),this._logHandler(this,_t.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,_t.INFO,...e),this._logHandler(this,_t.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,_t.WARN,...e),this._logHandler(this,_t.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,_t.ERROR,...e),this._logHandler(this,_t.ERROR,...e)}}const o$e=(n,e)=>e.some(t=>n instanceof t);let G$,H$;function a$e(){return G$||(G$=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function l$e(){return H$||(H$=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const oj=new WeakMap,dS=new WeakMap,aj=new WeakMap,p1=new WeakMap,M_=new WeakMap;function c$e(n){const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(ya(n.result)),r()},o=()=>{s(n.error),r()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&oj.set(t,n)}).catch(()=>{}),M_.set(e,n),e}function u$e(n){if(dS.has(n))return;const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});dS.set(n,e)}let pS={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return dS.get(n);if(e==="objectStoreNames")return n.objectStoreNames||aj.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ya(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function h$e(n){pS=n(pS)}function d$e(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(f1(this),e,...t);return aj.set(s,e.sort?e.sort():[e]),ya(s)}:l$e().includes(n)?function(...e){return n.apply(f1(this),e),ya(oj.get(this))}:function(...e){return ya(n.apply(f1(this),e))}}function p$e(n){return typeof n=="function"?d$e(n):(n instanceof IDBTransaction&&u$e(n),o$e(n,a$e())?new Proxy(n,pS):n)}function ya(n){if(n instanceof IDBRequest)return c$e(n);if(p1.has(n))return p1.get(n);const e=p$e(n);return e!==n&&(p1.set(n,e),M_.set(e,n)),e}const f1=n=>M_.get(n);function lj(n,e,{blocked:t,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(n,e),a=ya(o);return s&&o.addEventListener("upgradeneeded",l=>{s(ya(o.result),l.oldVersion,l.newVersion,ya(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),r&&l.addEventListener("versionchange",c=>r(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const f$e=["get","getKey","getAll","getAllKeys","count"],m$e=["put","add","delete","clear"],m1=new Map;function q$(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(m1.get(e))return m1.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,r=m$e.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(r||f$e.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,r?"readwrite":"readonly");let c=l.store;return s&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),r&&l.done]))[0]};return m1.set(e,i),i}h$e(n=>({...n,get:(e,t,s)=>q$(e,t)||n.get(e,t,s),has:(e,t)=>!!q$(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g$e{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(y$e(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function y$e(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const fS="@firebase/app",K$="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _o=new U0("@firebase/app"),b$e="@firebase/app-compat",x$e="@firebase/analytics-compat",w$e="@firebase/analytics",v$e="@firebase/app-check-compat",I$e="@firebase/app-check",S$e="@firebase/auth",k$e="@firebase/auth-compat",T$e="@firebase/database",C$e="@firebase/data-connect",E$e="@firebase/database-compat",_$e="@firebase/functions",N$e="@firebase/functions-compat",A$e="@firebase/installations",R$e="@firebase/installations-compat",$$e="@firebase/messaging",D$e="@firebase/messaging-compat",P$e="@firebase/performance",O$e="@firebase/performance-compat",F$e="@firebase/remote-config",L$e="@firebase/remote-config-compat",M$e="@firebase/storage",z$e="@firebase/storage-compat",V$e="@firebase/firestore",B$e="@firebase/ai",j$e="@firebase/firestore-compat",U$e="firebase",W$e="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mS="[DEFAULT]",G$e={[fS]:"fire-core",[b$e]:"fire-core-compat",[w$e]:"fire-analytics",[x$e]:"fire-analytics-compat",[I$e]:"fire-app-check",[v$e]:"fire-app-check-compat",[S$e]:"fire-auth",[k$e]:"fire-auth-compat",[T$e]:"fire-rtdb",[C$e]:"fire-data-connect",[E$e]:"fire-rtdb-compat",[_$e]:"fire-fn",[N$e]:"fire-fn-compat",[A$e]:"fire-iid",[R$e]:"fire-iid-compat",[$$e]:"fire-fcm",[D$e]:"fire-fcm-compat",[P$e]:"fire-perf",[O$e]:"fire-perf-compat",[F$e]:"fire-rc",[L$e]:"fire-rc-compat",[M$e]:"fire-gcs",[z$e]:"fire-gcs-compat",[V$e]:"fire-fst",[j$e]:"fire-fst-compat",[B$e]:"fire-vertex","fire-js":"fire-js",[U$e]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mb=new Map,H$e=new Map,gS=new Map;function X$(n,e){try{n.container.addComponent(e)}catch(t){_o.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Zi(n){const e=n.name;if(gS.has(e))return _o.debug(`There were multiple attempts to register component ${e}.`),!1;gS.set(e,n);for(const t of Mb.values())X$(t,n);for(const t of H$e.values())X$(t,n);return!0}function Ec(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function zs(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q$e={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ba=new Cc("app","Firebase",q$e);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K$e{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new bi("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ba.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ad=W$e;function cj(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:mS,automaticDataCollectionEnabled:!0,...e},r=s.name;if(typeof r!="string"||!r)throw ba.create("bad-app-name",{appName:String(r)});if(t||(t=tj()),!t)throw ba.create("no-options");const i=Mb.get(r);if(i){if($a(t,i.options)&&$a(s,i.config))return i;throw ba.create("duplicate-app",{appName:r})}const o=new t$e(r);for(const l of gS.values())o.addComponent(l);const a=new K$e(t,s,o);return Mb.set(r,a),a}function z_(n=mS){const e=Mb.get(n);if(!e&&n===mS&&tj())return cj();if(!e)throw ba.create("no-app",{appName:n});return e}function jr(n,e,t){let s=G$e[n]??n;t&&(s+=`-${t}`);const r=s.match(/\s|\//),i=e.match(/\s|\//);if(r||i){const o=[`Unable to register library "${s}" with version "${e}":`];r&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),_o.warn(o.join(" "));return}Zi(new bi(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X$e="firebase-heartbeat-database",Y$e=1,nf="firebase-heartbeat-store";let g1=null;function uj(){return g1||(g1=lj(X$e,Y$e,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(nf)}catch(t){console.warn(t)}}}}).catch(n=>{throw ba.create("idb-open",{originalErrorMessage:n.message})})),g1}async function Q$e(n){try{const t=(await uj()).transaction(nf),s=await t.objectStore(nf).get(hj(n));return await t.done,s}catch(e){if(e instanceof ki)_o.warn(e.message);else{const t=ba.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});_o.warn(t.message)}}}async function Y$(n,e){try{const s=(await uj()).transaction(nf,"readwrite");await s.objectStore(nf).put(e,hj(n)),await s.done}catch(t){if(t instanceof ki)_o.warn(t.message);else{const s=ba.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});_o.warn(s.message)}}}function hj(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z$e=1024,J$e=30;class eDe{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new nDe(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,t;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Q$();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:r}),this._heartbeatsCache.heartbeats.length>J$e){const o=sDe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(s){_o.warn(s)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Q$(),{heartbeatsToSend:s,unsentEntries:r}=tDe(this._heartbeatsCache.heartbeats),i=Lb(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return _o.warn(t),""}}}function Q$(){return new Date().toISOString().substring(0,10)}function tDe(n,e=Z$e){const t=[];let s=n.slice();for(const r of n){const i=t.find(o=>o.agent===r.agent);if(i){if(i.dates.push(r.date),Z$(t)>e){i.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),Z$(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class nDe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return F_()?L_().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Q$e(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return Y$(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return Y$(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Z$(n){return Lb(JSON.stringify({version:2,heartbeats:n})).length}function sDe(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rDe(n){Zi(new bi("platform-logger",e=>new g$e(e),"PRIVATE")),Zi(new bi("heartbeat",e=>new eDe(e),"PRIVATE")),jr(fS,K$,n),jr(fS,K$,"esm2020"),jr("fire-js","")}rDe("");var iDe="firebase",oDe="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */jr(iDe,oDe,"app");function dj(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const aDe=dj,pj=new Cc("auth","Firebase",dj());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zb=new U0("@firebase/auth");function lDe(n,...e){zb.logLevel<=_t.WARN&&zb.warn(`Auth (${ad}): ${n}`,...e)}function Ey(n,...e){zb.logLevel<=_t.ERROR&&zb.error(`Auth (${ad}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gr(n,...e){throw B_(n,...e)}function ui(n,...e){return B_(n,...e)}function V_(n,e,t){const s={...aDe(),[e]:t};return new Cc("auth","Firebase",s).create(e,{appName:n.name})}function hi(n){return V_(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function fj(n,e,t){const s=t;if(!(e instanceof s))throw s.name!==e.constructor.name&&Gr(n,"argument-error"),V_(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function B_(n,...e){if(typeof n!="string"){const t=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=n.name),n._errorFactory.create(t,...s)}return pj.create(n,...e)}function Ye(n,e,...t){if(!n)throw B_(e,...t)}function mo(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Ey(e),new Error(e)}function No(n,e){n||mo(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yS(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function cDe(){return J$()==="http:"||J$()==="https:"}function J$(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uDe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(cDe()||O_()||"connection"in navigator)?navigator.onLine:!0}function hDe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dg{constructor(e,t){this.shortDelay=e,this.longDelay=t,No(t>e,"Short delay should be less than long delay!"),this.isMobile=O2e()||M2e()}get(){return uDe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j_(n,e){No(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mj{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;mo("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;mo("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;mo("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dDe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pDe=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],fDe=new dg(3e4,6e4);function Ya(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Qa(n,e,t,s,r={}){return gj(n,r,async()=>{let i={},o={};s&&(e==="GET"?o=s:i={body:JSON.stringify(s)});const a=hg({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c={method:e,headers:l,...i};return L2e()||(c.referrerPolicy="no-referrer"),n.emulatorConfig&&od(n.emulatorConfig.host)&&(c.credentials="include"),mj.fetch()(await yj(n,n.config.apiHost,t,a),c)})}async function gj(n,e,t){n._canInitEmulator=!1;const s={...dDe,...e};try{const r=new gDe(n),i=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Jg(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Jg(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Jg(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Jg(n,"user-disabled",o);const u=s[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw V_(n,u,c);Gr(n,u)}}catch(r){if(r instanceof ki)throw r;Gr(n,"network-request-failed",{message:String(r)})}}async function pg(n,e,t,s,r={}){const i=await Qa(n,e,t,s,r);return"mfaPendingCredential"in i&&Gr(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function yj(n,e,t,s){const r=`${e}${t}?${s}`,i=n,o=i.config.emulator?j_(n.config,r):`${n.config.apiScheme}://${r}`;return pDe.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function mDe(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class gDe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,s)=>{this.timer=setTimeout(()=>s(ui(this.auth,"network-request-failed")),fDe.get())})}}function Jg(n,e,t){const s={appName:n.name};t.email&&(s.email=t.email),t.phoneNumber&&(s.phoneNumber=t.phoneNumber);const r=ui(n,e,s);return r.customData._tokenResponse=t,r}function eD(n){return n!==void 0&&n.enterprise!==void 0}class yDe{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return mDe(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function bDe(n,e){return Qa(n,"GET","/v2/recaptchaConfig",Ya(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xDe(n,e){return Qa(n,"POST","/v1/accounts:delete",e)}async function Vb(n,e){return Qa(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lp(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function wDe(n,e=!1){const t=ms(n),s=await t.getIdToken(e),r=U_(s);Ye(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const i=typeof r.firebase=="object"?r.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:r,token:s,authTime:lp(y1(r.auth_time)),issuedAtTime:lp(y1(r.iat)),expirationTime:lp(y1(r.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function y1(n){return Number(n)*1e3}function U_(n){const[e,t,s]=n.split(".");if(e===void 0||t===void 0||s===void 0)return Ey("JWT malformed, contained fewer than 3 sections"),null;try{const r=J4(t);return r?JSON.parse(r):(Ey("Failed to decode base64 JWT payload"),null)}catch(r){return Ey("Caught error parsing JWT payload as JSON",r==null?void 0:r.toString()),null}}function tD(n){const e=U_(n);return Ye(e,"internal-error"),Ye(typeof e.exp<"u","internal-error"),Ye(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sf(n,e,t=!1){if(t)return e;try{return await e}catch(s){throw s instanceof ki&&vDe(s)&&n.auth.currentUser===n&&await n.auth.signOut(),s}}function vDe({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IDe{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const s=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bS{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=lp(this.lastLoginAt),this.creationTime=lp(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bb(n){var h;const e=n.auth,t=await n.getIdToken(),s=await sf(n,Vb(e,{idToken:t}));Ye(s==null?void 0:s.users.length,e,"internal-error");const r=s.users[0];n._notifyReloadListener(r);const i=(h=r.providerUserInfo)!=null&&h.length?bj(r.providerUserInfo):[],o=kDe(n.providerData,i),a=n.isAnonymous,l=!(n.email&&r.passwordHash)&&!(o!=null&&o.length),c=a?l:!1,u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new bS(r.createdAt,r.lastLoginAt),isAnonymous:c};Object.assign(n,u)}async function SDe(n){const e=ms(n);await Bb(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function kDe(n,e){return[...n.filter(s=>!e.some(r=>r.providerId===s.providerId)),...e]}function bj(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TDe(n,e){const t=await gj(n,{},async()=>{const s=hg({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:i}=n.config,o=await yj(n,r,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:s};return n.emulatorConfig&&od(n.emulatorConfig.host)&&(l.credentials="include"),mj.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function CDe(n,e){return Qa(n,"POST","/v2/accounts:revokeToken",Ya(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class su{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ye(e.idToken,"internal-error"),Ye(typeof e.idToken<"u","internal-error"),Ye(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):tD(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ye(e.length!==0,"internal-error");const t=tD(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ye(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:s,refreshToken:r,expiresIn:i}=await TDe(e,t);this.updateTokensAndExpiration(s,r,Number(i))}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,t){const{refreshToken:s,accessToken:r,expirationTime:i}=t,o=new su;return s&&(Ye(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),r&&(Ye(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),i&&(Ye(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new su,this.toJSON())}_performRefresh(){return mo("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zo(n,e){Ye(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ni{constructor({uid:e,auth:t,stsTokenManager:s,...r}){this.providerId="firebase",this.proactiveRefresh=new IDe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new bS(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await sf(this,this.stsTokenManager.getToken(this.auth,e));return Ye(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return wDe(this,e)}reload(){return SDe(this)}_assign(e){this!==e&&(Ye(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ni({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){Ye(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&await Bb(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(zs(this.auth.app))return Promise.reject(hi(this.auth));const e=await this.getIdToken();return await sf(this,xDe(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const s=t.displayName??void 0,r=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,l=t._redirectEventId??void 0,c=t.createdAt??void 0,u=t.lastLoginAt??void 0,{uid:h,emailVerified:d,isAnonymous:p,providerData:f,stsTokenManager:g}=t;Ye(h&&g,e,"internal-error");const m=su.fromJSON(this.name,g);Ye(typeof h=="string",e,"internal-error"),Zo(s,e.name),Zo(r,e.name),Ye(typeof d=="boolean",e,"internal-error"),Ye(typeof p=="boolean",e,"internal-error"),Zo(i,e.name),Zo(o,e.name),Zo(a,e.name),Zo(l,e.name),Zo(c,e.name),Zo(u,e.name);const y=new ni({uid:h,auth:e,email:r,emailVerified:d,displayName:s,isAnonymous:p,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:m,createdAt:c,lastLoginAt:u});return f&&Array.isArray(f)&&(y.providerData=f.map(w=>({...w}))),l&&(y._redirectEventId=l),y}static async _fromIdTokenResponse(e,t,s=!1){const r=new su;r.updateFromServerResponse(t);const i=new ni({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:s});return await Bb(i),i}static async _fromGetAccountInfoResponse(e,t,s){const r=t.users[0];Ye(r.localId!==void 0,"internal-error");const i=r.providerUserInfo!==void 0?bj(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!(i!=null&&i.length),a=new su;a.updateFromIdToken(s);const l=new ni({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new bS(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nD=new Map;function go(n){No(n instanceof Function,"Expected a class definition");let e=nD.get(n);return e?(No(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,nD.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xj{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}xj.type="NONE";const sD=xj;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _y(n,e,t){return`firebase:${n}:${e}:${t}`}class ru{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:r,name:i}=this.auth;this.fullUserKey=_y(this.userKey,r.apiKey,i),this.fullPersistenceKey=_y("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Vb(this.auth,{idToken:e}).catch(()=>{});return t?ni._fromGetAccountInfoResponse(this.auth,t,e):null}return ni._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,s="authUser"){if(!t.length)return new ru(go(sD),e,s);const r=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=r[0]||go(sD);const o=_y(s,e.config.apiKey,e.name);let a=null;for(const c of t)try{const u=await c._get(o);if(u){let h;if(typeof u=="string"){const d=await Vb(e,{idToken:u}).catch(()=>{});if(!d)break;h=await ni._fromGetAccountInfoResponse(e,d,u)}else h=ni._fromJSON(e,u);c!==i&&(a=h),i=c;break}}catch{}const l=r.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new ru(i,e,s):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new ru(i,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rD(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Sj(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(wj(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Tj(e))return"Blackberry";if(Cj(e))return"Webos";if(vj(e))return"Safari";if((e.includes("chrome/")||Ij(e))&&!e.includes("edge/"))return"Chrome";if(kj(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=n.match(t);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function wj(n=Ns()){return/firefox\//i.test(n)}function vj(n=Ns()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Ij(n=Ns()){return/crios\//i.test(n)}function Sj(n=Ns()){return/iemobile/i.test(n)}function kj(n=Ns()){return/android/i.test(n)}function Tj(n=Ns()){return/blackberry/i.test(n)}function Cj(n=Ns()){return/webos/i.test(n)}function W_(n=Ns()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function EDe(n=Ns()){var e;return W_(n)&&!!((e=window.navigator)!=null&&e.standalone)}function _De(){return z2e()&&document.documentMode===10}function Ej(n=Ns()){return W_(n)||kj(n)||Cj(n)||Tj(n)||/windows phone/i.test(n)||Sj(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _j(n,e=[]){let t;switch(n){case"Browser":t=rD(Ns());break;case"Worker":t=`${rD(Ns())}-${n}`;break;default:t=n}const s=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${ad}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NDe{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});s.onAbort=t,this.queue.push(s);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)await s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ADe(n,e={}){return Qa(n,"GET","/v2/passwordPolicy",Ya(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RDe=6;class $De{constructor(e){var s;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??RDe,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((s=e.allowedNonAlphanumericCharacters)==null?void 0:s.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let s;for(let r=0;r<e.length;r++)s=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DDe{constructor(e,t,s,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new iD(this),this.idTokenSubscription=new iD(this),this.beforeStateQueue=new NDe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=pj,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=go(t)),this._initializationPromise=this.queue(async()=>{var s,r,i;if(!this._deleted&&(this.persistenceManager=await ru.create(this,e),(s=this._resolvePersistenceManagerAvailable)==null||s.call(this),!this._deleted)){if((r=this._popupRedirectResolver)!=null&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Vb(this,{idToken:e}),s=await ni._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(zs(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let s=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,r=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Ye(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Bb(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=hDe()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(zs(this.app))return Promise.reject(hi(this));const t=e?ms(e):null;return t&&Ye(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ye(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return zs(this.app)?Promise.reject(hi(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return zs(this.app)?Promise.reject(hi(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(go(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await ADe(this),t=new $De(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Cc("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(s.tenantId=this.tenantId),await CDe(this,s)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const s=await this.getOrInitRedirectPersistenceManager(t);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&go(e)||this._popupRedirectResolver;Ye(t,this,"argument-error"),this.redirectPersistenceManager=await ru.create(this,[go(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,s;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((s=this.redirectUser)==null?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,r){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ye(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,s,r);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ye(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=_j(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var r;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((r=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:r.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const s=await this._getAppCheckToken();return s&&(e["X-Firebase-AppCheck"]=s),e}async _getAppCheckToken(){var t;if(zs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&lDe(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Ti(n){return ms(n)}class iD{constructor(e){this.auth=e,this.observer=null,this.addObserver=G2e(t=>this.observer=t)}get next(){return Ye(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let W0={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function PDe(n){W0=n}function Nj(n){return W0.loadJS(n)}function ODe(){return W0.recaptchaEnterpriseScript}function FDe(){return W0.gapiScript}function LDe(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class MDe{constructor(){this.enterprise=new zDe}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class zDe{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const VDe="recaptcha-enterprise",Aj="NO_RECAPTCHA";class BDe{constructor(e){this.type=VDe,this.auth=Ti(e)}async verify(e="verify",t=!1){async function s(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{bDe(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new yDe(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function r(i,o,a){const l=window.grecaptcha;eD(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(Aj)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new MDe().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{s(this.auth).then(a=>{if(!t&&eD(window.grecaptcha))r(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=ODe();l.length!==0&&(l+=a),Nj(l).then(()=>{r(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function Pd(n,e,t,s=!1,r=!1){const i=new BDe(n);let o;if(r)o=Aj;else try{o=await i.verify(t)}catch{o=await i.verify(t,!0)}const a={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,c=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return s?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function xS(n,e,t,s,r){var i,o;if(r==="EMAIL_PASSWORD_PROVIDER")if((i=n._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await Pd(n,e,t,t==="getOobCode");return s(n,a)}else return s(n,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await Pd(n,e,t,t==="getOobCode");return s(n,l)}else return Promise.reject(a)});else if(r==="PHONE_PROVIDER")if((o=n._getRecaptchaConfig())!=null&&o.isProviderEnabled("PHONE_PROVIDER")){const a=await Pd(n,e,t);return s(n,a).catch(async l=>{var c;if(((c=n._getRecaptchaConfig())==null?void 0:c.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(l.code==="auth/missing-recaptcha-token"||l.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);const u=await Pd(n,e,t,!1,!0);return s(n,u)}return Promise.reject(l)})}else{const a=await Pd(n,e,t,!1,!0);return s(n,a)}else return Promise.reject(r+" provider is not supported.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jDe(n,e){const t=Ec(n,"auth");if(t.isInitialized()){const r=t.getImmediate(),i=t.getOptions();if($a(i,e??{}))return r;Gr(r,"already-initialized")}return t.initialize({options:e})}function UDe(n,e){const t=(e==null?void 0:e.persistence)||[],s=(Array.isArray(t)?t:[t]).map(go);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function WDe(n,e,t){const s=Ti(n);Ye(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const r=!!(t!=null&&t.disableWarnings),i=Rj(e),{host:o,port:a}=GDe(e),l=a===null?"":`:${a}`,c={url:`${i}//${o}${l}/`},u=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!s._canInitEmulator){Ye(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),Ye($a(c,s.config.emulator)&&$a(u,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=c,s.emulatorConfig=u,s.settings.appVerificationDisabledForTesting=!0,od(o)?(sj(`${i}//${o}${l}`),rj("Auth",!0)):r||HDe()}function Rj(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function GDe(n){const e=Rj(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const s=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const i=r[1];return{host:i,port:oD(s.substr(i.length+1))}}else{const[i,o]=s.split(":");return{host:i,port:oD(o)}}}function oD(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function HDe(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G_{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return mo("not implemented")}_getIdTokenResponse(e){return mo("not implemented")}_linkToIdToken(e,t){return mo("not implemented")}_getReauthenticationResolver(e){return mo("not implemented")}}async function qDe(n,e){return Qa(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KDe(n,e){return pg(n,"POST","/v1/accounts:signInWithPassword",Ya(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XDe(n,e){return pg(n,"POST","/v1/accounts:signInWithEmailLink",Ya(n,e))}async function YDe(n,e){return pg(n,"POST","/v1/accounts:signInWithEmailLink",Ya(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rf extends G_{constructor(e,t,s,r=null){super("password",s),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new rf(e,t,"password")}static _fromEmailAndCode(e,t,s=null){return new rf(e,t,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return xS(e,t,"signInWithPassword",KDe,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return XDe(e,{email:this._email,oobCode:this._password});default:Gr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const s={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return xS(e,s,"signUpPassword",qDe,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return YDe(e,{idToken:t,email:this._email,oobCode:this._password});default:Gr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iu(n,e){return pg(n,"POST","/v1/accounts:signInWithIdp",Ya(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QDe="http://localhost";class sc extends G_{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new sc(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Gr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:r,...i}=t;if(!s||!r)return null;const o=new sc(s,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return iu(e,t)}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,iu(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,iu(e,t)}buildRequest(){const e={requestUri:QDe,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=hg(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZDe(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function JDe(n){const e=Xd(Yd(n)).link,t=e?Xd(Yd(e)).deep_link_id:null,s=Xd(Yd(n)).deep_link_id;return(s?Xd(Yd(s)).link:null)||s||t||e||n}class H_{constructor(e){const t=Xd(Yd(e)),s=t.apiKey??null,r=t.oobCode??null,i=ZDe(t.mode??null);Ye(s&&r&&i,"argument-error"),this.apiKey=s,this.operation=i,this.code=r,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=JDe(e);try{return new H_(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ld{constructor(){this.providerId=ld.PROVIDER_ID}static credential(e,t){return rf._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const s=H_.parseLink(t);return Ye(s,"argument-error"),rf._fromEmailAndCode(e,s.code,s.tenantId)}}ld.PROVIDER_ID="password";ld.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ld.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G0{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fg extends G0{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia extends fg{constructor(){super("facebook.com")}static credential(e){return sc._fromParams({providerId:ia.PROVIDER_ID,signInMethod:ia.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ia.credentialFromTaggedObject(e)}static credentialFromError(e){return ia.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ia.credential(e.oauthAccessToken)}catch{return null}}}ia.FACEBOOK_SIGN_IN_METHOD="facebook.com";ia.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fo extends fg{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return sc._fromParams({providerId:fo.PROVIDER_ID,signInMethod:fo.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return fo.credentialFromTaggedObject(e)}static credentialFromError(e){return fo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return fo.credential(t,s)}catch{return null}}}fo.GOOGLE_SIGN_IN_METHOD="google.com";fo.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oa extends fg{constructor(){super("github.com")}static credential(e){return sc._fromParams({providerId:oa.PROVIDER_ID,signInMethod:oa.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return oa.credentialFromTaggedObject(e)}static credentialFromError(e){return oa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return oa.credential(e.oauthAccessToken)}catch{return null}}}oa.GITHUB_SIGN_IN_METHOD="github.com";oa.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa extends fg{constructor(){super("twitter.com")}static credential(e,t){return sc._fromParams({providerId:aa.PROVIDER_ID,signInMethod:aa.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return aa.credentialFromTaggedObject(e)}static credentialFromError(e){return aa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return aa.credential(t,s)}catch{return null}}}aa.TWITTER_SIGN_IN_METHOD="twitter.com";aa.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $j(n,e){return pg(n,"POST","/v1/accounts:signUp",Ya(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ao{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,s,r=!1){const i=await ni._fromIdTokenResponse(e,s,r),o=aD(s);return new Ao({user:i,providerId:o,_tokenResponse:s,operationType:t})}static async _forOperation(e,t,s){await e._updateTokensIfNecessary(s,!0);const r=aD(s);return new Ao({user:e,providerId:r,_tokenResponse:s,operationType:t})}}function aD(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ePe(n){var r;if(zs(n.app))return Promise.reject(hi(n));const e=Ti(n);if(await e._initializationPromise,(r=e.currentUser)!=null&&r.isAnonymous)return new Ao({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await $j(e,{returnSecureToken:!0}),s=await Ao._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jb extends ki{constructor(e,t,s,r){super(t.code,t.message),this.operationType=s,this.user=r,Object.setPrototypeOf(this,jb.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,r){return new jb(e,t,s,r)}}function Dj(n,e,t,s){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?jb._fromErrorAndOperation(n,i,e,s):i})}async function tPe(n,e,t=!1){const s=await sf(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Ao._forOperation(n,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nPe(n,e,t=!1){const{auth:s}=n;if(zs(s.app))return Promise.reject(hi(s));const r="reauthenticate";try{const i=await sf(n,Dj(s,r,e,n),t);Ye(i.idToken,s,"internal-error");const o=U_(i.idToken);Ye(o,s,"internal-error");const{sub:a}=o;return Ye(n.uid===a,s,"user-mismatch"),Ao._forOperation(n,r,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Gr(s,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pj(n,e,t=!1){if(zs(n.app))return Promise.reject(hi(n));const s="signIn",r=await Dj(n,s,e),i=await Ao._fromIdTokenResponse(n,s,r);return t||await n._updateCurrentUser(i.user),i}async function sPe(n,e){return Pj(Ti(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Oj(n){const e=Ti(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function rPe(n,e,t){if(zs(n.app))return Promise.reject(hi(n));const s=Ti(n),o=await xS(s,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",$j,"EMAIL_PASSWORD_PROVIDER").catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Oj(n),l}),a=await Ao._fromIdTokenResponse(s,"signIn",o);return await s._updateCurrentUser(a.user),a}function iPe(n,e,t){return zs(n.app)?Promise.reject(hi(n)):sPe(ms(n),ld.credential(e,t)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&Oj(n),s})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oPe(n,e){return ms(n).setPersistence(e)}function aPe(n,e,t,s){return ms(n).onIdTokenChanged(e,t,s)}function lPe(n,e,t){return ms(n).beforeAuthStateChanged(e,t)}function cPe(n,e,t,s){return ms(n).onAuthStateChanged(e,t,s)}function uPe(n){return ms(n).signOut()}const Ub="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fj{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ub,"1"),this.storage.removeItem(Ub),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hPe=1e3,dPe=10;class Lj extends Fj{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Ej(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),r=this.localCache[t];s!==r&&e(t,r,s)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const s=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const o=this.storage.getItem(s);!t&&this.localCache[s]===o||this.notifyListeners(s,o)},i=this.storage.getItem(s);_De()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,dPe):r()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},hPe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Lj.type="LOCAL";const Mj=Lj;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zj extends Fj{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}zj.type="SESSION";const Vj=zj;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pPe(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H0{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const s=new H0(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:s,eventType:r,data:i}=t.data,o=this.handlersMap[r];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:r});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await pPe(a);t.ports[0].postMessage({status:"done",eventId:s,eventType:r,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}H0.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q_(n="",e=10){let t="";for(let s=0;s<e;s++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fPe{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,s=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=q_("",20);r.port1.start();const u=setTimeout(()=>{l(new Error("unsupported_event"))},s);o={messageChannel:r,onMessage(h){const d=h;if(d.data.eventId===c)switch(d.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(d.data.response);break;default:clearTimeout(u),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ji(){return window}function mPe(n){ji().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bj(){return typeof ji().WorkerGlobalScope<"u"&&typeof ji().importScripts=="function"}async function gPe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function yPe(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function bPe(){return Bj()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jj="firebaseLocalStorageDb",xPe=1,Wb="firebaseLocalStorage",Uj="fbase_key";class mg{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function q0(n,e){return n.transaction([Wb],e?"readwrite":"readonly").objectStore(Wb)}function wPe(){const n=indexedDB.deleteDatabase(jj);return new mg(n).toPromise()}function wS(){const n=indexedDB.open(jj,xPe);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const s=n.result;try{s.createObjectStore(Wb,{keyPath:Uj})}catch(r){t(r)}}),n.addEventListener("success",async()=>{const s=n.result;s.objectStoreNames.contains(Wb)?e(s):(s.close(),await wPe(),e(await wS()))})})}async function lD(n,e,t){const s=q0(n,!0).put({[Uj]:e,value:t});return new mg(s).toPromise()}async function vPe(n,e){const t=q0(n,!1).get(e),s=await new mg(t).toPromise();return s===void 0?null:s.value}function cD(n,e){const t=q0(n,!0).delete(e);return new mg(t).toPromise()}const IPe=800,SPe=3;class Wj{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await wS(),this.db)}async _withRetries(e){let t=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(t++>SPe)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Bj()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=H0._getInstance(bPe()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,s;if(this.activeServiceWorker=await gPe(),!this.activeServiceWorker)return;this.sender=new fPe(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(s=e[0])!=null&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||yPe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await wS();return await lD(e,Ub,"1"),await cD(e,Ub),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(s=>lD(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(s=>vPe(s,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>cD(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const i=q0(r,!1).getAll();return new mg(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],s=new Set;if(e.length!==0)for(const{fbase_key:r,value:i}of e)s.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!s.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),IPe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Wj.type="LOCAL";const kPe=Wj;new dg(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K_(n,e){return e?go(e):(Ye(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X_ extends G_{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return iu(e,this._buildIdpRequest())}_linkToIdToken(e,t){return iu(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return iu(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function TPe(n){return Pj(n.auth,new X_(n),n.bypassAuthState)}function CPe(n){const{auth:e,user:t}=n;return Ye(t,e,"internal-error"),nPe(t,new X_(n),n.bypassAuthState)}async function EPe(n){const{auth:e,user:t}=n;return Ye(t,e,"internal-error"),tPe(t,new X_(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gj{constructor(e,t,s,r,i=!1){this.auth=e,this.resolver=s,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:s,postBody:r,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:s,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return TPe;case"linkViaPopup":case"linkViaRedirect":return EPe;case"reauthViaPopup":case"reauthViaRedirect":return CPe;default:Gr(this.auth,"internal-error")}}resolve(e){No(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){No(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _Pe=new dg(2e3,1e4);async function NPe(n,e,t){if(zs(n.app))return Promise.reject(ui(n,"operation-not-supported-in-this-environment"));const s=Ti(n);fj(n,e,G0);const r=K_(s,t);return new kl(s,"signInViaPopup",e,r).executeNotNull()}class kl extends Gj{constructor(e,t,s,r,i){super(e,t,r,i),this.provider=s,this.authWindow=null,this.pollId=null,kl.currentPopupAction&&kl.currentPopupAction.cancel(),kl.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ye(e,this.auth,"internal-error"),e}async onExecution(){No(this.filter.length===1,"Popup operations only handle one event");const e=q_();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(ui(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(ui(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,kl.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,s;if((s=(t=this.authWindow)==null?void 0:t.window)!=null&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ui(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,_Pe.get())};e()}}kl.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const APe="pendingRedirect",Ny=new Map;class RPe extends Gj{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}async execute(){let e=Ny.get(this.auth._key());if(!e){try{const s=await $Pe(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(t){e=()=>Promise.reject(t)}Ny.set(this.auth._key(),e)}return this.bypassAuthState||Ny.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function $Pe(n,e){const t=qj(e),s=Hj(n);if(!await s._isAvailable())return!1;const r=await s._get(t)==="true";return await s._remove(t),r}async function DPe(n,e){return Hj(n)._set(qj(e),"true")}function PPe(n,e){Ny.set(n._key(),e)}function Hj(n){return go(n._redirectPersistence)}function qj(n){return _y(APe,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uD(n,e,t){return OPe(n,e,t)}async function OPe(n,e,t){if(zs(n.app))return Promise.reject(hi(n));const s=Ti(n);fj(n,e,G0),await s._initializationPromise;const r=K_(s,t);return await DPe(r,s),r._openRedirect(s,e,"signInViaRedirect")}async function FPe(n,e){return await Ti(n)._initializationPromise,Kj(n,e,!1)}async function Kj(n,e,t=!1){if(zs(n.app))return Promise.reject(hi(n));const s=Ti(n),r=K_(s,e),o=await new RPe(s,r,t).execute();return o&&!t&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LPe=10*60*1e3;class MPe{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!zPe(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var s;if(e.error&&!Xj(e)){const r=((s=e.error.code)==null?void 0:s.split("auth/")[1])||"internal-error";t.onError(ui(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=LPe&&this.cachedEventUids.clear(),this.cachedEventUids.has(hD(e))}saveEventToCache(e){this.cachedEventUids.add(hD(e)),this.lastProcessedEventTime=Date.now()}}function hD(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Xj({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function zPe(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Xj(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VPe(n,e={}){return Qa(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BPe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,jPe=/^https?/;async function UPe(n){if(n.config.emulator)return;const{authorizedDomains:e}=await VPe(n);for(const t of e)try{if(WPe(t))return}catch{}Gr(n,"unauthorized-domain")}function WPe(n){const e=yS(),{protocol:t,hostname:s}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&s===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===s}if(!jPe.test(t))return!1;if(BPe.test(n))return s===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GPe=new dg(3e4,6e4);function dD(){const n=ji().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function HPe(n){return new Promise((e,t)=>{var r,i,o;function s(){dD(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{dD(),t(ui(n,"network-request-failed"))},timeout:GPe.get()})}if((i=(r=ji().gapi)==null?void 0:r.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=ji().gapi)!=null&&o.load)s();else{const a=LDe("iframefcb");return ji()[a]=()=>{gapi.load?s():t(ui(n,"network-request-failed"))},Nj(`${FDe()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw Ay=null,e})}let Ay=null;function qPe(n){return Ay=Ay||HPe(n),Ay}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KPe=new dg(5e3,15e3),XPe="__/auth/iframe",YPe="emulator/auth/iframe",QPe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ZPe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function JPe(n){const e=n.config;Ye(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?j_(e,YPe):`https://${n.config.authDomain}/${XPe}`,s={apiKey:e.apiKey,appName:n.name,v:ad},r=ZPe.get(n.config.apiHost);r&&(s.eid=r);const i=n._getFrameworks();return i.length&&(s.fw=i.join(",")),`${t}?${hg(s).slice(1)}`}async function eOe(n){const e=await qPe(n),t=ji().gapi;return Ye(t,n,"internal-error"),e.open({where:document.body,url:JPe(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:QPe,dontclear:!0},s=>new Promise(async(r,i)=>{await s.restyle({setHideOnLeave:!1});const o=ui(n,"network-request-failed"),a=ji().setTimeout(()=>{i(o)},KPe.get());function l(){ji().clearTimeout(a),r(s)}s.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tOe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},nOe=500,sOe=600,rOe="_blank",iOe="http://localhost";class pD{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function oOe(n,e,t,s=nOe,r=sOe){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const l={...tOe,width:s.toString(),height:r.toString(),top:i,left:o},c=Ns().toLowerCase();t&&(a=Ij(c)?rOe:t),wj(c)&&(e=e||iOe,l.scrollbars="yes");const u=Object.entries(l).reduce((d,[p,f])=>`${d}${p}=${f},`,"");if(EDe(c)&&a!=="_self")return aOe(e||"",a),new pD(null);const h=window.open(e||"",a,u);Ye(h,n,"popup-blocked");try{h.focus()}catch{}return new pD(h)}function aOe(n,e){const t=document.createElement("a");t.href=n,t.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lOe="__/auth/handler",cOe="emulator/auth/handler",uOe=encodeURIComponent("fac");async function fD(n,e,t,s,r,i){Ye(n.config.authDomain,n,"auth-domain-config-required"),Ye(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:s,v:ad,eventId:r};if(e instanceof G0){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",W2e(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,h]of Object.entries(i||{}))o[u]=h}if(e instanceof fg){const u=e.getScopes().filter(h=>h!=="");u.length>0&&(o.scopes=u.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const u of Object.keys(a))a[u]===void 0&&delete a[u];const l=await n._getAppCheckToken(),c=l?`#${uOe}=${encodeURIComponent(l)}`:"";return`${hOe(n)}?${hg(a).slice(1)}${c}`}function hOe({config:n}){return n.emulator?j_(n,cOe):`https://${n.authDomain}/${lOe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b1="webStorageSupport";class dOe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Vj,this._completeRedirectFn=Kj,this._overrideRedirectResult=PPe}async _openPopup(e,t,s,r){var o;No((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await fD(e,t,s,yS(),r);return oOe(e,i,q_())}async _openRedirect(e,t,s,r){await this._originValidation(e);const i=await fD(e,t,s,yS(),r);return mPe(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:i}=this.eventManagers[t];return r?Promise.resolve(r):(No(i,"If manager is not set, promise should be"),i)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}async initAndGetManager(e){const t=await eOe(e),s=new MPe(e);return t.register("authEvent",r=>(Ye(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:s.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(b1,{type:b1},r=>{var o;const i=(o=r==null?void 0:r[0])==null?void 0:o[b1];i!==void 0&&t(!!i),Gr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=UPe(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ej()||vj()||W_()}}const pOe=dOe;var mD="@firebase/auth",gD="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fOe{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ye(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mOe(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function gOe(n){Zi(new bi("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=s.options;Ye(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:_j(n)},c=new DDe(s,r,i,l);return UDe(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),Zi(new bi("auth-internal",e=>{const t=Ti(e.getProvider("auth").getImmediate());return(s=>new fOe(s))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),jr(mD,gD,mOe(n)),jr(mD,gD,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yOe=5*60,bOe=nj("authIdTokenMaxAge")||yOe;let yD=null;const xOe=n=>async e=>{const t=e&&await e.getIdTokenResult(),s=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(s&&s>bOe)return;const r=t==null?void 0:t.token;yD!==r&&(yD=r,await fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function wOe(n=z_()){const e=Ec(n,"auth");if(e.isInitialized())return e.getImmediate();const t=jDe(n,{popupRedirectResolver:pOe,persistence:[kPe,Mj,Vj]}),s=nj("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(s,location.origin);if(location.origin===i.origin){const o=xOe(i.toString());lPe(t,o,()=>o(t.currentUser)),aPe(t,a=>o(a))}}const r=ej("auth");return r&&WDe(t,`http://${r}`),t}function vOe(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}PDe({loadJS(n){return new Promise((e,t)=>{const s=document.createElement("script");s.setAttribute("src",n),s.onload=e,s.onerror=r=>{const i=ui("internal-error");i.customData=r,t(i)},s.type="text/javascript",s.charset="UTF-8",vOe().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});gOe("Browser");var bD=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var xa,Yj;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(T,E){function k(){}k.prototype=E.prototype,T.F=E.prototype,T.prototype=new k,T.prototype.constructor=T,T.D=function(S,A,P){for(var D=Array(arguments.length-2),V=2;V<arguments.length;V++)D[V-2]=arguments[V];return E.prototype[A].apply(S,D)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(s,t),s.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(T,E,k){k||(k=0);const S=Array(16);if(typeof E=="string")for(var A=0;A<16;++A)S[A]=E.charCodeAt(k++)|E.charCodeAt(k++)<<8|E.charCodeAt(k++)<<16|E.charCodeAt(k++)<<24;else for(A=0;A<16;++A)S[A]=E[k++]|E[k++]<<8|E[k++]<<16|E[k++]<<24;E=T.g[0],k=T.g[1],A=T.g[2];let P=T.g[3],D;D=E+(P^k&(A^P))+S[0]+3614090360&4294967295,E=k+(D<<7&4294967295|D>>>25),D=P+(A^E&(k^A))+S[1]+3905402710&4294967295,P=E+(D<<12&4294967295|D>>>20),D=A+(k^P&(E^k))+S[2]+606105819&4294967295,A=P+(D<<17&4294967295|D>>>15),D=k+(E^A&(P^E))+S[3]+3250441966&4294967295,k=A+(D<<22&4294967295|D>>>10),D=E+(P^k&(A^P))+S[4]+4118548399&4294967295,E=k+(D<<7&4294967295|D>>>25),D=P+(A^E&(k^A))+S[5]+1200080426&4294967295,P=E+(D<<12&4294967295|D>>>20),D=A+(k^P&(E^k))+S[6]+2821735955&4294967295,A=P+(D<<17&4294967295|D>>>15),D=k+(E^A&(P^E))+S[7]+4249261313&4294967295,k=A+(D<<22&4294967295|D>>>10),D=E+(P^k&(A^P))+S[8]+1770035416&4294967295,E=k+(D<<7&4294967295|D>>>25),D=P+(A^E&(k^A))+S[9]+2336552879&4294967295,P=E+(D<<12&4294967295|D>>>20),D=A+(k^P&(E^k))+S[10]+4294925233&4294967295,A=P+(D<<17&4294967295|D>>>15),D=k+(E^A&(P^E))+S[11]+2304563134&4294967295,k=A+(D<<22&4294967295|D>>>10),D=E+(P^k&(A^P))+S[12]+1804603682&4294967295,E=k+(D<<7&4294967295|D>>>25),D=P+(A^E&(k^A))+S[13]+4254626195&4294967295,P=E+(D<<12&4294967295|D>>>20),D=A+(k^P&(E^k))+S[14]+2792965006&4294967295,A=P+(D<<17&4294967295|D>>>15),D=k+(E^A&(P^E))+S[15]+1236535329&4294967295,k=A+(D<<22&4294967295|D>>>10),D=E+(A^P&(k^A))+S[1]+4129170786&4294967295,E=k+(D<<5&4294967295|D>>>27),D=P+(k^A&(E^k))+S[6]+3225465664&4294967295,P=E+(D<<9&4294967295|D>>>23),D=A+(E^k&(P^E))+S[11]+643717713&4294967295,A=P+(D<<14&4294967295|D>>>18),D=k+(P^E&(A^P))+S[0]+3921069994&4294967295,k=A+(D<<20&4294967295|D>>>12),D=E+(A^P&(k^A))+S[5]+3593408605&4294967295,E=k+(D<<5&4294967295|D>>>27),D=P+(k^A&(E^k))+S[10]+38016083&4294967295,P=E+(D<<9&4294967295|D>>>23),D=A+(E^k&(P^E))+S[15]+3634488961&4294967295,A=P+(D<<14&4294967295|D>>>18),D=k+(P^E&(A^P))+S[4]+3889429448&4294967295,k=A+(D<<20&4294967295|D>>>12),D=E+(A^P&(k^A))+S[9]+568446438&4294967295,E=k+(D<<5&4294967295|D>>>27),D=P+(k^A&(E^k))+S[14]+3275163606&4294967295,P=E+(D<<9&4294967295|D>>>23),D=A+(E^k&(P^E))+S[3]+4107603335&4294967295,A=P+(D<<14&4294967295|D>>>18),D=k+(P^E&(A^P))+S[8]+1163531501&4294967295,k=A+(D<<20&4294967295|D>>>12),D=E+(A^P&(k^A))+S[13]+2850285829&4294967295,E=k+(D<<5&4294967295|D>>>27),D=P+(k^A&(E^k))+S[2]+4243563512&4294967295,P=E+(D<<9&4294967295|D>>>23),D=A+(E^k&(P^E))+S[7]+1735328473&4294967295,A=P+(D<<14&4294967295|D>>>18),D=k+(P^E&(A^P))+S[12]+2368359562&4294967295,k=A+(D<<20&4294967295|D>>>12),D=E+(k^A^P)+S[5]+4294588738&4294967295,E=k+(D<<4&4294967295|D>>>28),D=P+(E^k^A)+S[8]+2272392833&4294967295,P=E+(D<<11&4294967295|D>>>21),D=A+(P^E^k)+S[11]+1839030562&4294967295,A=P+(D<<16&4294967295|D>>>16),D=k+(A^P^E)+S[14]+4259657740&4294967295,k=A+(D<<23&4294967295|D>>>9),D=E+(k^A^P)+S[1]+2763975236&4294967295,E=k+(D<<4&4294967295|D>>>28),D=P+(E^k^A)+S[4]+1272893353&4294967295,P=E+(D<<11&4294967295|D>>>21),D=A+(P^E^k)+S[7]+4139469664&4294967295,A=P+(D<<16&4294967295|D>>>16),D=k+(A^P^E)+S[10]+3200236656&4294967295,k=A+(D<<23&4294967295|D>>>9),D=E+(k^A^P)+S[13]+681279174&4294967295,E=k+(D<<4&4294967295|D>>>28),D=P+(E^k^A)+S[0]+3936430074&4294967295,P=E+(D<<11&4294967295|D>>>21),D=A+(P^E^k)+S[3]+3572445317&4294967295,A=P+(D<<16&4294967295|D>>>16),D=k+(A^P^E)+S[6]+76029189&4294967295,k=A+(D<<23&4294967295|D>>>9),D=E+(k^A^P)+S[9]+3654602809&4294967295,E=k+(D<<4&4294967295|D>>>28),D=P+(E^k^A)+S[12]+3873151461&4294967295,P=E+(D<<11&4294967295|D>>>21),D=A+(P^E^k)+S[15]+530742520&4294967295,A=P+(D<<16&4294967295|D>>>16),D=k+(A^P^E)+S[2]+3299628645&4294967295,k=A+(D<<23&4294967295|D>>>9),D=E+(A^(k|~P))+S[0]+4096336452&4294967295,E=k+(D<<6&4294967295|D>>>26),D=P+(k^(E|~A))+S[7]+1126891415&4294967295,P=E+(D<<10&4294967295|D>>>22),D=A+(E^(P|~k))+S[14]+2878612391&4294967295,A=P+(D<<15&4294967295|D>>>17),D=k+(P^(A|~E))+S[5]+4237533241&4294967295,k=A+(D<<21&4294967295|D>>>11),D=E+(A^(k|~P))+S[12]+1700485571&4294967295,E=k+(D<<6&4294967295|D>>>26),D=P+(k^(E|~A))+S[3]+2399980690&4294967295,P=E+(D<<10&4294967295|D>>>22),D=A+(E^(P|~k))+S[10]+4293915773&4294967295,A=P+(D<<15&4294967295|D>>>17),D=k+(P^(A|~E))+S[1]+2240044497&4294967295,k=A+(D<<21&4294967295|D>>>11),D=E+(A^(k|~P))+S[8]+1873313359&4294967295,E=k+(D<<6&4294967295|D>>>26),D=P+(k^(E|~A))+S[15]+4264355552&4294967295,P=E+(D<<10&4294967295|D>>>22),D=A+(E^(P|~k))+S[6]+2734768916&4294967295,A=P+(D<<15&4294967295|D>>>17),D=k+(P^(A|~E))+S[13]+1309151649&4294967295,k=A+(D<<21&4294967295|D>>>11),D=E+(A^(k|~P))+S[4]+4149444226&4294967295,E=k+(D<<6&4294967295|D>>>26),D=P+(k^(E|~A))+S[11]+3174756917&4294967295,P=E+(D<<10&4294967295|D>>>22),D=A+(E^(P|~k))+S[2]+718787259&4294967295,A=P+(D<<15&4294967295|D>>>17),D=k+(P^(A|~E))+S[9]+3951481745&4294967295,T.g[0]=T.g[0]+E&4294967295,T.g[1]=T.g[1]+(A+(D<<21&4294967295|D>>>11))&4294967295,T.g[2]=T.g[2]+A&4294967295,T.g[3]=T.g[3]+P&4294967295}s.prototype.v=function(T,E){E===void 0&&(E=T.length);const k=E-this.blockSize,S=this.C;let A=this.h,P=0;for(;P<E;){if(A==0)for(;P<=k;)r(this,T,P),P+=this.blockSize;if(typeof T=="string"){for(;P<E;)if(S[A++]=T.charCodeAt(P++),A==this.blockSize){r(this,S),A=0;break}}else for(;P<E;)if(S[A++]=T[P++],A==this.blockSize){r(this,S),A=0;break}}this.h=A,this.o+=E},s.prototype.A=function(){var T=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);T[0]=128;for(var E=1;E<T.length-8;++E)T[E]=0;E=this.o*8;for(var k=T.length-8;k<T.length;++k)T[k]=E&255,E/=256;for(this.v(T),T=Array(16),E=0,k=0;k<4;++k)for(let S=0;S<32;S+=8)T[E++]=this.g[k]>>>S&255;return T};function i(T,E){var k=a;return Object.prototype.hasOwnProperty.call(k,T)?k[T]:k[T]=E(T)}function o(T,E){this.h=E;const k=[];let S=!0;for(let A=T.length-1;A>=0;A--){const P=T[A]|0;S&&P==E||(k[A]=P,S=!1)}this.g=k}var a={};function l(T){return-128<=T&&T<128?i(T,function(E){return new o([E|0],E<0?-1:0)}):new o([T|0],T<0?-1:0)}function c(T){if(isNaN(T)||!isFinite(T))return h;if(T<0)return m(c(-T));const E=[];let k=1;for(let S=0;T>=k;S++)E[S]=T/k|0,k*=4294967296;return new o(E,0)}function u(T,E){if(T.length==0)throw Error("number format error: empty string");if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(T.charAt(0)=="-")return m(u(T.substring(1),E));if(T.indexOf("-")>=0)throw Error('number format error: interior "-" character');const k=c(Math.pow(E,8));let S=h;for(let P=0;P<T.length;P+=8){var A=Math.min(8,T.length-P);const D=parseInt(T.substring(P,P+A),E);A<8?(A=c(Math.pow(E,A)),S=S.j(A).add(c(D))):(S=S.j(k),S=S.add(c(D)))}return S}var h=l(0),d=l(1),p=l(16777216);n=o.prototype,n.m=function(){if(g(this))return-m(this).m();let T=0,E=1;for(let k=0;k<this.g.length;k++){const S=this.i(k);T+=(S>=0?S:4294967296+S)*E,E*=4294967296}return T},n.toString=function(T){if(T=T||10,T<2||36<T)throw Error("radix out of range: "+T);if(f(this))return"0";if(g(this))return"-"+m(this).toString(T);const E=c(Math.pow(T,6));var k=this;let S="";for(;;){const A=I(k,E).g;k=y(k,A.j(E));let P=((k.g.length>0?k.g[0]:k.h)>>>0).toString(T);if(k=A,f(k))return P+S;for(;P.length<6;)P="0"+P;S=P+S}},n.i=function(T){return T<0?0:T<this.g.length?this.g[T]:this.h};function f(T){if(T.h!=0)return!1;for(let E=0;E<T.g.length;E++)if(T.g[E]!=0)return!1;return!0}function g(T){return T.h==-1}n.l=function(T){return T=y(this,T),g(T)?-1:f(T)?0:1};function m(T){const E=T.g.length,k=[];for(let S=0;S<E;S++)k[S]=~T.g[S];return new o(k,~T.h).add(d)}n.abs=function(){return g(this)?m(this):this},n.add=function(T){const E=Math.max(this.g.length,T.g.length),k=[];let S=0;for(let A=0;A<=E;A++){let P=S+(this.i(A)&65535)+(T.i(A)&65535),D=(P>>>16)+(this.i(A)>>>16)+(T.i(A)>>>16);S=D>>>16,P&=65535,D&=65535,k[A]=D<<16|P}return new o(k,k[k.length-1]&-2147483648?-1:0)};function y(T,E){return T.add(m(E))}n.j=function(T){if(f(this)||f(T))return h;if(g(this))return g(T)?m(this).j(m(T)):m(m(this).j(T));if(g(T))return m(this.j(m(T)));if(this.l(p)<0&&T.l(p)<0)return c(this.m()*T.m());const E=this.g.length+T.g.length,k=[];for(var S=0;S<2*E;S++)k[S]=0;for(S=0;S<this.g.length;S++)for(let A=0;A<T.g.length;A++){const P=this.i(S)>>>16,D=this.i(S)&65535,V=T.i(A)>>>16,U=T.i(A)&65535;k[2*S+2*A]+=D*U,w(k,2*S+2*A),k[2*S+2*A+1]+=P*U,w(k,2*S+2*A+1),k[2*S+2*A+1]+=D*V,w(k,2*S+2*A+1),k[2*S+2*A+2]+=P*V,w(k,2*S+2*A+2)}for(T=0;T<E;T++)k[T]=k[2*T+1]<<16|k[2*T];for(T=E;T<2*E;T++)k[T]=0;return new o(k,0)};function w(T,E){for(;(T[E]&65535)!=T[E];)T[E+1]+=T[E]>>>16,T[E]&=65535,E++}function v(T,E){this.g=T,this.h=E}function I(T,E){if(f(E))throw Error("division by zero");if(f(T))return new v(h,h);if(g(T))return E=I(m(T),E),new v(m(E.g),m(E.h));if(g(E))return E=I(T,m(E)),new v(m(E.g),E.h);if(T.g.length>30){if(g(T)||g(E))throw Error("slowDivide_ only works with positive integers.");for(var k=d,S=E;S.l(T)<=0;)k=_(k),S=_(S);var A=N(k,1),P=N(S,1);for(S=N(S,2),k=N(k,2);!f(S);){var D=P.add(S);D.l(T)<=0&&(A=A.add(k),P=D),S=N(S,1),k=N(k,1)}return E=y(T,A.j(E)),new v(A,E)}for(A=h;T.l(E)>=0;){for(k=Math.max(1,Math.floor(T.m()/E.m())),S=Math.ceil(Math.log(k)/Math.LN2),S=S<=48?1:Math.pow(2,S-48),P=c(k),D=P.j(E);g(D)||D.l(T)>0;)k-=S,P=c(k),D=P.j(E);f(P)&&(P=d),A=A.add(P),T=y(T,D)}return new v(A,T)}n.B=function(T){return I(this,T).h},n.and=function(T){const E=Math.max(this.g.length,T.g.length),k=[];for(let S=0;S<E;S++)k[S]=this.i(S)&T.i(S);return new o(k,this.h&T.h)},n.or=function(T){const E=Math.max(this.g.length,T.g.length),k=[];for(let S=0;S<E;S++)k[S]=this.i(S)|T.i(S);return new o(k,this.h|T.h)},n.xor=function(T){const E=Math.max(this.g.length,T.g.length),k=[];for(let S=0;S<E;S++)k[S]=this.i(S)^T.i(S);return new o(k,this.h^T.h)};function _(T){const E=T.g.length+1,k=[];for(let S=0;S<E;S++)k[S]=T.i(S)<<1|T.i(S-1)>>>31;return new o(k,T.h)}function N(T,E){const k=E>>5;E%=32;const S=T.g.length-k,A=[];for(let P=0;P<S;P++)A[P]=E>0?T.i(P+k)>>>E|T.i(P+k+1)<<32-E:T.i(P+k);return new o(A,T.h)}s.prototype.digest=s.prototype.A,s.prototype.reset=s.prototype.u,s.prototype.update=s.prototype.v,Yj=s,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=u,xa=o}).apply(typeof bD<"u"?bD:typeof self<"u"?self:typeof window<"u"?window:{});var ey=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Qj,Qd,Zj,Ry,vS,Jj,eU,tU;(function(){var n,e=Object.defineProperty;function t(b){b=[typeof globalThis=="object"&&globalThis,b,typeof window=="object"&&window,typeof self=="object"&&self,typeof ey=="object"&&ey];for(var C=0;C<b.length;++C){var $=b[C];if($&&$.Math==Math)return $}throw Error("Cannot find global object")}var s=t(this);function r(b,C){if(C)e:{var $=s;b=b.split(".");for(var M=0;M<b.length-1;M++){var Q=b[M];if(!(Q in $))break e;$=$[Q]}b=b[b.length-1],M=$[b],C=C(M),C!=M&&C!=null&&e($,b,{configurable:!0,writable:!0,value:C})}}r("Symbol.dispose",function(b){return b||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(b){return b||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(b){return b||function(C){var $=[],M;for(M in C)Object.prototype.hasOwnProperty.call(C,M)&&$.push([M,C[M]]);return $}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var i=i||{},o=this||self;function a(b){var C=typeof b;return C=="object"&&b!=null||C=="function"}function l(b,C,$){return b.call.apply(b.bind,arguments)}function c(b,C,$){return c=l,c.apply(null,arguments)}function u(b,C){var $=Array.prototype.slice.call(arguments,1);return function(){var M=$.slice();return M.push.apply(M,arguments),b.apply(this,M)}}function h(b,C){function $(){}$.prototype=C.prototype,b.Z=C.prototype,b.prototype=new $,b.prototype.constructor=b,b.Ob=function(M,Q,se){for(var Ie=Array(arguments.length-2),yt=2;yt<arguments.length;yt++)Ie[yt-2]=arguments[yt];return C.prototype[Q].apply(M,Ie)}}var d=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?b=>b&&AsyncContext.Snapshot.wrap(b):b=>b;function p(b){const C=b.length;if(C>0){const $=Array(C);for(let M=0;M<C;M++)$[M]=b[M];return $}return[]}function f(b,C){for(let M=1;M<arguments.length;M++){const Q=arguments[M];var $=typeof Q;if($=$!="object"?$:Q?Array.isArray(Q)?"array":$:"null",$=="array"||$=="object"&&typeof Q.length=="number"){$=b.length||0;const se=Q.length||0;b.length=$+se;for(let Ie=0;Ie<se;Ie++)b[$+Ie]=Q[Ie]}else b.push(Q)}}class g{constructor(C,$){this.i=C,this.j=$,this.h=0,this.g=null}get(){let C;return this.h>0?(this.h--,C=this.g,this.g=C.next,C.next=null):C=this.i(),C}}function m(b){o.setTimeout(()=>{throw b},0)}function y(){var b=T;let C=null;return b.g&&(C=b.g,b.g=b.g.next,b.g||(b.h=null),C.next=null),C}class w{constructor(){this.h=this.g=null}add(C,$){const M=v.get();M.set(C,$),this.h?this.h.next=M:this.g=M,this.h=M}}var v=new g(()=>new I,b=>b.reset());class I{constructor(){this.next=this.g=this.h=null}set(C,$){this.h=C,this.g=$,this.next=null}reset(){this.next=this.g=this.h=null}}let _,N=!1,T=new w,E=()=>{const b=Promise.resolve(void 0);_=()=>{b.then(k)}};function k(){for(var b;b=y();){try{b.h.call(b.g)}catch($){m($)}var C=v;C.j(b),C.h<100&&(C.h++,b.next=C.g,C.g=b)}N=!1}function S(){this.u=this.u,this.C=this.C}S.prototype.u=!1,S.prototype.dispose=function(){this.u||(this.u=!0,this.N())},S.prototype[Symbol.dispose]=function(){this.dispose()},S.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function A(b,C){this.type=b,this.g=this.target=C,this.defaultPrevented=!1}A.prototype.h=function(){this.defaultPrevented=!0};var P=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var b=!1,C=Object.defineProperty({},"passive",{get:function(){b=!0}});try{const $=()=>{};o.addEventListener("test",$,C),o.removeEventListener("test",$,C)}catch{}return b}();function D(b){return/^[\s\xa0]*$/.test(b)}function V(b,C){A.call(this,b?b.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,b&&this.init(b,C)}h(V,A),V.prototype.init=function(b,C){const $=this.type=b.type,M=b.changedTouches&&b.changedTouches.length?b.changedTouches[0]:null;this.target=b.target||b.srcElement,this.g=C,C=b.relatedTarget,C||($=="mouseover"?C=b.fromElement:$=="mouseout"&&(C=b.toElement)),this.relatedTarget=C,M?(this.clientX=M.clientX!==void 0?M.clientX:M.pageX,this.clientY=M.clientY!==void 0?M.clientY:M.pageY,this.screenX=M.screenX||0,this.screenY=M.screenY||0):(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0),this.button=b.button,this.key=b.key||"",this.ctrlKey=b.ctrlKey,this.altKey=b.altKey,this.shiftKey=b.shiftKey,this.metaKey=b.metaKey,this.pointerId=b.pointerId||0,this.pointerType=b.pointerType,this.state=b.state,this.i=b,b.defaultPrevented&&V.Z.h.call(this)},V.prototype.h=function(){V.Z.h.call(this);const b=this.i;b.preventDefault?b.preventDefault():b.returnValue=!1};var U="closure_listenable_"+(Math.random()*1e6|0),q=0;function J(b,C,$,M,Q){this.listener=b,this.proxy=null,this.src=C,this.type=$,this.capture=!!M,this.ha=Q,this.key=++q,this.da=this.fa=!1}function K(b){b.da=!0,b.listener=null,b.proxy=null,b.src=null,b.ha=null}function ee(b,C,$){for(const M in b)C.call($,b[M],M,b)}function L(b,C){for(const $ in b)C.call(void 0,b[$],$,b)}function ae(b){const C={};for(const $ in b)C[$]=b[$];return C}const ce="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function z(b,C){let $,M;for(let Q=1;Q<arguments.length;Q++){M=arguments[Q];for($ in M)b[$]=M[$];for(let se=0;se<ce.length;se++)$=ce[se],Object.prototype.hasOwnProperty.call(M,$)&&(b[$]=M[$])}}function ue(b){this.src=b,this.g={},this.h=0}ue.prototype.add=function(b,C,$,M,Q){const se=b.toString();b=this.g[se],b||(b=this.g[se]=[],this.h++);const Ie=be(b,C,M,Q);return Ie>-1?(C=b[Ie],$||(C.fa=!1)):(C=new J(C,this.src,se,!!M,Q),C.fa=$,b.push(C)),C};function de(b,C){const $=C.type;if($ in b.g){var M=b.g[$],Q=Array.prototype.indexOf.call(M,C,void 0),se;(se=Q>=0)&&Array.prototype.splice.call(M,Q,1),se&&(K(C),b.g[$].length==0&&(delete b.g[$],b.h--))}}function be(b,C,$,M){for(let Q=0;Q<b.length;++Q){const se=b[Q];if(!se.da&&se.listener==C&&se.capture==!!$&&se.ha==M)return Q}return-1}var Ee="closure_lm_"+(Math.random()*1e6|0),Re={};function _e(b,C,$,M,Q){if(M&&M.once)return qe(b,C,$,M,Q);if(Array.isArray(C)){for(let se=0;se<C.length;se++)_e(b,C[se],$,M,Q);return null}return $=yn($),b&&b[U]?b.J(C,$,a(M)?!!M.capture:!!M,Q):Ae(b,C,$,!1,M,Q)}function Ae(b,C,$,M,Q,se){if(!C)throw Error("Invalid event type");const Ie=a(Q)?!!Q.capture:!!Q;let yt=Rt(b);if(yt||(b[Ee]=yt=new ue(b)),$=yt.add(C,$,M,Ie,se),$.proxy)return $;if(M=je(),$.proxy=M,M.src=b,M.listener=$,b.addEventListener)P||(Q=Ie),Q===void 0&&(Q=!1),b.addEventListener(C.toString(),M,Q);else if(b.attachEvent)b.attachEvent(ot(C.toString()),M);else if(b.addListener&&b.removeListener)b.addListener(M);else throw Error("addEventListener and attachEvent are unavailable.");return $}function je(){function b($){return C.call(b.src,b.listener,$)}const C=xt;return b}function qe(b,C,$,M,Q){if(Array.isArray(C)){for(let se=0;se<C.length;se++)qe(b,C[se],$,M,Q);return null}return $=yn($),b&&b[U]?b.K(C,$,a(M)?!!M.capture:!!M,Q):Ae(b,C,$,!0,M,Q)}function gt(b,C,$,M,Q){if(Array.isArray(C))for(var se=0;se<C.length;se++)gt(b,C[se],$,M,Q);else M=a(M)?!!M.capture:!!M,$=yn($),b&&b[U]?(b=b.i,se=String(C).toString(),se in b.g&&(C=b.g[se],$=be(C,$,M,Q),$>-1&&(K(C[$]),Array.prototype.splice.call(C,$,1),C.length==0&&(delete b.g[se],b.h--)))):b&&(b=Rt(b))&&(C=b.g[C.toString()],b=-1,C&&(b=be(C,$,M,Q)),($=b>-1?C[b]:null)&&Et($))}function Et(b){if(typeof b!="number"&&b&&!b.da){var C=b.src;if(C&&C[U])de(C.i,b);else{var $=b.type,M=b.proxy;C.removeEventListener?C.removeEventListener($,M,b.capture):C.detachEvent?C.detachEvent(ot($),M):C.addListener&&C.removeListener&&C.removeListener(M),($=Rt(C))?(de($,b),$.h==0&&($.src=null,C[Ee]=null)):K(b)}}}function ot(b){return b in Re?Re[b]:Re[b]="on"+b}function xt(b,C){if(b.da)b=!0;else{C=new V(C,this);const $=b.listener,M=b.ha||b.src;b.fa&&Et(b),b=$.call(M,C)}return b}function Rt(b){return b=b[Ee],b instanceof ue?b:null}var It="__closure_events_fn_"+(Math.random()*1e9>>>0);function yn(b){return typeof b=="function"?b:(b[It]||(b[It]=function(C){return b.handleEvent(C)}),b[It])}function at(){S.call(this),this.i=new ue(this),this.M=this,this.G=null}h(at,S),at.prototype[U]=!0,at.prototype.removeEventListener=function(b,C,$,M){gt(this,b,C,$,M)};function zt(b,C){var $,M=b.G;if(M)for($=[];M;M=M.G)$.push(M);if(b=b.M,M=C.type||C,typeof C=="string")C=new A(C,b);else if(C instanceof A)C.target=C.target||b;else{var Q=C;C=new A(M,b),z(C,Q)}Q=!0;let se,Ie;if($)for(Ie=$.length-1;Ie>=0;Ie--)se=C.g=$[Ie],Q=ln(se,M,!0,C)&&Q;if(se=C.g=b,Q=ln(se,M,!0,C)&&Q,Q=ln(se,M,!1,C)&&Q,$)for(Ie=0;Ie<$.length;Ie++)se=C.g=$[Ie],Q=ln(se,M,!1,C)&&Q}at.prototype.N=function(){if(at.Z.N.call(this),this.i){var b=this.i;for(const C in b.g){const $=b.g[C];for(let M=0;M<$.length;M++)K($[M]);delete b.g[C],b.h--}}this.G=null},at.prototype.J=function(b,C,$,M){return this.i.add(String(b),C,!1,$,M)},at.prototype.K=function(b,C,$,M){return this.i.add(String(b),C,!0,$,M)};function ln(b,C,$,M){if(C=b.i.g[String(C)],!C)return!0;C=C.concat();let Q=!0;for(let se=0;se<C.length;++se){const Ie=C[se];if(Ie&&!Ie.da&&Ie.capture==$){const yt=Ie.listener,Vn=Ie.ha||Ie.src;Ie.fa&&de(b.i,Ie),Q=yt.call(Vn,M)!==!1&&Q}}return Q&&!M.defaultPrevented}function Ps(b,C){if(typeof b!="function")if(b&&typeof b.handleEvent=="function")b=c(b.handleEvent,b);else throw Error("Invalid listener argument");return Number(C)>2147483647?-1:o.setTimeout(b,C||0)}function qt(b){b.g=Ps(()=>{b.g=null,b.i&&(b.i=!1,qt(b))},b.l);const C=b.h;b.h=null,b.m.apply(null,C)}class Yn extends S{constructor(C,$){super(),this.m=C,this.l=$,this.h=null,this.i=!1,this.g=null}j(C){this.h=arguments,this.g?this.i=!0:qt(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ie(b){S.call(this),this.h=b,this.g={}}h(ie,S);var fe=[];function ze(b){ee(b.g,function(C,$){this.g.hasOwnProperty($)&&Et(C)},b),b.g={}}ie.prototype.N=function(){ie.Z.N.call(this),ze(this)},ie.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ke=o.JSON.stringify,ne=o.JSON.parse,Z=class{stringify(b){return o.JSON.stringify(b,void 0)}parse(b){return o.JSON.parse(b,void 0)}};function ye(){}function Le(){}var nt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Lt(){A.call(this,"d")}h(Lt,A);function lt(){A.call(this,"c")}h(lt,A);var Wt={},Mt=null;function Qs(){return Mt=Mt||new at}Wt.Ia="serverreachability";function bs(b){A.call(this,Wt.Ia,b)}h(bs,A);function Uo(b){const C=Qs();zt(C,new bs(C))}Wt.STAT_EVENT="statevent";function $c(b,C){A.call(this,Wt.STAT_EVENT,b),this.stat=C}h($c,A);function Jt(b){const C=Qs();zt(C,new $c(C,b))}Wt.Ja="timingevent";function ro(b,C){A.call(this,Wt.Ja,b),this.size=C}h(ro,A);function Dc(b,C){if(typeof b!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){b()},C)}function Pc(){this.g=!0}Pc.prototype.ua=function(){this.g=!1};function ON(b,C,$,M,Q,se){b.info(function(){if(b.g)if(se){var Ie="",yt=se.split("&");for(let Kt=0;Kt<yt.length;Kt++){var Vn=yt[Kt].split("=");if(Vn.length>1){const Qn=Vn[0];Vn=Vn[1];const Ei=Qn.split("_");Ie=Ei.length>=2&&Ei[1]=="type"?Ie+(Qn+"="+Vn+"&"):Ie+(Qn+"=redacted&")}}}else Ie=null;else Ie=se;return"XMLHTTP REQ ("+M+") [attempt "+Q+"]: "+C+`
`+$+`
`+Ie})}function FN(b,C,$,M,Q,se,Ie){b.info(function(){return"XMLHTTP RESP ("+M+") [ attempt "+Q+"]: "+C+`
`+$+`
`+se+" "+Ie})}function Wo(b,C,$,M){b.info(function(){return"XMLHTTP TEXT ("+C+"): "+iG(b,$)+(M?" "+M:"")})}function pd(b,C){b.info(function(){return"TIMEOUT: "+C})}Pc.prototype.info=function(){};function iG(b,C){if(!b.g)return C;if(!C)return null;try{const se=JSON.parse(C);if(se){for(b=0;b<se.length;b++)if(Array.isArray(se[b])){var $=se[b];if(!($.length<2)){var M=$[1];if(Array.isArray(M)&&!(M.length<1)){var Q=M[0];if(Q!="noop"&&Q!="stop"&&Q!="close")for(let Ie=1;Ie<M.length;Ie++)M[Ie]=""}}}}return Ke(se)}catch{return C}}var vg={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},LN={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},MN;function uv(){}h(uv,ye),uv.prototype.g=function(){return new XMLHttpRequest},MN=new uv;function fd(b){return encodeURIComponent(String(b))}function oG(b){var C=1;b=b.split(":");const $=[];for(;C>0&&b.length;)$.push(b.shift()),C--;return b.length&&$.push(b.join(":")),$}function Go(b,C,$,M){this.j=b,this.i=C,this.l=$,this.S=M||1,this.V=new ie(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new zN}function zN(){this.i=null,this.g="",this.h=!1}var VN={},hv={};function dv(b,C,$){b.M=1,b.A=Sg(Ci(C)),b.u=$,b.R=!0,BN(b,null)}function BN(b,C){b.F=Date.now(),Ig(b),b.B=Ci(b.A);var $=b.B,M=b.S;Array.isArray(M)||(M=[String(M)]),eA($.i,"t",M),b.C=0,$=b.j.L,b.h=new zN,b.g=bA(b.j,$?C:null,!b.u),b.P>0&&(b.O=new Yn(c(b.Y,b,b.g),b.P)),C=b.V,$=b.g,M=b.ba;var Q="readystatechange";Array.isArray(Q)||(Q&&(fe[0]=Q.toString()),Q=fe);for(let se=0;se<Q.length;se++){const Ie=_e($,Q[se],M||C.handleEvent,!1,C.h||C);if(!Ie)break;C.g[Ie.key]=Ie}C=b.J?ae(b.J):{},b.u?(b.v||(b.v="POST"),C["Content-Type"]="application/x-www-form-urlencoded",b.g.ea(b.B,b.v,b.u,C)):(b.v="GET",b.g.ea(b.B,b.v,null,C)),Uo(),ON(b.i,b.v,b.B,b.l,b.S,b.u)}Go.prototype.ba=function(b){b=b.target;const C=this.O;C&&Ko(b)==3?C.j():this.Y(b)},Go.prototype.Y=function(b){try{if(b==this.g)e:{const yt=Ko(this.g),Vn=this.g.ya(),Kt=this.g.ca();if(!(yt<3)&&(yt!=3||this.g&&(this.h.h||this.g.la()||aA(this.g)))){this.K||yt!=4||Vn==7||(Vn==8||Kt<=0?Uo(3):Uo(2)),pv(this);var C=this.g.ca();this.X=C;var $=aG(this);if(this.o=C==200,FN(this.i,this.v,this.B,this.l,this.S,yt,C),this.o){if(this.U&&!this.L){t:{if(this.g){var M,Q=this.g;if((M=Q.g?Q.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!D(M)){var se=M;break t}}se=null}if(b=se)Wo(this.i,this.l,b,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,fv(this,b);else{this.o=!1,this.m=3,Jt(12),Za(this),md(this);break e}}if(this.R){b=!0;let Qn;for(;!this.K&&this.C<$.length;)if(Qn=lG(this,$),Qn==hv){yt==4&&(this.m=4,Jt(14),b=!1),Wo(this.i,this.l,null,"[Incomplete Response]");break}else if(Qn==VN){this.m=4,Jt(15),Wo(this.i,this.l,$,"[Invalid Chunk]"),b=!1;break}else Wo(this.i,this.l,Qn,null),fv(this,Qn);if(jN(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),yt!=4||$.length!=0||this.h.h||(this.m=1,Jt(16),b=!1),this.o=this.o&&b,!b)Wo(this.i,this.l,$,"[Invalid Chunked Response]"),Za(this),md(this);else if($.length>0&&!this.W){this.W=!0;var Ie=this.j;Ie.g==this&&Ie.aa&&!Ie.P&&(Ie.j.info("Great, no buffering proxy detected. Bytes received: "+$.length),Iv(Ie),Ie.P=!0,Jt(11))}}else Wo(this.i,this.l,$,null),fv(this,$);yt==4&&Za(this),this.o&&!this.K&&(yt==4?fA(this.j,this):(this.o=!1,Ig(this)))}else IG(this.g),C==400&&$.indexOf("Unknown SID")>0?(this.m=3,Jt(12)):(this.m=0,Jt(13)),Za(this),md(this)}}}catch{}finally{}};function aG(b){if(!jN(b))return b.g.la();const C=aA(b.g);if(C==="")return"";let $="";const M=C.length,Q=Ko(b.g)==4;if(!b.h.i){if(typeof TextDecoder>"u")return Za(b),md(b),"";b.h.i=new o.TextDecoder}for(let se=0;se<M;se++)b.h.h=!0,$+=b.h.i.decode(C[se],{stream:!(Q&&se==M-1)});return C.length=0,b.h.g+=$,b.C=0,b.h.g}function jN(b){return b.g?b.v=="GET"&&b.M!=2&&b.j.Aa:!1}function lG(b,C){var $=b.C,M=C.indexOf(`
`,$);return M==-1?hv:($=Number(C.substring($,M)),isNaN($)?VN:(M+=1,M+$>C.length?hv:(C=C.slice(M,M+$),b.C=M+$,C)))}Go.prototype.cancel=function(){this.K=!0,Za(this)};function Ig(b){b.T=Date.now()+b.H,UN(b,b.H)}function UN(b,C){if(b.D!=null)throw Error("WatchDog timer not null");b.D=Dc(c(b.aa,b),C)}function pv(b){b.D&&(o.clearTimeout(b.D),b.D=null)}Go.prototype.aa=function(){this.D=null;const b=Date.now();b-this.T>=0?(pd(this.i,this.B),this.M!=2&&(Uo(),Jt(17)),Za(this),this.m=2,md(this)):UN(this,this.T-b)};function md(b){b.j.I==0||b.K||fA(b.j,b)}function Za(b){pv(b);var C=b.O;C&&typeof C.dispose=="function"&&C.dispose(),b.O=null,ze(b.V),b.g&&(C=b.g,b.g=null,C.abort(),C.dispose())}function fv(b,C){try{var $=b.j;if($.I!=0&&($.g==b||mv($.h,b))){if(!b.L&&mv($.h,b)&&$.I==3){try{var M=$.Ba.g.parse(C)}catch{M=null}if(Array.isArray(M)&&M.length==3){var Q=M;if(Q[0]==0){e:if(!$.v){if($.g)if($.g.F+3e3<b.F)_g($),Cg($);else break e;vv($),Jt(18)}}else $.xa=Q[1],0<$.xa-$.K&&Q[2]<37500&&$.F&&$.A==0&&!$.C&&($.C=Dc(c($.Va,$),6e3));HN($.h)<=1&&$.ta&&($.ta=void 0)}else el($,11)}else if((b.L||$.g==b)&&_g($),!D(C))for(Q=$.Ba.g.parse(C),C=0;C<Q.length;C++){let Kt=Q[C];const Qn=Kt[0];if(!(Qn<=$.K))if($.K=Qn,Kt=Kt[1],$.I==2)if(Kt[0]=="c"){$.M=Kt[1],$.ba=Kt[2];const Ei=Kt[3];Ei!=null&&($.ka=Ei,$.j.info("VER="+$.ka));const tl=Kt[4];tl!=null&&($.za=tl,$.j.info("SVER="+$.za));const Xo=Kt[5];Xo!=null&&typeof Xo=="number"&&Xo>0&&(M=1.5*Xo,$.O=M,$.j.info("backChannelRequestTimeoutMs_="+M)),M=$;const Yo=b.g;if(Yo){const Ag=Yo.g?Yo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ag){var se=M.h;se.g||Ag.indexOf("spdy")==-1&&Ag.indexOf("quic")==-1&&Ag.indexOf("h2")==-1||(se.j=se.l,se.g=new Set,se.h&&(gv(se,se.h),se.h=null))}if(M.G){const Sv=Yo.g?Yo.g.getResponseHeader("X-HTTP-Session-Id"):null;Sv&&(M.wa=Sv,sn(M.J,M.G,Sv))}}$.I=3,$.l&&$.l.ra(),$.aa&&($.T=Date.now()-b.F,$.j.info("Handshake RTT: "+$.T+"ms")),M=$;var Ie=b;if(M.na=yA(M,M.L?M.ba:null,M.W),Ie.L){qN(M.h,Ie);var yt=Ie,Vn=M.O;Vn&&(yt.H=Vn),yt.D&&(pv(yt),Ig(yt)),M.g=Ie}else dA(M);$.i.length>0&&Eg($)}else Kt[0]!="stop"&&Kt[0]!="close"||el($,7);else $.I==3&&(Kt[0]=="stop"||Kt[0]=="close"?Kt[0]=="stop"?el($,7):wv($):Kt[0]!="noop"&&$.l&&$.l.qa(Kt),$.A=0)}}Uo(4)}catch{}}var cG=class{constructor(b,C){this.g=b,this.map=C}};function WN(b){this.l=b||10,o.PerformanceNavigationTiming?(b=o.performance.getEntriesByType("navigation"),b=b.length>0&&(b[0].nextHopProtocol=="hq"||b[0].nextHopProtocol=="h2")):b=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=b?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function GN(b){return b.h?!0:b.g?b.g.size>=b.j:!1}function HN(b){return b.h?1:b.g?b.g.size:0}function mv(b,C){return b.h?b.h==C:b.g?b.g.has(C):!1}function gv(b,C){b.g?b.g.add(C):b.h=C}function qN(b,C){b.h&&b.h==C?b.h=null:b.g&&b.g.has(C)&&b.g.delete(C)}WN.prototype.cancel=function(){if(this.i=KN(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const b of this.g.values())b.cancel();this.g.clear()}};function KN(b){if(b.h!=null)return b.i.concat(b.h.G);if(b.g!=null&&b.g.size!==0){let C=b.i;for(const $ of b.g.values())C=C.concat($.G);return C}return p(b.i)}var XN=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function uG(b,C){if(b){b=b.split("&");for(let $=0;$<b.length;$++){const M=b[$].indexOf("=");let Q,se=null;M>=0?(Q=b[$].substring(0,M),se=b[$].substring(M+1)):Q=b[$],C(Q,se?decodeURIComponent(se.replace(/\+/g," ")):"")}}}function Ho(b){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let C;b instanceof Ho?(this.l=b.l,gd(this,b.j),this.o=b.o,this.g=b.g,yd(this,b.u),this.h=b.h,yv(this,tA(b.i)),this.m=b.m):b&&(C=String(b).match(XN))?(this.l=!1,gd(this,C[1]||"",!0),this.o=bd(C[2]||""),this.g=bd(C[3]||"",!0),yd(this,C[4]),this.h=bd(C[5]||"",!0),yv(this,C[6]||"",!0),this.m=bd(C[7]||"")):(this.l=!1,this.i=new wd(null,this.l))}Ho.prototype.toString=function(){const b=[];var C=this.j;C&&b.push(xd(C,YN,!0),":");var $=this.g;return($||C=="file")&&(b.push("//"),(C=this.o)&&b.push(xd(C,YN,!0),"@"),b.push(fd($).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),$=this.u,$!=null&&b.push(":",String($))),($=this.h)&&(this.g&&$.charAt(0)!="/"&&b.push("/"),b.push(xd($,$.charAt(0)=="/"?pG:dG,!0))),($=this.i.toString())&&b.push("?",$),($=this.m)&&b.push("#",xd($,mG)),b.join("")},Ho.prototype.resolve=function(b){const C=Ci(this);let $=!!b.j;$?gd(C,b.j):$=!!b.o,$?C.o=b.o:$=!!b.g,$?C.g=b.g:$=b.u!=null;var M=b.h;if($)yd(C,b.u);else if($=!!b.h){if(M.charAt(0)!="/")if(this.g&&!this.h)M="/"+M;else{var Q=C.h.lastIndexOf("/");Q!=-1&&(M=C.h.slice(0,Q+1)+M)}if(Q=M,Q==".."||Q==".")M="";else if(Q.indexOf("./")!=-1||Q.indexOf("/.")!=-1){M=Q.lastIndexOf("/",0)==0,Q=Q.split("/");const se=[];for(let Ie=0;Ie<Q.length;){const yt=Q[Ie++];yt=="."?M&&Ie==Q.length&&se.push(""):yt==".."?((se.length>1||se.length==1&&se[0]!="")&&se.pop(),M&&Ie==Q.length&&se.push("")):(se.push(yt),M=!0)}M=se.join("/")}else M=Q}return $?C.h=M:$=b.i.toString()!=="",$?yv(C,tA(b.i)):$=!!b.m,$&&(C.m=b.m),C};function Ci(b){return new Ho(b)}function gd(b,C,$){b.j=$?bd(C,!0):C,b.j&&(b.j=b.j.replace(/:$/,""))}function yd(b,C){if(C){if(C=Number(C),isNaN(C)||C<0)throw Error("Bad port number "+C);b.u=C}else b.u=null}function yv(b,C,$){C instanceof wd?(b.i=C,gG(b.i,b.l)):($||(C=xd(C,fG)),b.i=new wd(C,b.l))}function sn(b,C,$){b.i.set(C,$)}function Sg(b){return sn(b,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),b}function bd(b,C){return b?C?decodeURI(b.replace(/%25/g,"%2525")):decodeURIComponent(b):""}function xd(b,C,$){return typeof b=="string"?(b=encodeURI(b).replace(C,hG),$&&(b=b.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),b):null}function hG(b){return b=b.charCodeAt(0),"%"+(b>>4&15).toString(16)+(b&15).toString(16)}var YN=/[#\/\?@]/g,dG=/[#\?:]/g,pG=/[#\?]/g,fG=/[#\?@]/g,mG=/#/g;function wd(b,C){this.h=this.g=null,this.i=b||null,this.j=!!C}function Ja(b){b.g||(b.g=new Map,b.h=0,b.i&&uG(b.i,function(C,$){b.add(decodeURIComponent(C.replace(/\+/g," ")),$)}))}n=wd.prototype,n.add=function(b,C){Ja(this),this.i=null,b=Oc(this,b);let $=this.g.get(b);return $||this.g.set(b,$=[]),$.push(C),this.h+=1,this};function QN(b,C){Ja(b),C=Oc(b,C),b.g.has(C)&&(b.i=null,b.h-=b.g.get(C).length,b.g.delete(C))}function ZN(b,C){return Ja(b),C=Oc(b,C),b.g.has(C)}n.forEach=function(b,C){Ja(this),this.g.forEach(function($,M){$.forEach(function(Q){b.call(C,Q,M,this)},this)},this)};function JN(b,C){Ja(b);let $=[];if(typeof C=="string")ZN(b,C)&&($=$.concat(b.g.get(Oc(b,C))));else for(b=Array.from(b.g.values()),C=0;C<b.length;C++)$=$.concat(b[C]);return $}n.set=function(b,C){return Ja(this),this.i=null,b=Oc(this,b),ZN(this,b)&&(this.h-=this.g.get(b).length),this.g.set(b,[C]),this.h+=1,this},n.get=function(b,C){return b?(b=JN(this,b),b.length>0?String(b[0]):C):C};function eA(b,C,$){QN(b,C),$.length>0&&(b.i=null,b.g.set(Oc(b,C),p($)),b.h+=$.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const b=[],C=Array.from(this.g.keys());for(let M=0;M<C.length;M++){var $=C[M];const Q=fd($);$=JN(this,$);for(let se=0;se<$.length;se++){let Ie=Q;$[se]!==""&&(Ie+="="+fd($[se])),b.push(Ie)}}return this.i=b.join("&")};function tA(b){const C=new wd;return C.i=b.i,b.g&&(C.g=new Map(b.g),C.h=b.h),C}function Oc(b,C){return C=String(C),b.j&&(C=C.toLowerCase()),C}function gG(b,C){C&&!b.j&&(Ja(b),b.i=null,b.g.forEach(function($,M){const Q=M.toLowerCase();M!=Q&&(QN(this,M),eA(this,Q,$))},b)),b.j=C}function yG(b,C){const $=new Pc;if(o.Image){const M=new Image;M.onload=u(qo,$,"TestLoadImage: loaded",!0,C,M),M.onerror=u(qo,$,"TestLoadImage: error",!1,C,M),M.onabort=u(qo,$,"TestLoadImage: abort",!1,C,M),M.ontimeout=u(qo,$,"TestLoadImage: timeout",!1,C,M),o.setTimeout(function(){M.ontimeout&&M.ontimeout()},1e4),M.src=b}else C(!1)}function bG(b,C){const $=new Pc,M=new AbortController,Q=setTimeout(()=>{M.abort(),qo($,"TestPingServer: timeout",!1,C)},1e4);fetch(b,{signal:M.signal}).then(se=>{clearTimeout(Q),se.ok?qo($,"TestPingServer: ok",!0,C):qo($,"TestPingServer: server error",!1,C)}).catch(()=>{clearTimeout(Q),qo($,"TestPingServer: error",!1,C)})}function qo(b,C,$,M,Q){try{Q&&(Q.onload=null,Q.onerror=null,Q.onabort=null,Q.ontimeout=null),M($)}catch{}}function xG(){this.g=new Z}function bv(b){this.i=b.Sb||null,this.h=b.ab||!1}h(bv,ye),bv.prototype.g=function(){return new kg(this.i,this.h)};function kg(b,C){at.call(this),this.H=b,this.o=C,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}h(kg,at),n=kg.prototype,n.open=function(b,C){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=b,this.D=C,this.readyState=1,Id(this)},n.send=function(b){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const C={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};b&&(C.body=b),(this.H||o).fetch(new Request(this.D,C)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,vd(this)),this.readyState=0},n.Pa=function(b){if(this.g&&(this.l=b,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=b.headers,this.readyState=2,Id(this)),this.g&&(this.readyState=3,Id(this),this.g)))if(this.responseType==="arraybuffer")b.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in b){if(this.j=b.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;nA(this)}else b.text().then(this.Oa.bind(this),this.ga.bind(this))};function nA(b){b.j.read().then(b.Ma.bind(b)).catch(b.ga.bind(b))}n.Ma=function(b){if(this.g){if(this.o&&b.value)this.response.push(b.value);else if(!this.o){var C=b.value?b.value:new Uint8Array(0);(C=this.B.decode(C,{stream:!b.done}))&&(this.response=this.responseText+=C)}b.done?vd(this):Id(this),this.readyState==3&&nA(this)}},n.Oa=function(b){this.g&&(this.response=this.responseText=b,vd(this))},n.Na=function(b){this.g&&(this.response=b,vd(this))},n.ga=function(){this.g&&vd(this)};function vd(b){b.readyState=4,b.l=null,b.j=null,b.B=null,Id(b)}n.setRequestHeader=function(b,C){this.A.append(b,C)},n.getResponseHeader=function(b){return this.h&&this.h.get(b.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const b=[],C=this.h.entries();for(var $=C.next();!$.done;)$=$.value,b.push($[0]+": "+$[1]),$=C.next();return b.join(`\r
`)};function Id(b){b.onreadystatechange&&b.onreadystatechange.call(b)}Object.defineProperty(kg.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(b){this.m=b?"include":"same-origin"}});function sA(b){let C="";return ee(b,function($,M){C+=M,C+=":",C+=$,C+=`\r
`}),C}function xv(b,C,$){e:{for(M in $){var M=!1;break e}M=!0}M||($=sA($),typeof b=="string"?$!=null&&fd($):sn(b,C,$))}function bn(b){at.call(this),this.headers=new Map,this.L=b||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}h(bn,at);var wG=/^https?$/i,vG=["POST","PUT"];n=bn.prototype,n.Fa=function(b){this.H=b},n.ea=function(b,C,$,M){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+b);C=C?C.toUpperCase():"GET",this.D=b,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():MN.g(),this.g.onreadystatechange=d(c(this.Ca,this));try{this.B=!0,this.g.open(C,String(b),!0),this.B=!1}catch(se){rA(this,se);return}if(b=$||"",$=new Map(this.headers),M)if(Object.getPrototypeOf(M)===Object.prototype)for(var Q in M)$.set(Q,M[Q]);else if(typeof M.keys=="function"&&typeof M.get=="function")for(const se of M.keys())$.set(se,M.get(se));else throw Error("Unknown input type for opt_headers: "+String(M));M=Array.from($.keys()).find(se=>se.toLowerCase()=="content-type"),Q=o.FormData&&b instanceof o.FormData,!(Array.prototype.indexOf.call(vG,C,void 0)>=0)||M||Q||$.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[se,Ie]of $)this.g.setRequestHeader(se,Ie);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(b),this.v=!1}catch(se){rA(this,se)}};function rA(b,C){b.h=!1,b.g&&(b.j=!0,b.g.abort(),b.j=!1),b.l=C,b.o=5,iA(b),Tg(b)}function iA(b){b.A||(b.A=!0,zt(b,"complete"),zt(b,"error"))}n.abort=function(b){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=b||7,zt(this,"complete"),zt(this,"abort"),Tg(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Tg(this,!0)),bn.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?oA(this):this.Xa())},n.Xa=function(){oA(this)};function oA(b){if(b.h&&typeof i<"u"){if(b.v&&Ko(b)==4)setTimeout(b.Ca.bind(b),0);else if(zt(b,"readystatechange"),Ko(b)==4){b.h=!1;try{const se=b.ca();e:switch(se){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var C=!0;break e;default:C=!1}var $;if(!($=C)){var M;if(M=se===0){let Ie=String(b.D).match(XN)[1]||null;!Ie&&o.self&&o.self.location&&(Ie=o.self.location.protocol.slice(0,-1)),M=!wG.test(Ie?Ie.toLowerCase():"")}$=M}if($)zt(b,"complete"),zt(b,"success");else{b.o=6;try{var Q=Ko(b)>2?b.g.statusText:""}catch{Q=""}b.l=Q+" ["+b.ca()+"]",iA(b)}}finally{Tg(b)}}}}function Tg(b,C){if(b.g){b.m&&(clearTimeout(b.m),b.m=null);const $=b.g;b.g=null,C||zt(b,"ready");try{$.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Ko(b){return b.g?b.g.readyState:0}n.ca=function(){try{return Ko(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(b){if(this.g){var C=this.g.responseText;return b&&C.indexOf(b)==0&&(C=C.substring(b.length)),ne(C)}};function aA(b){try{if(!b.g)return null;if("response"in b.g)return b.g.response;switch(b.F){case"":case"text":return b.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in b.g)return b.g.mozResponseArrayBuffer}return null}catch{return null}}function IG(b){const C={};b=(b.g&&Ko(b)>=2&&b.g.getAllResponseHeaders()||"").split(`\r
`);for(let M=0;M<b.length;M++){if(D(b[M]))continue;var $=oG(b[M]);const Q=$[0];if($=$[1],typeof $!="string")continue;$=$.trim();const se=C[Q]||[];C[Q]=se,se.push($)}L(C,function(M){return M.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Sd(b,C,$){return $&&$.internalChannelParams&&$.internalChannelParams[b]||C}function lA(b){this.za=0,this.i=[],this.j=new Pc,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Sd("failFast",!1,b),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Sd("baseRetryDelayMs",5e3,b),this.Za=Sd("retryDelaySeedMs",1e4,b),this.Ta=Sd("forwardChannelMaxRetries",2,b),this.va=Sd("forwardChannelRequestTimeoutMs",2e4,b),this.ma=b&&b.xmlHttpFactory||void 0,this.Ua=b&&b.Rb||void 0,this.Aa=b&&b.useFetchStreams||!1,this.O=void 0,this.L=b&&b.supportsCrossDomainXhr||!1,this.M="",this.h=new WN(b&&b.concurrentRequestLimit),this.Ba=new xG,this.S=b&&b.fastHandshake||!1,this.R=b&&b.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=b&&b.Pb||!1,b&&b.ua&&this.j.ua(),b&&b.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&b&&b.detectBufferingProxy||!1,this.ia=void 0,b&&b.longPollingTimeout&&b.longPollingTimeout>0&&(this.ia=b.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=lA.prototype,n.ka=8,n.I=1,n.connect=function(b,C,$,M){Jt(0),this.W=b,this.H=C||{},$&&M!==void 0&&(this.H.OSID=$,this.H.OAID=M),this.F=this.X,this.J=yA(this,null,this.W),Eg(this)};function wv(b){if(cA(b),b.I==3){var C=b.V++,$=Ci(b.J);if(sn($,"SID",b.M),sn($,"RID",C),sn($,"TYPE","terminate"),kd(b,$),C=new Go(b,b.j,C),C.M=2,C.A=Sg(Ci($)),$=!1,o.navigator&&o.navigator.sendBeacon)try{$=o.navigator.sendBeacon(C.A.toString(),"")}catch{}!$&&o.Image&&(new Image().src=C.A,$=!0),$||(C.g=bA(C.j,null),C.g.ea(C.A)),C.F=Date.now(),Ig(C)}gA(b)}function Cg(b){b.g&&(Iv(b),b.g.cancel(),b.g=null)}function cA(b){Cg(b),b.v&&(o.clearTimeout(b.v),b.v=null),_g(b),b.h.cancel(),b.m&&(typeof b.m=="number"&&o.clearTimeout(b.m),b.m=null)}function Eg(b){if(!GN(b.h)&&!b.m){b.m=!0;var C=b.Ea;_||E(),N||(_(),N=!0),T.add(C,b),b.D=0}}function SG(b,C){return HN(b.h)>=b.h.j-(b.m?1:0)?!1:b.m?(b.i=C.G.concat(b.i),!0):b.I==1||b.I==2||b.D>=(b.Sa?0:b.Ta)?!1:(b.m=Dc(c(b.Ea,b,C),mA(b,b.D)),b.D++,!0)}n.Ea=function(b){if(this.m)if(this.m=null,this.I==1){if(!b){this.V=Math.floor(Math.random()*1e5),b=this.V++;const Q=new Go(this,this.j,b);let se=this.o;if(this.U&&(se?(se=ae(se),z(se,this.U)):se=this.U),this.u!==null||this.R||(Q.J=se,se=null),this.S)e:{for(var C=0,$=0;$<this.i.length;$++){t:{var M=this.i[$];if("__data__"in M.map&&(M=M.map.__data__,typeof M=="string")){M=M.length;break t}M=void 0}if(M===void 0)break;if(C+=M,C>4096){C=$;break e}if(C===4096||$===this.i.length-1){C=$+1;break e}}C=1e3}else C=1e3;C=hA(this,Q,C),$=Ci(this.J),sn($,"RID",b),sn($,"CVER",22),this.G&&sn($,"X-HTTP-Session-Id",this.G),kd(this,$),se&&(this.R?C="headers="+fd(sA(se))+"&"+C:this.u&&xv($,this.u,se)),gv(this.h,Q),this.Ra&&sn($,"TYPE","init"),this.S?(sn($,"$req",C),sn($,"SID","null"),Q.U=!0,dv(Q,$,null)):dv(Q,$,C),this.I=2}}else this.I==3&&(b?uA(this,b):this.i.length==0||GN(this.h)||uA(this))};function uA(b,C){var $;C?$=C.l:$=b.V++;const M=Ci(b.J);sn(M,"SID",b.M),sn(M,"RID",$),sn(M,"AID",b.K),kd(b,M),b.u&&b.o&&xv(M,b.u,b.o),$=new Go(b,b.j,$,b.D+1),b.u===null&&($.J=b.o),C&&(b.i=C.G.concat(b.i)),C=hA(b,$,1e3),$.H=Math.round(b.va*.5)+Math.round(b.va*.5*Math.random()),gv(b.h,$),dv($,M,C)}function kd(b,C){b.H&&ee(b.H,function($,M){sn(C,M,$)}),b.l&&ee({},function($,M){sn(C,M,$)})}function hA(b,C,$){$=Math.min(b.i.length,$);const M=b.l?c(b.l.Ka,b.l,b):null;e:{var Q=b.i;let yt=-1;for(;;){const Vn=["count="+$];yt==-1?$>0?(yt=Q[0].g,Vn.push("ofs="+yt)):yt=0:Vn.push("ofs="+yt);let Kt=!0;for(let Qn=0;Qn<$;Qn++){var se=Q[Qn].g;const Ei=Q[Qn].map;if(se-=yt,se<0)yt=Math.max(0,Q[Qn].g-100),Kt=!1;else try{se="req"+se+"_"||"";try{var Ie=Ei instanceof Map?Ei:Object.entries(Ei);for(const[tl,Xo]of Ie){let Yo=Xo;a(Xo)&&(Yo=Ke(Xo)),Vn.push(se+tl+"="+encodeURIComponent(Yo))}}catch(tl){throw Vn.push(se+"type="+encodeURIComponent("_badmap")),tl}}catch{M&&M(Ei)}}if(Kt){Ie=Vn.join("&");break e}}Ie=void 0}return b=b.i.splice(0,$),C.G=b,Ie}function dA(b){if(!b.g&&!b.v){b.Y=1;var C=b.Da;_||E(),N||(_(),N=!0),T.add(C,b),b.A=0}}function vv(b){return b.g||b.v||b.A>=3?!1:(b.Y++,b.v=Dc(c(b.Da,b),mA(b,b.A)),b.A++,!0)}n.Da=function(){if(this.v=null,pA(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var b=4*this.T;this.j.info("BP detection timer enabled: "+b),this.B=Dc(c(this.Wa,this),b)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Jt(10),Cg(this),pA(this))};function Iv(b){b.B!=null&&(o.clearTimeout(b.B),b.B=null)}function pA(b){b.g=new Go(b,b.j,"rpc",b.Y),b.u===null&&(b.g.J=b.o),b.g.P=0;var C=Ci(b.na);sn(C,"RID","rpc"),sn(C,"SID",b.M),sn(C,"AID",b.K),sn(C,"CI",b.F?"0":"1"),!b.F&&b.ia&&sn(C,"TO",b.ia),sn(C,"TYPE","xmlhttp"),kd(b,C),b.u&&b.o&&xv(C,b.u,b.o),b.O&&(b.g.H=b.O);var $=b.g;b=b.ba,$.M=1,$.A=Sg(Ci(C)),$.u=null,$.R=!0,BN($,b)}n.Va=function(){this.C!=null&&(this.C=null,Cg(this),vv(this),Jt(19))};function _g(b){b.C!=null&&(o.clearTimeout(b.C),b.C=null)}function fA(b,C){var $=null;if(b.g==C){_g(b),Iv(b),b.g=null;var M=2}else if(mv(b.h,C))$=C.G,qN(b.h,C),M=1;else return;if(b.I!=0){if(C.o)if(M==1){$=C.u?C.u.length:0,C=Date.now()-C.F;var Q=b.D;M=Qs(),zt(M,new ro(M,$)),Eg(b)}else dA(b);else if(Q=C.m,Q==3||Q==0&&C.X>0||!(M==1&&SG(b,C)||M==2&&vv(b)))switch($&&$.length>0&&(C=b.h,C.i=C.i.concat($)),Q){case 1:el(b,5);break;case 4:el(b,10);break;case 3:el(b,6);break;default:el(b,2)}}}function mA(b,C){let $=b.Qa+Math.floor(Math.random()*b.Za);return b.isActive()||($*=2),$*C}function el(b,C){if(b.j.info("Error code "+C),C==2){var $=c(b.bb,b),M=b.Ua;const Q=!M;M=new Ho(M||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||gd(M,"https"),Sg(M),Q?yG(M.toString(),$):bG(M.toString(),$)}else Jt(2);b.I=0,b.l&&b.l.pa(C),gA(b),cA(b)}n.bb=function(b){b?(this.j.info("Successfully pinged google.com"),Jt(2)):(this.j.info("Failed to ping google.com"),Jt(1))};function gA(b){if(b.I=0,b.ja=[],b.l){const C=KN(b.h);(C.length!=0||b.i.length!=0)&&(f(b.ja,C),f(b.ja,b.i),b.h.i.length=0,p(b.i),b.i.length=0),b.l.oa()}}function yA(b,C,$){var M=$ instanceof Ho?Ci($):new Ho($);if(M.g!="")C&&(M.g=C+"."+M.g),yd(M,M.u);else{var Q=o.location;M=Q.protocol,C=C?C+"."+Q.hostname:Q.hostname,Q=+Q.port;const se=new Ho(null);M&&gd(se,M),C&&(se.g=C),Q&&yd(se,Q),$&&(se.h=$),M=se}return $=b.G,C=b.wa,$&&C&&sn(M,$,C),sn(M,"VER",b.ka),kd(b,M),M}function bA(b,C,$){if(C&&!b.L)throw Error("Can't create secondary domain capable XhrIo object.");return C=b.Aa&&!b.ma?new bn(new bv({ab:$})):new bn(b.ma),C.Fa(b.L),C}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function xA(){}n=xA.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Ng(){}Ng.prototype.g=function(b,C){return new fr(b,C)};function fr(b,C){at.call(this),this.g=new lA(C),this.l=b,this.h=C&&C.messageUrlParams||null,b=C&&C.messageHeaders||null,C&&C.clientProtocolHeaderRequired&&(b?b["X-Client-Protocol"]="webchannel":b={"X-Client-Protocol":"webchannel"}),this.g.o=b,b=C&&C.initMessageHeaders||null,C&&C.messageContentType&&(b?b["X-WebChannel-Content-Type"]=C.messageContentType:b={"X-WebChannel-Content-Type":C.messageContentType}),C&&C.sa&&(b?b["X-WebChannel-Client-Profile"]=C.sa:b={"X-WebChannel-Client-Profile":C.sa}),this.g.U=b,(b=C&&C.Qb)&&!D(b)&&(this.g.u=b),this.A=C&&C.supportsCrossDomainXhr||!1,this.v=C&&C.sendRawJson||!1,(C=C&&C.httpSessionIdParam)&&!D(C)&&(this.g.G=C,b=this.h,b!==null&&C in b&&(b=this.h,C in b&&delete b[C])),this.j=new Fc(this)}h(fr,at),fr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},fr.prototype.close=function(){wv(this.g)},fr.prototype.o=function(b){var C=this.g;if(typeof b=="string"){var $={};$.__data__=b,b=$}else this.v&&($={},$.__data__=Ke(b),b=$);C.i.push(new cG(C.Ya++,b)),C.I==3&&Eg(C)},fr.prototype.N=function(){this.g.l=null,delete this.j,wv(this.g),delete this.g,fr.Z.N.call(this)};function wA(b){Lt.call(this),b.__headers__&&(this.headers=b.__headers__,this.statusCode=b.__status__,delete b.__headers__,delete b.__status__);var C=b.__sm__;if(C){e:{for(const $ in C){b=$;break e}b=void 0}(this.i=b)&&(b=this.i,C=C!==null&&b in C?C[b]:void 0),this.data=C}else this.data=b}h(wA,Lt);function vA(){lt.call(this),this.status=1}h(vA,lt);function Fc(b){this.g=b}h(Fc,xA),Fc.prototype.ra=function(){zt(this.g,"a")},Fc.prototype.qa=function(b){zt(this.g,new wA(b))},Fc.prototype.pa=function(b){zt(this.g,new vA)},Fc.prototype.oa=function(){zt(this.g,"b")},Ng.prototype.createWebChannel=Ng.prototype.g,fr.prototype.send=fr.prototype.o,fr.prototype.open=fr.prototype.m,fr.prototype.close=fr.prototype.close,tU=function(){return new Ng},eU=function(){return Qs()},Jj=Wt,vS={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},vg.NO_ERROR=0,vg.TIMEOUT=8,vg.HTTP_ERROR=6,Ry=vg,LN.COMPLETE="complete",Zj=LN,Le.EventType=nt,nt.OPEN="a",nt.CLOSE="b",nt.ERROR="c",nt.MESSAGE="d",at.prototype.listen=at.prototype.J,Qd=Le,bn.prototype.listenOnce=bn.prototype.K,bn.prototype.getLastError=bn.prototype.Ha,bn.prototype.getLastErrorCode=bn.prototype.ya,bn.prototype.getStatus=bn.prototype.ca,bn.prototype.getResponseJson=bn.prototype.La,bn.prototype.getResponseText=bn.prototype.la,bn.prototype.send=bn.prototype.ea,bn.prototype.setWithCredentials=bn.prototype.Fa,Qj=bn}).apply(typeof ey<"u"?ey:typeof self<"u"?self:typeof window<"u"?window:{});const xD="@firebase/firestore",wD="4.9.3";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ws.UNAUTHENTICATED=new ws(null),ws.GOOGLE_CREDENTIALS=new ws("google-credentials-uid"),ws.FIRST_PARTY=new ws("first-party-uid"),ws.MOCK_USER=new ws("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cd="12.7.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rc=new U0("@firebase/firestore");function Hc(){return rc.logLevel}function De(n,...e){if(rc.logLevel<=_t.DEBUG){const t=e.map(Y_);rc.debug(`Firestore (${cd}): ${n}`,...t)}}function Ro(n,...e){if(rc.logLevel<=_t.ERROR){const t=e.map(Y_);rc.error(`Firestore (${cd}): ${n}`,...t)}}function Ru(n,...e){if(rc.logLevel<=_t.WARN){const t=e.map(Y_);rc.warn(`Firestore (${cd}): ${n}`,...t)}}function Y_(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qe(n,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,nU(n,s,t)}function nU(n,e,t){let s=`FIRESTORE (${cd}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw Ro(s),new Error(s)}function Vt(n,e,t,s){let r="Unexpected state";typeof t=="string"?r=t:s=t,n||nU(e,r,s)}function it(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ge={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class We extends ki{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wa{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sU{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class IOe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ws.UNAUTHENTICATED))}shutdown(){}}class SOe{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class kOe{constructor(e){this.t=e,this.currentUser=ws.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Vt(this.o===void 0,42304);let s=this.i;const r=l=>this.i!==s?(s=this.i,t(l)):Promise.resolve();let i=new wa;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new wa,e.enqueueRetryable(()=>r(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await r(this.currentUser)})},a=l=>{De("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(De("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new wa)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(s=>this.i!==e?(De("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(Vt(typeof s.accessToken=="string",31837,{l:s}),new sU(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Vt(e===null||typeof e=="string",2055,{h:e}),new ws(e)}}class TOe{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=ws.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class COe{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new TOe(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(ws.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class vD{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class EOe{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,zs(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Vt(this.o===void 0,3512);const s=i=>{i.error!=null&&De("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,De("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>s(i))};const r=i=>{De("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>r(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?r(i):De("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new vD(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Vt(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new vD(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _Oe(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q_{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const r=_Oe(40);for(let i=0;i<r.length;++i)s.length<20&&r[i]<t&&(s+=e.charAt(r[i]%62))}return s}}function Nt(n,e){return n<e?-1:n>e?1:0}function IS(n,e){const t=Math.min(n.length,e.length);for(let s=0;s<t;s++){const r=n.charAt(s),i=e.charAt(s);if(r!==i)return x1(r)===x1(i)?Nt(r,i):x1(r)?1:-1}return Nt(n.length,e.length)}const NOe=55296,AOe=57343;function x1(n){const e=n.charCodeAt(0);return e>=NOe&&e<=AOe}function $u(n,e,t){return n.length===e.length&&n.every((s,r)=>t(s,e[r]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ID="__name__";class Ai{constructor(e,t,s){t===void 0?t=0:t>e.length&&Qe(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&Qe(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return Ai.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ai?e.forEach(s=>{t.push(s)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const i=Ai.compareSegments(e.get(r),t.get(r));if(i!==0)return i}return Nt(e.length,t.length)}static compareSegments(e,t){const s=Ai.isNumericId(e),r=Ai.isNumericId(t);return s&&!r?-1:!s&&r?1:s&&r?Ai.extractNumericId(e).compare(Ai.extractNumericId(t)):IS(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return xa.fromString(e.substring(4,e.length-2))}}class fn extends Ai{construct(e,t,s){return new fn(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new We(ge.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter(r=>r.length>0))}return new fn(t)}static emptyPath(){return new fn([])}}const ROe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class fs extends Ai{construct(e,t,s){return new fs(e,t,s)}static isValidIdentifier(e){return ROe.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),fs.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===ID}static keyField(){return new fs([ID])}static fromServerFormat(e){const t=[];let s="",r=0;const i=()=>{if(s.length===0)throw new We(ge.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let o=!1;for(;r<e.length;){const a=e[r];if(a==="\\"){if(r+1===e.length)throw new We(ge.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[r+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new We(ge.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=l,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(s+=a,r++):(i(),r++)}if(i(),o)throw new We(ge.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new fs(t)}static emptyPath(){return new fs([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class He{constructor(e){this.path=e}static fromPath(e){return new He(fn.fromString(e))}static fromName(e){return new He(fn.fromString(e).popFirst(5))}static empty(){return new He(fn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&fn.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return fn.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new He(new fn(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $Oe(n,e,t){if(!t)throw new We(ge.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function DOe(n,e,t,s){if(e===!0&&s===!0)throw new We(ge.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function SD(n){if(!He.isDocumentKey(n))throw new We(ge.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function rU(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Z_(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(s){return s.constructor?s.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Qe(12329,{type:typeof n})}function of(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new We(ge.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Z_(n);throw new We(ge.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fn(n,e){const t={typeString:n};return e&&(t.value=e),t}function gg(n,e){if(!rU(n))throw new We(ge.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const r=e[s].typeString,i="value"in e[s]?{value:e[s].value}:void 0;if(!(s in n)){t=`JSON missing required field: '${s}'`;break}const o=n[s];if(r&&typeof o!==r){t=`JSON field '${s}' must be a ${r}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${s}' field to equal '${i.value}'`;break}}if(t)throw new We(ge.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kD=-62135596800,TD=1e6;class rn{static now(){return rn.fromMillis(Date.now())}static fromDate(e){return rn.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*TD);return new rn(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new We(ge.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new We(ge.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<kD)throw new We(ge.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new We(ge.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/TD}_compareTo(e){return this.seconds===e.seconds?Nt(this.nanoseconds,e.nanoseconds):Nt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:rn._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(gg(e,rn._jsonSchema))return new rn(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-kD;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}rn._jsonSchemaVersion="firestore/timestamp/1.0",rn._jsonSchema={type:Fn("string",rn._jsonSchemaVersion),seconds:Fn("number"),nanoseconds:Fn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class st{static fromTimestamp(e){return new st(e)}static min(){return new st(new rn(0,0))}static max(){return new st(new rn(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const af=-1;function POe(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,r=st.fromTimestamp(s===1e9?new rn(t+1,0):new rn(t,s));return new Da(r,He.empty(),e)}function OOe(n){return new Da(n.readTime,n.key,af)}class Da{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new Da(st.min(),He.empty(),af)}static max(){return new Da(st.max(),He.empty(),af)}}function FOe(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=He.comparator(n.documentKey,e.documentKey),t!==0?t:Nt(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LOe="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class MOe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ud(n){if(n.code!==ge.FAILED_PRECONDITION||n.message!==LOe)throw n;De("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class he{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Qe(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new he((s,r)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(s,r)},this.catchCallback=i=>{this.wrapFailure(t,i).next(s,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof he?t:he.resolve(t)}catch(t){return he.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):he.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):he.reject(t)}static resolve(e){return new he((t,s)=>{t(e)})}static reject(e){return new he((t,s)=>{s(e)})}static waitFor(e){return new he((t,s)=>{let r=0,i=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++i,o&&i===r&&t()},l=>s(l))}),o=!0,i===r&&t()})}static or(e){let t=he.resolve(!1);for(const s of e)t=t.next(r=>r?he.resolve(r):s());return t}static forEach(e,t){const s=[];return e.forEach((r,i)=>{s.push(t.call(this,r,i))}),this.waitFor(s)}static mapArray(e,t){return new he((s,r)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(u=>{o[c]=u,++a,a===i&&s(o)},u=>r(u))}})}static doWhile(e,t){return new he((s,r)=>{const i=()=>{e()===!0?t().next(()=>{i()},r):s()};i()})}}function zOe(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function hd(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K0{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}K0.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J_=-1;function X0(n){return n==null}function Gb(n){return n===0&&1/n==-1/0}function VOe(n){return typeof n=="number"&&Number.isInteger(n)&&!Gb(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iU="";function BOe(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=CD(e)),e=jOe(n.get(t),e);return CD(e)}function jOe(n,e){let t=e;const s=n.length;for(let r=0;r<s;r++){const i=n.charAt(r);switch(i){case"\0":t+="";break;case iU:t+="";break;default:t+=i}}return t}function CD(n){return n+iU+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ED(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function _c(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function oU(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gn{constructor(e,t){this.comparator=e,this.root=t||ps.EMPTY}insert(e,t){return new gn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ps.BLACK,null,null))}remove(e){return new gn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ps.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,s)=>(e(t,s),!1))}toString(){const e=[];return this.inorderTraversal((t,s)=>(e.push(`${t}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ty(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ty(this.root,e,this.comparator,!1)}getReverseIterator(){return new ty(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ty(this.root,e,this.comparator,!0)}}class ty{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?s(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ps{constructor(e,t,s,r,i){this.key=e,this.value=t,this.color=s??ps.RED,this.left=r??ps.EMPTY,this.right=i??ps.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,i){return new ps(e??this.key,t??this.value,s??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const i=s(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,s),null):i===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return ps.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return ps.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ps.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ps.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Qe(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Qe(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Qe(27949);return e+(this.isRed()?0:1)}}ps.EMPTY=null,ps.RED=!0,ps.BLACK=!1;ps.EMPTY=new class{constructor(){this.size=0}get key(){throw Qe(57766)}get value(){throw Qe(16141)}get color(){throw Qe(16727)}get left(){throw Qe(29726)}get right(){throw Qe(36894)}copy(e,t,s,r,i){return this}insert(e,t,s){return new ps(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gn{constructor(e){this.comparator=e,this.data=new gn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,s)=>(e(t),!1))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new _D(this.data.getIterator())}getIteratorFrom(e){return new _D(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(s=>{t=t.add(s)}),t}isEqual(e){if(!(e instanceof Gn)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(this.comparator(r,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Gn(this.comparator);return t.data=e,t}}class _D{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class si{constructor(e){this.fields=e,e.sort(fs.comparator)}static empty(){return new si([])}unionWith(e){let t=new Gn(fs.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new si(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return $u(this.fields,e.fields,(t,s)=>t.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aU extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new aU("Invalid base64 string: "+i):i}}(e);return new gs(t)}static fromUint8Array(e){const t=function(r){let i="";for(let o=0;o<r.length;++o)i+=String.fromCharCode(r[o]);return i}(e);return new gs(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Nt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}gs.EMPTY_BYTE_STRING=new gs("");const UOe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pa(n){if(Vt(!!n,39018),typeof n=="string"){let e=0;const t=UOe.exec(n);if(Vt(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:Cn(n.seconds),nanos:Cn(n.nanos)}}function Cn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Oa(n){return typeof n=="string"?gs.fromBase64String(n):gs.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lU="server_timestamp",cU="__type__",uU="__previous_value__",hU="__local_write_time__";function eN(n){var t,s;return((s=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[cU])==null?void 0:s.stringValue)===lU}function Y0(n){const e=n.mapValue.fields[uU];return eN(e)?Y0(e):e}function lf(n){const e=Pa(n.mapValue.fields[hU].timestampValue);return new rn(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WOe{constructor(e,t,s,r,i,o,a,l,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c,this.isUsingEmulator=u}}const Hb="(default)";class cf{constructor(e,t){this.projectId=e,this.database=t||Hb}static empty(){return new cf("","")}get isDefaultDatabase(){return this.database===Hb}isEqual(e){return e instanceof cf&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dU="__type__",pU="__max__",ny={mapValue:{fields:{__type__:{stringValue:pU}}}},fU="__vector__",qb="value";function Fa(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?eN(n)?4:HOe(n)?9007199254740991:GOe(n)?10:11:Qe(28295,{value:n})}function Ji(n,e){if(n===e)return!0;const t=Fa(n);if(t!==Fa(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return lf(n).isEqual(lf(e));case 3:return function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const o=Pa(r.timestampValue),a=Pa(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(r,i){return Oa(r.bytesValue).isEqual(Oa(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,i){return Cn(r.geoPointValue.latitude)===Cn(i.geoPointValue.latitude)&&Cn(r.geoPointValue.longitude)===Cn(i.geoPointValue.longitude)}(n,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return Cn(r.integerValue)===Cn(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const o=Cn(r.doubleValue),a=Cn(i.doubleValue);return o===a?Gb(o)===Gb(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return $u(n.arrayValue.values||[],e.arrayValue.values||[],Ji);case 10:case 11:return function(r,i){const o=r.mapValue.fields||{},a=i.mapValue.fields||{};if(ED(o)!==ED(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Ji(o[l],a[l])))return!1;return!0}(n,e);default:return Qe(52216,{left:n})}}function uf(n,e){return(n.values||[]).find(t=>Ji(t,e))!==void 0}function Du(n,e){if(n===e)return 0;const t=Fa(n),s=Fa(e);if(t!==s)return Nt(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return Nt(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Cn(i.integerValue||i.doubleValue),l=Cn(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return ND(n.timestampValue,e.timestampValue);case 4:return ND(lf(n),lf(e));case 5:return IS(n.stringValue,e.stringValue);case 6:return function(i,o){const a=Oa(i),l=Oa(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const u=Nt(a[c],l[c]);if(u!==0)return u}return Nt(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Nt(Cn(i.latitude),Cn(o.latitude));return a!==0?a:Nt(Cn(i.longitude),Cn(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return AD(n.arrayValue,e.arrayValue);case 10:return function(i,o){var d,p,f,g;const a=i.fields||{},l=o.fields||{},c=(d=a[qb])==null?void 0:d.arrayValue,u=(p=l[qb])==null?void 0:p.arrayValue,h=Nt(((f=c==null?void 0:c.values)==null?void 0:f.length)||0,((g=u==null?void 0:u.values)==null?void 0:g.length)||0);return h!==0?h:AD(c,u)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===ny.mapValue&&o===ny.mapValue)return 0;if(i===ny.mapValue)return 1;if(o===ny.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},u=Object.keys(c);l.sort(),u.sort();for(let h=0;h<l.length&&h<u.length;++h){const d=IS(l[h],u[h]);if(d!==0)return d;const p=Du(a[l[h]],c[u[h]]);if(p!==0)return p}return Nt(l.length,u.length)}(n.mapValue,e.mapValue);default:throw Qe(23264,{he:t})}}function ND(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Nt(n,e);const t=Pa(n),s=Pa(e),r=Nt(t.seconds,s.seconds);return r!==0?r:Nt(t.nanos,s.nanos)}function AD(n,e){const t=n.values||[],s=e.values||[];for(let r=0;r<t.length&&r<s.length;++r){const i=Du(t[r],s[r]);if(i)return i}return Nt(t.length,s.length)}function Pu(n){return SS(n)}function SS(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const s=Pa(t);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Oa(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return He.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let s="[",r=!0;for(const i of t.values||[])r?r=!1:s+=",",s+=SS(i);return s+"]"}(n.arrayValue):"mapValue"in n?function(t){const s=Object.keys(t.fields||{}).sort();let r="{",i=!0;for(const o of s)i?i=!1:r+=",",r+=`${o}:${SS(t.fields[o])}`;return r+"}"}(n.mapValue):Qe(61005,{value:n})}function $y(n){switch(Fa(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Y0(n);return e?16+$y(e):16;case 5:return 2*n.stringValue.length;case 6:return Oa(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(s){return(s.values||[]).reduce((r,i)=>r+$y(i),0)}(n.arrayValue);case 10:case 11:return function(s){let r=0;return _c(s.fields,(i,o)=>{r+=i.length+$y(o)}),r}(n.mapValue);default:throw Qe(13486,{value:n})}}function kS(n){return!!n&&"integerValue"in n}function tN(n){return!!n&&"arrayValue"in n}function RD(n){return!!n&&"nullValue"in n}function $D(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Dy(n){return!!n&&"mapValue"in n}function GOe(n){var t,s;return((s=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[dU])==null?void 0:s.stringValue)===fU}function cp(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return _c(n.mapValue.fields,(t,s)=>e.mapValue.fields[t]=cp(s)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=cp(n.arrayValue.values[t]);return e}return{...n}}function HOe(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===pU}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Or{constructor(e){this.value=e}static empty(){return new Or({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!Dy(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=cp(t)}setAll(e){let t=fs.emptyPath(),s={},r=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,s,r),s={},r=[],t=a.popLast()}o?s[a.lastSegment()]=cp(o):r.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,s,r)}delete(e){const t=this.field(e.popLast());Dy(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ji(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];Dy(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){_c(t,(r,i)=>e[r]=i);for(const r of s)delete e[r]}clone(){return new Or(cp(this.value))}}function mU(n){const e=[];return _c(n.fields,(t,s)=>{const r=new fs([t]);if(Dy(s)){const i=mU(s.mapValue).fields;if(i.length===0)e.push(r);else for(const o of i)e.push(r.child(o))}else e.push(r)}),new si(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ss{constructor(e,t,s,r,i,o,a){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Ss(e,0,st.min(),st.min(),st.min(),Or.empty(),0)}static newFoundDocument(e,t,s,r){return new Ss(e,1,t,st.min(),s,r,0)}static newNoDocument(e,t){return new Ss(e,2,t,st.min(),st.min(),Or.empty(),0)}static newUnknownDocument(e,t){return new Ss(e,3,t,st.min(),st.min(),Or.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(st.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Or.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Or.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=st.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ss&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ss(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kb{constructor(e,t){this.position=e,this.inclusive=t}}function DD(n,e,t){let s=0;for(let r=0;r<n.position.length;r++){const i=e[r],o=n.position[r];if(i.field.isKeyField()?s=He.comparator(He.fromName(o.referenceValue),t.key):s=Du(o,t.data.field(i.field)),i.dir==="desc"&&(s*=-1),s!==0)break}return s}function PD(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ji(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xb{constructor(e,t="asc"){this.field=e,this.dir=t}}function qOe(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gU{}class jn extends gU{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new XOe(e,t,s):t==="array-contains"?new ZOe(e,s):t==="in"?new JOe(e,s):t==="not-in"?new eFe(e,s):t==="array-contains-any"?new tFe(e,s):new jn(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new YOe(e,s):new QOe(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Du(t,this.value)):t!==null&&Fa(this.value)===Fa(t)&&this.matchesComparison(Du(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Qe(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class eo extends gU{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new eo(e,t)}matches(e){return yU(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function yU(n){return n.op==="and"}function bU(n){return KOe(n)&&yU(n)}function KOe(n){for(const e of n.filters)if(e instanceof eo)return!1;return!0}function TS(n){if(n instanceof jn)return n.field.canonicalString()+n.op.toString()+Pu(n.value);if(bU(n))return n.filters.map(e=>TS(e)).join(",");{const e=n.filters.map(t=>TS(t)).join(",");return`${n.op}(${e})`}}function xU(n,e){return n instanceof jn?function(s,r){return r instanceof jn&&s.op===r.op&&s.field.isEqual(r.field)&&Ji(s.value,r.value)}(n,e):n instanceof eo?function(s,r){return r instanceof eo&&s.op===r.op&&s.filters.length===r.filters.length?s.filters.reduce((i,o,a)=>i&&xU(o,r.filters[a]),!0):!1}(n,e):void Qe(19439)}function wU(n){return n instanceof jn?function(t){return`${t.field.canonicalString()} ${t.op} ${Pu(t.value)}`}(n):n instanceof eo?function(t){return t.op.toString()+" {"+t.getFilters().map(wU).join(" ,")+"}"}(n):"Filter"}class XOe extends jn{constructor(e,t,s){super(e,t,s),this.key=He.fromName(s.referenceValue)}matches(e){const t=He.comparator(e.key,this.key);return this.matchesComparison(t)}}class YOe extends jn{constructor(e,t){super(e,"in",t),this.keys=vU("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class QOe extends jn{constructor(e,t){super(e,"not-in",t),this.keys=vU("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function vU(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(s=>He.fromName(s.referenceValue))}class ZOe extends jn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return tN(t)&&uf(t.arrayValue,this.value)}}class JOe extends jn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&uf(this.value.arrayValue,t)}}class eFe extends jn{constructor(e,t){super(e,"not-in",t)}matches(e){if(uf(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!uf(this.value.arrayValue,t)}}class tFe extends jn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!tN(t)||!t.arrayValue.values)&&t.arrayValue.values.some(s=>uf(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nFe{constructor(e,t=null,s=[],r=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function OD(n,e=null,t=[],s=[],r=null,i=null,o=null){return new nFe(n,e,t,s,r,i,o)}function nN(n){const e=it(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(s=>TS(s)).join(","),t+="|ob:",t+=e.orderBy.map(s=>function(i){return i.field.canonicalString()+i.dir}(s)).join(","),X0(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(s=>Pu(s)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(s=>Pu(s)).join(",")),e.Te=t}return e.Te}function sN(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!qOe(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!xU(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!PD(n.startAt,e.startAt)&&PD(n.endAt,e.endAt)}function CS(n){return He.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q0{constructor(e,t=null,s=[],r=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function sFe(n,e,t,s,r,i,o,a){return new Q0(n,e,t,s,r,i,o,a)}function rN(n){return new Q0(n)}function FD(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function rFe(n){return n.collectionGroup!==null}function up(n){const e=it(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Gn(fs.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Xb(i,s))}),t.has(fs.keyField().canonicalString())||e.Ie.push(new Xb(fs.keyField(),s))}return e.Ie}function Ui(n){const e=it(n);return e.Ee||(e.Ee=iFe(e,up(n))),e.Ee}function iFe(n,e){if(n.limitType==="F")return OD(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{const i=r.dir==="desc"?"asc":"desc";return new Xb(r.field,i)});const t=n.endAt?new Kb(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new Kb(n.startAt.position,n.startAt.inclusive):null;return OD(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function ES(n,e,t){return new Q0(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Z0(n,e){return sN(Ui(n),Ui(e))&&n.limitType===e.limitType}function IU(n){return`${nN(Ui(n))}|lt:${n.limitType}`}function qc(n){return`Query(target=${function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map(r=>wU(r)).join(", ")}]`),X0(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map(r=>Pu(r)).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map(r=>Pu(r)).join(",")),`Target(${s})`}(Ui(n))}; limitType=${n.limitType})`}function J0(n,e){return e.isFoundDocument()&&function(s,r){const i=r.key.path;return s.collectionGroup!==null?r.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(i):He.isDocumentKey(s.path)?s.path.isEqual(i):s.path.isImmediateParentOf(i)}(n,e)&&function(s,r){for(const i of up(s))if(!i.field.isKeyField()&&r.data.field(i.field)===null)return!1;return!0}(n,e)&&function(s,r){for(const i of s.filters)if(!i.matches(r))return!1;return!0}(n,e)&&function(s,r){return!(s.startAt&&!function(o,a,l){const c=DD(o,a,l);return o.inclusive?c<=0:c<0}(s.startAt,up(s),r)||s.endAt&&!function(o,a,l){const c=DD(o,a,l);return o.inclusive?c>=0:c>0}(s.endAt,up(s),r))}(n,e)}function oFe(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function SU(n){return(e,t)=>{let s=!1;for(const r of up(n)){const i=aFe(r,e,t);if(i!==0)return i;s=s||r.field.isKeyField()}return 0}}function aFe(n,e,t){const s=n.field.isKeyField()?He.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?Du(l,c):Qe(42886)}(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return Qe(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nc{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[r,i]of s)if(this.equalsFn(r,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return s.length===1?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){_c(this.inner,(t,s)=>{for(const[r,i]of s)e(r,i)})}isEmpty(){return oU(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lFe=new gn(He.comparator);function $o(){return lFe}const kU=new gn(He.comparator);function Zd(...n){let e=kU;for(const t of n)e=e.insert(t.key,t);return e}function TU(n){let e=kU;return n.forEach((t,s)=>e=e.insert(t,s.overlayedDocument)),e}function Tl(){return hp()}function CU(){return hp()}function hp(){return new Nc(n=>n.toString(),(n,e)=>n.isEqual(e))}const cFe=new gn(He.comparator),uFe=new Gn(He.comparator);function At(...n){let e=uFe;for(const t of n)e=e.add(t);return e}const hFe=new Gn(Nt);function dFe(){return hFe}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iN(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Gb(e)?"-0":e}}function EU(n){return{integerValue:""+n}}function _U(n,e){return VOe(e)?EU(e):iN(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ev{constructor(){this._=void 0}}function pFe(n,e,t){return n instanceof hf?function(r,i){const o={fields:{[cU]:{stringValue:lU},[hU]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&eN(i)&&(i=Y0(i)),i&&(o.fields[uU]=i),{mapValue:o}}(t,e):n instanceof df?AU(n,e):n instanceof pf?RU(n,e):function(r,i){const o=NU(r,i),a=LD(o)+LD(r.Ae);return kS(o)&&kS(r.Ae)?EU(a):iN(r.serializer,a)}(n,e)}function fFe(n,e,t){return n instanceof df?AU(n,e):n instanceof pf?RU(n,e):t}function NU(n,e){return n instanceof ff?function(s){return kS(s)||function(i){return!!i&&"doubleValue"in i}(s)}(e)?e:{integerValue:0}:null}class hf extends ev{}class df extends ev{constructor(e){super(),this.elements=e}}function AU(n,e){const t=$U(e);for(const s of n.elements)t.some(r=>Ji(r,s))||t.push(s);return{arrayValue:{values:t}}}class pf extends ev{constructor(e){super(),this.elements=e}}function RU(n,e){let t=$U(e);for(const s of n.elements)t=t.filter(r=>!Ji(r,s));return{arrayValue:{values:t}}}class ff extends ev{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function LD(n){return Cn(n.integerValue||n.doubleValue)}function $U(n){return tN(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DU{constructor(e,t){this.field=e,this.transform=t}}function mFe(n,e){return n.field.isEqual(e.field)&&function(s,r){return s instanceof df&&r instanceof df||s instanceof pf&&r instanceof pf?$u(s.elements,r.elements,Ji):s instanceof ff&&r instanceof ff?Ji(s.Ae,r.Ae):s instanceof hf&&r instanceof hf}(n.transform,e.transform)}class gFe{constructor(e,t){this.version=e,this.transformResults=t}}class bo{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new bo}static exists(e){return new bo(void 0,e)}static updateTime(e){return new bo(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Py(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class tv{}function PU(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new FU(n.key,bo.none()):new yg(n.key,n.data,bo.none());{const t=n.data,s=Or.empty();let r=new Gn(fs.comparator);for(let i of e.fields)if(!r.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?s.delete(i):s.set(i,o),r=r.add(i)}return new Ac(n.key,s,new si(r.toArray()),bo.none())}}function yFe(n,e,t){n instanceof yg?function(r,i,o){const a=r.value.clone(),l=zD(r.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Ac?function(r,i,o){if(!Py(r.precondition,i))return void i.convertToUnknownDocument(o.version);const a=zD(r.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(OU(r)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(r,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function dp(n,e,t,s){return n instanceof yg?function(i,o,a,l){if(!Py(i.precondition,o))return a;const c=i.value.clone(),u=VD(i.fieldTransforms,l,o);return c.setAll(u),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,s):n instanceof Ac?function(i,o,a,l){if(!Py(i.precondition,o))return a;const c=VD(i.fieldTransforms,l,o),u=o.data;return u.setAll(OU(i)),u.setAll(c),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(h=>h.field))}(n,e,t,s):function(i,o,a){return Py(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function bFe(n,e){let t=null;for(const s of n.fieldTransforms){const r=e.data.field(s.field),i=NU(s.transform,r||null);i!=null&&(t===null&&(t=Or.empty()),t.set(s.field,i))}return t||null}function MD(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(s,r){return s===void 0&&r===void 0||!(!s||!r)&&$u(s,r,(i,o)=>mFe(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class yg extends tv{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Ac extends tv{constructor(e,t,s,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function OU(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}}),e}function zD(n,e,t){const s=new Map;Vt(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let r=0;r<t.length;r++){const i=n[r],o=i.transform,a=e.data.field(i.field);s.set(i.field,fFe(o,a,t[r]))}return s}function VD(n,e,t){const s=new Map;for(const r of n){const i=r.transform,o=t.data.field(r.field);s.set(r.field,pFe(i,o,e))}return s}class FU extends tv{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class xFe extends tv{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wFe{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&yFe(i,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=dp(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=dp(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=CU();return this.mutations.forEach(r=>{const i=e.get(r.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(r.key)?null:a;const l=PU(o,a);l!==null&&s.set(r.key,l),o.isValidDocument()||o.convertToNoDocument(st.min())}),s}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),At())}isEqual(e){return this.batchId===e.batchId&&$u(this.mutations,e.mutations,(t,s)=>MD(t,s))&&$u(this.baseMutations,e.baseMutations,(t,s)=>MD(t,s))}}class oN{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){Vt(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let r=function(){return cFe}();const i=e.mutations;for(let o=0;o<i.length;o++)r=r.insert(i[o].key,s[o].version);return new oN(e,t,s,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vFe{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IFe{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Rn,Dt;function SFe(n){switch(n){case ge.OK:return Qe(64938);case ge.CANCELLED:case ge.UNKNOWN:case ge.DEADLINE_EXCEEDED:case ge.RESOURCE_EXHAUSTED:case ge.INTERNAL:case ge.UNAVAILABLE:case ge.UNAUTHENTICATED:return!1;case ge.INVALID_ARGUMENT:case ge.NOT_FOUND:case ge.ALREADY_EXISTS:case ge.PERMISSION_DENIED:case ge.FAILED_PRECONDITION:case ge.ABORTED:case ge.OUT_OF_RANGE:case ge.UNIMPLEMENTED:case ge.DATA_LOSS:return!0;default:return Qe(15467,{code:n})}}function LU(n){if(n===void 0)return Ro("GRPC error has no .code"),ge.UNKNOWN;switch(n){case Rn.OK:return ge.OK;case Rn.CANCELLED:return ge.CANCELLED;case Rn.UNKNOWN:return ge.UNKNOWN;case Rn.DEADLINE_EXCEEDED:return ge.DEADLINE_EXCEEDED;case Rn.RESOURCE_EXHAUSTED:return ge.RESOURCE_EXHAUSTED;case Rn.INTERNAL:return ge.INTERNAL;case Rn.UNAVAILABLE:return ge.UNAVAILABLE;case Rn.UNAUTHENTICATED:return ge.UNAUTHENTICATED;case Rn.INVALID_ARGUMENT:return ge.INVALID_ARGUMENT;case Rn.NOT_FOUND:return ge.NOT_FOUND;case Rn.ALREADY_EXISTS:return ge.ALREADY_EXISTS;case Rn.PERMISSION_DENIED:return ge.PERMISSION_DENIED;case Rn.FAILED_PRECONDITION:return ge.FAILED_PRECONDITION;case Rn.ABORTED:return ge.ABORTED;case Rn.OUT_OF_RANGE:return ge.OUT_OF_RANGE;case Rn.UNIMPLEMENTED:return ge.UNIMPLEMENTED;case Rn.DATA_LOSS:return ge.DATA_LOSS;default:return Qe(39323,{code:n})}}(Dt=Rn||(Rn={}))[Dt.OK=0]="OK",Dt[Dt.CANCELLED=1]="CANCELLED",Dt[Dt.UNKNOWN=2]="UNKNOWN",Dt[Dt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Dt[Dt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Dt[Dt.NOT_FOUND=5]="NOT_FOUND",Dt[Dt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Dt[Dt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Dt[Dt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Dt[Dt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Dt[Dt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Dt[Dt.ABORTED=10]="ABORTED",Dt[Dt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Dt[Dt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Dt[Dt.INTERNAL=13]="INTERNAL",Dt[Dt.UNAVAILABLE=14]="UNAVAILABLE",Dt[Dt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kFe(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TFe=new xa([4294967295,4294967295],0);function BD(n){const e=kFe().encode(n),t=new Yj;return t.update(e),new Uint8Array(t.digest())}function jD(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new xa([t,s],0),new xa([r,i],0)]}class aN{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new Jd(`Invalid padding: ${t}`);if(s<0)throw new Jd(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new Jd(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new Jd(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=xa.fromNumber(this.ge)}ye(e,t,s){let r=e.add(t.multiply(xa.fromNumber(s)));return r.compare(TFe)===1&&(r=new xa([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=BD(e),[s,r]=jD(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(s,r,i);if(!this.we(o))return!1}return!0}static create(e,t,s){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new aN(i,r,t);return s.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const t=BD(e),[s,r]=jD(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(s,r,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class Jd extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nv{constructor(e,t,s,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,bg.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new nv(st.min(),r,new gn(Nt),$o(),At())}}class bg{constructor(e,t,s,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new bg(s,t,At(),At(),At())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oy{constructor(e,t,s,r){this.be=e,this.removedTargetIds=t,this.key=s,this.De=r}}class MU{constructor(e,t){this.targetId=e,this.Ce=t}}class zU{constructor(e,t,s=gs.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class UD{constructor(){this.ve=0,this.Fe=WD(),this.Me=gs.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=At(),t=At(),s=At();return this.Fe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:Qe(38017,{changeType:i})}}),new bg(this.Me,this.xe,e,t,s)}qe(){this.Oe=!1,this.Fe=WD()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Vt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class CFe{constructor(e){this.Ge=e,this.ze=new Map,this.je=$o(),this.Je=sy(),this.He=sy(),this.Ye=new gn(Nt)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.Ke(),s.Ne||s.qe(),s.Le(e.resumeToken);break;case 2:s.Ke(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.We(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:Qe(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((s,r)=>{this.rt(r)&&t(r)})}st(e){const t=e.targetId,s=e.Ce.count,r=this.ot(t);if(r){const i=r.target;if(CS(i))if(s===0){const o=new He(i.path);this.et(t,o,Ss.newNoDocument(o,st.min()))}else Vt(s===1,20013,{expectedCount:s});else{const o=this._t(t);if(o!==s){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,c)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:i=0}=t;let o,a;try{o=Oa(s).toUint8Array()}catch(l){if(l instanceof aU)return Ru("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new aN(o,r,i)}catch(l){return Ru(l instanceof Jd?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let r=0;return s.forEach(i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),r++)}),r}Tt(e){const t=new Map;this.ze.forEach((i,o)=>{const a=this.ot(o);if(a){if(i.current&&CS(a.target)){const l=new He(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,Ss.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.qe())}});let s=At();this.He.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.ot(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(s=s.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const r=new nv(e,t,this.Ye,this.je,s);return this.je=$o(),this.Je=sy(),this.He=sy(),this.Ye=new gn(Nt),r}Xe(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,s),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new UD,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Gn(Nt),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Gn(Nt),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||De("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new UD),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function sy(){return new gn(He.comparator)}function WD(){return new gn(He.comparator)}const EFe=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),_Fe=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),NFe=(()=>({and:"AND",or:"OR"}))();class AFe{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function _S(n,e){return n.useProto3Json||X0(e)?e:{value:e}}function Yb(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function VU(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function RFe(n,e){return Yb(n,e.toTimestamp())}function Wi(n){return Vt(!!n,49232),st.fromTimestamp(function(t){const s=Pa(t);return new rn(s.seconds,s.nanos)}(n))}function lN(n,e){return NS(n,e).canonicalString()}function NS(n,e){const t=function(r){return new fn(["projects",r.projectId,"databases",r.database])}(n).child("documents");return e===void 0?t:t.child(e)}function BU(n){const e=fn.fromString(n);return Vt(HU(e),10190,{key:e.toString()}),e}function AS(n,e){return lN(n.databaseId,e.path)}function w1(n,e){const t=BU(e);if(t.get(1)!==n.databaseId.projectId)throw new We(ge.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new We(ge.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new He(UU(t))}function jU(n,e){return lN(n.databaseId,e)}function $Fe(n){const e=BU(n);return e.length===4?fn.emptyPath():UU(e)}function RS(n){return new fn(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function UU(n){return Vt(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function GD(n,e,t){return{name:AS(n,e),fields:t.value.mapValue.fields}}function DFe(n,e){let t;if("targetChange"in e){e.targetChange;const s=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Qe(39313,{state:c})}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=function(c,u){return c.useProto3Json?(Vt(u===void 0||typeof u=="string",58123),gs.fromBase64String(u||"")):(Vt(u===void 0||u instanceof Buffer||u instanceof Uint8Array,16193),gs.fromUint8Array(u||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const u=c.code===void 0?ge.UNKNOWN:LU(c.code);return new We(u,c.message||"")}(o);t=new zU(s,r,i,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=w1(n,s.document.name),i=Wi(s.document.updateTime),o=s.document.createTime?Wi(s.document.createTime):st.min(),a=new Or({mapValue:{fields:s.document.fields}}),l=Ss.newFoundDocument(r,i,o,a),c=s.targetIds||[],u=s.removedTargetIds||[];t=new Oy(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=w1(n,s.document),i=s.readTime?Wi(s.readTime):st.min(),o=Ss.newNoDocument(r,i),a=s.removedTargetIds||[];t=new Oy([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=w1(n,s.document),i=s.removedTargetIds||[];t=new Oy([],i,r,null)}else{if(!("filter"in e))return Qe(11601,{Rt:e});{e.filter;const s=e.filter;s.targetId;const{count:r=0,unchangedNames:i}=s,o=new IFe(r,i),a=s.targetId;t=new MU(a,o)}}return t}function PFe(n,e){let t;if(e instanceof yg)t={update:GD(n,e.key,e.value)};else if(e instanceof FU)t={delete:AS(n,e.key)};else if(e instanceof Ac)t={update:GD(n,e.key,e.data),updateMask:UFe(e.fieldMask)};else{if(!(e instanceof xFe))return Qe(16599,{Vt:e.type});t={verify:AS(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(s=>function(i,o){const a=o.transform;if(a instanceof hf)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof df)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof pf)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof ff)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw Qe(20930,{transform:o.transform})}(0,s))),e.precondition.isNone||(t.currentDocument=function(r,i){return i.updateTime!==void 0?{updateTime:RFe(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Qe(27497)}(n,e.precondition)),t}function OFe(n,e){return n&&n.length>0?(Vt(e!==void 0,14353),n.map(t=>function(r,i){let o=r.updateTime?Wi(r.updateTime):Wi(i);return o.isEqual(st.min())&&(o=Wi(i)),new gFe(o,r.transformResults||[])}(t,e))):[]}function FFe(n,e){return{documents:[jU(n,e.path)]}}function LFe(n,e){const t={structuredQuery:{}},s=e.path;let r;e.collectionGroup!==null?(r=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=jU(n,r);const i=function(c){if(c.length!==0)return GU(eo.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(u=>function(d){return{field:Kc(d.field),direction:VFe(d.dir)}}(u))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=_S(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{ft:t,parent:r}}function MFe(n){let e=$Fe(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let r=null;if(s>0){Vt(s===1,65062);const u=t.from[0];u.allDescendants?r=u.collectionId:e=e.child(u.collectionId)}let i=[];t.where&&(i=function(h){const d=WU(h);return d instanceof eo&&bU(d)?d.getFilters():[d]}(t.where));let o=[];t.orderBy&&(o=function(h){return h.map(d=>function(f){return new Xb(Xc(f.field),function(m){switch(m){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(f.direction))}(d))}(t.orderBy));let a=null;t.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,X0(d)?null:d}(t.limit));let l=null;t.startAt&&(l=function(h){const d=!!h.before,p=h.values||[];return new Kb(p,d)}(t.startAt));let c=null;return t.endAt&&(c=function(h){const d=!h.before,p=h.values||[];return new Kb(p,d)}(t.endAt)),sFe(e,r,o,i,a,"F",l,c)}function zFe(n,e){const t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Qe(28987,{purpose:r})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function WU(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=Xc(t.unaryFilter.field);return jn.create(s,"==",{doubleValue:NaN});case"IS_NULL":const r=Xc(t.unaryFilter.field);return jn.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Xc(t.unaryFilter.field);return jn.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Xc(t.unaryFilter.field);return jn.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Qe(61313);default:return Qe(60726)}}(n):n.fieldFilter!==void 0?function(t){return jn.create(Xc(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Qe(58110);default:return Qe(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return eo.create(t.compositeFilter.filters.map(s=>WU(s)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return Qe(1026)}}(t.compositeFilter.op))}(n):Qe(30097,{filter:n})}function VFe(n){return EFe[n]}function BFe(n){return _Fe[n]}function jFe(n){return NFe[n]}function Kc(n){return{fieldPath:n.canonicalString()}}function Xc(n){return fs.fromServerFormat(n.fieldPath)}function GU(n){return n instanceof jn?function(t){if(t.op==="=="){if($D(t.value))return{unaryFilter:{field:Kc(t.field),op:"IS_NAN"}};if(RD(t.value))return{unaryFilter:{field:Kc(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if($D(t.value))return{unaryFilter:{field:Kc(t.field),op:"IS_NOT_NAN"}};if(RD(t.value))return{unaryFilter:{field:Kc(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Kc(t.field),op:BFe(t.op),value:t.value}}}(n):n instanceof eo?function(t){const s=t.getFilters().map(r=>GU(r));return s.length===1?s[0]:{compositeFilter:{op:jFe(t.op),filters:s}}}(n):Qe(54877,{filter:n})}function UFe(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function HU(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da{constructor(e,t,s,r,i=st.min(),o=st.min(),a=gs.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new da(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new da(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new da(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new da(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WFe{constructor(e){this.yt=e}}function GFe(n){const e=MFe({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ES(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HFe{constructor(){this.Cn=new qFe}addToCollectionParentIndex(e,t){return this.Cn.add(t),he.resolve()}getCollectionParents(e,t){return he.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return he.resolve()}deleteFieldIndex(e,t){return he.resolve()}deleteAllFieldIndexes(e){return he.resolve()}createTargetIndexes(e,t){return he.resolve()}getDocumentsMatchingTarget(e,t){return he.resolve(null)}getIndexType(e,t){return he.resolve(0)}getFieldIndexes(e,t){return he.resolve([])}getNextCollectionGroupToUpdate(e){return he.resolve(null)}getMinOffset(e,t){return he.resolve(Da.min())}getMinOffsetFromCollectionGroup(e,t){return he.resolve(Da.min())}updateCollectionGroup(e,t,s){return he.resolve()}updateIndexEntries(e,t){return he.resolve()}}class qFe{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new Gn(fn.comparator),i=!r.has(s);return this.index[t]=r.add(s),i}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new Gn(fn.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HD={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},qU=41943040;class nr{static withCacheSize(e){return new nr(e,nr.DEFAULT_COLLECTION_PERCENTILE,nr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */nr.DEFAULT_COLLECTION_PERCENTILE=10,nr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,nr.DEFAULT=new nr(qU,nr.DEFAULT_COLLECTION_PERCENTILE,nr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),nr.DISABLED=new nr(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ou{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Ou(0)}static cr(){return new Ou(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qD="LruGarbageCollector",KFe=1048576;function KD([n,e],[t,s]){const r=Nt(n,t);return r===0?Nt(e,s):r}class XFe{constructor(e){this.Ir=e,this.buffer=new Gn(KD),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();KD(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class YFe{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){De(qD,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){hd(t)?De(qD,"Ignoring IndexedDB error during garbage collection: ",t):await ud(t)}await this.Vr(3e5)})}}class QFe{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(s=>Math.floor(t/100*s))}nthSequenceNumber(e,t){if(t===0)return he.resolve(K0.ce);const s=new XFe(t);return this.mr.forEachTarget(e,r=>s.Ar(r.sequenceNumber)).next(()=>this.mr.pr(e,r=>s.Ar(r))).next(()=>s.maxValue)}removeTargets(e,t,s){return this.mr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(De("LruGarbageCollector","Garbage collection skipped; disabled"),he.resolve(HD)):this.getCacheSize(e).next(s=>s<this.params.cacheSizeCollectionThreshold?(De("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),HD):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let s,r,i,o,a,l,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(De("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),r=this.params.maximumSequenceNumbersToCollect):r=h,o=Date.now(),this.nthSequenceNumber(e,r))).next(h=>(s=h,a=Date.now(),this.removeTargets(e,s,t))).next(h=>(i=h,l=Date.now(),this.removeOrphanedDocuments(e,s))).next(h=>(c=Date.now(),Hc()<=_t.DEBUG&&De("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${r} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${h} documents in `+(c-l)+`ms
Total Duration: ${c-u}ms`),he.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:h})))}}function ZFe(n,e){return new QFe(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JFe{constructor(){this.changes=new Nc(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ss.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?he.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eLe{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tLe{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(s=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(s!==null&&dp(s.mutation,r,si.empty(),rn.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(s=>this.getLocalViewOfDocuments(e,s,At()).next(()=>s))}getLocalViewOfDocuments(e,t,s=At()){const r=Tl();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,s).next(i=>{let o=Zd();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const s=Tl();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,At()))}populateOverlays(e,t,s){const r=[];return s.forEach(i=>{t.has(i)||r.push(i)}),this.documentOverlayCache.getOverlays(e,r).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,s,r){let i=$o();const o=hp(),a=function(){return hp()}();return t.forEach((l,c)=>{const u=s.get(c.key);r.has(c.key)&&(u===void 0||u.mutation instanceof Ac)?i=i.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),dp(u.mutation,c,u.mutation.getFieldMask(),rn.now())):o.set(c.key,si.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>a.set(c,new eLe(u,o.get(c)??null))),a))}recalculateAndSaveOverlays(e,t){const s=hp();let r=new gn((o,a)=>o-a),i=At();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let u=s.get(l)||si.empty();u=a.applyToLocalView(c,u),s.set(l,u);const h=(r.get(a.batchId)||At()).add(l);r=r.insert(a.batchId,h)})}).next(()=>{const o=[],a=r.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,u=l.value,h=CU();u.forEach(d=>{if(!i.has(d)){const p=PU(t.get(d),s.get(d));p!==null&&h.set(d,p),i=i.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return he.waitFor(o)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(s=>this.recalculateAndSaveOverlays(e,s))}getDocumentsMatchingQuery(e,t,s,r){return function(o){return He.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):rFe(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,r):this.getDocumentsMatchingCollectionQuery(e,t,s,r)}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next(i=>{const o=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-i.size):he.resolve(Tl());let a=af,l=i;return o.next(c=>he.forEach(c,(u,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),i.get(u)?he.resolve():this.remoteDocumentCache.getEntry(e,u).next(d=>{l=l.insert(u,d)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,At())).next(u=>({batchId:a,changes:TU(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new He(t)).next(s=>{let r=Zd();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,s,r){const i=t.collectionGroup;let o=Zd();return this.indexManager.getCollectionParents(e,i).next(a=>he.forEach(a,l=>{const c=function(h,d){return new Q0(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,s,r).next(u=>{u.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,s,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,i,r))).next(o=>{i.forEach((l,c)=>{const u=c.getKey();o.get(u)===null&&(o=o.insert(u,Ss.newInvalidDocument(u)))});let a=Zd();return o.forEach((l,c)=>{const u=i.get(l);u!==void 0&&dp(u.mutation,c,si.empty(),rn.now()),J0(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nLe{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return he.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(r){return{id:r.id,version:r.version,createTime:Wi(r.createTime)}}(t)),he.resolve()}getNamedQuery(e,t){return he.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(r){return{name:r.name,query:GFe(r.bundledQuery),readTime:Wi(r.readTime)}}(t)),he.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sLe{constructor(){this.overlays=new gn(He.comparator),this.qr=new Map}getOverlay(e,t){return he.resolve(this.overlays.get(t))}getOverlays(e,t){const s=Tl();return he.forEach(t,r=>this.getOverlay(e,r).next(i=>{i!==null&&s.set(r,i)})).next(()=>s)}saveOverlays(e,t,s){return s.forEach((r,i)=>{this.St(e,t,i)}),he.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.qr.get(s);return r!==void 0&&(r.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(s)),he.resolve()}getOverlaysForCollection(e,t,s){const r=Tl(),i=t.length+1,o=new He(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>s&&r.set(l.getKey(),l)}return he.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let i=new gn((c,u)=>c-u);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>s){let u=i.get(c.largestBatchId);u===null&&(u=Tl(),i=i.insert(c.largestBatchId,u)),u.set(c.getKey(),c)}}const a=Tl(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,u)=>a.set(c,u)),!(a.size()>=r)););return he.resolve(a)}St(e,t,s){const r=this.overlays.get(s.key);if(r!==null){const o=this.qr.get(r.largestBatchId).delete(s.key);this.qr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new vFe(t,s));let i=this.qr.get(t);i===void 0&&(i=At(),this.qr.set(t,i)),this.qr.set(t,i.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rLe{constructor(){this.sessionToken=gs.EMPTY_BYTE_STRING}getSessionToken(e){return he.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,he.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cN{constructor(){this.Qr=new Gn(Zn.$r),this.Ur=new Gn(Zn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const s=new Zn(e,t);this.Qr=this.Qr.add(s),this.Ur=this.Ur.add(s)}Wr(e,t){e.forEach(s=>this.addReference(s,t))}removeReference(e,t){this.Gr(new Zn(e,t))}zr(e,t){e.forEach(s=>this.removeReference(s,t))}jr(e){const t=new He(new fn([])),s=new Zn(t,e),r=new Zn(t,e+1),i=[];return this.Ur.forEachInRange([s,r],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new He(new fn([])),s=new Zn(t,e),r=new Zn(t,e+1);let i=At();return this.Ur.forEachInRange([s,r],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Zn(e,0),s=this.Qr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class Zn{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return He.comparator(e.key,t.key)||Nt(e.Yr,t.Yr)}static Kr(e,t){return Nt(e.Yr,t.Yr)||He.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iLe{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Gn(Zn.$r)}checkEmpty(e){return he.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,r){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new wFe(i,t,s,r);this.mutationQueue.push(o);for(const a of r)this.Zr=this.Zr.add(new Zn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return he.resolve(o)}lookupMutationBatch(e,t){return he.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=this.ei(s),i=r<0?0:r;return he.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return he.resolve(this.mutationQueue.length===0?J_:this.tr-1)}getAllMutationBatches(e){return he.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new Zn(t,0),r=new Zn(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([s,r],o=>{const a=this.Xr(o.Yr);i.push(a)}),he.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Gn(Nt);return t.forEach(r=>{const i=new Zn(r,0),o=new Zn(r,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],a=>{s=s.add(a.Yr)})}),he.resolve(this.ti(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let i=s;He.isDocumentKey(i)||(i=i.child(""));const o=new Zn(new He(i),0);let a=new Gn(Nt);return this.Zr.forEachWhile(l=>{const c=l.key.path;return!!s.isPrefixOf(c)&&(c.length===r&&(a=a.add(l.Yr)),!0)},o),he.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(s=>{const r=this.Xr(s);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){Vt(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Zr;return he.forEach(t.mutations,r=>{const i=new Zn(r.key,t.batchId);return s=s.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=s})}ir(e){}containsKey(e,t){const s=new Zn(t,0),r=this.Zr.firstAfterOrEqual(s);return he.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,he.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oLe{constructor(e){this.ri=e,this.docs=function(){return new gn(He.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),i=r?r.size:0,o=this.ri(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return he.resolve(s?s.document.mutableCopy():Ss.newInvalidDocument(t))}getEntries(e,t){let s=$o();return t.forEach(r=>{const i=this.docs.get(r);s=s.insert(r,i?i.document.mutableCopy():Ss.newInvalidDocument(r))}),he.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let i=$o();const o=t.path,a=new He(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||FOe(OOe(u),s)<=0||(r.has(u.key)||J0(t,u))&&(i=i.insert(u.key,u.mutableCopy()))}return he.resolve(i)}getAllFromCollectionGroup(e,t,s,r){Qe(9500)}ii(e,t){return he.forEach(this.docs,s=>t(s))}newChangeBuffer(e){return new aLe(this)}getSize(e){return he.resolve(this.size)}}class aLe extends JFe{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((s,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(s)}),he.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lLe{constructor(e){this.persistence=e,this.si=new Nc(t=>nN(t),sN),this.lastRemoteSnapshotVersion=st.min(),this.highestTargetId=0,this.oi=0,this._i=new cN,this.targetCount=0,this.ai=Ou.ur()}forEachTarget(e,t){return this.si.forEach((s,r)=>t(r)),he.resolve()}getLastRemoteSnapshotVersion(e){return he.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return he.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),he.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.oi&&(this.oi=t),he.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Ou(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,he.resolve()}updateTargetData(e,t){return this.Pr(t),he.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,he.resolve()}removeTargets(e,t,s){let r=0;const i=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=t&&s.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),he.waitFor(i).next(()=>r)}getTargetCount(e){return he.resolve(this.targetCount)}getTargetData(e,t){const s=this.si.get(t)||null;return he.resolve(s)}addMatchingKeys(e,t,s){return this._i.Wr(t,s),he.resolve()}removeMatchingKeys(e,t,s){this._i.zr(t,s);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(o=>{i.push(r.markPotentiallyOrphaned(e,o))}),he.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),he.resolve()}getMatchingKeysForTargetId(e,t){const s=this._i.Hr(t);return he.resolve(s)}containsKey(e,t){return he.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KU{constructor(e,t){this.ui={},this.overlays={},this.ci=new K0(0),this.li=!1,this.li=!0,this.hi=new rLe,this.referenceDelegate=e(this),this.Pi=new lLe(this),this.indexManager=new HFe,this.remoteDocumentCache=function(r){return new oLe(r)}(s=>this.referenceDelegate.Ti(s)),this.serializer=new WFe(t),this.Ii=new nLe(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new sLe,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.ui[e.toKey()];return s||(s=new iLe(t,this.referenceDelegate),this.ui[e.toKey()]=s),s}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,s){De("MemoryPersistence","Starting transaction:",e);const r=new cLe(this.ci.next());return this.referenceDelegate.Ei(),s(r).next(i=>this.referenceDelegate.di(r).next(()=>i)).toPromise().then(i=>(r.raiseOnCommittedEvent(),i))}Ai(e,t){return he.or(Object.values(this.ui).map(s=>()=>s.containsKey(e,t)))}}class cLe extends MOe{constructor(e){super(),this.currentSequenceNumber=e}}class uN{constructor(e){this.persistence=e,this.Ri=new cN,this.Vi=null}static mi(e){return new uN(e)}get fi(){if(this.Vi)return this.Vi;throw Qe(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.fi.delete(s.toString()),he.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.fi.add(s.toString()),he.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),he.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(r=>this.fi.add(r.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(i=>this.fi.add(i.toString()))}).next(()=>s.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return he.forEach(this.fi,s=>{const r=He.fromPath(s);return this.gi(e,r).next(i=>{i||t.removeEntry(r,st.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(s=>{s?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return he.or([()=>he.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Qb{constructor(e,t){this.persistence=e,this.pi=new Nc(s=>BOe(s.path),(s,r)=>s.isEqual(r)),this.garbageCollector=ZFe(this,t)}static mi(e,t){return new Qb(e,t)}Ei(){}di(e){return he.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(s=>t.next(r=>s+r))}wr(e){let t=0;return this.pr(e,s=>{t++}).next(()=>t)}pr(e,t){return he.forEach(this.pi,(s,r)=>this.br(e,s,r).next(i=>i?he.resolve():t(r)))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,o=>this.br(e,o,t).next(a=>{a||(s++,i.removeEntry(o,st.min()))})).next(()=>i.apply(e)).next(()=>s)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),he.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),he.resolve()}removeReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),he.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),he.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=$y(e.data.value)),t}br(e,t,s){return he.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.pi.get(t);return he.resolve(r!==void 0&&r>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hN{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.Es=s,this.ds=r}static As(e,t){let s=At(),r=At();for(const i of t.docChanges)switch(i.type){case 0:s=s.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new hN(e,t.fromCache,s,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uLe{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hLe{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return V2e()?8:zOe(Ns())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,r){const i={result:null};return this.ys(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,t,r,s).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new uLe;return this.Ss(e,t,o).next(a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)})}).next(()=>i.result)}bs(e,t,s,r){return s.documentReadCount<this.fs?(Hc()<=_t.DEBUG&&De("QueryEngine","SDK will not create cache indexes for query:",qc(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),he.resolve()):(Hc()<=_t.DEBUG&&De("QueryEngine","Query:",qc(t),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.gs*r?(Hc()<=_t.DEBUG&&De("QueryEngine","The SDK decides to create cache indexes for query:",qc(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ui(t))):he.resolve())}ys(e,t){if(FD(t))return he.resolve(null);let s=Ui(t);return this.indexManager.getIndexType(e,s).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=ES(t,null,"F"),s=Ui(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next(i=>{const o=At(...i);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,s).next(l=>{const c=this.Ds(t,a);return this.Cs(t,c,o,l.readTime)?this.ys(e,ES(t,null,"F")):this.vs(e,c,t,l)}))})))}ws(e,t,s,r){return FD(t)||r.isEqual(st.min())?he.resolve(null):this.ps.getDocuments(e,s).next(i=>{const o=this.Ds(t,i);return this.Cs(t,o,s,r)?he.resolve(null):(Hc()<=_t.DEBUG&&De("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),qc(t)),this.vs(e,o,t,POe(r,af)).next(a=>a))})}Ds(e,t){let s=new Gn(SU(e));return t.forEach((r,i)=>{J0(e,i)&&(s=s.add(i))}),s}Cs(e,t,s,r){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,s){return Hc()<=_t.DEBUG&&De("QueryEngine","Using full collection scan to execute query:",qc(t)),this.ps.getDocumentsMatchingQuery(e,t,Da.min(),s)}vs(e,t,s,r){return this.ps.getDocumentsMatchingQuery(e,s,r).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dN="LocalStore",dLe=3e8;class pLe{constructor(e,t,s,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new gn(Nt),this.xs=new Nc(i=>nN(i),sN),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(s)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new tLe(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function fLe(n,e,t,s){return new pLe(n,e,t,s)}async function XU(n,e){const t=it(n);return await t.persistence.runTransaction("Handle user change","readonly",s=>{let r;return t.mutationQueue.getAllMutationBatches(s).next(i=>(r=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(s))).next(i=>{const o=[],a=[];let l=At();for(const c of r){o.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}for(const c of i){a.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}return t.localDocuments.getDocuments(s,l).next(c=>({Ls:c,removedBatchIds:o,addedBatchIds:a}))})})}function mLe(n,e){const t=it(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const r=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return function(a,l,c,u){const h=c.batch,d=h.keys();let p=he.resolve();return d.forEach(f=>{p=p.next(()=>u.getEntry(l,f)).next(g=>{const m=c.docVersions.get(f);Vt(m!==null,48541),g.version.compareTo(m)<0&&(h.applyToRemoteDocument(g,c),g.isValidDocument()&&(g.setReadTime(c.commitVersion),u.addEntry(g)))})}),p.next(()=>a.mutationQueue.removeMutationBatch(l,h))}(t,s,e,i).next(()=>i.apply(s)).next(()=>t.mutationQueue.performConsistencyCheck(s)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(a){let l=At();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(s,r))})}function YU(n){const e=it(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function gLe(n,e){const t=it(n),s=e.snapshotVersion;let r=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});r=t.Ms;const a=[];e.targetChanges.forEach((u,h)=>{const d=r.get(h);if(!d)return;a.push(t.Pi.removeMatchingKeys(i,u.removedDocuments,h).next(()=>t.Pi.addMatchingKeys(i,u.addedDocuments,h)));let p=d.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(h)!==null?p=p.withResumeToken(gs.EMPTY_BYTE_STRING,st.min()).withLastLimboFreeSnapshotVersion(st.min()):u.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(u.resumeToken,s)),r=r.insert(h,p),function(g,m,y){return g.resumeToken.approximateByteSize()===0||m.snapshotVersion.toMicroseconds()-g.snapshotVersion.toMicroseconds()>=dLe?!0:y.addedDocuments.size+y.modifiedDocuments.size+y.removedDocuments.size>0}(d,p,u)&&a.push(t.Pi.updateTargetData(i,p))});let l=$o(),c=At();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,u))}),a.push(yLe(i,o,e.documentUpdates).next(u=>{l=u.ks,c=u.qs})),!s.isEqual(st.min())){const u=t.Pi.getLastRemoteSnapshotVersion(i).next(h=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,s));a.push(u)}return he.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.Ms=r,i))}function yLe(n,e,t){let s=At(),r=At();return t.forEach(i=>s=s.add(i)),e.getEntries(n,s).next(i=>{let o=$o();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(r=r.add(a)),l.isNoDocument()&&l.version.isEqual(st.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):De(dN,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{ks:o,qs:r}})}function bLe(n,e){const t=it(n);return t.persistence.runTransaction("Get next mutation batch","readonly",s=>(e===void 0&&(e=J_),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e)))}function xLe(n,e){const t=it(n);return t.persistence.runTransaction("Allocate target","readwrite",s=>{let r;return t.Pi.getTargetData(s,e).next(i=>i?(r=i,he.resolve(r)):t.Pi.allocateTargetId(s).next(o=>(r=new da(e,o,"TargetPurposeListen",s.currentSequenceNumber),t.Pi.addTargetData(s,r).next(()=>r))))}).then(s=>{const r=t.Ms.get(s.targetId);return(r===null||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(s.targetId,s),t.xs.set(e,s.targetId)),s})}async function $S(n,e,t){const s=it(n),r=s.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",i,o=>s.persistence.referenceDelegate.removeTarget(o,r))}catch(o){if(!hd(o))throw o;De(dN,`Failed to update sequence numbers for target ${e}: ${o}`)}s.Ms=s.Ms.remove(e),s.xs.delete(r.target)}function XD(n,e,t){const s=it(n);let r=st.min(),i=At();return s.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,u){const h=it(l),d=h.xs.get(u);return d!==void 0?he.resolve(h.Ms.get(d)):h.Pi.getTargetData(c,u)}(s,o,Ui(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>s.Fs.getDocumentsMatchingQuery(o,e,t?r:st.min(),t?i:At())).next(a=>(wLe(s,oFe(e),a),{documents:a,Qs:i})))}function wLe(n,e,t){let s=n.Os.get(e)||st.min();t.forEach((r,i)=>{i.readTime.compareTo(s)>0&&(s=i.readTime)}),n.Os.set(e,s)}class YD{constructor(){this.activeTargetIds=dFe()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class vLe{constructor(){this.Mo=new YD,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,s){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new YD,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ILe{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QD="ConnectivityMonitor";class ZD{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){De(QD,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){De(QD,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ry=null;function DS(){return ry===null?ry=function(){return 268435456+Math.round(2147483648*Math.random())}():ry++,"0x"+ry.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v1="RestConnection",SLe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class kLe{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${s}/databases/${r}`,this.Wo=this.databaseId.database===Hb?`project_id=${s}`:`project_id=${s}&database_id=${r}`}Go(e,t,s,r,i){const o=DS(),a=this.zo(e,t.toUriEncodedString());De(v1,`Sending RPC '${e}' ${o}:`,a,s);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,r,i);const{host:c}=new URL(a),u=od(c);return this.Jo(e,a,l,s,u).then(h=>(De(v1,`Received RPC '${e}' ${o}: `,h),h),h=>{throw Ru(v1,`RPC '${e}' ${o} failed with error: `,h,"url: ",a,"request:",s),h})}Ho(e,t,s,r,i,o){return this.Go(e,t,s,r,i)}jo(e,t,s){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+cd}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((r,i)=>e[i]=r),s&&s.headers.forEach((r,i)=>e[i]=r)}zo(e,t){const s=SLe[e];return`${this.Uo}/v1/${t}:${s}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TLe{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xs="WebChannelConnection";class CLe extends kLe{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,s,r,i){const o=DS();return new Promise((a,l)=>{const c=new Qj;c.setWithCredentials(!0),c.listenOnce(Zj.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Ry.NO_ERROR:const h=c.getResponseJson();De(xs,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(h)),a(h);break;case Ry.TIMEOUT:De(xs,`RPC '${e}' ${o} timed out`),l(new We(ge.DEADLINE_EXCEEDED,"Request time out"));break;case Ry.HTTP_ERROR:const d=c.getStatus();if(De(xs,`RPC '${e}' ${o} failed with status:`,d,"response text:",c.getResponseText()),d>0){let p=c.getResponseJson();Array.isArray(p)&&(p=p[0]);const f=p==null?void 0:p.error;if(f&&f.status&&f.message){const g=function(y){const w=y.toLowerCase().replace(/_/g,"-");return Object.values(ge).indexOf(w)>=0?w:ge.UNKNOWN}(f.status);l(new We(g,f.message))}else l(new We(ge.UNKNOWN,"Server responded with status "+c.getStatus()))}else l(new We(ge.UNAVAILABLE,"Connection failed."));break;default:Qe(9055,{l_:e,streamId:o,h_:c.getLastErrorCode(),P_:c.getLastError()})}}finally{De(xs,`RPC '${e}' ${o} completed.`)}});const u=JSON.stringify(r);De(xs,`RPC '${e}' ${o} sending request:`,r),c.send(t,"POST",u,s,15)})}T_(e,t,s){const r=DS(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=tU(),a=eU(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,s),l.encodeInitMessageHeaders=!0;const u=i.join("");De(xs,`Creating RPC '${e}' stream ${r}: ${u}`,l);const h=o.createWebChannel(u,l);this.I_(h);let d=!1,p=!1;const f=new TLe({Yo:m=>{p?De(xs,`Not sending because RPC '${e}' stream ${r} is closed:`,m):(d||(De(xs,`Opening RPC '${e}' stream ${r} transport.`),h.open(),d=!0),De(xs,`RPC '${e}' stream ${r} sending:`,m),h.send(m))},Zo:()=>h.close()}),g=(m,y,w)=>{m.listen(y,v=>{try{w(v)}catch(I){setTimeout(()=>{throw I},0)}})};return g(h,Qd.EventType.OPEN,()=>{p||(De(xs,`RPC '${e}' stream ${r} transport opened.`),f.o_())}),g(h,Qd.EventType.CLOSE,()=>{p||(p=!0,De(xs,`RPC '${e}' stream ${r} transport closed`),f.a_(),this.E_(h))}),g(h,Qd.EventType.ERROR,m=>{p||(p=!0,Ru(xs,`RPC '${e}' stream ${r} transport errored. Name:`,m.name,"Message:",m.message),f.a_(new We(ge.UNAVAILABLE,"The operation could not be completed")))}),g(h,Qd.EventType.MESSAGE,m=>{var y;if(!p){const w=m.data[0];Vt(!!w,16349);const v=w,I=(v==null?void 0:v.error)||((y=v[0])==null?void 0:y.error);if(I){De(xs,`RPC '${e}' stream ${r} received error:`,I);const _=I.status;let N=function(k){const S=Rn[k];if(S!==void 0)return LU(S)}(_),T=I.message;N===void 0&&(N=ge.INTERNAL,T="Unknown error status: "+_+" with message "+I.message),p=!0,f.a_(new We(N,T)),h.close()}else De(xs,`RPC '${e}' stream ${r} received:`,w),f.u_(w)}}),g(a,Jj.STAT_EVENT,m=>{m.stat===vS.PROXY?De(xs,`RPC '${e}' stream ${r} detected buffering proxy`):m.stat===vS.NOPROXY&&De(xs,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{f.__()},0),f}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function I1(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sv(n){return new AFe(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QU{constructor(e,t,s=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=s,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-s);r>0&&De("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JD="PersistentStream";class ZU{constructor(e,t,s,r,i,o,a,l){this.Mi=e,this.S_=s,this.b_=r,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new QU(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===ge.RESOURCE_EXHAUSTED?(Ro(t.toString()),Ro("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===ge.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,r])=>{this.D_===t&&this.G_(s,r)},s=>{e(()=>{const r=new We(ge.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(r)})})}G_(e,t){const s=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{s(()=>this.listener.Xo())}),this.stream.t_(()=>{s(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(r=>{s(()=>this.z_(r))}),this.stream.onMessage(r=>{s(()=>++this.F_==1?this.J_(r):this.onNext(r))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return De(JD,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(De(JD,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ELe extends ZU{constructor(e,t,s,r,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=DFe(this.serializer,e),s=function(i){if(!("targetChange"in i))return st.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?st.min():o.readTime?Wi(o.readTime):st.min()}(e);return this.listener.H_(t,s)}Y_(e){const t={};t.database=RS(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=CS(l)?{documents:FFe(i,l)}:{query:LFe(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=VU(i,o.resumeToken);const c=_S(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(st.min())>0){a.readTime=Yb(i,o.snapshotVersion.toTimestamp());const c=_S(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const s=zFe(this.serializer,e);s&&(t.labels=s),this.q_(t)}Z_(e){const t={};t.database=RS(this.serializer),t.removeTarget=e,this.q_(t)}}class _Le extends ZU{constructor(e,t,s,r,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Vt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Vt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Vt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=OFe(e.writeResults,e.commitTime),s=Wi(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=RS(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(s=>PFe(this.serializer,s))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NLe{}class ALe extends NLe{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new We(ge.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,NS(t,s),r,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===ge.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new We(ge.UNKNOWN,i.toString())})}Ho(e,t,s,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,NS(t,s),r,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===ge.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new We(ge.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class RLe{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ro(t),this.aa=!1):De("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ic="RemoteStore";class $Le{constructor(e,t,s,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{s.enqueueAndForget(async()=>{Rc(this)&&(De(ic,"Restarting streams for network reachability change."),await async function(l){const c=it(l);c.Ea.add(4),await xg(c),c.Ra.set("Unknown"),c.Ea.delete(4),await rv(c)}(this))})}),this.Ra=new RLe(s,r)}}async function rv(n){if(Rc(n))for(const e of n.da)await e(!0)}async function xg(n){for(const e of n.da)await e(!1)}function JU(n,e){const t=it(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),gN(t)?mN(t):dd(t).O_()&&fN(t,e))}function pN(n,e){const t=it(n),s=dd(t);t.Ia.delete(e),s.O_()&&eW(t,e),t.Ia.size===0&&(s.O_()?s.L_():Rc(t)&&t.Ra.set("Unknown"))}function fN(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(st.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}dd(n).Y_(e)}function eW(n,e){n.Va.Ue(e),dd(n).Z_(e)}function mN(n){n.Va=new CFe({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),dd(n).start(),n.Ra.ua()}function gN(n){return Rc(n)&&!dd(n).x_()&&n.Ia.size>0}function Rc(n){return it(n).Ea.size===0}function tW(n){n.Va=void 0}async function DLe(n){n.Ra.set("Online")}async function PLe(n){n.Ia.forEach((e,t)=>{fN(n,e)})}async function OLe(n,e){tW(n),gN(n)?(n.Ra.ha(e),mN(n)):n.Ra.set("Unknown")}async function FLe(n,e,t){if(n.Ra.set("Online"),e instanceof zU&&e.state===2&&e.cause)try{await async function(r,i){const o=i.cause;for(const a of i.targetIds)r.Ia.has(a)&&(await r.remoteSyncer.rejectListen(a,o),r.Ia.delete(a),r.Va.removeTarget(a))}(n,e)}catch(s){De(ic,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await Zb(n,s)}else if(e instanceof Oy?n.Va.Ze(e):e instanceof MU?n.Va.st(e):n.Va.tt(e),!t.isEqual(st.min()))try{const s=await YU(n.localStore);t.compareTo(s)>=0&&await function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const u=i.Ia.get(c);u&&i.Ia.set(c,u.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const u=i.Ia.get(l);if(!u)return;i.Ia.set(l,u.withResumeToken(gs.EMPTY_BYTE_STRING,u.snapshotVersion)),eW(i,l);const h=new da(u.target,l,c,u.sequenceNumber);fN(i,h)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(s){De(ic,"Failed to raise snapshot:",s),await Zb(n,s)}}async function Zb(n,e,t){if(!hd(e))throw e;n.Ea.add(1),await xg(n),n.Ra.set("Offline"),t||(t=()=>YU(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{De(ic,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await rv(n)})}function nW(n,e){return e().catch(t=>Zb(n,t,e))}async function iv(n){const e=it(n),t=La(e);let s=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:J_;for(;LLe(e);)try{const r=await bLe(e.localStore,s);if(r===null){e.Ta.length===0&&t.L_();break}s=r.batchId,MLe(e,r)}catch(r){await Zb(e,r)}sW(e)&&rW(e)}function LLe(n){return Rc(n)&&n.Ta.length<10}function MLe(n,e){n.Ta.push(e);const t=La(n);t.O_()&&t.X_&&t.ea(e.mutations)}function sW(n){return Rc(n)&&!La(n).x_()&&n.Ta.length>0}function rW(n){La(n).start()}async function zLe(n){La(n).ra()}async function VLe(n){const e=La(n);for(const t of n.Ta)e.ea(t.mutations)}async function BLe(n,e,t){const s=n.Ta.shift(),r=oN.from(s,e,t);await nW(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),await iv(n)}async function jLe(n,e){e&&La(n).X_&&await async function(s,r){if(function(o){return SFe(o)&&o!==ge.ABORTED}(r.code)){const i=s.Ta.shift();La(s).B_(),await nW(s,()=>s.remoteSyncer.rejectFailedWrite(i.batchId,r)),await iv(s)}}(n,e),sW(n)&&rW(n)}async function eP(n,e){const t=it(n);t.asyncQueue.verifyOperationInProgress(),De(ic,"RemoteStore received new credentials");const s=Rc(t);t.Ea.add(3),await xg(t),s&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await rv(t)}async function ULe(n,e){const t=it(n);e?(t.Ea.delete(2),await rv(t)):e||(t.Ea.add(2),await xg(t),t.Ra.set("Unknown"))}function dd(n){return n.ma||(n.ma=function(t,s,r){const i=it(t);return i.sa(),new ELe(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(n.datastore,n.asyncQueue,{Xo:DLe.bind(null,n),t_:PLe.bind(null,n),r_:OLe.bind(null,n),H_:FLe.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),gN(n)?mN(n):n.Ra.set("Unknown")):(await n.ma.stop(),tW(n))})),n.ma}function La(n){return n.fa||(n.fa=function(t,s,r){const i=it(t);return i.sa(),new _Le(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:zLe.bind(null,n),r_:jLe.bind(null,n),ta:VLe.bind(null,n),na:BLe.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await iv(n)):(await n.fa.stop(),n.Ta.length>0&&(De(ic,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yN{constructor(e,t,s,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=i,this.deferred=new wa,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,r,i){const o=Date.now()+s,a=new yN(e,t,o,r,i);return a.start(s),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new We(ge.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function bN(n,e){if(Ro("AsyncQueue",`${e}: ${n}`),hd(n))return new We(ge.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ou{static emptySet(e){return new ou(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||He.comparator(t.key,s.key):(t,s)=>He.comparator(t.key,s.key),this.keyedMap=Zd(),this.sortedSet=new gn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,s)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ou)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(!r.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new ou;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tP{constructor(){this.ga=new gn(He.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Qe(63341,{Rt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,s)=>{e.push(s)}),e}}class Fu{constructor(e,t,s,r,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,s,r,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Fu(e,t,ou.emptySet(t),o,s,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Z0(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WLe{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class GLe{constructor(){this.queries=nP(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const r=it(t),i=r.queries;r.queries=nP(),i.forEach((o,a)=>{for(const l of a.Sa)l.onError(s)})})(this,new We(ge.ABORTED,"Firestore shutting down"))}}function nP(){return new Nc(n=>IU(n),Z0)}async function HLe(n,e){const t=it(n);let s=3;const r=e.query;let i=t.queries.get(r);i?!i.ba()&&e.Da()&&(s=2):(i=new WLe,s=e.Da()?0:1);try{switch(s){case 0:i.wa=await t.onListen(r,!0);break;case 1:i.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(o){const a=bN(o,`Initialization of query '${qc(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&xN(t)}async function qLe(n,e){const t=it(n),s=e.query;let r=3;const i=t.queries.get(s);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?r=e.Da()?0:1:!i.ba()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function KLe(n,e){const t=it(n);let s=!1;for(const r of e){const i=r.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(r)&&(s=!0);o.wa=r}}s&&xN(t)}function XLe(n,e,t){const s=it(n),r=s.queries.get(e);if(r)for(const i of r.Sa)i.onError(t);s.queries.delete(e)}function xN(n){n.Ca.forEach(e=>{e.next()})}var PS,sP;(sP=PS||(PS={})).Ma="default",sP.Cache="cache";class YLe{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)r.type!==3&&s.push(r);e=new Fu(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.qa||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Fu.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==PS.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iW{constructor(e){this.key=e}}class oW{constructor(e){this.key=e}}class QLe{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=At(),this.mutatedKeys=At(),this.eu=SU(e),this.tu=new ou(this.eu)}get nu(){return this.Ya}ru(e,t){const s=t?t.iu:new tP,r=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1;const l=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,c=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((u,h)=>{const d=r.get(u),p=J0(this.query,h)?h:null,f=!!d&&this.mutatedKeys.has(d.key),g=!!p&&(p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations);let m=!1;d&&p?d.data.isEqual(p.data)?f!==g&&(s.track({type:3,doc:p}),m=!0):this.su(d,p)||(s.track({type:2,doc:p}),m=!0,(l&&this.eu(p,l)>0||c&&this.eu(p,c)<0)&&(a=!0)):!d&&p?(s.track({type:0,doc:p}),m=!0):d&&!p&&(s.track({type:1,doc:d}),m=!0,(l||c)&&(a=!0)),m&&(p?(o=o.add(p),i=g?i.add(u):i.delete(u)):(o=o.delete(u),i=i.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),i=i.delete(u.key),s.track({type:1,doc:u})}return{tu:o,iu:s,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,r){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((u,h)=>function(p,f){const g=m=>{switch(m){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Qe(20277,{Rt:m})}};return g(p)-g(f)}(u.type,h.type)||this.eu(u.doc,h.doc)),this.ou(s),r=r??!1;const a=t&&!r?this._u():[],l=this.Xa.size===0&&this.current&&!r?1:0,c=l!==this.Za;return this.Za=l,o.length!==0||c?{snapshot:new Fu(this.query,e.tu,i,o,e.mutatedKeys,l===0,c,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new tP,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=At(),this.tu.forEach(s=>{this.uu(s.key)&&(this.Xa=this.Xa.add(s.key))});const t=[];return e.forEach(s=>{this.Xa.has(s)||t.push(new oW(s))}),this.Xa.forEach(s=>{e.has(s)||t.push(new iW(s))}),t}cu(e){this.Ya=e.Qs,this.Xa=At();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Fu.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const wN="SyncEngine";class ZLe{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class JLe{constructor(e){this.key=e,this.hu=!1}}class eMe{constructor(e,t,s,r,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Nc(a=>IU(a),Z0),this.Iu=new Map,this.Eu=new Set,this.du=new gn(He.comparator),this.Au=new Map,this.Ru=new cN,this.Vu={},this.mu=new Map,this.fu=Ou.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function tMe(n,e,t=!0){const s=dW(n);let r;const i=s.Tu.get(e);return i?(s.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.lu()):r=await aW(s,e,t,!0),r}async function nMe(n,e){const t=dW(n);await aW(t,e,!0,!1)}async function aW(n,e,t,s){const r=await xLe(n.localStore,Ui(e)),i=r.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return s&&(a=await sMe(n,e,i,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&JU(n.remoteStore,r),a}async function sMe(n,e,t,s,r){n.pu=(h,d,p)=>async function(g,m,y,w){let v=m.view.ru(y);v.Cs&&(v=await XD(g.localStore,m.query,!1).then(({documents:T})=>m.view.ru(T,v)));const I=w&&w.targetChanges.get(m.targetId),_=w&&w.targetMismatches.get(m.targetId)!=null,N=m.view.applyChanges(v,g.isPrimaryClient,I,_);return iP(g,m.targetId,N.au),N.snapshot}(n,h,d,p);const i=await XD(n.localStore,e,!0),o=new QLe(e,i.Qs),a=o.ru(i.documents),l=bg.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",r),c=o.applyChanges(a,n.isPrimaryClient,l);iP(n,t,c.au);const u=new ZLe(e,t,o);return n.Tu.set(e,u),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),c.snapshot}async function rMe(n,e,t){const s=it(n),r=s.Tu.get(e),i=s.Iu.get(r.targetId);if(i.length>1)return s.Iu.set(r.targetId,i.filter(o=>!Z0(o,e))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await $S(s.localStore,r.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(r.targetId),t&&pN(s.remoteStore,r.targetId),OS(s,r.targetId)}).catch(ud)):(OS(s,r.targetId),await $S(s.localStore,r.targetId,!0))}async function iMe(n,e){const t=it(n),s=t.Tu.get(e),r=t.Iu.get(s.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),pN(t.remoteStore,s.targetId))}async function oMe(n,e,t){const s=pMe(n);try{const r=await function(o,a){const l=it(o),c=rn.now(),u=a.reduce((p,f)=>p.add(f.key),At());let h,d;return l.persistence.runTransaction("Locally write mutations","readwrite",p=>{let f=$o(),g=At();return l.Ns.getEntries(p,u).next(m=>{f=m,f.forEach((y,w)=>{w.isValidDocument()||(g=g.add(y))})}).next(()=>l.localDocuments.getOverlayedDocuments(p,f)).next(m=>{h=m;const y=[];for(const w of a){const v=bFe(w,h.get(w.key).overlayedDocument);v!=null&&y.push(new Ac(w.key,v,mU(v.value.mapValue),bo.exists(!0)))}return l.mutationQueue.addMutationBatch(p,c,y,a)}).next(m=>{d=m;const y=m.applyToLocalDocumentSet(h,g);return l.documentOverlayCache.saveOverlays(p,m.batchId,y)})}).then(()=>({batchId:d.batchId,changes:TU(h)}))}(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),function(o,a,l){let c=o.Vu[o.currentUser.toKey()];c||(c=new gn(Nt)),c=c.insert(a,l),o.Vu[o.currentUser.toKey()]=c}(s,r.batchId,t),await wg(s,r.changes),await iv(s.remoteStore)}catch(r){const i=bN(r,"Failed to persist write");t.reject(i)}}async function lW(n,e){const t=it(n);try{const s=await gLe(t.localStore,e);e.targetChanges.forEach((r,i)=>{const o=t.Au.get(i);o&&(Vt(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?o.hu=!0:r.modifiedDocuments.size>0?Vt(o.hu,14607):r.removedDocuments.size>0&&(Vt(o.hu,42227),o.hu=!1))}),await wg(t,s,e)}catch(s){await ud(s)}}function rP(n,e,t){const s=it(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const r=[];s.Tu.forEach((i,o)=>{const a=o.view.va(e);a.snapshot&&r.push(a.snapshot)}),function(o,a){const l=it(o);l.onlineState=a;let c=!1;l.queries.forEach((u,h)=>{for(const d of h.Sa)d.va(a)&&(c=!0)}),c&&xN(l)}(s.eventManager,e),r.length&&s.Pu.H_(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function aMe(n,e,t){const s=it(n);s.sharedClientState.updateQueryState(e,"rejected",t);const r=s.Au.get(e),i=r&&r.key;if(i){let o=new gn(He.comparator);o=o.insert(i,Ss.newNoDocument(i,st.min()));const a=At().add(i),l=new nv(st.min(),new Map,new gn(Nt),o,a);await lW(s,l),s.du=s.du.remove(i),s.Au.delete(e),vN(s)}else await $S(s.localStore,e,!1).then(()=>OS(s,e,t)).catch(ud)}async function lMe(n,e){const t=it(n),s=e.batch.batchId;try{const r=await mLe(t.localStore,e);uW(t,s,null),cW(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),await wg(t,r)}catch(r){await ud(r)}}async function cMe(n,e,t){const s=it(n);try{const r=await function(o,a){const l=it(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let u;return l.mutationQueue.lookupMutationBatch(c,a).next(h=>(Vt(h!==null,37113),u=h.keys(),l.mutationQueue.removeMutationBatch(c,h))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,u,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,u)).next(()=>l.localDocuments.getDocuments(c,u))})}(s.localStore,e);uW(s,e,t),cW(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),await wg(s,r)}catch(r){await ud(r)}}function cW(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function uW(n,e,t){const s=it(n);let r=s.Vu[s.currentUser.toKey()];if(r){const i=r.get(e);i&&(t?i.reject(t):i.resolve(),r=r.remove(e)),s.Vu[s.currentUser.toKey()]=r}}function OS(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Iu.get(e))n.Tu.delete(s),t&&n.Pu.yu(s,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(s=>{n.Ru.containsKey(s)||hW(n,s)})}function hW(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(pN(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),vN(n))}function iP(n,e,t){for(const s of t)s instanceof iW?(n.Ru.addReference(s.key,e),uMe(n,s)):s instanceof oW?(De(wN,"Document no longer in limbo: "+s.key),n.Ru.removeReference(s.key,e),n.Ru.containsKey(s.key)||hW(n,s.key)):Qe(19791,{wu:s})}function uMe(n,e){const t=e.key,s=t.path.canonicalString();n.du.get(t)||n.Eu.has(s)||(De(wN,"New document in limbo: "+t),n.Eu.add(s),vN(n))}function vN(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new He(fn.fromString(e)),s=n.fu.next();n.Au.set(s,new JLe(t)),n.du=n.du.insert(t,s),JU(n.remoteStore,new da(Ui(rN(t.path)),s,"TargetPurposeLimboResolution",K0.ce))}}async function wg(n,e,t){const s=it(n),r=[],i=[],o=[];s.Tu.isEmpty()||(s.Tu.forEach((a,l)=>{o.push(s.pu(l,e,t).then(c=>{var u;if((c||t)&&s.isPrimaryClient){const h=c?!c.fromCache:(u=t==null?void 0:t.targetChanges.get(l.targetId))==null?void 0:u.current;s.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(c){r.push(c);const h=hN.As(l.targetId,c);i.push(h)}}))}),await Promise.all(o),s.Pu.H_(r),await async function(l,c){const u=it(l);try{await u.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>he.forEach(c,d=>he.forEach(d.Es,p=>u.persistence.referenceDelegate.addReference(h,d.targetId,p)).next(()=>he.forEach(d.ds,p=>u.persistence.referenceDelegate.removeReference(h,d.targetId,p)))))}catch(h){if(!hd(h))throw h;De(dN,"Failed to update sequence numbers: "+h)}for(const h of c){const d=h.targetId;if(!h.fromCache){const p=u.Ms.get(d),f=p.snapshotVersion,g=p.withLastLimboFreeSnapshotVersion(f);u.Ms=u.Ms.insert(d,g)}}}(s.localStore,i))}async function hMe(n,e){const t=it(n);if(!t.currentUser.isEqual(e)){De(wN,"User change. New user:",e.toKey());const s=await XU(t.localStore,e);t.currentUser=e,function(i,o){i.mu.forEach(a=>{a.forEach(l=>{l.reject(new We(ge.CANCELLED,o))})}),i.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await wg(t,s.Ls)}}function dMe(n,e){const t=it(n),s=t.Au.get(e);if(s&&s.hu)return At().add(s.key);{let r=At();const i=t.Iu.get(e);if(!i)return r;for(const o of i){const a=t.Tu.get(o);r=r.unionWith(a.view.nu)}return r}}function dW(n){const e=it(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=lW.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=dMe.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=aMe.bind(null,e),e.Pu.H_=KLe.bind(null,e.eventManager),e.Pu.yu=XLe.bind(null,e.eventManager),e}function pMe(n){const e=it(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=lMe.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=cMe.bind(null,e),e}class Jb{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=sv(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return fLe(this.persistence,new hLe,e.initialUser,this.serializer)}Cu(e){return new KU(uN.mi,this.serializer)}Du(e){return new vLe}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Jb.provider={build:()=>new Jb};class fMe extends Jb{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Vt(this.persistence.referenceDelegate instanceof Qb,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new YFe(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?nr.withCacheSize(this.cacheSizeBytes):nr.DEFAULT;return new KU(s=>Qb.mi(s,t),this.serializer)}}class FS{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>rP(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=hMe.bind(null,this.syncEngine),await ULe(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new GLe}()}createDatastore(e){const t=sv(e.databaseInfo.databaseId),s=function(i){return new CLe(i)}(e.databaseInfo);return function(i,o,a,l){return new ALe(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return function(s,r,i,o,a){return new $Le(s,r,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>rP(this.syncEngine,t,0),function(){return ZD.v()?new ZD:new ILe}())}createSyncEngine(e,t){return function(r,i,o,a,l,c,u){const h=new eMe(r,i,o,a,l,c);return u&&(h.gu=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(r){const i=it(r);De(ic,"RemoteStore shutting down."),i.Ea.add(5),await xg(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}FS.provider={build:()=>new FS};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mMe{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ro("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ma="FirestoreClient";class gMe{constructor(e,t,s,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=r,this.user=ws.UNAUTHENTICATED,this.clientId=Q_.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(s,async o=>{De(Ma,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(s,o=>(De(Ma,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new wa;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=bN(t,"Failed to shutdown persistence");e.reject(s)}}),e.promise}}async function S1(n,e){n.asyncQueue.verifyOperationInProgress(),De(Ma,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener(async r=>{s.isEqual(r)||(await XU(e.localStore,r),s=r)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function oP(n,e){n.asyncQueue.verifyOperationInProgress();const t=await yMe(n);De(Ma,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(s=>eP(e.remoteStore,s)),n.setAppCheckTokenChangeListener((s,r)=>eP(e.remoteStore,r)),n._onlineComponents=e}async function yMe(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){De(Ma,"Using user provided OfflineComponentProvider");try{await S1(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(r){return r.name==="FirebaseError"?r.code===ge.FAILED_PRECONDITION||r.code===ge.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(t))throw t;Ru("Error using user provided cache. Falling back to memory cache: "+t),await S1(n,new Jb)}}else De(Ma,"Using default OfflineComponentProvider"),await S1(n,new fMe(void 0));return n._offlineComponents}async function pW(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(De(Ma,"Using user provided OnlineComponentProvider"),await oP(n,n._uninitializedComponentsProvider._online)):(De(Ma,"Using default OnlineComponentProvider"),await oP(n,new FS))),n._onlineComponents}function bMe(n){return pW(n).then(e=>e.syncEngine)}async function xMe(n){const e=await pW(n),t=e.eventManager;return t.onListen=tMe.bind(null,e.syncEngine),t.onUnlisten=rMe.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=nMe.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=iMe.bind(null,e.syncEngine),t}function wMe(n,e,t={}){const s=new wa;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const u=new mMe({next:d=>{u.Nu(),o.enqueueAndForget(()=>qLe(i,h));const p=d.docs.has(a);!p&&d.fromCache?c.reject(new We(ge.UNAVAILABLE,"Failed to get document because the client is offline.")):p&&d.fromCache&&l&&l.source==="server"?c.reject(new We(ge.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new YLe(rN(a.path),u,{includeMetadataChanges:!0,qa:!0});return HLe(i,h)}(await xMe(n),n.asyncQueue,e,t,s)),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fW(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aP=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mW="firestore.googleapis.com",lP=!0;class cP{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new We(ge.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=mW,this.ssl=lP}else this.host=e.host,this.ssl=e.ssl??lP;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=qU;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<KFe)throw new We(ge.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}DOe("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=fW(e.experimentalLongPollingOptions??{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new We(ge.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new We(ge.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new We(ge.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(s,r){return s.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class IN{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new cP({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new We(ge.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new We(ge.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new cP(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new IOe;switch(s.type){case"firstParty":return new COe(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new We(ge.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const s=aP.get(t);s&&(De("ComponentProvider","Removing Datastore"),aP.delete(t),s.terminate())}(this),Promise.resolve()}}function vMe(n,e,t,s={}){var c;n=of(n,IN);const r=od(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;r&&(sj(`https://${a}`),rj("Firestore",!0)),i.host!==mW&&i.host!==a&&Ru("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:r,emulatorOptions:s};if(!$a(l,o)&&(n._setSettings(l),s.mockUserToken)){let u,h;if(typeof s.mockUserToken=="string")u=s.mockUserToken,h=ws.MOCK_USER;else{u=$2e(s.mockUserToken,(c=n._app)==null?void 0:c.options.projectId);const d=s.mockUserToken.sub||s.mockUserToken.user_id;if(!d)throw new We(ge.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new ws(d)}n._authCredentials=new SOe(new sU(u,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SN{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new SN(this.firestore,e,this._query)}}class rs{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new mf(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new rs(this.firestore,e,this._key)}toJSON(){return{type:rs._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(gg(t,rs._jsonSchema))return new rs(e,s||null,new He(fn.fromString(t.referencePath)))}}rs._jsonSchemaVersion="firestore/documentReference/1.0",rs._jsonSchema={type:Fn("string",rs._jsonSchemaVersion),referencePath:Fn("string")};class mf extends SN{constructor(e,t,s){super(e,t,rN(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new rs(this.firestore,null,new He(e))}withConverter(e){return new mf(this.firestore,e,this._path)}}function k1(n,e,...t){if(n=ms(n),arguments.length===1&&(e=Q_.newId()),$Oe("doc","path",e),n instanceof IN){const s=fn.fromString(e,...t);return SD(s),new rs(n,null,new He(s))}{if(!(n instanceof rs||n instanceof mf))throw new We(ge.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(fn.fromString(e,...t));return SD(s),new rs(n.firestore,n instanceof mf?n.converter:null,new He(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uP="AsyncQueue";class hP{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new QU(this,"async_queue_retry"),this._c=()=>{const s=I1();s&&De(uP,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=I1();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=I1();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new wa;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!hd(e))throw e;De(uP,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(s=>{throw this.nc=s,this.rc=!1,Ro("INTERNAL UNHANDLED ERROR: ",dP(s)),s}).then(s=>(this.rc=!1,s))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=yN.createAndSchedule(this,e,t,s,i=>this.hc(i));return this.tc.push(r),r}uc(){this.nc&&Qe(47125,{Pc:dP(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,s)=>t.targetTimeMs-s.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function dP(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class kN extends IN{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new hP,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new hP(e),this._firestoreClient=void 0,await e}}}function IMe(n,e){const t=typeof n=="object"?n:z_(),s=typeof n=="string"?n:e||Hb,r=Ec(t,"firestore").getImmediate({identifier:s});if(!r._initialized){const i=A2e("firestore");i&&vMe(r,...i)}return r}function gW(n){if(n._terminated)throw new We(ge.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||SMe(n),n._firestoreClient}function SMe(n){var s,r,i;const e=n._freezeSettings(),t=function(a,l,c,u){return new WOe(a,l,c,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,fW(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)}(n._databaseId,((s=n._app)==null?void 0:s.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(r=e.localCache)!=null&&r._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new gMe(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Fr(gs.fromBase64String(e))}catch(t){throw new We(ge.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Fr(gs.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Fr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(gg(e,Fr._jsonSchema))return Fr.fromBase64String(e.bytes)}}Fr._jsonSchemaVersion="firestore/bytes/1.0",Fr._jsonSchema={type:Fn("string",Fr._jsonSchemaVersion),bytes:Fn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TN{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new We(ge.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new fs(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ov{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new We(ge.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new We(ge.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Nt(this._lat,e._lat)||Nt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Gi._jsonSchemaVersion}}static fromJSON(e){if(gg(e,Gi._jsonSchema))return new Gi(e.latitude,e.longitude)}}Gi._jsonSchemaVersion="firestore/geoPoint/1.0",Gi._jsonSchema={type:Fn("string",Gi._jsonSchemaVersion),latitude:Fn("number"),longitude:Fn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hi{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(s,r){if(s.length!==r.length)return!1;for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Hi._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(gg(e,Hi._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new Hi(e.vectorValues);throw new We(ge.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Hi._jsonSchemaVersion="firestore/vectorValue/1.0",Hi._jsonSchema={type:Fn("string",Hi._jsonSchemaVersion),vectorValues:Fn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kMe=/^__.*__$/;class TMe{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return this.fieldMask!==null?new Ac(e,this.data,this.fieldMask,t,this.fieldTransforms):new yg(e,this.data,t,this.fieldTransforms)}}function yW(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Qe(40011,{Ac:n})}}class CN{constructor(e,t,s,r,i,o){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=r,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new CN({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var r;const t=(r=this.path)==null?void 0:r.child(e),s=this.Vc({path:t,fc:!1});return s.gc(e),s}yc(e){var r;const t=(r=this.path)==null?void 0:r.child(e),s=this.Vc({path:t,fc:!1});return s.Rc(),s}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return ex(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(yW(this.Ac)&&kMe.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class CMe{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||sv(e)}Cc(e,t,s,r=!1){return new CN({Ac:e,methodName:t,Dc:s,path:fs.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function EMe(n){const e=n._freezeSettings(),t=sv(n._databaseId);return new CMe(n._databaseId,!!e.ignoreUndefinedProperties,t)}function _Me(n,e,t,s,r,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,r);vW("Data must be an object, but it was:",o,s);const a=xW(s,o);let l,c;if(i.merge)l=new si(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const u=[];for(const h of i.mergeFields){const d=NMe(e,h,t);if(!o.contains(d))throw new We(ge.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);RMe(u,d)||u.push(d)}l=new si(u),c=o.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,c=o.fieldTransforms;return new TMe(new Or(a),l,c)}class EN extends ov{_toFieldTransform(e){return new DU(e.path,new hf)}isEqual(e){return e instanceof EN}}class _N extends ov{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new ff(e.serializer,_U(e.serializer,this.Fc));return new DU(e.path,t)}isEqual(e){return e instanceof _N&&this.Fc===e.Fc}}function bW(n,e){if(wW(n=ms(n)))return vW("Unsupported field value:",e,n),xW(n,e);if(n instanceof ov)return function(s,r){if(!yW(r.Ac))throw r.Sc(`${s._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Sc(`${s._methodName}() is not currently supported inside arrays`);const i=s._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(s,r){const i=[];let o=0;for(const a of s){let l=bW(a,r.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(s,r){if((s=ms(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return _U(r.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const i=rn.fromDate(s);return{timestampValue:Yb(r.serializer,i)}}if(s instanceof rn){const i=new rn(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:Yb(r.serializer,i)}}if(s instanceof Gi)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Fr)return{bytesValue:VU(r.serializer,s._byteString)};if(s instanceof rs){const i=r.databaseId,o=s.firestore._databaseId;if(!o.isEqual(i))throw r.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:lN(s.firestore._databaseId||r.databaseId,s._key.path)}}if(s instanceof Hi)return function(o,a){return{mapValue:{fields:{[dU]:{stringValue:fU},[qb]:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw a.Sc("VectorValues must only contain numeric values.");return iN(a.serializer,c)})}}}}}}(s,r);throw r.Sc(`Unsupported field value: ${Z_(s)}`)}(n,e)}function xW(n,e){const t={};return oU(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):_c(n,(s,r)=>{const i=bW(r,e.mc(s));i!=null&&(t[s]=i)}),{mapValue:{fields:t}}}function wW(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof rn||n instanceof Gi||n instanceof Fr||n instanceof rs||n instanceof ov||n instanceof Hi)}function vW(n,e,t){if(!wW(t)||!rU(t)){const s=Z_(t);throw s==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+s)}}function NMe(n,e,t){if((e=ms(e))instanceof TN)return e._internalPath;if(typeof e=="string")return IW(n,e);throw ex("Field path arguments must be of type string or ",n,!1,void 0,t)}const AMe=new RegExp("[~\\*/\\[\\]]");function IW(n,e,t){if(e.search(AMe)>=0)throw ex(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new TN(...e.split("."))._internalPath}catch{throw ex(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function ex(n,e,t,s,r){const i=s&&!s.isEmpty(),o=r!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${s}`),o&&(l+=` in document ${r}`),l+=")"),new We(ge.INVALID_ARGUMENT,a+n+l)}function RMe(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SW{constructor(e,t,s,r,i){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new rs(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new $Me(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(kW("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class $Me extends SW{data(){return super.data()}}function kW(n,e){return typeof e=="string"?IW(n,e):e instanceof TN?e._internalPath:e._delegate._internalPath}class DMe{convertValue(e,t="none"){switch(Fa(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Cn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Oa(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Qe(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return _c(e,(r,i)=>{s[r]=this.convertValue(i,t)}),s}convertVectorValue(e){var s,r,i;const t=(i=(r=(s=e.fields)==null?void 0:s[qb].arrayValue)==null?void 0:r.values)==null?void 0:i.map(o=>Cn(o.doubleValue));return new Hi(t)}convertGeoPoint(e){return new Gi(Cn(e.latitude),Cn(e.longitude))}convertArray(e,t){return(e.values||[]).map(s=>this.convertValue(s,t))}convertServerTimestamp(e,t){switch(t){case"previous":const s=Y0(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(lf(e));default:return null}}convertTimestamp(e){const t=Pa(e);return new rn(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=fn.fromString(e);Vt(HU(s),9688,{name:e});const r=new cf(s.get(1),s.get(3)),i=new He(s.popFirst(5));return r.isEqual(t)||Ro(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PMe(n,e,t){let s;return s=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,s}class ep{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ol extends SW{constructor(e,t,s,r,i,o){super(e,t,s,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Fy(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(kW("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new We(ge.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Ol._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Ol._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ol._jsonSchema={type:Fn("string",Ol._jsonSchemaVersion),bundleSource:Fn("string","DocumentSnapshot"),bundleName:Fn("string"),bundle:Fn("string")};class Fy extends Ol{data(e={}){return super.data(e)}}class pp{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new ep(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(s=>{e.call(t,new Fy(this._firestore,this._userDataWriter,s.key,s,new ep(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new We(ge.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(a=>{const l=new Fy(r._firestore,r._userDataWriter,a.doc.key,a.doc,new ep(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Fy(r._firestore,r._userDataWriter,a.doc.key,a.doc,new ep(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);let c=-1,u=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),u=o.indexOf(a.doc.key)),{type:OMe(a.type),doc:l,oldIndex:c,newIndex:u}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new We(ge.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=pp._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Q_.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],r=[];return this.docs.forEach(i=>{i._document!==null&&(t.push(i._document),s.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),r.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function OMe(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Qe(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FMe(n){n=of(n,rs);const e=of(n.firestore,kN);return wMe(gW(e),n._key).then(t=>zMe(e,n,t))}pp._jsonSchemaVersion="firestore/querySnapshot/1.0",pp._jsonSchema={type:Fn("string",pp._jsonSchemaVersion),bundleSource:Fn("string","QuerySnapshot"),bundleName:Fn("string"),bundle:Fn("string")};class LMe extends DMe{constructor(e){super(),this.firestore=e}convertBytes(e){return new Fr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new rs(this.firestore,null,t)}}function pP(n,e,t){n=of(n,rs);const s=of(n.firestore,kN),r=PMe(n.converter,e,t);return MMe(s,[_Me(EMe(s),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,bo.none())])}function MMe(n,e){return function(s,r){const i=new wa;return s.asyncQueue.enqueueAndForget(async()=>oMe(await bMe(s),r,i)),i.promise}(gW(n),e)}function zMe(n,e,t){const s=t.docs.get(e._key),r=new LMe(n);return new Ol(n,r,e._key,s,new ep(t.hasPendingWrites,t.fromCache),e.converter)}function fP(){return new EN("serverTimestamp")}function VMe(n){return new _N("increment",n)}(function(e,t=!0){(function(r){cd=r})(ad),Zi(new bi("firestore",(s,{instanceIdentifier:r,options:i})=>{const o=s.getProvider("app").getImmediate(),a=new kN(new kOe(s.getProvider("auth-internal")),new EOe(o,s.getProvider("app-check-internal")),function(c,u){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new We(ge.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new cf(c.options.projectId,u)}(o,r),o);return i={useFetchStreams:t,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),jr(xD,wD,e),jr(xD,wD,"esm2020")})();const TW="@firebase/installations",NN="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CW=1e4,EW=`w:${NN}`,_W="FIS_v2",BMe="https://firebaseinstallations.googleapis.com/v1",jMe=60*60*1e3,UMe="installations",WMe="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GMe={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},oc=new Cc(UMe,WMe,GMe);function NW(n){return n instanceof ki&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AW({projectId:n}){return`${BMe}/projects/${n}/installations`}function RW(n){return{token:n.token,requestStatus:2,expiresIn:qMe(n.expiresIn),creationTime:Date.now()}}async function $W(n,e){const s=(await e.json()).error;return oc.create("request-failed",{requestName:n,serverCode:s.code,serverMessage:s.message,serverStatus:s.status})}function DW({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function HMe(n,{refreshToken:e}){const t=DW(n);return t.append("Authorization",KMe(e)),t}async function PW(n){const e=await n();return e.status>=500&&e.status<600?n():e}function qMe(n){return Number(n.replace("s","000"))}function KMe(n){return`${_W} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XMe({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const s=AW(n),r=DW(n),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&r.append("x-firebase-client",c)}const o={fid:t,authVersion:_W,appId:n.appId,sdkVersion:EW},a={method:"POST",headers:r,body:JSON.stringify(o)},l=await PW(()=>fetch(s,a));if(l.ok){const c=await l.json();return{fid:c.fid||t,registrationStatus:2,refreshToken:c.refreshToken,authToken:RW(c.authToken)}}else throw await $W("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OW(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YMe(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QMe=/^[cdef][\w-]{21}$/,LS="";function ZMe(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=JMe(n);return QMe.test(t)?t:LS}catch{return LS}}function JMe(n){return YMe(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function av(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FW=new Map;function LW(n,e){const t=av(n);MW(t,e),eze(t,e)}function MW(n,e){const t=FW.get(n);if(t)for(const s of t)s(e)}function eze(n,e){const t=tze();t&&t.postMessage({key:n,fid:e}),nze()}let Cl=null;function tze(){return!Cl&&"BroadcastChannel"in self&&(Cl=new BroadcastChannel("[Firebase] FID Change"),Cl.onmessage=n=>{MW(n.data.key,n.data.fid)}),Cl}function nze(){FW.size===0&&Cl&&(Cl.close(),Cl=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sze="firebase-installations-database",rze=1,ac="firebase-installations-store";let T1=null;function AN(){return T1||(T1=lj(sze,rze,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(ac)}}})),T1}async function tx(n,e){const t=av(n),r=(await AN()).transaction(ac,"readwrite"),i=r.objectStore(ac),o=await i.get(t);return await i.put(e,t),await r.done,(!o||o.fid!==e.fid)&&LW(n,e.fid),e}async function zW(n){const e=av(n),s=(await AN()).transaction(ac,"readwrite");await s.objectStore(ac).delete(e),await s.done}async function lv(n,e){const t=av(n),r=(await AN()).transaction(ac,"readwrite"),i=r.objectStore(ac),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await r.done,a&&(!o||o.fid!==a.fid)&&LW(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RN(n){let e;const t=await lv(n.appConfig,s=>{const r=ize(s),i=oze(n,r);return e=i.registrationPromise,i.installationEntry});return t.fid===LS?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function ize(n){const e=n||{fid:ZMe(),registrationStatus:0};return VW(e)}function oze(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const r=Promise.reject(oc.create("app-offline"));return{installationEntry:e,registrationPromise:r}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},s=aze(n,t);return{installationEntry:t,registrationPromise:s}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:lze(n)}:{installationEntry:e}}async function aze(n,e){try{const t=await XMe(n,e);return tx(n.appConfig,t)}catch(t){throw NW(t)&&t.customData.serverCode===409?await zW(n.appConfig):await tx(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function lze(n){let e=await mP(n.appConfig);for(;e.registrationStatus===1;)await OW(100),e=await mP(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:s}=await RN(n);return s||t}return e}function mP(n){return lv(n,e=>{if(!e)throw oc.create("installation-not-found");return VW(e)})}function VW(n){return cze(n)?{fid:n.fid,registrationStatus:0}:n}function cze(n){return n.registrationStatus===1&&n.registrationTime+CW<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uze({appConfig:n,heartbeatServiceProvider:e},t){const s=hze(n,t),r=HMe(n,t),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&r.append("x-firebase-client",c)}const o={installation:{sdkVersion:EW,appId:n.appId}},a={method:"POST",headers:r,body:JSON.stringify(o)},l=await PW(()=>fetch(s,a));if(l.ok){const c=await l.json();return RW(c)}else throw await $W("Generate Auth Token",l)}function hze(n,{fid:e}){return`${AW(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $N(n,e=!1){let t;const s=await lv(n.appConfig,i=>{if(!BW(i))throw oc.create("not-registered");const o=i.authToken;if(!e&&fze(o))return i;if(o.requestStatus===1)return t=dze(n,e),i;{if(!navigator.onLine)throw oc.create("app-offline");const a=gze(i);return t=pze(n,a),a}});return t?await t:s.authToken}async function dze(n,e){let t=await gP(n.appConfig);for(;t.authToken.requestStatus===1;)await OW(100),t=await gP(n.appConfig);const s=t.authToken;return s.requestStatus===0?$N(n,e):s}function gP(n){return lv(n,e=>{if(!BW(e))throw oc.create("not-registered");const t=e.authToken;return yze(t)?{...e,authToken:{requestStatus:0}}:e})}async function pze(n,e){try{const t=await uze(n,e),s={...e,authToken:t};return await tx(n.appConfig,s),t}catch(t){if(NW(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await zW(n.appConfig);else{const s={...e,authToken:{requestStatus:0}};await tx(n.appConfig,s)}throw t}}function BW(n){return n!==void 0&&n.registrationStatus===2}function fze(n){return n.requestStatus===2&&!mze(n)}function mze(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+jMe}function gze(n){const e={requestStatus:1,requestTime:Date.now()};return{...n,authToken:e}}function yze(n){return n.requestStatus===1&&n.requestTime+CW<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bze(n){const e=n,{installationEntry:t,registrationPromise:s}=await RN(e);return s?s.catch(console.error):$N(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xze(n,e=!1){const t=n;return await wze(t),(await $N(t,e)).token}async function wze(n){const{registrationPromise:e}=await RN(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vze(n){if(!n||!n.options)throw C1("App Configuration");if(!n.name)throw C1("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw C1(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function C1(n){return oc.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jW="installations",Ize="installations-internal",Sze=n=>{const e=n.getProvider("app").getImmediate(),t=vze(e),s=Ec(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:s,_delete:()=>Promise.resolve()}},kze=n=>{const e=n.getProvider("app").getImmediate(),t=Ec(e,jW).getImmediate();return{getId:()=>bze(t),getToken:r=>xze(t,r)}};function Tze(){Zi(new bi(jW,Sze,"PUBLIC")),Zi(new bi(Ize,kze,"PRIVATE"))}Tze();jr(TW,NN);jr(TW,NN,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nx="analytics",Cze="firebase_id",Eze="origin",_ze=60*1e3,Nze="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",DN="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const js=new U0("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Aze={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Tr=new Cc("analytics","Analytics",Aze);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rze(n){if(!n.startsWith(DN)){const e=Tr.create("invalid-gtag-resource",{gtagURL:n});return js.warn(e.message),""}return n}function UW(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function $ze(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function Dze(n,e){const t=$ze("firebase-js-sdk-policy",{createScriptURL:Rze}),s=document.createElement("script"),r=`${DN}?l=${n}&id=${e}`;s.src=t?t==null?void 0:t.createScriptURL(r):r,s.async=!0,document.head.appendChild(s)}function Pze(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function Oze(n,e,t,s,r,i){const o=s[r];try{if(o)await e[o];else{const l=(await UW(t)).find(c=>c.measurementId===r);l&&await e[l.appId]}}catch(a){js.error(a)}n("config",r,i)}async function Fze(n,e,t,s,r){try{let i=[];if(r&&r.send_to){let o=r.send_to;Array.isArray(o)||(o=[o]);const a=await UW(t);for(const l of o){const c=a.find(h=>h.measurementId===l),u=c&&e[c.appId];if(u)i.push(u);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),n("event",s,r||{})}catch(i){js.error(i)}}function Lze(n,e,t,s){async function r(i,...o){try{if(i==="event"){const[a,l]=o;await Fze(n,e,t,a,l)}else if(i==="config"){const[a,l]=o;await Oze(n,e,t,s,a,l)}else if(i==="consent"){const[a,l]=o;n("consent",a,l)}else if(i==="get"){const[a,l,c]=o;n("get",a,l,c)}else if(i==="set"){const[a]=o;n("set",a)}else n(i,...o)}catch(a){js.error(a)}}return r}function Mze(n,e,t,s,r){let i=function(...o){window[s].push(arguments)};return window[r]&&typeof window[r]=="function"&&(i=window[r]),window[r]=Lze(i,n,e,t),{gtagCore:i,wrappedGtag:window[r]}}function zze(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(DN)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vze=30,Bze=1e3;class jze{constructor(e={},t=Bze){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const WW=new jze;function Uze(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function Wze(n){var o;const{appId:e,apiKey:t}=n,s={method:"GET",headers:Uze(t)},r=Nze.replace("{app-id}",e),i=await fetch(r,s);if(i.status!==200&&i.status!==304){let a="";try{const l=await i.json();(o=l.error)!=null&&o.message&&(a=l.error.message)}catch{}throw Tr.create("config-fetch-failed",{httpStatus:i.status,responseMessage:a})}return i.json()}async function Gze(n,e=WW,t){const{appId:s,apiKey:r,measurementId:i}=n.options;if(!s)throw Tr.create("no-app-id");if(!r){if(i)return{measurementId:i,appId:s};throw Tr.create("no-api-key")}const o=e.getThrottleMetadata(s)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Kze;return setTimeout(async()=>{a.abort()},t!==void 0?t:_ze),GW({appId:s,apiKey:r,measurementId:i},o,a,e)}async function GW(n,{throttleEndTimeMillis:e,backoffCount:t},s,r=WW){var a;const{appId:i,measurementId:o}=n;try{await Hze(s,e)}catch(l){if(o)return js.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:i,measurementId:o};throw l}try{const l=await Wze(n);return r.deleteThrottleMetadata(i),l}catch(l){const c=l;if(!qze(c)){if(r.deleteThrottleMetadata(i),o)return js.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${c==null?void 0:c.message}]`),{appId:i,measurementId:o};throw l}const u=Number((a=c==null?void 0:c.customData)==null?void 0:a.httpStatus)===503?W$(t,r.intervalMillis,Vze):W$(t,r.intervalMillis),h={throttleEndTimeMillis:Date.now()+u,backoffCount:t+1};return r.setThrottleMetadata(i,h),js.debug(`Calling attemptFetch again in ${u} millis`),GW(n,h,s,r)}}function Hze(n,e){return new Promise((t,s)=>{const r=Math.max(e-Date.now(),0),i=setTimeout(t,r);n.addEventListener(()=>{clearTimeout(i),s(Tr.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function qze(n){if(!(n instanceof ki)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class Kze{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Xze(n,e,t,s,r){if(r&&r.global){n("event",t,s);return}else{const i=await e,o={...s,send_to:i};n("event",t,o)}}async function Yze(n,e,t,s){if(s&&s.global){const r={};for(const i of Object.keys(t))r[`user_properties.${i}`]=t[i];return n("set",r),Promise.resolve()}else{const r=await e;n("config",r,{update:!0,user_properties:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qze(){if(F_())try{await L_()}catch(n){return js.warn(Tr.create("indexeddb-unavailable",{errorInfo:n==null?void 0:n.toString()}).message),!1}else return js.warn(Tr.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function Zze(n,e,t,s,r,i,o){const a=Gze(n);a.then(d=>{t[d.measurementId]=d.appId,n.options.measurementId&&d.measurementId!==n.options.measurementId&&js.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${d.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(d=>js.error(d)),e.push(a);const l=Qze().then(d=>{if(d)return s.getId()}),[c,u]=await Promise.all([a,l]);zze(i)||Dze(i,c.measurementId),r("js",new Date);const h=(o==null?void 0:o.config)??{};return h[Eze]="firebase",h.update=!0,u!=null&&(h[Cze]=u),r("config",c.measurementId,h),c.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jze{constructor(e){this.app=e}_delete(){return delete au[this.app.options.appId],Promise.resolve()}}let au={},yP=[];const bP={};let E1="dataLayer",e3e="gtag",xP,PN,wP=!1;function t3e(){const n=[];if(O_()&&n.push("This is a browser extension environment."),ij()||n.push("Cookies are not available."),n.length>0){const e=n.map((s,r)=>`(${r+1}) ${s}`).join(" "),t=Tr.create("invalid-analytics-context",{errorInfo:e});js.warn(t.message)}}function n3e(n,e,t){t3e();const s=n.options.appId;if(!s)throw Tr.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)js.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Tr.create("no-api-key");if(au[s]!=null)throw Tr.create("already-exists",{id:s});if(!wP){Pze(E1);const{wrappedGtag:i,gtagCore:o}=Mze(au,yP,bP,E1,e3e);PN=i,xP=o,wP=!0}return au[s]=Zze(n,yP,bP,e,xP,E1,t),new Jze(n)}function s3e(n=z_()){n=ms(n);const e=Ec(n,nx);return e.isInitialized()?e.getImmediate():r3e(n)}function r3e(n,e={}){const t=Ec(n,nx);if(t.isInitialized()){const r=t.getImmediate();if($a(e,t.getOptions()))return r;throw Tr.create("already-initialized")}return t.initialize({options:e})}async function i3e(){if(O_()||!ij()||!F_())return!1;try{return await L_()}catch{return!1}}function o3e(n,e,t){n=ms(n),Yze(PN,au[n.app.options.appId],e,t).catch(s=>js.error(s))}function a3e(n,e,t,s){n=ms(n),Xze(PN,au[n.app.options.appId],e,t,s).catch(r=>js.error(r))}const vP="@firebase/analytics",IP="0.10.19";function l3e(){Zi(new bi(nx,(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();return n3e(s,r,t)},"PUBLIC")),Zi(new bi("analytics-internal",n,"PRIVATE")),jr(vP,IP),jr(vP,IP,"esm2020");function n(e){try{const t=e.getProvider(nx).getImmediate();return{logEvent:(s,r,i)=>a3e(t,s,r,i),setUserProperties:(s,r)=>o3e(t,s,r)}}catch(t){throw Tr.create("interop-component-reg-failed",{reason:t})}}}l3e();const c3e={apiKey:{}.VITE_FIREBASE_API_KEY,authDomain:{}.VITE_FIREBASE_AUTH_DOMAIN,projectId:{}.VITE_FIREBASE_PROJECT_ID,storageBucket:{}.VITE_FIREBASE_STORAGE_BUCKET,messagingSenderId:{}.VITE_FIREBASE_MESSAGING_SENDER_ID,appId:{}.VITE_FIREBASE_APP_ID,measurementId:{}.VITE_FIREBASE_MEASUREMENT_ID};let iy,Zr,Ly,_1=new fo;try{iy=cj(c3e),Zr=wOe(iy),oPe(Zr,Mj).then(()=>console.log("âœ… Firebase persistence enabled")).catch(n=>console.error("âŒ Persistence failed:",n)),Ly=IMe(iy),i3e().then(n=>n?s3e(iy):null).catch(n=>console.warn("Analytics failed",n))}catch(n){console.error("âŒ FIREBASE INIT FAILED:",n),console.error("Check your .env file! It might be missing keys or formatted wrong.")}class u3e{constructor(){le(this,"user",null);le(this,"status","loading");le(this,"listeners",[]);le(this,"DEV_SECRET",{}.VITE_AI_ACCESS_SECRET);console.log("ðŸ” Checking for redirect result..."),FPe(Zr).then(e=>{e!=null&&e.user?console.log("âœ… Redirect login successful!",e.user.email):console.log("â„¹ï¸ No redirect result (normal page load)")}).catch(e=>{console.error("âŒ Redirect result error:",e.code,e.message)}),cPe(Zr,e=>{console.log("ðŸ”„ Auth state changed:",e?`User: ${e.email||e.uid}`:"No user"),this.user=e,e?(console.log("âœ… User logged in:",e.uid,e.email||"anonymous","Is Anonymous?",e.isAnonymous),e.isAnonymous||this.syncUserToDB(e)):console.log("âŒ User is null/signed out"),this.updateStatus()})}async syncUserToDB(e){try{const t=k1(Ly,"users",e.uid);await pP(t,{email:e.email,displayName:e.displayName,photoURL:e.photoURL,lastSeen:fP()},{merge:!0})}catch(t){console.error("Marketing sync failed",t)}}updateStatus(){var e;this.DEV_SECRET&&this.DEV_SECRET.length>5?this.status="god_mode":(e=this.user)!=null&&e.isAnonymous?this.status="anonymous":this.user?this.status="pro":this.status="loading",this.notifyListeners()}notifyListeners(){this.listeners.forEach(e=>e(this.status,this.user))}subscribe(e){return this.listeners.push(e),e(this.status,this.user),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}async signIn(){try{console.log("ðŸš€ Starting Google sign in...");const e=await NPe(Zr,_1);return console.log("âœ… Popup sign in successful!",e.user.email),e}catch(e){if(console.error("âŒ Popup error:",e.code,e.message),e.code==="auth/popup-blocked"||e.code==="auth/popup-closed-by-user"||e.code==="auth/cancelled-popup-request")console.log("ðŸ”„ Popup failed, trying redirect..."),await uD(Zr,_1);else throw console.error("Login failed",e),e}}async signInWithRedirect(){try{await uD(Zr,_1)}catch(e){throw console.error("Redirect login failed",e),e}}async signInWithEmail(e,t){try{await iPe(Zr,e,t)}catch(s){throw console.error("Email login failed",s),s}}async signUpWithEmail(e,t){try{return(await rPe(Zr,e,t)).user}catch(s){throw console.error("Email signup failed",s),s}}async signInAsGuest(){try{await ePe(Zr)}catch(e){throw console.error("Anonymous login failed",e),e}}async signOut(){await uPe(Zr)}getStatus(){return this.status}async checkAccess(){if(this.status==="god_mode")return{allowed:!0,remaining:9999};if(!this.user)return{allowed:!1,reason:"login_required"};const e=new Date().toISOString().split("T")[0],t=k1(Ly,`users/${this.user.uid}/usage/${e}`);try{const s=await FMe(t);let r=0;return s.exists()&&(r=s.data().count||0),r>=10?{allowed:!1,reason:"limit_reached",remaining:0}:{allowed:!0,remaining:10-r}}catch(s){return console.error("Auth Check Error",s),{allowed:!1,reason:"error"}}}async incrementUsage(){if(this.status==="god_mode"||!this.user)return;const e=new Date().toISOString().split("T")[0],t=k1(Ly,`users/${this.user.uid}/usage/${e}`);try{await pP(t,{count:VMe(1),lastUsed:fP()},{merge:!0})}catch(s){console.error("Failed to track usage",s)}}}const Os=new u3e;function h3e({onClose:n}){const[e,t]=te.useState(()=>{const k=localStorage.getItem("cortex_history");if(k)try{return JSON.parse(k)}catch(S){console.error("Failed to load history",S)}return[{role:"assistant",content:"SYSTEM ONLINE. Connected to Central Neural Net (GPT-OSS-120B). Awaiting input..."}]}),[s,r]=te.useState(""),[i,o]=te.useState(!1),[a,l]=te.useState("loading"),[c,u]=te.useState("inf"),[h,d]=te.useState(),[p,f]=te.useState(!1),g=te.useRef(null),m=()=>{var A;if(p){(A=g.current)==null||A.stop(),f(!1);return}const k=window.SpeechRecognition||window.webkitSpeechRecognition;if(!k){alert("Neural Voice Link not supported in this browser.");return}const S=new k;S.continuous=!1,S.interimResults=!1,S.lang="en-US",S.onstart=()=>f(!0),S.onend=()=>f(!1),S.onresult=P=>{const D=P.results[0][0].transcript;r(V=>V+(V?" ":"")+D)},g.current=S,S.start()},y=k=>{window.speechSynthesis.cancel();const S=new SpeechSynthesisUtterance(k);S.rate=1,S.pitch=.9,window.speechSynthesis.speak(S)},w=te.useRef(null);te.useEffect(()=>{localStorage.setItem("cortex_history",JSON.stringify(e))},[e]),te.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]),te.useEffect(()=>Os.subscribe((S,A)=>{l(S),v()}),[]);const v=async()=>{const k=await Os.checkAccess();k.remaining!==void 0&&u(k.remaining>100?"inf":k.remaining),d(k.reason)},I=()=>{if(confirm("Delete neural logs? This cannot be undone.")){const k=[{role:"assistant",content:"Memory Wiped. System Ready."}];t(k),localStorage.setItem("cortex_history",JSON.stringify(k))}},_=async()=>{if(!s.trim()||i)return;const k=await Os.checkAccess();if(!k.allowed){d(k.reason);return}const S=s;r(""),t(P=>[...P,{role:"user",content:S}]),o(!0);const A=await v2e.chat(e.concat({role:"user",content:S}));A.error?t(P=>[...P,{role:"assistant",content:`âš ï¸ SYSTEM ERROR: ${A.error}`}]):(t(P=>[...P,{role:"assistant",content:A.content}]),await Os.incrementUsage(),v()),o(!1)},N=k=>{k.key==="Enter"&&!k.shiftKey&&(k.preventDefault(),_())};te.useEffect(()=>{var k;(k=w.current)==null||k.scrollIntoView({behavior:"smooth"})},[e]);const T=()=>a==="loading"?x.jsxs("div",{className:"ai-overlay-glass",children:[x.jsx(uu,{className:"spin",size:48,color:"#a855f7"}),x.jsx("p",{children:"ESTABLISHING SECURE LINK..."})]}):a==="anonymous"?x.jsxs("div",{className:"ai-overlay-glass",children:[x.jsx(jS,{size:64,color:"#ef4444"}),x.jsx("h2",{children:"ACCESS RESTRICTED"}),x.jsx("p",{children:"Identity Verification Required."}),x.jsxs("button",{className:"btn-neon",onClick:()=>Os.signIn(),children:[x.jsx(uo,{size:18})," CONNECT NEURAL ID (GOOGLE)"]}),x.jsx("p",{className:"tiny-text",children:"Free Plan: 10 Queries / Day"})]}):h==="limit_reached"?x.jsxs("div",{className:"ai-overlay-glass",children:[x.jsx(LP,{size:64,color:"#f59e0b"}),x.jsx("h2",{children:"DAILY LIMIT REACHED"}),x.jsx("p",{children:"Neural capacity exhausted for today."}),x.jsxs("div",{className:"limit-box",children:[x.jsx("span",{children:"Refills in: 24h"}),x.jsx("span",{children:"God Mode: LOCKED"})]}),x.jsx("button",{className:"btn-neon",disabled:!0,style:{opacity:.5},children:"WATCH AD TO REFILL (SOON)"})]}):null,E=()=>a==="god_mode"?"#22c55e":c===0?"#ef4444":"#a855f7";return x.jsx("div",{className:"ai-brain-overlay",children:x.jsxs("div",{className:"ai-brain-container",children:[x.jsxs("header",{className:"ai-header",children:[x.jsxs("div",{className:"ai-title",children:[x.jsx(lu,{size:24,className:"ai-icon-pulse"}),x.jsxs("div",{children:[x.jsx("h3",{children:"Cortex Neural Link"}),x.jsxs("div",{className:"ai-status",children:[x.jsx("span",{className:"dot",style:{background:E(),boxShadow:`0 0 8px ${E()}`}}),x.jsx("span",{className:"secure",children:a==="god_mode"?"GOD MODE ACTIVE":`CREDITS: ${c}/10`})]})]})]}),x.jsxs("div",{className:"header-actions",children:[x.jsx("button",{className:"icon-btn",title:"Clear History",onClick:I,children:x.jsx(gf,{size:20})}),x.jsx("button",{onClick:n,className:"icon-btn close-btn",children:x.jsx(El,{size:24})})]})]}),x.jsxs("div",{className:"ai-chat-viewport",children:[e.map((k,S)=>x.jsxs("div",{className:`chat-bubble ${k.role}`,children:[k.role==="assistant"&&x.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[x.jsx(lu,{size:14,style:{opacity:.5}}),x.jsx("button",{onClick:()=>y(k.content),className:"icon-btn",style:{padding:2,opacity:.7},title:"Vocalize",children:x.jsx(BG,{size:12})})]}),x.jsx("div",{className:"ai-markdown",children:x.jsx(rAe,{remarkPlugins:[y2e],children:k.content})})]},S)),i&&x.jsxs("div",{className:"chat-bubble assistant",children:[x.jsx(uu,{className:"spin",size:16})," PROCESSING..."]}),x.jsx("div",{ref:w}),T()]}),x.jsxs("footer",{className:"ai-input-zone",children:[x.jsxs("div",{className:"input-wrapper",children:[x.jsx("button",{className:`icon-btn ${p?"pulse-red":""}`,onClick:m,title:"Voice Input",style:{marginRight:8,color:p?"#ef4444":"inherit"},children:p?x.jsx(jG,{size:20}):x.jsx(UG,{size:20})}),x.jsx("textarea",{value:s,onChange:k=>r(k.target.value),onKeyDown:N,placeholder:h?"SYSTEM LOCKED":"Input command... (Shift+Enter for newline)",disabled:!!h||a==="anonymous",className:"ai-textarea"}),x.jsx("button",{className:"send-btn",onClick:_,disabled:!s.trim()||i||!!h||a==="anonymous",children:x.jsx(WG,{size:18})})]}),x.jsxs("div",{className:"ai-footer-info",children:["Model: GPT-OSS-120B via Groq â€¢ ",a==="god_mode"?"UNLIMITED":"FREE TIER"]})]})]})})}const d3e=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0")),p3e=512;function f3e(n,e){return n.slice(0,e).arrayBuffer().then(t=>new Uint8Array(t))}function m3e(n){return new DataView(n.buffer,n.byteOffset,n.byteLength)}function g3e(n,e=n.length){const t=Math.min(n.length,e);let s="";for(let r=0;r<t;r+=1){const i=n[r];s+=i>=32&&i<=126?String.fromCharCode(i):"\0"}return s}function _i(n,e,t){let s="";for(let r=0;r<t;r+=1){const i=n.getUint8(e+r);s+=i>=32&&i<=126?String.fromCharCode(i):"\0"}return s}function y3e(n,e=16){const t=Math.min(n.length,e);let s="";for(let r=0;r<t;r+=1)s+=d3e[n[r]];return s}function SP(){if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();const n=Date.now().toString(16),e=Math.floor(Math.random()*4294967295).toString(16).padStart(8,"0");return`${n}-${e}`}const My="II*\0",b3e="MM\0*",x3e=n=>n.startsWith(My)||n.startsWith(b3e),w3e=[{label:"Canon CR2",mimeType:"image/x-canon-cr2",vendor:"Canon",extensions:["cr2"],cfa:"RGGB",matcher:n=>_i(n,0,4)===My&&_i(n,8,2)==="CR",littleEndian:!0},{label:"Canon CR3",mimeType:"image/x-canon-cr3",vendor:"Canon",extensions:["cr3"],cfa:"RGGB",matcher:(n,e)=>e.includes("ftypcrx"),littleEndian:!0},{label:"Adobe DNG",mimeType:"image/x-adobe-dng",vendor:"Adobe",extensions:["dng"],cfa:"RGGB",matcher:n=>x3e(_i(n,0,4))&&_i(n,8,4)==="ADBE"},{label:"Nikon NEF",mimeType:"image/x-nikon-nef",vendor:"Nikon",extensions:["nef"],cfa:"RGGB",matcher:n=>_i(n,0,4)===My&&_i(n,8,4)==="Nikon",littleEndian:!0},{label:"Sony ARW",mimeType:"image/x-sony-arw",vendor:"Sony",extensions:["arw","srf","sr2"],cfa:"RGGB",matcher:n=>_i(n,0,4)===My&&_i(n,8,4)==="SONY",littleEndian:!0},{label:"Fujifilm RAF",mimeType:"image/x-fuji-raf",vendor:"Fujifilm",extensions:["raf"],cfa:"X-Trans",matcher:n=>_i(n,0,12)==="FUJIFILMCCD",littleEndian:!0},{label:"Olympus ORF",mimeType:"image/x-olympus-orf",vendor:"Olympus",extensions:["orf"],cfa:"GRBG",matcher:(n,e)=>e.startsWith("IIRO")||e.startsWith("MMMOR"),littleEndian:!0},{label:"Panasonic RW2",mimeType:"image/x-panasonic-rw2",vendor:"Panasonic",extensions:["rw2"],cfa:"BGGR",matcher:(n,e)=>e.startsWith("II*\0")&&_i(n,8,4)==="Panasonic",littleEndian:!0}];function v3e(n,e){return w3e.find(t=>{try{return t.matcher(n,e)}catch(s){return console.warn("[RawSignature] matcher failed",s),!1}})}const I3e="Unknown RAW container",kP={Canon:"RGGB",Nikon:"RGGB",Sony:"RGGB",Fujifilm:"X-Trans",Panasonic:"BGGR",Olympus:"GRBG",Adobe:"RGGB"},TP={raf:"X-Trans",rw2:"BGGR",orf:"GRBG"};class S3e extends Error{constructor(e){super(e),this.name="RawSessionError"}}class fp{constructor(e,t){le(this,"firstRunId",SP());le(this,"headerBytes");le(this,"probe");le(this,"backingBuffer");le(this,"logicalName");le(this,"headerBudget");le(this,"extensionHint",null);this.source=e,this.logicalName=(t==null?void 0:t.logicalName)??fp.resolveName(e),this.headerBudget=(t==null?void 0:t.maxHeaderBytes)??p3e}static async create(e,t){const s=new fp(e,t);return await s.ensureProbe(),s}get diagnostics(){if(!this.probe)throw new S3e("RawSession diagnostics requested before probe completed");return this.probe}get bytes(){return this.source.size}get name(){return this.logicalName}async toWorkerPayload(){await this.ensureProbe();const e=await this.materializeBuffer();return{job:{firstRunId:this.firstRunId,traceToken:SP(),logicalName:this.logicalName,diagnostics:this.diagnostics},transferable:[e],buffers:[e]}}async ensureProbe(){if(this.probe)return;const e=await this.readHeader(),t=g3e(e,256),s=m3e(e),r=v3e(s,t),i=this.extractExtension(),o=(r==null?void 0:r.vendor)??k3e(i),a=(r==null?void 0:r.cfa)??T3e(o,i),l=(r==null?void 0:r.littleEndian)??t.startsWith("II");this.probe={formatLabel:(r==null?void 0:r.label)??fp.labelFromExtension(i),mimeType:(r==null?void 0:r.mimeType)??"image/x-raw",extensionHint:i,littleEndian:l,vendorGuess:o,colorFilterArray:a,headerDigest:y3e(e),locator:r?`signature:${r.label}`:`offset:0,len:${e.length}`}}async materializeBuffer(){return this.backingBuffer||(this.backingBuffer=await this.source.arrayBuffer()),this.backingBuffer}async readHeader(){return this.headerBytes||(this.headerBytes=await f3e(this.source,this.headerBudget)),this.headerBytes}extractExtension(){var e;if(this.extensionHint)return this.extensionHint;if(typeof File<"u"&&this.source instanceof File&&this.source.name.includes(".")){const t=((e=this.source.name.split(".").pop())==null?void 0:e.toLowerCase())??null;return this.extensionHint=t,t}return null}static resolveName(e){return typeof File<"u"&&e instanceof File&&e.name?e.name:"raw-input"}static labelFromExtension(e){return e?`${e.toUpperCase()} (unverified)`:I3e}}function k3e(n){if(!n)return null;switch(n){case"cr2":case"cr3":return"Canon";case"nef":return"Nikon";case"arw":case"srf":case"sr2":return"Sony";case"raf":return"Fujifilm";case"rw2":case"rwl":return"Panasonic";case"orf":return"Olympus";case"dng":return"Adobe";default:return null}}function T3e(n,e){return n&&kP[n]?kP[n]:e&&TP[e]?TP[e]:"Unknown"}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const HW=Symbol("Comlink.proxy"),C3e=Symbol("Comlink.endpoint"),qW=Symbol("Comlink.releaseProxy"),N1=Symbol("Comlink.finalizer"),zy=Symbol("Comlink.thrown"),KW=n=>typeof n=="object"&&n!==null||typeof n=="function",E3e={canHandle:n=>KW(n)&&n[HW],serialize(n){const{port1:e,port2:t}=new MessageChannel;return YW(n,e),[t,[t]]},deserialize(n){return n.start(),ZW(n)}},_3e={canHandle:n=>KW(n)&&zy in n,serialize({value:n}){let e;return n instanceof Error?e={isError:!0,value:{message:n.message,name:n.name,stack:n.stack}}:e={isError:!1,value:n},[e,[]]},deserialize(n){throw n.isError?Object.assign(new Error(n.value.message),n.value):n.value}},XW=new Map([["proxy",E3e],["throw",_3e]]);function N3e(n,e){for(const t of n)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function YW(n,e=globalThis,t=["*"]){e.addEventListener("message",function s(r){if(!r||!r.data)return;if(!N3e(t,r.origin)){console.warn(`Invalid origin '${r.origin}' for comlink proxy`);return}const{id:i,type:o,path:a}=Object.assign({path:[]},r.data),l=(r.data.argumentList||[]).map(gl);let c;try{const u=a.slice(0,-1).reduce((d,p)=>d[p],n),h=a.reduce((d,p)=>d[p],n);switch(o){case"GET":c=h;break;case"SET":u[a.slice(-1)[0]]=gl(r.data.value),c=!0;break;case"APPLY":c=h.apply(u,l);break;case"CONSTRUCT":{const d=new h(...l);c=O3e(d)}break;case"ENDPOINT":{const{port1:d,port2:p}=new MessageChannel;YW(n,p),c=P3e(d,[d])}break;case"RELEASE":c=void 0;break;default:return}}catch(u){c={value:u,[zy]:0}}Promise.resolve(c).catch(u=>({value:u,[zy]:0})).then(u=>{const[h,d]=ix(u);e.postMessage(Object.assign(Object.assign({},h),{id:i}),d),o==="RELEASE"&&(e.removeEventListener("message",s),QW(e),N1 in n&&typeof n[N1]=="function"&&n[N1]())}).catch(u=>{const[h,d]=ix({value:new TypeError("Unserializable return value"),[zy]:0});e.postMessage(Object.assign(Object.assign({},h),{id:i}),d)})}),e.start&&e.start()}function A3e(n){return n.constructor.name==="MessagePort"}function QW(n){A3e(n)&&n.close()}function ZW(n,e){const t=new Map;return n.addEventListener("message",function(r){const{data:i}=r;if(!i||!i.id)return;const o=t.get(i.id);if(o)try{o(i)}finally{t.delete(i.id)}}),MS(n,t,[],e)}function oy(n){if(n)throw new Error("Proxy has been released and is not useable")}function JW(n){return Yc(n,new Map,{type:"RELEASE"}).then(()=>{QW(n)})}const sx=new WeakMap,rx="FinalizationRegistry"in globalThis&&new FinalizationRegistry(n=>{const e=(sx.get(n)||0)-1;sx.set(n,e),e===0&&JW(n)});function R3e(n,e){const t=(sx.get(e)||0)+1;sx.set(e,t),rx&&rx.register(n,e,n)}function $3e(n){rx&&rx.unregister(n)}function MS(n,e,t=[],s=function(){}){let r=!1;const i=new Proxy(s,{get(o,a){if(oy(r),a===qW)return()=>{$3e(i),JW(n),e.clear(),r=!0};if(a==="then"){if(t.length===0)return{then:()=>i};const l=Yc(n,e,{type:"GET",path:t.map(c=>c.toString())}).then(gl);return l.then.bind(l)}return MS(n,e,[...t,a])},set(o,a,l){oy(r);const[c,u]=ix(l);return Yc(n,e,{type:"SET",path:[...t,a].map(h=>h.toString()),value:c},u).then(gl)},apply(o,a,l){oy(r);const c=t[t.length-1];if(c===C3e)return Yc(n,e,{type:"ENDPOINT"}).then(gl);if(c==="bind")return MS(n,e,t.slice(0,-1));const[u,h]=CP(l);return Yc(n,e,{type:"APPLY",path:t.map(d=>d.toString()),argumentList:u},h).then(gl)},construct(o,a){oy(r);const[l,c]=CP(a);return Yc(n,e,{type:"CONSTRUCT",path:t.map(u=>u.toString()),argumentList:l},c).then(gl)}});return R3e(i,n),i}function D3e(n){return Array.prototype.concat.apply([],n)}function CP(n){const e=n.map(ix);return[e.map(t=>t[0]),D3e(e.map(t=>t[1]))]}const eG=new WeakMap;function P3e(n,e){return eG.set(n,e),n}function O3e(n){return Object.assign(n,{[HW]:!0})}function ix(n){for(const[e,t]of XW)if(t.canHandle(n)){const[s,r]=t.serialize(n);return[{type:"HANDLER",name:e,value:s},r]}return[{type:"RAW",value:n},eG.get(n)||[]]}function gl(n){switch(n.type){case"HANDLER":return XW.get(n.name).deserialize(n.value);case"RAW":return n.value}}function Yc(n,e,t,s){return new Promise(r=>{const i=F3e();e.set(i,r),n.start&&n.start(),n.postMessage(Object.assign({id:i},t),s)})}function F3e(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}const L3e=new URL("/assets/raw-worker-d4c36f40.ts",self.location),EP=2;class M3e{constructor(e={}){le(this,"watchdog");le(this,"handles",[]);le(this,"queue",[]);le(this,"destroyed",!1);this.watchdog=cv();const t=this.watchdog.available?z3e(e.maxWorkers):1;this.watchdog.available||console.warn("[RawWorkerPool] SharedArrayBuffer unavailable, using single-worker fallback",this.watchdog.reason);for(let s=0;s<t;s+=1)this.handles.push(this.spawnWorker(s))}get size(){return this.handles.length}async submitSession(e){const t=await e.toWorkerPayload();return this.submitPayload(t)}submitPayload(e){return this.destroyed?Promise.reject(new Error("RawWorkerPool has been destroyed")):new Promise((t,s)=>{this.queue.push({payload:e,resolve:t,reject:s}),this.pumpQueue()})}shutdown(){this.destroyed=!0,this.queue.splice(0,this.queue.length),this.handles.forEach(e=>{e.remote[qW](),e.worker.terminate()}),this.handles.length=0}spawnWorker(e){const t=new Worker(L3e,{type:"module",name:`raw-worker-${e}`}),s=ZW(t);return{worker:t,remote:s,busy:!1}}pumpQueue(){if(this.queue.length===0)return;const e=this.handles.find(s=>!s.busy);if(!e)return;const t=this.queue.shift();t&&this.dispatch(e,t)}async dispatch(e,t){e.busy=!0;try{const s=await e.remote.process(t.payload);t.resolve(s)}catch(s){t.reject(s)}finally{e.busy=!1,this.pumpQueue()}}}function z3e(n){if(n&&n>0)return n;const e=typeof navigator<"u"&&navigator.hardwareConcurrency||EP;return Math.min(Math.max(1,Math.floor(e/2)),4)}function cv(){return typeof SharedArrayBuffer>"u"?{available:!1,reason:"SharedArrayBuffer is undefined in this environment"}:typeof crossOriginIsolated<"u"&&crossOriginIsolated===!1?{available:!1,reason:"crossOriginIsolated is false; COOP/COEP headers missing"}:{available:!0}}let A1=null;function V3e(n){return A1||(A1=new M3e(n)),A1}async function B3e(n,e){const t=await fp.create(n,e);return V3e().submitSession(t)}const R1=new Uint8Array([69,120,105,102,0,0]);class _P{constructor(){le(this,"entries",[])}addAscii(e,t){if(!t)return;const s=`${t}\0`;this.entries.push({tag:e,type:2,count:s.length,data:W3e(s)})}addShort(e,t){const s=Array.isArray(t)?t:[t];if(!s.length)return;const r=new Uint8Array(s.length*2),i=new DataView(r.buffer);s.forEach((o,a)=>{i.setUint16(a*2,G3e(o),!0)}),this.entries.push({tag:e,type:3,count:s.length,data:r})}addLong(e,t){const s=Array.isArray(t)?t:[t];if(!s.length)return;const r=new Uint8Array(s.length*4),i=new DataView(r.buffer);s.forEach((o,a)=>{i.setUint32(a*4,Math.max(0,Math.round(o)),!0)}),this.entries.push({tag:e,type:4,count:s.length,data:r})}addRational(e,t){const s=Array.isArray(t)?t:[t];if(!s.length)return;const r=new Uint8Array(s.length*8),i=new DataView(r.buffer);s.forEach((o,a)=>{const l=Math.max(0,Math.round(o.numerator)),c=Math.max(1,Math.round(o.denominator));i.setUint32(a*8,l,!0),i.setUint32(a*8+4,c,!0)}),this.entries.push({tag:e,type:5,count:s.length,data:r})}addIfdPointer(e,t){this.entries.push({tag:e,type:4,count:1,data:new Uint8Array(4),child:t})}serialize(e){const t=this.entries,s=2+t.length*12+4;let r=e+s;const i=[];t.forEach(u=>{if(u.child){const h=u.child.serialize(r);u.dataOffset=r,i.push({offset:r,data:h.bytes}),r+=h.length}else if(u.data.byteLength>4){const h=U3e(u.data);u.dataOffset=r,i.push({offset:r,data:h}),r+=h.byteLength}});const o=r-e,a=new Uint8Array(o),l=new DataView(a.buffer);let c=0;return l.setUint16(c,t.length,!0),c+=2,t.forEach(u=>{l.setUint16(c,u.tag,!0),l.setUint16(c+2,u.type,!0),l.setUint32(c+4,u.count,!0),u.child||u.data.byteLength>4?l.setUint32(c+8,u.dataOffset??0,!0):new Uint8Array(a.buffer,c+8,4).set(j3e(u.data)),c+=12}),l.setUint32(c,0,!0),i.forEach(u=>{const h=u.offset-e;a.set(u.data,h)}),{bytes:a,length:o}}}function j3e(n){if(n.byteLength===4)return n;const e=new Uint8Array(4);return e.set(n),e}function U3e(n){if(n.byteLength%2===0)return n;const e=new Uint8Array(n.byteLength+1);return e.set(n),e}function W3e(n){const e=new Uint8Array(n.length);for(let t=0;t<n.length;t+=1)e[t]=n.charCodeAt(t)&255;return e}function G3e(n){return!Number.isFinite(n)||n<=0?0:n>=65535?65535:Math.round(n)}function tG(n){const e=new _P,t=n.metadata??{};e.addLong(256,n.width),e.addLong(257,n.height),e.addShort(258,Array(n.channels).fill(Math.min(16,n.bitDepth))),e.addShort(259,1),e.addShort(262,2),t.orientation&&e.addShort(274,t.orientation),e.addRational(282,{numerator:300,denominator:1}),e.addRational(283,{numerator:300,denominator:1}),e.addShort(296,2),e.addAscii(305,t.software),e.addAscii(306,D1(t.captureTime)),e.addAscii(270,t.imageDescription),e.addAscii(271,t.cameraMake),e.addAscii(272,t.cameraModel),e.addShort(277,n.channels),e.addShort(284,1),e.addRational(318,q3e),e.addRational(319,K3e),e.addRational(532,X3e);const s=new _P;s.addShort(40961,Y3e(t.colorSpace)),s.addLong(40962,n.width),s.addLong(40963,n.height),t.exposureTime&&s.addRational(33434,$1(t.exposureTime)),t.fNumber&&s.addRational(33437,$1(t.fNumber)),t.iso&&s.addShort(34855,t.iso),t.focalLength&&s.addRational(37386,$1(t.focalLength)),t.focalLength35mm&&s.addShort(41989,t.focalLength35mm),s.addAscii(36867,D1(t.captureTime)),s.addAscii(36868,D1(t.captureTime)),s.addShort(41495,2),s.addAscii(42036,t.lensModel),s.addAscii(42033,t.serialNumber),s.addAscii(42016,t.uniqueImageId),e.addIfdPointer(34665,s);const r=H3e(e),i=new Uint8Array(R1.byteLength+r.byteLength);return i.set(R1,0),i.set(r,R1.byteLength),i}function H3e(n){const e=new Uint8Array(8);e[0]=73,e[1]=73,e[2]=42,e[3]=0;const t=n.serialize(8),s=new Uint8Array(e.byteLength+t.length);return new DataView(s.buffer).setUint32(4,8,!0),s.set(e,0),s.set(t.bytes,e.byteLength),s}const q3e=[{numerator:3127,denominator:1e4},{numerator:3290,denominator:1e4}],K3e=[{numerator:6400,denominator:1e4},{numerator:3300,denominator:1e4},{numerator:3e3,denominator:1e4},{numerator:6e3,denominator:1e4},{numerator:1500,denominator:1e4},{numerator:600,denominator:1e4}],X3e=[{numerator:0,denominator:1e4},{numerator:1e4,denominator:1e4},{numerator:0,denominator:1e4},{numerator:1e4,denominator:1e4},{numerator:0,denominator:1e4},{numerator:1e4,denominator:1e4}];function Y3e(n){switch(n){case"AdobeRGB":return 65535;case"DisplayP3":return 65535;case"sRGB":default:return 1}}function $1(n){return{numerator:Math.round(n*1e4),denominator:1e4}}function D1(n){if(!n)return;const e=new Date(n);if(Number.isNaN(e.getTime()))return;const t=e.getUTCFullYear().toString().padStart(4,"0"),s=(e.getUTCMonth()+1).toString().padStart(2,"0"),r=e.getUTCDate().toString().padStart(2,"0"),i=e.getUTCHours().toString().padStart(2,"0"),o=e.getUTCMinutes().toString().padStart(2,"0"),a=e.getUTCSeconds().toString().padStart(2,"0");return`${t}:${s}:${r} ${i}:${o}:${a}`}const P1=new Uint8Array([137,80,78,71,13,10,26,10]),NP=sVe();function Q3e(n,e,t){if(!Z3e(n))return n;const s=[],r=J3e(n);if(!r.has("gAMA")){const u=new Uint8Array(4);new DataView(u.buffer).setUint32(0,45455,!1),s.push(ay("gAMA",u))}if(!r.has("cHRM")){const u=new Uint8Array(32),h=new DataView(u.buffer);[31270,32900,64e3,33e3,3e4,6e4,15e3,6e3].forEach((p,f)=>{h.setUint32(f*4,p,!1)}),s.push(ay("cHRM",u))}r.has("sRGB")||s.push(ay("sRGB",new Uint8Array([0])));const i=t??(e?tG(e):void 0);if(i&&!r.has("eXIf")&&s.push(ay("eXIf",i)),!s.length)return n;const o=eVe(n),a=s.reduce((u,h)=>u+h.length,0),l=new Uint8Array(n.length+a);l.set(n.subarray(0,o),0);let c=o;return s.forEach(u=>{l.set(u,c),c+=u.length}),l.set(n.subarray(o),c),l}function Z3e(n){if(n.byteLength<P1.byteLength)return!1;for(let e=0;e<P1.length;e+=1)if(n[e]!==P1[e])return!1;return!0}function J3e(n){const e=new Set;let t=8;for(;t+12<=n.length;){const s=nG(n,t),r=rVe(n,t+4);e.add(r),t+=12+s}return e}function eVe(n){let e=8;if(e+12>n.length)return n.length;const t=nG(n,e);return Math.min(n.length,e+12+t)}function ay(n,e){const t=new Uint8Array(12+e.length),s=new DataView(t.buffer);s.setUint32(0,e.length,!1);const r=tVe(n);t.set(r,4),t.set(e,8);const i=nVe(r,e);return s.setUint32(8+e.length,i,!1),t}function tVe(n){const e=new Uint8Array(n.length);for(let t=0;t<n.length;t+=1)e[t]=n.charCodeAt(t);return e}function nVe(n,e){let t=4294967295;for(let s=0;s<n.length;s+=1)t=NP[(t^n[s])&255]^t>>>8;for(let s=0;s<e.length;s+=1)t=NP[(t^e[s])&255]^t>>>8;return(t^4294967295)>>>0}function sVe(){const n=new Uint32Array(256);for(let e=0;e<256;e+=1){let t=e;for(let s=0;s<8;s+=1)t=t&1?3988292384^t>>>1:t>>>1;n[e]=t>>>0}return n}function nG(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}function rVe(n,e){return String.fromCharCode(n[e],n[e+1],n[e+2],n[e+3])}const iVe=2048,sG=.82,oVe=.45,wl=class wl{constructor(){le(this,"vipsPromise",null)}static getInstance(){return wl.singleton||(wl.singleton=new wl),wl.singleton}async export(e,t,s={}){var a;const r=AP(),i=await this.ensureVips(),o=this.createImage(i,e);try{const l=this.buildExifPayload(e);return{...await this.write(o,t,e,s,l),durationMs:AP()-r}}finally{(a=o==null?void 0:o.delete)==null||a.call(o)}}async ensureVips(){return this.vipsPromise||(this.vipsPromise=gp(()=>import("wasm-vips"),[]).then(e=>e.default({locateFile:t=>`/wasm/${t}`}))),this.vipsPromise}createImage(e,t){const{buffer:s,width:r,height:i,channels:o,bitDepth:a}=t;if(a>8){const c=new Uint16Array(s);return e.Image.newFromMemory(c,r,i,o,"ushort")}const l=new Uint8Array(s);return e.Image.newFromMemory(l,r,i,o,"uchar")}async write(e,t,s,r,i){switch(t){case"tiff16":{const o=Math.min(16,s.bitDepth);this.attachExif(e,i);const a=e.writeToBuffer(".tif",{compression:"lzw",predictor:"horizontal",tile:!1,bitdepth:o,strip:!0});return this.buildArtifact("tiff16",a,"image/tiff",`TIFF ${o}-bit`)}case"png16":{const o=Math.min(16,s.bitDepth);this.attachExif(e,i);const a=e.writeToBuffer(".png",{bitdepth:o,interlace:!1,compression:6,strip:!0}),l=Q3e(dVe(a),this.buildExifContext(s),i);return this.buildArtifact("png16",l,"image/png",`PNG ${o}-bit`)}case"jpegxl":{const o=lVe(r.jpegxlDistance??oVe),a=e.writeToBuffer(".jxl",{effort:7,distance:o,lossless:o===0}),l=o===0?"JPEG XL lossless":`JPEG XL d=${o.toFixed(2)}`;return this.buildArtifact("jpegxl",a,"image/jxl",l)}case"jpeg-preview":default:return this.attachExif(e,i),this.buildPreviewArtifact(e,s,r)}}async buildPreviewArtifact(e,t,s){const r=Math.max(512,s.previewMaxEdge??iVe),i=aVe(s.previewQuality??sG),o=Math.round(i*100),a=new Set;let l=typeof e.copy=="function"?e.copy():e;l!==e&&a.add(l);const c=u=>{u&&(u!==l&&u!==e&&a.add(u),l=u)};try{const u=Math.max(t.width,t.height);u>r&&typeof l.resize=="function"&&c(l.resize(r/u)),typeof l.cast=="function"&&c(l.cast("uchar"));const h=l.writeToBuffer(".jpg",{Q:o,optimiseCoding:!0,strip:!0});return this.buildArtifact("jpeg-preview",h,"image/jpeg",`JPEG preview Q${o}`)}finally{a.forEach(u=>{var h;return(h=u==null?void 0:u.delete)==null?void 0:h.call(u)})}}async buildArtifact(e,t,s,r){const i=t.slice(),o=await cVe(i);return{format:e,mimeType:s,label:r,bytes:i.byteLength,blob:new Blob([i],{type:s}),checksum:o}}buildExifContext(e){return{width:e.width,height:e.height,bitDepth:e.bitDepth,channels:e.channels,metadata:e.metadata}}buildExifPayload(e){const t=this.buildExifContext(e);try{return tG(t)}catch(s){console.warn("[RawExportService] EXIF build failed",s);return}}attachExif(e,t){if(!(!t||!e||typeof e.set!="function")){try{e.set("exif-data",t)}catch(s){console.warn("[RawExportService] Unable to attach EXIF payload",s)}try{e.set("icc-profile-name","sRGB IEC61966-2.1")}catch{}}}};le(wl,"singleton",null);let ox=wl;function aVe(n){return Number.isFinite(n)?Math.max(.4,Math.min(1,n)):sG}function lVe(n){return!Number.isFinite(n)||n<0?0:Math.min(1,n)}function AP(){return typeof performance<"u"?performance.now():Date.now()}async function cVe(n){if(!(typeof crypto>"u"||!crypto.subtle))try{const e=hVe(n),t=await crypto.subtle.digest("SHA-256",e);return uVe(t)}catch(e){console.warn("[RawExportService] SHA-256 digest failed",e);return}}function uVe(n){const e=new Uint8Array(n);let t="";for(let s=0;s<e.length;s+=1)t+=e[s].toString(16).padStart(2,"0");return t}function hVe(n){if(n.byteOffset===0&&n.byteLength===n.buffer.byteLength&&n.buffer instanceof ArrayBuffer)return n.buffer;const e=new ArrayBuffer(n.byteLength);return new Uint8Array(e).set(n),e}function dVe(n){return n instanceof Uint8Array?n:new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}const O1=[{id:"ingest",title:"Stage 1 Â· Intake",detail:"RAW file is opened and checked for basics before anything else happens.",notes:["Confirms the camera pattern.","Captures quick preview stats."]},{id:"demosaic",title:"Stage 2 Â· Clean Up",detail:"Image is demosaiced and balanced so it looks natural.",notes:["Noise reduced, colors lined up.","16-bit quality stays untouched."]},{id:"qa",title:"Stage 3 Â· Ready Check",detail:"Quick QA pass before you export or hand off.",notes:["Shows what changed per stage.","Flags anything that needs attention."]}];function pVe({onBackToHome:n}){const e=te.useMemo(()=>cv(),[]),[t,s]=te.useState("loading");te.useEffect(()=>Os.subscribe(u=>{s(u)}),[]);const r=te.useMemo(()=>{let u="CHECKING...";return t==="anonymous"?u="LOGIN REQUIRED":t==="god_mode"?u="GOD MODE":t==="pro"&&(u="10/10 CREDITS"),[{id:"ai-brain",name:"Central AI Brain",summary:"Powered by OpenAI GPT-OSS-120B. The Master Intelligence.",icon:x.jsx(jy,{size:22,"aria-hidden":!0}),status:"open",badge:u,motionClass:"vector-grid",openId:"ai-brain"},{id:"trash-hunter",name:"Trash Hunter",summary:"AI-Powered System Cleaner & God Mode.",icon:x.jsx(gf,{size:22,"aria-hidden":!0}),status:"open",badge:"GOD MODE",motionClass:"vector-grid",openId:"trash"},{id:"system-monitor",name:"AI Overseer",summary:"Real-time Process Analysis & Threat Detection.",icon:x.jsx(uu,{size:22,"aria-hidden":!0}),status:"open",badge:"BETA",motionClass:"vector-grid",openId:"monitor"},{id:"vector-command",name:"Vector Command Center",summary:"Prompt Architect & Image-to-SVG Vectorizer.",icon:x.jsx(lu,{size:22,"aria-hidden":!0}),status:"open",badge:"NEW",motionClass:"vector-grid",openId:"vector"},{id:"raw-decoder",name:"RAW Decoder Lab",summary:"Lossless demosaic + LibRaw arbitration. Active build.",icon:x.jsx(z1,{size:22,"aria-hidden":!0}),status:"open",badge:"ACTIVE",motionClass:"raw-grid",openId:"raw"},{id:"internet-downloader",name:"404 Social Media Downloader",summary:"Client-side helper for the yt-dlp PowerShell runner.",icon:x.jsx(mp,{size:22,"aria-hidden":!0}),status:"open",badge:"NEW",motionClass:"downloader-stream",openId:"downloader"},{id:"voice-encrypter",name:"Voice Encryptor FX",summary:"FX toggles + mastering queue for drops.",icon:x.jsx(BS,{size:22,"aria-hidden":!0}),status:"soon",badge:"COMING SOON",motionClass:"cipher-glyphs"},{id:"prompt-forge",name:"Prompt Forge",summary:"Micro prompt polisher + tone guardrails.",icon:x.jsx(sa,{size:22,"aria-hidden":!0}),status:"soon",badge:"COMING SOON",motionClass:"prompt-plasma"},{id:"ops-pipeline",name:"Ops Pipeline",summary:"Multi-step task runner for drops and proofing.",icon:x.jsx(GG,{size:22,"aria-hidden":!0}),status:"soon",badge:"COMING SOON",motionClass:"ops-orbit"},{id:"anagram-lab",name:"Anagram Lab",summary:"Scramble tools for undercover scripts.",icon:x.jsx(HG,{size:22,"aria-hidden":!0}),status:"soon",badge:"COMING SOON",motionClass:"anagram-matrix"},{id:"ai-companion",name:"AI Companion",summary:"Supervise agents, pin diagnostics, run macros.",icon:x.jsx(lu,{size:22,"aria-hidden":!0}),status:"soon",badge:"COMING SOON",motionClass:"ai-circuits"}]},[t]),[i,o]=te.useState(null),[a,l]=te.useState(0),c=te.useCallback(u=>{l(h=>u==="next"?h+1>=O1.length?0:h+1:h-1<0?O1.length-1:h-1)},[]);return i==="trash"?x.jsx(TTe,{onBack:()=>o(null)}):x.jsxs("div",{className:"app tools-screen",children:[x.jsx(US,{opacity:.08,density:24,speed:2}),x.jsxs("div",{className:"sysbar",children:[x.jsxs("div",{className:"sys-item",children:[x.jsx("span",{className:"dot"})," ACCESS: OPEN"]}),x.jsx("div",{className:"sys-item mono",children:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),x.jsxs("div",{className:"sys-item mono",children:["TOOLS Â· MATRIX-",Math.abs((Date.now()/1e3|0)%999)]}),x.jsx("div",{className:`sys-item mono sab-pill ${e.available?"ok":"warn"}`,children:e.available?"SAB LOCK":"SAB FALLBACK"})]}),x.jsx("main",{className:"tools-viewport container",children:x.jsxs("section",{className:"tools-panel",children:[x.jsxs("header",{className:"tools-hero",children:[x.jsx("div",{className:"tools-label",children:"01 Â· Tools"}),x.jsx("h1",{children:"Tools Library"}),x.jsx("p",{children:"Floating client-side utilities. Tap a tool banner to open its deck."}),x.jsx("div",{className:"tools-hero-actions",children:x.jsxs("button",{className:"back-button",onClick:n,children:[x.jsx(ax,{size:18,"aria-hidden":!0})," Back to Home"]})})]}),x.jsx("div",{className:"tool-banner-list",children:r.map(u=>x.jsxs("article",{className:`tool-banner ${u.status}`,children:[x.jsx("div",{className:`tool-motion ${u.motionClass}`,"aria-hidden":!0}),x.jsxs("div",{className:"tool-banner-meta",children:[x.jsx("span",{className:"tool-icon-pill",children:u.icon}),x.jsxs("div",{children:[x.jsxs("p",{className:"tool-tag",children:["#",u.badge]}),x.jsx("h2",{children:u.name}),x.jsx("p",{className:"tool-summary",children:u.summary})]})]}),x.jsx("button",{className:`btn ${u.status==="open"?"cta-open":""}`,disabled:u.status!=="open",onClick:()=>{u.status==="open"&&u.openId&&o(u.openId)},children:u.status==="open"?"Open Tool":"Coming Soon"})]},u.id))})]})}),x.jsxs("footer",{className:"footer",children:[x.jsx("p",{children:"Built like a pro. React + TypeScript + Vite. Optimized for touch."}),x.jsx("small",{className:"mono","aria-label":"terminal-log",children:"terminal-log: tools deck primed"})]}),i==="ai-brain"&&x.jsx(h3e,{onClose:()=>o(null)}),i==="vector"&&x.jsx("div",{className:"tools-overlay",role:"dialog","aria-modal":"true",children:x.jsxs("div",{className:"raw-holo",style:{width:"95vw",maxWidth:"none",height:"90vh",display:"flex",flexDirection:"column"},children:[x.jsx("div",{className:"raw-anim-grid vector-grid","aria-hidden":!0}),x.jsxs("header",{className:"raw-holo-head",children:[x.jsxs("div",{children:[x.jsx("h3",{className:"raw-head-title",children:"Vector Command Center"}),x.jsx("p",{className:"raw-head-note",children:"Prompt Architect & Image-to-SVG Vectorizer."})]}),x.jsxs("button",{className:"btn ghost",onClick:()=>o(null),children:["Close ",x.jsx("span",{className:"close-cross","aria-hidden":!0,children:"âœ•"})]})]}),x.jsx("div",{style:{flex:1,overflow:"hidden",padding:"0"},children:x.jsx(ITe,{})})]})}),i==="monitor"&&x.jsx("div",{className:"tools-overlay",role:"dialog","aria-modal":"true",children:x.jsxs("div",{className:"raw-holo",style:{maxWidth:"900px",width:"95%",height:"90vh",display:"flex",flexDirection:"column"},children:[x.jsx("div",{className:"raw-anim-grid vector-grid","aria-hidden":!0}),x.jsxs("header",{className:"raw-holo-head",children:[x.jsxs("div",{children:[x.jsx("h3",{className:"raw-head-title",children:"AI Overseer"}),x.jsx("p",{className:"raw-head-note",children:"System Process Monitor & Analysis"})]}),x.jsxs("button",{className:"btn ghost",onClick:()=>o(null),children:["Close ",x.jsx("span",{className:"close-cross","aria-hidden":!0,children:"âœ•"})]})]}),x.jsx("div",{style:{flex:1,overflow:"hidden",padding:"0",position:"relative"},children:x.jsx(CTe,{onBack:()=>o(null)})})]})}),i==="raw"&&x.jsx("div",{className:"tools-overlay",role:"dialog","aria-modal":"true",children:x.jsxs("div",{className:"raw-holo",children:[x.jsx("div",{className:"raw-anim-grid","aria-hidden":!0}),x.jsxs("header",{className:"raw-holo-head",children:[x.jsxs("div",{children:[x.jsx("h3",{className:"raw-head-title",children:"RAW Decoder Lab"}),x.jsx("p",{className:"raw-head-note",children:"RAW image converter Â· from any RAW to any format."})]}),x.jsxs("button",{className:"btn ghost",onClick:()=>o(null),children:["Close ",x.jsx("span",{className:"close-cross","aria-hidden":!0,children:"âœ•"})]})]}),x.jsxs("section",{className:"raw-deck",children:[x.jsxs("div",{className:"raw-deck-head",children:[x.jsx("p",{className:"raw-deck-label",children:"Stage preview"}),x.jsx("div",{className:"raw-deck-badge",children:"Live"})]}),x.jsxs("div",{className:"tools-slider","aria-roledescription":"carousel",children:[x.jsx("button",{className:"slider-btn","aria-label":"Previous stage",onClick:()=>c("prev"),children:x.jsx(qG,{size:20,"aria-hidden":!0})}),x.jsx("div",{className:"tool-stage",children:x.jsx("div",{className:"tool-track",style:{transform:`translateX(-${a*100}%)`},children:O1.map(u=>x.jsx("article",{className:"tool-slide",children:x.jsxs("div",{className:"tool-floating glass",children:[x.jsxs("header",{className:"tool-slide-head",children:[x.jsx("span",{className:"tool-icon-pill",children:x.jsx(z1,{size:20,"aria-hidden":!0})}),x.jsxs("div",{children:[x.jsx("p",{className:"tool-tag",children:"Stage"}),x.jsx("h2",{children:u.title})]}),x.jsx("span",{className:"status-chip live",children:"ACTIVE"})]}),x.jsx("p",{className:"tool-summary",children:u.detail}),x.jsx("ul",{className:"tool-highlights",children:u.notes.map(h=>x.jsx("li",{children:h},h))}),x.jsxs("div",{className:"tool-actions compact",children:[x.jsxs("button",{className:"btn ghost",onClick:()=>c("next"),children:["Next Stage ",x.jsx(cu,{size:16,"aria-hidden":!0})]}),x.jsx("span",{className:"stage-hint",children:"Currently runningâ€¦"})]})]})},u.id))})}),x.jsx("button",{className:"slider-btn","aria-label":"Next stage",onClick:()=>c("next"),children:x.jsx(cu,{size:20,"aria-hidden":!0})})]})]})]})}),i==="downloader"&&x.jsx("div",{className:"tools-overlay",role:"dialog","aria-modal":"true",children:x.jsxs("div",{className:"raw-holo",style:{maxWidth:"500px"},children:[x.jsx("div",{className:"raw-anim-grid downloader-grid","aria-hidden":!0}),x.jsxs("header",{className:"raw-holo-head",children:[x.jsxs("div",{children:[x.jsx("h3",{className:"raw-head-title",children:"404 Social Media Downloader"}),x.jsx("p",{className:"raw-head-note",children:"Desktop App Required"})]}),x.jsxs("button",{className:"btn ghost",onClick:()=>o(null),children:["Close ",x.jsx("span",{className:"close-cross","aria-hidden":!0,children:"âœ•"})]})]}),x.jsxs("section",{className:"downloader-box",style:{padding:"2rem",display:"flex",flexDirection:"column",gap:"1.5rem",alignItems:"center",textAlign:"center"},children:[x.jsxs("p",{className:"downloader-hint intense",children:["For the best experience, use our dedicated desktop application.",x.jsx("br",{}),"Secure, fast, and ad-free."]}),x.jsxs("div",{className:"trust-badge",style:{fontSize:"0.8rem",color:"#9aa3b2",background:"rgba(255,255,255,0.05)",padding:"0.5rem 1rem",borderRadius:"4px",border:"1px solid rgba(255,255,255,0.1)"},children:["âš ï¸ ",x.jsx("strong",{children:"Windows Warning?"}),' Click "More Info" â†’ "Run Anyway".',x.jsx("br",{}),"(Normal for new open-source tools!)"]}),x.jsxs("div",{className:"cta-stack",style:{width:"100%",maxWidth:"400px"},children:[x.jsxs("button",{className:"btn full",type:"button",onClick:()=>window.open("https://github.com/Pramsss108/wh404-desktop-builds/releases/download/desktop-v1.0.0/WH404.Downloader_1.0.0_x64-setup.exe","_blank"),style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[x.jsx(uo,{size:20})," Download Installer"]}),x.jsxs("button",{className:"btn ghost full",type:"button",onClick:()=>window.open("https://github.com/Pramsss108/wh404-desktop-builds/releases","_blank"),children:[x.jsx(sa,{size:20})," View All Releases"]})]}),x.jsx("p",{className:"downloader-hint",children:"Windows 10/11 (64-bit) â€¢ 40 MB â€¢ No admin required"})]})]})})]})}function fVe(){const n=te.useMemo(()=>cv(),[]),e=n.available,t=e?x.jsx(z1,{size:12,"aria-hidden":!0}):x.jsx(LP,{size:12,"aria-hidden":!0}),s=e?"SAB LOCK":"SAB FALLBACK",r=e?"cross-origin isolated":n.reason??"missing COOP/COEP";return x.jsxs("div",{className:`watchdog-chip ${e?"watchdog-ok":"watchdog-warn"}`,role:"status","aria-live":"polite",title:`SharedArrayBuffer status: ${r}`,children:[t,x.jsx("span",{className:"watchdog-text",children:s})]})}const mVe=te.memo(fVe),RP="Word Hacker 404 Â· RAW Dock";function gVe(n,e){var l;const t=(l=n.metadata)==null?void 0:l.libraw,s=F1(t,"metadata","maker","camera"),r=F1(t,"exif","metadata","Exif"),i=F1(t,"lens"),o=yVe(Rr([s==null?void 0:s.timestamp,s==null?void 0:s.Timestamp,r==null?void 0:r.DateTimeOriginal,r==null?void 0:r.SubSecTimeOriginal])),a={cameraMake:Od(Rr([s==null?void 0:s.make,s==null?void 0:s.Make,s==null?void 0:s.camera_make,r==null?void 0:r.Make])),cameraModel:Od(Rr([s==null?void 0:s.model,s==null?void 0:s.Model,s==null?void 0:s.camera_model,r==null?void 0:r.Model])),lensModel:Od(Rr([i==null?void 0:i.lens,i==null?void 0:i.Lens,i==null?void 0:i.model,r==null?void 0:r.LensModel])),orientation:yl(Rr([r==null?void 0:r.Orientation,s==null?void 0:s.orientation,s==null?void 0:s.Orientation]),1),captureTime:o,software:RP,serialNumber:Od(Rr([s==null?void 0:s.serial,s==null?void 0:s.SerialNumber,r==null?void 0:r.BodySerialNumber])),imageDescription:e?`RAW export of ${e}`:void 0,exposureTime:bVe(Rr([r==null?void 0:r.ExposureTime,s==null?void 0:s.shutter])),fNumber:yl(Rr([r==null?void 0:r.FNumber,s==null?void 0:s.aperture]),void 0),iso:yl(Rr([r==null?void 0:r.ISOSpeedRatings,s==null?void 0:s.iso_speed,s==null?void 0:s.iso])),focalLength:yl(Rr([r==null?void 0:r.FocalLength,i==null?void 0:i.focal,i==null?void 0:i.FocalLength])),focalLength35mm:yl(Rr([r==null?void 0:r.FocalLengthIn35mmFilm,i==null?void 0:i.focal35,i==null?void 0:i.FocalLengthIn35mm])),colorSpace:xVe(n),uniqueImageId:Od(Rr([r==null?void 0:r.ImageUniqueID,t==null?void 0:t.unique_image_id,wVe()]))};return a.cameraMake||(a.cameraMake="Unknown Camera"),a.cameraModel||(a.cameraModel="RAW Source"),a.software||(a.software=RP),a}function F1(n,...e){if(n)for(const t of e){const s=n[t];if(s&&typeof s=="object")return s}}function Rr(n){for(const e of n)if(e!=null)return e}function yl(n,e){if(typeof n=="number"&&Number.isFinite(n))return n;if(typeof n=="string"){const t=Number(n);if(Number.isFinite(t))return t}return e}function Od(n){if(typeof n=="string"){const e=n.trim();return e.length?e:void 0}}function yVe(n){if(typeof n=="number"&&Number.isFinite(n))return new Date(n*1e3).toISOString();if(typeof n=="string"&&n.trim()){const e=new Date(n);if(!Number.isNaN(e.getTime()))return e.toISOString()}}function bVe(n){if(typeof n=="number"&&Number.isFinite(n))return n;if(typeof n=="string"){const e=n.match(/^(\d+)\/(\d+)$/);if(e){const s=Number(e[1]),r=Number(e[2]);if(r!==0)return s/r}const t=Number(n);if(Number.isFinite(t))return t}if(typeof n=="object"&&n){const e=yl(n.numerator??n.num),t=yl(n.denominator??n.den);if(e!==void 0&&t&&t!==0)return e/t}}function xVe(n){var t,s,r;const e=(r=(s=(t=n.metadata)==null?void 0:t.libraw)==null?void 0:s.color)==null?void 0:r.space;if(typeof e=="string"){const i=e.toLowerCase();if(i.includes("srgb"))return"sRGB";if(i.includes("adobe"))return"AdobeRGB";if(i.includes("p3"))return"DisplayP3"}return"sRGB"}function wVe(){if(typeof crypto<"u"&&"randomUUID"in crypto)try{return crypto.randomUUID()}catch(n){console.warn("[deriveExportMetadata] randomUUID failed",n)}}function ly(n){if(!Number.isFinite(n)||n<=0)return"0 B";const e=["B","KB","MB","GB"],t=Math.min(Math.floor(Math.log(n)/Math.log(1024)),e.length-1),s=n/1024**t;return`${s.toFixed(s>=10?1:2)} ${e[t]}`}function $P(n){return!Number.isFinite(n)||n<=0?"0 ms":n<1e3?`${n.toFixed(0)} ms`:`${(n/1e3).toFixed(2)} s`}function DP(n){return!n||n.length===0?"â€”":n.map(e=>{const t=Math.abs(e);return t>=100?e.toFixed(0):t>=10?e.toFixed(1):e.toFixed(2)}).join(" / ")}const cy=[{stroke:"rgba(255,92,141,0.95)",fill:"rgba(255,92,141,0.25)"},{stroke:"rgba(10,255,106,0.9)",fill:"rgba(10,255,106,0.18)"},{stroke:"rgba(77,166,255,0.9)",fill:"rgba(77,166,255,0.2)"},{stroke:"rgba(233,238,246,0.85)",fill:"rgba(233,238,246,0.12)"}],rG="rawDock.exportLog.v1",zS=8,vVe=[{id:"tiff16",label:"TIFF 16-bit",detail:"LZW compressed archive"},{id:"png16",label:"PNG 16-bit",detail:"Lossless glass"},{id:"jpegxl",label:"JPEG XL",detail:"Delivery ready"},{id:"jpeg-preview",label:"JPEG Preview",detail:"Downscaled diagnostic"}];function PP(){return{tiff16:{status:"idle"},png16:{status:"idle"},jpegxl:{status:"idle"},"jpeg-preview":{status:"idle"}}}function IVe(n,e){const t=n||"raw-export";switch(e){case"png16":return`${t}.png`;case"jpegxl":return`${t}.jxl`;case"jpeg-preview":return`${t}.jpg`;case"tiff16":default:return`${t}.tiff`}}function SVe(){if(typeof window>"u")return[];try{const n=window.localStorage.getItem(rG);if(!n)return[];const e=JSON.parse(n);if(Array.isArray(e))return e.slice(0,zS)}catch(n){console.warn("[RawDiagnosticsPanel] Failed to parse export log",n)}return[]}function kVe(n){if(!(typeof window>"u"))try{window.localStorage.setItem(rG,JSON.stringify(n))}catch(e){console.warn("[RawDiagnosticsPanel] Failed to persist export log",e)}}function TVe(n){const e=new Date(n);return Number.isNaN(e.getTime())?"â€”":e.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})}function CVe(n){return{id:typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,timestamp:new Date().toISOString(),...n}}function EVe(){const n=te.useRef(null),[e,t]=te.useState(!1),[s,r]=te.useState(null),[i,o]=te.useState(null),[a,l]=te.useState(""),c=te.useRef(null),u=te.useRef([]),[h,d]=te.useState(PP),[p,f]=te.useState(85),[g,m]=te.useState(SVe),y=te.useCallback(()=>{var k;(k=n.current)==null||k.click()},[]),w=te.useCallback(async k=>{if(!k||k.length===0)return;const S=k[0];r(null),t(!0),o(null),l(S.name);try{const A=await B3e(S,{logicalName:S.name});o(A)}catch(A){r(A instanceof Error?A.message:"Unknown ingest failure")}finally{t(!1)}},[]),v=te.useCallback(k=>{k.preventDefault(),w(k.dataTransfer.files)},[w]),I=te.useCallback(()=>{u.current.forEach(k=>URL.revokeObjectURL(k)),u.current=[]},[]),_=te.useCallback(k=>{m(S=>{const A=[k,...S].slice(0,zS);return kVe(A),A})},[]);te.useEffect(()=>(c.current=ox.getInstance(),()=>{I()}),[I]),te.useEffect(()=>{I(),d(PP())},[I,i==null?void 0:i.traceToken]),te.useEffect(()=>{i!=null&&i.pipelineBuffer&&d(k=>{const S={...k},A=S["jpeg-preview"];return A!=null&&A.url&&(URL.revokeObjectURL(A.url),u.current=u.current.filter(P=>P!==A.url)),S["jpeg-preview"]={status:"idle"},S})},[p,i==null?void 0:i.pipelineBuffer]);const N=te.useMemo(()=>(a||(i==null?void 0:i.logicalName)||"raw-decode").replace(/[^a-z0-9-_]+/gi,"_").replace(/_{2,}/g,"_").toLowerCase(),[a,i==null?void 0:i.logicalName]),T=te.useMemo(()=>{if(i!=null&&i.pipeline)return gVe(i.pipeline,i.logicalName||a)},[a,i==null?void 0:i.logicalName,i==null?void 0:i.pipeline]),E=te.useCallback(async k=>{if(!(i!=null&&i.pipeline)||!i.pipelineBuffer)return;const S=c.current??ox.getInstance();c.current=S,d(A=>({...A,[k]:{status:"working"}}));try{const A=await S.export({buffer:i.pipelineBuffer,width:i.pipeline.dimensions.width,height:i.pipeline.dimensions.height,channels:i.pipeline.channels,bitDepth:i.pipeline.bitDepth,metadata:T},k,k==="jpeg-preview"?{previewQuality:p/100}:void 0);d(P=>{const D={...P},V=D[k];V!=null&&V.url&&(URL.revokeObjectURL(V.url),u.current=u.current.filter(q=>q!==V.url));const U=URL.createObjectURL(A.blob);return u.current.push(U),D[k]={status:"ready",url:U,bytes:A.bytes,label:A.label,checksum:A.checksum},D}),_(CVe({format:k,label:A.label,bytes:A.bytes,checksum:A.checksum,durationMs:A.durationMs}))}catch(A){d(P=>({...P,[k]:{status:"error",error:A instanceof Error?A.message:"Export failed"}}))}},[_,T,p,i]);return x.jsxs("section",{className:"raw-diagnostics glass","aria-live":"polite",children:[x.jsxs("header",{className:"raw-diag-head",children:[x.jsx(Uy,{size:18,"aria-hidden":!0}),x.jsxs("div",{children:[x.jsx("p",{className:"mono",style:{fontSize:"0.65rem",letterSpacing:"0.25em",margin:0},children:"RAW DOCK"}),x.jsx("h2",{children:"Lossless Intake"})]}),x.jsxs("button",{className:"btn ghost small",onClick:y,disabled:e,children:[x.jsx(Vy,{size:14})," Select RAW"]}),x.jsx("input",{ref:n,type:"file",hidden:!0,accept:".cr2,.cr3,.nef,.arw,.raf,.dng,.orf,.rw2,.3fr,.fff,.raw,.rwl,.pef",onChange:k=>w(k.target.files)})]}),x.jsx("div",{className:`raw-drop ${e?"raw-drop-busy":""}`,onDragOver:k=>k.preventDefault(),onDrop:v,children:e?x.jsxs("span",{children:[x.jsx(uy,{className:"spin",size:18,"aria-hidden":!0})," Probingâ€¦"]}):x.jsx("span",{children:"Drop RAW file here â€¢ first-attempt ingest"})}),s&&x.jsxs("div",{className:"raw-alert",role:"alert",children:[x.jsx(FP,{size:14,"aria-hidden":!0})," ",s]}),i&&x.jsxs("div",{className:"raw-diag-grid",children:[x.jsxs("div",{children:[x.jsx("p",{className:"label",children:"Logical name"}),x.jsx("p",{className:"value mono",children:a||i.logicalName})]}),x.jsxs("div",{children:[x.jsx("p",{className:"label",children:"Format"}),x.jsx("p",{className:"value",children:i.diagnostics.formatLabel})]}),x.jsxs("div",{children:[x.jsx("p",{className:"label",children:"Vendor"}),x.jsx("p",{className:"value",children:i.diagnostics.vendorGuess??"Unknown"})]}),x.jsxs("div",{children:[x.jsx("p",{className:"label",children:"CFA"}),x.jsx("p",{className:"value mono",children:i.diagnostics.colorFilterArray})]}),x.jsxs("div",{children:[x.jsx("p",{className:"label",children:"Endianness"}),x.jsx("p",{className:"value mono",children:i.diagnostics.littleEndian?"Little":"Big"})]}),x.jsxs("div",{children:[x.jsx("p",{className:"label",children:"Header digest"}),x.jsx("p",{className:"value mono",children:i.diagnostics.headerDigest})]}),x.jsxs("div",{children:[x.jsx("p",{className:"label",children:"Payload"}),x.jsx("p",{className:"value mono",children:ly(i.receivedBytes)})]}),x.jsxs("div",{children:[x.jsx("p",{className:"label",children:"Turnaround"}),x.jsx("p",{className:"value mono",children:$P(i.elapsedMs)})]}),x.jsx("div",{className:"status-pill",children:i.status==="completed"?x.jsxs(x.Fragment,{children:[x.jsx(L1,{size:14,"aria-hidden":!0})," Completed"]}):i.status==="failed"?x.jsxs(x.Fragment,{children:[x.jsx(KG,{size:14,"aria-hidden":!0})," Failed"]}):x.jsxs(x.Fragment,{children:[x.jsx(uu,{size:14,"aria-hidden":!0})," ",i.status]})})]}),(i==null?void 0:i.pipeline)&&x.jsxs("div",{className:"raw-pipeline-card",children:[x.jsxs("div",{className:"raw-pipeline-grid",children:[x.jsxs("div",{children:[x.jsx("p",{className:"label",children:"Resolution"}),x.jsxs("p",{className:"value mono",children:[i.pipeline.dimensions.width,"Ã—",i.pipeline.dimensions.height]})]}),x.jsxs("div",{children:[x.jsx("p",{className:"label",children:"Bit depth"}),x.jsxs("p",{className:"value mono",children:[i.pipeline.bitDepth,"-bit"]})]}),x.jsxs("div",{children:[x.jsx("p",{className:"label",children:"Channels"}),x.jsx("p",{className:"value mono",children:i.pipeline.channels})]}),i.pipeline.preview&&x.jsxs("div",{children:[x.jsx("p",{className:"label",children:"Preview"}),x.jsxs("p",{className:"value mono",children:[i.pipeline.preview.width,"Ã—",i.pipeline.preview.height]}),x.jsx("small",{className:"mono muted",children:i.pipeline.preview.format})]})]}),i.pipeline.histogram&&x.jsx(_Ve,{histogram:i.pipeline.histogram}),i.pipeline.colorScience&&x.jsxs("div",{className:"raw-color-science",children:[x.jsxs("div",{children:[x.jsx("p",{className:"label",children:"Black level"}),x.jsx("p",{className:"value mono",children:DP(i.pipeline.colorScience.blackLevel)})]}),x.jsxs("div",{children:[x.jsx("p",{className:"label",children:"WB multipliers"}),x.jsx("p",{className:"value mono",children:DP(i.pipeline.colorScience.whiteBalance)})]}),typeof i.pipeline.colorScience.maxSignal=="number"&&x.jsxs("div",{children:[x.jsx("p",{className:"label",children:"Max signal"}),x.jsx("p",{className:"value mono",children:i.pipeline.colorScience.maxSignal})]}),x.jsx("div",{className:"raw-color-chip",children:x.jsx("span",{className:`badge ${i.pipeline.colorScience.applied?"engine-ok":"engine-missing"}`,children:i.pipeline.colorScience.applied?"calibrated":"metadata only"})}),i.pipeline.colorScience.notes&&x.jsx("ul",{className:"raw-color-notes",children:i.pipeline.colorScience.notes.map((k,S)=>x.jsx("li",{children:k},`${k}-${S}`))})]}),i.pipelineBuffer&&x.jsxs("div",{className:"raw-exporter",children:[x.jsxs("div",{className:"raw-export-head",children:[x.jsxs("div",{children:[x.jsx("p",{className:"label",children:"Exports"}),x.jsx("p",{className:"value mono",children:"16-bit core sealed"})]}),x.jsxs("label",{className:"raw-export-quality",children:[x.jsx("span",{children:"Preview quality"}),x.jsx("input",{type:"range",min:60,max:95,value:p,onChange:k=>f(Number(k.target.value))}),x.jsxs("span",{className:"mono",children:[p,"%"]})]})]}),x.jsx("div",{className:"raw-export-grid",children:vVe.map(k=>{const S=h[k.id],A=(S==null?void 0:S.status)==="working",P=A?"Buildingâ€¦":(S==null?void 0:S.status)==="ready"?"Rebuild":"Build lossless";return x.jsxs("div",{className:"raw-export-card",children:[x.jsxs("div",{children:[x.jsx("p",{className:"label",children:k.label}),x.jsx("p",{className:"value mono",children:k.detail})]}),x.jsx("button",{className:"btn ghost small",onClick:()=>E(k.id),disabled:A||!i.pipelineBuffer,children:P}),(S==null?void 0:S.bytes)&&x.jsxs("p",{className:"raw-export-meta mono",children:[ly(S.bytes),S.checksum?` Â· ${S.checksum.slice(0,16)}â€¦`:""]}),(S==null?void 0:S.status)==="ready"&&S.url&&x.jsxs("a",{className:"raw-export-download",href:S.url,download:IVe(N,k.id),children:[x.jsx(mp,{size:14,"aria-hidden":!0})," Download Â· ",ly(S.bytes??0)]}),(S==null?void 0:S.status)==="error"&&x.jsx("p",{className:"raw-export-error",children:S.error})]},k.id)})}),x.jsx("small",{className:"mono muted",children:"Slider only touches JPEG preview; TIFF/PNG/JPEG XL stay at full 16-bit."}),g.length>0&&x.jsxs("div",{className:"raw-export-log",children:[x.jsxs("header",{children:[x.jsx("span",{children:"Diagnostics log"}),x.jsxs("span",{className:"mono",children:["latest ",g.length,"/",zS]})]}),x.jsx("ul",{children:g.map(k=>x.jsxs("li",{children:[x.jsxs("span",{children:[x.jsx("strong",{children:k.format})," Â· ",k.label]}),x.jsxs("span",{children:[ly(k.bytes),k.checksum?` Â· ${k.checksum.slice(0,12)}â€¦`:""]}),x.jsxs("span",{children:[TVe(k.timestamp),typeof k.durationMs=="number"?` Â· ${$P(k.durationMs)}`:""]})]},k.id))})]})]}),i.pipeline.arbitration&&x.jsxs("div",{className:"raw-arbitration",children:[x.jsxs("div",{children:[x.jsx("p",{className:"label",children:"Engine winner"}),x.jsx("p",{className:"value mono",children:i.pipeline.arbitration.winner})]}),x.jsx("div",{className:"raw-arb-engines",children:i.pipeline.arbitration.engines.map(k=>x.jsxs("span",{className:`badge engine-${k.status}`,children:[k.id," Â· ",k.status]},k.id))}),typeof i.pipeline.arbitration.varianceScore=="number"&&x.jsxs("small",{className:"mono muted",children:["variance ",Math.round(i.pipeline.arbitration.varianceScore*100),"% Â· threshold ",Math.round(i.pipeline.arbitration.threshold*100),"%"]})]})]}),(i==null?void 0:i.notes)&&i.notes.length>0&&x.jsx("ul",{className:"raw-notes",children:i.notes.map((k,S)=>x.jsx("li",{children:k},`${k}-${S}`))})]})}function _Ve({histogram:n}){const e=te.useRef(null);return te.useEffect(()=>{const t=e.current;if(!t)return;const s=t.getContext("2d");if(!s)return;const{width:r,height:i}=t;s.clearRect(0,0,r,i),s.fillStyle="rgba(255,255,255,0.02)",s.fillRect(0,0,r,i);const o=n.channels.reduce((a,l)=>{const c=l.values.reduce((u,h)=>h>u?h:u,0);return c>a?c:a},0);n.channels.forEach((a,l)=>{const c=cy[l%cy.length];s.beginPath(),s.moveTo(0,i);const u=a.values.length,h=Math.max(1,u-1);for(let d=0;d<u;d+=1){const p=a.values[d]??0,f=o>0?p/o:0,g=d/h*r,m=i-f*i;s.lineTo(g,m)}s.lineTo(r,i),s.closePath(),s.fillStyle=c.fill,s.strokeStyle=c.stroke,s.lineWidth=1,s.fill(),s.stroke()})},[n]),x.jsxs("div",{className:"raw-histogram-card",children:[x.jsxs("div",{className:"raw-hist-head",children:[x.jsx("p",{className:"label",children:"QA Histogram"}),x.jsx("span",{className:"mono muted",children:n.channels.map(t=>t.label).join(" Â· ")})]}),x.jsx("canvas",{ref:e,className:"raw-hist-canvas",width:320,height:110,role:"img","aria-label":"Histogram overlay"}),x.jsx("div",{className:"raw-hist-legend",children:n.channels.map((t,s)=>{const r=cy[s%cy.length];return x.jsx("span",{className:"hist-chip",style:{borderColor:r.stroke,color:r.stroke},children:t.label},`${t.label}-${s}`)})})]})}function NVe({onClose:n}){const[e,t]=te.useState("loading"),[s,r]=te.useState(null),[i,o]=te.useState("inf"),[a,l]=te.useState("overview"),[c,u]=te.useState("select"),[h,d]=te.useState(""),[p,f]=te.useState(""),[g,m]=te.useState(!1),[y,w]=te.useState(""),[v,I]=te.useState(!1),[_,N]=te.useState("");te.useEffect(()=>Os.subscribe((V,U)=>{console.log("ðŸ“Š Dashboard received auth update:",V,U==null?void 0:U.email),t(V),r(U),U&&(I(!1),N("Logged in successfully!")),T()}),[]);const T=async()=>{const D=await Os.checkAccess();D.remaining!==void 0&&o(D.remaining>100?"inf":D.remaining)},E=async()=>{I(!0),w("");try{await Os.signIn()}catch(D){w(D.message||"Login Failed. Please try again."),I(!1)}},k=async D=>{var V,U,q,J;if(!h||!p){w("Please fill in all fields");return}if(p.length<6){w("Password must be at least 6 characters");return}I(!0),w("");try{D?(await Os.signUpWithEmail(h,p),N("Account created successfully!")):(await Os.signInWithEmail(h,p),N("Logged in!")),d(""),f(""),u("select")}catch(K){const ee=(V=K.code)!=null&&V.includes("user-not-found")?"No account found. Try signing up.":(U=K.code)!=null&&U.includes("wrong-password")?"Incorrect password.":(q=K.code)!=null&&q.includes("email-already-in-use")?"Email already registered. Try logging in.":(J=K.code)!=null&&J.includes("invalid-email")?"Invalid email format.":K.message||"Authentication failed";w(ee)}finally{I(!1)}},S=async()=>{I(!0),w("");try{await Os.signInAsGuest(),N("Signed in as Guest!")}catch(D){w(D.message||"Guest login failed.")}finally{I(!1)}},A=async()=>{await Os.signOut(),n()},P=({user:D})=>{const[V,U]=te.useState(!1);return D.photoURL&&!V?x.jsx("img",{src:D.photoURL,alt:"Profile",className:"profile-img",onError:q=>{U(!0),q.currentTarget.style.display="none"}}):x.jsx(t6,{size:24})};return x.jsx("div",{className:"login-overlay",children:x.jsxs("div",{className:"dashboard-container glass",children:[x.jsxs("aside",{className:"dash-sidebar",children:[x.jsxs("div",{className:"dash-brand",children:[x.jsx(uo,{className:"brand-icon"}),x.jsx("span",{children:"Word Hacker"})]}),x.jsxs("nav",{className:"dash-nav",children:[x.jsxs("button",{className:`nav-item ${a==="overview"?"active":""}`,onClick:()=>l("overview"),children:[x.jsx(XG,{size:18})," Overview"]}),x.jsxs("button",{className:`nav-item ${a==="billing"?"active":""}`,onClick:()=>l("billing"),children:[x.jsx(YG,{size:18})," Plan & Billing"]}),x.jsxs("button",{className:`nav-item ${a==="settings"?"active":""}`,onClick:()=>l("settings"),children:[x.jsx(QG,{size:18})," Settings"]})]}),x.jsx("div",{className:"dash-footer",children:s&&x.jsxs("button",{className:"logout-btn",onClick:A,children:[x.jsx(kA,{size:16})," Sign Out"]})})]}),x.jsxs("main",{className:"dash-content",children:[x.jsx("button",{className:"close-btn-corner",onClick:n,children:x.jsx(El,{size:20})}),s?x.jsxs("div",{className:"user-view",children:[a==="overview"&&x.jsxs(x.Fragment,{children:[x.jsxs("header",{className:"content-header",children:[x.jsxs("div",{className:"user-welcome",children:[x.jsx("div",{className:"avatar-small",children:x.jsx(P,{user:s})}),x.jsxs("div",{children:[x.jsxs("h1",{children:["Welcome",s.displayName?`, ${s.displayName.split(" ")[0]}`:" back","!"]}),x.jsx("p",{className:"user-email",children:s.email||(s.isAnonymous?"Guest User":"No email")})]})]}),x.jsx("div",{className:"header-badges",children:x.jsx("span",{className:`plan-badge ${s.isAnonymous?"guest":""}`,children:e==="god_mode"?"GOD MODE":s.isAnonymous?"GUEST":"PRO PLAN"})})]}),s.isAnonymous&&x.jsxs("div",{className:"guest-upgrade-banner",children:[x.jsx("p",{children:"ðŸ”’ You're browsing as a guest. Sign in to unlock all features and save your progress."}),x.jsx("button",{onClick:()=>{Os.signOut()},children:"Upgrade Account"})]}),x.jsxs("div",{className:"stats-row",children:[x.jsxs("div",{className:"stat-card",children:[x.jsx("label",{children:"Daily Credits"}),x.jsxs("div",{className:"stat-value",children:[e==="god_mode"?"âˆž":s.isAnonymous?"3":i,x.jsxs("span",{className:"stat-total",children:["/",s.isAnonymous?"3":"10"]})]}),x.jsx("div",{className:"stat-bar",children:x.jsx("div",{className:"stat-fill",style:{width:e==="god_mode"?"100%":`${Number(i)/10*100}%`}})})]}),x.jsxs("div",{className:"stat-card",children:[x.jsx("label",{children:"Account Status"}),x.jsx("div",{className:`stat-value ${s.isAnonymous?"":"ok"}`,children:s.isAnonymous?"Limited":"Active"}),x.jsx("div",{className:"stat-sub",children:s.isAnonymous?"Anonymous Session":"Verified Identity"})]})]}),x.jsxs("div",{className:"action-section",children:[x.jsx("h3",{children:"Quick Actions"}),x.jsxs("div",{className:"action-grid",children:[x.jsxs("button",{className:"action-card",children:[x.jsx(TA,{size:20}),x.jsx("span",{children:"View History"}),x.jsx(cu,{size:16,className:"arrow"})]}),x.jsxs("button",{className:"action-card",children:[x.jsx(Uy,{size:20}),x.jsx("span",{children:"Security Log"}),x.jsx(cu,{size:16,className:"arrow"})]})]})]})]}),a==="billing"&&x.jsxs("div",{className:"tab-content fade-in",children:[x.jsx("h2",{className:"tab-title",children:"Plan & Billing"}),x.jsxs("div",{className:"billing-card glass",children:[x.jsxs("div",{className:"plan-header",children:[x.jsxs("div",{children:[x.jsx("h3",{children:"Free Tier"}),x.jsx("p",{children:"Current Plan"})]}),x.jsx("span",{className:"badge active",children:"Active"})]}),x.jsxs("ul",{className:"plan-features",children:[x.jsxs("li",{children:[x.jsx(Rg,{size:16})," 10 AI Credits / Day"]}),x.jsxs("li",{children:[x.jsx(Rg,{size:16})," Basic Word Decoding"]}),x.jsxs("li",{children:[x.jsx(Rg,{size:16})," Community Support"]})]})]}),x.jsxs("div",{className:"billing-card glass disabled",children:[x.jsxs("div",{className:"plan-header",children:[x.jsxs("div",{children:[x.jsx("h3",{children:"Pro Hacker"}),x.jsx("p",{children:"Coming Soon"})]}),x.jsx("span",{className:"badge",children:"Soon"})]}),x.jsxs("ul",{className:"plan-features",children:[x.jsxs("li",{children:[x.jsx(uo,{size:16})," Unlimited Credits"]}),x.jsxs("li",{children:[x.jsx(uo,{size:16})," GPT-4 Turbo Access"]}),x.jsxs("li",{children:[x.jsx(uo,{size:16})," Priority Queue"]})]})]})]}),a==="settings"&&x.jsxs("div",{className:"tab-content fade-in",children:[x.jsx("h2",{className:"tab-title",children:"Settings"}),x.jsxs("div",{className:"settings-group",children:[x.jsx("h3",{children:"Account"}),x.jsx("div",{className:"setting-item",children:x.jsxs("div",{children:[x.jsx("label",{children:"Email"}),x.jsx("p",{children:s.email||"Anonymous"})]})}),x.jsx("div",{className:"setting-item",children:x.jsxs("div",{children:[x.jsx("label",{children:"User ID"}),x.jsxs("p",{className:"mono",children:[s.uid.slice(0,8),"..."]})]})})]}),x.jsxs("div",{className:"settings-group",children:[x.jsx("h3",{children:"Data & Privacy"}),x.jsxs("button",{className:"btn-danger-outline",onClick:()=>{confirm("Clear local history?")&&(localStorage.removeItem("cortex_history"),alert("History cleared."))},children:[x.jsx(gf,{size:16})," Clear Local History"]})]}),x.jsx("div",{className:"settings-group",children:x.jsxs("button",{className:"btn-danger-full",onClick:A,children:[x.jsx(kA,{size:16})," Sign Out"]})})]})]}):x.jsx("div",{className:"guest-view",children:c==="select"?x.jsxs(x.Fragment,{children:[x.jsxs("div",{className:"guest-hero",children:[x.jsx("div",{className:"hero-icon-ring",children:x.jsx(jS,{size:32})}),x.jsx("h2",{children:"Unlock the Neural Network"}),x.jsx("p",{children:"Sign in to access the Central AI Brain, save your history, and unlock Pro tools."})]}),x.jsxs("div",{className:"feature-list",children:[x.jsxs("div",{className:"feature",children:[x.jsx(uo,{size:16,className:"f-icon"}),x.jsx("span",{children:"GPT-OSS-120B Access"})]}),x.jsxs("div",{className:"feature",children:[x.jsx(TA,{size:16,className:"f-icon"}),x.jsx("span",{children:"Save Chat History"})]}),x.jsxs("div",{className:"feature",children:[x.jsx(Uy,{size:16,className:"f-icon"}),x.jsx("span",{children:"Pro Security Badge"})]})]}),y&&x.jsxs("div",{className:"auth-message error",children:[x.jsx(By,{size:16}),x.jsx("span",{children:y})]}),_&&x.jsxs("div",{className:"auth-message success",children:[x.jsx(Rg,{size:16}),x.jsx("span",{children:_})]}),x.jsxs("div",{className:"auth-buttons",children:[x.jsxs("button",{className:"auth-btn google",onClick:E,disabled:v,children:[x.jsx("img",{src:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg",alt:"G"}),x.jsx("span",{children:v?"Connecting...":"Continue with Google"})]}),x.jsxs("button",{className:"auth-btn email",onClick:()=>{u("email-login"),w("")},children:[x.jsx(CA,{size:20}),x.jsx("span",{children:"Continue with Email"})]}),x.jsx("div",{className:"auth-divider",children:x.jsx("span",{children:"or"})}),x.jsxs("button",{className:"auth-btn guest",onClick:S,disabled:v,children:[x.jsx(ZG,{size:20}),x.jsx("span",{children:"Continue as Guest"})]})]}),x.jsx("p",{className:"auth-note",children:"Guest access has limited features. Sign in to save your progress."})]}):x.jsxs("div",{className:"email-form-container",children:[x.jsx("button",{className:"back-to-select",onClick:()=>{u("select"),w("")},children:"â† Back to options"}),x.jsxs("div",{className:"email-form-header",children:[x.jsx(CA,{size:32,className:"email-icon"}),x.jsx("h2",{children:c==="email-login"?"Sign In":"Create Account"}),x.jsx("p",{children:c==="email-login"?"Enter your credentials":"Set up your new account"})]}),y&&x.jsxs("div",{className:"auth-message error",children:[x.jsx(By,{size:16}),x.jsx("span",{children:y})]}),x.jsxs("form",{className:"email-form",onSubmit:D=>{D.preventDefault(),k(c==="email-signup")},children:[x.jsxs("div",{className:"form-group",children:[x.jsx("label",{children:"Email"}),x.jsx("input",{type:"email",value:h,onChange:D=>d(D.target.value),placeholder:"you@example.com",autoComplete:"email"})]}),x.jsxs("div",{className:"form-group",children:[x.jsx("label",{children:"Password"}),x.jsxs("div",{className:"password-input",children:[x.jsx("input",{type:g?"text":"password",value:p,onChange:D=>f(D.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",autoComplete:c==="email-login"?"current-password":"new-password"}),x.jsx("button",{type:"button",className:"toggle-password",onClick:()=>m(!g),children:g?x.jsx(JG,{size:18}):x.jsx(e6,{size:18})})]})]}),x.jsx("button",{type:"submit",className:"submit-btn",disabled:v,children:v?"Please wait...":c==="email-login"?"Sign In":"Create Account"})]}),x.jsx("div",{className:"auth-switch",children:c==="email-login"?x.jsxs("p",{children:["Don't have an account? ",x.jsx("button",{onClick:()=>{u("email-signup"),w("")},children:"Sign Up"})]}):x.jsxs("p",{children:["Already have an account? ",x.jsx("button",{onClick:()=>{u("email-login"),w("")},children:"Sign In"})]})})]})})]})]})})}const AVe=[{id:"w1",word:"à¦­à¦¾à¦‡à¦°à¦¾à¦²",tone:"comedic",teaser:"à¦¸à¦¬à¦¾à¦‡ à¦¬à¦²à§‡, à¦•à¦¿à¦¨à§à¦¤à§ à¦­à¦¿à¦¤à¦°à§‡ à¦šà¦¾à¦ªà¦¾ insecurityà¥¤",emoji:"ðŸ”¥"},{id:"w2",word:"à¦–à¦¿à¦¸à§à¦¤à¦¿",tone:"angry",teaser:"à¦°à¦¾à¦— à¦¨à¦¾, à¦¬à§à¦¯à¦¥à¦¾â€”à¦šà§‹à¦–à§‡ à¦ªà¦°à§‡ à¦¨à¦¾, à¦®à§à¦–à§‡ à¦¬à§‡à¦°à§‹à¦¯à¦¼à¥¤",emoji:"ðŸ—¡ï¸"},{id:"w3",word:"à¦¸à¦¾à¦®à¦²",tone:"friendly",teaser:"à¦¬à¦¨à§à¦§à§à¦¦à§‡à¦° à¦ à¦¾à¦Ÿà§à¦Ÿà¦¾â€”à¦­à¦¾à¦²à§‹à¦¬à¦¾à¦¸à¦¾à¦° à¦›à¦¦à§à¦®à¦¬à§‡à¦¶à¥¤",emoji:"ðŸ«¶"}],RVe=[{id:"d1",word:"à¦²à¦¾à¦‰à¦¡à¦¾",literal:"à¦¶à¦¬à§à¦¦/à¦—à¦¾à¦²à¦¿",street:"à¦­à¦¾à¦‡à§Ÿà§‡à¦°à¦¾ à¦°à§‡à¦—à§‡ à¦—à§‡à¦²à§‡â€”à¦…à¦¥à¦¬à¦¾ à¦œà§‹à¦•à¦¸à¥¤",tones:["angry","comedic","taboo"],lang:"bn"},{id:"d2",word:"BC",literal:"cuss acronym",street:"à¦®à¦¿à¦®à§‡ à¦›à§à¦à§œà§‡ à¦¦à§‡à¦“à¦¯à¦¼à¦¾ à¦†à¦—à§à¦¨à¥¤",tones:["comedic","taboo"],lang:"hi"},{id:"d3",word:"simp",literal:"simpleton",street:"attention-à¦­à¦¿à¦¤à§à¦¤à¦¿à¦• à¦ªà§à¦°à§‡à¦®à§‡à¦° à¦¤à§à¦²à¦¿à¥¤",tones:["friendly","comedic"],lang:"en"}];function $Ve(){var m;const[n,e]=te.useState("menu"),[t]=te.useState(0),[s,r]=te.useState(""),[i,o]=te.useState(!0),[a,l]=te.useState(!1),[c,u]=te.useState("loading"),[h,d]=te.useState(null);te.useEffect(()=>{const y=Os.subscribe((w,v)=>{u(w),d(v)});return()=>y()},[]);const p=te.useRef(null),f=te.useMemo(()=>cv(),[]),{initWorker:g}=m_();return te.useEffect(()=>{g();const y=setTimeout(()=>o(!1),2400);return()=>clearTimeout(y)},[]),x.jsxs("div",{className:"app",children:[x.jsx(US,{opacity:.08,density:24,speed:2}),x.jsx(mVe,{}),n==="voice-encrypter"?x.jsx(Z6,{onBackToHome:()=>e("menu")}):n==="tools"?x.jsx(pVe,{onBackToHome:()=>e("menu")}):n==="menu"?x.jsxs(x.Fragment,{children:[x.jsxs("div",{className:"sysbar",children:[x.jsxs("div",{className:"sys-item clickable",onClick:()=>l(!0),style:{cursor:"pointer"},children:[x.jsx("span",{className:`dot ${h?"active":""}`,style:{background:h?"#0aff6a":c==="loading"?"#f59e0b":"#d92e2e"}}),c==="loading"?"ACCESS: VERIFYING...":h?`ID: ${(m=h.displayName)==null?void 0:m.split(" ")[0].toUpperCase()}`:"ACCESS: GUEST"]}),x.jsx("div",{className:"sys-item mono",children:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),x.jsxs("div",{className:"sys-item mono",children:["BETA Â· MATRIX-",Math.abs((Date.now()/1e3|0)%999)]}),x.jsx("div",{className:`sys-item mono sab-pill ${f.available?"ok":"warn"}`,children:f.available?"SAB LOCK":"SAB FALLBACK"})]}),x.jsx("header",{className:"header hero",ref:p,children:x.jsxs("div",{className:"container",children:[x.jsxs("div",{className:"brand-row",children:[x.jsxs("div",{className:"logo-pill glass",children:[x.jsx(uo,{className:"logo-icon","aria-hidden":!0}),x.jsx("span",{className:"logo-text",children:"Word Hacker 404"})]}),x.jsx("span",{className:"beta-tag",children:"CYBER EDITION"})]}),x.jsx("h1",{className:"hero-title",children:i?x.jsxs("span",{className:"type-line",children:["Word Hacker 404 â€” ",x.jsx("span",{className:"mono",children:"decode forbidden words"}),x.jsx("span",{className:"cursor"})]}):x.jsxs(x.Fragment,{children:["Word Hacker 404 â€” ",x.jsx("span",{className:"mono",children:"decode forbidden words"})]})}),x.jsx("p",{className:"hero-sub",children:"à¦†à¦®à¦°à¦¾ à¦¶à¦¬à§à¦¦ à¦–à§à¦à¦œà¦¿, à¦…à¦¨à§à¦­à§‚à¦¤à¦¿ à¦¦à§‡à¦–à¦¾à¦‡à¥¤ à§ªà§«â€“à§¬à§¦ à¦¸à§‡à¦•à§‡à¦¨à§à¦¡à§‡à¦° à¦¡à¦¿à¦•à§‹à¦¡ à¦°à¦¿à¦²à¦¸à¥¤"}),x.jsxs("div",{className:"cta-row",children:[x.jsxs("button",{className:"btn full",onClick:()=>{var y;(y=p.current)==null||y.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{const w=document.getElementById("featured");w==null||w.scrollIntoView({behavior:"smooth"})},260)},children:[x.jsx(sa,{size:18})," Decode Now ",x.jsx(cu,{size:18})]}),x.jsxs("button",{className:"btn ghost full",onClick:()=>{var y;return(y=document.getElementById("dictionary"))==null?void 0:y.scrollIntoView({behavior:"smooth"})},children:[x.jsx(M1,{size:18})," Open Dictionary"]})]})]})}),x.jsxs("main",{className:"main container",children:[x.jsx("section",{className:"tools-strip","aria-label":"Tools",children:x.jsxs("div",{className:"tools-row",children:[x.jsxs("button",{className:"tool glass",children:[x.jsx(n6,{size:18})," Sound Lab"]}),x.jsxs("button",{className:"tool glass",onClick:()=>e("tools"),children:[x.jsx(BS,{size:18})," Useful Tools"]}),x.jsxs("button",{className:"tool glass",onClick:()=>e("voice-encrypter"),children:[x.jsx(s6,{size:18})," Voice Encryptor"]}),x.jsxs("button",{className:"tool glass",children:[x.jsx(jS,{size:18})," Private Drops"]})]})}),x.jsxs("section",{id:"featured",className:"featured",children:[x.jsx("h2",{className:"section-title",children:"Featured Decodes"}),x.jsx("div",{className:"carousel",children:AVe.map(y=>x.jsxs("article",{className:`decode-card glass ${y.tone==="taboo"?"danger":""}`,children:[x.jsxs("header",{className:"decode-head",children:[x.jsx("span",{className:"emoji","aria-hidden":!0,children:y.emoji}),x.jsx("h3",{className:"decode-word",children:y.word}),x.jsx("span",{className:`badge tone-${y.tone}`,children:y.tone})]}),x.jsx("p",{className:"decode-tease",children:y.teaser}),x.jsx("button",{className:"btn full small",children:"Watch Reel"})]},y.id))})]}),x.jsxs("section",{id:"dictionary",className:"dictionary glass",children:[x.jsx("h2",{className:"section-title",children:"Slang Dictionary"}),x.jsxs("div",{className:"dict-search",children:[x.jsx(M1,{size:18}),x.jsx("input",{value:s,onChange:y=>r(y.target.value),placeholder:"Type a wordâ€¦ à¦¬à¦¾à¦‚à¦²à¦¾, à¤¹à¤¿à¤¨à¥à¤¦à¥€, English","aria-label":"Search dictionary"})]}),x.jsx("div",{className:"dict-tags",children:["Bengali","Hindi","English","para","meme"].map(y=>x.jsxs("span",{className:"tag",children:["#",y]},y))}),x.jsx("div",{className:"dict-results",children:RVe.filter(y=>y.word.toLowerCase().includes(s.toLowerCase())).slice(0,6).map(y=>x.jsxs("article",{className:"dict-card glass",children:[x.jsxs("header",{className:"dict-head",children:[x.jsx("h3",{className:"dict-word",children:y.word}),x.jsx("div",{className:"tones",children:y.tones.map(w=>x.jsx("span",{className:`badge tone-${w}`,children:w},w))})]}),x.jsxs("p",{className:"dict-mean",children:[x.jsx("b",{children:"lit:"})," ",y.literal]}),x.jsxs("p",{className:"dict-mean",children:[x.jsx("b",{children:"street:"})," ",y.street]}),x.jsxs("div",{className:"dict-actions",children:[x.jsx("button",{className:"btn ghost",children:"Listen"}),x.jsx("button",{className:"btn",children:"Report"})]})]},y.id))})]}),x.jsx("section",{id:"raw-lab",className:"raw-lab-section","aria-label":"RAW Diagnostics",children:x.jsx(EVe,{})}),x.jsxs("section",{className:"how glass",children:[x.jsx("h2",{className:"section-title",children:"How it works"}),x.jsxs("ol",{className:"steps",children:[x.jsxs("li",{children:[x.jsx("span",{className:"dot"})," Access"]}),x.jsxs("li",{children:[x.jsx("span",{className:"dot"})," Decode"]}),x.jsxs("li",{children:[x.jsx("span",{className:"dot"})," Reflect"]}),x.jsxs("li",{children:[x.jsx("span",{className:"dot"})," Submit your word"]})]}),x.jsxs("div",{className:"callout",children:[x.jsx("p",{children:"Secret drops via Telegram. Subscribe for private decodes."}),x.jsx("a",{className:"btn",href:"#","aria-disabled":!0,children:"Join Soon"})]})]})]}),x.jsxs("footer",{className:"footer",children:[x.jsx("p",{children:"Built like a pro. React + TypeScript + Vite. Optimized for touch."}),x.jsx("small",{className:"mono","aria-label":"terminal-log",children:"terminal-log: ready"})]})]}):x.jsx("main",{className:"main container",children:x.jsxs("div",{className:"game",children:[x.jsxs("div",{className:"game-header glass",children:[x.jsx("button",{className:"back-button",onClick:()=>e("menu"),children:"â† Back"}),x.jsxs("div",{className:"score",children:["Score: ",t]})]}),x.jsx("div",{className:"game-content",children:x.jsxs("div",{className:"game-placeholder",children:[x.jsx(jy,{className:"placeholder-icon"}),x.jsx("h3",{children:"Game Loading..."}),x.jsx("p",{children:"AI is preparing your word challenge!"})]})})]})}),a&&x.jsx(NVe,{onClose:()=>l(!1)})]})}V1.createRoot(document.getElementById("root")).render(x.jsx(_G.StrictMode,{children:x.jsx($Ve,{})}));export{gp as _};
//# sourceMappingURL=index-b7044f2a.js.map
