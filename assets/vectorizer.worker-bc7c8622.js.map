{"version":3,"file":"vectorizer.worker-bc7c8622.js","sources":["../node_modules/imagetracerjs/imagetracer_v1.2.6.js","../src/workers/vectorizer.worker.ts"],"sourcesContent":["/*\n\timagetracer.js version 1.2.6\n\tSimple raster image tracer and vectorizer written in JavaScript.\n\tandras@jankovics.net\n*/\n\n/*\n\nThe Unlicense / PUBLIC DOMAIN\n\nThis is free and unencumbered software released into the public domain.\n\nAnyone is free to copy, modify, publish, use, compile, sell, or\ndistribute this software, either in source code form or as a compiled\nbinary, for any purpose, commercial or non-commercial, and by any\nmeans.\n\nIn jurisdictions that recognize copyright laws, the author or authors\nof this software dedicate any and all copyright interest in the\nsoftware to the public domain. We make this dedication for the benefit\nof the public at large and to the detriment of our heirs and\nsuccessors. We intend this dedication to be an overt act of\nrelinquishment in perpetuity of all present and future rights to this\nsoftware under copyright law.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\nMERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\nIN NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR\nOTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,\nARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n\nFor more information, please refer to http://unlicense.org/\n\n*/\n\n(function(){ 'use strict';\n\nfunction ImageTracer(){\n\tvar _this = this;\n\n\tthis.versionnumber = '1.2.6',\n\t\n\t////////////////////////////////////////////////////////////\n\t//\n\t//  API\n\t//\n\t////////////////////////////////////////////////////////////\n\t\n\t// Loading an image from a URL, tracing when loaded,\n\t// then executing callback with the scaled svg string as argument\n\tthis.imageToSVG = function( url, callback, options ){\n\t\toptions = _this.checkoptions(options);\n\t\t// loading image, tracing and callback\n\t\t_this.loadImage(\n\t\t\turl,\n\t\t\tfunction(canvas){\n\t\t\t\tcallback(\n\t\t\t\t\t_this.imagedataToSVG( _this.getImgdata(canvas), options )\n\t\t\t\t);\n\t\t\t},\n\t\t\toptions\n\t\t);\n\t},// End of imageToSVG()\n\t\n\t// Tracing imagedata, then returning the scaled svg string\n\tthis.imagedataToSVG = function( imgd, options ){\n\t\toptions = _this.checkoptions(options);\n\t\t// tracing imagedata\n\t\tvar td = _this.imagedataToTracedata( imgd, options );\n\t\t// returning SVG string\n\t\treturn _this.getsvgstring(td, options);\n\t},// End of imagedataToSVG()\n\t\n\t// Loading an image from a URL, tracing when loaded,\n\t// then executing callback with tracedata as argument\n\tthis.imageToTracedata = function( url, callback, options ){\n\t\toptions = _this.checkoptions(options);\n\t\t// loading image, tracing and callback\n\t\t_this.loadImage(\n\t\t\t\turl,\n\t\t\t\tfunction(canvas){\n\t\t\t\t\tcallback(\n\t\t\t\t\t\t_this.imagedataToTracedata( _this.getImgdata(canvas), options )\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\toptions\n\t\t);\n\t},// End of imageToTracedata()\n\t\n\t// Tracing imagedata, then returning tracedata (layers with paths, palette, image size)\n\tthis.imagedataToTracedata = function( imgd, options ){\n\t\toptions = _this.checkoptions(options);\n\t\t\n\t\t// 1. Color quantization\n\t\tvar ii = _this.colorquantization( imgd, options );\n\t\t\n\t\tif(options.layering === 0){// Sequential layering\n\t\t\t\n\t\t\t// create tracedata object\n\t\t\tvar tracedata = {\n\t\t\t\tlayers : [],\n\t\t\t\tpalette : ii.palette,\n\t\t\t\twidth : ii.array[0].length-2,\n\t\t\t\theight : ii.array.length-2\n\t\t\t};\n\t\t\t\n\t\t\t// Loop to trace each color layer\n\t\t\tfor(var colornum=0; colornum<ii.palette.length; colornum++){\n\t\t\t\t\n\t\t\t\t// layeringstep -> pathscan -> internodes -> batchtracepaths\n\t\t\t\tvar tracedlayer =\n\t\t\t\t\t_this.batchtracepaths(\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t_this.internodes(\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t_this.pathscan(\n\t\t\t\t\t\t\t\t_this.layeringstep( ii, colornum ),\n\t\t\t\t\t\t\t\toptions.pathomit\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\toptions\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t),\n\t\t\t\t\t\t\n\t\t\t\t\t\toptions.ltres,\n\t\t\t\t\t\toptions.qtres\n\t\t\t\t\t\t\n\t\t\t\t\t);\n\t\t\t\t\n\t\t\t\t// adding traced layer\n\t\t\t\ttracedata.layers.push(tracedlayer);\n\t\t\t\t\n\t\t\t}// End of color loop\n\t\t\t\n\t\t}else{// Parallel layering\n\t\t\t// 2. Layer separation and edge detection\n\t\t\tvar ls = _this.layering( ii );\n\t\t\t\n\t\t\t// Optional edge node visualization\n\t\t\tif(options.layercontainerid){ _this.drawLayers( ls, _this.specpalette, options.scale, options.layercontainerid ); }\n\t\t\t\n\t\t\t// 3. Batch pathscan\n\t\t\tvar bps = _this.batchpathscan( ls, options.pathomit );\n\t\t\t\n\t\t\t// 4. Batch interpollation\n\t\t\tvar bis = _this.batchinternodes( bps, options );\n\t\t\t\n\t\t\t// 5. Batch tracing and creating tracedata object\n\t\t\tvar tracedata = {\n\t\t\t\tlayers : _this.batchtracelayers( bis, options.ltres, options.qtres ),\n\t\t\t\tpalette : ii.palette,\n\t\t\t\twidth : imgd.width,\n\t\t\t\theight : imgd.height\n\t\t\t};\n\t\t\t\n\t\t}// End of parallel layering\n\t\t\n\t\t// return tracedata\n\t\treturn tracedata;\n\t\t\n\t},// End of imagedataToTracedata()\n\t\n\tthis.optionpresets = {\n\t\t'default': {\n\t\t\t\n\t\t\t// Tracing\n\t\t\tcorsenabled : false,\n\t\t\tltres : 1,\n\t\t\tqtres : 1,\n\t\t\tpathomit : 8,\n\t\t\trightangleenhance : true,\n\t\t\t\n\t\t\t// Color quantization\n\t\t\tcolorsampling : 2,\n\t\t\tnumberofcolors : 16,\n\t\t\tmincolorratio : 0,\n\t\t\tcolorquantcycles : 3,\n\t\t\t\n\t\t\t// Layering method\n\t\t\tlayering : 0,\n\t\t\t\n\t\t\t// SVG rendering\n\t\t\tstrokewidth : 1,\n\t\t\tlinefilter : false,\n\t\t\tscale : 1,\n\t\t\troundcoords : 1,\n\t\t\tviewbox : false,\n\t\t\tdesc : false,\n\t\t\tlcpr : 0,\n\t\t\tqcpr : 0,\n\t\t\t\n\t\t\t// Blur\n\t\t\tblurradius : 0,\n\t\t\tblurdelta : 20\n\t\t\t\n\t\t},\n\t\t'posterized1': { colorsampling:0, numberofcolors:2 },\n\t\t'posterized2': { numberofcolors:4, blurradius:5 },\n\t\t'curvy': { ltres:0.01, linefilter:true, rightangleenhance:false },\n\t\t'sharp': { qtres:0.01, linefilter:false },\n\t\t'detailed': { pathomit:0, roundcoords:2, ltres:0.5, qtres:0.5, numberofcolors:64 },\n\t\t'smoothed': { blurradius:5, blurdelta: 64 },\n\t\t'grayscale': { colorsampling:0, colorquantcycles:1, numberofcolors:7 },\n\t\t'fixedpalette': { colorsampling:0, colorquantcycles:1, numberofcolors:27 },\n\t\t'randomsampling1': { colorsampling:1, numberofcolors:8 },\n\t\t'randomsampling2': { colorsampling:1, numberofcolors:64 },\n\t\t'artistic1': { colorsampling:0, colorquantcycles:1, pathomit:0, blurradius:5, blurdelta: 64, ltres:0.01, linefilter:true, numberofcolors:16, strokewidth:2 },\n\t\t'artistic2': { qtres:0.01, colorsampling:0, colorquantcycles:1, numberofcolors:4, strokewidth:0 },\n\t\t'artistic3': { qtres:10, ltres:10, numberofcolors:8 },\n\t\t'artistic4': { qtres:10, ltres:10, numberofcolors:64, blurradius:5, blurdelta: 256, strokewidth:2 },\n\t\t'posterized3': { ltres: 1, qtres: 1, pathomit: 20, rightangleenhance: true, colorsampling: 0, numberofcolors: 3,\n\t\t\tmincolorratio: 0, colorquantcycles: 3, blurradius: 3, blurdelta: 20, strokewidth: 0, linefilter: false,\n\t\t\troundcoords: 1, pal: [ { r: 0, g: 0, b: 100, a: 255 }, { r: 255, g: 255, b: 255, a: 255 } ] }\n\t},// End of optionpresets\n\t\n\t// creating options object, setting defaults for missing values\n\tthis.checkoptions = function(options){\n\t\toptions = options || {};\n\t\t// Option preset\n\t\tif(typeof options === 'string'){\n\t\t\toptions = options.toLowerCase();\n\t\t\tif( _this.optionpresets[options] ){ options = _this.optionpresets[options]; }else{ options = {}; }\n\t\t}\n\t\t// Defaults\n\t\tvar ok = Object.keys(_this.optionpresets['default']);\n\t\tfor(var k=0; k<ok.length; k++){\n\t\t\tif(!options.hasOwnProperty(ok[k])){ options[ok[k]] = _this.optionpresets['default'][ok[k]]; }\n\t\t}\n\t\t// options.pal is not defined here, the custom palette should be added externally: options.pal = [ { 'r':0, 'g':0, 'b':0, 'a':255 }, {...}, ... ];\n\t\t// options.layercontainerid is not defined here, can be added externally: options.layercontainerid = 'mydiv'; ... <div id=\"mydiv\"></div>\n\t\treturn options;\n\t},// End of checkoptions()\n\t\n\t////////////////////////////////////////////////////////////\n\t//\n\t//  Vectorizing functions\n\t//\n\t////////////////////////////////////////////////////////////\n\t\n\t// 1. Color quantization\n\t// Using a form of k-means clustering repeatead options.colorquantcycles times. http://en.wikipedia.org/wiki/Color_quantization\n\tthis.colorquantization = function( imgd, options ){\n\t\tvar arr = [], idx=0, cd,cdl,ci, paletteacc = [], pixelnum = imgd.width * imgd.height, i, j, k, cnt, palette;\n\t\t\n\t\t// imgd.data must be RGBA, not just RGB\n\t\tif( imgd.data.length < pixelnum * 4 ){\n\t\t\tvar newimgddata = new Uint8ClampedArray(pixelnum * 4);\n\t\t\tfor(var pxcnt = 0; pxcnt < pixelnum ; pxcnt++){\n\t\t\t\tnewimgddata[pxcnt*4  ] = imgd.data[pxcnt*3  ];\n\t\t\t\tnewimgddata[pxcnt*4+1] = imgd.data[pxcnt*3+1];\n\t\t\t\tnewimgddata[pxcnt*4+2] = imgd.data[pxcnt*3+2];\n\t\t\t\tnewimgddata[pxcnt*4+3] = 255;\n\t\t\t}\n\t\t\timgd.data = newimgddata;\n\t\t}// End of RGBA imgd.data check\n\t\t\n\t\t// Filling arr (color index array) with -1\n\t\tfor( j=0; j<imgd.height+2; j++ ){ arr[j]=[]; for(i=0; i<imgd.width+2 ; i++){ arr[j][i] = -1; } }\n\t\t\n\t\t// Use custom palette if pal is defined or sample / generate custom length palette\n\t\tif(options.pal){\n\t\t\tpalette = options.pal;\n\t\t}else if(options.colorsampling === 0){\n\t\t\tpalette = _this.generatepalette(options.numberofcolors);\n\t\t}else if(options.colorsampling === 1){\n\t\t\tpalette = _this.samplepalette( options.numberofcolors, imgd );\n\t\t}else{\n\t\t\tpalette = _this.samplepalette2( options.numberofcolors, imgd );\n\t\t}\n\t\t\n\t\t// Selective Gaussian blur preprocessing\n\t\tif( options.blurradius > 0 ){ imgd = _this.blur( imgd, options.blurradius, options.blurdelta ); }\n\t\t\n\t\t// Repeat clustering step options.colorquantcycles times\n\t\tfor( cnt=0; cnt < options.colorquantcycles; cnt++ ){\n\t\t\t\n\t\t\t// Average colors from the second iteration\n\t\t\tif(cnt>0){\n\t\t\t\t// averaging paletteacc for palette\n\t\t\t\tfor( k=0; k < palette.length; k++ ){\n\t\t\t\t\t\n\t\t\t\t\t// averaging\n\t\t\t\t\tif( paletteacc[k].n > 0 ){\n\t\t\t\t\t\tpalette[k] = {  r: Math.floor( paletteacc[k].r / paletteacc[k].n ),\n\t\t\t\t\t\t\t\t\t\tg: Math.floor( paletteacc[k].g / paletteacc[k].n ),\n\t\t\t\t\t\t\t\t\t\tb: Math.floor( paletteacc[k].b / paletteacc[k].n ),\n\t\t\t\t\t\t\t\t\t\ta:  Math.floor( paletteacc[k].a / paletteacc[k].n ) };\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// Randomizing a color, if there are too few pixels and there will be a new cycle\n\t\t\t\t\tif( ( paletteacc[k].n/pixelnum < options.mincolorratio ) && ( cnt < options.colorquantcycles-1 ) ){\n\t\t\t\t\t\tpalette[k] = {  r: Math.floor(Math.random()*255),\n\t\t\t\t\t\t\t\t\t\tg: Math.floor(Math.random()*255),\n\t\t\t\t\t\t\t\t\t\tb: Math.floor(Math.random()*255),\n\t\t\t\t\t\t\t\t\t\ta: Math.floor(Math.random()*255) };\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}// End of palette loop\n\t\t\t}// End of Average colors from the second iteration\n\t\t\t\n\t\t\t// Reseting palette accumulator for averaging\n\t\t\tfor( i=0; i < palette.length; i++ ){ paletteacc[i] = { r:0, g:0, b:0, a:0, n:0 }; }\n\t\t\t\n\t\t\t// loop through all pixels\n\t\t\tfor( j=0; j < imgd.height; j++ ){\n\t\t\t\tfor( i=0; i < imgd.width; i++ ){\n\t\t\t\t\t\n\t\t\t\t\t// pixel index\n\t\t\t\t\tidx = (j*imgd.width+i)*4;\n\t\t\t\t\t\n\t\t\t\t\t// find closest color from palette by measuring (rectilinear) color distance between this pixel and all palette colors\n\t\t\t\t\tci=0; cdl = 1024; // 4 * 256 is the maximum RGBA distance\n\t\t\t\t\tfor( k=0; k<palette.length; k++ ){\n\t\t\t\t\t\t\n\t\t\t\t\t\t// In my experience, https://en.wikipedia.org/wiki/Rectilinear_distance works better than https://en.wikipedia.org/wiki/Euclidean_distance\n\t\t\t\t\t\tcd = Math.abs(palette[k].r-imgd.data[idx]) + Math.abs(palette[k].g-imgd.data[idx+1]) + Math.abs(palette[k].b-imgd.data[idx+2]) + Math.abs(palette[k].a-imgd.data[idx+3]);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Remember this color if this is the closest yet\n\t\t\t\t\t\tif(cd<cdl){ cdl = cd; ci = k; }\n\t\t\t\t\t\t\n\t\t\t\t\t}// End of palette loop\n\t\t\t\t\t\n\t\t\t\t\t// add to palettacc\n\t\t\t\t\tpaletteacc[ci].r += imgd.data[idx  ];\n\t\t\t\t\tpaletteacc[ci].g += imgd.data[idx+1];\n\t\t\t\t\tpaletteacc[ci].b += imgd.data[idx+2];\n\t\t\t\t\tpaletteacc[ci].a += imgd.data[idx+3];\n\t\t\t\t\tpaletteacc[ci].n++;\n\t\t\t\t\t\n\t\t\t\t\t// update the indexed color array\n\t\t\t\t\tarr[j+1][i+1] = ci;\n\t\t\t\t\t\n\t\t\t\t}// End of i loop\n\t\t\t}// End of j loop\n\t\t\t\n\t\t}// End of Repeat clustering step options.colorquantcycles times\n\t\t\n\t\treturn { array:arr, palette:palette };\n\t\t\n\t},// End of colorquantization()\n\t\n\t// Sampling a palette from imagedata\n\tthis.samplepalette = function( numberofcolors, imgd ){\n\t\tvar idx, palette=[];\n\t\tfor(var i=0; i<numberofcolors; i++){\n\t\t\tidx = Math.floor( Math.random() * imgd.data.length / 4 ) * 4;\n\t\t\tpalette.push({ r:imgd.data[idx  ], g:imgd.data[idx+1], b:imgd.data[idx+2], a:imgd.data[idx+3] });\n\t\t}\n\t\treturn palette;\n\t},// End of samplepalette()\n\t\n\t// Deterministic sampling a palette from imagedata: rectangular grid\n\tthis.samplepalette2 = function( numberofcolors, imgd ){\n\t\tvar idx, palette=[], ni = Math.ceil(Math.sqrt(numberofcolors)), nj = Math.ceil(numberofcolors/ni),\n\t\t\tvx = imgd.width / (ni+1), vy = imgd.height / (nj+1);\n\t\tfor(var j=0; j<nj; j++){\n\t\t\tfor(var i=0; i<ni; i++){\n\t\t\t\tif(palette.length === numberofcolors){\n\t\t\t\t\tbreak;\n\t\t\t\t}else{\n\t\t\t\t\tidx = Math.floor( ((j+1)*vy) * imgd.width + ((i+1)*vx) ) * 4;\n\t\t\t\t\tpalette.push( { r:imgd.data[idx], g:imgd.data[idx+1], b:imgd.data[idx+2], a:imgd.data[idx+3] } );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn palette;\n\t},// End of samplepalette2()\n\t\n\t// Generating a palette with numberofcolors\n\tthis.generatepalette = function(numberofcolors){\n\t\tvar palette = [], rcnt, gcnt, bcnt;\n\t\tif(numberofcolors<8){\n\t\t\t\n\t\t\t// Grayscale\n\t\t\tvar graystep = Math.floor(255/(numberofcolors-1));\n\t\t\tfor(var i=0; i<numberofcolors; i++){ palette.push({ r:i*graystep, g:i*graystep, b:i*graystep, a:255 }); }\n\t\t\t\n\t\t}else{\n\t\t\t\n\t\t\t// RGB color cube\n\t\t\tvar colorqnum = Math.floor(Math.pow(numberofcolors, 1/3)), // Number of points on each edge on the RGB color cube\n\t\t\t\tcolorstep = Math.floor(255/(colorqnum-1)), // distance between points\n\t\t\t\trndnum = numberofcolors - colorqnum*colorqnum*colorqnum; // number of random colors\n\t\t\t\n\t\t\tfor(rcnt=0; rcnt<colorqnum; rcnt++){\n\t\t\t\tfor(gcnt=0; gcnt<colorqnum; gcnt++){\n\t\t\t\t\tfor(bcnt=0; bcnt<colorqnum; bcnt++){\n\t\t\t\t\t\tpalette.push( { r:rcnt*colorstep, g:gcnt*colorstep, b:bcnt*colorstep, a:255 } );\n\t\t\t\t\t}// End of blue loop\n\t\t\t\t}// End of green loop\n\t\t\t}// End of red loop\n\t\t\t\n\t\t\t// Rest is random\n\t\t\tfor(rcnt=0; rcnt<rndnum; rcnt++){ palette.push({ r:Math.floor(Math.random()*255), g:Math.floor(Math.random()*255), b:Math.floor(Math.random()*255), a:Math.floor(Math.random()*255) }); }\n\n\t\t}// End of numberofcolors check\n\t\t\n\t\treturn palette;\n\t},// End of generatepalette()\n\t\t\n\t// 2. Layer separation and edge detection\n\t// Edge node types ( ▓: this layer or 1; ░: not this layer or 0 )\n\t// 12  ░░  ▓░  ░▓  ▓▓  ░░  ▓░  ░▓  ▓▓  ░░  ▓░  ░▓  ▓▓  ░░  ▓░  ░▓  ▓▓\n\t// 48  ░░  ░░  ░░  ░░  ░▓  ░▓  ░▓  ░▓  ▓░  ▓░  ▓░  ▓░  ▓▓  ▓▓  ▓▓  ▓▓\n\t//     0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15\n\tthis.layering = function(ii){\n\t\t// Creating layers for each indexed color in arr\n\t\tvar layers = [], val=0, ah = ii.array.length, aw = ii.array[0].length, n1,n2,n3,n4,n5,n6,n7,n8, i, j, k;\n\t\t\n\t\t// Create layers\n\t\tfor(k=0; k<ii.palette.length; k++){\n\t\t\tlayers[k] = [];\n\t\t\tfor(j=0; j<ah; j++){\n\t\t\t\tlayers[k][j] = [];\n\t\t\t\tfor(i=0; i<aw; i++){\n\t\t\t\t\tlayers[k][j][i]=0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Looping through all pixels and calculating edge node type\n\t\tfor(j=1; j<ah-1; j++){\n\t\t\tfor(i=1; i<aw-1; i++){\n\t\t\t\t\n\t\t\t\t// This pixel's indexed color\n\t\t\t\tval = ii.array[j][i];\n\t\t\t\t\n\t\t\t\t// Are neighbor pixel colors the same?\n\t\t\t\tn1 = ii.array[j-1][i-1]===val ? 1 : 0;\n\t\t\t\tn2 = ii.array[j-1][i  ]===val ? 1 : 0;\n\t\t\t\tn3 = ii.array[j-1][i+1]===val ? 1 : 0;\n\t\t\t\tn4 = ii.array[j  ][i-1]===val ? 1 : 0;\n\t\t\t\tn5 = ii.array[j  ][i+1]===val ? 1 : 0;\n\t\t\t\tn6 = ii.array[j+1][i-1]===val ? 1 : 0;\n\t\t\t\tn7 = ii.array[j+1][i  ]===val ? 1 : 0;\n\t\t\t\tn8 = ii.array[j+1][i+1]===val ? 1 : 0;\n\t\t\t\t\n\t\t\t\t// this pixel's type and looking back on previous pixels\n\t\t\t\tlayers[val][j+1][i+1] = 1 + n5 * 2 + n8 * 4 + n7 * 8 ;\n\t\t\t\tif(!n4){ layers[val][j+1][i  ] = 0 + 2 + n7 * 4 + n6 * 8 ; }\n\t\t\t\tif(!n2){ layers[val][j  ][i+1] = 0 + n3*2 + n5 * 4 + 8 ; }\n\t\t\t\tif(!n1){ layers[val][j  ][i  ] = 0 + n2*2 + 4 + n4 * 8 ; }\n\t\t\t\t\n\t\t\t}// End of i loop\n\t\t}// End of j loop\n\t\t\n\t\treturn layers;\n\t},// End of layering()\n\t\n\t// 2. Layer separation and edge detection\n\t// Edge node types ( ▓: this layer or 1; ░: not this layer or 0 )\n\t// 12  ░░  ▓░  ░▓  ▓▓  ░░  ▓░  ░▓  ▓▓  ░░  ▓░  ░▓  ▓▓  ░░  ▓░  ░▓  ▓▓\n\t// 48  ░░  ░░  ░░  ░░  ░▓  ░▓  ░▓  ░▓  ▓░  ▓░  ▓░  ▓░  ▓▓  ▓▓  ▓▓  ▓▓\n\t//     0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15\n\tthis.layeringstep = function(ii,cnum){\n\t\t// Creating layers for each indexed color in arr\n\t\tvar layer = [], val=0, ah = ii.array.length, aw = ii.array[0].length, n1,n2,n3,n4,n5,n6,n7,n8, i, j, k;\n\t\t\n\t\t// Create layer\n\t\tfor(j=0; j<ah; j++){\n\t\t\tlayer[j] = [];\n\t\t\tfor(i=0; i<aw; i++){\n\t\t\t\tlayer[j][i]=0;\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Looping through all pixels and calculating edge node type\n\t\tfor(j=1; j<ah; j++){\n\t\t\tfor(i=1; i<aw; i++){\n\t\t\t\tlayer[j][i] =\n\t\t\t\t\t( ii.array[j-1][i-1]===cnum ? 1 : 0 ) +\n\t\t\t\t\t( ii.array[j-1][i]===cnum ? 2 : 0 ) +\n\t\t\t\t\t( ii.array[j][i-1]===cnum ? 8 : 0 ) +\n\t\t\t\t\t( ii.array[j][i]===cnum ? 4 : 0 )\n\t\t\t\t;\n\t\t\t}// End of i loop\n\t\t}// End of j loop\n\t\t\t\n\t\treturn layer;\n\t},// End of layeringstep()\n\t\n\t// Point in polygon test\n\tthis.pointinpoly = function( p, pa ){\n\t\tvar isin=false;\n\n\t\tfor(var i=0,j=pa.length-1; i<pa.length; j=i++){\n\t\t\tisin =\n\t\t\t\t( ((pa[i].y > p.y) !== (pa[j].y > p.y)) && (p.x < (pa[j].x - pa[i].x) * (p.y - pa[i].y) / (pa[j].y - pa[i].y) + pa[i].x) )\n\t\t\t\t? !isin : isin;\n\t\t}\n\n\t\treturn isin;\n\t},\n\t\n\t// Lookup tables for pathscan\n\t// pathscan_combined_lookup[ arr[py][px] ][ dir ] = [nextarrpypx, nextdir, deltapx, deltapy];\n\tthis.pathscan_combined_lookup = [\n\t\t[[-1,-1,-1,-1], [-1,-1,-1,-1], [-1,-1,-1,-1], [-1,-1,-1,-1]],// arr[py][px]===0 is invalid\n\t\t[[ 0, 1, 0,-1], [-1,-1,-1,-1], [-1,-1,-1,-1], [ 0, 2,-1, 0]],\n\t\t[[-1,-1,-1,-1], [-1,-1,-1,-1], [ 0, 1, 0,-1], [ 0, 0, 1, 0]],\n\t\t[[ 0, 0, 1, 0], [-1,-1,-1,-1], [ 0, 2,-1, 0], [-1,-1,-1,-1]],\n\t\t\n\t\t[[-1,-1,-1,-1], [ 0, 0, 1, 0], [ 0, 3, 0, 1], [-1,-1,-1,-1]],\n\t\t[[13, 3, 0, 1], [13, 2,-1, 0], [ 7, 1, 0,-1], [ 7, 0, 1, 0]],\n\t\t[[-1,-1,-1,-1], [ 0, 1, 0,-1], [-1,-1,-1,-1], [ 0, 3, 0, 1]],\n\t\t[[ 0, 3, 0, 1], [ 0, 2,-1, 0], [-1,-1,-1,-1], [-1,-1,-1,-1]],\n\t\t\n\t\t[[ 0, 3, 0, 1], [ 0, 2,-1, 0], [-1,-1,-1,-1], [-1,-1,-1,-1]],\n\t\t[[-1,-1,-1,-1], [ 0, 1, 0,-1], [-1,-1,-1,-1], [ 0, 3, 0, 1]],\n\t\t[[11, 1, 0,-1], [14, 0, 1, 0], [14, 3, 0, 1], [11, 2,-1, 0]],\n\t\t[[-1,-1,-1,-1], [ 0, 0, 1, 0], [ 0, 3, 0, 1], [-1,-1,-1,-1]],\n\t\t\n\t\t[[ 0, 0, 1, 0], [-1,-1,-1,-1], [ 0, 2,-1, 0], [-1,-1,-1,-1]],\n\t\t[[-1,-1,-1,-1], [-1,-1,-1,-1], [ 0, 1, 0,-1], [ 0, 0, 1, 0]],\n\t\t[[ 0, 1, 0,-1], [-1,-1,-1,-1], [-1,-1,-1,-1], [ 0, 2,-1, 0]],\n\t\t[[-1,-1,-1,-1], [-1,-1,-1,-1], [-1,-1,-1,-1], [-1,-1,-1,-1]]// arr[py][px]===15 is invalid\n\t],\n\n\t// 3. Walking through an edge node array, discarding edge node types 0 and 15 and creating paths from the rest.\n\t// Walk directions (dir): 0 > ; 1 ^ ; 2 < ; 3 v \n\tthis.pathscan = function( arr, pathomit ){\n\t\tvar paths=[], pacnt=0, pcnt=0, px=0, py=0, w = arr[0].length, h = arr.length,\n\t\t\tdir=0, pathfinished=true, holepath=false, lookuprow;\n\t\t\n\t\tfor(var j=0; j<h; j++){\n\t\t\tfor(var i=0; i<w; i++){\n\t\t\t\tif( (arr[j][i] == 4) || ( arr[j][i] == 11) ){ // Other values are not valid\n\t\t\t\t\t\n\t\t\t\t\t// Init\n\t\t\t\t\tpx = i; py = j;\n\t\t\t\t\tpaths[pacnt] = {};\n\t\t\t\t\tpaths[pacnt].points = [];\n\t\t\t\t\tpaths[pacnt].boundingbox = [px,py,px,py];\n\t\t\t\t\tpaths[pacnt].holechildren = [];\n\t\t\t\t\tpathfinished = false;\n\t\t\t\t\tpcnt=0;\n\t\t\t\t\tholepath = (arr[j][i]==11);\n\t\t\t\t\tdir = 1;\n\n\t\t\t\t\t// Path points loop\n\t\t\t\t\twhile(!pathfinished){\n\t\t\t\t\t\t\n\t\t\t\t\t\t// New path point\n\t\t\t\t\t\tpaths[pacnt].points[pcnt] = {};\n\t\t\t\t\t\tpaths[pacnt].points[pcnt].x = px-1;\n\t\t\t\t\t\tpaths[pacnt].points[pcnt].y = py-1;\n\t\t\t\t\t\tpaths[pacnt].points[pcnt].t = arr[py][px];\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Bounding box\n\t\t\t\t\t\tif( (px-1) < paths[pacnt].boundingbox[0] ){ paths[pacnt].boundingbox[0] = px-1; }\n\t\t\t\t\t\tif( (px-1) > paths[pacnt].boundingbox[2] ){ paths[pacnt].boundingbox[2] = px-1; }\n\t\t\t\t\t\tif( (py-1) < paths[pacnt].boundingbox[1] ){ paths[pacnt].boundingbox[1] = py-1; }\n\t\t\t\t\t\tif( (py-1) > paths[pacnt].boundingbox[3] ){ paths[pacnt].boundingbox[3] = py-1; }\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Next: look up the replacement, direction and coordinate changes = clear this cell, turn if required, walk forward\n\t\t\t\t\t\tlookuprow = _this.pathscan_combined_lookup[ arr[py][px] ][ dir ];\n\t\t\t\t\t\tarr[py][px] = lookuprow[0]; dir = lookuprow[1]; px += lookuprow[2]; py += lookuprow[3];\n\n\t\t\t\t\t\t// Close path\n\t\t\t\t\t\tif( (px-1 === paths[pacnt].points[0].x ) && ( py-1 === paths[pacnt].points[0].y ) ){\n\t\t\t\t\t\t\tpathfinished = true;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// Discarding paths shorter than pathomit\n\t\t\t\t\t\t\tif( paths[pacnt].points.length < pathomit ){\n\t\t\t\t\t\t\t\tpaths.pop();\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tpaths[pacnt].isholepath = holepath ? true : false;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// Finding the parent shape for this hole\n\t\t\t\t\t\t\t\tif(holepath){\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tvar parentidx = 0, parentbbox = [-1,-1,w+1,h+1];\n\t\t\t\t\t\t\t\t\tfor(var parentcnt=0; parentcnt < pacnt; parentcnt++){\n\t\t\t\t\t\t\t\t\t\tif( (!paths[parentcnt].isholepath) &&\n\t\t\t\t\t\t\t\t\t\t\t_this.boundingboxincludes( paths[parentcnt].boundingbox , paths[pacnt].boundingbox ) &&\n\t\t\t\t\t\t\t\t\t\t\t_this.boundingboxincludes( parentbbox , paths[parentcnt].boundingbox ) &&\n\t\t\t\t\t\t\t\t\t\t\t_this.pointinpoly( paths[pacnt].points[0], paths[parentcnt].points )\n\t\t\t\t\t\t\t\t\t\t){\n\t\t\t\t\t\t\t\t\t\t\tparentidx = parentcnt;\n\t\t\t\t\t\t\t\t\t\t\tparentbbox = paths[parentcnt].boundingbox;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tpaths[parentidx].holechildren.push( pacnt );\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t}// End of holepath parent finding\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tpacnt++;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}// End of Close path\n\t\t\t\t\t\t\n\t\t\t\t\t\tpcnt++;\n\t\t\t\t\t\t\n\t\t\t\t\t}// End of Path points loop\n\t\t\t\t\t\n\t\t\t\t}// End of Follow path\n\t\t\t\t\n\t\t\t}// End of i loop\n\t\t}// End of j loop\n\t\t\n\t\treturn paths;\n\t},// End of pathscan()\n\t\n\tthis.boundingboxincludes = function( parentbbox, childbbox ){\n\t\treturn ( ( parentbbox[0] < childbbox[0] ) && ( parentbbox[1] < childbbox[1] ) && ( parentbbox[2] > childbbox[2] ) && ( parentbbox[3] > childbbox[3] ) );\n\t},// End of boundingboxincludes()\n\t\n\t// 3. Batch pathscan\n\tthis.batchpathscan = function( layers, pathomit ){\n\t\tvar bpaths = [];\n\t\tfor(var k in layers){\n\t\t\tif(!layers.hasOwnProperty(k)){ continue; }\n\t\t\tbpaths[k] = _this.pathscan( layers[k], pathomit );\n\t\t}\n\t\treturn bpaths;\n\t},\n\t\n\t// 4. interpollating between path points for nodes with 8 directions ( East, SouthEast, S, SW, W, NW, N, NE )\n\tthis.internodes = function( paths, options ){\n\t\tvar ins = [], palen=0, nextidx=0, nextidx2=0, previdx=0, previdx2=0, pacnt, pcnt;\n\t\t\n\t\t// paths loop\n\t\tfor(pacnt=0; pacnt<paths.length; pacnt++){\n\t\t\t\n\t\t\tins[pacnt] = {};\n\t\t\tins[pacnt].points = [];\n\t\t\tins[pacnt].boundingbox = paths[pacnt].boundingbox;\n\t\t\tins[pacnt].holechildren = paths[pacnt].holechildren;\n\t\t\tins[pacnt].isholepath = paths[pacnt].isholepath;\n\t\t\tpalen = paths[pacnt].points.length;\n\t\t\t\n\t\t\t// pathpoints loop\n\t\t\tfor(pcnt=0; pcnt<palen; pcnt++){\n\t\t\t\n\t\t\t\t// next and previous point indexes\n\t\t\t\tnextidx = (pcnt+1)%palen; nextidx2 = (pcnt+2)%palen; previdx = (pcnt-1+palen)%palen; previdx2 = (pcnt-2+palen)%palen;\n\t\t\t\t\n\t\t\t\t// right angle enhance\n\t\t\t\tif( options.rightangleenhance && _this.testrightangle( paths[pacnt], previdx2, previdx, pcnt, nextidx, nextidx2 ) ){\n\t\t\t\t\t\n\t\t\t\t\t// Fix previous direction\n\t\t\t\t\tif(ins[pacnt].points.length > 0){\n\t\t\t\t\t\tins[pacnt].points[ ins[pacnt].points.length-1 ].linesegment = _this.getdirection(\n\t\t\t\t\t\t\t\tins[pacnt].points[ ins[pacnt].points.length-1 ].x,\n\t\t\t\t\t\t\t\tins[pacnt].points[ ins[pacnt].points.length-1 ].y,\n\t\t\t\t\t\t\t\tpaths[pacnt].points[pcnt].x,\n\t\t\t\t\t\t\t\tpaths[pacnt].points[pcnt].y\n\t\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// This corner point\n\t\t\t\t\tins[pacnt].points.push({\n\t\t\t\t\t\tx : paths[pacnt].points[pcnt].x,\n\t\t\t\t\t\ty : paths[pacnt].points[pcnt].y,\n\t\t\t\t\t\tlinesegment : _this.getdirection(\n\t\t\t\t\t\t\t\tpaths[pacnt].points[pcnt].x,\n\t\t\t\t\t\t\t\tpaths[pacnt].points[pcnt].y,\n\t\t\t\t\t\t\t\t(( paths[pacnt].points[pcnt].x + paths[pacnt].points[nextidx].x ) /2),\n\t\t\t\t\t\t\t\t(( paths[pacnt].points[pcnt].y + paths[pacnt].points[nextidx].y ) /2)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t}// End of right angle enhance\n\t\t\t\t\n\t\t\t\t// interpolate between two path points\n\t\t\t\tins[pacnt].points.push({\n\t\t\t\t\tx : (( paths[pacnt].points[pcnt].x + paths[pacnt].points[nextidx].x ) /2),\n\t\t\t\t\ty : (( paths[pacnt].points[pcnt].y + paths[pacnt].points[nextidx].y ) /2),\n\t\t\t\t\tlinesegment : _this.getdirection(\n\t\t\t\t\t\t\t(( paths[pacnt].points[pcnt].x + paths[pacnt].points[nextidx].x ) /2),\n\t\t\t\t\t\t\t(( paths[pacnt].points[pcnt].y + paths[pacnt].points[nextidx].y ) /2),\n\t\t\t\t\t\t\t(( paths[pacnt].points[nextidx].x + paths[pacnt].points[nextidx2].x ) /2),\n\t\t\t\t\t\t\t(( paths[pacnt].points[nextidx].y + paths[pacnt].points[nextidx2].y ) /2)\n\t\t\t\t\t\t)\n\t\t\t\t});\n\t\t\t\t\n\t\t\t}// End of pathpoints loop\n\t\t\t\t\t\t\n\t\t}// End of paths loop\n\t\t\n\t\treturn ins;\n\t},// End of internodes()\n\t\n\tthis.testrightangle = function( path, idx1, idx2, idx3, idx4, idx5 ){\n\t\treturn ( (( path.points[idx3].x === path.points[idx1].x) &&\n\t\t\t\t  ( path.points[idx3].x === path.points[idx2].x) &&\n\t\t\t\t  ( path.points[idx3].y === path.points[idx4].y) &&\n\t\t\t\t  ( path.points[idx3].y === path.points[idx5].y)\n\t\t\t\t ) ||\n\t\t\t\t (( path.points[idx3].y === path.points[idx1].y) &&\n\t\t\t\t  ( path.points[idx3].y === path.points[idx2].y) &&\n\t\t\t\t  ( path.points[idx3].x === path.points[idx4].x) &&\n\t\t\t\t  ( path.points[idx3].x === path.points[idx5].x)\n\t\t\t\t )\n\t\t);\n\t},// End of testrightangle()\n\t\n\tthis.getdirection = function( x1, y1, x2, y2 ){\n\t\tvar val = 8;\n\t\tif(x1 < x2){\n\t\t\tif     (y1 < y2){ val = 1; }// SouthEast\n\t\t\telse if(y1 > y2){ val = 7; }// NE\n\t\t\telse            { val = 0; }// E\n\t\t}else if(x1 > x2){\n\t\t\tif     (y1 < y2){ val = 3; }// SW\n\t\t\telse if(y1 > y2){ val = 5; }// NW\n\t\t\telse            { val = 4; }// W\n\t\t}else{\n\t\t\tif     (y1 < y2){ val = 2; }// S\n\t\t\telse if(y1 > y2){ val = 6; }// N\n\t\t\telse            { val = 8; }// center, this should not happen\n\t\t}\n\t\treturn val;\n\t},// End of getdirection()\n\t\n\t// 4. Batch interpollation\n\tthis.batchinternodes = function( bpaths, options ){\n\t\tvar binternodes = [];\n\t\tfor (var k in bpaths) {\n\t\t\tif(!bpaths.hasOwnProperty(k)){ continue; }\n\t\t\tbinternodes[k] = _this.internodes(bpaths[k], options);\n\t\t}\n\t\treturn binternodes;\n\t},\n\t\n\t// 5. tracepath() : recursively trying to fit straight and quadratic spline segments on the 8 direction internode path\n\t\n\t// 5.1. Find sequences of points with only 2 segment types\n\t// 5.2. Fit a straight line on the sequence\n\t// 5.3. If the straight line fails (distance error > ltres), find the point with the biggest error\n\t// 5.4. Fit a quadratic spline through errorpoint (project this to get controlpoint), then measure errors on every point in the sequence\n\t// 5.5. If the spline fails (distance error > qtres), find the point with the biggest error, set splitpoint = fitting point\n\t// 5.6. Split sequence and recursively apply 5.2. - 5.6. to startpoint-splitpoint and splitpoint-endpoint sequences\n\t\n\tthis.tracepath = function( path, ltres, qtres ){\n\t\tvar pcnt=0, segtype1, segtype2, seqend, smp = {};\n\t\tsmp.segments = [];\n\t\tsmp.boundingbox = path.boundingbox;\n\t\tsmp.holechildren = path.holechildren;\n\t\tsmp.isholepath = path.isholepath;\n\t\t\n\t\twhile(pcnt < path.points.length){\n\t\t\t// 5.1. Find sequences of points with only 2 segment types\n\t\t\tsegtype1 = path.points[pcnt].linesegment; segtype2 = -1; seqend=pcnt+1;\n\t\t\twhile(\n\t\t\t\t((path.points[seqend].linesegment === segtype1) || (path.points[seqend].linesegment === segtype2) || (segtype2 === -1))\n\t\t\t\t&& (seqend < path.points.length-1) ){\n\t\t\t\t\n\t\t\t\tif((path.points[seqend].linesegment!==segtype1) && (segtype2===-1)){ segtype2 = path.points[seqend].linesegment; }\n\t\t\t\tseqend++;\n\t\t\t\t\n\t\t\t}\n\t\t\tif(seqend === path.points.length-1){ seqend = 0; }\n\n\t\t\t// 5.2. - 5.6. Split sequence and recursively apply 5.2. - 5.6. to startpoint-splitpoint and splitpoint-endpoint sequences\n\t\t\tsmp.segments = smp.segments.concat( _this.fitseq(path, ltres, qtres, pcnt, seqend) );\n\t\t\t\n\t\t\t// forward pcnt;\n\t\t\tif(seqend>0){ pcnt = seqend; }else{ pcnt = path.points.length; }\n\t\t\t\n\t\t}// End of pcnt loop\n\t\t\n\t\treturn smp;\n\t},// End of tracepath()\n\t\t\n\t// 5.2. - 5.6. recursively fitting a straight or quadratic line segment on this sequence of path nodes,\n\t// called from tracepath()\n\tthis.fitseq = function( path, ltres, qtres, seqstart, seqend ){\n\t\t// return if invalid seqend\n\t\tif( (seqend>path.points.length) || (seqend<0) ){ return []; }\n\t\t// variables\n\t\tvar errorpoint=seqstart, errorval=0, curvepass=true, px, py, dist2;\n\t\tvar tl = (seqend-seqstart); if(tl<0){ tl += path.points.length; }\n\t\tvar vx = (path.points[seqend].x-path.points[seqstart].x) / tl,\n\t\t\tvy = (path.points[seqend].y-path.points[seqstart].y) / tl;\n\t\t\n\t\t// 5.2. Fit a straight line on the sequence\n\t\tvar pcnt = (seqstart+1) % path.points.length, pl;\n\t\twhile(pcnt != seqend){\n\t\t\tpl = pcnt-seqstart; if(pl<0){ pl += path.points.length; }\n\t\t\tpx = path.points[seqstart].x + vx * pl; py = path.points[seqstart].y + vy * pl;\n\t\t\tdist2 = (path.points[pcnt].x-px)*(path.points[pcnt].x-px) + (path.points[pcnt].y-py)*(path.points[pcnt].y-py);\n\t\t\tif(dist2>ltres){curvepass=false;}\n\t\t\tif(dist2>errorval){ errorpoint=pcnt; errorval=dist2; }\n\t\t\tpcnt = (pcnt+1)%path.points.length;\n\t\t}\n\t\t// return straight line if fits\n\t\tif(curvepass){ return [{ type:'L', x1:path.points[seqstart].x, y1:path.points[seqstart].y, x2:path.points[seqend].x, y2:path.points[seqend].y }]; }\n\t\t\n\t\t// 5.3. If the straight line fails (distance error>ltres), find the point with the biggest error\n\t\tvar fitpoint = errorpoint; curvepass = true; errorval = 0;\n\t\t\n\t\t// 5.4. Fit a quadratic spline through this point, measure errors on every point in the sequence\n\t\t// helpers and projecting to get control point\n\t\tvar t=(fitpoint-seqstart)/tl, t1=(1-t)*(1-t), t2=2*(1-t)*t, t3=t*t;\n\t\tvar cpx = (t1*path.points[seqstart].x + t3*path.points[seqend].x - path.points[fitpoint].x)/-t2 ,\n\t\t\tcpy = (t1*path.points[seqstart].y + t3*path.points[seqend].y - path.points[fitpoint].y)/-t2 ;\n\t\t\n\t\t// Check every point\n\t\tpcnt = seqstart+1;\n\t\twhile(pcnt != seqend){\n\t\t\tt=(pcnt-seqstart)/tl; t1=(1-t)*(1-t); t2=2*(1-t)*t; t3=t*t;\n\t\t\tpx = t1 * path.points[seqstart].x + t2 * cpx + t3 * path.points[seqend].x;\n\t\t\tpy = t1 * path.points[seqstart].y + t2 * cpy + t3 * path.points[seqend].y;\n\t\t\t\n\t\t\tdist2 = (path.points[pcnt].x-px)*(path.points[pcnt].x-px) + (path.points[pcnt].y-py)*(path.points[pcnt].y-py);\n\t\t\t\n\t\t\tif(dist2>qtres){curvepass=false;}\n\t\t\tif(dist2>errorval){ errorpoint=pcnt; errorval=dist2; }\n\t\t\tpcnt = (pcnt+1)%path.points.length;\n\t\t}\n\t\t// return spline if fits\n\t\tif(curvepass){ return [{ type:'Q', x1:path.points[seqstart].x, y1:path.points[seqstart].y, x2:cpx, y2:cpy, x3:path.points[seqend].x, y3:path.points[seqend].y }]; }\n\t\t// 5.5. If the spline fails (distance error>qtres), find the point with the biggest error\n\t\tvar splitpoint = fitpoint; // Earlier: Math.floor((fitpoint + errorpoint)/2);\n\t\t\n\t\t// 5.6. Split sequence and recursively apply 5.2. - 5.6. to startpoint-splitpoint and splitpoint-endpoint sequences\n\t\treturn _this.fitseq( path, ltres, qtres, seqstart, splitpoint ).concat(\n\t\t\t\t_this.fitseq( path, ltres, qtres, splitpoint, seqend ) );\n\t\t\n\t},// End of fitseq()\n\t\n\t// 5. Batch tracing paths\n\tthis.batchtracepaths = function(internodepaths,ltres,qtres){\n\t\tvar btracedpaths = [];\n\t\tfor(var k in internodepaths){\n\t\t\tif(!internodepaths.hasOwnProperty(k)){ continue; }\n\t\t\tbtracedpaths.push( _this.tracepath(internodepaths[k],ltres,qtres) );\n\t\t}\n\t\treturn btracedpaths;\n\t},\n\t\n\t// 5. Batch tracing layers\n\tthis.batchtracelayers = function(binternodes, ltres, qtres){\n\t\tvar btbis = [];\n\t\tfor(var k in binternodes){\n\t\t\tif(!binternodes.hasOwnProperty(k)){ continue; }\n\t\t\tbtbis[k] = _this.batchtracepaths(binternodes[k], ltres, qtres);\n\t\t}\n\t\treturn btbis;\n\t},\n\t\n\t////////////////////////////////////////////////////////////\n\t//\n\t//  SVG Drawing functions\n\t//\n\t////////////////////////////////////////////////////////////\n\t\n\t// Rounding to given decimals https://stackoverflow.com/questions/11832914/round-to-at-most-2-decimal-places-in-javascript\n\tthis.roundtodec = function(val,places){ return +val.toFixed(places); },\n\t\n\t// Getting SVG path element string from a traced path\n\tthis.svgpathstring = function( tracedata, lnum, pathnum, options ){\n\t\t\n\t\tvar layer = tracedata.layers[lnum], smp = layer[pathnum], str='', pcnt;\n\t\t\n\t\t// Line filter\n\t\tif(options.linefilter && (smp.segments.length < 3)){ return str; }\n\t\t\n\t\t// Starting path element, desc contains layer and path number\n\t\tstr = '<path '+\n\t\t\t( options.desc ? ('desc=\"l '+lnum+' p '+pathnum+'\" ') : '' ) +\n\t\t\t_this.tosvgcolorstr(tracedata.palette[lnum], options) +\n\t\t\t'd=\"';\n\t\t\n\t\t// Creating non-hole path string\n\t\tif( options.roundcoords === -1 ){\n\t\t\tstr += 'M '+ smp.segments[0].x1 * options.scale +' '+ smp.segments[0].y1 * options.scale +' ';\n\t\t\tfor(pcnt=0; pcnt<smp.segments.length; pcnt++){\n\t\t\t\tstr += smp.segments[pcnt].type +' '+ smp.segments[pcnt].x2 * options.scale +' '+ smp.segments[pcnt].y2 * options.scale +' ';\n\t\t\t\tif(smp.segments[pcnt].hasOwnProperty('x3')){\n\t\t\t\t\tstr += smp.segments[pcnt].x3 * options.scale +' '+ smp.segments[pcnt].y3 * options.scale +' ';\n\t\t\t\t}\n\t\t\t}\n\t\t\tstr += 'Z ';\n\t\t}else{\n\t\t\tstr += 'M '+ _this.roundtodec( smp.segments[0].x1 * options.scale, options.roundcoords ) +' '+ _this.roundtodec( smp.segments[0].y1 * options.scale, options.roundcoords ) +' ';\n\t\t\tfor(pcnt=0; pcnt<smp.segments.length; pcnt++){\n\t\t\t\tstr += smp.segments[pcnt].type +' '+ _this.roundtodec( smp.segments[pcnt].x2 * options.scale, options.roundcoords ) +' '+ _this.roundtodec( smp.segments[pcnt].y2 * options.scale, options.roundcoords ) +' ';\n\t\t\t\tif(smp.segments[pcnt].hasOwnProperty('x3')){\n\t\t\t\t\tstr += _this.roundtodec( smp.segments[pcnt].x3 * options.scale, options.roundcoords ) +' '+ _this.roundtodec( smp.segments[pcnt].y3 * options.scale, options.roundcoords ) +' ';\n\t\t\t\t}\n\t\t\t}\n\t\t\tstr += 'Z ';\n\t\t}// End of creating non-hole path string\n\t\t\n\t\t// Hole children\n\t\tfor( var hcnt=0; hcnt < smp.holechildren.length; hcnt++){\n\t\t\tvar hsmp = layer[ smp.holechildren[hcnt] ];\n\t\t\t// Creating hole path string\n\t\t\tif( options.roundcoords === -1 ){\n\t\t\t\t\n\t\t\t\tif(hsmp.segments[ hsmp.segments.length-1 ].hasOwnProperty('x3')){\n\t\t\t\t\tstr += 'M '+ hsmp.segments[ hsmp.segments.length-1 ].x3 * options.scale +' '+ hsmp.segments[ hsmp.segments.length-1 ].y3 * options.scale +' ';\n\t\t\t\t}else{\n\t\t\t\t\tstr += 'M '+ hsmp.segments[ hsmp.segments.length-1 ].x2 * options.scale +' '+ hsmp.segments[ hsmp.segments.length-1 ].y2 * options.scale +' ';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfor(pcnt = hsmp.segments.length-1; pcnt >= 0; pcnt--){\n\t\t\t\t\tstr += hsmp.segments[pcnt].type +' ';\n\t\t\t\t\tif(hsmp.segments[pcnt].hasOwnProperty('x3')){\n\t\t\t\t\t\tstr += hsmp.segments[pcnt].x2 * options.scale +' '+ hsmp.segments[pcnt].y2 * options.scale +' ';\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tstr += hsmp.segments[pcnt].x1 * options.scale +' '+ hsmp.segments[pcnt].y1 * options.scale +' ';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}else{\n\t\t\t\t\n\t\t\t\tif(hsmp.segments[ hsmp.segments.length-1 ].hasOwnProperty('x3')){\n\t\t\t\t\tstr += 'M '+ _this.roundtodec( hsmp.segments[ hsmp.segments.length-1 ].x3 * options.scale ) +' '+ _this.roundtodec( hsmp.segments[ hsmp.segments.length-1 ].y3 * options.scale ) +' ';\n\t\t\t\t}else{\n\t\t\t\t\tstr += 'M '+ _this.roundtodec( hsmp.segments[ hsmp.segments.length-1 ].x2 * options.scale ) +' '+ _this.roundtodec( hsmp.segments[ hsmp.segments.length-1 ].y2 * options.scale ) +' ';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfor(pcnt = hsmp.segments.length-1; pcnt >= 0; pcnt--){\n\t\t\t\t\tstr += hsmp.segments[pcnt].type +' ';\n\t\t\t\t\tif(hsmp.segments[pcnt].hasOwnProperty('x3')){\n\t\t\t\t\t\tstr += _this.roundtodec( hsmp.segments[pcnt].x2 * options.scale ) +' '+ _this.roundtodec( hsmp.segments[pcnt].y2 * options.scale ) +' ';\n\t\t\t\t\t}\n\t\t\t\t\tstr += _this.roundtodec( hsmp.segments[pcnt].x1 * options.scale ) +' '+ _this.roundtodec( hsmp.segments[pcnt].y1 * options.scale ) +' ';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t}// End of creating hole path string\n\t\t\t\n\t\t\tstr += 'Z '; // Close path\n\t\t\t\n\t\t}// End of holepath check\n\t\t\n\t\t// Closing path element\n\t\tstr += '\" />';\n\t\t\n\t\t// Rendering control points\n\t\tif(options.lcpr || options.qcpr){\n\t\t\tfor(pcnt=0; pcnt<smp.segments.length; pcnt++){\n\t\t\t\tif( smp.segments[pcnt].hasOwnProperty('x3') && options.qcpr ){\n\t\t\t\t\tstr += '<circle cx=\"'+ smp.segments[pcnt].x2 * options.scale +'\" cy=\"'+ smp.segments[pcnt].y2 * options.scale +'\" r=\"'+ options.qcpr +'\" fill=\"cyan\" stroke-width=\"'+ options.qcpr * 0.2 +'\" stroke=\"black\" />';\n\t\t\t\t\tstr += '<circle cx=\"'+ smp.segments[pcnt].x3 * options.scale +'\" cy=\"'+ smp.segments[pcnt].y3 * options.scale +'\" r=\"'+ options.qcpr +'\" fill=\"white\" stroke-width=\"'+ options.qcpr * 0.2 +'\" stroke=\"black\" />';\n\t\t\t\t\tstr += '<line x1=\"'+ smp.segments[pcnt].x1 * options.scale +'\" y1=\"'+ smp.segments[pcnt].y1 * options.scale +'\" x2=\"'+ smp.segments[pcnt].x2 * options.scale +'\" y2=\"'+ smp.segments[pcnt].y2 * options.scale +'\" stroke-width=\"'+ options.qcpr * 0.2 +'\" stroke=\"cyan\" />';\n\t\t\t\t\tstr += '<line x1=\"'+ smp.segments[pcnt].x2 * options.scale +'\" y1=\"'+ smp.segments[pcnt].y2 * options.scale +'\" x2=\"'+ smp.segments[pcnt].x3 * options.scale +'\" y2=\"'+ smp.segments[pcnt].y3 * options.scale +'\" stroke-width=\"'+ options.qcpr * 0.2 +'\" stroke=\"cyan\" />';\n\t\t\t\t}\n\t\t\t\tif( (!smp.segments[pcnt].hasOwnProperty('x3')) && options.lcpr){\n\t\t\t\t\tstr += '<circle cx=\"'+ smp.segments[pcnt].x2 * options.scale +'\" cy=\"'+ smp.segments[pcnt].y2 * options.scale +'\" r=\"'+ options.lcpr +'\" fill=\"white\" stroke-width=\"'+ options.lcpr * 0.2 +'\" stroke=\"black\" />';\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// Hole children control points\n\t\t\tfor( var hcnt=0; hcnt < smp.holechildren.length; hcnt++){\n\t\t\t\tvar hsmp = layer[ smp.holechildren[hcnt] ];\n\t\t\t\tfor(pcnt=0; pcnt<hsmp.segments.length; pcnt++){\n\t\t\t\t\tif( hsmp.segments[pcnt].hasOwnProperty('x3') && options.qcpr ){\n\t\t\t\t\t\tstr += '<circle cx=\"'+ hsmp.segments[pcnt].x2 * options.scale +'\" cy=\"'+ hsmp.segments[pcnt].y2 * options.scale +'\" r=\"'+ options.qcpr +'\" fill=\"cyan\" stroke-width=\"'+ options.qcpr * 0.2 +'\" stroke=\"black\" />';\n\t\t\t\t\t\tstr += '<circle cx=\"'+ hsmp.segments[pcnt].x3 * options.scale +'\" cy=\"'+ hsmp.segments[pcnt].y3 * options.scale +'\" r=\"'+ options.qcpr +'\" fill=\"white\" stroke-width=\"'+ options.qcpr * 0.2 +'\" stroke=\"black\" />';\n\t\t\t\t\t\tstr += '<line x1=\"'+ hsmp.segments[pcnt].x1 * options.scale +'\" y1=\"'+ hsmp.segments[pcnt].y1 * options.scale +'\" x2=\"'+ hsmp.segments[pcnt].x2 * options.scale +'\" y2=\"'+ hsmp.segments[pcnt].y2 * options.scale +'\" stroke-width=\"'+ options.qcpr * 0.2 +'\" stroke=\"cyan\" />';\n\t\t\t\t\t\tstr += '<line x1=\"'+ hsmp.segments[pcnt].x2 * options.scale +'\" y1=\"'+ hsmp.segments[pcnt].y2 * options.scale +'\" x2=\"'+ hsmp.segments[pcnt].x3 * options.scale +'\" y2=\"'+ hsmp.segments[pcnt].y3 * options.scale +'\" stroke-width=\"'+ options.qcpr * 0.2 +'\" stroke=\"cyan\" />';\n\t\t\t\t\t}\n\t\t\t\t\tif( (!hsmp.segments[pcnt].hasOwnProperty('x3')) && options.lcpr){\n\t\t\t\t\t\tstr += '<circle cx=\"'+ hsmp.segments[pcnt].x2 * options.scale +'\" cy=\"'+ hsmp.segments[pcnt].y2 * options.scale +'\" r=\"'+ options.lcpr +'\" fill=\"white\" stroke-width=\"'+ options.lcpr * 0.2 +'\" stroke=\"black\" />';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}// End of Rendering control points\n\t\t\t\n\t\treturn str;\n\t\t\n\t},// End of svgpathstring()\n\t\n\t// Converting tracedata to an SVG string\n\tthis.getsvgstring = function( tracedata, options ){\n\t\t\n\t\toptions = _this.checkoptions(options);\n\t\t\n\t\tvar w = tracedata.width * options.scale, h = tracedata.height * options.scale;\n\t\t\n\t\t// SVG start\n\t\tvar svgstr = '<svg ' + (options.viewbox ? ('viewBox=\"0 0 '+w+' '+h+'\" ') : ('width=\"'+w+'\" height=\"'+h+'\" ')) +\n\t\t\t'version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" desc=\"Created with imagetracer.js version '+_this.versionnumber+'\" >';\n\n\t\t// Drawing: Layers and Paths loops\n\t\tfor(var lcnt=0; lcnt < tracedata.layers.length; lcnt++){\n\t\t\tfor(var pcnt=0; pcnt < tracedata.layers[lcnt].length; pcnt++){\n\t\t\t\t\n\t\t\t\t// Adding SVG <path> string\n\t\t\t\tif( !tracedata.layers[lcnt][pcnt].isholepath ){\n\t\t\t\t\tsvgstr += _this.svgpathstring( tracedata, lcnt, pcnt, options );\n\t\t\t\t}\n\t\t\t\t\t\n\t\t\t}// End of paths loop\n\t\t}// End of layers loop\n\t\t\n\t\t// SVG End\n\t\tsvgstr+='</svg>';\n\t\t\n\t\treturn svgstr;\n\t\t\n\t},// End of getsvgstring()\n\t\n\t// Comparator for numeric Array.sort\n\tthis.compareNumbers = function(a,b){ return a - b; },\n\t\n\t// Convert color object to rgba string\n\tthis.torgbastr = function(c){ return 'rgba('+c.r+','+c.g+','+c.b+','+c.a+')'; },\n\t\n\t// Convert color object to SVG color string\n\tthis.tosvgcolorstr = function(c, options){\n\t\treturn 'fill=\"rgb('+c.r+','+c.g+','+c.b+')\" stroke=\"rgb('+c.r+','+c.g+','+c.b+')\" stroke-width=\"'+options.strokewidth+'\" opacity=\"'+c.a/255.0+'\" ';\n\t},\n\t\n\t// Helper function: Appending an <svg> element to a container from an svgstring\n\tthis.appendSVGString = function(svgstr,parentid){\n\t\tvar div;\n\t\tif(parentid){\n\t\t\tdiv = document.getElementById(parentid);\n\t\t\tif(!div){\n\t\t\t\tdiv = document.createElement('div');\n\t\t\t\tdiv.id = parentid;\n\t\t\t\tdocument.body.appendChild(div);\n\t\t\t}\n\t\t}else{\n\t\t\tdiv = document.createElement('div');\n\t\t\tdocument.body.appendChild(div);\n\t\t}\n\t\tdiv.innerHTML += svgstr;\n\t},\n\t\n\t////////////////////////////////////////////////////////////\n\t//\n\t//  Canvas functions\n\t//\n\t////////////////////////////////////////////////////////////\n\t\n\t// Gaussian kernels for blur\n\tthis.gks = [ [0.27901,0.44198,0.27901], [0.135336,0.228569,0.272192,0.228569,0.135336], [0.086776,0.136394,0.178908,0.195843,0.178908,0.136394,0.086776],\n\t             [0.063327,0.093095,0.122589,0.144599,0.152781,0.144599,0.122589,0.093095,0.063327], [0.049692,0.069304,0.089767,0.107988,0.120651,0.125194,0.120651,0.107988,0.089767,0.069304,0.049692] ],\n\t\n\t// Selective Gaussian blur for preprocessing\n\tthis.blur = function(imgd,radius,delta){\n\t\tvar i,j,k,d,idx,racc,gacc,bacc,aacc,wacc;\n\t\t\n\t\t// new ImageData\n\t\tvar imgd2 = { width:imgd.width, height:imgd.height, data:[] };\n\t\t\n\t\t// radius and delta limits, this kernel\n\t\tradius = Math.floor(radius); if(radius<1){ return imgd; } if(radius>5){ radius = 5; } delta = Math.abs( delta ); if(delta>1024){ delta = 1024; }\n\t\tvar thisgk = _this.gks[radius-1];\n\t\t\n\t\t// loop through all pixels, horizontal blur\n\t\tfor( j=0; j < imgd.height; j++ ){\n\t\t\tfor( i=0; i < imgd.width; i++ ){\n\n\t\t\t\tracc = 0; gacc = 0; bacc = 0; aacc = 0; wacc = 0;\n\t\t\t\t// gauss kernel loop\n\t\t\t\tfor( k = -radius; k < radius+1; k++){\n\t\t\t\t\t// add weighted color values\n\t\t\t\t\tif( (i+k > 0) && (i+k < imgd.width) ){\n\t\t\t\t\t\tidx = (j*imgd.width+i+k)*4;\n\t\t\t\t\t\tracc += imgd.data[idx  ] * thisgk[k+radius];\n\t\t\t\t\t\tgacc += imgd.data[idx+1] * thisgk[k+radius];\n\t\t\t\t\t\tbacc += imgd.data[idx+2] * thisgk[k+radius];\n\t\t\t\t\t\taacc += imgd.data[idx+3] * thisgk[k+radius];\n\t\t\t\t\t\twacc += thisgk[k+radius];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// The new pixel\n\t\t\t\tidx = (j*imgd.width+i)*4;\n\t\t\t\timgd2.data[idx  ] = Math.floor(racc / wacc);\n\t\t\t\timgd2.data[idx+1] = Math.floor(gacc / wacc);\n\t\t\t\timgd2.data[idx+2] = Math.floor(bacc / wacc);\n\t\t\t\timgd2.data[idx+3] = Math.floor(aacc / wacc);\n\t\t\t\t\n\t\t\t}// End of width loop\n\t\t}// End of horizontal blur\n\t\t\n\t\t// copying the half blurred imgd2\n\t\tvar himgd = new Uint8ClampedArray(imgd2.data);\n\t\t\n\t\t// loop through all pixels, vertical blur\n\t\tfor( j=0; j < imgd.height; j++ ){\n\t\t\tfor( i=0; i < imgd.width; i++ ){\n\n\t\t\t\tracc = 0; gacc = 0; bacc = 0; aacc = 0; wacc = 0;\n\t\t\t\t// gauss kernel loop\n\t\t\t\tfor( k = -radius; k < radius+1; k++){\n\t\t\t\t\t// add weighted color values\n\t\t\t\t\tif( (j+k > 0) && (j+k < imgd.height) ){\n\t\t\t\t\t\tidx = ((j+k)*imgd.width+i)*4;\n\t\t\t\t\t\tracc += himgd[idx  ] * thisgk[k+radius];\n\t\t\t\t\t\tgacc += himgd[idx+1] * thisgk[k+radius];\n\t\t\t\t\t\tbacc += himgd[idx+2] * thisgk[k+radius];\n\t\t\t\t\t\taacc += himgd[idx+3] * thisgk[k+radius];\n\t\t\t\t\t\twacc += thisgk[k+radius];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// The new pixel\n\t\t\t\tidx = (j*imgd.width+i)*4;\n\t\t\t\timgd2.data[idx  ] = Math.floor(racc / wacc);\n\t\t\t\timgd2.data[idx+1] = Math.floor(gacc / wacc);\n\t\t\t\timgd2.data[idx+2] = Math.floor(bacc / wacc);\n\t\t\t\timgd2.data[idx+3] = Math.floor(aacc / wacc);\n\t\t\t\t\n\t\t\t}// End of width loop\n\t\t}// End of vertical blur\n\t\t\n\t\t// Selective blur: loop through all pixels\n\t\tfor( j=0; j < imgd.height; j++ ){\n\t\t\tfor( i=0; i < imgd.width; i++ ){\n\t\t\t\t\n\t\t\t\tidx = (j*imgd.width+i)*4;\n\t\t\t\t// d is the difference between the blurred and the original pixel\n\t\t\t\td = Math.abs(imgd2.data[idx  ] - imgd.data[idx  ]) + Math.abs(imgd2.data[idx+1] - imgd.data[idx+1]) +\n\t\t\t\t\tMath.abs(imgd2.data[idx+2] - imgd.data[idx+2]) + Math.abs(imgd2.data[idx+3] - imgd.data[idx+3]);\n\t\t\t\t// selective blur: if d>delta, put the original pixel back\n\t\t\t\tif(d>delta){\n\t\t\t\t\timgd2.data[idx  ] = imgd.data[idx  ];\n\t\t\t\t\timgd2.data[idx+1] = imgd.data[idx+1];\n\t\t\t\t\timgd2.data[idx+2] = imgd.data[idx+2];\n\t\t\t\t\timgd2.data[idx+3] = imgd.data[idx+3];\n\t\t\t\t}\n\t\t\t}\n\t\t}// End of Selective blur\n\t\t\n\t\treturn imgd2;\n\t\t\n\t},// End of blur()\n\t\n\t// Helper function: loading an image from a URL, then executing callback with canvas as argument\n\tthis.loadImage = function(url,callback,options){\n\t\tvar img = new Image();\n\t\tif(options && options.corsenabled){ img.crossOrigin = 'Anonymous'; }\n\t\timg.onload = function(){\n\t\t\tvar canvas = document.createElement('canvas');\n\t\t\tcanvas.width = img.width;\n\t\t\tcanvas.height = img.height;\n\t\t\tvar context = canvas.getContext('2d');\n\t\t\tcontext.drawImage(img,0,0);\n\t\t\tcallback(canvas);\n\t\t};\n\t\timg.src = url;\n\t},\n\t\n\t// Helper function: getting ImageData from a canvas\n\tthis.getImgdata = function(canvas){\n\t\tvar context = canvas.getContext('2d');\n\t\treturn context.getImageData(0,0,canvas.width,canvas.height);\n\t},\n\t\n\t// Special palette to use with drawlayers()\n\tthis.specpalette = [\n\t\t{r:0,g:0,b:0,a:255}, {r:128,g:128,b:128,a:255}, {r:0,g:0,b:128,a:255}, {r:64,g:64,b:128,a:255},\n\t\t{r:192,g:192,b:192,a:255}, {r:255,g:255,b:255,a:255}, {r:128,g:128,b:192,a:255}, {r:0,g:0,b:192,a:255},\n\t\t{r:128,g:0,b:0,a:255}, {r:128,g:64,b:64,a:255}, {r:128,g:0,b:128,a:255}, {r:168,g:168,b:168,a:255},\n\t\t{r:192,g:128,b:128,a:255}, {r:192,g:0,b:0,a:255}, {r:255,g:255,b:255,a:255}, {r:0,g:128,b:0,a:255}\n\t],\n\t\n\t// Helper function: Drawing all edge node layers into a container\n\tthis.drawLayers = function(layers,palette,scale,parentid){\n\t\tscale = scale||1;\n\t\tvar w,h,i,j,k;\n\t\t\n\t\t// Preparing container\n\t\tvar div;\n\t\tif(parentid){\n\t\t\tdiv = document.getElementById(parentid);\n\t\t\tif(!div){\n\t\t\t\tdiv = document.createElement('div');\n\t\t\t\tdiv.id = parentid;\n\t\t\t\tdocument.body.appendChild(div);\n\t\t\t}\n\t\t}else{\n\t\t\tdiv = document.createElement('div');\n\t\t\tdocument.body.appendChild(div);\n\t\t}\n\t\t\n\t\t// Layers loop\n\t\tfor (k in layers) {\n\t\t\tif(!layers.hasOwnProperty(k)){ continue; }\n\t\t\t\n\t\t\t// width, height\n\t\t\tw=layers[k][0].length; h=layers[k].length;\n\t\t\t\n\t\t\t// Creating new canvas for every layer\n\t\t\tvar canvas = document.createElement('canvas'); canvas.width=w*scale; canvas.height=h*scale;\n\t\t\tvar context = canvas.getContext('2d');\n\t\t\t\n\t\t\t// Drawing\n\t\t\tfor(j=0; j<h; j++){\n\t\t\t\tfor(i=0; i<w; i++){\n\t\t\t\t\tcontext.fillStyle = _this.torgbastr(palette[ layers[k][j][i]%palette.length ]);\n\t\t\t\t\tcontext.fillRect(i*scale,j*scale,scale,scale);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// Appending canvas to container\n\t\t\tdiv.appendChild(canvas);\n\t\t}// End of Layers loop\n\t}// End of drawlayers\n\t\n\t;// End of function list\n\t\n}// End of ImageTracer object\n\n// export as AMD module / Node module / browser or worker variable\nif(typeof define === 'function' && define.amd){\n\tdefine(function() { return new ImageTracer(); });\n}else if(typeof module !== 'undefined'){\n\tmodule.exports = new ImageTracer();\n}else if(typeof self !== 'undefined'){\n\tself.ImageTracer = new ImageTracer();\n}else window.ImageTracer = new ImageTracer();\n\n})();","/* eslint-disable no-restricted-globals */\n// @ts-ignore\nimport ImageTracer from 'imagetracerjs';\n\nself.onmessage = (e: MessageEvent) => {\n  const { imageData, options } = e.data;\n\n  try {\n    // ImageTracer.imagedataToSVG expects an ImageData-like object { width, height, data }\n    // and an options object.\n    const svgString = ImageTracer.imagedataToSVG(imageData, options);\n    \n    self.postMessage({ type: 'success', svg: svgString });\n  } catch (error) {\n    self.postMessage({ type: 'error', error: String(error) });\n  }\n};\n"],"names":["ImageTracer","_this","url","callback","options","canvas","imgd","td","ii","tracedata","colornum","tracedlayer","ls","bps","bis","ok","k","arr","idx","cd","cdl","ci","paletteacc","pixelnum","i","j","cnt","palette","newimgddata","pxcnt","numberofcolors","ni","nj","vx","vy","rcnt","gcnt","bcnt","graystep","colorqnum","colorstep","rndnum","layers","val","ah","aw","n1","n2","n3","n4","n5","n6","n7","n8","cnum","layer","p","pa","isin","pathomit","paths","pacnt","pcnt","px","py","w","h","dir","pathfinished","holepath","lookuprow","parentidx","parentbbox","parentcnt","childbbox","bpaths","ins","palen","nextidx","nextidx2","previdx","previdx2","path","idx1","idx2","idx3","idx4","idx5","x1","y1","x2","y2","binternodes","ltres","qtres","segtype1","segtype2","seqend","smp","seqstart","errorpoint","errorval","curvepass","dist2","tl","pl","fitpoint","t","t1","t2","t3","cpx","cpy","splitpoint","internodepaths","btracedpaths","btbis","places","lnum","pathnum","str","hcnt","hsmp","svgstr","lcnt","a","b","c","parentid","div","radius","delta","d","racc","gacc","bacc","aacc","wacc","imgd2","thisgk","himgd","img","context","scale","module","e","imageData","svgString","error"],"mappings":"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G,GAAG,EAAE,EAAG,CAAC,GAAG,GAAG,GAAG,EAAE,CAAC,EAC3D,CAAC,CAAE,EAAG,EAAG,EAAE,EAAE,EAAG,CAAC,GAAG,GAAG,GAAG,EAAE,EAAG,CAAC,GAAG,GAAG,GAAG,EAAE,EAAG,CAAE,EAAG,EAAE,GAAI,CAAC,CAAC,EAC3D,CAAC,CAAC,GAAG,GAAG,GAAG,EAAE,EAAG,CAAC,GAAG,GAAG,GAAG,EAAE,EAAG,CAAE,EAAG,EAAG,EAAE,EAAE,EAAG,CAAE,EAAG,EAAG,EAAG,CAAC,CAAC,EAC3D,CAAC,CAAE,EAAG,EAAG,EAAG,CAAC,EAAG,CAAC,GAAG,GAAG,GAAG,EAAE,EAAG,CAAE,EAAG,EAAE,GAAI,CAAC,EAAG,CAAC,GAAG,GAAG,GAAG,EAAE,CAAC,EAE3D,CAAC,CAAC,GAAG,GAAG,GAAG,EAAE,EAAG,CAAE,EAAG,EAAG,EAAG,CAAC,EAAG,CAAE,EAAG,EAAG,EAAG,CAAC,EAAG,CAAC,GAAG,GAAG,GAAG,EAAE,CAAC,EAC3D,CAAC,CAAC,GAAI,EAAG,EAAG,CAAC,EAAG,CAAC,GAAI,EAAE,GAAI,CAAC,EAAG,CAAE,EAAG,EAAG,EAAE,EAAE,EAAG,CAAE,EAAG,EAAG,EAAG,CAAC,CAAC,EAC3D,CAAC,CAAC,GAAG,GAAG,GAAG,EAAE,EAAG,CAAE,EAAG,EAAG,EAAE,EAAE,EAAG,CAAC,GAAG,GAAG,GAAG,EAAE,EAAG,CAAE,EAAG,EAAG,EAAG,CAAC,CAAC,EAC3D,CAAC,CAAE,EAAG,EAAG,EAAG,CAAC,EAAG,CAAE,EAAG,EAAE,GAAI,CAAC,EAAG,CAAC,GAAG,GAAG,GAAG,EAAE,EAAG,CAAC,GAAG,GAAG,GAAG,EAAE,CAAC,EAE3D,CAAC,CAAE,EAAG,EAAG,EAAG,CAAC,EAAG,CAAE,EAAG,EAAE,GAAI,CAAC,EAAG,CAAC,GAAG,GAAG,GAAG,EAAE,EAAG,CAAC,GAAG,GAAG,GAAG,EAAE,CAAC,EAC3D,CAAC,CAAC,GAAG,GAAG,GAAG,EAAE,EAAG,CAAE,EAAG,EAAG,EAAE,EAAE,EAAG,CAAC,GAAG,GAAG,GAAG,EAAE,EAAG,CAAE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","x_google_ignoreList":[0]}